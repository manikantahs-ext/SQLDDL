-- DDL Export
-- Server: 10.253.33.91
-- Database: Dustbin
-- Exported: 2026-02-05T12:29:06.510491

USE Dustbin;
GO

-- --------------------------------------------------
-- INDEX dbo.allocate_temp
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [party] ON [dbo].[allocate_temp] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.allocate_temp_NEW
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [party] ON [dbo].[allocate_temp_NEW] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.allocate_temp_NEW
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Seg] ON [dbo].[allocate_temp_NEW] ([EXCHANGE], [SEGMENT])

GO

-- --------------------------------------------------
-- INDEX dbo.b2b_pricing_communication_1
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [f] ON [dbo].[b2b_pricing_communication_1] ([sNo])

GO

-- --------------------------------------------------
-- INDEX dbo.bal_2122
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [clt] ON [dbo].[bal_2122] ([Cltcode], [vtyp])

GO

-- --------------------------------------------------
-- INDEX dbo.Brokchangenew
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Code] ON [dbo].[Brokchangenew] ([partycode])

GO

-- --------------------------------------------------
-- INDEX dbo.ChangeDeactivateFlagC
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IXDUSTBINDBOChangeDeactivateFlagC] ON [dbo].[ChangeDeactivateFlagC] ([CL_CODE]) INCLUDE ([EXCHANGE], [SEGMENT])

GO

-- --------------------------------------------------
-- INDEX dbo.Client_custom_brok
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Cl_code] ON [dbo].[Client_custom_brok] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.clientbrokdata
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idx_clientbrokdata] ON [dbo].[clientbrokdata] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.clientbrokdata1
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idx_clientbrokdata1] ON [dbo].[clientbrokdata1] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.dormant_19112022
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_Cl_code] ON [dbo].[dormant_19112022] ([CL_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.dormant191122
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Cl] ON [dbo].[dormant191122] ([CL_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.DormantSuspendClient_11112022
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [party] ON [dbo].[DormantSuspendClient_11112022] ([CL_code])

GO

-- --------------------------------------------------
-- INDEX dbo.DP_Charges_for_Accrual
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [party] ON [dbo].[DP_Charges_for_Accrual] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.FINAL_PEAK_BENEFIT_Check
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Transdate] ON [dbo].[FINAL_PEAK_BENEFIT_Check] ([TRANSDATE])

GO

-- --------------------------------------------------
-- INDEX dbo.finaltest_hold
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [s] ON [dbo].[finaltest_hold] ([Process_Date], [party_code], [ISIN])

GO

-- --------------------------------------------------
-- INDEX dbo.Gst_Change
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [c] ON [dbo].[Gst_Change] ([Cl_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.led_mtf
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [c] ON [dbo].[led_mtf] ([vdt], [vtyp], [lno], [cltcode])

GO

-- --------------------------------------------------
-- INDEX dbo.MARGIN_Peak_Ledger_Test
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mar] ON [dbo].[MARGIN_Peak_Ledger_Test] ([MArgindate], [Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.nse_bulk_process_test1
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [s] ON [dbo].[nse_bulk_process_test1] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.SegregationCollateralUpdation
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_DUSTBINSegregationCollateralUpdation] ON [dbo].[SegregationCollateralUpdation] ([PARTY_CODE]) INCLUDE ([PROCESS_DT], [SEGMENT], [EXCHANGE])

GO

-- --------------------------------------------------
-- INDEX dbo.settlement_bse_18102022
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_settlement_bse_18102022] ON [dbo].[settlement_bse_18102022] ([Sauda_date], [Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.settlement_nse_18102022
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_settlement_nse_18102022] ON [dbo].[settlement_nse_18102022] ([Sauda_date], [Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_COMBINE_REPORTING_PEAK_DETAIL_test
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_MagPar] ON [dbo].[TBL_COMBINE_REPORTING_PEAK_DETAIL_test] ([MARGINDATE], [PARTY_CODE], [EXCHANGE])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_COMBINE_REPORTING_PEAK_test
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_MagPar] ON [dbo].[TBL_COMBINE_REPORTING_PEAK_test] ([MARGINDATE], [PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_CUSPA_RELEASE_PROCESS
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_PARTY] ON [dbo].[TBL_CUSPA_RELEASE_PROCESS] ([PARTY_CODE], [PROCESS_DATE], [APPROVED_AMT])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_CUSPA_SHARE_RELEASE_PROCESS
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_PARTY] ON [dbo].[TBL_CUSPA_SHARE_RELEASE_PROCESS] ([PARTY_CODE], [PROCESS_DATE], [RELEASE_QTY])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_CUSPA_SHARE_RELEASE_PROCESS
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SCRIP] ON [dbo].[TBL_CUSPA_SHARE_RELEASE_PROCESS] ([ISIN], [SCRIP_CD], [SERIES])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_dormant_data
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [s] ON [dbo].[tbl_dormant_data] ([CL_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_Dormant_Omny
-- --------------------------------------------------
CREATE CLUSTERED INDEX [party] ON [dbo].[Tbl_Dormant_Omny] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_b2c
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_party] ON [dbo].[temp_b2c] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_penalty
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Part] ON [dbo].[temp_penalty] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_sebi
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Party] ON [dbo].[temp_sebi] ([partycode])

GO

-- --------------------------------------------------
-- INDEX dbo.Trade_info
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_party] ON [dbo].[Trade_info] ([Cltcode], [vdt], [exchange])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.fund_movements_ledger_stg
-- --------------------------------------------------
ALTER TABLE [dbo].[fund_movements_ledger_stg] ADD CONSTRAINT [fund_movements_ledger_stg_new_1] PRIMARY KEY ([vtyp], [actionSegment], [cltcode], [drcr], [edt], [vdt])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.LEDGER
-- --------------------------------------------------
ALTER TABLE [dbo].[LEDGER] ADD CONSTRAINT [PK1_LEDGER] PRIMARY KEY ([VDT], [CLTCODE], [VTYP], [VNO], [LNO], [BOOKTYPE], [DRCR])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Mcastudents
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Mcastudents] ADD CONSTRAINT [PK__tbl_Mcas__3214EC0759179C21] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tblPub
-- --------------------------------------------------
ALTER TABLE [dbo].[tblPub] ADD CONSTRAINT [PK_tblPub] PRIMARY KEY ([SrNo])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tblPub_1
-- --------------------------------------------------
ALTER TABLE [dbo].[tblPub_1] ADD CONSTRAINT [PK_tblPub_1] PRIMARY KEY ([SrNo])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tblPublisher
-- --------------------------------------------------
ALTER TABLE [dbo].[tblPublisher] ADD CONSTRAINT [PK_tblPublisher] PRIMARY KEY ([SrNo])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.test_repl_nosync
-- --------------------------------------------------
ALTER TABLE [dbo].[test_repl_nosync] ADD CONSTRAINT [PK__test_rep__3213E83F058EC7FB] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Angel_nri_data_lec_new_15may2023
-- --------------------------------------------------
CREATE PROC [dbo].[Angel_nri_data_lec_new_15may2023](@SDATE  AS VARCHAR(11),                                    
                                   @TYPE   AS INT,                                    
                                   @BANKID AS INT,                                    
                                   @SEG    AS VARCHAR(5))                                    
AS                                    
  BEGIN                                    
      SET NOCOUNT ON                                    
    --  DECLARE @SDATE AS VARCHAR(11),@TYPE AS VARCHAR(2),@BANKID AS INT,@SEG AS VARCHAR(5)                                                                            
   --   SET @SDATE ='10/05/2022' SET @TYPE ='2' SET @BANKID =0 SET @SEG='NSE'                                                                            
      SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103))                                
                           
   create table #output ([output] varchar(200))                        
                           
 -- insert into #output                        
  --   Exec master.dbo.xp_cmdshell 'NET USE \\INHOUSELIVEAPP1-FS.angelone.in\IPC$ /USER:Administrator Winw0rld@1604'                          
                          
      DECLARE @SELL_BUY        AS CHAR(1),                                    
              @TRANS_AMOUNT    AS DECIMAL(18, 2),                                    
              @calculation     AS DECIMAL(18, 2),                                    
              @HEADER_TOTALAMT AS DECIMAL(18, 2),                                    
              @diffamt         AS DECIMAL(18, 2);                                    
                                    
      SELECT @SELL_BUY = CASE                                    
                           WHEN @TYPE = 1 THEN 'P'                                    
                           WHEN @TYPE = 2 THEN 'S'                                    
                         END                                    
                                    
      IF( @SEG = 'NSE' )                                    
        BEGIN                                    
            CREATE TABLE #NSE_HEADER                                 
              (                                    
                 EXCHANGE           VARCHAR(50),                                    
                 PARTY_CODE         VARCHAR(50),                                    
                 SAUDA_DATE         DATETIME,                                    
                 SELL_BUY           INT,                                    
                 CONTRACTNO         VARCHAR(50),                                    
                 SERVICE_TAX        DECIMAL(18, 4),                                    
                 EDUCESS            INT,                                    
                 EXCHAGE_LEVIES     DECIMAL(18, 4),                                    
                 STT                DECIMAL(18, 4),                                    
                 STAMPDUTY          DECIMAL(18, 4),                                    
                 MINBROKERAGE       DECIMAL(18, 4),                                    
                 OTHER_CHARGES      DECIMAL(18, 4),                                    
                 NO_OF_TRANSACTIONS INT,                                    
                 TOTALAMT           DECIMAL(18, 2),                             
     SETT_NO            varchar(10)                        
              ); -- drop table #NSE_HEADER                                                        
                                    
            INSERT INTO #NSE_HEADER                                    
            EXEC DUSTBIN.dbo.Nsenriheader_T1                                    
              @SDATE,                                    
              @TYPE                                    
                                    
            --UPDATE #NSE_HEADER                    
            --      SET    TOTALAMT = TOTALAMT * ( -1 )                                    
                                
            CREATE TABLE #NSE_DETAILS                                    
 (                                    
EXCHANGE         VARCHAR(50),                                    
                 PARTY_CODE       VARCHAR(50),                  
                 SAUDA_DATE       DATETIME,                                    
                 CONTRACTNO       VARCHAR(50),                                 
                 TRANSACTION_TYPE CHAR(1),                                    
                 ISIN             VARCHAR(50),                      
                 qty              INT,                                    
                 Rate             DECIMAL(18, 6),                   
                 BROK_PERSCRIP    DECIMAL(18, 2),                                    
                 TRANACTIONAMT    DECIMAL(18, 4),                        
     Scripname    varchar(100),                        
    scripcode    varchar(100),                        
     SETT_NO         varchar(10),                        
     TRATE           DECIMAL(18, 6),                        
     OtherCharges    DECIMAL(18, 6),                        
     NseStt          DECIMAL(18, 6),                  
  OtherTax    DECIMAL(18, 6)                  
              );                                    
                                    
            INSERT INTO #NSE_DETAILS                                    
  EXEC DUSTBIN.DBO.[NSENRIDETAIL_T1_15may2023]                                    
              @SDATE,                                    
              @TYPE                                    
                                    
            --UPDATE #NSE_DETAILS                                    
            --      SET    TRANACTIONAMT = TRANACTIONAMT * ( -1 )                                    
        END                                    
      ELSE                                    
        BEGIN                                    
            CREATE TABLE #BSE_HEADER                                    
              (                                    
                 EXCHANGE           VARCHAR(50),                                    
                 PARTY_CODE         VARCHAR(50),                                    
                 SAUDA_DATE         DATETIME,                                    
                SELL_BUY           INT,                                    
                 CONTRACTNO         VARCHAR(50),                                    
                 SERVICE_TAX        DECIMAL(18, 4),                                    
                 EDUCESS            INT,                                    
                 EXCHAGE_LEVIES     DECIMAL(18, 4),                                    
                 STT                DECIMAL(18, 4),                                    
                 STAMPDUTY          DECIMAL(18, 4),                                    
                 MINBROKERAGE       DECIMAL(18, 4),                                    
                 OTHER_CHARGES      DECIMAL(18, 4),                                    
                 NO_OF_TRANSACTIONS INT,                                    
                 TOTALAMT           DECIMAL(18, 2),                         
     SETT_NO            varchar(10)                        
              ); -- drop table #BSE_HEADER                                                         
            INSERT INTO #BSE_HEADER                                    
            EXEC AngelBSECM.DUSTBIN.DBO.Bsenriheader_T1                                    
                      @SDATE,                                    
                      @TYPE                                    
                                    
            --UPDATE #BSE_HEADER                                    
            --      SET    TOTALAMT = TOTALAMT * ( -1 )                                    
                                  
            CREATE TABLE #BSE_DETAILS                                    
              (                                    
                 EXCHANGE         VARCHAR(50),           
                 PARTY_CODE       VARCHAR(50),                                    
                 SAUDA_DATE       DATETIME,                                    
                 CONTRACTNO       VARCHAR(50),                         
                 TRANSACTION_TYPE CHAR(1),                                    
                 ISIN             VARCHAR(50),                                    
                 qty              INT,                                    
               Rate             DECIMAL(18, 6),                                    
                 BROK_PERSCRIP    DECIMAL(18, 2),                                    
                 TRANACTIONAMT    DECIMAL(18, 4),                         
     Scripname    varchar(100),                        
     scripcode    varchar(100),                        
     SETT_NO         varchar(10),                        
     TRATE           DECIMAL(18, 6),                        
     OtherCharges     DECIMAL(18, 6),                        
     BseStt           DECIMAL(18, 6),                  
  OtherTax   DECIMAL(18, 6)                  
   ); -- drop table #BSE_DETAILS                                                         
                                    
            INSERT INTO #BSE_DETAILS                                    
            EXEC AngelBSECM.DUSTBIN.DBO.Bsenridetail_T1_15may2023                                   
              @SDATE,                             
              @TYPE                                    
                                    
            --UPDATE #BSE_DETAILS                                    
            --      SET    TRANACTIONAMT = TRANACTIONAMT * ( -1 )                                    
        END                                    
                           CREATE TABLE #TEMP1                                    
        (                                    
           FLDCOL VARCHAR(1000) ,                        
     BankName varchar(100)                        
        )                        
    truncate table tbl_NRILec_temp                        
  --create table tbl_NRILec_temp                        
  -- (                                    
       --      FLDCOL VARCHAR(1000)                                    
       --   )                        
                                    
      DECLARE @BSE AS INT                            
      DECLARE @NSE AS INT                                    
                                    
      SELECT @BSE = Count(*)                                    
      FROM   DUSTBIN.DBO.NRIBSE                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
      SELECT @NSE = Count(*)                                    
      FROM   DUSTBIN.DBO.NRINSE                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
      IF @BSE = 0                                    
          OR @NSE = 0                                    
        BEGIN                                    
            SELECT DISTINCT FLD_CLIENTCODE                                    
            INTO   #ZRCLI                           
            FROM   INTRANET.RISK.DBO.TBL_NRICLIENTMASTER B WITH (NOLOCK)                                    
                                    
            SELECT DISTINCT PARTY_CODE                                    
            INTO   #NRI_CLI                                    
            FROM   MSAJAG.DBO.CMBILLVALAN X WITH (NOLOCK)                                    
                   INNER JOIN #ZRCLI B WITH (NOLOCK)                                    
      ON X.PARTY_CODE = B.FLD_CLIENTCODE                                    
            WHERE  SAUDA_DATE = CONVERT(DATETIME, @SDATE, 103) --AND PARTY_CODE LIKE 'ZR%'                                                     
            UNION                                                                            
            SELECT DISTINCT PARTY_CODE                                    
            FROM   AngelBSECM.BSEDB_AB.DBO.CMBILLVALAN X WITH (NOLOCK)                                    
                   INNER JOIN #ZRCLI B WITH (NOLOCK)                                    
                     ON X.PARTY_CODE = B.FLD_CLIENTCODE                                    
    WHERE  SAUDA_DATE = CONVERT(DATETIME, @SDATE, 103) --AND PARTY_CODE LIKE 'ZR%'                                                                          
                                    
            IF @SEG = 'BSE'                                    
              BEGIN                                    
                  DELETE FROM DUSTBIN.DBO.NRIBSE                                      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
         --INSERT INTO NRIBSE_test               
                  INSERT INTO DUSTBIN.DBO.NRIBSE                                    
                  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                                    
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                              
                         SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,                                    
                         SEBI_TAX,                                    
            BROKER_CHRG,                                  
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                         NSERTAX,                                    
                         N_NETRATE                        
                  FROM   AngelBSECM.BSEDB_AB.DBO.SETTLEMENT WITH (NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
                  INSERT INTO DUSTBIN.DBO.NRIBSE                                    
                  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                           
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                                    
                         SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,                                    
                         SEBI_TAX,                                    
                         BROKER_CHRG,                                  
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                         NSERTAX,                                  
                         N_NETRATE                                    
                  FROM   AngelBSECM.BSEDB_AB.DBO.HISTORY WITH (NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
              END                                    
                                    
            IF @SEG = 'NSE'                                    
              BEGIN                                    
                  DELETE FROM DUSTBIN.DBO.NRINSE                                    
                  WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
                  INSERT INTO DUSTBIN.DBO.NRINSE                                    
  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                                    
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                                    
   SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,              
                         SEBI_TAX,                                    
                         BROKER_CHRG,                                    
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                         NSERTAX,                                    
                         N_NETRATE                                    
                  FROM   MSAJAG.DBO.SETTLEMENT(NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
                  INSERT INTO DUSTBIN.DBO.NRINSE                                    
                  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                                    
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                                    
                         SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,                                    
                         SEBI_TAX,                                    
                         BROKER_CHRG,                   
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                   NSERTAX,                                    
                         N_NETRATE                                    
                  FROM   MSAJAG.DBO.HISTORY(NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                              
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
              END                                    
        END                                    
                                    
      SELECT DISTINCT PARTY_CODE                                    
      INTO   #CLIENTS                                    
      FROM   DUSTBIN.DBO.NRIBSE WITH (NOLOCK)                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
             AND SELL_BUY = @TYPE                                    
      UNION                                    
      SELECT DISTINCT PARTY_CODE                                    
      FROM   DUSTBIN.DBO.NRINSE WITH (NOLOCK)                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
             AND SELL_BUY = @TYPE                                    
                                    
      IF @BANKID <> 0             
        BEGIN                                    
            SELECT #CLIENTS.PARTY_CODE,                                    
                   B.FLD_BANKID                                    
            INTO   #T                                    
            FROM   #CLIENTS,                                    
                   INTRANET.RISK.DBO.TBL_NRICLIENTMASTER B WITH (NOLOCK)                                    
            WHERE  #CLIENTS.PARTY_CODE = B.FLD_CLIENTCODE                                    
                                    
            DELETE FROM #CLIENTS                                          WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                  FROM   #T                                    
                                  WHERE  FLD_BANKID <> @BANKID)                                    
        END                                    
                                    
      CREATE TABLE #TT                                    
        (                    
           CNT        INT IDENTITY (1, 1),                                    
           PARTY_CODE VARCHAR(20)                                    
        )                                    
                                    
      INSERT INTO #TT                                    
      SELECT *                                    
      FROM   #CLIENTS                                    
                                    
      DECLARE @CNT INT                                    
                                    
      SELECT @CNT = Count(*)                                    
      FROM   #CLIENTS                                    
                            
      WHILE @CNT > 0                                    
        BEGIN                                    
            DECLARE @TRANCNT   AS INT,                                    
                    @PARTYCODE AS VARCHAR(20)                                    
                                    
            SELECT @PARTYCODE = Ltrim(Rtrim(PARTY_CODE))                                    
            FROM   #TT                                    
            WHERE  @CNT = CNT                                    
                                    
            IF @SEG = 'BSE'                                    
              BEGIN                                    
                  SELECT @TRANCNT = Count(CONTRACTNO),                                    
                         @TRANS_AMOUNT = Sum(CONVERT(DECIMAL(14, 2), TRANACTIONAMT))                                    
                  FROM   #BSE_DETAILS                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE,                                    
                            Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),                                    
                            CONTRACTNO                                    
                                    
                 SELECT @CALCULATION = CONVERT(DECIMAL(14, 2), ( @TRANS_AMOUNT ) - ( SERVICE_TAX + EDUCESS + EXCHAGE_LEVIES + STT + STAMPDUTY + MINBROKERAGE + OTHER_CHARGES) )                              
                 FROM #BSE_HEADER WITH (NOLOCK)                  
                 WHERE  PARTY_CODE = @PARTYCODE                              
                  --PRINT'calculation'                                    
                                    
                  --PRINT @CALCULATION                             
                                    
                  --GROUP  BY PARTY_CODE                                                        
                  SELECT @HEADER_TOTALAMT = Sum(CONVERT(DECIMAL(14, 2), TOTALAMT))                                    
                  FROM   #BSE_HEADER                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE                                    
                                    
                  --PRINT 'Header Totalamt'                                    
                             
                  --PRINT @HEADER_TOTALAMT                                    
                                    
                  --SELECT @DIFFAMT = Round(@HEADER_TOTALAMT, 2) - Round(@CALCULATION, 2)                                    
                  SELECT @DIFFAMT = Round(@CALCULATION, 2) - Round(@HEADER_TOTALAMT, 2)                              
                                    
                  /*IF @TYPE = 1                                    
                    BEGIN                                    
                        SELECT @DIFFAMT = @DIFFAMT * ( 1 )                                    
                  END                                    
                  ELSE                                    
                   BEGIN                                                      SELECT @DIFFAMT = @DIFFAMT * ( -1 )                                    
                    END   */                                 
                                    
                  --select * from #TEMP1                                
                              
   DECLARE @SETT_NO VARCHAR(8)                         
      declare @setdate as varchar(10) ,@Bsesetdate_t1 as varchar(10)                              
       declare @bseBank as varchar(50),@BsecliBankBranch as varchar(100),@BseCliBnkAcc as varchar(50),@BseangelAcc as varchar(50),@BseCliPISNo as varchar(50)                        
       SELECT @SETT_NO = SETT_NO,@setdate=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'                          
        SELECT @Bsesetdate_t1=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'                      
    -- SELECT @SETT_NO = SETT_NO FROM  MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE IN('D','C')                             
                              
      --select top 1 @setdate =Sett_Date from Msajag.dbo.common_CONTRACT_DATA with(nolock) where sett_no=@SETT_NO                        
      --set @setdate = substring(@setdate,7,4)+ substring(@setdate,4,2) +substring(@setdate,1,2)                        
                        
     --  select @bseBank=fld_bankName from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                        
       select @bseBank=fld_bankName,@BsecliBankBranch=Fld_branchlocation,@BseangelAcc=Case when @type='1' then Fld_BankPISAc else Fld_AngelAcc end from Intranet.DUSTBIN.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                   
  
    
     
                               
      Begin Try              
     drop table #settno                        
   End Try                        
   Begin catch                        
   End catch                        
     select Row_number() over (order by sett_no) Srno,Sett_no into #settno from #BSE_HEADER where party_code=@PARTYCODE                        
  group by Sett_no               
                        
  declare @rw as int=1                        
  declare @max as int                        
  select @max=max(Srno) from #settno                        
  declare @bseSETT_NO as varchar(10)                        
                        
  while (@rw<=@max)                        
  Begin                        
  select @bseSETT_NO=Sett_no from #settno where Srno=@rw                        
      if(@bseBank like '%AXIS%' or @bseBank like '%INDUSIND%' or @bseBank like '%IDFC%')                        
   Begin                        
                           
        INSERT INTO #TEMP1                                    
        SELECT 'H' + '|' + Ltrim(Rtrim(a.PARTY_CODE)) + '|'                           
        + Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', '') + '|'                           
        + CONVERT(VARCHAR, CONTRACTNO) + '|'                           
        + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(SERVICE_TAX, 0)))) + '|' + '0.00' + '|'                           
        + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(EXCHAGE_LEVIES, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STT, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STAMPDUTY, 0)))) + '|' +               
   
    
      
       
          
            
              
               
                         
    CASE WHEN @diffamt BETWEEN -0.03 AND 0.03                               
      THEN CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(CONVERT(DECIMAL(14, 2), Isnull(MINBROKERAGE, 0)) + CONVERT(DECIMAL(14, 2), Isnull(OTHER_CHARGES, 0))) + @diffamt )))                                    
      ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(Isnull(MINBROKERAGE, 0) + Isnull(OTHER_CHARGES, 0)) )))                                    
    END + '|' + CONVERT(VARCHAR, @TRANCNT) + '|' +                               
    CONVERT(VARCHAR, CONVERT(DECIMAL( 14, 2), Sum(TOTALAMT) )) +'|'+ b.DPid1+'|'+right(b.cltdpID1,8)+'|'+@SEG+'|'+                         
     CASE   WHEN @TYPE = 1 THEN 'B'  WHEN @TYPE = 2 THEN 'S'  END + '|A|'+CASE WHEN (@TYPE = 2 and right(@bseSETT_NO,3)<500) THEN 'T2' else 'T1'end+'|'+@bseSETT_NO+'|'+ CASE   WHEN @TYPE = 1 THEN isnull(@Bsesetdate_t1,'')  else                       
  case when ( right(@bseSETT_NO,3)<500) then @setdate else isnull(@Bsesetdate_t1,'') End END ,@bseBank                                    
        FROM   #BSE_HEADER a WITH (NOLOCK)                          
         left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                        
        WHERE  SAUDA_DATE = @SDATE                                    
         AND a.PARTY_CODE = @PARTYCODE              
         and a.Sett_no=@bseSETT_NO                        
         AND SELL_BUY = @TYPE                                    
        GROUP  BY a.PARTY_CODE,                                    
         CONTRACTNO,                                    
         Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', '') ,b.DPid1,right(b.cltdpID1,8),a.sauda_date                       
                                    
        INSERT INTO #TEMP1                                    
        SELECT 'T' + '|' + Ltrim(Rtrim(PARTY_CODE)) + '|' + Ltrim(Rtrim(CONTRACTNO)) + '|' + CASE                                    
                             WHEN @TYPE = 1 THEN 'P'                                    
                             WHEN @TYPE = 2 THEN 'S'                                    
                              END + '|' + Ltrim(Rtrim(Isnull(ISIN, ''))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, QTY))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), TRATE))))                        
                          
                            
                              
    + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), BROK_PERSCRIP)))) + '|' +                               
    Ltrim(Rtrim(CONVERT(DEC(10, 2), TRANACTIONAMT )))  +'|'+left(Scripname,75) ,@bseBank                                 
        FROM   #BSE_DETAILS X                                    
        WHERE  X.PARTY_CODE = @PARTYCODE                                    
         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
         AND Transaction_type = @SELL_BUY                          
         and X.Sett_no=@bseSETT_NO                            
                              
    End                          
    else if(@bseBank like '%IDBI%')                 
         BEGIN                        
                        
    declare @BseTotalAmt as money                        
    declare @rbi_refno varchar(50)                        
 select @BseTotalAmt=(sum(TRANACTIONAMT)) from #BSE_DETAILS where party_code =@PARTYCODE                        
                        
    select @BseCliPISNo= case when (isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
    @BseCliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
    @rbi_refno=rbi_refno                        
    from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                        
                        
     INSERT INTO #TEMP1                          
     --declare @bseBank as varchar(20)='jdfc',@PARTYCODE as varchar(20)='ZR1101N',@seg as varchar(20)='NSE',@SETT_NO as varchar(20)='1122321',@TYPE as varchar(20)='1',@diffamt as numeric='0.01',@BsecliBankBranch as varchar(100),        
  --@BseCliBnkAcc as varchar(50),@BseangelAcc as varchar(50)                        
     --select @bseBank=fld_bankName,@BsecliBankBranch=Fld_branchlocation,@BseCliBnkAcc=fld_ClientPISac,@BseangelAcc=Fld_AngelAcc from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                        
                             
     select 'IDBI BANK'+','+Convert(varchar,a.SAUDA_DATE,103)+','+@PARTYCODE+','+b.DPid1 +','+cast(right(b.cltdpID1,8) as varchar) +','+b.Short_Name +','+@SEG +','+isnull(@bseSETT_NO,'') +','+                        
     CONVERT(VARCHAR,a.CONTRACTNO)+','+ltrim(rtrim(c.scripcode))+','+Ltrim(Rtrim(Isnull(c.ISIN,'')))+','+                        
     left(c.Scripname,75)+','+CASE WHEN @TYPE = 1 THEN 'Buy'  WHEN @TYPE = 2 THEN 'Sell'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,c.QTY))) +','+ Convert(Varchar,c.RATE)+','+cast((CONVERT(DEC(15,2),c.TRATE) *c.QTY) as varchar)  +','+                        
     Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), c.TRATE)))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), c.BROK_PERSCRIP))))+','+                        
     --CASE WHEN @DIFFAMT BETWEEN -0.03 AND 0.03                               
     -- THEN CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(CONVERT(DECIMAL(14,2),Isnull(MINBROKERAGE,0)) + CONVERT(DECIMAL(14,2),Isnull(OTHER_CHARGES,0))) + @DIFFAMT )))                                
     -- ELSE CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(Isnull(MINBROKERAGE,0) + Isnull(OTHER_CHARGES,0)) )))                           
     --  END +','+  --Other Charges end+','+                        
         CONVERT(VARCHAR,Isnull(c.OTHERCHARGES,0))+','+                        
     cast(Ltrim(Rtrim(CONVERT(DEC(10,2),c.TRANACTIONAMT))) as varchar)+','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(c.BseSTT, 0))))+','+                        
     Convert(Varchar,CONVERT(DECIMAL(14,2),a.TOTALAMT))+','+isnull(@rbi_refno,'')+','+@BseCliPISNo+','+@BseCliBnkAcc+','+@BsecliBankBranch+','+'Angel One Ltd'+','+CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN       
 
   
  Convert(varchar,(a.sauda_date+2),103)  END +','+                        
     CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN Convert(varchar,(a.sauda_date+2),103)  END+','+@BseangelAcc,@BseBank                        
     from #BSE_HEADER a                             
     left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                         
     left outer join #BSE_DETAILS c on a.party_code=c.party_code                        
     where a.party_code= @PARTYCODE and a.SETT_NO=@bseSETT_NO and c.SETT_NO=@bseSETT_NO                        
     group by                        
     a.SAUDA_DATE ,b.DPid1 ,right(b.cltdpID1,8) ,b.Short_Name ,                        
     CONVERT(VARCHAR, a.CONTRACTNO) ,Ltrim(Rtrim(Isnull(c.ISIN, ''))),                        
     left(c.Scripname,75) ,Ltrim(Rtrim(CONVERT(VARCHAR, c.QTY))) ,Ltrim(Rtrim(CONVERT(DEC(10, 2), c.TRANACTIONAMT ))),c.scripcode,                        
     Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), c.RATE)))),Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), c.BROK_PERSCRIP)))),                        
     c.QTY, Convert(Varchar,c.RATE),c.TRATE,c.RATE, Isnull(c.OTHERCHARGES,0),a.TOTALAMT                        
                        
   End                  
   else if(@bseBank like '%HDFC%' or @bseBank like '%YES%')                        
   Begin                  
                  
   select @BseCliPISNo= case when ( isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
   @BseCliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
   @rbi_refno=rbi_refno                        
   from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                    
      
    insert into tbl_NSEBSE_HEADER_yesHdfcbnk                  
 select *,@TYPE,@bseSETT_NO,@bseBank,isnull(@rbi_refno,''),@BseCliPISNo,@BseCliBnkAcc,@BsecliBankBranch,@BseangelAcc                   
 from #BSE_HEADER a                     
  WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@bseSETT_NO                        
        AND SELL_BUY = @TYPE                   
                  
 insert into tbl_NSEBSE_Details_yesHdfcbnk                  
 select distinct * from #BSE_DETAILS a WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@bseSETT_NO                        
        AND TRANSACTION_TYPE =  CASE WHEN @TYPE = 1 THEN 'P' WHEN @TYPE = 2 THEN 'S' END                  
   End                  
                        
   set @rw=@rw+1                        
  END                        
              END                                    
                                    
     ---- NSE                                                                           
            IF @SEG = 'NSE'                                    
              BEGIN                                    
                  SELECT @TRANCNT = Count(CONTRACTNO)                                    
                  FROM   DUSTBIN.DBO.NRINSE                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                         AND SELL_BUY = @TYPE                                    
                  GROUP  BY PARTY_CODE,                                    
                            Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),                                    
                            CONTRACTNO                                    
                                    
                  SELECT @TRANCNT = Count(CONTRACTNO),                                    
                  @TRANS_AMOUNT = Sum(CONVERT(DECIMAL(14, 2), TRANACTIONAMT))                                    
                  FROM   #NSE_DETAILS                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE,                                    
                            Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),                                    
                           CONTRACTNO                                    
                                    
                  -- as per formula add header's service tax + Education Cess + Exchange Levy + STT + Stamp Duty+ Others                                                        
     SELECT @CALCULATION = CONVERT(DECIMAL(14, 2), ( @TRANS_AMOUNT ) - ( SERVICE_TAX + EDUCESS + EXCHAGE_LEVIES + STT + STAMPDUTY + MINBROKERAGE + OTHER_CHARGES) )                              
                 FROM   #NSE_HEADER WITH (NOLOCK)                 
                 WHERE  PARTY_CODE = @PARTYCODE                              
                                
                  --GROUP  BY PARTY_CODE                                                        
                  --PRINT 'Final cal'                                                         
                  --Print  @CALCULATION                                                              
                  SELECT @HEADER_TOTALAMT = Sum(CONVERT(DECIMAL(14, 2), TOTALAMT))                                    
                  FROM   #NSE_HEADER                                    
               WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE                                    
                                    
                  --Print 'HEADER TOTALAMT'                                                        
                  --Print @HEADER_TOTALAMT                                                        
                  --SELECT @diffamt = Round(@HEADER_TOTALAMT, 2) - Round(@calculation, 2)                                    
                  SELECT @diffamt = Round(@calculation, 2) - Round(@HEADER_TOTALAMT, 2)                              
                                    
                  --IF @TYPE = 1                                    
                  --  BEGIN                                    
                  --      SELECT @DIFFAMT = @DIFFAMT * ( 1 )                                    
                  --  END                                    
                  --ELSE                                    
                  --  BEGIN                                    
                  --      SELECT @DIFFAMT = @DIFFAMT * ( -1 )                                    
                  --  END                                    
                                    
                  --PRINT 'Diff amount'                                                         
                  --Print  @diffamt                                                         
                  --select * from #TEMP1                        
    --  print(@PARTYCODE)                        
      DECLARE @nseSETT_NO VARCHAR(8)                        
      declare @nsesetdate as varchar(10),@nsesetdate_t1 as varchar(10)                          
      declare @nseBank as varchar(50),@cliBankBranch as varchar(100),@CliBnkAcc as varchar(50),@angelAcc as varchar(50),@CliPISNo as varchar(20)                        
     SELECT @nseSETT_NO = SETT_NO,@nsesetdate=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'                      
   SELECT @nsesetdate_t1=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'                      
   Begin Try                        
     drop table #NSEsettno                        
   End Try                           Begin catch                        
   End catch                        
  select Row_number() over (order by sett_no) Srno, Sett_NO into #NSEsettno from #NSE_HEADER where party_code=@PARTYCODE                        
  group by Sett_no                        
  declare @nserw as int=1                   
  declare @nsemax as int                        
  declare @nseSett_no2 as varchar(10)                        
  select @nsemax=max(Srno) from #NSEsettno                        
    -- select settno from #NSE_HEADER where party_code=@PARTYCODE                        
                        
    --set  @nsesetdate =(select top 1 Sett_Date from Msajag.dbo.common_CONTRACT_DATA with(nolock) where sett_no=@nseSETT_NO)                        
     --set @nsesetdate = substring(@nsesetdate,7,4)+ substring(@nsesetdate,4,2) +substring(@nsesetdate,1,2)                        
                        
     select @nseBank=fld_bankName,@cliBankBranch=Fld_branchlocation,@angelAcc=Case when @type='1' then Fld_BankPISAc else Fld_AngelAcc end from Intranet.DUSTBIN.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                            
 
                       
      while (@nserw<=@nsemax)                        
   Begin                        
   select @nseSett_no2=Sett_no from #NSEsettno where Srno=@nserw                        
                           
      if(@nseBank like '%AXIS%' or @nseBank like '%INDUSIND%' or @nseBank like '%IDFC%')                        
   Begin                        
                           
                           
       INSERT INTO #TEMP1                                
     SELECT 'H' + '|' + Ltrim(Rtrim(a.PARTY_CODE)) + '|' + Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', '') + '|' + CONVERT(VARCHAR, CONTRACTNO) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(SERVICE_TAX, 0)))) + '|' + '0.00'          
  
    
     
        
           
             
                 
                  
     + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(EXCHAGE_LEVIES, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STT, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STAMPDUTY, 0)))) + '|' +             
  
    
      
        
          
            
              
                
                  
     CASE WHEN @diffamt BETWEEN -0.03 AND 0.03           
    THEN CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(CONVERT(DECIMAL(14, 2), Isnull(MINBROKERAGE, 0)) + CONVERT(DECIMAL(14, 2), Isnull(OTHER_CHARGES, 0))) + @diffamt )))                                
    ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(Isnull(MINBROKERAGE, 0) + Isnull(OTHER_CHARGES, 0)) )))                                
     END + '|' + CONVERT(VARCHAR, @TRANCNT) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(TOTALAMT))) +'|'+ b.DPid1+'|'+right(b.cltdpID1,8)+'|'+@SEG+'|'+                         
     CASE   WHEN @TYPE = 1 THEN 'B'  WHEN @TYPE = 2 THEN 'S'  END + '|A|'+CASE WHEN (@TYPE = 2 and right(@nseSett_no2,3)<500 )THEN 'T1' else 'T1'end+'|'+isnull(@nseSett_no2,'')+'|'+ CASE   WHEN @TYPE = 1 THEN isnull(@nsesetdate_t1,'') else                
  
   
       
       
  case when (right(@nseSett_no2,3)<500 ) then isnull(@nsesetdate,'') else isnull(@nsesetdate_t1,'') END End ,@nseBank                          
                        
       FROM   #NSE_HEADER a WITH (NOLOCK)                         
       left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                               
       WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@nseSett_no2                        
        AND SELL_BUY = @TYPE                                
       GROUP  BY a.PARTY_CODE,                                
           CONTRACTNO,                                
           Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),b.DPid1,right(b.cltdpID1,8)                            
                                                 
       INSERT INTO #TEMP1                                
       SELECT 'T' + '|' + Ltrim(Rtrim(PARTY_CODE)) + '|' + Ltrim(Rtrim(CONTRACTNO)) + '|' + CASE                                
                            WHEN @TYPE = 1 THEN 'P'                                
                            WHEN @TYPE = 2 THEN 'S'                                
                             END + '|' + Ltrim(Rtrim(Isnull(ISIN, ''))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, QTY))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), TRATE))))                         
                          
                            
                              
     + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), BROK_PERSCRIP)))) + '|' + Ltrim(Rtrim(CONVERT(DEC(10, 2), TRANACTIONAMT )))+'|'+left(Scripname,75),@nseBank                                  
       FROM   #NSE_DETAILS X                                
       WHERE  X.PARTY_CODE = @PARTYCODE                          
       and X.Sett_no = @nseSett_no2                        
                            
       End                             
    else if(@nseBank like '%IDBI%')                        
         BEGIN                        
                        
   declare @TotalAmt as money                        
   select @TotalAmt=(sum(TRANACTIONAMT)) from #NSE_DETAILS where party_code =@PARTYCODE                        
                           
   select @CliPISNo= case when ( isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
   @CliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
   @rbi_refno=rbi_refno                        
   from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                        
                           
     INSERT INTO #TEMP1                          
     --declare @nseBank as varchar(20)='jdfc',@PARTYCODE as varchar(20)='ZR1101N',@seg as varchar(20)='NSE',@nseSETT_NO as varchar(20)='1122321',@TYPE as varchar(20)='1',        
  ---@diffamt as numeric='0.01',@cliBankBranch as varchar(100),@CliBnkAcc as varchar(50),@angelAcc as varchar(50)                        
     --select @nseBank=fld_bankName,@cliBankBranch=Fld_branchlocation,@CliBnkAcc=fld_ClientPISac,@angelAcc=Fld_AngelAcc from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = 'ZR1101N'                        
      
     select 'IDBI BANK'+','+Convert(varchar,a.SAUDA_DATE,103)+','+@PARTYCODE+','+b.DPid1 +','+cast(right(b.cltdpID1,8) as varchar) +','+b.Short_Name +','+@SEG +','+isnull(@nseSett_no2,'') +','+                        
     CONVERT(VARCHAR,a.CONTRACTNO)+','+ltrim(rtrim(c.scripcode))+','+Ltrim(Rtrim(Isnull(c.ISIN,'')))+','+                        
     left(c.Scripname,75)+','+CASE WHEN @TYPE = 1 THEN 'Buy'  WHEN @TYPE = 2 THEN 'Sell'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,c.QTY))) +','+ Convert(Varchar,c.RATE)+','+cast((CONVERT(DEC(15,2),c.TRATE) *c.QTY) as varchar) +','+                        
       Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), c.TRATE)))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), c.BROK_PERSCRIP))))+','+                        
     --CASE WHEN @diffamt BETWEEN -0.03 AND 0.03                               
     -- THEN CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(CONVERT(DECIMAL(14,2),Isnull(MINBROKERAGE,0)) + CONVERT(DECIMAL(14,2),Isnull(OTHER_CHARGES,0))) + @diffamt )))                                
     -- ELSE CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(Isnull(MINBROKERAGE,0) + Isnull(OTHER_CHARGES,0)) )))                             
     --  END +','+  --Other Charges end+','+                        
        CONVERT(VARCHAR,Isnull(C.OTHERCHARGES,0))+','+                        
     cast(Ltrim(Rtrim(CONVERT(DEC(10,2),c.TRANACTIONAMT))) as varchar) +','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(C.NseStt, 0))))+','+                        
     CONVERT(VARCHAR,CONVERT(DECIMAL(14,2), a.TOTALAMT))+','+isnull(@rbi_refno,'')+','+@CliPISNo+','+@CliBnkAcc+','+@cliBankBranch+','+'Angel One Ltd'+','+ CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN           
  Convert(varchar,(a.sauda_date+2),103)  END+','+                        
      CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN Convert(varchar,(a.sauda_date+2),103)  END +','+@angelAcc,@nseBank                        
     from #NSE_HEADER a                             
     left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                         
     left outer join #NSE_DETAILS c on a.party_code=c.party_code                        
     where a.party_code= @PARTYCODE and a.SETT_NO=@nseSett_no2 and c.SETT_NO=@nseSett_no2                        
     group by    a.SAUDA_DATE ,b.DPid1 ,right(b.cltdpID1,8) ,b.Short_Name ,                        
     CONVERT(VARCHAR, a.CONTRACTNO) ,Ltrim(Rtrim(Isnull(c.ISIN, ''))),                        
     left(c.Scripname,75) ,Ltrim(Rtrim(CONVERT(VARCHAR, c.QTY))) ,Ltrim(Rtrim(CONVERT(DEC(10, 2), c.TRANACTIONAMT))),c.scripcode,                        
     Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), c.RATE)))),Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), c.BROK_PERSCRIP)))),                        
     c.QTY, Convert(Varchar,c.RATE),c.TRATE,c.RATE, Isnull(c.OTHERCHARGES,0),a.TOTALAMT                        
   -- print('4 ' + @PARTYCODE)                        
   End                        
  else if(@nseBank like '%HDFC%' or @nseBank like '%YES%')                   
  begin                  
                  
   select @CliPISNo= case when ( isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
   @CliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
   @rbi_refno=rbi_refno                        
   from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                     
                     
   if (@nseBank like '%HDFC%')                  
   set @nseBank='HDFC BANK'                  
                  
   insert into tbl_NSEBSE_HEADER_yesHdfcbnk                  
 select *,@TYPE,@nseSett_no2,@nseBank,isnull(@rbi_refno,''),@CliPISNo,@CliBnkAcc,@cliBankBranch,@angelAcc                   
 from #NSE_HEADER a                     
  WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@nseSett_no2                        
  AND SELL_BUY = @TYPE                   
                  
 insert into tbl_NSEBSE_Details_yesHdfcbnk                  
 select distinct * from #NSE_DETAILS a WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@nseSett_no2                        
        AND TRANSACTION_TYPE =  CASE WHEN @TYPE = 1 THEN 'P' WHEN @TYPE = 2 THEN 'S' END                  
                  
  End                  
            set @nserw=@nserw+1                        
      END                        
                        
              END                                    
                                    
            SET @CNT=@CNT - 1                                    
        END                                    
                                    
      --SELECT *                                    
      --FROM   #TEMP1       Intranet.risk.dbo.V_NriBank_Details where fld_bankname like '%idfc%'                        
                        
  insert into tbl_NRILec_temp                        
  select * from #TEMP1                        
                        
                        
  if ((select count(1) from tbl_NRILec_temp) >0)                        
    Begin                        
     declare @BCPCOMMAND1 as varchar(1000)                        
     DECLARE @Axisfilename2 as varchar(200)         DECLARE @indusfilename2 as varchar(200)                        
     DECLARE @Idfcfilename2 as varchar(200)                        
     DECLARE @hdfcfilename2 as varchar(200)                        
     DECLARE @IDBIfilename2 as varchar(200)                        
     DECLARE @Yesfilename2 as varchar(200)                        
     DECLARE @Allfilename2 as varchar(200)                        
     declare @link as varchar(2000)=''                        
     declare @Ftype as varchar(100)                                 
                            
   set @Ftype=  CASE   WHEN @TYPE = 1 THEN 'Buy'  WHEN @TYPE = 2 THEN 'Sell'  END+'_'+@SEG                            
   --set @Ftype=  'BUY_NSE'                            
                            
                            
    if ((select count(1) from tbl_NRILec_temp where bankname like '%AXIS%')>0)                        
     Begin                        
        SET @Axisfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\Axis_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
      SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Dustbin.dbo.tbl_NRILec_temp where bankname like ''%AXIS%''" QUERYOUT "'                        
     SET @BCPCOMMAND1 = @BCPCOMMAND1 + @Axisfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                        
     EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
     --print(@BCPCOMMAND1)                        
    -- set @link=@link +'<a href='+replace(@Axisfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Axis</a><br>'                        
     select '<a href='+replace(@Axisfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Axis</a><br>'                        
     End                        
      if ((select count(1) from tbl_NRILec_temp where bankname like '%INDUSIND%')>0)                        
     Begin                        
        SET @indusfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\INDUSIND_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
      SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Dustbin.dbo.tbl_NRILec_temp where bankname like ''%INDUSIND%''" QUERYOUT "'                                                    
   -- print(@BCPCOMMAND1)                                              
     SET @BCPCOMMAND1 = @BCPCOMMAND1 + @indusfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
     EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
    -- set @link=@link +'<a href='+replace(@indusfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Indusind</a><br>'                        
    select '<a href='+replace(@indusfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Indusind</a><br>'                        
     End                        
      if ((select count(1) from tbl_NRILec_temp where bankname like '%IDFC%')>0)                        
     Begin                        
        SET @Idfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\IDFC_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
      SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Dustbin.dbo.tbl_NRILec_temp where bankname like ''%IDFC%''" QUERYOUT "'                                                    
   -- print(@BCPCOMMAND1)                                              
     SET @BCPCOMMAND1 = @BCPCOMMAND1 + @Idfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
     EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
      --set @link=@link +'<a href='+replace(@Idfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDFC</a><br>'                        
       select '<a href='+replace(@Idfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDFC</a><br>'                        
     End                        
   --    if ((select count(1) from tbl_NRILec_temp where bankname like '%HDFC%')>0)                        
   --  Begin                        
   --     SET @hdfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\HDFC_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                         
   --   SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%HDFC%''" QUERYOUT "'                                                    
   ---- print(@BCPCOMMAND1)                                              
   --  SET @BCPCOMMAND1 = @BCPCOMMAND1 + @hdfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uclassmkt -Pdd$$gnfDTVs244648ysjgZAcc'                                                          
   --  EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
   -- -- set @link=@link +'<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                        
   -- select '<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                        
   --  End                        
   --   if ((select count(1) from tbl_NRILec_temp where bankname like '%IDBI%')>0)                        
   --  Begin                        
   --     SET @IDBIfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\IDBI_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                         
   --   SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%IDBI%''" QUERYOUT "'                                                    
   ---- print(@BCPCOMMAND1)                                              
   --  SET @BCPCOMMAND1 = @BCPCOMMAND1 + @IDBIfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uclassmkt -Pdd$$gnfDTVs244648ysjgZAcc'                                                          
   --  EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                        
   -- --  set @link=@link +'<a href='+replace(@IDBIfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDBI</a><br>'                        
   -- select '<a href='+replace(@IDBIfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDBI</a><br>'                        
   --  End               
            
     IF ((SELECT COUNT(1) FROM tbl_NRILec_temp WHERE bankname LIKE '%IDBI%') > 0)          
   BEGIN          
       SET @IDBIfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\IDBI_' + @Ftype + '_' + REPLACE(CONVERT(VARCHAR(12), GETDATE(), 103), '/', '') + '.csv';          
    --SET @BCPCOMMAND1 = 'BCP "SELECT ''Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Banks Branch Name,Broker Name,Date of Receipt /payment,Demat Debit/Credit Date,Broker A/C No'' UNION ALL SELECT ''IDBI Bank,' +  + 'SELECT FLDCOL FROM Inhouse.dbo.tbl_NRILec_temp WHERE bankname LIKE ''%IDBI%''" QUERYOUT "'         
   SET @BCPCOMMAND1 = 'BCP "SELECT ''Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Banks Branch Name,Broker Name,Date of Receipt /payment,Demat Debit /Credit DateBroker A/C No'' UNION ALL SELECT FLDCOL FROM Dustbin.dbo.tbl_NRILec_temp where bankname like ''%IDBI%''" QUERYOUT "'           
   SET @BCPCOMMAND1 = @BCPCOMMAND1 + @IDBIfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc';        
          
       EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1;          
             
       SELECT '<a href=' + REPLACE(@IDBIfilename2, '\\INHOUSELIVEAPP1-FS.angelone.in', '') + '>Right click and save -- IDBI</a><br>';          
   END;          
   --   if ((select count(1) from tbl_NRILec_temp where bankname like '%YES%')>0)                        
   --  Begin                        
   --     SET @YESfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\YES_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                         
   --   SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%YES%''" QUERYOUT "'                                                    
   ---- print(@BCPCOMMAND1)                                              
   --  SET @BCPCOMMAND1 = @BCPCOMMAND1 + @YESfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uclassmkt -Pdd$$gnfDTVs244648ysjgZAcc'                                                          
   --  EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
   --  --set @link=@link +'<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                            
   --  select '<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                        
   --  End                        
                         
                        
    SET @Allfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\TEST_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                                    
  
    
      
        
          
            
               
    --SET @FILENAME = '\\196.1.115.182\upload1\OmnesysFileFormat\CodeCreationFileFormat'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
    SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Dustbin.dbo.tbl_NRILec_temp" QUERYOUT "'                                                    
   -- print(@BCPCOMMAND1)                                              
    SET @BCPCOMMAND1 = @BCPCOMMAND1 + @Allfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
    EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1              
    --set @link=@link +'<a href='+replace(@Allfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- All Banks</a><br>'                        
    select '<a href='+replace(@Allfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- All Banks</a><br>'                        
                            
              
       End                        
      Else                        
    Begin                        
         select 'No Records found'                           
    End                        
                  
      SET NOCOUNT OFF                                    
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Angel_nri_data_lec_new_15may2023_BKP
-- --------------------------------------------------

CREATE PROC [dbo].[Angel_nri_data_lec_new_15may2023_BKP](@SDATE  AS VARCHAR(11),                                    
                                   @TYPE   AS INT,                                    
                                   @BANKID AS INT,                                    
                                   @SEG    AS VARCHAR(5))                                    
AS                                    
  BEGIN                                    
      SET NOCOUNT ON                                    
    --  DECLARE @SDATE AS VARCHAR(11),@TYPE AS VARCHAR(2),@BANKID AS INT,@SEG AS VARCHAR(5)                                                                            
   --   SET @SDATE ='10/05/2022' SET @TYPE ='2' SET @BANKID =0 SET @SEG='NSE'                                                                            
      SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103))                                
                           
   create table #output ([output] varchar(200))                        
                           
 -- insert into #output                        
  --   Exec master.dbo.xp_cmdshell 'NET USE \\INHOUSELIVEAPP1-FS.angelone.in\IPC$ /USER:Administrator Winw0rld@1604'                          
                          
      DECLARE @SELL_BUY        AS CHAR(1),                                    
              @TRANS_AMOUNT    AS DECIMAL(18, 2),                                    
              @calculation     AS DECIMAL(18, 2),                                    
              @HEADER_TOTALAMT AS DECIMAL(18, 2),                                    
              @diffamt         AS DECIMAL(18, 2);                                    
                                    
      SELECT @SELL_BUY = CASE                                    
                           WHEN @TYPE = 1 THEN 'P'                                    
                           WHEN @TYPE = 2 THEN 'S'                                    
                         END                                    
                                    
      IF( @SEG = 'NSE' )                                    
        BEGIN                                    
            CREATE TABLE #NSE_HEADER                                 
              (                                    
                 EXCHANGE           VARCHAR(50),                                    
                 PARTY_CODE         VARCHAR(50),                                    
                 SAUDA_DATE         DATETIME,                                    
                 SELL_BUY           INT,                                    
                 CONTRACTNO         VARCHAR(50),                                    
                 SERVICE_TAX        DECIMAL(18, 4),                                    
                 EDUCESS            INT,                                    
                 EXCHAGE_LEVIES     DECIMAL(18, 4),                                    
                 STT                DECIMAL(18, 4),                                    
                 STAMPDUTY          DECIMAL(18, 4),                                    
                 MINBROKERAGE       DECIMAL(18, 4),                                    
                 OTHER_CHARGES      DECIMAL(18, 4),                                    
                 NO_OF_TRANSACTIONS INT,                                    
                 TOTALAMT           DECIMAL(18, 2),                             
     SETT_NO            varchar(10)                        
              ); -- drop table #NSE_HEADER                                                        
                                    
            INSERT INTO #NSE_HEADER                                    
            EXEC MSAJAG.dbo.Nsenriheader_T1                                    
              @SDATE,                                    
              @TYPE                                    
                                    
            --UPDATE #NSE_HEADER                    
            --      SET    TOTALAMT = TOTALAMT * ( -1 )                                    
                                
            CREATE TABLE #NSE_DETAILS                                    
 (                                    
EXCHANGE         VARCHAR(50),                                    
                 PARTY_CODE       VARCHAR(50),                  
                 SAUDA_DATE       DATETIME,                                    
                 CONTRACTNO       VARCHAR(50),                                 
                 TRANSACTION_TYPE CHAR(1),                                    
                 ISIN             VARCHAR(50),                      
                 qty              INT,                                    
                 Rate             DECIMAL(18, 6),                   
                 BROK_PERSCRIP    DECIMAL(18, 2),                                    
                 TRANACTIONAMT    DECIMAL(18, 4),                        
     Scripname    varchar(100),                        
    scripcode    varchar(100),                        
     SETT_NO         varchar(10),                        
     TRATE           DECIMAL(18, 6),                        
     OtherCharges    DECIMAL(18, 6),                        
     NseStt          DECIMAL(18, 6),                  
  OtherTax    DECIMAL(18, 6)                  
              );                                    
                                    
            INSERT INTO #NSE_DETAILS                                    
  EXEC MSAJAG.DBO.[NSENRIDETAIL_T1_15may2023]                                    
              @SDATE,                                    
              @TYPE                                    
                                    
            --UPDATE #NSE_DETAILS                                    
            --      SET    TRANACTIONAMT = TRANACTIONAMT * ( -1 )                                    
        END                                    
      ELSE                                    
        BEGIN                                    
            CREATE TABLE #BSE_HEADER                                    
              (                                    
                 EXCHANGE           VARCHAR(50),                                    
                 PARTY_CODE         VARCHAR(50),                                    
                 SAUDA_DATE         DATETIME,                                    
                SELL_BUY           INT,                                    
                 CONTRACTNO         VARCHAR(50),                                    
                 SERVICE_TAX        DECIMAL(18, 4),                                    
                 EDUCESS            INT,                                    
                 EXCHAGE_LEVIES     DECIMAL(18, 4),                                    
                 STT                DECIMAL(18, 4),                                    
                 STAMPDUTY          DECIMAL(18, 4),                                    
                 MINBROKERAGE       DECIMAL(18, 4),                                    
                 OTHER_CHARGES      DECIMAL(18, 4),                                    
                 NO_OF_TRANSACTIONS INT,                                    
                 TOTALAMT           DECIMAL(18, 2),                         
     SETT_NO            varchar(10)                        
              ); -- drop table #BSE_HEADER                                                         
            INSERT INTO #BSE_HEADER                                    
            EXEC AngelBSECM.BSEDB_AB.DBO.Bsenriheader_T1                                    
                      @SDATE,                                    
                      @TYPE                                    
                                    
            --UPDATE #BSE_HEADER                                    
            --      SET    TOTALAMT = TOTALAMT * ( -1 )                                    
                                  
            CREATE TABLE #BSE_DETAILS                                    
              (                                    
                 EXCHANGE         VARCHAR(50),           
                 PARTY_CODE       VARCHAR(50),                                    
                 SAUDA_DATE       DATETIME,                                    
                 CONTRACTNO       VARCHAR(50),                         
                 TRANSACTION_TYPE CHAR(1),                                    
                 ISIN             VARCHAR(50),                                    
                 qty              INT,                                    
               Rate             DECIMAL(18, 6),                                    
                 BROK_PERSCRIP    DECIMAL(18, 2),                                    
                 TRANACTIONAMT    DECIMAL(18, 4),                         
     Scripname    varchar(100),                        
     scripcode    varchar(100),                        
     SETT_NO         varchar(10),                        
     TRATE           DECIMAL(18, 6),                        
     OtherCharges     DECIMAL(18, 6),                        
     BseStt           DECIMAL(18, 6),                  
  OtherTax   DECIMAL(18, 6)                  
   ); -- drop table #BSE_DETAILS                                                         
                                    
            INSERT INTO #BSE_DETAILS                                    
            EXEC AngelBSECM.BSEDB_AB.DBO.Bsenridetail_T1_15may2023                                   
              @SDATE,                             
              @TYPE                                    
                                    
            --UPDATE #BSE_DETAILS                                    
            --      SET    TRANACTIONAMT = TRANACTIONAMT * ( -1 )                                    
        END                                    
                           CREATE TABLE #TEMP1                                    
        (                                    
           FLDCOL VARCHAR(1000) ,                        
     BankName varchar(100)                        
        )                        
    truncate table tbl_NRILec_temp                        
  --create table tbl_NRILec_temp                        
  -- (                                    
       --      FLDCOL VARCHAR(1000)                                    
       --   )                        
                                    
      DECLARE @BSE AS INT                            
      DECLARE @NSE AS INT                                    
                                    
      SELECT @BSE = Count(*)                                    
      FROM   MSAJAG.DBO.NRIBSE                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
      SELECT @NSE = Count(*)                                    
      FROM   MSAJAG.DBO.NRINSE                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
      IF @BSE = 0                                    
          OR @NSE = 0                                    
        BEGIN                                    
            SELECT DISTINCT FLD_CLIENTCODE                                    
            INTO   #ZRCLI                           
            FROM   INTRANET.RISK.DBO.TBL_NRICLIENTMASTER B WITH (NOLOCK)                                    
                                    
            SELECT DISTINCT PARTY_CODE                                    
            INTO   #NRI_CLI                                    
            FROM   MSAJAG.DBO.CMBILLVALAN X WITH (NOLOCK)                                    
                   INNER JOIN #ZRCLI B WITH (NOLOCK)                                    
      ON X.PARTY_CODE = B.FLD_CLIENTCODE                                    
            WHERE  SAUDA_DATE = CONVERT(DATETIME, @SDATE, 103) --AND PARTY_CODE LIKE 'ZR%'                                                     
            UNION                                                                            
            SELECT DISTINCT PARTY_CODE                                    
            FROM   AngelBSECM.BSEDB_AB.DBO.CMBILLVALAN X WITH (NOLOCK)                                    
                   INNER JOIN #ZRCLI B WITH (NOLOCK)                                    
                     ON X.PARTY_CODE = B.FLD_CLIENTCODE                                    
    WHERE  SAUDA_DATE = CONVERT(DATETIME, @SDATE, 103) --AND PARTY_CODE LIKE 'ZR%'                                                                          
                                    
            IF @SEG = 'BSE'                                    
              BEGIN                                    
                  DELETE FROM MSAJAG.DBO.NRIBSE                                      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
         --INSERT INTO NRIBSE_test               
                  INSERT INTO MSAJAG.DBO.NRIBSE                                    
                  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                                    
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                              
                         SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,                                    
                         SEBI_TAX,                                    
            BROKER_CHRG,                                  
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                         NSERTAX,                                    
                         N_NETRATE                        
                  FROM   AngelBSECM.BSEDB_AB.DBO.SETTLEMENT WITH (NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
                  INSERT INTO MSAJAG.DBO.NRIBSE                                    
                  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                           
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                                    
                         SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,                                    
                         SEBI_TAX,                                    
                         BROKER_CHRG,                                  
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                         NSERTAX,                                  
                         N_NETRATE                                    
                  FROM   AngelBSECM.BSEDB_AB.DBO.HISTORY WITH (NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
              END                                    
                                    
            IF @SEG = 'NSE'                                    
              BEGIN                                    
                  DELETE FROM MSAJAG.DBO.NRINSE                                    
                  WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
                  INSERT INTO MSAJAG.DBO.NRINSE                                    
  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                                    
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                                    
   SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,              
                         SEBI_TAX,                                    
                         BROKER_CHRG,                                    
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                         NSERTAX,                                    
                         N_NETRATE                                    
                  FROM   MSAJAG.DBO.SETTLEMENT(NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                                    
                  INSERT INTO MSAJAG.DBO.NRINSE                                    
                  SELECT CONTRACTNO,                                    
                         PARTY_CODE,                                    
                         SCRIP_CD,                                    
                         TRADEQTY,                                    
                         SAUDA_DATE,                                    
                         SELL_BUY,                                    
                         NBROKAPP,                                    
                         INS_CHRG,                                    
                         TURN_TAX,                                    
                         OTHER_CHRG,                                    
                         SEBI_TAX,                                    
                         BROKER_CHRG,                   
                         TRADE_AMOUNT,                                    
                         MARKETRATE,                                    
                   NSERTAX,                                    
                         N_NETRATE                                    
                  FROM   MSAJAG.DBO.HISTORY(NOLOCK)                                    
                  WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                        FROM   #NRI_CLI)                              
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
              END                                    
        END                                    
                                    
      SELECT DISTINCT PARTY_CODE                                    
      INTO   #CLIENTS                                    
      FROM   MSAJAG.DBO.NRIBSE WITH (NOLOCK)                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
             AND SELL_BUY = @TYPE                                    
      UNION                                    
      SELECT DISTINCT PARTY_CODE                                    
      FROM   MSAJAG.DBO.NRINSE WITH (NOLOCK)                                    
      WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
             AND SELL_BUY = @TYPE                                    
                                    
      IF @BANKID <> 0             
        BEGIN                                    
            SELECT #CLIENTS.PARTY_CODE,                                    
                   B.FLD_BANKID                                    
            INTO   #T                                    
            FROM   #CLIENTS,                                    
                   INTRANET.RISK.DBO.TBL_NRICLIENTMASTER B WITH (NOLOCK)                                    
            WHERE  #CLIENTS.PARTY_CODE = B.FLD_CLIENTCODE                                    
                                    
            DELETE FROM #CLIENTS                                          WHERE  PARTY_CODE IN (SELECT PARTY_CODE                                    
                                  FROM   #T                                    
                                  WHERE  FLD_BANKID <> @BANKID)                                    
        END                                    
                                    
      CREATE TABLE #TT                                    
        (                    
           CNT        INT IDENTITY (1, 1),                                    
           PARTY_CODE VARCHAR(20)                                    
        )                                    
                                    
      INSERT INTO #TT                                    
      SELECT *                                    
      FROM   #CLIENTS                                    
                                    
      DECLARE @CNT INT                                    
                                    
      SELECT @CNT = Count(*)                                    
      FROM   #CLIENTS                                    
                            
      WHILE @CNT > 0                                    
        BEGIN                                    
            DECLARE @TRANCNT   AS INT,                                    
                    @PARTYCODE AS VARCHAR(20)                                    
                                    
            SELECT @PARTYCODE = Ltrim(Rtrim(PARTY_CODE))                                    
            FROM   #TT                                    
            WHERE  @CNT = CNT                                    
                                    
            IF @SEG = 'BSE'                                    
              BEGIN                                    
                  SELECT @TRANCNT = Count(CONTRACTNO),                                    
                         @TRANS_AMOUNT = Sum(CONVERT(DECIMAL(14, 2), TRANACTIONAMT))                                    
                  FROM   #BSE_DETAILS                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE,                                    
                            Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),                                    
                            CONTRACTNO                                    
                                    
                 SELECT @CALCULATION = CONVERT(DECIMAL(14, 2), ( @TRANS_AMOUNT ) - ( SERVICE_TAX + EDUCESS + EXCHAGE_LEVIES + STT + STAMPDUTY + MINBROKERAGE + OTHER_CHARGES) )                              
                 FROM #BSE_HEADER WITH (NOLOCK)                  
                 WHERE  PARTY_CODE = @PARTYCODE                              
                  --PRINT'calculation'                                    
                                    
                  --PRINT @CALCULATION                             
                                    
                  --GROUP  BY PARTY_CODE                                                        
                  SELECT @HEADER_TOTALAMT = Sum(CONVERT(DECIMAL(14, 2), TOTALAMT))                                    
                  FROM   #BSE_HEADER                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE                                    
                                    
                  --PRINT 'Header Totalamt'                                    
                             
                  --PRINT @HEADER_TOTALAMT                                    
                                    
                  --SELECT @DIFFAMT = Round(@HEADER_TOTALAMT, 2) - Round(@CALCULATION, 2)                                    
                  SELECT @DIFFAMT = Round(@CALCULATION, 2) - Round(@HEADER_TOTALAMT, 2)                              
                                    
                  /*IF @TYPE = 1                                    
                    BEGIN                                    
                        SELECT @DIFFAMT = @DIFFAMT * ( 1 )                                    
                  END                                    
                  ELSE                                    
                   BEGIN                                                      SELECT @DIFFAMT = @DIFFAMT * ( -1 )                                    
                    END   */                                 
                                    
                  --select * from #TEMP1                                
                              
   DECLARE @SETT_NO VARCHAR(8)                         
      declare @setdate as varchar(10) ,@Bsesetdate_t1 as varchar(10)                              
       declare @bseBank as varchar(50),@BsecliBankBranch as varchar(100),@BseCliBnkAcc as varchar(50),@BseangelAcc as varchar(50),@BseCliPISNo as varchar(50)                        
       SELECT @SETT_NO = SETT_NO,@setdate=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'                          
        SELECT @Bsesetdate_t1=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'                      
    -- SELECT @SETT_NO = SETT_NO FROM  MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE IN('D','C')                             
                              
      --select top 1 @setdate =Sett_Date from Msajag.dbo.common_CONTRACT_DATA with(nolock) where sett_no=@SETT_NO                        
      --set @setdate = substring(@setdate,7,4)+ substring(@setdate,4,2) +substring(@setdate,1,2)                        
                        
     --  select @bseBank=fld_bankName from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                        
       select @bseBank=fld_bankName,@BsecliBankBranch=Fld_branchlocation,@BseangelAcc=Case when @type='1' then Fld_BankPISAc else Fld_AngelAcc end from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                   
  
    
     
                               
      Begin Try              
     drop table #settno                        
   End Try                        
   Begin catch                        
   End catch                        
     select Row_number() over (order by sett_no) Srno,Sett_no into #settno from #BSE_HEADER where party_code=@PARTYCODE                        
  group by Sett_no               
                        
  declare @rw as int=1                        
  declare @max as int                        
  select @max=max(Srno) from #settno                        
  declare @bseSETT_NO as varchar(10)                        
                        
  while (@rw<=@max)                        
  Begin                        
  select @bseSETT_NO=Sett_no from #settno where Srno=@rw                        
      if(@bseBank like '%AXIS%' or @bseBank like '%INDUSIND%' or @bseBank like '%IDFC%')                        
   Begin                        
                           
        INSERT INTO #TEMP1                                    
        SELECT 'H' + '|' + Ltrim(Rtrim(a.PARTY_CODE)) + '|'                           
        + Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', '') + '|'                           
        + CONVERT(VARCHAR, CONTRACTNO) + '|'                           
        + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(SERVICE_TAX, 0)))) + '|' + '0.00' + '|'                           
        + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(EXCHAGE_LEVIES, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STT, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STAMPDUTY, 0)))) + '|' +               
   
    
      
       
          
            
              
               
                         
    CASE WHEN @diffamt BETWEEN -0.03 AND 0.03                               
      THEN CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(CONVERT(DECIMAL(14, 2), Isnull(MINBROKERAGE, 0)) + CONVERT(DECIMAL(14, 2), Isnull(OTHER_CHARGES, 0))) + @diffamt )))                                    
      ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(Isnull(MINBROKERAGE, 0) + Isnull(OTHER_CHARGES, 0)) )))                                    
    END + '|' + CONVERT(VARCHAR, @TRANCNT) + '|' +                               
    CONVERT(VARCHAR, CONVERT(DECIMAL( 14, 2), Sum(TOTALAMT) )) +'|'+ b.DPid1+'|'+right(b.cltdpID1,8)+'|'+@SEG+'|'+                         
     CASE   WHEN @TYPE = 1 THEN 'B'  WHEN @TYPE = 2 THEN 'S'  END + '|A|'+CASE WHEN (@TYPE = 2 and right(@bseSETT_NO,3)<500) THEN 'T2' else 'T1'end+'|'+@bseSETT_NO+'|'+ CASE   WHEN @TYPE = 1 THEN isnull(@Bsesetdate_t1,'')  else                       
  case when ( right(@bseSETT_NO,3)<500) then @setdate else isnull(@Bsesetdate_t1,'') End END ,@bseBank                                    
        FROM   #BSE_HEADER a WITH (NOLOCK)                          
         left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                        
        WHERE  SAUDA_DATE = @SDATE                                    
         AND a.PARTY_CODE = @PARTYCODE              
         and a.Sett_no=@bseSETT_NO                        
         AND SELL_BUY = @TYPE                                    
        GROUP  BY a.PARTY_CODE,                                    
         CONTRACTNO,                                    
         Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', '') ,b.DPid1,right(b.cltdpID1,8),a.sauda_date                       
                                    
        INSERT INTO #TEMP1                                    
        SELECT 'T' + '|' + Ltrim(Rtrim(PARTY_CODE)) + '|' + Ltrim(Rtrim(CONTRACTNO)) + '|' + CASE                                    
                             WHEN @TYPE = 1 THEN 'P'                                    
                             WHEN @TYPE = 2 THEN 'S'                                    
                              END + '|' + Ltrim(Rtrim(Isnull(ISIN, ''))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, QTY))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), TRATE))))                        
                          
                            
                              
    + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), BROK_PERSCRIP)))) + '|' +                               
    Ltrim(Rtrim(CONVERT(DEC(10, 2), TRANACTIONAMT )))  +'|'+left(Scripname,75) ,@bseBank                                 
        FROM   #BSE_DETAILS X                                    
        WHERE  X.PARTY_CODE = @PARTYCODE                                    
         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
         AND Transaction_type = @SELL_BUY                          
         and X.Sett_no=@bseSETT_NO                            
                              
    End                          
    else if(@bseBank like '%IDBI%')                 
         BEGIN                        
                        
    declare @BseTotalAmt as money                        
    declare @rbi_refno varchar(50)                        
 select @BseTotalAmt=(sum(TRANACTIONAMT)) from #BSE_DETAILS where party_code =@PARTYCODE                        
                        
    select @BseCliPISNo= case when (isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
    @BseCliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
    @rbi_refno=rbi_refno                        
    from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                        
                        
     INSERT INTO #TEMP1                          
     --declare @bseBank as varchar(20)='jdfc',@PARTYCODE as varchar(20)='ZR1101N',@seg as varchar(20)='NSE',@SETT_NO as varchar(20)='1122321',@TYPE as varchar(20)='1',@diffamt as numeric='0.01',@BsecliBankBranch as varchar(100),        
  --@BseCliBnkAcc as varchar(50),@BseangelAcc as varchar(50)                        
     --select @bseBank=fld_bankName,@BsecliBankBranch=Fld_branchlocation,@BseCliBnkAcc=fld_ClientPISac,@BseangelAcc=Fld_AngelAcc from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                        
                             
     select 'IDBI BANK'+','+Convert(varchar,a.SAUDA_DATE,103)+','+@PARTYCODE+','+b.DPid1 +','+cast(right(b.cltdpID1,8) as varchar) +','+b.Short_Name +','+@SEG +','+isnull(@bseSETT_NO,'') +','+                        
     CONVERT(VARCHAR,a.CONTRACTNO)+','+ltrim(rtrim(c.scripcode))+','+Ltrim(Rtrim(Isnull(c.ISIN,'')))+','+                        
     left(c.Scripname,75)+','+CASE WHEN @TYPE = 1 THEN 'Buy'  WHEN @TYPE = 2 THEN 'Sell'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,c.QTY))) +','+ Convert(Varchar,c.RATE)+','+cast((CONVERT(DEC(15,2),c.TRATE) *c.QTY) as varchar)  +','+                        
     Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), c.TRATE)))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), c.BROK_PERSCRIP))))+','+                        
     --CASE WHEN @DIFFAMT BETWEEN -0.03 AND 0.03                               
     -- THEN CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(CONVERT(DECIMAL(14,2),Isnull(MINBROKERAGE,0)) + CONVERT(DECIMAL(14,2),Isnull(OTHER_CHARGES,0))) + @DIFFAMT )))                                
     -- ELSE CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(Isnull(MINBROKERAGE,0) + Isnull(OTHER_CHARGES,0)) )))                           
     --  END +','+  --Other Charges end+','+                        
         CONVERT(VARCHAR,Isnull(c.OTHERCHARGES,0))+','+                        
     cast(Ltrim(Rtrim(CONVERT(DEC(10,2),c.TRANACTIONAMT))) as varchar)+','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(c.BseSTT, 0))))+','+                        
     Convert(Varchar,CONVERT(DECIMAL(14,2),a.TOTALAMT))+','+isnull(@rbi_refno,'')+','+@BseCliPISNo+','+@BseCliBnkAcc+','+@BsecliBankBranch+','+'Angel One Ltd'+','+CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN       
 
   
  Convert(varchar,(a.sauda_date+2),103)  END +','+                        
     CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN Convert(varchar,(a.sauda_date+2),103)  END+','+@BseangelAcc,@BseBank                        
     from #BSE_HEADER a                             
     left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                         
     left outer join #BSE_DETAILS c on a.party_code=c.party_code                        
     where a.party_code= @PARTYCODE and a.SETT_NO=@bseSETT_NO and c.SETT_NO=@bseSETT_NO                        
     group by                        
     a.SAUDA_DATE ,b.DPid1 ,right(b.cltdpID1,8) ,b.Short_Name ,                        
     CONVERT(VARCHAR, a.CONTRACTNO) ,Ltrim(Rtrim(Isnull(c.ISIN, ''))),                        
     left(c.Scripname,75) ,Ltrim(Rtrim(CONVERT(VARCHAR, c.QTY))) ,Ltrim(Rtrim(CONVERT(DEC(10, 2), c.TRANACTIONAMT ))),c.scripcode,                        
     Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), c.RATE)))),Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), c.BROK_PERSCRIP)))),                        
     c.QTY, Convert(Varchar,c.RATE),c.TRATE,c.RATE, Isnull(c.OTHERCHARGES,0),a.TOTALAMT                        
                        
   End                  
   else if(@bseBank like '%HDFC%' or @bseBank like '%YES%')                        
   Begin                  
                  
   select @BseCliPISNo= case when ( isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
   @BseCliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
   @rbi_refno=rbi_refno                        
   from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                    
      
    insert into tbl_NSEBSE_HEADER_yesHdfcbnk                  
 select *,@TYPE,@bseSETT_NO,@bseBank,isnull(@rbi_refno,''),@BseCliPISNo,@BseCliBnkAcc,@BsecliBankBranch,@BseangelAcc                   
 from #BSE_HEADER a                     
  WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@bseSETT_NO                        
        AND SELL_BUY = @TYPE                   
                  
 insert into tbl_NSEBSE_Details_yesHdfcbnk                  
 select distinct * from #BSE_DETAILS a WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@bseSETT_NO                        
        AND TRANSACTION_TYPE =  CASE WHEN @TYPE = 1 THEN 'P' WHEN @TYPE = 2 THEN 'S' END                  
   End                  
                        
   set @rw=@rw+1                        
  END                        
              END                                    
                                    
     ---- NSE                                                                           
            IF @SEG = 'NSE'                                    
              BEGIN                                    
                  SELECT @TRANCNT = Count(CONTRACTNO)                                    
                  FROM   MSAJAG.DBO.NRINSE                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                         AND CONVERT(DATETIME, CONVERT(VARCHAR(11), SAUDA_DATE)) = @SDATE                                    
                         AND SELL_BUY = @TYPE                                    
                  GROUP  BY PARTY_CODE,                                    
                            Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),                                    
                            CONTRACTNO                                    
                                    
                  SELECT @TRANCNT = Count(CONTRACTNO),                                    
                  @TRANS_AMOUNT = Sum(CONVERT(DECIMAL(14, 2), TRANACTIONAMT))                                    
                  FROM   #NSE_DETAILS                                    
                  WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE,                                    
                            Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),                                    
                           CONTRACTNO                                    
                                    
                  -- as per formula add header's service tax + Education Cess + Exchange Levy + STT + Stamp Duty+ Others                                                        
     SELECT @CALCULATION = CONVERT(DECIMAL(14, 2), ( @TRANS_AMOUNT ) - ( SERVICE_TAX + EDUCESS + EXCHAGE_LEVIES + STT + STAMPDUTY + MINBROKERAGE + OTHER_CHARGES) )                              
                 FROM   #NSE_HEADER WITH (NOLOCK)                 
                 WHERE  PARTY_CODE = @PARTYCODE                              
                                
                  --GROUP  BY PARTY_CODE                                                        
                  --PRINT 'Final cal'                                                         
                  --Print  @CALCULATION                                                              
                  SELECT @HEADER_TOTALAMT = Sum(CONVERT(DECIMAL(14, 2), TOTALAMT))                                    
                  FROM   #NSE_HEADER                                    
               WHERE  PARTY_CODE = @PARTYCODE                                    
                  GROUP  BY PARTY_CODE                                    
                                    
                  --Print 'HEADER TOTALAMT'                                                        
                  --Print @HEADER_TOTALAMT                                                        
                  --SELECT @diffamt = Round(@HEADER_TOTALAMT, 2) - Round(@calculation, 2)                                    
                  SELECT @diffamt = Round(@calculation, 2) - Round(@HEADER_TOTALAMT, 2)                              
                                    
                  --IF @TYPE = 1                                    
                  --  BEGIN                                    
                  --      SELECT @DIFFAMT = @DIFFAMT * ( 1 )                                    
                  --  END                                    
                  --ELSE                                    
                  --  BEGIN                                    
                  --      SELECT @DIFFAMT = @DIFFAMT * ( -1 )                                    
                  --  END                                    
                                    
                  --PRINT 'Diff amount'                                                         
                  --Print  @diffamt                                                         
                  --select * from #TEMP1                        
    --  print(@PARTYCODE)                        
      DECLARE @nseSETT_NO VARCHAR(8)                        
      declare @nsesetdate as varchar(10),@nsesetdate_t1 as varchar(10)                          
      declare @nseBank as varchar(50),@cliBankBranch as varchar(100),@CliBnkAcc as varchar(50),@angelAcc as varchar(50),@CliPISNo as varchar(20)                        
     SELECT @nseSETT_NO = SETT_NO,@nsesetdate=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'                      
   SELECT @nsesetdate_t1=Convert(varchar,Funds_Payin,112) FROM MSAJag.dbo.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'                      
   Begin Try                        
     drop table #NSEsettno                        
   End Try                           Begin catch                        
   End catch                        
  select Row_number() over (order by sett_no) Srno, Sett_NO into #NSEsettno from #NSE_HEADER where party_code=@PARTYCODE                        
  group by Sett_no                        
  declare @nserw as int=1                   
  declare @nsemax as int                        
  declare @nseSett_no2 as varchar(10)                        
  select @nsemax=max(Srno) from #NSEsettno                        
    -- select settno from #NSE_HEADER where party_code=@PARTYCODE                        
                        
    --set  @nsesetdate =(select top 1 Sett_Date from Msajag.dbo.common_CONTRACT_DATA with(nolock) where sett_no=@nseSETT_NO)                        
     --set @nsesetdate = substring(@nsesetdate,7,4)+ substring(@nsesetdate,4,2) +substring(@nsesetdate,1,2)                        
                        
     select @nseBank=fld_bankName,@cliBankBranch=Fld_branchlocation,@angelAcc=Case when @type='1' then Fld_BankPISAc else Fld_AngelAcc end from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = @PARTYCODE                            
 
                       
      while (@nserw<=@nsemax)                        
   Begin                        
   select @nseSett_no2=Sett_no from #NSEsettno where Srno=@nserw                        
                           
      if(@nseBank like '%AXIS%' or @nseBank like '%INDUSIND%' or @nseBank like '%IDFC%')                        
   Begin                        
                           
                           
       INSERT INTO #TEMP1                                
     SELECT 'H' + '|' + Ltrim(Rtrim(a.PARTY_CODE)) + '|' + Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', '') + '|' + CONVERT(VARCHAR, CONTRACTNO) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(SERVICE_TAX, 0)))) + '|' + '0.00'          
  
    
     
        
           
             
                 
                  
     + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(EXCHAGE_LEVIES, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STT, 0)))) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(Isnull(STAMPDUTY, 0)))) + '|' +             
  
    
      
        
          
            
              
                
                  
     CASE WHEN @diffamt BETWEEN -0.03 AND 0.03           
    THEN CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(CONVERT(DECIMAL(14, 2), Isnull(MINBROKERAGE, 0)) + CONVERT(DECIMAL(14, 2), Isnull(OTHER_CHARGES, 0))) + @diffamt )))                                
    ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( Sum(Isnull(MINBROKERAGE, 0) + Isnull(OTHER_CHARGES, 0)) )))                                
     END + '|' + CONVERT(VARCHAR, @TRANCNT) + '|' + CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), Sum(TOTALAMT))) +'|'+ b.DPid1+'|'+right(b.cltdpID1,8)+'|'+@SEG+'|'+                         
     CASE   WHEN @TYPE = 1 THEN 'B'  WHEN @TYPE = 2 THEN 'S'  END + '|A|'+CASE WHEN (@TYPE = 2 and right(@nseSett_no2,3)<500 )THEN 'T1' else 'T1'end+'|'+isnull(@nseSett_no2,'')+'|'+ CASE   WHEN @TYPE = 1 THEN isnull(@nsesetdate_t1,'') else                
  
   
       
       
  case when (right(@nseSett_no2,3)<500 ) then isnull(@nsesetdate,'') else isnull(@nsesetdate_t1,'') END End ,@nseBank                          
                        
       FROM   #NSE_HEADER a WITH (NOLOCK)                         
       left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                               
       WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@nseSett_no2                        
        AND SELL_BUY = @TYPE                                
       GROUP  BY a.PARTY_CODE,                                
           CONTRACTNO,                                
           Replace(CONVERT(VARCHAR(11), SAUDA_DATE, 102), '.', ''),b.DPid1,right(b.cltdpID1,8)                            
                                                 
       INSERT INTO #TEMP1                                
       SELECT 'T' + '|' + Ltrim(Rtrim(PARTY_CODE)) + '|' + Ltrim(Rtrim(CONTRACTNO)) + '|' + CASE                                
                            WHEN @TYPE = 1 THEN 'P'                                
                            WHEN @TYPE = 2 THEN 'S'                                
                             END + '|' + Ltrim(Rtrim(Isnull(ISIN, ''))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, QTY))) + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), TRATE))))                         
                          
                            
                              
     + '|' + Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), BROK_PERSCRIP)))) + '|' + Ltrim(Rtrim(CONVERT(DEC(10, 2), TRANACTIONAMT )))+'|'+left(Scripname,75),@nseBank                                  
       FROM   #NSE_DETAILS X                                
       WHERE  X.PARTY_CODE = @PARTYCODE                          
       and X.Sett_no = @nseSett_no2                        
                            
       End                             
    else if(@nseBank like '%IDBI%')                        
         BEGIN                        
                        
   declare @TotalAmt as money                        
   select @TotalAmt=(sum(TRANACTIONAMT)) from #NSE_DETAILS where party_code =@PARTYCODE                        
                           
   select @CliPISNo= case when ( isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
   @CliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
   @rbi_refno=rbi_refno                        
   from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                        
                           
     INSERT INTO #TEMP1                          
     --declare @nseBank as varchar(20)='jdfc',@PARTYCODE as varchar(20)='ZR1101N',@seg as varchar(20)='NSE',@nseSETT_NO as varchar(20)='1122321',@TYPE as varchar(20)='1',        
  ---@diffamt as numeric='0.01',@cliBankBranch as varchar(100),@CliBnkAcc as varchar(50),@angelAcc as varchar(50)                        
     --select @nseBank=fld_bankName,@cliBankBranch=Fld_branchlocation,@CliBnkAcc=fld_ClientPISac,@angelAcc=Fld_AngelAcc from Intranet.risk.dbo.V_NriBank_Details with (nolock) where fld_clientcode = 'ZR1101N'                        
      
     select 'IDBI BANK'+','+Convert(varchar,a.SAUDA_DATE,103)+','+@PARTYCODE+','+b.DPid1 +','+cast(right(b.cltdpID1,8) as varchar) +','+b.Short_Name +','+@SEG +','+isnull(@nseSett_no2,'') +','+                        
     CONVERT(VARCHAR,a.CONTRACTNO)+','+ltrim(rtrim(c.scripcode))+','+Ltrim(Rtrim(Isnull(c.ISIN,'')))+','+                        
     left(c.Scripname,75)+','+CASE WHEN @TYPE = 1 THEN 'Buy'  WHEN @TYPE = 2 THEN 'Sell'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,c.QTY))) +','+ Convert(Varchar,c.RATE)+','+cast((CONVERT(DEC(15,2),c.TRATE) *c.QTY) as varchar) +','+                        
       Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), c.TRATE)))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), c.BROK_PERSCRIP))))+','+                        
     --CASE WHEN @diffamt BETWEEN -0.03 AND 0.03                               
     -- THEN CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(CONVERT(DECIMAL(14,2),Isnull(MINBROKERAGE,0)) + CONVERT(DECIMAL(14,2),Isnull(OTHER_CHARGES,0))) + @diffamt )))                                
     -- ELSE CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),( Sum(Isnull(MINBROKERAGE,0) + Isnull(OTHER_CHARGES,0)) )))                             
     --  END +','+  --Other Charges end+','+                        
        CONVERT(VARCHAR,Isnull(C.OTHERCHARGES,0))+','+                        
     cast(Ltrim(Rtrim(CONVERT(DEC(10,2),c.TRANACTIONAMT))) as varchar) +','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(C.NseStt, 0))))+','+                        
     CONVERT(VARCHAR,CONVERT(DECIMAL(14,2), a.TOTALAMT))+','+isnull(@rbi_refno,'')+','+@CliPISNo+','+@CliBnkAcc+','+@cliBankBranch+','+'Angel One Ltd'+','+ CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN           
  Convert(varchar,(a.sauda_date+2),103)  END+','+                        
      CASE WHEN @TYPE = 1 THEN  Convert(varchar,(a.sauda_date +1),103)  WHEN @TYPE = 2 THEN Convert(varchar,(a.sauda_date+2),103)  END +','+@angelAcc,@nseBank                        
     from #NSE_HEADER a                             
     left outer join [INTRANET].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                         
     left outer join #NSE_DETAILS c on a.party_code=c.party_code                        
     where a.party_code= @PARTYCODE and a.SETT_NO=@nseSett_no2 and c.SETT_NO=@nseSett_no2                        
     group by    a.SAUDA_DATE ,b.DPid1 ,right(b.cltdpID1,8) ,b.Short_Name ,                        
     CONVERT(VARCHAR, a.CONTRACTNO) ,Ltrim(Rtrim(Isnull(c.ISIN, ''))),                        
     left(c.Scripname,75) ,Ltrim(Rtrim(CONVERT(VARCHAR, c.QTY))) ,Ltrim(Rtrim(CONVERT(DEC(10, 2), c.TRANACTIONAMT))),c.scripcode,                        
     Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(15, 2), c.RATE)))),Ltrim(Rtrim(CONVERT(VARCHAR, CONVERT(DEC(10, 2), c.BROK_PERSCRIP)))),                        
     c.QTY, Convert(Varchar,c.RATE),c.TRATE,c.RATE, Isnull(c.OTHERCHARGES,0),a.TOTALAMT                        
   -- print('4 ' + @PARTYCODE)                        
   End                        
  else if(@nseBank like '%HDFC%' or @nseBank like '%YES%')                   
  begin                  
                  
   select @CliPISNo= case when ( isnull(fld_ClientPISac,'0')='0') then FLD_NROPISNO  else fld_ClientPISac end,                        
   @CliBnkAcc= case when (isnull(fld_NREAcNO,'0')='0') then FLD_NROAcNO  else fld_NREAcNO end,                        
   @rbi_refno=rbi_refno                        
   from Intranet.risk.dbo.tbl_NRIClientMaster with (nolock)  where fld_clientcode = @PARTYCODE                     
                     
   if (@nseBank like '%HDFC%')                  
   set @nseBank='HDFC BANK'                  
                  
   insert into tbl_NSEBSE_HEADER_yesHdfcbnk                  
 select *,@TYPE,@nseSett_no2,@nseBank,isnull(@rbi_refno,''),@CliPISNo,@CliBnkAcc,@cliBankBranch,@angelAcc                   
 from #NSE_HEADER a                     
  WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@nseSett_no2                        
  AND SELL_BUY = @TYPE                   
                  
 insert into tbl_NSEBSE_Details_yesHdfcbnk                  
 select distinct * from #NSE_DETAILS a WHERE  SAUDA_DATE = @SDATE                                
        AND a.PARTY_CODE = @PARTYCODE                            
        And a.Sett_no=@nseSett_no2                        
        AND TRANSACTION_TYPE =  CASE WHEN @TYPE = 1 THEN 'P' WHEN @TYPE = 2 THEN 'S' END                  
                  
  End                  
            set @nserw=@nserw+1                        
      END                        
                        
              END                                    
                                    
            SET @CNT=@CNT - 1                                    
        END                                    
                                    
      --SELECT *                                    
      --FROM   #TEMP1       Intranet.risk.dbo.V_NriBank_Details where fld_bankname like '%idfc%'                        
                        
  insert into tbl_NRILec_temp                        
  select * from #TEMP1                        
                        
                        
  if ((select count(1) from tbl_NRILec_temp) >0)                        
    Begin                        
     declare @BCPCOMMAND1 as varchar(1000)                        
     DECLARE @Axisfilename2 as varchar(200)         DECLARE @indusfilename2 as varchar(200)                        
     DECLARE @Idfcfilename2 as varchar(200)                        
     DECLARE @hdfcfilename2 as varchar(200)                        
     DECLARE @IDBIfilename2 as varchar(200)                        
     DECLARE @Yesfilename2 as varchar(200)                        
     DECLARE @Allfilename2 as varchar(200)                        
     declare @link as varchar(2000)=''                        
     declare @Ftype as varchar(100)                                 
                            
   set @Ftype=  CASE   WHEN @TYPE = 1 THEN 'Buy'  WHEN @TYPE = 2 THEN 'Sell'  END+'_'+@SEG                            
   --set @Ftype=  'BUY_NSE'                            
                            
                            
    if ((select count(1) from tbl_NRILec_temp where bankname like '%AXIS%')>0)                        
     Begin                        
        SET @Axisfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\Axis_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
      SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%AXIS%''" QUERYOUT "'                        
     SET @BCPCOMMAND1 = @BCPCOMMAND1 + @Axisfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                        
     EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
     --print(@BCPCOMMAND1)                        
    -- set @link=@link +'<a href='+replace(@Axisfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Axis</a><br>'                        
     select '<a href='+replace(@Axisfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Axis</a><br>'                        
     End                        
      if ((select count(1) from tbl_NRILec_temp where bankname like '%INDUSIND%')>0)                        
     Begin                        
        SET @indusfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\INDUSIND_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
      SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%INDUSIND%''" QUERYOUT "'                                                    
   -- print(@BCPCOMMAND1)                                              
     SET @BCPCOMMAND1 = @BCPCOMMAND1 + @indusfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
     EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
    -- set @link=@link +'<a href='+replace(@indusfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Indusind</a><br>'                        
    select '<a href='+replace(@indusfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Indusind</a><br>'                        
     End                        
      if ((select count(1) from tbl_NRILec_temp where bankname like '%IDFC%')>0)                        
     Begin                        
        SET @Idfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\IDFC_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
      SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%IDFC%''" QUERYOUT "'                                                    
   -- print(@BCPCOMMAND1)                                              
     SET @BCPCOMMAND1 = @BCPCOMMAND1 + @Idfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
     EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
      --set @link=@link +'<a href='+replace(@Idfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDFC</a><br>'                        
       select '<a href='+replace(@Idfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDFC</a><br>'                        
     End                        
   --    if ((select count(1) from tbl_NRILec_temp where bankname like '%HDFC%')>0)                        
   --  Begin                        
   --     SET @hdfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\HDFC_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                         
   --   SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%HDFC%''" QUERYOUT "'                                                    
   ---- print(@BCPCOMMAND1)                                              
   --  SET @BCPCOMMAND1 = @BCPCOMMAND1 + @hdfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uclassmkt -Pdd$$gnfDTVs244648ysjgZAcc'                                                          
   --  EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
   -- -- set @link=@link +'<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                        
   -- select '<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                        
   --  End                        
   --   if ((select count(1) from tbl_NRILec_temp where bankname like '%IDBI%')>0)                        
   --  Begin                        
   --     SET @IDBIfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\IDBI_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                         
   --   SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%IDBI%''" QUERYOUT "'                                                    
   ---- print(@BCPCOMMAND1)                                              
   --  SET @BCPCOMMAND1 = @BCPCOMMAND1 + @IDBIfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uclassmkt -Pdd$$gnfDTVs244648ysjgZAcc'                                                          
   --  EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                        
   -- --  set @link=@link +'<a href='+replace(@IDBIfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDBI</a><br>'                        
   -- select '<a href='+replace(@IDBIfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDBI</a><br>'                        
   --  End               
            
     IF ((SELECT COUNT(1) FROM tbl_NRILec_temp WHERE bankname LIKE '%IDBI%') > 0)          
   BEGIN          
       SET @IDBIfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\IDBI_' + @Ftype + '_' + REPLACE(CONVERT(VARCHAR(12), GETDATE(), 103), '/', '') + '.csv';          
    --SET @BCPCOMMAND1 = 'BCP "SELECT ''Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Banks Branch Name,Broker Name,Date of Receipt /payment,Demat Debit/Credit Date,Broker A/C No'' UNION ALL SELECT ''IDBI Bank,' +  + 'SELECT FLDCOL FROM Inhouse.dbo.tbl_NRILec_temp WHERE bankname LIKE ''%IDBI%''" QUERYOUT "'         
   SET @BCPCOMMAND1 = 'BCP "SELECT ''Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Banks Branch Name,Broker Name,Date of Receipt /payment,Demat Debit /Credit DateBroker A/C No'' UNION ALL SELECT FLDCOL FROM Inhouse.dbo.tbl_NRILec_temp where bankname like ''%IDBI%''" QUERYOUT "'           
   SET @BCPCOMMAND1 = @BCPCOMMAND1 + @IDBIfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc';        
          
       EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1;          
             
       SELECT '<a href=' + REPLACE(@IDBIfilename2, '\\INHOUSELIVEAPP1-FS.angelone.in', '') + '>Right click and save -- IDBI</a><br>';          
   END;          
   --   if ((select count(1) from tbl_NRILec_temp where bankname like '%YES%')>0)                        
   --  Begin                        
   --     SET @YESfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\YES_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                         
   --   SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp where bankname like ''%YES%''" QUERYOUT "'                                                    
   ---- print(@BCPCOMMAND1)                                              
   --  SET @BCPCOMMAND1 = @BCPCOMMAND1 + @YESfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uclassmkt -Pdd$$gnfDTVs244648ysjgZAcc'                                                          
   --  EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                         
   --  --set @link=@link +'<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                            
   --  select '<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                        
   --  End                        
                         
                        
    SET @Allfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\TEST_'+@Ftype+'_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                                    
  
    
      
        
          
            
               
    --SET @FILENAME = '\\196.1.115.182\upload1\OmnesysFileFormat\CodeCreationFileFormat'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
    SET @BCPCOMMAND1 = 'BCP "select FLDCOL from Inhouse.dbo.tbl_NRILec_temp" QUERYOUT "'                                                    
   -- print(@BCPCOMMAND1)                                              
    SET @BCPCOMMAND1 = @BCPCOMMAND1 + @Allfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
    EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1              
    --set @link=@link +'<a href='+replace(@Allfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- All Banks</a><br>'                        
    select '<a href='+replace(@Allfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- All Banks</a><br>'                        
                            
              
       End                        
      Else                        
    Begin                        
         select 'No Records found'                           
    End                        
                  
      SET NOCOUNT OFF                                    
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.API_CLIENT_FUNDS_REPORTING_for_Sebi
-- --------------------------------------------------



 
 


--	EXEC API_CLIENT_FUNDS_REPORTING_for_Sebi 'APR  1 2018', 'NOV 27 2018','suresh','suresh'

CREATE PROCEDURE [dbo].[API_CLIENT_FUNDS_REPORTING_for_Sebi]
	@FR_DATE VARCHAR(11),
	@TO_DATE VARCHAR(11),
	@FR_CODE VARCHAR(10) = '0',
	@TO_CODE VARCHAR(10) = 'ZZZZZ',
	@EXCSEGMENT VARCHAR(500) = '',
	@ACCTYPE	VARCHAR(5)  = ''


AS

/*
EXEC API_CLIENT_FUNDS_REPORTING 'JAN  1 2019','JAN  7 2019','J55358','J55358'
*/

DECLARE @FILENAME   VARCHAR(50)
DECLARE @BATCHNO	INT  
DECLARE @MEMBERCODE VARCHAR(20)
DECLARE @MEMBERNAME	VARCHAR(500)

SELECT @MEMBERCODE = MEMBERCODE, @MEMBERNAME = ISNULL(LTRIM(RTRIM(COMPANY)),'') FROM MSAJAG.DBO.OWNER (NOLOCK)
SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0)+1 FROM MSAJAG.DBO.ASIANFILEBATCHNO  
WHERE FLDFILENO = 'CL'  
AND LEFT(FLDFILEDATE,11) = LEFT(GETDATE(),11)
  
IF @BATCHNO = 1  
BEGIN  
	INSERT INTO MSAJAG.DBO.ASIANFILEBATCHNO VALUES ('CL', @BATCHNO, GETDATE(), GETDATE())  
END  
ELSE  
BEGIN  
	UPDATE MSAJAG.DBO.ASIANFILEBATCHNO SET FLDBATCHNO = @BATCHNO WHERE FLDFILENO = 'CL' AND LEFT(FLDFILEDATE,11) = LEFT(GETDATE(),11)
END  
  
SET	@FILENAME = @MEMBERCODE + '_CL_' + REPLACE(CONVERT(VARCHAR,GETDATE(),103),'/','') + '_' + RIGHT('00'+CONVERT(VARCHAR,@BATCHNO),2) 


CREATE TABLE [DBO].[#DBNAME_LIST] (
	ACCOUNTDB VARCHAR(20)
	,EXCHANGE VARCHAR(6)
	,SEGMENT VARCHAR(10)
	,ACCOUNTSERVER VARCHAR(50)
	,SHAREDB VARCHAR(20)
	) ON [PRIMARY]

DECLARE
	@@DB1 VARCHAR(1000)
	,@@SQL VARCHAR(5000)
	,@@SEGORD1 SMALLINT
	,@@MAINREC1 AS CURSOR
	,@@ACCOUNTDB1 VARCHAR(20)
	,@@SHAREDB1 VARCHAR(20)
	,@@ACCOUNTSVR1 VARCHAR(50)
	,@@EXCHANGE1 VARCHAR(15)
	,@@SEGMENT1 VARCHAR(15)

IF @EXCSEGMENT <> ''
	SELECT @@DB1 = " INSERT INTO #DBNAME_LIST SELECT ACCOUNTDB, EXCHANGE, SEGMENT, ACCOUNTSERVER, SHAREDB FROM  PRADNYA.DBO.VW_REPORTING_MULTICOMPANY (NOLOCK) WHERE EXCHANGE+'~'+SEGMENT IN ('" + REPLACE(@EXCSEGMENT, ',', ''',''') + "') ORDER BY EXCHANGE "
ELSE
	SELECT @@DB1 = " INSERT INTO #DBNAME_LIST SELECT ACCOUNTDB, EXCHANGE, SEGMENT, ACCOUNTSERVER, SHAREDB FROM  PRADNYA.DBO.VW_REPORTING_MULTICOMPANY (NOLOCK) ORDER BY EXCHANGE "

EXEC (@@DB1)

CREATE TABLE #LEDGER_PL_DETAILS
(
	UCC_CODE VARCHAR(30),
	CLTCODE VARCHAR(10),
	LONG_NAME VARCHAR(150),
	CLIENT_PAN VARCHAR(50),
	VDT DATETIME,
	EDT DATETIME,
	EXCHANGE VARCHAR(10),
	SEGMENT VARCHAR(10),
	SETT_NO VARCHAR(10),
	CHQ_NO VARCHAR(30),
	VTYPE VARCHAR(30),
	NARRATION VARCHAR(500),
	VNO VARCHAR(12),
	DRAMOUNT MONEY,
	CRAMOUNT MONEY,
	RUNNING_BALANCE MONEY,
	OPBAL MONEY,
	PDT DATETIME
)

SET @@MAINREC1 = CURSOR
FOR

SELECT ACCOUNTDB
	,EXCHANGE
	,SEGMENT
	,ACCOUNTSERVER
	,SHAREDB
FROM #DBNAME_LIST

SET @@SEGORD1 = 1

OPEN @@MAINREC1

FETCH NEXT
FROM @@MAINREC1
INTO @@ACCOUNTDB1
	,@@EXCHANGE1
	,@@SEGMENT1
	,@@ACCOUNTSVR1
	,@@SHAREDB1

WHILE @@FETCH_STATUS = 0
BEGIN

IF @@ACCOUNTSVR1 = 'ANAND1'
	SET @@SQL = "INSERT INTO #LEDGER_PL_DETAILS EXEC " + @@ACCOUNTDB1 + ".DBO.CLIENT_FUNDS_REPORTING '" + @FR_DATE + "','" + @TO_DATE + "','" + @@EXCHANGE1 + "','" + @@SEGMENT1 + "','" + @FR_CODE + "','" + @TO_CODE + "'"
else
	SET @@SQL = "INSERT INTO #LEDGER_PL_DETAILS EXEC " + @@ACCOUNTSVR1 + "." + @@ACCOUNTDB1 + ".DBO.CLIENT_FUNDS_REPORTING '" + @FR_DATE + "','" + @TO_DATE + "','" + @@EXCHANGE1 + "','" + @@SEGMENT1 + "','" + @FR_CODE + "','" + @TO_CODE + "'"
	PRINT @@SQL
	EXEC (@@SQL)


FETCH NEXT
	FROM @@MAINREC1
	INTO @@ACCOUNTDB1
		,@@EXCHANGE1
		,@@SEGMENT1
		,@@ACCOUNTSVR1
		,@@SHAREDB1
END

CLOSE @@MAINREC1

CREATE TABLE #LEDGER_PL_DETAILS_FINAL
(
	UCC_CODE VARCHAR(30),
	CLTCODE VARCHAR(10),
	LONG_NAME VARCHAR(150),
	CLIENT_PAN VARCHAR(30),
	VDT DATETIME,
	EDT DATETIME,
	EXCHANGE VARCHAR(10),
	SEGMENT VARCHAR(10),
	SETT_NO VARCHAR(10),
	CHQ_NO VARCHAR(30),
	VTYPE VARCHAR(30),
	NARRATION VARCHAR(500),
	VNO VARCHAR(12),
	DRAMOUNT MONEY,
	CRAMOUNT MONEY,
	RUNNING_BALANCE MONEY,
	OPBAL MONEY,
	PDT DATETIME,
	SNO INT IDENTITY(1, 1)
)

INSERT INTO #LEDGER_PL_DETAILS_FINAL
SELECT * FROM #LEDGER_PL_DETAILS ORDER BY CLTCODE, VDT, PDT

UPDATE L SET RUNNING_BALANCE = (SELECT SUM(CRAMOUNT - DRAMOUNT) FROM #LEDGER_PL_DETAILS_FINAL L1 WHERE L.CLTCODE = L1.CLTCODE AND L1.SNO <= L.SNO) FROM #LEDGER_PL_DETAILS_FINAL L

--SELECT * FROM #LEDGER_PL_DETAILS_FINAL ORDER BY SNO
/*
DECLARE
	@MEMBER_CODE VARCHAR(200)
SELECT @MEMBER_CODE = COMPANY FROM OWNER
*/

CREATE TABLE #FINAL ( Filename varchar(80),Data varchar(8000),SNO INT IDENTITY(1,1))

--NEED TO APPLY THE LOGIC OF RUNNING BALANCE IN _WRAPPER PROCEDURE 

INSERT INTO #FINAL
SELECT FILENAME = @FILENAME, DATA = @MEMBERNAME+','+ REPLACE(CONVERT(VARCHAR, CONVERT(DATETIME, @FR_DATE , 109), 103), '/', '') + ' to ' + REPLACE(CONVERT(VARCHAR, CONVERT(DATETIME, @TO_DATE , 109), 103), '/', '') 

---SELECT FILENAME = @FILENAME, DATA = UCC_CODE + ',' + CLTCODE + ',' + LONG_NAME + ',' + CLIENT_PAN + ',' + REPLACE(CONVERT(VARCHAR(10), VDT, 103), '/', '-') + ',' + REPLACE(CONVERT(VARCHAR(10), EDT, 103), '/', '-') + ',' + EXCHANGE + ',' + SEGMENT + ',' + ISNULL(SETT_NO, '') + ',' + ISNULL(CHQ_NO, '') + ',' + VTYPE + ',' + NARRATION + ',' + VNO + ',' + CONVERT(VARCHAR, DRAMOUNT) + ',' + CONVERT(VARCHAR, CRAMOUNT) + ',' + CONVERT(VARCHAR, RUNNING_BALANCE) FROM #LEDGER_PL_DETAILS_FINAL

-- added for header

INSERT INTO #FINAL
SELECT FILENAME = @FILENAME, DATA = 'Unique Client Code (UCC),Back Office Client Code,Client Name,Client PAN,Date,Settlement Date,Exchange,Segment Type,Settlement No.,Bill/Chq No.,Transaction Type,Particulars /Narration,Voucher No.,Debit (Rs.),Credit (Rs.),Balance(Rs.)' 

-- added for header

INSERT INTO  #FINAL
SELECT FILENAME = @FILENAME, DATA = UCC_CODE + ',' + CLTCODE + ',' + LONG_NAME + ',' + CLIENT_PAN + ',' + REPLACE(CONVERT(VARCHAR(10), VDT, 103), '/', '-') + ',' + REPLACE(CONVERT(VARCHAR(10), EDT, 103), '/', '-') + ',' + EXCHANGE + ',' + SEGMENT + ',' + 
ISNULL(SETT_NO, '') + ',' + ISNULL(CHQ_NO, '') + ',' + VTYPE + ',' + NARRATION + ',' + VNO + ',' + CONVERT(VARCHAR, DRAMOUNT) + ',' + CONVERT(VARCHAR, CRAMOUNT) + ',' + CONVERT(VARCHAR, RUNNING_BALANCE) 
FROM #LEDGER_PL_DETAILS_FINAL 
ORDER BY VDT 

SELECT Filename,Data,SNO INTO DUstbin.dbo.led_sebi   from #FINAL ORDER by SNO

GO

-- --------------------------------------------------
-- PROCEDURE dbo.aws_contract_note_single_BKP_06JUN2025_SRE_37277
-- --------------------------------------------------

CREATE  proc [dbo].[aws_contract_note_single_BKP_06JUN2025_SRE_37277] (@dt datetime,@cnflag VARCHAR(2),@CLTCODE VARCHAR(10))  
as  
---aws_contract_note_single '2024-10-01' ,'A','A00927'

declare @date varchar(30),@sdt varchar(11),@tdt varchar(11)  
  
  
select @date= convert(varchar(11),@dt,103)  
  
select @sdt=replace( convert(varchar(12),@dt,107),',','')   
select @tdt=replace( convert(varchar(12),@dt,107),',','') +' 23:59:59'  
   
    
  EXEC  V2_COMBINED_CONTRACTNOTE_NEW_OptTest 'broker','broker',@sdt,@sdt,@CLTCODE,@CLTCODE,'','zzzzzzzzzzz','','zzzzzzzzzzz','','99999999','', 'ALL',0,'ALL','Angel Broking Pvt Ltd.(Erstwhile Angel Broking Ltd.)','CASHFNO'  
  
  exec usp_TradeSummaryInContractNotes_DataFetching_single @sdt,@tdt,@CLTCODE  
  
If (@cnflag ='c')  
  BEGIN      
            Truncate table FO_Cn  
  
   Insert into FO_Cn  
   Select distinct Party_code, DataFetchDatetime = getdate()    
   From mimansa.Clientservice.dbo.Foopenpos with(nolock)  
   where Sauda_date >= CONVERT(VARCHAR(11),getdate(),120)  
   and Sauda_date <= CONVERT(VARCHAR(11),getdate(),120) + ' 23:59'  AND PARTY_CODE = @CLTCODE
   UNION  
   Select distinct Party_code = ClientAccount_No, DataFetchDatetime = getdate()  
   from csomimansa.general.dbo.tbl_NetPosition_NSEFo with(nolock)  
   where ActivityTime >= CONVERT(VARCHAR(11),getdate(),120)  
   and ActivityTime <= CONVERT(VARCHAR(11),getdate(),120) + ' 23:59'   AND ClientAccount_No = @CLTCODE
  
   Delete c from Contractnote_Daily c,FO_Cn F  
   where  C.PARTY_CODE = F.Party_code  
  
  
  
  END  
    
IF (@CNFLAG='F')  
  BEGIN   
  
          /* Select Distinct party_code into #PFNO  from Contractnote_Daily where SEGMENT='Futures'  
        
     CREATE CLUSTERED INDEX ix_PFNO ON #PFNO ([party_code])  
  
     Delete c from Contractnote_Daily c  
     where PARTY_CODE Not in (select * from #PFNO) */  
  
       
   Delete c from Contractnote_Daily c,CASH_CN F  
   where  C.PARTY_CODE = F.Party_code  
   AND CONVERT(VARCHAR(11),SAUDA_DATE ,120)=CONVERT(VARCHAR(11),SDATE ,103)  
  END  
       
  
 --Create Table FO_Cn (party_code varchar(15),sdate datetime)   
   
    
  
SELECT DISTINCT A.PARTY_CODE,CONTRACT_HEADER_DET,A.EXCHANGE,A.SEGMENT,A.SETT_TYPE INTO #TEMP  FROM Contractnote_Daily  A,(  
select PARTY_CODE,EXCHANGE,SEGMENT,SETT_TYPE  
from Contractnote_Daily WHERE  SAUDA_DATE =@date AND SCRIPNAME IN ('BROKERAGE','BRKSCR')  AND PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE  
and segment ='CAPITAL' )B  
WHERE A.PARTY_CODE=B.PARTY_CODE AND A.EXCHANGE=B.EXCHANGE AND A.SEGMENT=B.SEGMENT AND A.SETT_TYPE =B.SETT_TYPE AND A.SETT_TYPE IN ('N','W','D','C','M','Z','RC','RD')   
AND SCRIPNAME NOT  IN ('BROKERAGE','BRKSCR')    
  
BEGIN TRAN   
UPDATE B SET CONTRACT_HEADER_DET=A.CONTRACT_HEADER_DET FROM  #TEMP A ,  
Contractnote_Daily B WHERE  SAUDA_DATE =@date AND SCRIPNAME IN ('BROKERAGE','BRKSCR')     
and B.segment ='CAPITAL'   
AND  A.PARTY_CODE=B.PARTY_CODE AND A.EXCHANGE=B.EXCHANGE AND A.SEGMENT=B.SEGMENT AND A.SETT_TYPE =B.SETT_TYPE  
COMMIT  
  
 SELECT DISTINCT A.PARTY_CODE,CONTRACT_HEADER_DET,A.EXCHANGE,A.SEGMENT INTO #TEMP1   
 FROM Contractnote_Daily  A,(  
select distinct  PARTY_CODE,EXCHANGE,SEGMENT  
from Contractnote_Daily WHERE  SAUDA_DATE =@date AND  CONTRACTNO ='0'  
AND PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE
and segment ='Futures' and CONTRACTNO ='0' )B  
WHERE A.PARTY_CODE=B.PARTY_CODE AND A.EXCHANGE=B.EXCHANGE AND A.SEGMENT=B.SEGMENT   
AND  CONTRACTNO <>'0'  
  
BEGIN TRAN   
UPDATE B SET CONTRACT_HEADER_DET=A.CONTRACT_HEADER_DET FROM  #TEMP1 A ,  
Contractnote_Daily B WHERE  SAUDA_DATE =@date and CONTRACTNO ='0'     
and B.segment ='Futures'   
AND  A.PARTY_CODE=B.PARTY_CODE AND A.EXCHANGE=B.EXCHANGE AND A.SEGMENT=B.SEGMENT AND    
a.segment ='Futures'    
COMMIT  
  
  
  
truncate table nse_bulk_process  
  
   
SELECT * INTO #DELAING_ADDRESS FROM (  
SELECT DISTINCT PARTY_CODE ,(CASE WHEN DEALING_ADDRESS='- ' THEN 'G-1, Akruti Trade Centre, Road No. 7,MIDC Marol, Andheri (East),MUMBAI-400093 MAHARASHTRA' ELSE DEALING_ADDRESS END)  
 DEALING_ADDRESS,GST_LOCATION,SUB_BROKER,TGST_NO,roW_NUMBER()OVER (PARTITION BY PARTY_CODE ORDER BY PARTY_CODE) AS ROW_NO FROM (  
SELECT distinct party_code,ISNULL(LTRIM(RTRIM(Address1)),'')+ ISNULL(LTRIM(RTRIM(Address2)),'')+ isnull(LTRIM(RTRIM(Address3)),'')+isnull(LTRIM(RTRIM(City)),'')+'-'+  
isnull(LTRIM(RTRIM(ZIP)),'')+' '+isnull(LTRIM(RTRIM(sTATE)),'')  AS DEALING_ADDRESS,  
SOURCESTATE +' ' +DEAL_CLIENT_ADD AS GST_LOCATION ,C.SUB_BROKER,TGST_NO  
FROM Contractnote_Daily C    
LEFT OUTER JOIN   
 vwGetSubBrokerDetail_dummY V  with(nolock)  
ON  C.Sub_Broker =V.Sub_Broker )A )A  
WHERE ROW_NO=1  
  
   
 SELECT DISTINCT EXCHANGE,SEGMENT,PARTY_CODE,ORDER_NO,SCRIPNAME,SELL_BUY INTO #TEMP12 FROM Contractnote_Daily   
  
SELECT CD_PARTY_CODE, EXCHANGE='NSE' ,SEGMENT ='CAPITAL', CONVERT(VARCHAR(200),CD_Scrip_Cd) SCRIP_CD ,SELL_FLAG=CONVERT(VARCHAR(10),''), CD_Order_No ,  
 CD_TrdBuy_Qty+ CD_TrdSell_Qty+ CD_DelBuy_Qty+CD_DelSell_Qty AS TRD_QTY,CD_BUYRATE+CD_SELLRATE AS PRICE,  
(CD_TrdBuy_TurnOver+ CD_TrdSell_TurnOver+ CD_DelBuy_TurnOver +CD_DelSell_TurnOver) TURNOVER ,CONVERT(VARCHAR,CD_TotalBrokerage) AS BROKERAGE  
INTO #ORDER_WISE  
FROM Charges_Detail (Nolock)   WHERE CD_SAUDA_DATE =@dt AND CD_Scrip_Cd <>'BROKERAGE'  AND CD_PARTY_CODE >= @CLTCODE AND CD_PARTY_CODE <= @CLTCODE 
UNION ALL   
SELECT CD_PARTY_CODE, EXCHANGE='BSE' ,SEGMENT ='CAPITAL',CONVERT(VARCHAR(200),CD_Scrip_Cd) SCRIP_CD ,SELL_FLAG=CONVERT(VARCHAR(10),''), CD_Order_No ,  
 CD_TrdBuy_Qty+ CD_TrdSell_Qty+ CD_DelBuy_Qty+CD_DelSell_Qty AS TRD_QTY,CD_BUYRATE+CD_SELLRATE AS PRICE,  
(CD_TrdBuy_TurnOver+ CD_TrdSell_TurnOver+ CD_DelBuy_TurnOver +CD_DelSell_TurnOver) TURNOVER ,CONVERT(VARCHAR,CD_TotalBrokerage) AS BROKERAGE  
FROM AngelBSECM.BSEDB_AB.DBO.Charges_Detail with (Nolock)   WHERE CD_SAUDA_DATE =@dt AND CD_Scrip_Cd <>'BRKSCR' AND CD_PARTY_CODE >= @CLTCODE AND CD_PARTY_CODE <= @CLTCODE  
UNION ALL   
SELECT CD_PARTY_CODE,EXCHANGE='NSE' ,SEGMENT='FUTURES',CONVERT(VARCHAR(200),CD_SYMBOL) SCRIP_CD,SELL_FLAG=CONVERT(VARCHAR(10),''),CONVERT(VARCHAR,CD_Order_No),  
 CD_Tot_BuyQty +CD_Tot_SellQty AS TRD_QTY  ,CD_BUYRATE+CD_SELLRATE AS PRICE, CD_TOT_TURNOVER,CD_TOT_BROK   
FROM ANGELFO.NSEFO.DBO.Charges_Detail with (Nolock)    WHERE CD_SAUDA_DATE =@dt  AND CD_ComputationLevel ='O'  AND CD_PARTY_CODE >= @CLTCODE AND CD_PARTY_CODE <= @CLTCODE
UNION ALL
SELECT CD_PARTY_CODE,EXCHANGE='BSE' ,SEGMENT='FUTURES',CONVERT(VARCHAR(200),CD_SERIES_CODE) SCRIP_CD,SELL_FLAG=CONVERT(VARCHAR(10),''),CONVERT(VARCHAR,CD_Order_No),
 CD_Tot_BuyQty	+CD_Tot_SellQty AS TRD_QTY  ,CD_BUYRATE+CD_SELLRATE AS PRICE, CD_TOT_TURNOVER,CD_TOT_BROK 
FROM ANGELCOMMODITY.BSEFO.DBO.Charges_Detail with (Nolock)    WHERE CD_SAUDA_DATE =@dt  AND CD_ComputationLevel ='O'  AND CD_PARTY_CODE >=@CLTCODE AND CD_PARTY_CODE <=@CLTCODE
  
UPDATE O SET SCRIP_CD =T.SCRIPNAME,SELL_FLAG =SELL_BUY FROM #ORDER_WISE O,#TEMP12 T  
WHERE O.CD_Order_No=ORDER_NO   
AND T.EXCHANGE=O.EXCHANGE AND T.SEGMENT=O.SEGMENT  
AND T.PARTY_CODE =O.CD_Party_Code  
   
 --SELECT * FROM #ORDER_WISE WHERE SCRIP_CD =''  
 --TRUNCATE TABLE nse_bulk_process  
  
INSERT INTO nse_bulk_process  
   
 select PARTY_CODE,SNO,DATA,dense_rank ()OVER(PARTITION BY PARTY_CODE ORDER BY PARTY_CODE,EXCHANGE asc, SCRIPNAME ),B,C,D,E from (  
SELECT DISTINCT PARTY_CODE,'3' AS SNO,LTRIM(RTRIM(PARTY_CODE))+'|'+'CA'+'|'+EXCHANGE+'|'+SCRIPName+'|'+CONVERT(VARCHAR,Buy_qty)+'|'+ CONVERT(VARCHAR,BuyMarketRate)+'|'+ CONVERT(VARCHAR,Sell_qty)+'|'+ CONVERT(VARCHAR,SellMarketRate)+'|'+  
 CONVERT(VARCHAR,BROKERAGE)+'|'+ CONVERT(VARCHAR,STT)+'|'+CONVERT(VARCHAR,Other_charges)+'|'+CONVERT(VARCHAR,Grand_Total)AS DATA,''A,''B,''C,''D,''E,EXCHANGE,  
 SCRIPName=( CASE WHEN SCRIPName ='**Additional Brokerage**' THEN 'ZZZZZZZZ' ELSE  SCRIPName END)  
FROM Tbl_CashTradeSummaryforCN (Nolock)   
WHERE   PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE
UNION ALL  
SELECT DISTINCT PARTY_CODE,'4' AS SNO,LTRIM(RTRIM(PARTY_CODE))+'|'+'FO'+'|'+  
( CASE WHEN SYMBOL ='**Additional Brokerage**' THEN '**Additional Brokerage' ELSE  SYMBOL END)+' '+  
( CASE WHEN SYMBOL ='**Additional Brokerage**' THEN '' ELSE  TRADETYPE END)+'|'+  
CONVERT(Varchar(11),REPLACE(REPLACE(CONVERT(VARCHAR,EXPIRYDATE),'Jan  1 1900 12:00AM',''),'Dec 31 2049 11:59PM',''))+'|'+INST_TYPE+'|'+CONVERT(VARCHAR,OPTION_TYPE)+' '+CONVERT(VARCHAR,STRIKE_PRICE)+'|'  
+CONVERT(VARCHAR,Buyqty)+'|'+   
CONVERT(VARCHAR,BuyRate)+'|'+ CONVERT(VARCHAR,Sellqty)+'|'+ CONVERT(VARCHAR,SellRate)+'|'+  
CONVERT(VARCHAR,BROKERAGE)+'|'+ CONVERT(VARCHAR,STT)+'|'+CONVERT(VARCHAR,OTHER_TAX)+'|'+CONVERT(VARCHAR,CLOSING_RATE) +'|'+CONVERT(VARCHAR,Grand_Total),''A,''B,''C,''D,''E  
,EXCHANGE='NSEFO',  
SCRIPName=( CASE WHEN SYMBOL ='**Additional Brokerage**' THEN 'ZZZZZZZZ' ELSE  SYMBOL END)  
FROM tbl_DailyTradesumary_NSEFO (Nolock)  where PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE) a  
order by party_code,EXCHANGE,SCRIPName  
   
   
delete from nse_bulk_process where sno=1  
  
    
 INSERT INTO nse_bulk_process  
SELECT DISTINCT C.PARTY_CODE,'1' AS SNO,C.PARTY_CODE+'|'+'H'+'|'+C.PARTY_CODE+'('+c.branch_cd+'/'+c.sub_broker+')'+'|'+PARTYNAME+'|'  
+REPLACE(C.L_ADDRESS1,'|','')+'|'+replace(C.L_ADDRESS2,'|','')+'|'+replace(C.L_ADDRESS3,'|','')+'|'+C.L_CITY+'|'+C.L_STATE+'-'+C.L_ZIP+'|'+CONTRACTNO_NEW+'|'+C.PAN_GIR_NO+'|'+  
CONVERT(VARCHAR(11),SAUDA_DATE,120) +'|'+email +'|'+mobile_pager +'|'+CLGSTNO AS TEXT ,'','','','',''  
--CONVERT(VARCHAR(11),SAUDA_DATE,120) +'|'+'shashi.soni@angelbroking.com' +'|'+'9321501694' +'|'+CLGSTNO AS TEXT ,'','','','',''  
FROM Contractnote_Daily (Nolock) D,CLIENT_DETAILS (Nolock) C  
WHERE SAUDA_DATE =@date  AND C.PARTY_CODE >= @CLTCODE AND C.PARTY_CODE <= @CLTCODE  
AND D.PARTY_CODE=C.CL_CODE   
  
 INSERT INTO nse_bulk_process   
SELECT PARTY_CODE,'2' AS SNO,LTRIM(RTRIM(PARTY_CODE))+'|'+'A'+'|'+DEALING_ADDRESS+'|'+GST_LOCATION+'|'+TGST_NO,'','','','','' FROM #DELAING_ADDRESS   
  
   
    
 INSERT INTO nse_bulk_process   
SELECT PARTY_CODE,'5' AS SNO,LTRIM(RTRIM(PARTY_CODE))+'|'+'D'+'|'+EXCHANGE+'|'+SEGMENT+'|'+CONVERT(VARCHAR,ORDER_NO)+'|'+CONVERT(VARCHAR,ORDER_TIME)+'|'+CONVERT(VARCHAR,TRADE_NO)+'|'+  
CONVERT(VARCHAR,TRADE_TIME)  
+'|'+CONVERT(VARCHAR(100),SCRIPNAME)+'|'+CONVERT(VARCHAR,SELL_BUY)+'|'+(CONVERT(VARCHAR,QTY)+CONVERT(VARCHAR,' '+TMARK))+'|'+convert( varchar(20), cast( MARKETRATE as decimal(18,4)))+'|'+  
convert( varchar(20), cast( BROKERAGE as decimal(18,4)))  
+'|'+convert( varchar(20), cast( NETRATE as decimal(18,4)))+'|'+convert( varchar(20), cast( CL_RATE as decimal(18,4)))+'|'+ convert( varchar(20), cast( NETAMOUNT as decimal(18,4)))  
+'|'+ISIN+'|'+CONVERT(VARCHAR,SETT_NO)+'-'+CONVERT(VARCHAR,SETTTYPE_DESC)+'|'+CONVERT(VARCHAR,SETT_DATE)+'|'+  
CONVERT(VARCHAR,CONTRACTNO) +'|'+CONVERT(VARCHAR,REMARK_DESC)+'|'+CONTRACT_HEADER_DET , SRNO,EXCHANGE,SEGMENT,CONVERT(VARCHAR(100),SCRIPNAME),CONVERT(VARCHAR,ORDER_TIME)  
FROM (  
SELECT  dense_rank ()OVER(PARTITION BY PARTY_CODE ORDER BY PARTY_CODE,CONTRACTNO DESC, SCRIPNAME )AS SRNO, PARTY_CODE,EXCHANGE,SEGMENT  
,ORDER_NO=(CASE WHEN ORDER_NO ='' AND BFCF_FLAG ='BF_F' THEN 'FUTBF' ELSE ORDER_NO END)  
,ORDER_TIME,TRADE_NO,  
TRADE_TIME,SCRIPNAME,SELL_BUY,QTY,MARKETRATE,BROKERAGE=Brok,TMARK   
,NETRATE,CL_RATE,NETAMOUNT,ISIN,SETT_NO,SETT_DATE,CONTRACTNO ,(CASE WHEN REMARK_DESC ='' THEN '0' ELSE REMARK END) REMARK_DESC,CONTRACT_HEADER_DET,SETTTYPE_DESC  
FROM Contractnote_Daily WITH(NOLOCK) WHERE SAUDA_DATE =@date AND PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE AND SCRIPNAME NOT IN ('BROKERAGE','BRKSCR')   AND QTY <>0  
UNION ALL  
SELECT dense_rank ()OVER(PARTITION BY PARTY_CODE ORDER BY PARTY_CODE,CONTRACTNO DESC ,SCRIPNAME ) AS ROW_NO, PARTY_CODE,EXCHANGE,SEGMENT,ORDER_NO='',ORDER_TIME='23:59:59',TRADE_NO='',  
TRADE_TIME='',SCRIPNAME,SELL_BUY='',SUM(CASE WHEN SELL_BUY='SELL' THEN QTY*-1 ELSE QTY END),MARKETRATE='',BROKERAGE ='',TMARK=''  
,NETRATE='',CL_RATE='',NETAMOUNT=SUM(NETAMOUNT),ISIN ,SETT_NO ,SETT_DATE,CONTRACTNO ='0',REMARK_DESC ='0',CONTRACT_HEADER_DET,SETTTYPE_DESC  
FROM Contractnote_Daily WITH(NOLOCK) WHERE   PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE AND SCRIPNAME NOT IN ('BROKERAGE','BRKSCR')   AND QTY <>0  
GROUP BY PARTY_CODE,EXCHANGE,SEGMENT,SCRIPNAME,ISIN,CONTRACTNO,CONTRACT_HEADER_DET,SETTTYPE_DESC,SETT_NO ,SETT_DATE   
 ) A     ORDER BY PARTY_CODE,EXCHANGE,SEGMENT,CONTRACTNO DESC,SCRIPNAME,ORDER_TIME   
   
INSERT INTO nse_bulk_process  
SELECT PARTY_CODE,'6' AS SNO,LTRIM(RTRIM(PARTY_CODE))+'|'+'D'+'|'+EXCHANGE+'|'+SEGMENT+'|'+CONVERT(VARCHAR,ORDER_NO)+'|'+CONVERT(VARCHAR,ORDER_TIME)+'|'+CONVERT(VARCHAR,TRADE_NO)+'|'+CONVERT(VARCHAR,TRADE_TIME)  
+'|'+CONVERT(VARCHAR,'ADDITIONAL BROKERAGE')+'|'+CONVERT(VARCHAR,SELL_BUY)+'|'+CONVERT(VARCHAR,QTY)+'|'+CONVERT(VARCHAR,MARKETRATE)+'|'+convert( varchar(20), cast( BROKERAGE as decimal(18,4)))  
+'|'+CONVERT(VARCHAR,NETRATE)+'|'+CONVERT(VARCHAR,CL_RATE)+'|'+convert( varchar(20), cast( NETAMOUNT as decimal(18,4)))+'|'+ 'Brokerage'+'|'+CONVERT(VARCHAR,SETT_NO)+'-'+CONVERT(VARCHAR,SETTTYPE_DESC)+'|'+CONVERT(VARCHAR,SETT_DATE)+'|'+  
CONVERT(VARCHAR,CONTRACTNO) +'|'+CONVERT(VARCHAR,REMARK_DESC)+'|'+CONTRACT_HEADER_DET,1,exchange,SEGMENT,'',''  
FROM Contractnote_Daily WHERE  SAUDA_DATE =@date AND SCRIPNAME IN ('BROKERAGE','BRKSCR')  AND PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE 
union all   
SELECT PARTY_CODE,'6' AS SNO,LTRIM(RTRIM(PARTY_CODE))+'|'+'D'+'|'+EXCHANGE+'|'+SEGMENT+'|'+CONVERT(VARCHAR,ORDER_NO)+'|'+CONVERT(VARCHAR,ORDER_TIME)+'|'+CONVERT(VARCHAR,TRADE_NO)+'|'+CONVERT(VARCHAR,TRADE_TIME)  
+'|'+CONVERT(VARCHAR(35),'ADDITIONAL BROKERAGE (NET TOTAL)')+'|'+CONVERT(VARCHAR,SELL_BUY)+'|'+CONVERT(VARCHAR,QTY)+'|'+CONVERT(VARCHAR,MARKETRATE)+'|'+CONVERT(VARCHAR,0)  
+'|'+CONVERT(VARCHAR,NETRATE)+'|'+CONVERT(VARCHAR,CL_RATE)+'|'+convert( varchar(20), cast( NETAMOUNT as decimal(18,4)))+'|'+ 'Brokerage'+'|'+CONVERT(VARCHAR,SETT_NO)+'-'+CONVERT(VARCHAR,SETTTYPE_DESC)+'|'+CONVERT(VARCHAR,SETT_DATE)+'|'+  
CONVERT(VARCHAR,CONTRACTNO) +'|'+CONVERT(VARCHAR,REMARK_DESC)+'|'+CONTRACT_HEADER_DET,2,exchange,SEGMENT,'',''  
FROM Contractnote_Daily WHERE  SAUDA_DATE =@date AND SCRIPNAME IN ('BROKERAGE','BRKSCR')  AND PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE  
  
  
  
INSERT INTO nse_bulk_process  
  
SELECT CD_PARTY_CODE,'7' AS SNO,LTRIM(RTRIM(CD_PARTY_CODE))+'|'+'O'+'|'+EXCHANGE+'|'+SEGMENT+'|'  
+CONVERT(VARCHAR(100),SCRIP_CD)+'|'+SELL_FLAG+'|'+CONVERT(VARCHAR,CD_Order_No)+'|'+CONVERT(VARCHAR,TRD_QTY)+'|'+CONVERT(VARCHAR(20),CAST(PRICE AS DECIMAL(18,4)))+'|'+  
CONVERT(VARCHAR(20),CAST(TURNOVER  AS DECIMAL(18,4)))+'|'+CONVERT(VARCHAR(20),CAST(BROKERAGE  AS DECIMAL(18,4))),dense_rank ()OVER(PARTITION BY cd_PARTY_CODE ORDER BY cd_PARTY_CODE,exchange,segment ,scrip_cd,cd_order_no ) AS ROW_NO,'','','',''  
FROM #ORDER_WISE  ---WHERE CD_PARTY_CODE ='HHTF1005'  
ORDER BY CD_Party_Code,EXCHANGE,SEGMENT,SCRIP_CD  
  
 /* MODIFIED ON 05052020 ADDED GST VALUES   
 INSERT INTO nse_bulk_process  
SELECT PARTY_CODE,'8' AS SNO,PARTY_CODE+'|'+'F'+'|'+EXCHANGE+'|'+SEGMENT+'|'+CONVERT(VARCHAR,SUM(NETAMOUNT)) +'|'+  
CONVERT(VARCHAR,SUM(INS_CHRG)) +'|'+CONVERT(VARCHAR,SUM(BROKERAGE+TURN_TAX+SEBI_TAX))   
+'|'+CONVERT(VARCHAR(20),CAST(SUM(CGST) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR(20),CAST(SUM(SGST) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR,SUM(TURN_TAX))  
+'|'+CONVERT(VARCHAR,SUM(SEBI_TAX))+'|'+CONVERT(VARCHAR,SUM(BROKER_CHRG))++'|'+CONVERT(VARCHAR,SUM(OTHER_CHRG))  
+'|'+CONVERT(VARCHAR(20),CAST(SUM(NETAMOUNT-(INS_CHRG+TURN_TAX+SEBI_TAX+CGST+SGST+BROKER_CHRG+IGST+UGST)) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR,SUM(BROKERAGE))   
+'|'+CONVERT(VARCHAR(20),CAST(SUM(IGST) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR(20),CAST(SUM(UGST) AS DECIMAL(18,2))),0,'','','',''  
FROM Contractnote_Daily WHERE SAUDA_DATE =@date   AND  PARTY_CODE >='a00' AND PARTY_CODE <='zzzzzz'  
GROUP BY  PARTY_CODE,EXCHANGE,SEGMENT     
*/   
INSERT INTO nse_bulk_process  
SELECT PARTY_CODE,'8' AS SNO,PARTY_CODE+'|'+'F'+'|'+EXCHANGE+'|'+SEGMENT+'|'+CONVERT(VARCHAR,SUM(NETAMOUNT)) +'|'+  
CONVERT(VARCHAR,SUM(INS_CHRG)) +'|'+CONVERT(VARCHAR(20),CAST(SUM(BROKERAGE+TURN_TAX+SEBI_TAX+IPFT_CHRG) AS DECIMAL(18,2)))  
+'|'+CONVERT(VARCHAR(20),CAST(SUM(CGST) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR(20),CAST(SUM(SGST) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR,SUM(TURN_TAX))  
+'|'+CONVERT(VARCHAR,SUM(SEBI_TAX))+'|'+CONVERT(VARCHAR,SUM(BROKER_CHRG))++'|'+CONVERT(VARCHAR,SUM(OTHER_CHRG))  
+'|'+CONVERT(VARCHAR(20),CAST(SUM(NETAMOUNT-(INS_CHRG+TURN_TAX+SEBI_TAX+CGST+SGST+BROKER_CHRG+IGST+UGST+OTHER_CHRG+IPFT_CHRG)) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR,SUM(BROKERAGE))   
+'|'+CONVERT(VARCHAR(20),CAST(SUM(IGST) AS DECIMAL(18,2)))+'|'+CONVERT(VARCHAR(20),CAST(SUM(UGST) AS DECIMAL(18,2)))  
+'|'+(case when MIN(CGST_PER) <>0 then 'CGST (@ '+ convert(varchar(10),MIN(CGST_PER))+'%)' ELSE 'NA' END)  
+'|'+(case when MIN(SGST_PER) <>0 then 'SGST (@ '+ convert(varchar(10),MIN(SGST_PER))+'%)' ELSE 'NA' END)  
+'|'+(case when MIN(IGST_PER) <>0 then 'IGST (@ '+ convert(varchar(10),MIN(IGST_PER))+'%)' ELSE 'NA' END)  
+'|'+(case when MIN(UGST_PER) <>0 then 'UGST (@ '+ convert(varchar(10),MIN(UGST_PER))+'%)' ELSE 'NA' END) 
+'|'+CONVERT(VARCHAR(20),CAST(SUM(IPFT_CHRG) AS DECIMAL(18,2)))
 ,0,'','','',''  
FROM Contractnote_Daily WHERE SAUDA_DATE =@date    AND  PARTY_CODE >= @CLTCODE AND PARTY_CODE <= @CLTCODE --and UGST <>0  
GROUP BY  PARTY_CODE,EXCHANGE,SEGMENT    
  
  
  
  
SELECT DISTINCT PARTY_CODE INTO #P FROM nse_bulk_process WHERE SNO=1  
  
 create index #v on #P  (party_code)  
  
  
delete FROM   nse_bulk_process WHERE     PARTY_CODE NOT IN (  
SELECT DISTINCT PARTY_CODE FROM #P )  
  
  
   
 select party_code into #party from nse_bulk_process where sno=1  
  
 create index #v on #party  (party_code)  
  
 DECLARE @SDATE DATETIME  
 SELECT @SDATE = sdtcur FROM ACCOUNT.DBO.parameter WHERE @dt BETWEEN sdtcur AND ldtcur   
  
   
  
  
 select cltcode,sum(case when drcr ='d' then -vamt else vamt end) as balance into #vdt  
 from account.dbo.ledger_all where vdt >=@SDATE and vdt <=@dt +' 23:59' and cltcode in (select * from #party)  
 group by cltcode  
    
  insert into #vdt  
   select cltcode,sum(case when drcr ='d' then -vamt else vamt end) as balance    
 from mtftrade.dbo.ledger where vdt >=@SDATE and vdt <=@dt +' 23:59' and cltcode in (select * from #party)  
 group by cltcode  
    
  select cltcode,sum(balance)  as balance into #final from #vdt  group by cltcode  
   create index #v on #final (cltcode)  
  
update n set Data_text=data_text+'|'+convert(varchar(30),balance)--+(case when balance >0 then ' (Cr.)' else ' (Dr.)' end)   
   from nse_bulk_process n,#final f where sno=1 and cltcode=party_code   
  
IF(@cnflag ='c')  
  
  BEGIN   
    INSERT INTO CASH_CN  
    SELECT party_code,PROCESS= GETDATE(),'CASH' AS EXCHANGE_TYPE FROM nse_bulk_process WHERE SNO=1  
  END  
  
SELECT B2C_SB INTO #BTWOB FROM [MIS].REMISIOR.DBO.B2C_SB WITH(NOLOCK)  
WHERE ISNULL(B2C_SB,'')  NOT IN ('AMRVT')  
  
update n set  Data_text=data_text+'|'+(case when B2C_SB is null then 'B2B' else 'B2C' end)   
from nse_bulk_process n,client_Details d  
 left outer join #BTWOB on B2C_SB=sub_broker  
 where n.party_code =d.cl_code and sno=1   
  
 
SELECT 'GENERATED'   
   
declare @NSEQUERY varchar(max)  
set @NSEQUERY = ' bcp " select Data_text'  
set @NSEQUERY = @NSEQUERY + ' from anand1.msajag.dbo.nse_bulk_process  order by party_code ,sno,SRNO,EXCHANGE,SEGMENT,SCRIP_CD,OD_TIME " queryout j:\Contract_Note\ContractNote_'+replace(convert(varchar,@dt,103),'/','')+'.txt -c -t"," -Sanand1 -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'  
set @NSEQUERY = '''' + @NSEQUERY + ''''  
set @NSEQUERY = 'EXEC MASTER.DBO.XP_CMDSHELL '+ @NSEQUERY  
--print @NSEQUERY   
exec (@NSEQUERY)    

 
SELECT 'GENERATED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.BANK_RECO_REPORT_ANG
-- --------------------------------------------------


CREATE PROC [dbo].[BANK_RECO_REPORT_ANG] (@FROMDATE DATETIME)                              
AS                              
                              
 --EXEC BANK_RECO_REPORT_ANG 'SEP 28 2022'                              
                              
                               
-- INSERT INTO  TABLE THE DATA OF FILES.                                    
        
DELETE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG_LOG WHERE RECODATE = @FROMDATE           
DELETE ACCOUNT.DBO.REC_BANK_RECO_ANG_ALL        
        
INSERT INTO ACCOUNT.DBO.BANK_RECO_BALANCE_ANG_LOG SELECT * FROM ACCOUNT.DBO.BANK_RECO_BALANCE_ANG         
        
CREATE TABLE [DBO].[#DATA]([FILEDATA] [VARCHAR](MAX))                                    
                                    
BULK INSERT [DBO].[#DATA] FROM 'J:\BACKOFFICE\EXPORT\COMB_RECO.CSV' WITH ( FIRSTROW = 2);                                    
                              
DELETE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG --WHERE RECODATE = @FROMDATE                                
                                    
INSERT INTO ACCOUNT.DBO.BANK_RECO_BALANCE_ANG (RECODATE ,SEGMENT,BANKCODE,BANKBAL)                              
SELECT CONVERT(VARCHAR(11), CONVERT(DATE, DBO.PIECE(FILEDATA,',',1), 103), 109), DBO.PIECE(FILEDATA,',',2)                              
, DBO.PIECE(FILEDATA,',',3), DBO.PIECE(FILEDATA,',',4)                              
FROM [#DATA]                                    
                            
DROP TABLE #DATA                            
                               
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET BOOKBAL = 0 , DIFFBAL = 0 , CRAMT = 0,DRAMT = 0,TOTDIFFBAL = 0 WHERE RECODATE = @FROMDATE                               
                              
DECLARE @STARTDATE DATETIME                              
                              
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                          
 INTO #BANK_RECO_MASTER_ANG FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'NSE'                              
                              
 SELECT @STARTDATE = SDTCUR  FROM ACCOUNT.DBO.PARAMETER WITH (NOLOCK)   WHERE @FROMDATE BETWEEN SDTCUR  AND LDTCUR                                 
                              
  /*            
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK), #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
      */        
               
SELECT B.SEGMENT,B.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0) INTO #CTE                          
 FROM ACCOUNT.DBO.LEDGER L WITH (NOLOCK) , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
 VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = B.BANKCODE                              
  GROUP BY B.SEGMENT,B.BANKCODE
     
	 /*
;WITH CTE AS (SELECT B.SEGMENT,B.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM LEDGER L WITH (NOLOCK) , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
 VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = B.BANKCODE                              
  GROUP BY B.SEGMENT,B.BANKCODE)              
  */            

 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                            
 #CTE A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                         
 DROP TABLE #CTE          
 
 --CREATE TABLE #LEDGER_BANK                                
 --(  BANKCODE VARCHAR(20),                              
 --VNO VARCHAR(12),                                
 --VTYP INT,                                
 --BOOKTYPE VARCHAR(3)                                
 -- )                                
                                
                                     
--WITH                                        
--    FILLFACTOR = 90                                        
--ON [PRIMARY]                                    
                                
                                 
  SELECT L.CLTCODE AS BANKCODE , VNO, VTYP, BOOKTYPE INTO #LEDGER_BANK   FROM ACCOUNT.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-92 AND @FROMDATE + ' 23:59:59' AND CLTCODE = A.BANKCODE       
  AND VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                                                 
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                            
                      
                                
                           
CREATE   CLUSTERED  INDEX [VNO] ON [DBO].[#LEDGER_BANK] ([VNO], [VTYP], [BOOKTYPE] ,BANKCODE )                                 
                              
                               
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  INTO #LED1                           
  FROM ACCOUNT.DBO.LEDGER1 L1 (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                           
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
           
                         
--UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM        ---// COMENTED ON 4 APR 2024 FOR TESTING
UPDATE A  SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM   ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A,     ---// ADDED ON 4 APR 2024 FOR TESTING
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 ACCOUNT.DBO.LEDGER L (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE  VDT BETWEEN @FROMDATE-92 AND @FROMDATE + ' 23:59:59' AND CLTCODE <> A.BANKCODE       AND                                   
 L.VTYP = L2.VTYP AND L.VTYP = L1.VTYP AND L.VNO= L2.VNO AND L.VNO = L1.VNO AND L.LNO = L1.LNO
 AND L.BOOKTYPE = L2.BOOKTYPE                                                     
  AND L.BOOKTYPE = L1.BOOKTYPE                                         
 AND  L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM ACCOUNT.DBO.LEDGER1 L3 (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)              
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO             
  AND L3.VTYP = L4.VTYP                           
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND ( (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE) )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
                        
            
 INSERT INTO  ACCOUNT.DBO.REC_BANK_RECO_ANG_ALL            
 SELECT   L.VDT,ISNULL(L1.DDNO,'') AS DDNO,A.BANKCODE,A.SEGMENT,CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END +    
 CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END     
  AS DRAMT,0  AS CRAMT ,RELDT,L1.REFNO,L.CLTCODE,L.VNO,L.VTYP   ,@FROMDATE                                       
FROM                                     
 ACCOUNT.DBO.LEDGER L (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE VDT BETWEEN @FROMDATE-92 AND @FROMDATE + ' 23:59:59' AND   CLTCODE <> A.BANKCODE       AND                                  
 L.VTYP = L2.VTYP AND L.VTYP = L1.VTYP AND L.VNO= L2.VNO AND L.VNO = L1.VNO AND L.LNO = L1.LNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
  AND L.BOOKTYPE = L1.BOOKTYPE                                        
 AND  L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM ACCOUNT.DBO.LEDGER1 L3 (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND ( (RELDT ='1900-01-01 00:00:00.000' OR RELDT >   @FROMDATE) )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE =  @FROMDATE             
                
                        
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  INTO #LEDGER_BANK_2  FROM ACCOUNT.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , ACCOUNT.DBO.LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'      AND CLTCODE = A.BANKCODE         
  AND  L.VTYP = L1.VTYP  AND L.VTYP IN (2,3) AND L.VNO = L1.VNO  AND L.BOOKTYPE = L1.BOOKTYPE          
  AND A.RECODATE = @FROMDATE                                           
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND ((RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59')  OR (RELDT  < @FROMDATE AND RELDT <> '1900-01-01 00:00:00.000'))                        
              
                      
                        
                           
CREATE   CLUSTERED  INDEX [VNO] ON [DBO].[#LEDGER_BANK_2] ([VNO], [VTYP], [BOOKTYPE] ,BANKCODE )                                 
                                        
                          
  SELECT  bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  INTO #LED1_2                             
  FROM ACCOUNT.DBO.LEDGER1 L1 (NOLOCK) 
  WHERE ((RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59')  OR (RELDT  < @FROMDATE AND RELDT <> '1900-01-01 00:00:00.000'))                                 
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      

                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 ACCOUNT.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                       
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                           
WHERE VDT BETWEEN @FROMDATE-92 AND @FROMDATE + ' 23:59:59' AND  CLTCODE <> A.BANKCODE       AND                                   
 L.VTYP = L2.VTYP AND L.VTYP = L1.VTYP AND L.VNO= L2.VNO AND L.VNO = L1.VNO AND L.LNO = L1.LNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND  L.BOOKTYPE = L1.BOOKTYPE                                         
 AND  L2.BANKCODE = A.BANKCODE                                   
 --AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'  
 AND ((RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59')  OR (RELDT  < @FROMDATE AND RELDT <> '1900-01-01 00:00:00.000'))
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
            
 INSERT INTO  ACCOUNT.DBO.REC_BANK_RECO_ANG_ALL            
SELECT  L.VDT,ISNULL(L1.DDNO,'') AS DDNO,A.BANKCODE,A.SEGMENT,        
 0 AS DRAMT,CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END +    
 CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END AS CRAMT,RELDT,L1.REFNO,L.CLTCODE,L.VNO,L.VTYP   ,@FROMDATE                                    
FROM                                     
 ACCOUNT.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                           
WHERE  VDT BETWEEN @FROMDATE-92 AND @FROMDATE + ' 23:59:59' AND     CLTCODE <> A.BANKCODE       AND                       
 L.VTYP = L2.VTYP AND L.VTYP = L1.VTYP AND L.VNO= L2.VNO AND L.VNO = L1.VNO AND L.LNO = L1.LNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND  L.BOOKTYPE = L1.BOOKTYPE                                         
 AND  L2.BANKCODE = A.BANKCODE                                   
 --AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'      
 AND ((RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59')  OR (RELDT  < @FROMDATE AND RELDT <> '1900-01-01 00:00:00.000'))
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                            
 AND VDT > @FROMDATE                
                               
                                 
                      
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                               
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK           
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                      
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                          
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'BSE'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelBSECM].ACCOUNT_AB.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                               
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelBSECM].ACCOUNT_AB.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                             
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                              
  INSERT INTO #LED1   
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelBSECM].ACCOUNT_AB.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelBSECM].ACCOUNT_AB.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                       
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelBSECM].ACCOUNT_AB.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                                
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                  
 AND A.SEGMENT = B.SEGMENT                              
                               
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelBSECM].ACCOUNT_AB.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
   INSERT INTO #LED1_2                      
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelBSECM].ACCOUNT_AB.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelBSECM].ACCOUNT_AB.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE            --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
                                 
                               
 UPDATE BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                                     
                               
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                      
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                           
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'NSEFO'                              
                  
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelFO].ACCOUNTFO.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                              
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DIFFBAL = BANKBAL - BOOKBAL  FROM  #BANK_RECO_MASTER_ANG WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelFO].ACCOUNTFO.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'               
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                              
  INSERT INTO #LED1                               
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelFO].ACCOUNTFO.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelFO].ACCOUNTFO.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                           
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelFO].ACCOUNTFO.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                        
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                                
                              
                         
                         
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelFO].ACCOUNTFO.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT           
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
  INSERT INTO #LED1_2                             
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelFO].ACCOUNTFO.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                
FROM                                     
 [AngelFO].ACCOUNTFO.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                       
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
                                   
                      
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                      
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                          
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'NSECD'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelFO].ACCOUNTCURFO.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                              
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelFO].ACCOUNTCURFO.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                             
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
            
  INSERT INTO #LED1                                  
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelFO].ACCOUNTCURFO.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                            
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelFO].ACCOUNTCURFO.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                              
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelFO].ACCOUNTCURFO.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                 
                              
                        
                         
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelFO].ACCOUNTCURFO.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
  INSERT INTO #LED1_2                             
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                       
  FROM [AngelFO].ACCOUNTCURFO.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelFO].ACCOUNTCURFO.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                             
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                    WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                          
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                          
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                        
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                      
                                INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                           
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'MCX'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                             
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                                 
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                             
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                
  INSERT INTO #LED1                                 
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                      AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                                
                      
                       
                         
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                        
  INSERT INTO #LED1_2                             
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,               
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                          
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                   
                               
                       
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                           
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                           
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'NCDX'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                 
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT          
                                
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)           
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                                 
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                              
  INSERT INTO #LED1                                 
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                               
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                    
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE    
 AND A.SEGMENT = B.SEGMENT                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                                
                        
                      
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
   INSERT INTO #LED1_2                             
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                   
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                 
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                        
 AND A.SEGMENT = B.SEGMENT                          
                      
                               
 UPDATE BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                        
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                      
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                           
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'BSEFO'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelCommodity].ACCOUNTBFO.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                              
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelCommodity].ACCOUNTBFO.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                             
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                              
  INSERT INTO #LED1                          
  SELECT  bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                
  FROM [AngelCommodity].ACCOUNTBFO.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                   
 [AngelCommodity].ACCOUNTBFO.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelCommodity].ACCOUNTBFO.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                                
                              
                       
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelCommodity].ACCOUNTBFO.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , ACCOUNT.DBO.LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
   INSERT INTO #LED1_2                            
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTBFO.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTBFO.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                      
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                           
                       
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT               
                       
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                          
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                           
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'MCXCD'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                            
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                                
                              
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                             
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                              
  INSERT INTO #LED1                                 
  SELECT  bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                             
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER L WITH (NOLOCK),               
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                                    
  (SELECT L3.DDNO FROM [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                             
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                        
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                       
 AND A.SEGMENT = B.SEGMENT                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                                
                              
                          
                       
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
  INSERT INTO #LED1_2                             
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2 , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                           
                       
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                        
 TRUNCATE TABLE  #BANK_RECO_MASTER_ANG                              
 TRUNCATE TABLE  #LEDGER_BANK                      
 TRUNCATE TABLE  #LEDGER_BANK_2                      
 TRUNCATE TABLE  #LED1                      
 TRUNCATE TABLE  #LED1_2                           
                               
 INSERT  INTO #BANK_RECO_MASTER_ANG                               
 SELECT [BANK NAME],[Details],[BANKCODE],[TYPE OF ACCOUNT],[SEGMENT],[NAME],[BANK STATEMENT BALANCE]                           
 FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE SEGMENT  = 'BSE Curr'                              
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET  BOOKBAL = A.BOOKBAL FROM                              
 (SELECT A.RECODATE, A.SEGMENT,A.BANKCODE,BOOKBAL = ISNULL(SUM(CASE DRCR WHEN 'D' THEN ISNULL(VAMT,0) ELSE ISNULL(-VAMT,0) END),0)                               
 FROM [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER L WITH (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
 #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE                                 
    VDT >= @STARTDATE                                 
    AND VDT <= @FROMDATE + ' 23:59:59'                                
    AND CLTCODE = A.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                              
 AND A.RECODATE = @FROMDATE GROUP BY A.RECODATE, A.SEGMENT,A.BANKCODE) A , #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
 WHERE BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                              
 AND A.RECODATE = BANK_RECO_BALANCE_ANG.RECODATE                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT   = B.SEGMENT                               
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE = A.BANKCODE                               
 AND A.BANKCODE = B.BANKCODE                              
 AND A.SEGMENT = B.SEGMENT                               
                              
                               
  INSERT INTO #LEDGER_BANK                                
  SELECT A.BANKCODE, VNO, VTYP, BOOKTYPE FROM [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER L WITH (NOLOCK) ,                               
  ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
  WHERE VDT BETWEEN @FROMDATE-7 AND @FROMDATE + ' 23:59:59'   AND VTYP <> '18'                             
  AND A.RECODATE = @FROMDATE                              
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                               
                              
  INSERT INTO #LED1                                 
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER1 L1 WITH (NOLOCK) WHERE (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )                                    
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                                
                              
                                
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = A.DRAMT  , CRAMT = A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT ELSE 0 END )                                     
FROM           
 [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER L WITH (NOLOCK),                                     
 #LED1 L1 ,                                                    
 #LEDGER_BANK L2       , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                              
 AND NOT EXISTS                    
  (SELECT L3.DDNO FROM [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER1 L3 WITH (NOLOCK), (SELECT VNO, VTYP, BOOKTYPE FROM #LEDGER_BANK WHERE VTYP = 16) L4                                    
  WHERE L1.DDNO = L3.DDNO                                 
  AND CONVERT(VARCHAR(11),L1.DDDT,109) = CONVERT(VARCHAR(11),L3.DDDT,109)                                 
  AND L1.RELAMT = L3.RELAMT                                 
  AND L1.BNKNAME = L3.BNKNAME                                
  AND L1.BOOKTYPE = L3.BOOKTYPE                                   
  AND L3.VNO = L4.VNO                                 
  AND L3.VTYP = L4.VTYP                                 
  AND L3.BOOKTYPE = L4.BOOKTYPE AND L1.CLEAR_MODE = 'C'                                
  )                                   
 AND (RELDT ='1900-01-01 00:00:00.000' OR RELDT >  @FROMDATE )  AND L1.VTYP <> 16                                
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT               
 AND A.RECODATE = @FROMDATE                              
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                               
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                              
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                               
                       
                       
  INSERT INTO #LEDGER_BANK_2                      
  SELECT L.CLTCODE AS BANKCODE , L.VNO, L.VTYP, L.BOOKTYPE                       
  FROM [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER L (NOLOCK) , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)        , LEDGER1 L1 (NOLOCK)                      
  WHERE VDT BETWEEN @FROMDATE+1 AND @FROMDATE+3 AND L.VTYP <> '18'                              
  AND A.RECODATE = @FROMDATE                      
  AND CLTCODE = A.BANKCODE                              
  AND A.SEGMENT = B.SEGMENT                              
  AND A.BANKCODE = B.BANKCODE                      
  AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                      
  AND L.VNO = L1.VNO AND  L.VTYP = L1.VTYP  AND L.BOOKTYPE = L1.BOOKTYPE                      
  AND L.VTYP IN (2,3)                      
                            
  INSERT INTO #LED1_2               
  SELECT bnkname,brnname,dd,ddno,dddt,reldt,relamt,refno,receiptno,vtyp,vno,lno,drcr,BookType,MicrNo,SlipNo,slipdate,ChequeInName,Chqprinted,clear_mode                      
  FROM [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER1 L1 (NOLOCK) WHERE RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                   
  AND EXISTS(SELECT VNO FROM #LEDGER_BANK_2 LL WHERE L1.VNO = LL.VNO AND L1.VTYP = LL.VTYP AND L1.BOOKTYPE = LL.BOOKTYPE)                          
                      
                           
UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET DRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.DRAMT + A.DRAMT  ,                       
CRAMT = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.CRAMT + A.CRAMT FROM                              
 ( SELECT  A.SEGMENT,A.BANKCODE,DRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'C' THEN RELAMT  ELSE 0 END ),                                                    
 CRAMT= SUM(CASE WHEN UPPER(L.DRCR) = 'D' THEN RELAMT ELSE 0 END )                                     
FROM                                     
 [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER L (NOLOCK),                                     
 #LED1_2 L1 ,                                                    
 #LEDGER_BANK_2 L2   , ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A WITH (NOLOCK),                               
  #BANK_RECO_MASTER_ANG B WITH (NOLOCK)                              
WHERE                                     
 L.VTYP = L2.VTYP AND L.VNO= L2.VNO AND L.BOOKTYPE = L2.BOOKTYPE                                                     
 AND L.VTYP = L1.VTYP AND L.BOOKTYPE = L1.BOOKTYPE AND L.VNO = L1.VNO AND L.LNO = L1.LNO                                        
 AND CLTCODE <> A.BANKCODE       AND L2.BANKCODE = A.BANKCODE                                   
 AND RELDT BETWEEN @FROMDATE AND @FROMDATE + ' 23:59'                                     
 AND A.BANKCODE = B.BANKCODE AND A.SEGMENT = B.SEGMENT                              
 AND A.RECODATE = @FROMDATE                              
 AND VDT > @FROMDATE                      
 GROUP BY  A.SEGMENT,A.BANKCODE                              
  --AND L.VNO IN ('202104268075', '202104289454') AND L.VTYP=3 AND L.BOOKTYPE='01'                                 
   ) A   , #BANK_RECO_MASTER_ANG B WITH (NOLOCK) WHERE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.RECODATE = @FROMDATE                               
 AND A.BANKCODE = ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.BANKCODE                  
 AND ACCOUNT.DBO.BANK_RECO_BALANCE_ANG.SEGMENT = B.SEGMENT                              
 AND A.BANKCODE = B.BANKCODE                               
 AND A.SEGMENT = B.SEGMENT                           
                       
                               
 UPDATE ACCOUNT.DBO.BANK_RECO_BALANCE_ANG SET TOTDIFFBAL = ABS((BANKBAL - BOOKBAL) - (DRAMT - CRAMT)) ,DIFFBAL = ABS(BANKBAL - BOOKBAL)                                
 FROM  #BANK_RECO_MASTER_ANG  WHERE RECODATE = @FROMDATE                              
 AND BANK_RECO_BALANCE_ANG.BANKCODE = #BANK_RECO_MASTER_ANG.BANKCODE AND BANK_RECO_BALANCE_ANG.SEGMENT = #BANK_RECO_MASTER_ANG.SEGMENT                              
                               
                                
                              
 SELECT B.SRNO,[BANK NAME],[Details],B.BANKCODE,[TYPE OF ACCOUNT],B.SEGMENT,[NAME] ,                              
 A.BANKBAL AS [BANK STATEMENT BALANCE] , A.BOOKBAL AS [BANK BOOK BALANCE], A.CRAMT AS [CHQ. DEPOSITED BUT NOT CREDITED] ,                              
 A.DRAMT AS [CHQ. ISSUED BUT NOT DEBITED],TOTDIFFBAL AS DIFF , [TALLY/ UNTALLY] = CASE WHEN TOTDIFFBAL = 0 THEN 'TALLY' ELSE 'UNTALLY' END,                              
 REMARKS = ''          INTO #FINAL                    
 FROM ACCOUNT.DBO.BANK_RECO_BALANCE_ANG A,                               
 ACCOUNT.DBO.BANK_RECO_MASTER_ANG  B WHERE RECODATE = @FROMDATE  AND                               
 A.SEGMENT = B.SEGMENT AND A.BANKCODE  = B.BANKCODE                               
 AND B.SEGMENT NOT IN ('BSEMFSS','NSEMFSS')                              
             
 INSERT INTO #FINAL                    
 SELECT  SRNO,[BANK NAME],[Details],BANKCODE,[TYPE OF ACCOUNT],SEGMENT,[NAME] ,                              
 0 AS [BANK STATEMENT BALANCE] , 0 AS [BANK BOOK BALANCE], 0 AS [CHQ. DEPOSITED BUT NOT CREDITED] ,                              
 0 AS [CHQ. ISSUED BUT NOT DEBITED],0 AS DIFF , [TALLY/ UNTALLY] = 'TALLY',                              
 REMARKS = ''  FROM ACCOUNT.DBO.BANK_RECO_MASTER_ANG WHERE SRNO NOT IN (SELECT SRNO FROM #FINAL)                    
                    
 SELECT * FROM #FINAL ORDER BY SRNO                  
                    
 DROP TABLE #LED1                              
 DROP TABLE #LED1_2                           
 DROP TABLE #BANK_RECO_MASTER_ANG                              
 DROP TABLE #LEDGER_BANK                      
 DROP TABLE #LEDGER_BANK_2                    
 DROP TABLE #FINAL

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CL_BAL
-- --------------------------------------------------
  
--CL_BAL '2021-04-01','2022-03-31','RP61'  
CREATE PROCEDURE [DBO].[CL_BAL] (@FINSTDT VARCHAR(20),@FROMDATE VARCHAR(20),@CLCODE VARCHAR(11))  
  
AS --- EXEC RPT_TB_VDT 'DEC 31 2021'  
  
--DECLARE @FINSTDT DATETIME   
  
--SELECT @FINSTDT = SDTCUR FROM PARAMETER WHERE @FROMDATE BETWEEN SDTCUR AND LDTCUR  
  
      
----NSEBLBS      
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)  INTO #SLBS FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)    
FROM   ACCOUNTSLBS..LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT  AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE  GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
   
      
------------MTF      
      
      
      
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)   INTO #MTF FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)    
FROM   MTFTRADE.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT  AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
      
------------NSE      
      
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)  INTO #NSE FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)  FROM  ACCOUNT.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
      
      
 ------------BSE      
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)  INTO #BSE FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)  FROM   ANGELBSECM.ACCOUNT_AB.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
    
      
 ------------NSEFO      
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)  INTO #NSEFO FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)   FROM  ANGELFO.ACCOUNTFO.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59'  AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
    
      
  ------------NSX      
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)INTO #NSX FROM (      
  
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)   FROM  ANGELFO.ACCOUNTCURFO.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
   
      
      
  ------------MCD       
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL) INTO #MCD FROM (      
  
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)   FROM   ANGELCOMMODITY.ACCOUNTMCDXCDS.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
   
  ------------MCX       
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)  INTO #MCX FROM (      
 SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)   FROM   ANGELCOMMODITY.ACCOUNTMCDX.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
     
   ------------NCX       
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL) INTO #NCX FROM (     
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)   FROM   ANGELCOMMODITY.ACCOUNTNCDX.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59'  AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
   
    ------------BSEFO       
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL)  INTO #BSEFO FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)  FROM  ANGELCOMMODITY.ACCOUNTBFO.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
     
      
      
     ------------BSX       
SELECT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL) INTO #BSX FROM (      
SELECT CLTCODE,OP_BAL =SUM(CASE WHEN VTYP=18 Then (Case when DRCR ='D' THEN VAMT ELSE VAMT*-1 END) ELSE 0 END),  
CLOSE_BAL=SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)  FROM  ANGELCOMMODITY.ACCOUNTCURBFO.DBO.LEDGER WITH(NOLOCK)      
WHERE      
VDT>=@FINSTDT AND      
 VDT<=@FROMDATE  + ' 23:59' AND CLTCODE=@CLCODE GROUP BY CLTCODE)A      
 GROUP BY CLTCODE      
   
     
      
   
      
     
SELECT DISTINCT CLTCODE,OP_BAL=SUM(OP_BAL),CLOSE_BAL=SUM(CLOSE_BAL) ,FROM_DATE=@FINSTDT,TO_DATE= @FROMDATE FROM (      
SELECT *   FROM #NSE     
UNION ALL      
SELECT *   FROM #BSE     
UNION ALL      
SELECT * FROM #NSEFO      
UNION ALL      
SELECT *   FROM #NSX      
UNION ALL      
SELECT *   FROM #MCD      
UNION ALL      
SELECT *   FROM #MCX      
UNION ALL      
SELECT *  FROM #NCX      
UNION ALL      
SELECT *   FROM #BSEFO      
UNION ALL      
SELECT *   FROM #BSX      
UNION ALL      
SELECT *   FROM #MTF      
UNION ALL      
SELECT *   FROM #SLBS      
 )A      
 GROUP BY CLTCODE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CLI_BROK_SEG_CHECK
-- --------------------------------------------------
  

CREATE PROC CLI_BROK_SEG_CHECK (@CL_CODE VARCHAR(10))
AS
 
CREATE TABLE #CL_CODE (CL_CODE VARCHAR(10),EXCHANGE VARCHAR(10),SEGMENT VARCHAR(10),ACC_OPENDATE DATETIME,PLAN_NAME VARCHAR(11),LOADER_STATUS VARCHAR(1))

INSERT INTO #CL_CODE 
SELECT CL_CODE,EXCHANGE,SEGMENT,ACTIVE_DATE,'' ,IMP_STATUS FROM MSAJAG.DBO.CLIENT_BROK_DETAILS WITH(NOLOCK)  WHERE CL_CODE =@CL_CODE AND SEGMENT <>'SLBS'
 
 
SELECT * INTO #CL_BROK FROM (
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='NSE',SEGMENT ='CAPITAL' FROM MSAJAG.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID      AND EXCHANGE='NSE'AND SEGMENT ='CAPITAL'
UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN  ,EXCHANGE='BSE',SEGMENT ='CAPITAL'  FROM ANGELBSECM.BSEDB_AB.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID      AND EXCHANGE='BSE'AND SEGMENT ='CAPITAL'
UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN  ,EXCHANGE='NSE',SEGMENT ='FUTURES' FROM ANGELFO.NSEFO.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID     AND EXCHANGE='NSE'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='NSX',SEGMENT ='FUTURES' FROM ANGELFO.NSECURFO.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID   AND EXCHANGE='NSX'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='MCX',SEGMENT ='FUTURES' FROM ANGELCOMMODITY.MCDX.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID   AND EXCHANGE='MCX'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='NCX',SEGMENT ='FUTURES' FROM ANGELCOMMODITY.NCDX.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID   AND EXCHANGE='NCX'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='MCD',SEGMENT ='FUTURES' FROM ANGELCOMMODITY.MCDXCDS.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID   AND EXCHANGE='MCD'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='BSE',SEGMENT ='FUTURES' FROM ANGELCOMMODITY.BSEFO.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID  AND EXCHANGE='BSE'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='BSX',SEGMENT ='FUTURES' FROM ANGELCOMMODITY.BSECURFO.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID   AND EXCHANGE='BSX'AND SEGMENT ='FUTURES'
 UNION ALL
SELECT DISTINCT SP_PARTY_CODE CL_CODE,SCHEME_NAME AS BROK_PLAN ,EXCHANGE='NCE',SEGMENT ='FUTURES' FROM ANGELCOMMODITY.NCE.DBO.SCHEME_MAPPING S WITH(NOLOCK) ,MSAJAG.DBO.MAPPING_TABLE M    
WHERE SP_PARTY_CODE =@CL_CODE AND SP_DATE_TO >GETDATE() AND SP_COMPUTATION_LEVEL ='O'    
AND TRD_SCHEME_ID = SP_SCHEME_ID  AND EXCHANGE='NCE'AND SEGMENT ='FUTURES' )A



SELECT C.CL_CODE	,C.EXCHANGE	,C.SEGMENT,	ACC_OPENDATE,	PLAN_NAME=isnull(BROK_PLAN,'CUSTOM'),	LOADER_STATUS=(CASE WHEN LOADER_STATUS=1 THEN 'C' ELSE 'P' END) 
 FROM #CL_CODE C
LEFT OUTER JOIN 
#CL_BROK B ON  C.CL_CODE =B.CL_CODE AND C.EXCHANGE =B.EXCHANGE AND C.SEGMENT=B.SEGMENT

Drop table #CL_CODE
Drop table #CL_BROK

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CONTROL_ACC_ANG_BKP_03APR24_SRE24407
-- --------------------------------------------------


CREATE PROC [dbo].[CONTROL_ACC_ANG_BKP_03APR24_SRE24407](@FROMDATE VARCHAR(11) )      
      
AS      
      
-- EXEC CONTROL_ACC_ANG 'APR  4 2022'      
      
DECLARE @FINSTDT DATETIME       
      
SELECT @FINSTDT = SDTCUR FROM PARAMETER WITH (NOLOCK) WHERE @FROMDATE BETWEEN SDTCUR AND LDTCUR      
      
SELECT DISTINCT SCLTCODE AS PARTY_CODE INTO #CLOSE FROM CONTROLACC_ANG       
      
INSERT INTO #CLOSE      
SELECT DISTINCT TCLTCODE AS PARTY_CODE  FROM CONTROLACC_ANG  WHERE TCLTCODE NOT IN (SELECT PARTY_CODE FROM #CLOSE)      
      
          
----NSEBLBS          
SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'SLBS' INTO #VDTBAL FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   ACCOUNTSLBS..LEDGER WITH(NOLOCK)    ,#CLOSE      
WHERE          
VDT>=@FINSTDT  AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
 HAVING SUM(VAMT) <>0      
          
------------MTF          
UNION ALL          
          
          
SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'MTF' FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   MTFTRADE..LEDGER WITH(NOLOCK)  ,  #CLOSE      
WHERE          
VDT>=@FINSTDT  AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
  HAVING SUM(VAMT) <>0         
------------NSE          
 UNION ALL          
       
SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'NSE' FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   LEDGER WITH(NOLOCK)     ,  #CLOSE      
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
  HAVING SUM(VAMT) <>0         
      
  UNION ALL            
 ------------BSE          
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'BSE' FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelBSECM].ACCOUNT_AB.DBO.LEDGER WITH(NOLOCK)    ,  #CLOSE       
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
  HAVING SUM(VAMT) <>0         
      
  UNION ALL            
 ------------NSEFO          
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'FO'  FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelFO].ACCOUNTFO.DBO.LEDGER WITH(NOLOCK)   ,  #CLOSE        
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE  GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
  HAVING SUM(VAMT) <>0         
      
      
 UNION ALL             
  ------------NSX          
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'NSE CURRENCY' FROM (          
      
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelFO].ACCOUNTCURFO.DBO.LEDGER WITH(NOLOCK)     ,  #CLOSE      
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
   HAVING SUM(VAMT) <>0        
         
   UNION ALL          
          
  ------------MCD           
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT ,EXCH = 'MCX CURRENCY'  FROM (          
      
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelCommodity].ACCOUNTMCDXCDS.DBO.LEDGER WITH(NOLOCK)    ,  #CLOSE       
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
  HAVING SUM(VAMT) <>0         
  ------------MCX           
      
  UNION ALL         
 SELECT OCLTCODE,CLTCODE,ROUND(SUM(VAMT),2,-1) AS VAMT ,EXCH = 'MCX'  FROM (          
       
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelCommodity].ACCOUNTMCDX.DBO.LEDGER WITH(NOLOCK)    ,  #CLOSE       
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
   HAVING SUM(VAMT) <>0        
   ------------NCX           
      
   UNION ALL          
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT,EXCH = 'NCDEX'  FROM (          
      
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelCommodity].ACCOUNTNCDX.DBO.LEDGER WITH(NOLOCK)   ,  #CLOSE        
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
   HAVING SUM(VAMT) <>0        
   UNION ALL          
    ------------BSEFO           
      
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT,EXCH = 'BSEFO'  FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT FROM   [AngelCommodity].ACCOUNTBFO.DBO.LEDGER WITH(NOLOCK)     ,  #CLOSE      
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
  HAVING SUM(VAMT) <>0         
          
    UNION ALL          
     ------------BSX           
 SELECT OCLTCODE,CLTCODE,SUM(VAMT)AS VAMT,EXCH = 'BSX'  FROM (          
SELECT PARTY_CODE AS OCLTCODE,CLTCODE,SUM(CASE WHEN DRCR='D'THEN VAMT ELSE -VAMT END)VAMT       
FROM   [AngelCommodity].ACCOUNTCURBFO.DBO.LEDGER WITH(NOLOCK)     ,  #CLOSE      
WHERE          
VDT>=@FINSTDT AND          
 VDT<=@FROMDATE  + ' 23:59:59' AND CLTCODE = PARTY_CODE GROUP BY PARTY_CODE,CLTCODE)A          
 GROUP BY OCLTCODE,CLTCODE          
   HAVING SUM(VAMT) <>0        
      
   -------------------MFSS--------      
      
         
    UNION ALL       
      
SELECT CLTCODE AS OCLTCODE,CLTCODE,OPPBAL=SUM(DRAMOUNT+CRAMOUNT)*-1,EXCHANGE='BSE MFSS CONTROL A/C' FROM (      
SELECT B.CLTCODE,EXCHANGE,A.VTYPE,A.VNO,B.EDT,DRAMOUNT=(-B.DRAMOUNT),B.CRAMOUNT      
FROM ANGELFO.BBO_FA.DBO.ACC_TBL1 A (NOLOCK), ANGELFO.BBO_FA.DBO.ACC_TBL2 B (NOLOCK)  ,  #CLOSE      
WHERE A.SNO = B.MASTERSNO  AND CONVERT(DATETIME,CONVERT(VARCHAR(11),VDT)) BETWEEN @FINSTDT AND @FROMDATE + ' 23:59:59' AND      
EXCHANGE = 'BSE' AND SEGMENT = 'MFSS' AND B.CLTCODE = PARTY_CODE  ) B       
GROUP BY CLTCODE      
      
      
    UNION ALL       
      
SELECT CLTCODE AS OCLTCODE,CLTCODE,OPPBAL=SUM(DRAMOUNT+CRAMOUNT)*-1,EXCHANGE='NSE MFSS CONTROL A/C' FROM (      
SELECT B.CLTCODE,EXCHANGE,A.VTYPE,A.VNO,B.EDT,DRAMOUNT=(-B.DRAMOUNT),B.CRAMOUNT      
FROM ANGELFO.BBO_FA.DBO.ACC_TBL1 A (NOLOCK), ANGELFO.BBO_FA.DBO.ACC_TBL2 B (NOLOCK) ,  #CLOSE      
WHERE A.SNO = B.MASTERSNO  AND CONVERT(DATETIME,CONVERT(VARCHAR(11),VDT)) BETWEEN @FINSTDT AND @FROMDATE + ' 23:59:59' AND      
EXCHANGE = 'NSE' AND SEGMENT = 'MFSS' AND B.CLTCODE = PARTY_CODE  ) B       
GROUP BY CLTCODE      
      
SELECT * INTO #CONTROLACC_ANG FROM CONTROLACC_ANG      
      
      
ALTER TABLE #CONTROLACC_ANG ADD SRNO INT IDENTITY (1,1)      
ALTER TABLE #CONTROLACC_ANG ADD SAMOUNT NUMERIC(18,2)      
ALTER TABLE #CONTROLACC_ANG ADD TAMOUNT NUMERIC(18,2)      
ALTER TABLE #CONTROLACC_ANG ADD DIFFAMOUNT NUMERIC(18,2)      
      
UPDATE #CONTROLACC_ANG SET SAMOUNT = 0 , TAMOUNT = 0 , DIFFAMOUNT = 0      
       
UPDATE #CONTROLACC_ANG SET SAMOUNT = VAMT FROM #VDTBAL WHERE SSEGMENT = EXCH AND SCLTCODE = CLTCODE       
UPDATE #CONTROLACC_ANG SET TAMOUNT = VAMT FROM #VDTBAL WHERE TSEGMENT = EXCH AND TCLTCODE = CLTCODE       
      
UPDATE #CONTROLACC_ANG SET DIFFAMOUNT = SAMOUNT + TAMOUNT      
      
SELECT SRNO,@FROMDATE AS [DATE],SCLTCODE,SSEGMENT,SAMOUNT,TCLTCODE,TSEGMENT,TAMOUNT,DIFFAMOUNT FROM #CONTROLACC_ANG ORDER BY SRNO ASC      
        
    
DROP TABLE #CONTROLACC_ANG      
DROP TABLE #VDTBAL      
DROP TABLE #CLOSE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DEBIT_BILL_DATA
-- --------------------------------------------------


--DROP TABLE #TBL
--DROP TABLE #TBLMAIN
  
CREATE Proc DEBIT_BILL_DATA ( @FILTER INT)
  
AS  
  --DECLARE @FILTER INT='1'
BEGIN  
  
DECLARE @DT DATE=GETDATE()-@FILTER

CREATE TABLE #TBL  
(CL_CODE VARCHAR(15),  
 BILL_AMT MONEY ,  
 EXCHANGE VARCHAR(15))  
   
 CREATE NONCLUSTERED INDEX #T ON #TBL  
 (CL_CODE ASC,EXCHANGE ASC)  
  
   
 INSERT INTO #TBL  
 SELECT CLTCODE, SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'NSE'   
 FROM ACCOUNT.DBO.LEDGER WITH(NOLOCK) where Vtyp='15'  and Convert(date,EDT) >=GETDATE()-@FILTER  
 and cltcode IN ('A1177466')   
 GROUP BY CLTCODE,ACNAME,VAMT  
   
  INSERT INTO #TBL  
 SELECT CLTCODE, SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'BSE'   
 FROM [ANAND].ACCOUNT_AB.DBO.LEDGER WITH(NOLOCK) where Vtyp='15'  and Convert(date,EDT) >=GETDATE()-@FILTER 
 and cltcode IN ('A1177466')   
 GROUP BY CLTCODE,ACNAME,VAMT  
   
  INSERT INTO #TBL  
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'NSEFO'   
 FROM [ANGELFO].ACCOUNTFO.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and Convert(date,EDT) >=GETDATE()-@FILTER  
  and cltcode IN ('A1177466')   
 GROUP BY CLTCODE,ACNAME  
   
  INSERT INTO #TBL  
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END)  ,'NSECURFO'   
 FROM [ANGELFO].ACCOUNTCURFO.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and Convert(date,EDT) >=GETDATE()-@FILTER  
  and cltcode IN ('A1177466')   
 GROUP BY CLTCODE,ACNAME  
   
   INSERT INTO #TBL  
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'MCDX'   
 FROM [ANGELCOMMODITY].ACCOUNTMCDX.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and Convert(date,EDT) >=GETDATE()-@FILTER  
  and cltcode IN ('A1177466')   
 GROUP BY CLTCODE,ACNAME  
   
    INSERT INTO #TBL  
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END)  ,'NCDX'  
 FROM [ANGELCOMMODITY].ACCOUNTNCDX.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and Convert(date,EDT) >=GETDATE()-@FILTER  
  and cltcode IN ('A1177466')   
 GROUP BY CLTCODE,ACNAME  
  
  
CREATE TABLE #TBLMAIN  
(CL_CODE VARCHAR(15),  
NSE_BAL MONEY,  
BSE_BAL MONEY,  
NSEFO_BAL MONEY,  
NSECURFO_BAL MONEY,  
MCX_BAL MONEY,  
NCDX_BAL MONEY,  
TOTAL_BAL MONEY  
 )    
  
  
 CREATE NONCLUSTERED INDEX #TQ ON #TBLMAIN  
 (CL_CODE ASC)  
  
  
INSERT INTO  #TBLMAIN  
SELECT DISTINCT CL_CODE,'0','0','0','0','0','0', '0' FROM #TBL  
  
 UPDATE  #TBLMAIN SET NSE_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NSE' AND #TBLMAIN.CL_CODE=#TBL.CL_CODE    
 UPDATE  #TBLMAIN SET BSE_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='BSE'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE  
 UPDATE  #TBLMAIN SET NSEFO_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NSEFO'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE  
  UPDATE #TBLMAIN SET NSECURFO_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NSECURFO'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE  
 UPDATE  #TBLMAIN SET MCX_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='MCX'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE  
 UPDATE  #TBLMAIN SET NCDX_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NCDX'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE  
 UPDATE  #TBLMAIN SET TOTAL_BAL =  NSE_BAL+BSE_BAL+NSEFO_BAL+NSECURFO_BAL+MCX_BAL+NCDX_BAL  
 

  
  SELECT @DT AS 'BILL_DATE',* INTO #FINALDATA FROM #TBLMAIN where TOTAL_BAL >='1'  

  SELECT * FROM #FINALDATA ORDER BY CL_CODE
  
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DEBIT_BILL_DATA_NEW
-- --------------------------------------------------

--  DROP TABLE #TBL    
--DROP TABLE #TBLMAIN    
--DROP TABLE #FINALDATA         
  
      
CREATE Proc [dbo].[DEBIT_BILL_DATA_NEW] ( @FILTER INT)    
      
AS      
  --DECLARE @FILTER INT='1'    
BEGIN      
      
DECLARE @DT DATE=GETDATE()-@FILTER    
    
CREATE TABLE #TBL      
(CL_CODE VARCHAR(15),      
 BILL_AMT MONEY ,      
 EXCHANGE VARCHAR(15))      
       
 CREATE NONCLUSTERED INDEX #T ON #TBL      
 (CL_CODE ASC,EXCHANGE ASC)      
      
       
 INSERT INTO #TBL      
 SELECT CLTCODE, SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END),'NSE'       
 FROM ACCOUNT.DBO.LEDGER WITH(NOLOCK) where Vtyp='15'  and CONVERT(DATE,VDT) =CONVERT(DATE,Getdate()-@FILTER)
 --and cltcode IN ('CNBC2072','S1538575') 
 and cltcode >='A00000000' and Cltcode <='ZZZZZZZZZZ'  
 GROUP BY CLTCODE
       
  INSERT INTO #TBL      
 SELECT CLTCODE, SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'BSE'       
 FROM [ANAND].ACCOUNT_AB.DBO.LEDGER WITH(NOLOCK) where Vtyp='15'  and CONVERT(DATE,VDT) =CONVERT(DATE,Getdate()-@FILTER)   
 --and cltcode IN ('CNBC2072')   
 and cltcode >='A00000000' and Cltcode <='ZZZZZZZZZZ'  
 GROUP BY CLTCODE
       
  INSERT INTO #TBL      
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'NSEFO'       
 FROM [ANGELFO].ACCOUNTFO.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and CONVERT(DATE,VDT) =CONVERT(DATE,Getdate()-@FILTER)  
  --and cltcode IN ('CNBC2072')   
 and cltcode >='A00000000' and Cltcode <='ZZZZZZZZZZ'        
 GROUP BY CLTCODE
       
  INSERT INTO #TBL      
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END)  ,'NSECURFO'       
 FROM [ANGELFO].ACCOUNTCURFO.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and CONVERT(DATE,VDT) =CONVERT(DATE,Getdate()-@FILTER)   
  --and cltcode IN ('CNBC2072')   
 and cltcode >='A00000000' and Cltcode <='ZZZZZZZZZZ'  
 GROUP BY CLTCODE
       
   INSERT INTO #TBL      
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END) ,'MCDX'       
 FROM [ANGELCOMMODITY].ACCOUNTMCDX.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and CONVERT(DATE,VDT) =CONVERT(DATE,Getdate()-@FILTER) 
 --and cltcode IN ('CNBC2072')   
 and cltcode >='A00000000' and Cltcode <='ZZZZZZZZZZ'  
 GROUP BY CLTCODE
       
    INSERT INTO #TBL      
 SELECT  CLTCODE,SUM(CASE WHEN DRCR ='C' THEN VAMT*-1 ELSE VAMT END)  ,'NCDX'      
 FROM [ANGELCOMMODITY].ACCOUNTNCDX.DBO.LEDGER WITH(NOLOCK) WHERE Vtyp='15'  and CONVERT(DATE,VDT) =CONVERT(DATE,Getdate()-@FILTER)
  --and cltcode IN ('CNBC2072')   
 and cltcode >='A00000000' and Cltcode <='ZZZZZZZZZZ'  
 GROUP BY CLTCODE
      
      
CREATE TABLE #TBLMAIN      
(CL_CODE VARCHAR(15),      
NSE_BAL MONEY,      
BSE_BAL MONEY,      
NSEFO_BAL MONEY,      
NSECURFO_BAL MONEY,      
MCX_BAL MONEY,      
NCDX_BAL MONEY,      
TOTAL_BAL MONEY      
 )        
      
      
 CREATE NONCLUSTERED INDEX #TQ ON #TBLMAIN      
 (CL_CODE ASC)      
      
      
INSERT INTO  #TBLMAIN      
SELECT DISTINCT CL_CODE,'0','0','0','0','0','0', '0' FROM #TBL      
      
 UPDATE  #TBLMAIN SET NSE_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NSE' AND #TBLMAIN.CL_CODE=#TBL.CL_CODE        
 UPDATE  #TBLMAIN SET BSE_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='BSE'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE      
 UPDATE  #TBLMAIN SET NSEFO_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NSEFO'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE      
  UPDATE #TBLMAIN SET NSECURFO_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NSECURFO'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE      
 UPDATE  #TBLMAIN SET MCX_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='MCX'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE      
 UPDATE  #TBLMAIN SET NCDX_BAL = BILL_AMT FROM #TBL WHERE EXCHANGE ='NCDX'AND #TBLMAIN.CL_CODE=#TBL.CL_CODE      
 UPDATE  #TBLMAIN SET TOTAL_BAL =  NSE_BAL+BSE_BAL+NSEFO_BAL+NSECURFO_BAL+MCX_BAL+NCDX_BAL      
     
    
      
  SELECT @DT AS 'BILL_DATE',* INTO #FINALDATA FROM #TBLMAIN where TOTAL_BAL >='1'      
    
  SELECT * FROM #FINALDATA ORDER BY CL_CODE    
  
  DROP TABLE #TBL    
DROP TABLE #TBLMAIN    
      
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DetailsRequiredUrgently_data
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DetailsRequiredUrgently_data]


AS
BEGIN
	
create table #s (Party_code varchar(50))



select *From #s

	--SELECT DISTINCT A.CL_CODE,A.Long_NAME, B.Exchange
	--, B.SEGMENT,B.INACTIVE_FROM,B.ACTIVE_DATE,B.
	--DEACTIVE_VALUE,B.DEACTIVE_REMARKS 
	--FROM MSAJAG.dbo.CLIENT_DETAILS A 
 --   INNER JOIN MSAJAG.dbo.CLIENT_BROK_DETAILS B ON A.CL_CODE = B.CL_CODE 
	--WHERE A.cl_code in (select *From #s)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DetailsRequiredUrgently_data_bkp12042022
-- --------------------------------------------------

-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DetailsRequiredUrgently_data_bkp12042022]


AS
BEGIN
	
create table #s (Party_code varchar(50))



select *From #s

	--SELECT DISTINCT A.CL_CODE,A.Long_NAME, B.Exchange
	--, B.SEGMENT,B.INACTIVE_FROM,B.ACTIVE_DATE,B.
	--DEACTIVE_VALUE,B.DEACTIVE_REMARKS 
	--FROM MSAJAG.dbo.CLIENT_DETAILS A 
 --   INNER JOIN MSAJAG.dbo.CLIENT_BROK_DETAILS B ON A.CL_CODE = B.CL_CODE 
	--WHERE A.cl_code in (select *From #s)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DetailsRequiredUrgently_data_bkp12apr2022
-- --------------------------------------------------

-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DetailsRequiredUrgently_data_bkp12apr2022]


AS
BEGIN
	
create table #s (Party_code varchar(50))



select *From #s

	--SELECT DISTINCT A.CL_CODE,A.Long_NAME, B.Exchange
	--, B.SEGMENT,B.INACTIVE_FROM,B.ACTIVE_DATE,B.
	--DEACTIVE_VALUE,B.DEACTIVE_REMARKS 
	--FROM MSAJAG.dbo.CLIENT_DETAILS A 
 --   INNER JOIN MSAJAG.dbo.CLIENT_BROK_DETAILS B ON A.CL_CODE = B.CL_CODE 
	--WHERE A.cl_code in (select *From #s)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EDT_TB_EXPORT_BKP_JUN282024
-- --------------------------------------------------





CREATE PROCEDURE [dbo].[EDT_TB_EXPORT_BKP_JUN282024] (@TODATE VARCHAR(11))

AS ---- EXEC EDT_TB_EXPORT 'DEC 31 2018'

DECLARE @FROMDATE  VARCHAR(11)    
Select @FROMDATE = sdtcur from Parameter where @TODATE between sdtcur and ldtcur
 
----NSEBLBS    
select cltcode,SUM(vamt)as vamt  INTO #SLBS from (    
SELECT CLTCODE, Vamt = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) 
FROM ACCOUNTSLBS.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, Vamt = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) 
FROM ACCOUNTSLBS.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, Vamt = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) 
FROM  ACCOUNTSLBS.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
 group by cltcode    
 Having SUM(vamt) <>0
    
------------MTF    
select cltcode,SUM(vamt)as vamt  INTO #MTF from (    
SELECT CLTCODE, Vamt = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) 
FROM MTFTRADE.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, Vamt = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) 
FROM MTFTRADE.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, Vamt = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) 
FROM  MTFTRADE.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(vamt) <>0   

------------nse    
    
select cltcode,SUM(vamt)as vamt  INTO #NSE from (    
SELECT CLTCODE, Vamt = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) 
FROM ACCOUNT.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, Vamt = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) 
FROM ACCOUNT.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, Vamt = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) 
FROM  ACCOUNT.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(vamt) <>0   
    
 ------------bse    
select cltcode,SUM(LEDBAL)as vamt  INTO #BSE from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'BSECM' 
FROM AngelBSECM.ACCOUNT_AB.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'BSECM'
FROM AngelBSECM.ACCOUNT_AB.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'BSECM' 
FROM  AngelBSECM.ACCOUNT_AB.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(LEDBAL) <>0   
    
 ------------nsefo    
 select cltcode,SUM(LEDBAL)as vamt  INTO #NSEFO from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'NSEFO' 
FROM ANGELFO.ACCOUNTFO.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'NSEFO'
FROM ANGELFO.ACCOUNTFO.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'NSEFO' 
FROM  ANGELFO.ACCOUNTFO.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(LEDBAL) <>0   
    
  ------------nsx    
select cltcode,SUM(LEDBAL)as vamt  INTO #NSX from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'NSECD' 
FROM ANGELFO.ACCOUNTCURFO.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'NSECD'
FROM ANGELFO.ACCOUNTCURFO.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'NSECD' 
FROM  ANGELFO.ACCOUNTCURFO.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
 group by cltcode    
   Having SUM(LEDBAL) <>0  
    
    
  ------------mcd     
 select cltcode,SUM(LEDBAL)as vamt  INTO #MCD from (    
 SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'MCXCD' 
FROM ANGELCOMMODITY.ACCOUNTMCDXCDS.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'MCXCD'
FROM ANGELCOMMODITY.ACCOUNTMCDXCDS.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'MCXCD' 
FROM  ANGELCOMMODITY.ACCOUNTMCDXCDS.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
 group by cltcode    
  Having SUM(LEDBAL) <>0
  
  ------------mcX
  
select cltcode,SUM(LEDBAL)as vamt  INTO #MCX from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'MCDX' 
FROM ANGELCOMMODITY.ACCOUNTMCDX.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'MCDX'
FROM ANGELCOMMODITY.ACCOUNTMCDX.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'MCDX' 
FROM  ANGELCOMMODITY.ACCOUNTMCDX.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(LEDBAL) <>0
   
   ------------NCX 
   
select cltcode,SUM(LEDBAL)as vamt  INTO #NCX from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'NCDX' 
FROM ANGELCOMMODITY.ACCOUNTNCDX.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'NCDX'
FROM ANGELCOMMODITY.ACCOUNTNCDX.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'NCDX' 
FROM  ANGELCOMMODITY.ACCOUNTNCDX.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(LEDBAL) <>0
   
------------BSEFO

select cltcode,SUM(LEDBAL)as vamt  INTO #BSEFO from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'BSEFO' 
FROM ANGELCOMMODITY.ACCOUNTBFO.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'BSEFO'
FROM ANGELCOMMODITY.ACCOUNTBFO.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'BSEFO' 
FROM  ANGELCOMMODITY.ACCOUNTBFO.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(LEDBAL) <>0   
    
    
------------BSX     
select cltcode,SUM(LEDBAL)as vamt  INTO #BSX from (    
SELECT CLTCODE, LEDBAL = ISNULL(SUM(CASE WHEN UPPER(DRCR) = 'D' THEN VAMT ELSE -VAMT END ), 0) , EXCHANGE = 'BSECD' 
FROM ANGELCOMMODITY.ACCOUNTCURBFO.DBO.LEDGER WITH(NOLOCK) 
WHERE EDT LIKE @FROMDATE + '%' AND VTYP = 18  
GROUP BY CLTCODE 
UNION ALL
SELECT CLTCODE, LEDBAL = ISNULL(SUM( CASE WHEN UPPER(B.DRCR) = 'C' THEN B.VAMT ELSE -B.VAMT END ), 0) , EXCHANGE = 'BSECD'
FROM ANGELCOMMODITY.ACCOUNTCURBFO.DBO.LEDGER B WITH (NOLOCK) 
WHERE B.VDT < @FROMDATE AND EDT >= @FROMDATE 
GROUP BY CLTCODE
UNION ALL
SELECT CLTCODE, LEDBAL = SUM(CASE WHEN L.DRCR = 'D' THEN L.VAMT ELSE -L.VAMT END) , EXCHANGE = 'BSECD' 
FROM  ANGELCOMMODITY.ACCOUNTCURBFO.DBO.LEDGER L WITH (NOLOCK) 	
WHERE L.EDT >= @FROMDATE + ' 00:00:00' 	AND L.EDT <= @TODATE + ' 23:59:59' AND VTYP <> 18  
GROUP BY CLTCODE)a    
group by cltcode    
Having SUM(LEDBAL) <> 0  


IF OBJECT_ID(N'tempdb..#FINAL') IS NOT NULL
BEGIN
DROP TABLE #FINAL
END
    
CREATE TABLE #FINAL    
(CLTCODE VARCHAR(10), NSE MONEY, BSE MONEY,FO MONEY,NSX MONEY,MCD MONEY,
MCX MONEY,NCX MONEY,BSEFO MONEY,BSX MONEY,MTF MONEY,SLBS MONEY)	
    
INSERT INTO #FINAL    
SELECT DISTINCT CLTCODE,0,0,0,0,0,0,0,0,0,0,0 FROM (    
SELECT *  FROM #NSE   
UNION ALL    
SELECT * FROM #BSE   
UNION ALL    
SELECT * FROM #NSEFO    
UNION ALL    
SELECT * FROM #NSX    
UNION ALL    
SELECT * FROM #MCD    
UNION ALL    
SELECT * FROM #MCX    
UNION ALL    
SELECT * FROM #NCX    
UNION ALL    
SELECT * FROM #BSEFO    
UNION ALL    
SELECT * FROM #BSX    
UNION ALL    
SELECT * FROM #MTF    
UNION ALL    
SELECT * FROM #SLBS    
 )A    
    
UPDATE #FINAL SET NSE =VAMT FROM #NSE A WHERE A.CLTCODE =#FINAL.CLTCODE
UPDATE #FINAL SET BSE =VAMT FROM #BSE A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET FO =VAMT FROM #NSEFO A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET NSX =VAMT FROM #NSX A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET MCD =VAMT FROM #MCD A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET MCX =VAMT FROM #MCX A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET NCX =VAMT FROM #NCX A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET BSEFO =VAMT FROM #BSEFO A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET BSX =VAMT FROM #BSX A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET MTF =VAMT FROM #MTF A WHERE A.CLTCODE =#FINAL.CLTCODE     
UPDATE #FINAL SET SLBS =VAMT FROM #SLBS A WHERE A.CLTCODE =#FINAL.CLTCODE     
    
UPDATE #FINAL SET CLTCODE =FAMILY FROM MSAJAG.DBO.CLIENT_DETAILS WITH (NOLOCK)
WHERE Cl_code =CLTCODE AND CLTCODE LIKE '98%'    


TRUNCATE TABLE TB_EDT_EXPORT

INSERT INTO TB_EDT_EXPORT
SELECT RPORT_DATE=@TODATE,CLTCODE,LONG_NAME,PAN_GIR_NO,SUM(NSE)NSE,SUM(BSE)BSE,SUM(FO)FO,SUM(NSX)NSX,    
SUM(MCD)MCD ,SUM(MCX)MCX,SUM(NCX)NCX,SUM(BSEFO)BSEFO,SUM(BSX)BSX,SUM(MTF)MTF,SUM(SLBS)SLBS,    
SUM(NSE+BSE+FO+NSX+MCD+MCX+NCX+BSEFO+BSX+MTF+SLBS) AS TOTAL,REPORT='EDT',RUNTIME=GETDATE()     
FROM #FINAL A INNER JOIN MSAJAG..CLIENT_DETAILS B WITH (NOLOCK) ON A.CLTCODE=B.CL_CODE  
WHERE CLTCODE <>'BBBB' AND CL_CODE >='A0' AND CL_CODE <='ZZZZZZZZZZZZZ'
GROUP BY CLTCODE,LONG_NAME,PAN_GIR_NO ORDER BY CLTCODE ASC    

DROP TABLE #FINAL
DROP TABLE #NSE
DROP TABLE #BSE
DROP TABLE #NSEFO
DROP TABLE #NSX
DROP TABLE #MCD
DROP TABLE #MCX
DROP TABLE #NCX
DROP TABLE #BSEFO
DROP TABLE #BSX
DROP TABLE #MTF
DROP TABLE #SLBS
  
  --SELECT * FROM #TEMP WHERE CLTCODE BETWEEN 'A0'AND 'HZZZZZZZZZZ' AND LONG_NAME IS NOT NULL
  --SELECT * FROM #TEMP WHERE CLTCODE BETWEEN 'I0'AND 'PZZZZZZZZZZ' AND LONG_NAME IS NOT NULL  
  --SELECT * FROM #TEMP WHERE CLTCODE BETWEEN 'Q0'AND 'UZZZZZZZZZ'  AND LONG_NAME IS NOT NULL   
  --SELECT * FROM #TEMP WHERE CLTCODE BETWEEN 'V0'AND 'ZZZZZZZZZ'   AND LONG_NAME IS NOT NULL   

DECLARE @EDTFILENAME1 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_1.CSV'
DECLARE @EDT1 VARCHAR(MAX)                            
SET @EDT1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT1 = @EDT1 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''A0''''AND ''''CZZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'    
EXEC(@EDT1)

DECLARE @EDTFILENAME2 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_2.CSV'
DECLARE @EDT2 VARCHAR(MAX)                            
SET @EDT2 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT2 = @EDT2 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''D0'''' AND ''''GZZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME2+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
EXEC(@EDT2)

DECLARE @EDTFILENAME3 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_3.CSV'
DECLARE @EDT3 VARCHAR(MAX)                            
SET @EDT3 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT3 = @EDT3 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''H0'''' AND ''''LZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME3+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
EXEC(@EDT3)

DECLARE @EDTFILENAME4 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_4.CSV'
DECLARE @EDT4 VARCHAR(MAX)                            
SET @EDT4 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT4 = @EDT4 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''M0'''' AND ''''QZZZZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME4+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
EXEC(@EDT4)

DECLARE @EDTFILENAME5 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_5.CSV'
DECLARE @EDT5 VARCHAR(MAX)                            
SET @EDT5 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT5 = @EDT5 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''R0'''' AND ''''RZZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME5+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
EXEC(@EDT5)

DECLARE @EDTFILENAME6 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_6.CSV'
DECLARE @EDT6 VARCHAR(MAX)                            
SET @EDT6 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT6 = @EDT6 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''S0'''' AND ''''SZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME6+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
EXEC(@EDT6)

DECLARE @EDTFILENAME7 VARCHAR(100) = 'J:\BACKOFFICE\EXPORT\' +'TB_EDT_' + CONVERT(VARCHAR, CONVERT(DATETIME,@TODATE), 112) + '_7.CSV'
DECLARE @EDT7 VARCHAR(MAX)                            
SET @EDT7 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT DATE'''',''''CLTCODE'''',''''CLIENT NAME'''',''''PAN NO'''',''''NSECM'''',''''BSECM'''',''''NSEFO'''',''''NSEFO'''',''''MCXCD'''',''''MCDX'''',''''NCDX'''',''''BSEFO'''',''''BSECD'''',''''MTF'''',''''SLBM'''',''''TOTAL''''' 
SET @EDT7 = @EDT7 + ' UNION ALL SELECT CONVERT(VARCHAR(11),RPORT_DATE,105),LTRIM(RTRIM(CLTCODE)),LONG_NAME,PAN_GIR_NO,CONVERT(VARCHAR,NSE),CONVERT(VARCHAR,BSE),CONVERT(VARCHAR,FO),CONVERT(VARCHAR,NSX),CONVERT(VARCHAR,MCD),CONVERT(VARCHAR,MCX),CONVERT(VARCHAR,NCX),CONVERT(VARCHAR,BSEFO),CONVERT(VARCHAR,BSX),CONVERT(VARCHAR,MTF),CONVERT(VARCHAR,SLBS),CONVERT(VARCHAR,TOTAL) FROM ACCOUNT.DBO.TB_EDT_EXPORT WHERE CLTCODE BETWEEN ''''T0'''' AND ''''ZZZZZZZZZZZZZ'''' AND LONG_NAME IS NOT NULL" QUERYOUT ' +@EDTFILENAME7+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
EXEC(@EDT7)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.JOBTEST007
-- --------------------------------------------------
CREATE PROC JOBTEST007
AS
INSERT INTO SQLJOBTEST VALUES (GETDATE())

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MARGIN_PENALTY_SUMMARY_BKUP_28Jun2024
-- --------------------------------------------------



CREATE PROC [dbo].[MARGIN_PENALTY_SUMMARY_BKUP_28Jun2024] ( @FROMDATE VARCHAR(11) ,@TODATE VARCHAR(11) ,@CLT VARCHAR(1) = 'D')                          
AS                          
                          
-- EXEC MARGIN_PENALTY_SUMMARY 'MAR  3 2023','MAR  3 2023'       
                 
IF CONVERT(DATETIME,@TODATE) <> CONVERT(DATETIME,@FROMDATE)  
BEGIN  
SELECT EXCHANGE,SEGMENT,CONVERT(VARCHAR(10),P_SAUDADATE,105) AS P_SAUDADATE,          
PARTY_CODE,PROV,SHORTAGE,PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,  
(  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT+MTM_SHRT) ELSE (PEAK_SHRT+MTM_SHRT) END  
  ELSE 0  END) AS MAX_MAR_SHRT,  
 CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) AS MAX_PENALTY,  
  DIFF = PENALTY_AMT + CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)),  
(  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END) AS MAX_INI_SHRT,  
 CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) AS MAX_INI_PENALTY,  
  (  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT+MTM_SHRT) ELSE (PEAK_SHRT+MTM_SHRT) END  
  ELSE 0  END) - (  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END) AS MAX_MTM_MARGIN,  
MTM_PENALTY = CONVERT(NUMERIC(18,2),ROUND((CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) -   
   CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2))  
FROM MARGIN_PROV_FINAL_SUMMARY               
WHERE P_SAUDADATE  BETWEEN @FROMDATE AND @TODATE                    
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT                  
RETURN  
END  
  
IF (SELECT COUNT(*) FROM MARGIN_PROV_FINAL_SUMMARY WHERE P_SAUDADATE>= 'JAN  1 2023' AND P_SAUDADATE = @FROMDATE) = 0 
BEGIN
GOTO MARGIN_PROV_FINAL_SUMMARY_RUN
END
  
DECLARE @CHECDATE DATETIME  
  
SELECT @CHECDATE = MIN(START_DATE)  FROM   
(SELECT TOP 7 START_DATE FROM MSAJAG.DBO.SETT_MST WITH (NOLOCK) WHERE SETT_TYPE = 'M' AND  START_DATE <= GETDATE() ORDER BY START_DATE DESC) AS A  
                          
IF @CHECDATE > CONVERT(DATETIME,@FROMDATE)  
BEGIN  
SELECT EXCHANGE,SEGMENT,CONVERT(VARCHAR(10),P_SAUDADATE,105) AS P_SAUDADATE,          
PARTY_CODE,PROV,SHORTAGE,PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,  
(  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT+MTM_SHRT) ELSE (PEAK_SHRT+MTM_SHRT) END  
  ELSE 0  END) AS MAX_MAR_SHRT,  
 CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) AS MAX_PENALTY,  
  DIFF = PENALTY_AMT + CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)),  
(  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END) AS MAX_INI_SHRT,  
 CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) AS MAX_INI_PENALTY,  
  (  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT+MTM_SHRT) ELSE (PEAK_SHRT+MTM_SHRT) END  
  ELSE 0  END) - (  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END) AS MAX_MTM_MARGIN,  
MTM_PENALTY = CONVERT(NUMERIC(18,2),ROUND((CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) -   
   CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2))  
FROM MARGIN_PROV_FINAL_SUMMARY               
WHERE P_SAUDADATE  BETWEEN @FROMDATE AND @TODATE                    
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT         
RETURN  
END  
  

MARGIN_PROV_FINAL_SUMMARY_RUN:

SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,EXCHANGE = 'NSE',SEGMENT = 'CAPITAL'                          
INTO #MARGIN_PENALTY                           
FROM MSAJAG.DBO.CMMARGIN_PENALTY WITH (NOLOCK) WHERE 1 <> 1                          
                          
                          
IF @CLT = 'C'                           
                          
                          
BEGIN                          
                          
                          
INSERT INTO  #MARGIN_PENALTY                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT = CONVERT(NUMERIC (18,2) , PENALTY_AMT),                          
  EXCHANGE ,SEGMENT                          
                             
FROM (                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSE',SEGMENT = 'CAPITAL'                          
FROM  MSAJAG.DBO.CMMARGIN_PENALTY WITH (NOLOCK)  , #CLIENTDATA                          
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'AND PARTY_CODE = CLTCODE                          
UNION ALL                          
SELECT MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSE',SEGMENT = 'FUTURES'                          
FROM ANGELFO.NSEFO.DBO.FOMARGIN_PENALTY WITH (NOLOCK)  , #CLIENTDATA                          
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'AND PARTY_CODE = CLTCODE                          
UNION ALL                          
SELECT MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSX',SEGMENT = 'FUTURES'                          
FROM ANGELFO.NSECURFO.DBO.FOMARGIN_PENALTY WITH (NOLOCK)  , #CLIENTDATA                          
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'AND PARTY_CODE = CLTCODE                          
UNION ALL                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NCX',SEGMENT = 'FUTURES'                          
FROM ANGELCOMMODITY.NCDX.DBO.FOMARGIN_PENALTY WITH (NOLOCK)  , #CLIENTDATA                          
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'AND PARTY_CODE = CLTCODE                          
UNION ALL                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'MCX',SEGMENT = 'FUTURES'                          
FROM ANGELCOMMODITY.MCDX.DBO.FOMARGIN_PENALTY WITH (NOLOCK)  , #CLIENTDATA                          
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'AND PARTY_CODE = CLTCODE                          
 ) AS A                            
                          
DROP TABLE #CLIENTDATA                          
                          
END                          
                          
                          
ELSE                          
                          
                          
BEGIN                          
                          
INSERT INTO  #MARGIN_PENALTY                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT = CONVERT(NUMERIC (18,2) , PENALTY_AMT),                          
  EXCHANGE ,SEGMENT                          
                           
FROM (                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSE',SEGMENT = 'CAPITAL'                          
FROM  MSAJAG.DBO.CMMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                 
UNION ALL                          
SELECT MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSE',SEGMENT = 'FUTURES'                          
FROM ANGELFO.NSEFO.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'             
UNION ALL                          
SELECT MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSX',SEGMENT = 'FUTURES'                          
FROM ANGELFO.NSECURFO.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                         
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                           
UNION ALL                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NCX',SEGMENT = 'FUTURES'                          
FROM ANGELCOMMODITY.NCDX.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                          
UNION ALL                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'MCX',SEGMENT = 'FUTURES'                          
FROM ANGELCOMMODITY.MCDX.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                           
 ) AS A                            
                          
END                          
                          
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,TDAY_LEDGER = SUM(TDAY_LEDGER),TDAY_MARGIN = SUM(TDAY_MARGIN),TDAY_CASHCOLL = SUM(TDAY_CASHCOLL),                          
TDAY_NONCASH = SUM(TDAY_NONCASH),TDAY_MTM= SUM(TDAY_MTM),T_MARGINAVL = SUM(T_MARGINAVL),T_MTMAVL = SUM(T_MTMAVL), MTYPE = 'E'                          
INTO #MARGIN                          
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_DETAIL A WITH (NOLOCK)  , #MARGIN_PENALTY B WHERE  MARGINDATE  = MARGIN_DATE                          
AND A.PARTY_CODE = B.PARTY_CODE AND A.EXCHANGE= B.EXCHANGE  AND A.SEGMENT= B.SEGMENT                          
AND MARGINDATE >= 'NOV  1 2021'                            
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE  ORDER BY MARGINDATE,A.PARTY_CODE                          
                          
INSERT  INTO #MARGIN                          
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,TDAY_LEDGER = SUM(TDAY_LEDGER),TDAY_MARGIN = SUM(TDAY_MARGIN),TDAY_CASHCOLL = SUM(TDAY_CASHCOLL),                          
TDAY_NONCASH = SUM(TDAY_NONCASH),TDAY_MTM= SUM(TDAY_MTM),T_MARGINAVL = SUM(T_MARGINAVL),T_MTMAVL = SUM(T_MTMAVL), MTYPE = 'P'                          
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_PEAK_DETAIL  A WITH (NOLOCK)  , #MARGIN_PENALTY B WHERE  MARGINDATE  = MARGIN_DATE                          
AND A.PARTY_CODE = B.PARTY_CODE AND A.EXCHANGE= B.EXCHANGE  AND A.SEGMENT= B.SEGMENT                          
AND MARGINDATE >= 'NOV  1 2021'                          
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE  ORDER BY MARGINDATE,A.PARTY_CODE                          
                          
IF @FROMDATE <= 'OCT 31 2021'                          
BEGIN                           
INSERT  INTO #MARGIN                          
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,TDAY_LEDGER = SUM(TDAY_LEDGER),TDAY_MARGIN = SUM(TDAY_MARGIN),TDAY_CASHCOLL = SUM(TDAY_CASHCOLL),                          
TDAY_NONCASH = SUM(TDAY_NONCASH),TDAY_MTM= SUM(TDAY_MTM),T_MARGINAVL = SUM(T_MARGINAVL),T_MTMAVL = SUM(T_MTMAVL), MTYPE = 'P'                          
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_PEAK_DETAIL_HIST  A WITH (NOLOCK)  , #MARGIN_PENALTY B WHERE  MARGINDATE  = MARGIN_DATE                          
AND A.PARTY_CODE = B.PARTY_CODE AND A.EXCHANGE= B.EXCHANGE  AND A.SEGMENT= B.SEGMENT                          
AND MARGINDATE < 'NOV  1 2021'                          
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE  ORDER BY MARGINDATE,A.PARTY_CODE                          
                          
INSERT  INTO #MARGIN                          
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,TDAY_LEDGER = SUM(TDAY_LEDGER),TDAY_MARGIN = SUM(TDAY_MARGIN),TDAY_CASHCOLL = SUM(TDAY_CASHCOLL),                          
TDAY_NONCASH = SUM(TDAY_NONCASH),TDAY_MTM= SUM(TDAY_MTM),T_MARGINAVL = SUM(T_MARGINAVL),T_MTMAVL = SUM(T_MTMAVL), MTYPE = 'E'                          
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_DETAIL_HIST  A WITH (NOLOCK)  , #MARGIN_PENALTY B WHERE  MARGINDATE  = MARGIN_DATE                          
AND A.PARTY_CODE = B.PARTY_CODE AND A.EXCHANGE= B.EXCHANGE  AND A.SEGMENT= B.SEGMENT                          
AND MARGINDATE < 'NOV  1 2021'                          
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE  ORDER BY MARGINDATE,A.PARTY_CODE                     
END                          
                          
DELETE #MARGIN WHERE PARTY_CODE  = '12798'                          
                          
DELETE #MARGIN WHERE EXCHANGE IN ('MTF','EPN')                          
                          
SELECT  MARGINDATE,PARTY_CODE,MTYPE,TDAY_MARGIN = SUM(TDAY_MARGIN),                          
TDAY_MTM= SUM(TDAY_MTM),T_MARGINAVL = SUM(CASE WHEN T_MARGINAVL < 0  THEN T_MARGINAVL ELSE  0 END),                          
T_MTMAVL = SUM(CASE WHEN T_MTMAVL < 0  THEN T_MTMAVL ELSE  0 END)                           
INTO #MARGIN_FINAL2                          
FROM #MARGIN                           
GROUP BY PARTY_CODE,MARGINDATE,MTYPE                          
ORDER BY MARGINDATE,PARTY_cODE,MTYPE ASC                
      
/*      
      
SELECT  MARGINDATE,PARTY_CODE,MTYPE,TDAY_MARGIN = SUM(TDAY_MARGIN),                          
TDAY_MTM= SUM(TDAY_MTM),T_MARGINAVL = SUM(      
           CASE WHEN T_MARGINAVL < 0  THEN T_MARGINAVL ELSE        
           CASE WHEN T_MARGINAVL < TDAY_MARGIN THEN T_MARGINAVL - TDAY_MARGIN      
           ELSE 0 END END),                          
T_MTMAVL = SUM(CASE WHEN T_MTMAVL < 0  THEN T_MTMAVL ELSE        
               CASE WHEN T_MTMAVL < TDAY_MTM THEN T_MTMAVL - TDAY_MTM      
           ELSE 0 END END)                           
INTO #MARGIN_FINAL2                          
FROM #MARGIN                           
GROUP BY PARTY_CODE,MARGINDATE,MTYPE                          
ORDER BY MARGINDATE,PARTY_cODE,MTYPE ASC                          
*/      
                          
SELECT * INTO #MARGIN_FINAL3 FROM #MARGIN_FINAL2 --WHERE (T_MTMAVL < 0 OR T_MARGINAVL < 0)                    
                          
CREATE INDEX CLIIDX  ON #MARGIN_FINAL3(MARGINDATE,PARTY_CODE,MTYPE)                          
CREATE INDEX CLIIDX  ON #MARGIN(MARGINDATE,PARTY_CODE,MTYPE)                          
                          
                          
SELECT  A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,A.MARGINDATE,A.MTYPE,TDAY_MARGIN = SUM(A.TDAY_MARGIN),                          
TDAY_MTM= SUM(A.TDAY_MTM),T_MARGINAVL = SUM(CASE WHEN A.T_MARGINAVL < 0  THEN A.T_MARGINAVL ELSE  0 END),                          
T_MTMAVL = SUM(CASE WHEN A.T_MTMAVL < 0  THEN A.T_MTMAVL ELSE  0 END)                           
INTO #MARGIN_FINAL1                          
FROM #MARGIN  A , #MARGIN_FINAL3 B WHERE A.MARGINDATE = B.MARGINDATE AND   A.PARTY_CODE = B.PARTY_CODE AND A.MTYPE = B.MTYPE                           
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,A.MARGINDATE,A.MTYPE                          
ORDER BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,A.MARGINDATE,A.MTYPE ASC                
      
/*      
      
SELECT  A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,A.MARGINDATE,A.MTYPE,TDAY_MARGIN = SUM(A.TDAY_MARGIN),                          
TDAY_MTM= SUM(A.TDAY_MTM),T_MARGINAVL = SUM(      
           CASE WHEN A.T_MARGINAVL < 0  THEN A.T_MARGINAVL ELSE        
           CASE WHEN A.T_MARGINAVL < A.TDAY_MARGIN THEN A.T_MARGINAVL - A.TDAY_MARGIN      
           ELSE 0 END END),                          
T_MTMAVL = SUM(CASE WHEN A.T_MTMAVL < 0  THEN A.T_MTMAVL ELSE        
               CASE WHEN A.T_MTMAVL < A.TDAY_MTM THEN A.T_MTMAVL - A.TDAY_MTM      
     ELSE 0 END END)                        
INTO #MARGIN_FINAL1                          
FROM #MARGIN  A , #MARGIN_FINAL3 B WHERE A.MARGINDATE = B.MARGINDATE AND   A.PARTY_CODE = B.PARTY_CODE AND A.MTYPE = B.MTYPE                           
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,A.MARGINDATE,A.MTYPE                          
ORDER BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,A.MARGINDATE,A.MTYPE ASC                          
*/      
                          
                          
SELECT EXCHANGE,SEGMENT,MARGINDATE,PARTY_CODE,SUM(CASE WHEN MTYPE = 'E' THEN TDAY_MARGIN ELSE 0 END) AS EOD_MAR,                          
SUM(CASE WHEN MTYPE = 'P' THEN TDAY_MARGIN ELSE 0 END) AS PEAK_MAR,                          
SUM(CASE WHEN MTYPE = 'E' THEN TDAY_MTM ELSE 0 END) AS EOD_MTM,                          
SUM(CASE WHEN MTYPE = 'E' THEN T_MARGINAVL ELSE 0 END) AS EOD_SHRT,                          
SUM(CASE WHEN MTYPE = 'P' THEN T_MARGINAVL ELSE 0 END) AS PEAK_SHRT,                          
SUM(CASE WHEN MTYPE = 'E' THEN T_MTMAVL ELSE 0 END) AS MTM_SHRT INTO #MARGIN_FINAL4 FROM #MARGIN_FINAL1                          
GROUP BY EXCHANGE,SEGMENT,MARGINDATE,PARTY_CODE                          
ORDER BY MARGINDATE,PARTY_CODE                          
                          
SELECT MARGINDATE,PARTY_CODE,SUM(CASE WHEN MTYPE = 'E' THEN TDAY_MARGIN ELSE 0 END) AS EOD_MAR,                          
SUM(CASE WHEN MTYPE = 'P' THEN TDAY_MARGIN ELSE 0 END) AS PEAK_MAR,                          
SUM(CASE WHEN MTYPE = 'E' THEN TDAY_MTM ELSE 0 END) AS EOD_MTM,                          
SUM(CASE WHEN MTYPE = 'E' THEN T_MARGINAVL ELSE 0 END) AS EOD_SHRT,                          
SUM(CASE WHEN MTYPE = 'P' THEN T_MARGINAVL ELSE 0 END) AS PEAK_SHRT,                          
SUM(CASE WHEN MTYPE = 'E' THEN T_MTMAVL ELSE 0 END) AS MTM_SHRT                           
INTO #MARGIN_FINAL5                          
FROM #MARGIN_FINAL3                           
GROUP BY MARGINDATE,PARTY_CODE                          
ORDER BY MARGINDATE,PARTY_CODE                          
                          
                          
CREATE CLUSTERED INDEX CLIIDX  ON #MARGIN_FINAL5(MARGINDATE,PARTY_CODE)                          
CREATE CLUSTERED INDEX CLIIDX  ON #MARGIN_FINAL4(MARGINDATE,PARTY_CODE)                          
                          
--SELECT A.* FROM #MARGIN_FINAL4 A,#MARGIN_FINAL5 B WHERE A.MARGINDATE = B.MARGINDATE AND   A.PARTY_CODE = B.PARTY_CODE                           
--ORDER BY MARGINDATE,PARTY_CODE                          
                          
                          
DROP TABLE #MARGIN_FINAL2                          
DROP TABLE #MARGIN_FINAL3                          
DROP TABLE #MARGIN                          
                          
ALTER TABLE #MARGIN_PENALTY ADD EOD_MAR NUMERIC (18,2),PEAK_MAR NUMERIC (18,2), MTM_MAR NUMERIC (18,2), EOD_SHRT NUMERIC (18,2), PEAK_SHRT NUMERIC (18,2), MTM_SHRT NUMERIC (18,2)                           
                          
                          
UPDATE #MARGIN_PENALTY SET EOD_MAR = 0 ,PEAK_MAR = 0 ,MTM_MAR = 0 ,EOD_SHRT = 0 ,PEAK_SHRT = 0 ,MTM_SHRT = 0                           
                          
                          
;WITH CTE AS  (                          
SELECT A.*,INI_SHRT_FINAL = CASE WHEN A.EOD_SHRT + A.MTM_SHRT < A.PEAK_SHRT THEN A.EOD_SHRT ELSE A.PEAK_SHRT END,                          
MTM_SHRT_FINAL = CASE WHEN A.EOD_SHRT + A.MTM_SHRT < A.PEAK_SHRT THEN  A.MTM_SHRT ELSE 0 END,                          
TYPE_MARGIN = CASE WHEN A.EOD_SHRT + A.MTM_SHRT < A.PEAK_SHRT THEN  'EOD' ELSE 'PEAK' END                    
FROM #MARGIN_FINAL4 A,#MARGIN_FINAL5 B WHERE A.MARGINDATE = B.MARGINDATE AND   A.PARTY_CODE = B.PARTY_CODE )                          
                          
                          
UPDATE B SET B.EOD_MAR = A.EOD_MAR , B.PEAK_MAR= A.PEAK_MAR , B.MTM_MAR =A.EOD_MTM , B.EOD_SHRT = A.EOD_SHRT, B.PEAK_SHRT = A.PEAK_SHRT,                           
B.MTM_SHRT = A.MTM_SHRT                           
FROM CTE  A, #MARGIN_PENALTY B WHERE A.EXCHANGE = B.EXCHANGE AND A.SEGMENT = B.SEGMENT AND A.PARTY_CODE = B.PARTY_CODE                          
AND A.MARGINDATE = B.MARGIN_DATE                          
                        
DELETE A FROM MARGIN_PROV_FINAL_COMB2 A ,   #MARGIN_PENALTY B WHERE A.MARGIN_DATE = B.MARGIN_DATE                        
                        
EXEC MARGIN_PROC_YN @FROMDATE , @TODATE                      
                      
INSERT INTO MARGIN_PROV_FINAL_COMB2 SELECT * FROM #MARGIN_PENALTY                      
              
UPDATE MARGIN_PROV_FINAL_COMB1 SET PROV = 'N' WHERE SEGMENT = 'CAPITAL'              
            
UPDATE MARGIN_PROV_FINAL_COMB1 SET PROV = 'Y' WHERE LAST_SAUDA_DATE= 'Y' AND SEGMENT = 'CAPITAL'          
    
DELETE MARGIN_PROV_FINAL_SUMMARY WHERE P_SAUDADATE  BETWEEN @FROMDATE AND @TODATE                  
    
DELETE MARGIN_PROV_FINAL_DETAIL WHERE MARGINDATE  BETWEEN @FROMDATE AND @TODATE                  
                          
INSERT INTO MARGIN_PROV_FINAL_SUMMARY    
SELECT A.EXCHANGE,A.SEGMENT,P_SAUDADATE,          
A.PARTY_CODE,PROV,A.SHORTAGE,A.PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
A.PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT            
FROM MARGIN_PROV_FINAL_COMB1 A ,MARGIN_PROV_FINAL_COMB2 B                      
WHERE A.P_SAUDADATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                       
AND B.MARGIN_DATE  BETWEEN @FROMDATE AND @TODATE                    
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT                      
                    
INSERT INTO MARGIN_PROV_FINAL_DETAIL    
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,A.MTYPE,TDAY_MARGIN ,TDAY_MTM,T_MARGINAVL, T_MTMAVL        
FROM #MARGIN_FINAL1 A  ,MARGIN_PROV_FINAL_COMB2 B                      
WHERE A.MARGINDATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                        
AND B.MARGIN_DATE  BETWEEN @FROMDATE AND @TODATE                    
ORDER BY MARGINDATE,A.PARTY_CODE,A.EXCHANGE,A.SEGMENT,MTYPE                     
    
SELECT *,  
(  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT+MTM_SHRT) ELSE (PEAK_SHRT+MTM_SHRT) END  
  ELSE 0  END) AS MAX_MAR_SHRT,  
 CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) AS MAX_PENALTY,  
  DIFF = PENALTY_AMT + CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)),  
(  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END) AS MAX_INI_SHRT,  
 CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) AS MAX_INI_PENALTY,  
  (  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT+MTM_SHRT) ELSE (PEAK_SHRT+MTM_SHRT) END  
  ELSE 0  END) - (  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END) AS MAX_MTM_MARGIN,  
MTM_PENALTY = CONVERT(NUMERIC(18,2),ROUND((CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT)+(MTM_SHRT) ELSE (PEAK_SHRT)+(MTM_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) -   
   CONVERT(NUMERIC(18,2),ROUND((  
CASE WHEN EXCHANGE = 'NSE' AND SEGMENT = 'CAPITAL' THEN   
  CASE WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN  (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSE' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NSX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN (EOD_SHRT)+(MTM_SHRT) <=  (PEAK_SHRT) THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  WHEN EXCHANGE = 'MCX' AND SEGMENT = 'FUTURES' THEN   
  CASE  WHEN EOD_SHRT <=  PEAK_SHRT THEN (EOD_SHRT) ELSE (PEAK_SHRT) END  
  ELSE 0  END)* PENALTY_PERC/100,2)) FROM MARGIN_PROV_FINAL_SUMMARY WHERE P_SAUDADATE  BETWEEN @FROMDATE AND @TODATE ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT        
    
--SELECT * FROM MARGIN_PROV_FINAL_DETAIL  WHERE MARGINDATE  BETWEEN @FROMDATE AND @TODATE ORDER BY MARGINDATE,PARTY_CODE,EXCHANGE,SEGMENT,MTYPE            
                          
/*        
        
SELECT  FORMAT(MARGIN_DATE,'dd/MM/yyyy') as MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT = CONVERT(NUMERIC (18,2) , PENALTY_AMT),                
  DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX = CONVERT(NUMERIC (18,2) , SERVICE_TAX),EXCHANGE,SEGMENT                 
FROM (                
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSE',SEGMENT = 'CAPITAL'                          
FROM  MSAJAG.DBO.CMMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                          
UNION ALL                          
SELECT MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSE',SEGMENT = 'FUTURES'                          
FROM ANGELFO.NSEFO.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                           
UNION ALL                          
SELECT MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NSX',SEGMENT = 'FUTURES'                          
FROM ANGELFO.NSECURFO.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                           
UNION ALL                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'NCX',SEGMENT = 'FUTURES'                          
FROM ANGELCOMMODITY.NCDX.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                          
UNION ALL                          
SELECT  MARGIN_DATE,PARTY_CODE,SHORTAGE,PENALTY_PERC,PENALTY_AMT,DAYS_3_COUNT,MONTH_5_COUNT,LEDGER_POST_FLAG,SERVICE_TAX,EXCHANGE = 'MCX',SEGMENT = 'FUTURES'                          
FROM ANGELCOMMODITY.MCDX.DBO.FOMARGIN_PENALTY WITH (NOLOCK)                           
WHERE MARGIN_DATE BETWEEN @FROMDATE AND @TODATE + ' 23:59'                     
 ) AS A                  
 ORDER BY 1,2                
 */               
        
/*                
                
SELECT A.EXCHANGE,A.SEGMENT,P_SAUDADATE,A.PARTY_CODE,PROV,A.SHORTAGE,A.PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
A.PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,SHRT_TYPE = 'EM'     INTO #CHECK                 
FROM MARGIN_PROV_FINAL_COMB1 A ,MARGIN_PROV_FINAL_COMB2 B                      
WHERE A.P_SAUDADATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                       
AND B.MARGIN_DATE  BETWEEN 'OCT  1 2022'  AND 'OCT 31 2022'                    
AND CONVERT(NUMERIC(18,0),(A.SHORTAGE + EOD_SHRT +MTM_SHRT))  = 0                
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT                      
                
                      
                   
INSERT INTO #CHECK                
SELECT A.EXCHANGE,A.SEGMENT,P_SAUDADATE,A.PARTY_CODE,PROV,A.SHORTAGE,A.PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
A.PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,SHRT_TYPE = 'PM'                     
FROM MARGIN_PROV_FINAL_COMB1 A ,MARGIN_PROV_FINAL_COMB2 B                      
WHERE A.P_SAUDADATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                       
AND B.MARGIN_DATE  BETWEEN 'OCT  1 2022'  AND 'OCT 31 2022'                    
AND CONVERT(NUMERIC(18,0),(A.SHORTAGE + PEAK_SHRT + MTM_SHRT))  = 0                
AND NOT EXISTS (SELECT * FROM #CHECK C WHERE A.EXCHANGE = C.EXCHANGE AND A.SEGMENT = C.SEGMENT AND A.P_SAUDADATE = C.P_SAUDADATE                
AND A.PARTY_CODE = C.PARTY_CODE)                
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT                      
                
                
INSERT INTO #CHECK                
SELECT A.EXCHANGE,A.SEGMENT,P_SAUDADATE,A.PARTY_CODE,PROV,A.SHORTAGE,A.PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
A.PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,SHRT_TYPE = 'P'                     
FROM MARGIN_PROV_FINAL_COMB1 A ,MARGIN_PROV_FINAL_COMB2 B                      
WHERE A.P_SAUDADATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                       
AND B.MARGIN_DATE  BETWEEN 'OCT  1 2022'  AND 'OCT 31 2022'                    
AND CONVERT(NUMERIC(18,0),(A.SHORTAGE + PEAK_SHRT))   = 0                
AND NOT EXISTS (SELECT * FROM #CHECK C WHERE A.EXCHANGE = C.EXCHANGE AND A.SEGMENT = C.SEGMENT AND A.P_SAUDADATE = C.P_SAUDADATE                
AND A.PARTY_CODE = C.PARTY_CODE)                
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT                      
                
                
INSERT INTO #CHECK                
SELECT A.EXCHANGE,A.SEGMENT,P_SAUDADATE,A.PARTY_CODE,PROV,A.SHORTAGE,A.PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
A.PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,SHRT_TYPE = 'E'                     
FROM MARGIN_PROV_FINAL_COMB1 A ,MARGIN_PROV_FINAL_COMB2 B                     
WHERE A.P_SAUDADATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                       
AND B.MARGIN_DATE  BETWEEN 'OCT  1 2022'  AND 'OCT 31 2022'                    
AND CONVERT(NUMERIC(18,0),(A.SHORTAGE + EOD_SHRT))   = 0                
AND NOT EXISTS (SELECT * FROM #CHECK C WHERE A.EXCHANGE = C.EXCHANGE AND A.SEGMENT = C.SEGMENT AND A.P_SAUDADATE = C.P_SAUDADATE                
AND A.PARTY_CODE = C.PARTY_CODE)                
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT             
                      
                
                
SELECT A.EXCHANGE,A.SEGMENT,P_SAUDADATE,A.PARTY_CODE,PROV,A.SHORTAGE,A.PENALTY_AMT,POSITION_TYPE,ISNULL(LAST_SAUDA_DATE,'') AS LAST_SAUDA_DATE,                      
A.PENALTY_PERC,EOD_MAR,PEAK_MAR,MTM_MAR,EOD_SHRT,PEAK_SHRT,MTM_SHRT,SHRT_TYPE = 'NA'                     
FROM MARGIN_PROV_FINAL_COMB1 A ,MARGIN_PROV_FINAL_COMB2 B                      
WHERE A.P_SAUDADATE = B.MARGIN_DATE                      
AND A.PARTY_CODE = B.PARTY_CODE                      
AND A.EXCHANGE = B.EXCHANGE                      
AND A.SEGMENT = B.SEGMENT                       
AND B.MARGIN_DATE  BETWEEN 'OCT  1 2022'  AND 'OCT 31 2022'                    
AND A.SHORTAGE <> 0                
AND EOD_SHRT+PEAK_SHRT+MTM_SHRT  = 0                
AND NOT EXISTS (SELECT * FROM #CHECK C WHERE A.EXCHANGE = C.EXCHANGE AND A.SEGMENT = C.SEGMENT AND A.P_SAUDADATE = C.P_SAUDADATE                
AND A.PARTY_CODE = C.PARTY_CODE)                
ORDER BY P_SAUDADATE,PARTY_CODE,EXCHANGE,SEGMENT                      
*/                
                
DROP TABLE #MARGIN_FINAL4                          
DROP TABLE #MARGIN_FINAL5                          
DROP TABLE #MARGIN_PENALTY                      
DROP TABLE #MARGIN_FINAL1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MFUND_RPT_FUNDING_OPENPOS_SUMMARY
-- --------------------------------------------------
    
CREATE PROC [dbo].[MFUND_RPT_FUNDING_OPENPOS_SUMMARY](                      
  @STATUSID VARCHAR(50),                        
  @STATUSNAME VARCHAR(50),                        
  @FROMDATE VARCHAR(11),                        
  @TODATE  VARCHAR(11),                        
  @FROMPARTY VARCHAR(10),                        
  @TOPARTY VARCHAR(10),                        
  @FROMSCRIP VARCHAR(50)='',                        
  @TOSCRIP VARCHAR(50)='ZZZZZZZ',                        
  @OPT VARCHAR(20)=''                      
)                
AS         
-- EXEC MFUND_RPT_FUNDING_OPENPOS 'BROKER', 'BROKER', 'JAN  6 2022', 'JAN  6 2022', 'H31224', 'H31224', '0', 'ZZZ', ''    
    
SELECT @TOPARTY = (CASE WHEN @TOPARTY = '' AND @FROMPARTY <> '' THEN @FROMPARTY     
      WHEN @TOPARTY = '' AND @FROMPARTY = '' THEN 'ZZZZZZZZZZ'    
      ELSE @TOPARTY END)     
    
SELECT @TOSCRIP = (CASE WHEN @TOSCRIP = '' AND @FROMSCRIP <> '' THEN @FROMSCRIP     
      WHEN @TOSCRIP = '' AND @FROMSCRIP = '' THEN 'ZZZZZZZZZZ'    
      ELSE @TOSCRIP END)     
                  
SELECT ORGBUYDATE = CONVERT(VARCHAR,SAUDA_DATE,103),     
PROCESSDATE=CONVERT(VARCHAR,CONVERT(DATETIME,@FROMDATE),103),    
EXCHANGE = (CASE WHEN TRANSTYPE = 'TRBSE' THEN 'BSE' ELSE 'NSE' END),    
SETT_NO, SETT_TYPE,     
T.PARTY_CODE, LONG_NAME, SCRIP_NAME = CONVERT(VARCHAR(100),''),    
SCRIP_CD, SERIES, BSECODE, ISIN, QTY, MARKETVALUE=MKTAMT, NETVALUE = NETAMT,     
CL_RATE,    
HAIRCUT = CONVERT(NUMERIC(18,4),0),    
MTOMLOSS = CONVERT(NUMERIC(18,4),0),    
MARG_REQ = CONVERT(NUMERIC(18,4),0),    
TOTAL_REQ = CONVERT(NUMERIC(18,4),0),    
OPENDAY = DATEDIFF(D,SAUDA_DATE,CONVERT(DATETIME,@FROMDATE))    
INTO #DATA    
FROM MTFTRADE.DBO.TBL_PRODUCT_POSITION T WITH(NOLOCK), MSAJAG.DBO.CLIENT_DETAILS  C1  WITH(NOLOCK)  
WHERE SAUDA_DATE <= @FROMDATE     
AND ADJUST_DATE > @FROMDATE    
AND SELL_BUY = 1     
AND C1.CL_CODE = T.PARTY_CODE    
AND T.PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY    
AND @STATUSNAME =              
                  (CASE              
                        WHEN @STATUSID = 'BRANCH' THEN C1.BRANCH_CD              
                        WHEN @STATUSID = 'SUBBROKER' THEN C1.SUB_BROKER              
                        WHEN @STATUSID = 'TRADER' THEN C1.TRADER              
                        WHEN @STATUSID = 'FAMILY' THEN C1.FAMILY              
                        WHEN @STATUSID = 'AREA' THEN C1.AREA              
                        WHEN @STATUSID = 'REGION' THEN C1.REGION              
                        WHEN @STATUSID = 'CLIENT' THEN C1.CL_CODE              
                  ELSE              
                        'BROKER'              
                  END)        
    
UPDATE #DATA SET CL_RATE = CURR_CL_RATE,    
HAIRCUT = C.HAIRCUT    
FROM MTFTRADE.DBO.TBL_MTF_DATA C  WITH(NOLOCK)  
WHERE C.SAUDA_DATE = @FROMDATE    
AND #DATA.ISIN = C.ISIN    
AND #DATA.PARTY_CODE = C.PARTY_CODE    
  
  
SELECT PARTY_CODE, ISIN,QTY= SUM(QTY),MARGIN_REQ=SUM(MARGIN_REQ),MTOM_LOSS=SUM(MTOM_LOSS)   
INTO #MAR FROM MTFTRADE.DBO.TBL_MTF_DATA C  WITH(NOLOCK)  
WHERE C.SAUDA_DATE = @FROMDATE    
GROUP BY PARTY_CODE,ISIN  
  
UPDATE #DATA SET MTOMLOSS = (CL_RATE * QTY - MARKETVALUE )     
WHERE HAIRCUT <> 100    
    
UPDATE #DATA SET MARG_REQ = (CASE WHEN NETVALUE > CL_RATE*QTY THEN  CL_RATE * QTY * HAIRCUT / 100 ELSE NETVALUE * HAIRCUT / 100 END)   
    
  UPDATE #DATA SET MTOMLOSS = (C.MTOM_LOSS/C.QTY)*#DATA.QTY,  MARG_REQ=(C.MARGIN_REQ/C.QTY)*#DATA.QTY  
  FROM #MAR C  
  WHERE C.PARTY_CODE = #DATA.PARTY_CODE  
  AND C.ISIN= #DATA.ISIN  
  
  
UPDATE #DATA SET TOTAL_REQ = MARG_REQ - MTOMLOSS    
    
UPDATE #DATA SET SCRIP_NAME = S1.LONG_NAME FROM MSAJAG.DBO.SCRIP1 S1 WITH(NOLOCK), MSAJAG.DBO.SCRIP2 S2   WITH(NOLOCK)             
WHERE S1.CO_CODE = S2.CO_CODE AND S1.SERIES = S2.SERIES                
AND S2.SCRIP_CD = #DATA.SCRIP_CD AND S2.SERIES = #DATA.SERIES                
                
UPDATE #DATA SET SCRIP_NAME = S1.LONG_NAME FROM ANGELDEMAT.BSEDB.DBO.SCRIP1 S1 WITH(NOLOCK), ANGELDEMAT.BSEDB.DBO.SCRIP2 S2    WITH(NOLOCK)            
WHERE S1.CO_CODE = S2.CO_CODE AND S1.SERIES = S2.SERIES                
AND S2.BSECODE = #DATA.BSECODE               
AND SCRIP_NAME = ''         
    
SELECT DISTINCT PROCESSDATE, ISIN, SCRIP_CD, BSECODE, SUM (NETVALUE) AS NETVALUE  FROM #DATA    
WHERE SCRIP_NAME  >= @FROMSCRIP AND SCRIP_NAME  <= @TOSCRIP 
GROUP BY PROCESSDATE, ISIN, SCRIP_CD, BSECODE
ORDER BY PROCESSDATE, ISIN, SCRIP_CD, BSECODE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NSE_SCRIPMAPPINGUPLOAD_BKP04APR24_SRE24443
-- --------------------------------------------------



CREATE PROC [dbo].[NSE_SCRIPMAPPINGUPLOAD_BKP04APR24_SRE24443] (@FilePath Varchar(100)) AS            
                   
DROP TABLE TBL_EXCHG_SCRIP_MAP_TMP            
          
SELECT ISIN, BSECODE, BSE_GROUP, SCRIP_NAME, NSE_SCRIP_CD, NSE_SERIES, UPDFLAG = 0 
INTO TBL_EXCHG_SCRIP_MAP_TMP
FROM TBL_EXCHG_SCRIP_MAP        
WHERE 1 = 2           

SELECT ISIN, BSECODE, BSE_GROUP, SCRIP_NAME, NSE_SCRIP_CD, NSE_SERIES
INTO #TBL_EXCHG_SCRIP_MAP_TMP
FROM TBL_EXCHG_SCRIP_MAP        
WHERE 1 = 2     
          
--Bulk insert #Scrip_imp from @FilePath with  ( FIELDTERMINATOR = ',', ROWTERMINATOR = '\n' )             
EXEC Proc_Bulk_Ins_NEW '#TBL_EXCHG_SCRIP_MAP_TMP', @FilePath, ','            

UPDATE #TBL_EXCHG_SCRIP_MAP_TMP SET NSE_SCRIP_CD = ISNULL(NSE_SCRIP_CD,''), BSECODE = ISNULL(BSECODE,''), NSE_SERIES = ISNULL(NSE_SERIES,'')

INSERT INTO TBL_EXCHG_SCRIP_MAP_TMP
SELECT *,0 FROM #TBL_EXCHG_SCRIP_MAP_TMP

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NSENRIDETAIL_T1_15may2023
-- --------------------------------------------------
CREATE PROC  [dbo].[NSENRIDETAIL_T1_15may2023] (@SDATE AS VARCHAR(11),@SELL_BUY AS VARCHAR(1))                                    
AS                 
                
DECLARE @@SETT_NO VARCHAR(8),@@SETT_NO1 VARCHAR(8)                  
                    
SELECT @@SETT_NO = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'           
SELECT @@SETT_NO1 = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'          
              
select * into #party from (SELECT cl_code FROM MSAJAG.DBO.Client1 with (nolock) WHERE Cl_type ='NRI') a              
select a.* into #contractdata from MSAJAG.DBO.CONTRACT_DATA a with (nolock) inner join #party b on a.party_code=b.cl_code where SETT_NO in(@@SETT_NO,@@SETT_NO1) and SELL_BUY =@SELL_BUY                
                          
SELECT  'NSECM' AS EXCHANGE,PARTY_CODE,SAUDA_DATE,CONTRACTNO,                                
CASE WHEN SELL_BUY = 1 THEN 'P' ELSE 'S' END TRANSACTION_TYPE,                                
B.ISIN,PQTY+SQTY AS QTY,
--(PAMT+SAMT/NULLIF(PQTY,0)+NULLIF(SQTY,0)) RATE,
(PAMT+SAMT)/CASE WHEN (PQTY+SQTY)='0' THEN '1' ELSE (PQTY+SQTY) END AS RATE,
(ROUND(BROKERAGE,2)) AS BROK_PERSCRIP,
(PAMT+SAMT) AS TRANACTIONAMT

,cd.SCRIPNAME,cd.SCRIP_CD ,SETT_NO, (Cd.PRATE+cd.SRATE)TRATE  ,Service_Tax OtherCharges,INS_CHRG STT ,(Cd.broker_chrg+Cd.Turn_Tax+Cd.sebi_tax) OtherTax 
INTO #DATA
from #contractdata Cd with (nolock),[AngelDemat].MSAJAG.DBO.MULTIISIN AS B with (nolock)                
 WHERE Cd.SCRIP_CD <>'BROKERAGE'                
--AND PARTY_CODE IN (SELECT cl_code FROM Client1 WHERE Cl_type ='NRI')                          
AND Cd.SCRIP_CD=B.SCRIP_CD                        
AND Cd.SERIES=B.Series                         
AND VALID=1 AND SETT_NO in(@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                 
--AND VALID=1 AND SETT_NO='2021117' AND SELL_BUY = 1                
--and (PQTY+SQTY) !=0 

     
--DECLARE @SDATE AS VARCHAR(11)='MAR 19 2025' , @SELL_BUY AS VARCHAR(1)='2'     
SELECT EXCHANGE,PARTY_CODE, SAUDA_DATE, MAX(CONTRACTNO) AS CONTRACTNO,TRANSACTION_TYPE,ISIN,SUM(QTY) AS QTY,MAX(RATE) AS RATE,SUM(BROK_PERSCRIP) AS BROK_PERSCRIP,
--CASE WHEN @SELL_BUY='1' THEN SUM(TRANACTIONAMT) ELSE SUM(BROK_PERSCRIP)+SUM(TRANACTIONAMT) END AS TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,
CASE WHEN @SELL_BUY='1' THEN SUM(TRANACTIONAMT) ELSE SUM(TRANACTIONAMT) END AS TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,
MAX(TRATE) AS TRATE, SUM(OTHERCHARGES) AS OTHERCHARGES, SUM(STT) AS STT, SUM(OTHERTAX) AS OTHERTAX
INTO #MAIN_DATA
FROM #DATA
--WHERE PARTY_CODE IN ('ZR1529R','ZR73') --and ISIN='INE732I01013'
GROUP BY EXCHANGE,PARTY_CODE, SAUDA_DATE,TRANSACTION_TYPE,ISIN,SCRIPNAME,SCRIP_CD,SETT_NO

--SELECT EXCHANGE,PARTY_CODE, SAUDA_DATE, MAX(CONTRACTNO) AS CONTRACTNO,TRANSACTION_TYPE,ISIN,SUM(QTY) AS QTY,MAX(RATE) AS RATE,MAX(BROK_PERSCRIP) AS BROK_PERSCRIP,
--SUM(TRANACTIONAMT) AS TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,
--MAX(TRATE) AS TRATE, SUM(OTHERCHARGES) AS OTHERCHARGES, SUM(STT) AS STT, SUM(OTHERTAX) AS OTHERTAX
--INTO #MAIN_DATA
--FROM #DATA
----WHERE PARTY_CODE IN ('ZR1529R','ZR73') --and ISIN='INE732I01013'
--GROUP BY EXCHANGE,PARTY_CODE, SAUDA_DATE,TRANSACTION_TYPE,ISIN,SCRIPNAME,SCRIP_CD,SETT_NO

SELECT EXCHANGE,PARTY_CODE,SAUDA_DATE,CONTRACTNO,TRANSACTION_TYPE,ISIN,QTY,RATE,BROK_PERSCRIP,TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,TRATE,OTHERCHARGES,STT,OTHERTAX
FROM #MAIN_DATA  --- FINAL DATA

--------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NSENRIDETAIL_T1_BUYBACK
-- --------------------------------------------------

CREATE PROC  [dbo].[NSENRIDETAIL_T1_BUYBACK] (@SDATE AS VARCHAR(11),@SELL_BUY AS VARCHAR(1))                                    
AS                 
                
DECLARE @@SETT_NO VARCHAR(8),@@SETT_NO1 VARCHAR(8)                  
                    
SELECT @@SETT_NO = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='BX'           
SELECT @@SETT_NO1 = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='BX'          
              
select * into #party from (SELECT cl_code FROM MSAJAG.DBO.Client1 with (nolock) WHERE Cl_type ='NRI') a              
select a.* into #contractdata from MSAJAG.DBO.CONTRACT_DATA a with (nolock) inner join #party b on a.party_code=b.cl_code where SETT_NO in(@@SETT_NO,@@SETT_NO1) and SELL_BUY =@SELL_BUY                
                          
SELECT  'NSECM' AS EXCHANGE,PARTY_CODE,SAUDA_DATE,CONTRACTNO,                                
CASE WHEN SELL_BUY = 1 THEN 'P' ELSE 'S' END TRANSACTION_TYPE,                                
B.ISIN,PQTY+SQTY AS QTY,
--(PAMT+SAMT/NULLIF(PQTY,0)+NULLIF(SQTY,0)) RATE,
(PAMT+SAMT)/CASE WHEN (PQTY+SQTY)='0' THEN '1' ELSE (PQTY+SQTY) END AS RATE,
(ROUND(BROKERAGE,2)) AS BROK_PERSCRIP,
(PAMT+SAMT) AS TRANACTIONAMT

,cd.SCRIPNAME,cd.SCRIP_CD ,SETT_NO, (Cd.PRATE+cd.SRATE)TRATE  ,Service_Tax OtherCharges,INS_CHRG STT ,(Cd.broker_chrg+Cd.Turn_Tax+Cd.sebi_tax) OtherTax 
INTO #DATA
from #contractdata Cd with (nolock),[AngelDemat].MSAJAG.DBO.MULTIISIN AS B with (nolock)                
 WHERE Cd.SCRIP_CD <>'BROKERAGE'                
--AND PARTY_CODE IN (SELECT cl_code FROM Client1 WHERE Cl_type ='NRI')                          
AND Cd.SCRIP_CD=B.SCRIP_CD                        
AND Cd.SERIES=B.Series                         
AND VALID=1 AND SETT_NO in(@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                 
--AND VALID=1 AND SETT_NO='2021117' AND SELL_BUY = 1                
--and (PQTY+SQTY) !=0 

     
--DECLARE @SDATE AS VARCHAR(11)='MAR 19 2025' , @SELL_BUY AS VARCHAR(1)='2'     
SELECT EXCHANGE,PARTY_CODE, SAUDA_DATE, MAX(CONTRACTNO) AS CONTRACTNO,TRANSACTION_TYPE,ISIN,SUM(QTY) AS QTY,MAX(RATE) AS RATE,SUM(BROK_PERSCRIP) AS BROK_PERSCRIP,
--CASE WHEN @SELL_BUY='1' THEN SUM(TRANACTIONAMT) ELSE SUM(BROK_PERSCRIP)+SUM(TRANACTIONAMT) END AS TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,
CASE WHEN @SELL_BUY='1' THEN SUM(TRANACTIONAMT) ELSE SUM(TRANACTIONAMT) END AS TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,
MAX(TRATE) AS TRATE, SUM(OTHERCHARGES) AS OTHERCHARGES, SUM(STT) AS STT, SUM(OTHERTAX) AS OTHERTAX
INTO #MAIN_DATA
FROM #DATA
--WHERE PARTY_CODE IN ('ZR1529R','ZR73') --and ISIN='INE732I01013'
GROUP BY EXCHANGE,PARTY_CODE, SAUDA_DATE,TRANSACTION_TYPE,ISIN,SCRIPNAME,SCRIP_CD,SETT_NO

--SELECT EXCHANGE,PARTY_CODE, SAUDA_DATE, MAX(CONTRACTNO) AS CONTRACTNO,TRANSACTION_TYPE,ISIN,SUM(QTY) AS QTY,MAX(RATE) AS RATE,MAX(BROK_PERSCRIP) AS BROK_PERSCRIP,
--SUM(TRANACTIONAMT) AS TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,
--MAX(TRATE) AS TRATE, SUM(OTHERCHARGES) AS OTHERCHARGES, SUM(STT) AS STT, SUM(OTHERTAX) AS OTHERTAX
--INTO #MAIN_DATA
--FROM #DATA
----WHERE PARTY_CODE IN ('ZR1529R','ZR73') --and ISIN='INE732I01013'
--GROUP BY EXCHANGE,PARTY_CODE, SAUDA_DATE,TRANSACTION_TYPE,ISIN,SCRIPNAME,SCRIP_CD,SETT_NO

SELECT EXCHANGE,PARTY_CODE,SAUDA_DATE,CONTRACTNO,TRANSACTION_TYPE,ISIN,QTY,RATE,BROK_PERSCRIP,TRANACTIONAMT,SCRIPNAME,SCRIP_CD,SETT_NO,TRATE,OTHERCHARGES,STT,OTHERTAX
FROM #MAIN_DATA  --- FINAL DATA

--------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NSENRIHEADER_t1
-- --------------------------------------------------
  
CREATE PROC  [dbo].[NSENRIHEADER_t1] (@SDATE AS VARCHAR(11),@SELL_BUY AS VARCHAR(1))               
AS                            
DECLARE @@SETT_NO VARCHAR(8) ,@@SETT_NO1 VARCHAR(8)              
              
SELECT @@SETT_NO = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'         
SELECT @@SETT_NO1 = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'         
  
  
CREATE TABLE #DATA (EXCHANGE VARCHAR(50), PARTY_CODE VARCHAR(50),SAUDA_DATE VARCHAR(50), SELL_BUY INT, CONTRACTNO VARCHAR(50)   ---- ADDED ON 18 FEB 2025 SRE-34258  
,SERVICE_TAX MONEY, EDUCESS MONEY, EXCHAGE_LEVIES MONEY,STT MONEY,STAMPDUTY MONEY,MINBROKERAGE MONEY,OTHER_CHARGES MONEY  
,NO_OF_TRANSACTIONS INT, TOTALAMT MONEY, SETT_NO VARCHAR(50))  
  
 INSERT INTO #DATA          ---- ADDED ON 18 FEB 2025 SRE-34258  
 SELECT EXCHANGE,A.PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,ROUND(SUM(SERVICE_TAX+ISNULL(NSERTAX,0)),2)SERVICE_TAX,                          
 EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,ISNULL(MINBROKERAGE,0)MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,                        
 ROUND((TOTALAMT),2)TOTALAMT ,a.SETT_NO                          
 FROM                          
(SELECT  'NSECM' AS EXCHANGE,PARTY_CODE,SAUDA_DATE,SELL_BUY, CONTRACTNO,     ---- CHANGES ON 18 FEB 2025 SRE-34258  
SUM(NSERTAX)AS SERVICE_TAX,0 AS EDUCESS,ROUND(SUM(TURN_TAX),2) AS EXCHAGE_LEVIES,SUM(INS_CHRG)AS STT,                            
ROUND(SUM(BROKER_CHRG),2) AS STAMPDUTY,                            
ROUND(SUM(SEBI_TAX),2) AS OTHER_CHARGES,COUNT(PARTY_CODE) AS NO_OF_TRANSACTIONS,                            
case when @SELL_BUY=1 then SUM(PAMT+SAMT)+SUM(INS_CHRG+NSERTAX+BROKER_CHRG+TURN_TAX+SEBI_TAX)   
else  SUM(PAMT+SAMT)- SUM(INS_CHRG+NSERTAX+BROKER_CHRG+TURN_TAX+SEBI_TAX)  end AS TOTALAMT  , SETT_NO                         
from MSAJAG.DBO.CONTRACT_DATA WHERE SETT_NO in (@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                          
And SCRIP_CD <>'BROKERAGE'  AND PARTY_CODE IN (                        
SELECT cl_code FROM MSAJAG.DBO.Client1 WHERE Cl_type ='NRI')                        
GROUP BY PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO ,SETT_NO ) A                          
LEFT OUTER JOIN                           
(SELECT  PARTY_CODE,NSERTAX,BROKERAGE AS MINBROKERAGE,SETT_NO                            
from MSAJAG.DBO.CONTRACT_DATA WHERE SETT_NO in (@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                          
AND PARTY_CODE IN (SELECT cl_code FROM MSAJAG.DBO.Client1 WHERE Cl_type ='NRI')                        
and SCRIP_CD = 'BROKERAGE')B                          
ON A.PARTY_CODE=B.PARTY_CODE and a.SETT_NO=b.SETT_NO                         
GROUP BY EXCHANGE,A.PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,                          
 EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,TOTALAMT,NSERTAX ,                
 SERVICE_TAX,a.SETT_NO  
  
 --SELECT * FROM #DATA  
  
SELECT * INTO #MAIN_DATA FROM #DATA WHERE CONTRACTNO<>'0'  
SELECT * INTO #C_ZERO FROM #DATA WHERE CONTRACTNO='0'  
  
--DECLARE @SDATE AS VARCHAR(11)='MAR  5 2025' , @SELL_BUY AS VARCHAR(1)='2'  
SELECT M.EXCHANGE,M.PARTY_CODE,M.SAUDA_DATE,M.SELL_BUY,M.CONTRACTNO, (M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EDUCESS+Z.EDUCESS) AS EDUCESS,  
(M.EXCHAGE_LEVIES+Z.EXCHAGE_LEVIES) AS EXCHAGE_LEVIES, (M.STT+Z.STT) AS STT, (M.STAMPDUTY+Z.STAMPDUTY) AS STAMPDUTY, (M.MINBROKERAGE+Z.MINBROKERAGE) AS MINBROKERAGE,  
(M.OTHER_CHARGES+Z.OTHER_CHARGES) AS OTHER_CHARGES,M.NO_OF_TRANSACTIONS, CASE WHEN @SELL_BUY='1' THEN M.TOTALAMT+Z.TOTALAMT ELSE M.TOTALAMT END AS TOTALAMT,M.SETT_NO  
INTO #CONTRACT_ZERO  
FROM #MAIN_DATA M INNER JOIN #C_ZERO Z ON Z.PARTY_CODE=M.PARTY_CODE  
  
--SELECT M.EXCHANGE,M.PARTY_CODE,M.SAUDA_DATE,M.SELL_BUY,M.CONTRACTNO, (M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EDUCESS+Z.EDUCESS) AS EDUCESS,  
--(M.EXCHAGE_LEVIES+Z.EXCHAGE_LEVIES) AS EXCHAGE_LEVIES, (M.STT+Z.STT) AS STT, (M.STAMPDUTY+Z.STAMPDUTY) AS STAMPDUTY, (M.MINBROKERAGE+Z.MINBROKERAGE) AS MINBROKERAGE,  
--(M.OTHER_CHARGES+Z.OTHER_CHARGES) AS OTHER_CHARGES,M.NO_OF_TRANSACTIONS, (M.TOTALAMT+Z.TOTALAMT) AS TOTALAMT,M.SETT_NO  
----INTO #CONTRACT_ZERO  
--FROM #MAIN_DATA M INNER JOIN #C_ZERO Z ON Z.PARTY_CODE=M.PARTY_CODE  
  
DELETE FROM #MAIN_DATA WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO)  
   
INSERT INTO #MAIN_DATA  
SELECT * FROM #CONTRACT_ZERO  
  
SELECT * FROM #MAIN_DATA --- FINAL DATA

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NSENRIHEADER_t1_07Feb2025
-- --------------------------------------------------

Create PROC  [dbo].[NSENRIHEADER_t1_07Feb2025] (@SDATE AS VARCHAR(11),@SELL_BUY AS VARCHAR(1))             
AS                          
DECLARE @@SETT_NO VARCHAR(8) ,@@SETT_NO1 VARCHAR(8)            
            
SELECT @@SETT_NO = SETT_NO FROM SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'       
SELECT @@SETT_NO1 = SETT_NO FROM SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'       
          
 SELECT EXCHANGE,A.PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,ROUND(SUM(SERVICE_TAX+ISNULL(NSERTAX,0)),2)SERVICE_TAX,                        
 EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,ISNULL(MINBROKERAGE,0)MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,                      
 ROUND((TOTALAMT),2)TOTALAMT ,a.SETT_NO                        
 FROM                        
(SELECT  'NSECM' AS EXCHANGE,PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,                          
SUM(NSERTAX)AS SERVICE_TAX,0 AS EDUCESS,ROUND(SUM(TURN_TAX),2) AS EXCHAGE_LEVIES,SUM(INS_CHRG)AS STT,                          
ROUND(SUM(BROKER_CHRG),2) AS STAMPDUTY,                          
ROUND(SUM(SEBI_TAX),2) AS OTHER_CHARGES,COUNT(PARTY_CODE) AS NO_OF_TRANSACTIONS,                          
case when @SELL_BUY=1 then SUM(PAMT+SAMT)+SUM(INS_CHRG+NSERTAX+BROKER_CHRG+TURN_TAX+SEBI_TAX) 
else  SUM(PAMT+SAMT)- SUM(INS_CHRG+NSERTAX+BROKER_CHRG+TURN_TAX+SEBI_TAX)  end AS TOTALAMT  , SETT_NO                       
from CONTRACT_DATA WHERE SETT_NO in (@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                        
And SCRIP_CD <>'BROKERAGE'  AND PARTY_CODE IN (                      
SELECT cl_code FROM Client1 WHERE Cl_type ='NRI')                      
GROUP BY PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO ,SETT_NO ) A                        
LEFT OUTER JOIN                         
(SELECT  PARTY_CODE,NSERTAX,BROKERAGE AS MINBROKERAGE,SETT_NO                          
from CONTRACT_DATA WHERE SETT_NO in (@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                        
AND PARTY_CODE IN (SELECT cl_code FROM Client1 WHERE Cl_type ='NRI')                      
and SCRIP_CD = 'BROKERAGE')B                        
ON A.PARTY_CODE=B.PARTY_CODE and a.SETT_NO=b.SETT_NO                       
GROUP BY EXCHANGE,A.PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,                        
 EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,TOTALAMT,NSERTAX ,              
 SERVICE_TAX,a.SETT_NO

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NSENRIHEADER_t1_BUYBACK
-- --------------------------------------------------


CREATE PROC  [dbo].[NSENRIHEADER_t1_BUYBACK] (@SDATE AS VARCHAR(11),@SELL_BUY AS VARCHAR(1))             
AS                          
DECLARE @@SETT_NO VARCHAR(8) ,@@SETT_NO1 VARCHAR(8)            
            
SELECT @@SETT_NO = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='BX'       
SELECT @@SETT_NO1 = SETT_NO FROM MSAJAG.DBO.SETT_MST WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='BX'       


CREATE TABLE #DATA (EXCHANGE VARCHAR(50), PARTY_CODE VARCHAR(50),SAUDA_DATE VARCHAR(50), SELL_BUY INT, CONTRACTNO VARCHAR(50)   ---- ADDED ON 18 FEB 2025 SRE-34258
,SERVICE_TAX MONEY, EDUCESS MONEY, EXCHAGE_LEVIES MONEY,STT MONEY,STAMPDUTY MONEY,MINBROKERAGE MONEY,OTHER_CHARGES MONEY
,NO_OF_TRANSACTIONS INT, TOTALAMT MONEY, SETT_NO VARCHAR(50),SETT_TYPE VARCHAR(50))

 INSERT INTO #DATA										---- ADDED ON 18 FEB 2025 SRE-34258
 SELECT EXCHANGE,A.PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,ROUND(SUM(SERVICE_TAX+ISNULL(NSERTAX,0)),2)SERVICE_TAX,                        
 EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,ISNULL(MINBROKERAGE,0)MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,                      
 ROUND((TOTALAMT),2)TOTALAMT ,a.SETT_NO ,a.SETT_TYPE                       
 FROM                        
(SELECT  'NSECM' AS EXCHANGE,PARTY_CODE,SAUDA_DATE,SELL_BUY, CONTRACTNO,     ---- CHANGES ON 18 FEB 2025 SRE-34258
SUM(NSERTAX)AS SERVICE_TAX,0 AS EDUCESS,ROUND(SUM(TURN_TAX),2) AS EXCHAGE_LEVIES,SUM(INS_CHRG)AS STT,                          
ROUND(SUM(BROKER_CHRG),2) AS STAMPDUTY,                          
ROUND(SUM(SEBI_TAX),2) AS OTHER_CHARGES,COUNT(PARTY_CODE) AS NO_OF_TRANSACTIONS,                          
case when @SELL_BUY=1 then SUM(PAMT+SAMT)+SUM(INS_CHRG+NSERTAX+BROKER_CHRG+TURN_TAX+SEBI_TAX) 
else  SUM(PAMT+SAMT)- SUM(INS_CHRG+NSERTAX+BROKER_CHRG+TURN_TAX+SEBI_TAX)  end AS TOTALAMT  , SETT_NO ,SETT_TYPE                       
from MSAJAG.DBO.CONTRACT_DATA WHERE SETT_NO in (@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                        
And SCRIP_CD <>'BROKERAGE'  AND PARTY_CODE IN (                      
SELECT cl_code FROM MSAJAG.DBO.Client1 WHERE Cl_type ='NRI')                      
GROUP BY PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO ,SETT_NO ,SETT_TYPE) A                        
LEFT OUTER JOIN                         
(SELECT  PARTY_CODE,NSERTAX,BROKERAGE AS MINBROKERAGE,SETT_NO,SETT_TYPE                          
from MSAJAG.DBO.CONTRACT_DATA WHERE SETT_NO in (@@SETT_NO,@@SETT_NO1) AND SELL_BUY = @SELL_BUY                        
AND PARTY_CODE IN (SELECT cl_code FROM MSAJAG.DBO.Client1 WHERE Cl_type ='NRI')                      
and SCRIP_CD = 'BROKERAGE')B                        
ON A.PARTY_CODE=B.PARTY_CODE and a.SETT_NO=b.SETT_NO                       
GROUP BY EXCHANGE,A.PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,                        
 EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,TOTALAMT,NSERTAX ,              
 SERVICE_TAX,a.SETT_NO,a.SETT_TYPE

 --SELECT * FROM #DATA

SELECT * INTO #MAIN_DATA FROM #DATA WHERE CONTRACTNO<>'0'
SELECT * INTO #C_ZERO FROM #DATA WHERE CONTRACTNO='0'

--DECLARE @SDATE AS VARCHAR(11)='MAR  5 2025' , @SELL_BUY AS VARCHAR(1)='2'
SELECT M.EXCHANGE,M.PARTY_CODE,M.SAUDA_DATE,M.SELL_BUY,M.CONTRACTNO, (M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EDUCESS+Z.EDUCESS) AS EDUCESS,
(M.EXCHAGE_LEVIES+Z.EXCHAGE_LEVIES) AS EXCHAGE_LEVIES, (M.STT+Z.STT) AS STT, (M.STAMPDUTY+Z.STAMPDUTY) AS STAMPDUTY, (M.MINBROKERAGE+Z.MINBROKERAGE) AS MINBROKERAGE,
(M.OTHER_CHARGES+Z.OTHER_CHARGES) AS OTHER_CHARGES,M.NO_OF_TRANSACTIONS, CASE WHEN @SELL_BUY='1' THEN M.TOTALAMT+Z.TOTALAMT ELSE M.TOTALAMT-(Z.TOTALAMT * -1) END AS TOTALAMT,M.SETT_NO,M.SETT_TYPE
INTO #CONTRACT_ZERO
FROM #MAIN_DATA M INNER JOIN #C_ZERO Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE 

--SELECT M.EXCHANGE,M.PARTY_CODE,M.SAUDA_DATE,M.SELL_BUY,M.CONTRACTNO, (M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EDUCESS+Z.EDUCESS) AS EDUCESS,
--(M.EXCHAGE_LEVIES+Z.EXCHAGE_LEVIES) AS EXCHAGE_LEVIES, (M.STT+Z.STT) AS STT, (M.STAMPDUTY+Z.STAMPDUTY) AS STAMPDUTY, (M.MINBROKERAGE+Z.MINBROKERAGE) AS MINBROKERAGE,
--(M.OTHER_CHARGES+Z.OTHER_CHARGES) AS OTHER_CHARGES,M.NO_OF_TRANSACTIONS, (M.TOTALAMT+Z.TOTALAMT) AS TOTALAMT,M.SETT_NO
----INTO #CONTRACT_ZERO
--FROM #MAIN_DATA M INNER JOIN #C_ZERO Z ON Z.PARTY_CODE=M.PARTY_CODE

DELETE FROM #MAIN_DATA WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO)
 
INSERT INTO #MAIN_DATA
SELECT * FROM #CONTRACT_ZERO

SELECT EXCHANGE,PARTY_CODE,SAUDA_DATE,SELL_BUY,CONTRACTNO,SERVICE_TAX,EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,OTHER_CHARGES,NO_OF_TRANSACTIONS,TOTALAMT,SETT_NO
FROM #MAIN_DATA --- FINAL DATA

GO

-- --------------------------------------------------
-- PROCEDURE dbo.POP_COMMON_CONTRACTDATA_BKP_03SEP2024
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[POP_COMMON_CONTRACTDATA_BKP_03SEP2024]   
(  
@FROMDATE VARCHAR(11),  
@USERNAME VARCHAR(20) = '',  
@CONTRACTGROUP VARCHAR(20) = ''  
)  
  
AS                                                     
/*                                      
EXEC POP_COMMON_CONTRACTDATA_ANGEL 'SEP  9 2015','SURESH'                                      
EXEC POP_COMMON_CONTRACTDATA_ANGEL 'DEC 24 2014','','ZZZZZZZZZZZZZ'                                      
*/                                   
SET NOCOUNT ON;

DECLARE @SDDATE DATETIME
SET @SDDATE=GETDATE()

                             
EXEC POP_COMMON_CONTRACTDATA_DATAFETCH  @FROMDATE  
  
                                      
DECLARE @FROMPARTY VARCHAR(10)                                      
DECLARE @TOPARTY VARCHAR(10)                                      
                                      
SET @FROMPARTY = ''                                      
SET @TOPARTY = 'zzzzzzzzzzzz'                                      
                                      
CREATE TABLE #CONTRACT (                                      
 CONTRACTNO VARCHAR(10),                                      
 CONTRACTNO_NEW VARCHAR(10),                                      
 SAUDA_DATE DATETIME,                                      
 SETT_NO VARCHAR(10),                                      
 SETT_TYPE VARCHAR(3),                                      
 SETT_DATE VARCHAR(11),                                      
 EXCHANGE VARCHAR(3),                                      
 SEGMENT VARCHAR(10),                                      
 ORDER_NO VARCHAR(20),                                      
 ORDER_TIME VARCHAR(8),                                      
 TRADE_NO VARCHAR(16),                                      
 TRADE_TIME VARCHAR(8),                                      
 SCRIPNAME VARCHAR(100),                                      
 QTY BIGINT,                                      
 TMARK VARCHAR(1),                                      
 SELL_BUY VARCHAR(1),                                      
  MARKETRATE NUMERIC (36,18),                                  
 MARKETAMT NUMERIC (36,18),                                  
 BROKERAGE NUMERIC (36,18),                                  
 SERVICE_TAX NUMERIC (36,18),                                  
 INS_CHRG NUMERIC (36,18),                                  
 NETAMOUNT NUMERIC (36,18),                                  
 SEBI_TAX NUMERIC (36,18),                                  
 TURN_TAX NUMERIC (36,18),                                  
 BROKER_CHRG NUMERIC (36,18),                                  
 OTHER_CHRG NUMERIC (36,18),                                  
 NETAMOUNTALL NUMERIC (36,18),                                  
 BROK NUMERIC (36,18),                                  
 NETRATE NUMERIC (36,18),                                  
 CL_RATE NUMERIC (36,18),                                      
 BROKERSEBIREGNO VARCHAR(20),                                      
 MEMBERCODE VARCHAR(50),                                      
 CINNO VARCHAR(100),                                      
 SETTTYPE_DESC VARCHAR(35),                                      
 BFCF_FLAG VARCHAR(6),                                      
 CONTRACT_HEADER_DET VARCHAR(200),                                      
 REMARK VARCHAR(100),                                      
 COMPANYNAME VARCHAR(100),                                      
 USER_ID VARCHAR(20),                                      
 REMARK_ID VARCHAR(1),                                      
 REMARK_DESC VARCHAR(200),                                      
NETOBLIGATION NUMERIC (36,18),                                    
 BRANCH_CD VARCHAR(15),                                      
 SUB_BROKER VARCHAR(15),                                      
 TRADER VARCHAR(25),                                      
 AREA VARCHAR(25),                                      
 REGION VARCHAR(25),                                      
 FAMILY VARCHAR(15),                                      
 PARTY_CODE VARCHAR(15),                     PARTYNAME VARCHAR(100),                                      
 L_ADDRESS1 VARCHAR(100),                                      
 L_ADDRESS2 VARCHAR(100),                                      
 L_ADDRESS3 VARCHAR(100),                                      
 L_STATE VARCHAR(50),                                      
 L_CITY VARCHAR(50),              
 L_ZIP VARCHAR(10),                                      
 OFF_PHONE1 VARCHAR(50),                                      
 OFF_PHONE2 VARCHAR(50),                   
 PAN_GIR_NO VARCHAR(15),                                      
 MAPIDID VARCHAR(20),                                      
 UCC_CODE VARCHAR(20),      
 SEBI_NO VARCHAR(25),                                      
 PARTICIPANT_CODE VARCHAR(16),                                      
 CL_TYPE VARCHAR(3),                                      
 SERVICE_CHRG TINYINT,                                      
 PRINTF TINYINT ,                                    
 BOOKTYPE INT,            
 INSTRUMENT INT,  
 ISIN VARCHAR(12)       
 )                                      
                                      
CREATE CLUSTERED INDEX [IDXCONT] ON [DBO].[#CONTRACT] (                                      
 [PARTY_CODE],                                      
 [EXCHANGE],                                      
 [SEGMENT],                                      
 [SCRIPNAME] ,   
 [USER_ID],  
 [ORDER_NO]                                   
 )                      
  
CREATE NONCLUSTERED INDEX [IDXUSER] ON [DBO].[#CONTRACT] (    
 [ORDER_NO],
 [TRADE_NO]  ,  
 [USER_ID] ,
 [SETT_TYPE])  
   
CREATE TABLE #CONTRACT_TERMINAL_MAPPING  
(  
TERMINAL_ID VARCHAR(10),  
ORDER_NO VARCHAR(20),  
REMARK_ID VARCHAR(1),  
REMARK_DESC VARCHAR(200)  
)  
  
CREATE CLUSTERED INDEX [INDXCONTMAP] ON [DBO].[#CONTRACT_TERMINAL_MAPPING] ([ORDER_NO],[TERMINAL_ID])    
                                      
CREATE TABLE #MTOM_FNO (                                      
 PARTY_CODE VARCHAR(15),                                      
 MTM NUMERIC (36,18),                                        
 EXCHANGE VARCHAR(5),                                      
 SEGMENT VARCHAR(10)                                      
 )                                      
                                      
CREATE TABLE #PARTY (PARTYCODE VARCHAR(10))        
CREATE CLUSTERED INDEX [INDXPARTYCODE] ON [DBO].[#PARTY] (PARTYCODE)        
  
                                
                                      
CREATE TABLE #FOCLOSING                                      
 (                            
 SRNO  INT IDENTITY(1,1),                                      
 TRADE_DATE DATETIME,                                      
 SCRIPNAME VARCHAR(150),                                      
 CL_RATE  NUMERIC (36,18),  
 EXCHANGE VARCHAR(10),                                        
 SEGMENT VARCHAR(20)  
 )                                      
                                       
CREATE CLUSTERED INDEX [INDXCLOSING] ON [DBO].[#FOCLOSING] ([SCRIPNAME])                                      
                                      
DECLARE @FNOBILL_FLAG INT   
SET @FNOBILL_FLAG = 0  
DECLARE @CONTRACT_GROUP INT
DECLARE @CONTRACT_T1T2 INT  
  
SELECT @FNOBILL_FLAG = ISNULL(FNO_CONTRACT_BILL,''), @CONTRACT_GROUP = ISNULL(CONTRACTGROUP,0),@CONTRACT_T1T2 = ISNULL(CONTRACTNO_T1T2,0) FROM TBL_COMMONCONTRACT_MASTER (NOLOCK)  
WHERE @FROMDATE BETWEEN EFFECTIVE_FROM  AND EFFECTIVE_TO  
                                      
DECLARE @COMPANYNAME VARCHAR(150)                                      
DECLARE @EXCHANGE_NEW VARCHAR(3)                                      
DECLARE @SEGMENT_NEW VARCHAR(10)                                      
DECLARE @SHAREDB VARCHAR(35)                                      
DECLARE @SHARESERVER VARCHAR(35)                                      
DECLARE @ACCOUNTDB VARCHAR(35)                    
DECLARE @ACCOUNTSERVER VARCHAR(35)                                      
DECLARE @CONTRACTGROUP_NEW VARCHAR(20)  
DECLARE @CONTRACTGROUP_NEW1 VARCHAR(20)  
                                      
DECLARE @EXCHANGEWISE_CURSOR CURSOR   
DECLARE @EXCHANGEWISE_CURSOR_NEW CURSOR   
DECLARE @STRSQL VARCHAR(8000)   
SELECT EXCHANGE,                                      
 SEGMENT INTO #CLIENT_BROK_DETAILS FROM MSAJAG.DBO.CLIENT_BROK_DETAILS(NOLOCK)   
 GROUP BY EXCHANGE,SEGMENT   
  
SELECT DISTINCT COMPANYNAME,                                      
 EXCHANGE = M.EXCHANGE,                                      
 SEGMENT = M.SEGMENT,                                      
 SHAREDB,                                      
 SHARESERVER,                                      
 ACCOUNTDB,                                      
 ACCOUNTSERVER,  
 CONTRACTGROUP_NEW = (CASE WHEN @CONTRACT_GROUP = 1 THEN ISNULL(CONTRACTGROUP,'') ELSE '' END)   
 INTO #CONTMULTI  
FROM PRADNYA..MULTICOMPANY M(NOLOCK)  
,#CLIENT_BROK_DETAILS CB(NOLOCK)                                      
WHERE                                       
CATEGORY IN (                                      
  'EQUITY',                             
  'DERIVATIVES',                                      
  'CURRENCY'                                      
  )                                      
 --TEST                                       
 --AND M.EXCHANGE='BSE'               
 --TEST                                      
 AND M.SEGMENT NOT IN ('SLBS')                                      
 AND SEGMENT_DESCRIPTION NOT LIKE '%PCM%'                                      
 AND CB.EXCHANGE = M.EXCHANGE    
 --AND M.EXCHANGE <>'BSX'                                    
 AND CB.SEGMENT = M.SEGMENT                                      
 AND PRIMARYSERVER = 1                                      
 AND ISNULL(CONTRACTGROUP,'') = (CASE WHEN @CONTRACTGROUP = '' THEN ISNULL(CONTRACTGROUP,'') ELSE @CONTRACTGROUP END)  
  
   
  
   
 SET @EXCHANGEWISE_CURSOR = CURSOR  FOR                                      
 select * from #CONTMULTI  
                                      
/*                       
 AND M.EXCHANGE + M.SEGMENT = (                                      
  CASE                                       
   WHEN @EXCHANGE = ''                                      
    THEN M.EXCHANGE + M.SEGMENT                                      
   WHEN @EXCHANGE = 'CASH'                                      
    THEN (                                      
      SELECT DISTINCT EXCHANGE + SEGMENT                                      
      FROM PRADNYA..MULTICOMPANY M1(NOLOCK)                                      
      WHERE SEGMENT = 'CAPITAL'                                      
       AND M1.EXCHANGE = M.EXCHANGE                                      
  AND M1.SEGMENT = M.SEGMENT                                      
      )                                      
   WHEN @EXCHANGE = 'FUTURES'                                      
    THEN (                                      
      SELECT DISTINCT EXCHANGE + SEGMENT                                      
      FROM PRADNYA..MULTICOMPANY M2(NOLOCK)                                      
      WHERE SEGMENT = 'FUTURES'                             
       AND M2.EXCHANGE = M.EXCHANGE                                      
       AND M2.SEGMENT = M.SEGMENT                                      
      )                                      
   ELSE @EXCHANGE                                      
   END                                      
  )                                      
 AND COMPANYNAME = (CASE WHEN @COMPANY_NAME = '' THEN COMPANYNAME ELSE @COMPANY_NAME END)                                      
 */                                      
OPEN @EXCHANGEWISE_CURSOR                                      
                                      
FETCH NEXT                            
FROM @EXCHANGEWISE_CURSOR                                      
INTO @COMPANYNAME,                                      
 @EXCHANGE_NEW,                                      
 @SEGMENT_NEW,                                      
 @SHAREDB,                       
 @SHARESERVER,                                      
 @ACCOUNTDB,                                      
 @ACCOUNTSERVER,  
 @CONTRACTGROUP_NEW                                      
                                    
WHILE @@FETCH_STATUS = 0                                      
BEGIN                                      
 SET @STRSQL = '' 
 
 IF @SHARESERVER = @@SERVICENAME
	BEGIN
		SET @SHARESERVER =''
	END
	ELSE
	BEGIN
		SET @SHARESERVER = @SHARESERVER + '.'
	END
 IF @SHARESERVER = @@SERVICENAME AND @SHAREDB = 'MSAJAG'	  
	BEGIN
	    SET @SHAREDB = ''
	END	                               
                                      
 IF @SEGMENT_NEW = 'CAPITAL'                                      
 BEGIN   
 --PRINT 'D1'                                                                                                             
  SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME=''CONTRACT_DATA_COMMON'') > 0 '                                      
  SET @STRSQL = @STRSQL + ' BEGIN '                                      
  SET @STRSQL = @STRSQL + 'TRUNCATE TABLE #PARTY '                                      
  SET @STRSQL = @STRSQL + ' INSERT INTO #PARTY '                                      
  SET @STRSQL = @STRSQL + ' SELECT DISTINCT PARTY_CODE FROM '                                      
  SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CONTRACT_MASTER_COMMON WITH (NOLOCK) WHERE CONVERT(DATETIME,START_DATE,103) BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'' 
  AND PARTY_CODE BETWEEN ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''''                                      
  SET @STRSQL = @STRSQL + ' END '                               
  --PRINT 'D2'                                                                                                                                               
  --PRINT @STRSQL                                      
  EXEC (@STRSQL)                                      
                                      
  SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME=''CONTRACT_DATA_COMMON'') > 0 '              
  SET @STRSQL = @STRSQL + 'BEGIN '                                      
  SET @STRSQL = @STRSQL + 'INSERT INTO #CONTRACT '                                      
  SET @STRSQL = @STRSQL + 'SELECT '                                      
  SET @STRSQL = @STRSQL + ' CONTRACTNO,'                                      
  SET @STRSQL = @STRSQL + ' CONTRACTNO_NEW = CONTRACTNO,'                                      
  SET @STRSQL = @STRSQL + ' SAUDA_DATE = CONVERT(DATETIME,SAUDA_DATE,109),'                                      
                     
  IF @SHAREDB = 'BSEDB_AB'                                      
  BEGIN                                      
   SET @STRSQL = @STRSQL + ' SETT_NO =   MSAJAG.DBO.CONVERTSETTNO(D.SETT_NO,1),'                                      
  END                                      
  ELSE                                      
  BEGIN                                      
   SET @STRSQL = @STRSQL + ' SETT_NO = D.SETT_NO,'                                  
  END                                      
                                    
  SET @STRSQL = @STRSQL + ' SETT_TYPE = D.SETT_TYPE,'                                      
  SET @STRSQL = @STRSQL + ' SETT_DATE = FUNDS_PAYIN,'                                      
  SET @STRSQL = @STRSQL + ' EXCHANGE = ''' + @EXCHANGE_NEW + ''','                                      
  SET @STRSQL = @STRSQL + ' SEGMENT = ''' + @SEGMENT_NEW + ''','                                      
  SET @STRSQL = @STRSQL + ' ORDER_NO,'                       
  SET @STRSQL = @STRSQL + ' ORDER_TIME,'                                      
  SET @STRSQL = @STRSQL + ' TRADE_NO,'            
  SET @STRSQL = @STRSQL + ' TRADE_TIME=TM,'                                      
  SET @STRSQL = @STRSQL + ' SCRIPNAME,'                                      
  SET @STRSQL = @STRSQL + ' QTY=PQTY+SQTY,'                                      
  SET @STRSQL = @STRSQL + ' TMARK,'                                      
  SET @STRSQL = @STRSQL + ' SELL_BUY,'                          
  SET @STRSQL = @STRSQL + ' MARKETRATE = PRATE+SRATE,'                                      
  SET @STRSQL = @STRSQL + ' MARKETAMT = ((PRATE + SRATE)*(PQTY+SQTY)),'                    
  SET @STRSQL = @STRSQL + ' BROKERAGE,'                                      
  SET @STRSQL = @STRSQL + ' SERVICE_TAX = NSERTAX,'                                      
  SET @STRSQL = @STRSQL + ' INS_CHRG,'                                      
  SET @STRSQL = @STRSQL + ' NETAMOUNT = ('                                      
  SET @STRSQL = @STRSQL + ' CASE'                                      
  SET @STRSQL = @STRSQL + ' WHEN SELL_BUY = 1'                                      
  SET @STRSQL = @STRSQL + ' THEN -(PAMT)'                                      
  SET @STRSQL = @STRSQL + ' ELSE (SAMT)'                                      
  SET @STRSQL = @STRSQL + ' END),'                                      
  SET @STRSQL = @STRSQL + ' SEBI_TAX,'                                      
  SET @STRSQL = @STRSQL + ' TURN_TAX,'        
  SET @STRSQL = @STRSQL + ' BROKER_CHRG,'                   
  SET @STRSQL = @STRSQL + ' OTHER_CHRG,'                                      
  SET @STRSQL = @STRSQL + ' NETAMOUNTALL = ('                                      
  SET @STRSQL = @STRSQL + ' CASE'                                      
  SET @STRSQL = @STRSQL + ' WHEN SELL_BUY = 1'                                      
  SET @STRSQL = @STRSQL + ' THEN -(PAMT+NSERTAX+INS_CHRG+SEBI_TAX+TURN_TAX+BROKER_CHRG+OTHER_CHRG)'                                      
  SET @STRSQL = @STRSQL + ' ELSE (SAMT-NSERTAX-INS_CHRG-SEBI_TAX-TURN_TAX-BROKER_CHRG-OTHER_CHRG)'                                      
  SET @STRSQL = @STRSQL + ' END),'                                      
  SET @STRSQL = @STRSQL + ' BROK = (PBROK+SBROK),'                                      
  SET @STRSQL = @STRSQL + ' NETRATE = (CASE WHEN SELL_BUY = 1 '                                      
  SET @STRSQL = @STRSQL + ' THEN (CASE WHEN PQTY >0 THEN PAMT/PQTY ELSE 0 END) '                                      
  SET @STRSQL = @STRSQL + ' ELSE (CASE WHEN SQTY >0 THEN SAMT/SQTY ELSE 0 END) END),'                                      
  SET @STRSQL = @STRSQL + ' CL_RATE = 0, '                                      
  SET @STRSQL = @STRSQL + ' BROKERSEBIREGNO = O.BROKERSEBIREGNO,MEMBERCODE=O.MEMBERCODE,CINNO=O.CIN, '                                      
  SET @STRSQL = @STRSQL + ' SETTTYPE_DESC = (CASE '                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''D''  THEN ''MKTROLLING'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''C''  THEN ''ODD LOT'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''RD''  THEN ''MKTROLLING'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''RC''  THEN ''ODD LOT'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''F''  THEN ''DEBENTURE'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''AC'' THEN ''AUCTION ODD LOT'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''AF'' THEN ''AUCTION DEFENTURE'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''M''  THEN ''NORMAL'''         
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''M''  THEN ''NORMAL'''  
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''Z''  THEN ''TRADE FOR TRADE'''  
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''A''  THEN ''AUCTION'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''X''  THEN ''AUCTION TRADE FOR TRADE'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''W''  THEN ''TRADE FOR TRADE'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''MN'' THEN ''NORMAL'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''AN'' THEN ''AUCTION NORMAL'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''AD'' THEN ''AUCTION ROLLING'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''MW'' THEN ''TRADE FOR TRADE'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''MX'' THEN ''AUCTION TRADE FOR TRADE'''                                      
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''OS'' THEN ''OFFER FOR SALE'''   
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''T'' THEN ''OFFER FOR SALE'''   
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''H'' THEN ''OFFER FOR SALE'''   
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''BX'' THEN ''BUY BACK'''   
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''DX'' THEN ''DELISTING'''    
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''TX'' THEN ''TAKEOVER'''     
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''OB'' THEN ''BUY BACK'''   
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''DL'' THEN ''DELISTING'''    
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''TK'' THEN ''TAKEOVER'''                                   
  SET @STRSQL = @STRSQL + ' WHEN D.SETT_TYPE = ''TS'' THEN ''OFFER FOR SALE'''                                      
  SET @STRSQL = @STRSQL + ' ELSE '''' END), BFCF_FLAG = '''', '                                      
  SET @STRSQL = @STRSQL + ' CONTRACT_HEADER_DET = '''', '                               
  SET @STRSQL = @STRSQL + ' REMARK = '''', '                                      
  SET @STRSQL = @STRSQL + ' COMPANYNAME = O.COMPANY, USER_ID='''', '                                      
  SET @STRSQL = @STRSQL + ' REMARK_ID = '''', '                                      
  SET @STRSQL = @STRSQL + ' REMARK_DESC = '''', '                                      
  SET @STRSQL = @STRSQL + ' NETOBLIGATION = 0, '                                      
  SET @STRSQL = @STRSQL + ' M.BRANCH_CD, '                         
  SET @STRSQL = @STRSQL + ' M.SUB_BROKER, '                                      
  SET @STRSQL = @STRSQL + ' M.TRADER, '                                     
  SET @STRSQL = @STRSQL + ' M.AREA, '                                      
  SET @STRSQL = @STRSQL + ' M.REGION, '                                      
  SET @STRSQL = @STRSQL + ' M.FAMILY, '                                      
  SET @STRSQL = @STRSQL + ' PARTY_CODE= D.PARTY_CODE,'                                      
  SET @STRSQL = @STRSQL + ' M.PARTYNAME,'                                      
  SET @STRSQL = @STRSQL + ' M.L_ADDRESS1,'                                      
  SET @STRSQL = @STRSQL + ' M.L_ADDRESS2,'                                      
  SET @STRSQL = @STRSQL + ' M.L_ADDRESS3,'                                      
  SET @STRSQL = @STRSQL + ' M.L_STATE,'                                      
  SET @STRSQL = @STRSQL + ' M.L_CITY,'                                      
  SET @STRSQL = @STRSQL + ' M.L_ZIP,'                                      
  SET @STRSQL = @STRSQL + ' M.OFF_PHONE1,'                                      
  SET @STRSQL = @STRSQL + ' M.OFF_PHONE2,'                                      
  SET @STRSQL = @STRSQL + ' M.PAN_GIR_NO,'                 
  SET @STRSQL = @STRSQL + ' M.MAPIDID,'                                      
  SET @STRSQL = @STRSQL + ' M.UCC_CODE,'                                      
  SET @STRSQL = @STRSQL + ' M.SEBI_NO,'                                      
  SET @STRSQL = @STRSQL + ' M.PARTICIPANT_CODE,'                
  SET @STRSQL = @STRSQL + ' M.CL_TYPE,'                                      
  SET @STRSQL = @STRSQL + ' M.SERVICE_CHRG,'                                      
  SET @STRSQL = @STRSQL + ' M.PRINTF,'   
  SET @STRSQL = @STRSQL + ' BOOKTYPE='''' , '           
  SET @STRSQL = @STRSQL + ' INSTRUMENT='''' , '   
  SET @STRSQL = @STRSQL + ' ISIN=D.ISIN '   
       
  SET @STRSQL = @STRSQL + ' FROM '                                      
  SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CONTRACT_DATA_COMMON D WITH (NOLOCK),'                              
  SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CONTRACT_MASTER_COMMON M WITH (NOLOCK),'                                      
  SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.OWNER O WITH (NOLOCK)'                                      
  SET @STRSQL = @STRSQL + ' WHERE'                                      
  SET @STRSQL = @STRSQL + ' M.SETT_TYPE = D.SETT_TYPE'                                     
  SET @STRSQL = @STRSQL + ' AND M.SETT_NO = D.SETT_NO'                                      
  SET @STRSQL = @STRSQL + ' AND M.PARTY_CODE = D.PARTY_CODE'                                      
  SET @STRSQL = @STRSQL + ' AND M.PARTY_CODE BETWEEN ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''''                                      
  
  SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,D.SAUDA_DATE,109) >= ''' + @FROMDATE + ''' AND CONVERT(DATETIME,D.SAUDA_DATE,109) <= ''' + @FROMDATE + ' 23:59:59'''                                      
    
      
  SET @STRSQL = @STRSQL + ' AND EXISTS ( SELECT DISTINCT PARTYCODE FROM #PARTY P (NOLOCK) WHERE P.PARTYCODE = D.PARTY_CODE )'                                     
  SET @STRSQL = @STRSQL + ' ORDER BY'                                      
  SET @STRSQL = @STRSQL + ' SAUDA_DATE,'                                      
  SET @STRSQL = @STRSQL + ' D.PARTY_CODE '                   
  SET @STRSQL = @STRSQL + ' END'                                      
                                      
  --PRINT @STRSQL    
  EXEC (@STRSQL)                             
                               
                         
  SET @STRSQL = ' UPDATE #CONTRACT SET USER_ID = S.USER_ID FROM '                                      
  SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.SETTLEMENT S WITH (NOLOCK) '                                      
  SET @STRSQL = @STRSQL + ' WHERE S.SAUDA_DATE >= ''' + @FROMDATE + ''' AND S.SAUDA_DATE <= ''' + @FROMDATE + ' 23:59:59'''                                      
  SET @STRSQL = @STRSQL + ' AND S.ORDER_NO = #CONTRACT.ORDER_NO AND S.TRADE_NO = #CONTRACT.TRADE_NO '                                      
  SET @STRSQL = @STRSQL + ' AND S.PARTY_CODE = #CONTRACT.PARTY_CODE '                                      
  SET @STRSQL = @STRSQL + ' AND S.SETT_TYPE = #CONTRACT.SETT_TYPE '                 
  SET @STRSQL = @STRSQL + ' AND #CONTRACT.EXCHANGE = ''' + @EXCHANGE_NEW + ''' '                                      
  SET @STRSQL = @STRSQL + ' AND #CONTRACT.SEGMENT = ''' + @SEGMENT_NEW + ''' '                                      
      
                                      
  --PRINT @STRSQL                          
   EXEC (@STRSQL)                            
                             
                                     
                                      
  --EXEC (@STRSQL)  COMMENTED FOR TESTING SINU                                      
/*                                      
  SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + '.' + @SHAREDB + '.SYS.TABLES WHERE NAME=''TBL_CONTRACT_TERMINAL_MAPPING'') > 0 '                                      
  SET @STRSQL = @STRSQL + 'BEGIN '                                      
  SET @STRSQL = @STRSQL + 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + '.' + @SHAREDB + '.SYS.COLUMNS WHERE [NAME] = ''USER_ID'' AND [OBJECT_ID] IN (SELECT DISTINCT OBJECT_ID FROM ' + @SHARESERVER + '.' + @SHAREDB + '.SYS.TABLES WHERE NAME = ''CONTRACT_D
 
  
   
ATA_COMMON'')) > 0 '                                      
  SET @STRSQL = @STRSQL + 'BEGIN '                                      
  SET @STRSQL = @STRSQL + ' UPDATE #CONTRACT SET REMARK_ID = ISNULL(T.REMARK_ID,''''), REMARK_DESC = ISNULL(T.REMARK_DESC,'''') '                                      
  SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + '.' + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING T WITH (NOLOCK) '                               
  SET @STRSQL = @STRSQL + ' WHERE #CONTRACT.USER_ID = (CASE WHEN ISNULL(T.TERMINAL_ID,'''') <> '''' THEN ISNULL(T.TERMINAL_ID,'''') ELSE #CONTRACT.USER_ID END) '                                      
  SET @STRSQL = @STRSQL + ' AND #CONTRACT.ORDER_NO = (CASE WHEN ISNULL(T.ORDER_NO,'''') <> '''' THEN ISNULL(T.ORDER_NO,'''') ELSE #CONTRACT.ORDER_NO END) '                                      
  SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,SAUDA_DATE,103) BETWEEN FROM_DATE AND END_DATE '                                      
  SET @STRSQL = @STRSQL + ' AND EXCHANGE = ''' + @EXCHANGE_NEW + ''' AND SEGMENT = ''' + @SEGMENT_NEW + ''' '                                      
  SET @STRSQL = @STRSQL + 'END '                                      
  SET @STRSQL = @STRSQL + 'END '                                      
*/  
  SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME=''TBL_CONTRACT_TERMINAL_MAPPING'') > 0 '    
  SET @STRSQL = @STRSQL + 'BEGIN '    
 SET @STRSQL = @STRSQL + ' TRUNCATE TABLE #CONTRACT_TERMINAL_MAPPING '  
 SET @STRSQL = @STRSQL + ' INSERT INTO #CONTRACT_TERMINAL_MAPPING '  
 SET @STRSQL = @STRSQL + ' SELECT TERMINAL_ID,ORDER_NO,REMARK_ID,REMARK_DESC FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING WITH (NOLOCK) '  
 SET @STRSQL = @STRSQL + ' WHERE ''' + @FROMDATE + ''' = FROM_DATE '  
   
 SET @STRSQL = @STRSQL + ' UPDATE #CONTRACT SET REMARK_ID = ISNULL(T.REMARK_ID,''''), REMARK_DESC = ISNULL(T.REMARK_DESC,'''') '    
  --SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING T (NOLOCK) '    
  SET @STRSQL = @STRSQL + ' FROM #CONTRACT_TERMINAL_MAPPING T '    
  SET @STRSQL = @STRSQL + ' WHERE #CONTRACT.ORDER_NO = T.ORDER_NO '    
  SET @STRSQL = @STRSQL + ' AND ISNULL(T.ORDER_NO,'''') <> '''' '    
--  SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,SAUDA_DATE,103) BETWEEN CONVERT(DATETIME,CONVERT(VARCHAR,FROM_DATE,103),103) AND END_DATE '    
  --SET @STRSQL = @STRSQL + ' AND CONVERT(VARCHAR(11),SAUDA_DATE,109) BETWEEN CONVERT(VARCHAR(11),FROM_DATE,109) AND CONVERT(VARCHAR(11),END_DATE,109) '      
  --SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN FROM_DATE AND END_DATE '      
  SET @STRSQL = @STRSQL + ' AND EXCHANGE = ''' + @EXCHANGE_NEW + ''' AND SEGMENT = ''' + @SEGMENT_NEW + ''' '    
  --SET @STRSQL = @STRSQL + 'END '   
    
  SET @STRSQL = @STRSQL + ' UPDATE #CONTRACT SET REMARK_ID = ISNULL(T.REMARK_ID,''''), REMARK_DESC = ISNULL(T.REMARK_DESC,'''') '    
  --SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING T (NOLOCK) '    
  SET @STRSQL = @STRSQL + ' FROM #CONTRACT_TERMINAL_MAPPING T '    
  SET @STRSQL = @STRSQL + ' WHERE #CONTRACT.USER_ID = T.TERMINAL_ID '    
  SET @STRSQL = @STRSQL + ' AND ISNULL(T.TERMINAL_ID,'''') <> '''' '    
--  SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,SAUDA_DATE,103) BETWEEN CONVERT(DATETIME,CONVERT(VARCHAR,FROM_DATE,103),103) AND END_DATE '    
  --SET @STRSQL = @STRSQL + ' AND CONVERT(VARCHAR(11),SAUDA_DATE,109) BETWEEN CONVERT(VARCHAR(11),FROM_DATE,109) AND CONVERT(VARCHAR(11),END_DATE,109) '      
  --SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN FROM_DATE AND END_DATE '      
  SET @STRSQL = @STRSQL + ' AND EXCHANGE = ''' + @EXCHANGE_NEW + ''' AND SEGMENT = ''' + @SEGMENT_NEW + ''' '    
  --SET @STRSQL = @STRSQL + 'END '    
  SET @STRSQL = @STRSQL + 'END '                                          
  --PRINT @STRSQL                                      
  EXEC (@STRSQL)                                      
                            
  --PRINT 'ABC'                                      
END  
   
 ELSE   
  --PRINT 'ABC1'                                      
  IF @SEGMENT_NEW = 'FUTURES'                                      
  BEGIN  
  --PRINT 'ABC2'                                                                          
   SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME=''CONTRACT_DATA_COMMON'') > 0 '                                      
   SET @STRSQL = @STRSQL + 'BEGIN '                                      
   SET @STRSQL = @STRSQL + ' TRUNCATE TABLE #PARTY '                                      
   SET @STRSQL = @STRSQL + ' INSERT INTO #PARTY '                                      
                     
   IF (                                      
     @SHAREDB = 'BSEFO'                    
    -- OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' SELECT DISTINCT PARTY_CODE FROM '                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.BFOBILLVALAN WITH (NOLOCK) WHERE PARTY_CODE BETWEEN  ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''' '                                      
    SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   END                          
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' SELECT DISTINCT PARTY_CODE FROM '                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.FOBILLVALAN WITH (NOLOCK) WHERE PARTY_CODE BETWEEN  ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''' '                                      
    SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' END '                                      
                                      
   --PRINT @STRSQL                                      
   EXEC (@STRSQL)                                      
                                      
   /* FOR BF TRADE */                                      
   SET @STRSQL = ''                                      
   SET @STRSQL = @STRSQL + 'INSERT INTO #CONTRACT '                                      
   SET @STRSQL = @STRSQL + 'SELECT '                                      
   SET @STRSQL = @STRSQL + ' CONTRACTNO,'                                      
   SET @STRSQL = @STRSQL + ' CONTRACTNO_NEW = CONTRACTNO,'                                      
   SET @STRSQL = @STRSQL + ' SAUDA_DATE,'                                      
   SET @STRSQL = @STRSQL + ' SETT_NO = '''','                                      
   SET @STRSQL = @STRSQL + ' SETT_TYPE = '''','                                      
   SET @STRSQL = @STRSQL + ' SETT_DATE = '''','                                      
   SET @STRSQL = @STRSQL + ' EXCHANGE = ''' + @EXCHANGE_NEW + ''','                                      
   SET @STRSQL = @STRSQL + ' SEGMENT  = ''' + @SEGMENT_NEW + ''','                                      
   SET @STRSQL = @STRSQL + ' ORDER_NO = '''','                                      
   SET @STRSQL = @STRSQL + ' ORDER_TIME = '''','          
   SET @STRSQL = @STRSQL + ' TRADE_NO = '''','                                      
   SET @STRSQL = @STRSQL + ' TRADE_TIME='''','                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
   --  OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' SCRIPNAME = RTRIM(PRODUCT_CODE) + '' '' + RTRIM(SERIES_CODE) + '' '' + CONVERT(VARCHAR,SERIES_ID,108),'                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' SCRIPNAME = ('                                      
    SET @STRSQL = @STRSQL + ' CASE '                                     
    SET @STRSQL = @STRSQL + ' WHEN LEFT(INST_TYPE,3) = ''FUT'' THEN RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) '                                      
    SET @STRSQL = @STRSQL + ' ELSE RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) + '' '' + CONVERT(VARCHAR,STRIKE_PRICE) + '' '' + RTRIM(OPTION_TYPE) '                                      
    SET @STRSQL = @STRSQL + ' END),'             
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' QTY=ABS(SUM(PQTY-SQTY)),'                                      
   SET @STRSQL = @STRSQL + ' TMARK= '''','                                      
   SET @STRSQL = @STRSQL + ' SELL_BUY=(CASE WHEN SUM(PQTY-SQTY) > 0 THEN 1 ELSE 2 END),'                                      
   --SET @STRSQL = @STRSQL + ' MARKETRATE = (CASE WHEN SUM(PQTY-SQTY) <> 0 THEN (SUM(PRATE*PQTY)-SUM(SRATE*SQTY))/SUM(PQTY-SQTY) ELSE 0 END),'                                      
   SET @STRSQL = @STRSQL + ' MARKETRATE = (CASE WHEN SUM(PQTY-SQTY) <> 0 THEN (SUM(PAMT)-SUM(SAMT) )/SUM(PQTY-SQTY) ELSE 0 END),'                      
   SET @STRSQL = @STRSQL + ' MARKETAMT = (SUM(PRATE*PQTY)-SUM(SRATE*SQTY)),'                                      
   SET @STRSQL = @STRSQL + ' BROKERAGE = SUM(PBROKAMT-SBROKAMT),'                                      
   SET @STRSQL = @STRSQL + ' SERVICE_TAX = SUM(SERVICE_TAX),'                                      
   SET @STRSQL = @STRSQL + ' INS_CHRG = SUM(INS_CHRG),'                                      
--   SET @STRSQL = @STRSQL + ' NETAMOUNT = (CASE WHEN SUM(PQTY-SQTY) > 0 THEN SUM(PBILLAMT-SBILLAMT) ELSE SUM(SBILLAMT-PBILLAMT) END),'                                      
   SET @STRSQL = @STRSQL + ' NETAMOUNT = (SUM(SBILLAMT-PBILLAMT)),'                                      
   SET @STRSQL = @STRSQL + ' SEBI_TAX = SUM(SEBI_TAX),'                                      
   SET @STRSQL = @STRSQL + ' TURN_TAX = SUM(TURN_TAX),'                                      
   SET @STRSQL = @STRSQL + ' BROKER_CHRG = SUM(BROKER_NOTE),'                                      
   SET @STRSQL = @STRSQL + ' OTHER_CHRG = SUM(D.OTHER_CHRG),'                                      
   SET @STRSQL = @STRSQL + ' NETAMOUNTALL= 0,'                                      
   SET @STRSQL = @STRSQL + ' BROK  = (CASE WHEN SUM(PQTY-SQTY) <> 0 THEN SUM(PBROKAMT-SBROKAMT)/SUM(PQTY-SQTY) ELSE 0 END),'                                      
   SET @STRSQL = @STRSQL + ' NETRATE = 0,'                                      
   SET @STRSQL = @STRSQL + ' CL_RATE = (CASE WHEN SUM(PQTY-SQTY) <> 0 THEN  ABS(SUM((PQTY-SQTY)*CL_RATE) / SUM(PQTY-SQTY)) ELSE 0 END), '                                      
   SET @STRSQL = @STRSQL + ' BROKERSEBIREGNO = O.BROKERSEBIREGNO,'                                      
   SET @STRSQL = @STRSQL + ' MEMBERCODE = O.MEMBERCODE,'                                      
   SET @STRSQL = @STRSQL + ' CINNO = O.CIN,'                                      
   SET @STRSQL = @STRSQL + ' SETTTYPE_DESC='''','                                      
   SET @STRSQL = @STRSQL + ' BFCF_FLAG = ''BF_'''                                      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
     --OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN      
    SET @STRSQL = @STRSQL + '+RIGHT(LEFT(PRODUCT_CODE,1),3), '                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + '+LEFT(INST_TYPE,1), '                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' CONTRACT_HEADER_DET = '''', '                                      
   SET @STRSQL = @STRSQL + ' REMARK = '''', '                                      
   SET @STRSQL = @STRSQL + ' COMPANYNAME = O.COMPANY, USER_ID='''', '                                      
   SET @STRSQL = @STRSQL + ' REMARK_ID = '''', '                                      
   SET @STRSQL = @STRSQL + ' REMARK_DESC = '''', '                                
   SET @STRSQL = @STRSQL + ' NETOBLIGATION = 0, '                    
 SET @STRSQL = @STRSQL + ' M.BRANCH_CD, '                                      
   SET @STRSQL = @STRSQL + ' M.SUB_BROKER, '                         
   SET @STRSQL = @STRSQL + ' M.TRADER, '                                      
   SET @STRSQL = @STRSQL + ' M.AREA, '                                      
   SET @STRSQL = @STRSQL + ' M.REGION, '                                      
   SET @STRSQL = @STRSQL + ' M.FAMILY, '                                      
   SET @STRSQL = @STRSQL + ' PARTY_CODE= D.PARTY_CODE,'                                      
   SET @STRSQL = @STRSQL + ' PARTYNAME = LONG_NAME,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS1,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS2,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS3,'                                      
   SET @STRSQL = @STRSQL + ' M.L_STATE,'                                      
   SET @STRSQL = @STRSQL + ' M.L_CITY,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ZIP,'                                      
   SET @STRSQL = @STRSQL + ' M.OFF_PHONE1,'                                      
   SET @STRSQL = @STRSQL + ' M.OFF_PHONE2,'                                      
   SET @STRSQL = @STRSQL + ' M.PAN_GIR_NO,'                                      
   SET @STRSQL = @STRSQL + ' MAPIDID = '''','                                      
   SET @STRSQL = @STRSQL + ' UCC_CODE= '''','                                      
   SET @STRSQL = @STRSQL + ' SEBI_NO = FD_CODE,'                                      
   SET @STRSQL = @STRSQL + ' PARTICIPANT_CODE = BANKID,'                                      
   SET @STRSQL = @STRSQL + ' M.CL_TYPE,'                                      
   SET @STRSQL = @STRSQL + ' SERVICE_CHRG,'                                      
  SET @STRSQL = @STRSQL + ' C2.PRINTF,'   
  SET @STRSQL = @STRSQL + ' BOOKTYPE='''' , '                                  
  SET @STRSQL = @STRSQL + ' INSTRUMENT='''' , '   
  SET @STRSQL = @STRSQL + ' ISIN='''' '   
    
   SET @STRSQL = @STRSQL + ' FROM '                                      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                     
    -- OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                  
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.BFOBILLVALAN D WITH (NOLOCK),'                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CLIENT1 M WITH (NOLOCK),'                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.BFOOWNER O WITH (NOLOCK),'                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CLIENT2 C2 WITH (NOLOCK)'                                   
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.FOBILLVALAN D WITH (NOLOCK),'                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CLIENT1 M WITH (NOLOCK),'                              
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.FOOWNER O WITH (NOLOCK),'                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CLIENT2 C2 WITH (NOLOCK)'                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + 'WHERE'                                      
   SET @STRSQL = @STRSQL + ' 1 = 1'                                      
SET @STRSQL = @STRSQL + ' AND M.CL_CODE = C2.PARTY_CODE'    
   SET @STRSQL = @STRSQL + ' AND M.CL_CODE = D.PARTY_CODE'                                      
                                      
   IF @SHAREDB = 'NSEFO'                            
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' AND LEFT(INST_TYPE,3) = ''FUT'' '                                      
   END                                      
                                      
   IF (                
     @SHAREDB = 'NSECURFO'                                      
     OR @SHAREDB = 'MCDXCDS'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' AND LEFT(INST_TYPE,3) = ''FUT'' '                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' AND M.CL_CODE BETWEEN ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''''                                      
   SET @STRSQL = @STRSQL + ' AND D.SAUDA_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   ---SET @STRSQL = @STRSQL + ' AND TRADETYPE = ''BF'' '
   SET @STRSQL = @STRSQL + ' AND (TRADETYPE = ''BF'' OR (TRADETYPE = ''BT'' AND (PQTY-SQTY) <> 0 AND AUCTIONPART=''CA'' )) '                                      
   SET @STRSQL = @STRSQL + ' AND (PQTY-SQTY) <> 0 '                                      
   SET @STRSQL = @STRSQL + 'GROUP BY '                                      
   SET @STRSQL = @STRSQL + ' CONTRACTNO,'                                      
   SET @STRSQL = @STRSQL + ' SAUDA_DATE,'                                      
   SET @STRSQL = @STRSQL + ' M.BRANCH_CD, '                                      
   SET @STRSQL = @STRSQL + ' M.SUB_BROKER, '                                      
   SET @STRSQL = @STRSQL + ' M.TRADER, '                                      
   SET @STRSQL = @STRSQL + ' M.AREA, '                                      
   SET @STRSQL = @STRSQL + ' M.REGION, '                                      
   SET @STRSQL = @STRSQL + ' M.FAMILY, '                                      
   SET @STRSQL = @STRSQL + ' D.PARTY_CODE,'                                      
   SET @STRSQL = @STRSQL + ' LONG_NAME,'                                    
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS1,'               
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS2,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS3,'                                      
   SET @STRSQL = @STRSQL + ' M.L_STATE,'                                      
   SET @STRSQL = @STRSQL + ' M.L_CITY,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ZIP,'                                      
   SET @STRSQL = @STRSQL + ' M.OFF_PHONE1,'                                      
   SET @STRSQL = @STRSQL + ' M.OFF_PHONE2,'      
   SET @STRSQL = @STRSQL + ' M.PAN_GIR_NO,'                                      
   SET @STRSQL = @STRSQL + ' FD_CODE,'                                      
   SET @STRSQL = @STRSQL + ' BANKID,'                                      
   SET @STRSQL = @STRSQL + ' M.CL_TYPE,'                                      
   SET @STRSQL = @STRSQL + ' SERVICE_CHRG,'                                      
   SET @STRSQL = @STRSQL + ' PRINTF, '                                      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
   -- OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' RTRIM(PRODUCT_CODE) + '' '' + RTRIM(SERIES_CODE) + '' '' + CONVERT(VARCHAR,SERIES_ID,108),RIGHT(LEFT(PRODUCT_CODE,1),3),'                                      
END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' CASE '                                      
    SET @STRSQL = @STRSQL + ' WHEN LEFT(INST_TYPE,3) = ''FUT'' THEN RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) '                                      
    SET @STRSQL = @STRSQL + ' ELSE RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) + '' '' + CONVERT(VARCHAR,STRIKE_PRICE) + '' '' + RTRIM(OPTION_TYPE) '                                      
    SET @STRSQL = @STRSQL + ' END,LEFT(INST_TYPE,1),'                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' O.BROKERSEBIREGNO,O.MEMBERCODE,O.CIN,BRANCH_CD,M.SUB_BROKER,O.COMPANY '                                      
   SET @STRSQL = @STRSQL + 'ORDER BY '                                      
   SET @STRSQL = @STRSQL + ' SAUDA_DATE, '                                      
   SET @STRSQL = @STRSQL + ' D.PARTY_CODE '                                      
                                      
   --PRINT @STRSQL                               
                                      
   EXEC (@STRSQL)                                      
                                      
   /* FOR BT TRADE */                                      
   SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME=''CONTRACT_DATA_COMMON'') > 0 '                                      
   SET @STRSQL = @STRSQL + 'BEGIN '                                      
   SET @STRSQL = @STRSQL + 'INSERT INTO #CONTRACT '                                      
   SET @STRSQL = @STRSQL + ' SELECT CONTRACTNO,'                                      
   SET @STRSQL = @STRSQL + ' CONTRACTNO_NEW = CONTRACTNO,'                                      
   SET @STRSQL = @STRSQL + ' SAUDA_DATE,'                                      
   SET @STRSQL = @STRSQL + ' SETT_NO = '''','                                      
   SET @STRSQL = @STRSQL + ' SETT_TYPE = '''','                                      
   SET @STRSQL = @STRSQL + ' SETT_DATE = '''','                                      
   SET @STRSQL = @STRSQL + ' EXCHANGE = ''' + @EXCHANGE_NEW + ''','                                      
   SET @STRSQL = @STRSQL + ' SEGMENT = ''' + @SEGMENT_NEW + ''','                      
   SET @STRSQL = @STRSQL + ' ORDER_NO,'                                      
   SET @STRSQL = @STRSQL + ' ORDER_TIME,'                                      
   SET @STRSQL = @STRSQL + ' TRADE_NO,'                    
   SET @STRSQL = @STRSQL + ' TRADE_TIME=TRADETIME,'                                      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
   --  OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' SCRIPNAME = RTRIM(PRODUCT_CODE) + '' '' + RTRIM(SERIES_CODE) + '' '' + CONVERT(VARCHAR,SERIES_ID,108),'                                      
   END                                      
   ELSE                                  
    IF @SHAREDB = 'NSECURFO'                                      
    BEGIN                                      
     SET @STRSQL = @STRSQL + ' SCRIPNAME = ('                                      
     SET @STRSQL = @STRSQL + ' CASE '                                      
     SET @STRSQL = @STRSQL + ' WHEN LEFT(INST_TYPE,3) = ''FUT'' THEN RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) '                                      
     SET @STRSQL = @STRSQL + ' ELSE RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) + '' '' + CONVERT(VARCHAR,CAST(STRIKE_PRICE AS NUMERIC(18,4))) + '' '' + RTRIM(AUCTIONPART) '                                      
     SET @STRSQL = @STRSQL + ' END),'                                      
    END                      
    ELSE                                      
    BEGIN                                      
     SET @STRSQL = @STRSQL + ' SCRIPNAME = ('                           
     SET @STRSQL = @STRSQL + ' CASE '                                      
     SET @STRSQL = @STRSQL + ' WHEN LEFT(INST_TYPE,3) = ''FUT'' THEN RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) '                                      
     SET @STRSQL = @STRSQL + ' ELSE RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) + '' '' + CONVERT(VARCHAR,STRIKE_PRICE) + '' '' + RTRIM(OPTION_TYPE) '                                      
     SET @STRSQL = @STRSQL + ' END),'                                      
    END                                      
                                   
   SET @STRSQL = @STRSQL + ' QTY =PQTY+SQTY,'                                      
   SET @STRSQL = @STRSQL + ' TMARK = '''','                                      
   SET @STRSQL = @STRSQL + ' SELL_BUY = (CASE WHEN SELL_BUY = 1 THEN 1 ELSE 2 END),'                                      
   SET @STRSQL = @STRSQL + ' MARKETRATE = PRATE+SRATE,'                  
   --SET @STRSQL = @STRSQL + ' MARKETAMT = 0,'                                      
   SET @STRSQL = @STRSQL + ' MARKETAMT = ((PRATE + SRATE)*(PQTY+SQTY)),'                                      
   SET @STRSQL = @STRSQL + ' BROKERAGE,'                               
   SET @STRSQL = @STRSQL + ' SERVICE_TAX,'                                      
   SET @STRSQL = @STRSQL + ' INS_CHRG,'                                      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
    -- OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' NETAMOUNT = ('                                      
    SET @STRSQL = @STRSQL + ' CASE'                                      
    SET @STRSQL = @STRSQL + ' WHEN SELL_BUY = 1'                                      
    SET @STRSQL = @STRSQL + ' THEN -(PAMT)'                                      
    SET @STRSQL = @STRSQL + ' ELSE (SAMT)'                                      
    SET @STRSQL = @STRSQL + ' END)  ,'                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' NETAMOUNT = CASE WHEN LEFT(INST_TYPE,3) = ''FUT'' THEN ('                                      
    SET @STRSQL = @STRSQL + ' CASE'                                      
    SET @STRSQL = @STRSQL + ' WHEN SELL_BUY = 1'     
    SET @STRSQL = @STRSQL + ' THEN -(PAMT)'                                      
    SET @STRSQL = @STRSQL + ' ELSE (SAMT)'                                      
    SET @STRSQL = @STRSQL + ' END) ELSE '                                      
    SET @STRSQL = @STRSQL + ' (CASE'                                      
    SET @STRSQL = @STRSQL + ' WHEN SELL_BUY = 1'                                      
    SET @STRSQL = @STRSQL + ' THEN -(PAMT)'                                      
    SET @STRSQL = @STRSQL + ' ELSE (SAMT)'                                      
    SET @STRSQL = @STRSQL + ' END) END ,'                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' SEBI_TAX,'                                      
   SET @STRSQL = @STRSQL + ' TURN_TAX,'                                      
   SET @STRSQL = @STRSQL + ' BROKER_CHRG,'                                      
   SET @STRSQL = @STRSQL + ' D.OTHER_CHRG,'                                      
   SET @STRSQL = @STRSQL + ' NETAMOUNTALL = ('                                      
   SET @STRSQL = @STRSQL + ' CASE'                                      
   SET @STRSQL = @STRSQL + ' WHEN SELL_BUY = 1'                                      
   SET @STRSQL = @STRSQL + ' THEN -(PAMT+NSERTAX+INS_CHRG+SEBI_TAX+TURN_TAX+BROKER_CHRG+D.OTHER_CHRG)'                          
   SET @STRSQL = @STRSQL + ' ELSE (SAMT-NSERTAX-INS_CHRG-SEBI_TAX-TURN_TAX-BROKER_CHRG-D.OTHER_CHRG)'                                      
   SET @STRSQL = @STRSQL + ' END),'                                      
   SET @STRSQL = @STRSQL + ' BROK = (PBROK+SBROK),'                                  
   --SET @STRSQL = @STRSQL + ' NETRATE = (PNETRATE+SNETRATE),'                                                        
   --SET @STRSQL = @STRSQL + ' NETRATE = PRATE+PBROK+SRATE-SBROK ,'                                      
   SET @STRSQL = @STRSQL + ' NETRATE = (CASE WHEN SELL_BUY = 1 '                                    
   SET @STRSQL = @STRSQL + ' THEN (CASE WHEN PQTY >0 THEN PAMT/PQTY ELSE 0 END) '                                      
   SET @STRSQL = @STRSQL + ' ELSE (CASE WHEN SQTY >0 THEN SAMT/SQTY ELSE 0 END) END),'                                      
   SET @STRSQL = @STRSQL + ' CL_RATE = 0, '                                      
   SET @STRSQL = @STRSQL + ' BROKERSEBIREGNO = O.BROKERSEBIREGNO,MEMBERCODE=O.MEMBERCODE,CINNO=O.CIN,SETTTYPE_DESC='''', BFCF_FLAG = ''BT_'''      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
  --   OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + '+RIGHT(LEFT(PRODUCT_CODE,1),3), '                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + '+LEFT(INST_TYPE,1), '                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' CONTRACT_HEADER_DET = '''', '                                      
   SET @STRSQL = @STRSQL + ' REMARK = '''', '                                      
   SET @STRSQL = @STRSQL + ' COMPANYNAME = O.COMPANY, USER_ID='''', '                                      
   SET @STRSQL = @STRSQL + ' REMARK_ID = '''', '                                      
   SET @STRSQL = @STRSQL + ' REMARK_DESC = '''', '                                      
   SET @STRSQL = @STRSQL + ' NETOBLIGATION = 0, '                                      
   SET @STRSQL = @STRSQL + ' M.BRANCH_CD, '                                      
   SET @STRSQL = @STRSQL + ' M.SUBBROKER, '        
   SET @STRSQL = @STRSQL + ' M.TRADER, '                                      
   SET @STRSQL = @STRSQL + ' M.AREA, '                                      
   SET @STRSQL = @STRSQL + ' M.REGION, '                                      
   SET @STRSQL = @STRSQL + ' M.FAMILY, '                                      
   SET @STRSQL = @STRSQL + ' PARTY_CODE= D.PARTY_CODE,'                                      
   SET @STRSQL = @STRSQL + ' M.PARTYNAME,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS1,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS2,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ADDRESS3,'                                      
   SET @STRSQL = @STRSQL + ' M.L_STATE,'                                      
   SET @STRSQL = @STRSQL + ' M.L_CITY,'                                      
   SET @STRSQL = @STRSQL + ' M.L_ZIP,'                                      
   SET @STRSQL = @STRSQL + ' M.OFF_PHONE1,'                                      
   SET @STRSQL = @STRSQL + ' M.OFF_PHONE2,'                                      
   SET @STRSQL = @STRSQL + ' M.PAN_GIR_NO,'                                      
   SET @STRSQL = @STRSQL + ' M.MAPIDID,'                                      
   SET @STRSQL = @STRSQL + ' M.UCC_CODE,'                                      
   SET @STRSQL = @STRSQL + ' M.SEBI_NO,'                                      
   SET @STRSQL = @STRSQL + ' PARTICIPANT_CODE = '''','               
   SET @STRSQL = @STRSQL + ' CL_TYPE = '''','                                      
   SET @STRSQL = @STRSQL + ' M.SERVICE_CHRG,'                                      
  SET @STRSQL = @STRSQL + ' M.PRINTF, '          
 IF  @SHAREDB = 'MCDXCDS'          
  BEGIN              
  SET @STRSQL = @STRSQL + ' PRICEUNIT,QTY_UNIT, '            
  END           
  ELSE            
 BEGIN            
 SET @STRSQL = @STRSQL + ' 0,0, '           
 END         
   SET @STRSQL = @STRSQL + ' ISIN='''' '    
   SET @STRSQL = @STRSQL + 'FROM '                                      
   SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CONTRACT_DATA_COMMON D WITH (NOLOCK),'                                      
   SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.CONTRACT_MASTER_COMMON M WITH (NOLOCK),'                                      
                                      
   IF (                                      
     @SHAREDB = 'BSEFO'                                      
    -- OR @SHAREDB = 'BSECURFO'                                      
     )                                      
   BEGIN                                     
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.BFOOWNER O WITH (NOLOCK)'                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.FOOWNER O WITH (NOLOCK)'                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + 'WHERE'                                      
   SET @STRSQL = @STRSQL + ' 1 = 1'                                      
   SET @STRSQL = @STRSQL + ' AND M.PARTY_CODE = D.PARTY_CODE'                                      
   SET @STRSQL = @STRSQL + ' AND LEFT(M.TRADE_DATE,11) = LEFT(D.SAUDA_DATE,11) '                                      
   SET @STRSQL = @STRSQL + ' AND M.PARTY_CODE BETWEEN ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''''                                      
   SET @STRSQL = @STRSQL + ' AND D.SAUDA_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   --SET @STRSQL = @STRSQL + ' AND EXISTS ( SELECT DISTINCT PARTYCODE FROM #PARTY P (NOLOCK) WHERE P.PARTYCODE = D.PARTY_CODE )'                                      
   SET @STRSQL = @STRSQL + 'ORDER BY'                                      
   SET @STRSQL = @STRSQL + ' SAUDA_DATE,'                                      
   SET @STRSQL = @STRSQL + ' D.PARTY_CODE'                                      
   SET @STRSQL = @STRSQL + ' END '                                      
                                      
   --PRINT @STRSQL                 
                                      
   EXEC (@STRSQL)                                      
                                         
   IF (@SHAREDB = 'BSEFO')                              
   BEGIN                                      
    SET @STRSQL = ' INSERT INTO #FOCLOSING '                                          
    SET @STRSQL = @STRSQL + ' SELECT TRADE_DATE, '                                    
    SET @STRSQL = @STRSQL + ' SCRIPNAME = RTRIM(PRODUCT_CODE) + '' '' + RTRIM(SERIES_CODE) + '' '' + CONVERT(VARCHAR,SERIES_ID,108), '                                      
    SET @STRSQL = @STRSQL + ' CL_RATE = CLOSE_PRICE, '  
    SET @STRSQL = @STRSQL + ' EXCHANGE = ''' + @EXCHANGE_NEW + ''',SEGMENT = ''' + @SEGMENT_NEW + ''' '                                                                              
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.BFOCLOSING WITH (NOLOCK) '                
    SET @STRSQL = @STRSQL + ' WHERE TRADE_DATE  BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   END                    
   ELSE         
   BEGIN                                      
    SET @STRSQL = ' INSERT INTO #FOCLOSING '               
    SET @STRSQL = @STRSQL + ' SELECT TRADE_DATE, '                                      
    SET @STRSQL = @STRSQL + ' SCRIPNAME = (CASE WHEN LEFT(INST_TYPE,3) = ''FUT'' THEN RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' ''+ LEFT(EXPIRYDATE,11) '                                      
    SET @STRSQL = @STRSQL + ' ELSE RTRIM(INST_TYPE) + '' '' + RTRIM(SYMBOL) + '' '' + LEFT(EXPIRYDATE,11) + '' ''+ CONVERT(VARCHAR,STRIKE_PRICE) + '' '' + RTRIM(OPTION_TYPE) END), '                                      
    SET @STRSQL = @STRSQL + '  CL_RATE ,'    
    SET @STRSQL = @STRSQL + ' EXCHANGE = ''' + @EXCHANGE_NEW + ''',SEGMENT = ''' + @SEGMENT_NEW + ''' '                                                                              
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.FOCLOSING WITH (NOLOCK) '                                      
    SET @STRSQL = @STRSQL + ' WHERE TRADE_DATE  BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'' AND LEFT(INST_TYPE,3) = ''FUT'' '                                      
   END                                       
   EXEC (@STRSQL)                                      
                                        
                                      
                                      
   IF (@SHAREDB = 'BSEFO')                                      
   BEGIN                                      
    SET @STRSQL = ' UPDATE #CONTRACT SET USER_ID = S.TERMINALID FROM '                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.BFOSETTLEMENT S WITH (NOLOCK) '                                      
   END                                      
   ELSE                                      
   BEGIN                                      
   SET @STRSQL = ' UPDATE #CONTRACT SET USER_ID = S.USER_ID FROM '                                      
    SET @STRSQL = @STRSQL + ' ' + @SHARESERVER + @SHAREDB + '.DBO.FOSETTLEMENT S WITH (NOLOCK) '                                      
END                                      
   SET @STRSQL = @STRSQL + ' WHERE S.SAUDA_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   SET @STRSQL = @STRSQL + ' AND S.ORDER_NO = #CONTRACT.ORDER_NO AND S.TRADE_NO = #CONTRACT.TRADE_NO '                                      
   SET @STRSQL = @STRSQL + ' AND S.PARTY_CODE = #CONTRACT.PARTY_CODE '                                      
   SET @STRSQL = @STRSQL + ' AND #CONTRACT.EXCHANGE = ''' + @EXCHANGE_NEW + ''' '                                      
   SET @STRSQL = @STRSQL + ' AND #CONTRACT.SEGMENT = ''' + @SEGMENT_NEW + ''' '                                      
                                      
   --PRINT @STRSQL                                      
   EXEC (@STRSQL)                                       
                                         
    
   SET @STRSQL = 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME=''TBL_CONTRACT_TERMINAL_MAPPING'') > 0 '    
   SET @STRSQL = @STRSQL + 'BEGIN '    
   --SET @STRSQL = @STRSQL + 'IF (SELECT COUNT(1) FROM ' + @SHARESERVER + @SHAREDB + '.SYS.COLUMNS WHERE [NAME] = ''USER_ID''     
   --      AND [OBJECT_ID] IN (SELECT DISTINCT OBJECT_ID FROM ' + @SHARESERVER + @SHAREDB + '.SYS.TABLES WHERE NAME = ''CONTRACT_DATA'')) > 0 '    
   --SET @STRSQL = @STRSQL + 'BEGIN '    
  
SET @STRSQL = @STRSQL + ' TRUNCATE TABLE #CONTRACT_TERMINAL_MAPPING '  
SET @STRSQL = @STRSQL + ' INSERT INTO #CONTRACT_TERMINAL_MAPPING '  
SET @STRSQL = @STRSQL + ' SELECT TERMINAL_ID,ORDER_NO,REMARK_ID,REMARK_DESC FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING '  
SET @STRSQL = @STRSQL + ' WHERE ''' + @FROMDATE + ''' = FROM_DATE '  
/*  
   SET @STRSQL = @STRSQL + ' UPDATE #CONTRACT SET REMARK_ID = ISNULL(T.REMARK_ID,''''), REMARK_DESC = ISNULL(T.REMARK_DESC,'''') '    
   --SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING T (NOLOCK) '    
   SET @STRSQL = @STRSQL + ' FROM #CONTRACT_TERMINAL_MAPPING T (NOLOCK) '   
   SET @STRSQL = @STRSQL + ' WHERE (#CONTRACT.USER_ID = (CASE WHEN ISNULL(T.TERMINAL_ID,'''') <> '''' THEN ISNULL(T.TERMINAL_ID,'''') ELSE #CONTRACT.USER_ID END) '    
   SET @STRSQL = @STRSQL + ' AND #CONTRACT.ORDER_NO = (CASE WHEN ISNULL(T.ORDER_NO,'''') <> '''' THEN ISNULL(T.ORDER_NO,'''') ELSE #CONTRACT.ORDER_NO END)) '    
   SET @STRSQL = @STRSQL + ' AND (ISNULL(T.TERMINAL_ID,'''') <> '''' OR ISNULL(T.ORDER_NO,'''') <> '''')'    
   --SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,SAUDA_DATE,103) BETWEEN CONVERT(DATETIME,CONVERT(VARCHAR,FROM_DATE,103),103) AND END_DATE '    
   --SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN FROM_DATE AND END_DATE '      
   SET @STRSQL = @STRSQL + ' AND EXCHANGE = ''' + @EXCHANGE_NEW + ''' AND SEGMENT = ''' + @SEGMENT_NEW + ''' '    
   --SET @STRSQL = @STRSQL + 'END '    
   SET @STRSQL = @STRSQL + 'END '    
*/  
  
  SET @STRSQL = @STRSQL + ' UPDATE #CONTRACT SET REMARK_ID = ISNULL(T.REMARK_ID,''''), REMARK_DESC = ISNULL(T.REMARK_DESC,'''') '    
  --SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING T (NOLOCK) '    
  SET @STRSQL = @STRSQL + ' FROM #CONTRACT_TERMINAL_MAPPING T '    
  SET @STRSQL = @STRSQL + ' WHERE #CONTRACT.ORDER_NO = T.ORDER_NO '    
  SET @STRSQL = @STRSQL + ' AND ISNULL(T.ORDER_NO,'''') <> '''' '    
--  SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,SAUDA_DATE,103) BETWEEN CONVERT(DATETIME,CONVERT(VARCHAR,FROM_DATE,103),103) AND END_DATE '    
  --SET @STRSQL = @STRSQL + ' AND CONVERT(VARCHAR(11),SAUDA_DATE,109) BETWEEN CONVERT(VARCHAR(11),FROM_DATE,109) AND CONVERT(VARCHAR(11),END_DATE,109) '      
  --SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN FROM_DATE AND END_DATE '      
  SET @STRSQL = @STRSQL + ' AND EXCHANGE = ''' + @EXCHANGE_NEW + ''' AND SEGMENT = ''' + @SEGMENT_NEW + ''' '    
  --SET @STRSQL = @STRSQL + 'END '   
    
  SET @STRSQL = @STRSQL + ' UPDATE #CONTRACT SET REMARK_ID = ISNULL(T.REMARK_ID,''''), REMARK_DESC = ISNULL(T.REMARK_DESC,'''') '    
  --SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.TBL_CONTRACT_TERMINAL_MAPPING T (NOLOCK) '    
  SET @STRSQL = @STRSQL + ' FROM #CONTRACT_TERMINAL_MAPPING T '    
  SET @STRSQL = @STRSQL + ' WHERE #CONTRACT.USER_ID = T.TERMINAL_ID '    
  SET @STRSQL = @STRSQL + ' AND ISNULL(T.TERMINAL_ID,'''') <> '''' '    
--  SET @STRSQL = @STRSQL + ' AND CONVERT(DATETIME,SAUDA_DATE,103) BETWEEN CONVERT(DATETIME,CONVERT(VARCHAR,FROM_DATE,103),103) AND END_DATE '    
  --SET @STRSQL = @STRSQL + ' AND CONVERT(VARCHAR(11),SAUDA_DATE,109) BETWEEN CONVERT(VARCHAR(11),FROM_DATE,109) AND CONVERT(VARCHAR(11),END_DATE,109) '      
  --SET @STRSQL = @STRSQL + ' AND SAUDA_DATE BETWEEN FROM_DATE AND END_DATE '      
  SET @STRSQL = @STRSQL + ' AND EXCHANGE = ''' + @EXCHANGE_NEW + ''' AND SEGMENT = ''' + @SEGMENT_NEW + ''' '    
  --SET @STRSQL = @STRSQL + 'END '    
  SET @STRSQL = @STRSQL + 'END '     
   --PRINT @STRSQL    
    
   EXEC (@STRSQL)    
                              
                            
                                         
   SET @STRSQL = 'UPDATE #CONTRACT SET CL_RATE = ISNULL(F.CL_RATE,0) '                                      
   SET @STRSQL = @STRSQL + ' FROM #FOCLOSING F '                                      
   SET @STRSQL = @STRSQL + ' WHERE F.SCRIPNAME = #CONTRACT.SCRIPNAME '     
   SET @STRSQL = @STRSQL + ' AND  F.EXCHANGE = #CONTRACT.EXCHANGE '   
   SET @STRSQL = @STRSQL + ' AND  F.SEGMENT = #CONTRACT.SEGMENT '                                    
   SET @STRSQL = @STRSQL + ' AND LEFT(BFCF_FLAG,2) = ''BT'' '                                      
   EXEC (@STRSQL)                                      
                                         
   TRUNCATE TABLE #FOCLOSING               
             
                                         
   /*                         
   --IF @SHAREDB <> 'BSEFO'                                       
   IF (                                      
     @SHAREDB <> 'BSEFO'                                      
     --OR @SHAREDB <> 'BSECURFO'                                      
     )                                      
   BEGIN                                      
    SET @STRSQL = 'UPDATE #CONTRACT SET CL_RATE = ISNULL(F.CL_RATE,0) '                                      
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + '.' + @SHAREDB + '.DBO.FOCLOSING F WITH (NOLOCK) '                                      
    SET @STRSQL = @STRSQL + ' WHERE F.TRADE_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
    SET @STRSQL = @STRSQL + ' AND SCRIPNAME = (CASE WHEN F.INST_TYPE LIKE ''FUT%'' THEN RTRIM(F.INST_TYPE) + '' '' + RTRIM(F.SYMBOL) + '' ''                                       
         + LEFT(F.EXPIRYDATE,11) ELSE RTRIM(F.INST_TYPE) + '' '' + RTRIM(F.SYMBOL) + '' '' + LEFT(F.EXPIRYDATE,11) + ''''                                       
         + RTRIM(CAST(CAST(F.STRIKE_PRICE AS NUMERIC(18,0)) AS VARCHAR)) + '' '' + RTRIM(F.OPTION_TYPE) END) '                                      
    SET @STRSQL = @STRSQL + ' AND LEFT(BFCF_FLAG,2) = ''BT'' '                                      
   END                                      
                                      
   IF (@SHAREDB = 'BSEFO')             
   BEGIN                                      
    SET @STRSQL = 'UPDATE #CONTRACT SET CL_RATE = ISNULL(F.CLOSE_PRICE,0) '                                      
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + '.' + @SHAREDB + '.DBO.BFOCLOSING F WITH (NOLOCK) '                                      
    SET @STRSQL = @STRSQL + ' WHERE F.TRADE_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
    SET @STRSQL = @STRSQL + ' AND SCRIPNAME = (RTRIM(F.PRODUCT_CODE) + '' '' + RTRIM(F.SERIES_CODE) + '' '' + CONVERT(VARCHAR,F.SERIES_ID,108)) '                                      
    SET @STRSQL = @STRSQL + ' AND LEFT(BFCF_FLAG,2) = ''BT'''                                      
   END                                      
                                      
   IF (@SHAREDB = 'BSECURFO')                                      
   BEGIN                                      
    SET @STRSQL = 'UPDATE #CONTRACT SET CL_RATE = ISNULL(F.CL_RATE,0) '                                      
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + '.' + @SHAREDB + '.DBO.FOCLOSING F WITH (NOLOCK) '                                      
    SET @STRSQL = @STRSQL + ' WHERE F.TRADE_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                
    --SET @STRSQL = @STRSQL + ' AND SCRIPNAME = (RTRIM(F.PRODUCT_CODE) + '' '' + RTRIM(F.SERIES_CODE) + '' '' + CONVERT(VARCHAR,F.SERIES_ID,108)) '                                      
   SET @STRSQL = @STRSQL + ' AND SCRIPNAME = (RTRIM(F.SYMBOL)) '                                      
    -- + '' '' + RTRIM(F.SERIES_CODE) + '' '' + CONVERT(VARCHAR,F.SERIES_ID,108)) '                                      
    --SET @STRSQL = @STRSQL + ' AND LEFT(BFCF_FLAG,2) = ''BT'''                                      
   END                                      
                                      
   --PRINT @STRSQL                                      
   EXEC (@STRSQL)                       
   */                                      
                                      
   SET @STRSQL = ' INSERT INTO #MTOM_FNO '                                      
   SET @STRSQL = @STRSQL + ' SELECT PARTY_CODE, MTM = SUM(SBILLAMT - PBILLAMT), EXCHANGE = ''' + @EXCHANGE_NEW + ''', SEGMENT = ''' + @SEGMENT_NEW + ''' '                                      
                                   
   --   IF @SHAREDB = 'BSEFO'                  
   IF (                                      
     @SHAREDB = 'BSEFO'                         
     --OR @SHAREDB = 'BSECURFO'                           
     )                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.BFOBILLVALAN F WITH (NOLOCK) '                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' FROM ' + @SHARESERVER + @SHAREDB + '.DBO.FOBILLVALAN F WITH (NOLOCK) '                                      
   END                                      
                                      
   SET @STRSQL = @STRSQL + ' WHERE SAUDA_DATE BETWEEN ''' + @FROMDATE + ''' AND ''' + @FROMDATE + ' 23:59:59'''                                      
   SET @STRSQL = @STRSQL + ' AND PARTY_CODE BETWEEN ''' + @FROMPARTY + ''' AND ''' + @TOPARTY + ''''                                      
   /*                                      
   IF @SHAREDB = 'BSEFO'                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' AND RIGHT(F.PRODUCT_CODE,3) = ''FUT'' '                                      
   END                                      
   ELSE                                      
   BEGIN                                      
    SET @STRSQL = @STRSQL + ' AND LEFT(F.INST_TYPE,3) = ''FUT'' '                                      
   END                                      
   */                                    
   SET @STRSQL = @STRSQL + ' GROUP BY PARTY_CODE '                                      
                                      
   --PRINT @STRSQL                                      
                                      
   EXEC (@STRSQL)                                      
  END                                      
             
 --END                                                        
 FETCH NEXT                              
 FROM @EXCHANGEWISE_CURSOR                                      
 INTO @COMPANYNAME,                                      
  @EXCHANGE_NEW,                   
  @SEGMENT_NEW,                                      
  @SHAREDB,                                      
  @SHARESERVER,                                      
  @ACCOUNTDB,                                      
  @ACCOUNTSERVER,  
  @CONTRACTGROUP_NEW  
END                                      
                                      
CLOSE @EXCHANGEWISE_CURSOR                                      
                                      
DEALLOCATE @EXCHANGEWISE_CURSOR                                      
                                      
UPDATE #CONTRACT                                      
SET NETOBLIGATION = MTM                                      
FROM #MTOM_FNO F(NOLOCK)                                      
WHERE F.PARTY_CODE = #CONTRACT.PARTY_CODE                                      
 AND F.EXCHANGE = #CONTRACT.EXCHANGE                                      
 AND F.SEGMENT = #CONTRACT.SEGMENT                  
UPDATE #CONTRACT SET NETAMOUNT =            
        CASE WHEN SELL_BUY =2 THEN ROUND((MARKETRATE - CL_RATE) * QTY,4) - BROKERAGE                    
        ELSE ROUND((CL_RATE-MARKETRATE) * QTY,4) - BROKERAGE END                    
                              
WHERE SEGMENT = 'FUTURES'                    
AND EXCHANGE <> 'MCD'                
AND LEFT(BFCF_FLAG, 2) = 'BT'             
                                        
            
              
                     
UPDATE #CONTRACT SET NETAMOUNT =             
        CASE WHEN SELL_BUY =2 THEN ROUND((MARKETRATE - CL_RATE) * QTY*CONVERT(INT,BOOKTYPE)/CONVERT(INT,INSTRUMENT)  ,4) - BROKERAGE                   
            
        ELSE ROUND((CL_RATE-MARKETRATE) * QTY*CONVERT(INT,BOOKTYPE)/CONVERT(INT,INSTRUMENT),4) - BROKERAGE END                   
                    
         
        
                  
WHERE SEGMENT = 'FUTURES'                    
AND EXCHANGE = 'MCD'                
AND LEFT(BFCF_FLAG, 2) = 'BT'         
                                  
SELECT  * INTO #CLIENT_DETAILS FROM MSAJAG..CLIENT_DETAILS  WHERE CL_CODE IN (SELECT DISTINCT PARTY_CODE FROM #CONTRACT )                        
  
CREATE CLUSTERED INDEX IDX_CL ON #CLIENT_DETAILS  
(  
 cl_code  
)  
  
UPDATE #CONTRACT      
SET CL_TYPE = ISNULL(C.CL_TYPE, ''),                                      
MAPIDID = MAPIN_ID,                 
UCC_CODE = C.UCC_CODE                                      
FROM #CLIENT_DETAILS C(NOLOCK)                                      
WHERE C.CL_CODE = #CONTRACT.PARTY_CODE                            
 AND SEGMENT = 'FUTURES'    
  
  
  
/*  
UPDATE #CONTRACT      
SET CL_TYPE = ISNULL(C.CL_TYPE, ''),                                      
 MAPIDID = MAPIN_ID,                 
 UCC_CODE = C.UCC_CODE                                      
FROM MSAJAG..CLIENT_DETAILS C(NOLOCK)                                      
WHERE C.CL_CODE = #CONTRACT.PARTY_CODE                            
 AND SEGMENT = 'FUTURES'     
   
 */                                   
                                      
UPDATE #CONTRACT                                      
SET SCRIPNAME = SCRIPNAME + ' (' + LEFT(BFCF_FLAG, 2) + ')'                                      
WHERE SEGMENT = 'FUTURES'                                      
 AND LEN(BFCF_FLAG) <> 0   
   
 UPDATE #CONTRACT                                      
SET SCRIPNAME = 'BROKERAGE'                                      
WHERE SEGMENT = 'FUTURES'   
 AND  LEFT(SCRIPNAME,5)='BROKE'                                   
  
                                     
                                      
UPDATE #CONTRACT                                      
SET CONTRACTNO = A.CONTRACTNO                                      
FROM (                                      
 SELECT SAUDA_DATE = LEFT(SAUDA_DATE, 11),                                      
  PARTY_CODE,                                      
  SETT_TYPE,                                      
  CONTRACTNO                                      
 FROM #CONTRACT(NOLOCK)                                      
 WHERE CONTRACTNO <> 0                                      
 GROUP BY LEFT(SAUDA_DATE, 11),                                      
  PARTY_CODE,                                      
  CONTRACTNO,                           
  SETT_TYPE                                      
 ) A                                      
WHERE A.PARTY_CODE = #CONTRACT.PARTY_CODE                                      
 AND LEFT(A.SAUDA_DATE, 11) = LEFT(#CONTRACT.SAUDA_DATE, 11)                                      
 AND A.SETT_TYPE = #CONTRACT.SETT_TYPE                                      
 AND #CONTRACT.SCRIPNAME = 'BROKERAGE'                                      
 AND #CONTRACT.SCRIPNAME = ''                                      
 AND #CONTRACT.CONTRACTNO = 0                                      
                                      
UPDATE #CONTRACT                                      
SET CONTRACT_HEADER_DET = EXCHANGE + ' - ' + SEGMENT + ' - ' + (CASE WHEN SEGMENT = 'CAPITAL' THEN SETTTYPE_DESC + ' (' + LTRIM(RTRIM(SETT_NO)) + ' - ' + LTRIM(RTRIM(SETT_TYPE)) + ' - ' + LTRIM(RTRIM(SETT_DATE)) + ' - REF. NO: ' + LTRIM(RTRIM(CONTRACTNO)

  
  
)+ ')' ELSE 'REF. NO: ' + LTRIM(RTRIM(CONTRACTNO)) END)                                      
                                      
--SCRIPNAME_NEW = (CASE WHEN REMARK_ID <> '' THEN '(' + REMARK_ID + ')' ELSE '' END) + LTRIM(RTRIM(SCRIPNAME))                                      
UPDATE #CONTRACT                                      
SET CONTRACT_HEADER_DET = EXCHANGE + ' - ' + SEGMENT                                      
WHERE SEGMENT = 'FUTURES'                                      
 AND BFCF_FLAG = 'BF_F'                                   
 AND LEFT(BFCF_FLAG, 2) = 'BT'                                      
                                      
UPDATE #CONTRACT                                      
SET CONTRACTNO = 0                                      
WHERE #CONTRACT.SCRIPNAME LIKE '%BROKERAGE%'            
  
  
--print '111'                            
                                      
--------------------------------- COMMON CONTRACT NO UPDATE STARTS HERE ----------------------------                                      
DECLARE @CONTGEN_COMMON INT                                      
                                      
IF (                                      
  SELECT COUNT(1)                                      
  FROM CONTGEN_COMMON                                      
  WHERE @FROMDATE BETWEEN START_DATE AND END_DATE                                      
  ) = 0                                      
BEGIN                                      
 RAISERROR (                                      
   'CANNOT PROCEED. PLEASE CONFIGURE THE CONT GEN COMMON FIRST',                                      
   16,                                      
   1                                      
   )                                      
                                      
 RETURN                                      
END                                     
                                      
BEGIN TRANSACTION                                      
                                      
SELECT @CONTGEN_COMMON = ISNULL(CONVERT(INT, CONTRACTNO), 0)                                      
FROM CONTGEN_COMMON                                      
WHERE @FROMDATE BETWEEN START_DATE AND END_DATE                                      
                                      
CREATE TABLE #CONTRACTNO (                                      
 SNO INT IDENTITY(1,1) NOT NULL,                                      
 PARTY_CODE VARCHAR(20),
 SETT_DATE	VARCHAR(11)                                      
 )                                      
             
CREATE CLUSTERED INDEX IDXPARTY ON #CONTRACTNO (PARTY_CODE)                                      
                                      
UPDATE #CONTRACT                                      
SET CONTRACTNO_NEW = ''        
  
  
SELECT DISTINCT EXCHANGE = LTRIM(RTRIM(EXCHANGE))+LTRIM(RTRIM(SEGMENT))  
INTO #EXCHANGE_NEW  
FROM #CONTRACT                                
  
CREATE TABLE #OLDCONTRACTNO  
(  
 PARTY_CODE VARCHAR(10),  
 CONTRACTNO_NEW VARCHAR(10)  
)  
  
CREATE CLUSTERED INDEX IDXPARTY ON #OLDCONTRACTNO (PARTY_CODE)                                      
  
 SET @EXCHANGEWISE_CURSOR_NEW = CURSOR  FOR                                      
 SELECT DISTINCT CONTRACTGROUP_NEW FROM #CONTMULTI  
 GROUP BY CONTRACTGROUP_NEW  
 ORDER BY CONTRACTGROUP_NEW  
  
 OPEN @EXCHANGEWISE_CURSOR_NEW  
 FETCH NEXT FROM @EXCHANGEWISE_CURSOR_NEW INTO @CONTRACTGROUP_NEW1  
 BEGIN  
 TRUNCATE TABLE #OLDCONTRACTNO  
 TRUNCATE TABLE #CONTRACTNO  
  
 INSERT  INTO #OLDCONTRACTNO   
 SELECT DISTINCT PARTY_CODE, CONTRACTNO_NEW FROM COMMON_CONTRACT_DATA (NOLOCK)                                      
 WHERE SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59'  
 AND EXISTS (SELECT DISTINCT EXCHANGE FROM #CONTMULTI C 
 WHERE C.EXCHANGE+C.SEGMENT = LTRIM(RTRIM(COMMON_CONTRACT_DATA.EXCHANGE))+LTRIM(RTRIM(COMMON_CONTRACT_DATA.SEGMENT))  
    AND CONTRACTGROUP_NEW = @CONTRACTGROUP_NEW1)  

  /*
  DECLARE @SEG INT
  SELECT @SEG=COUNT(1) FROM COMMON_CONTRACT_DATA (NOLOCK)                                      
 WHERE SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59'  
 AND EXCHANGE IN ('NSE','BSE')

 IF @SEG =0
    BEGIN 
	   INSERT  INTO #OLDCONTRACTNO   
	   SELECT PARTY_CODE,CONTRACTNOTENO FROM TBL_COMMONCONTRACTNOMASTER_CLOUD(NOLOCK)
	   WHERE TRADEDATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59' 
 
	   DECLARE @MXCONTNO INT
	   SELECT @MXCONTNO=MAX(ISNULL(RWNO,0)) FROM TBL_COMMONCONTRACTNOMASTER_CLOUD(NOLOCK)
	   WHERE TRADEDATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59' 

	   UPDATE CONTGEN_COMMON  SET CONTRACTNO = @MXCONTNO                                      
		WHERE @FROMDATE BETWEEN START_DATE AND END_DATE   
		
	SET @CONTGEN_COMMON =@MXCONTNO
		
		  
    END  
  */
 UPDATE #CONTRACT                                      
 SET CONTRACTNO_NEW = C.CONTRACTNO_NEW                                      
 FROM #OLDCONTRACTNO C(NOLOCK)                                      
 WHERE C.PARTY_CODE = #CONTRACT.PARTY_CODE                                      
    AND EXISTS (SELECT DISTINCT EXCHANGE FROM #CONTMULTI C 
	WHERE C.EXCHANGE+C.SEGMENT = LTRIM(RTRIM(#CONTRACT.EXCHANGE))+LTRIM(RTRIM(#CONTRACT.SEGMENT))  
    AND CONTRACTGROUP_NEW = @CONTRACTGROUP_NEW1)  
                                          
 INSERT INTO #CONTRACTNO                                      
 SELECT DISTINCT PARTY_CODE,
 SETT_DATE = (
			CASE 
				WHEN @CONTRACT_T1T2 = 1 THEN (CASE WHEN EXCHANGE IN ('NSE','BSE') AND SEGMENT='CAPITAL' THEN SETT_DATE ELSE '' END) 
				ELSE '' 
			END)                                      
 FROM #CONTRACT                                      
 WHERE SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59'  
 AND CONTRACTNO_NEW = ''            
    AND EXISTS (SELECT DISTINCT EXCHANGE FROM #CONTMULTI C WHERE C.EXCHANGE+C.SEGMENT = LTRIM(RTRIM(#CONTRACT.EXCHANGE))+LTRIM(RTRIM(#CONTRACT.SEGMENT))  
    AND CONTRACTGROUP_NEW = @CONTRACTGROUP_NEW1)  
 --print 111  
  
                                          
 UPDATE #CONTRACT                                      
 SET CONTRACTNO_NEW = STUFF('0000000000', 11 - LEN(@CONTGEN_COMMON + SNO), LEN(@CONTGEN_COMMON + SNO), @CONTGEN_COMMON + SNO)                                      
 FROM #CONTRACTNO T                                      
 WHERE #CONTRACT.PARTY_CODE = T.PARTY_CODE                                      
    AND EXISTS (SELECT DISTINCT EXCHANGE FROM #CONTMULTI C WHERE C.EXCHANGE+C.SEGMENT = LTRIM(RTRIM(#CONTRACT.EXCHANGE))+LTRIM(RTRIM(#CONTRACT.SEGMENT))  
    AND CONTRACTGROUP_NEW = @CONTRACTGROUP_NEW1)  
                                         
/* ---- START CHANGES FOR T1T2 SETTELEMENT ---*/

UPDATE #CONTRACT
SET CONTRACTNO_NEW = STUFF('0000000', 8 - LEN(@CONTGEN_COMMON + SNO), LEN(@CONTGEN_COMMON + SNO), @CONTGEN_COMMON + SNO)
FROM #CONTRACT B,
	#CONTRACTNO T
WHERE B.PARTY_CODE = T.PARTY_CODE
AND B.SETT_DATE = T.SETT_DATE
--AND B.SEGMENT = 'CAPITAL'
AND @CONTRACT_T1T2 = 1
AND EXISTS (SELECT DISTINCT EXCHANGE FROM #CONTMULTI C WHERE C.EXCHANGE+C.SEGMENT = LTRIM(RTRIM(B.EXCHANGE))+LTRIM(RTRIM(B.SEGMENT))  
AND CONTRACTGROUP_NEW = @CONTRACTGROUP_NEW1) 

/* ---- END CHANGES FOR T1T2 SETTELEMENT ---*/ 
 
 SELECT @CONTGEN_COMMON = @CONTGEN_COMMON + ISNULL(MAX(SNO), 0)                                      
 FROM #CONTRACTNO                                      
                                      
 UPDATE CONTGEN_COMMON                                 
 SET CONTRACTNO = @CONTGEN_COMMON                                      
 WHERE @FROMDATE BETWEEN START_DATE AND END_DATE                                      
  
 --print 1111  
   
 FETCH NEXT FROM @EXCHANGEWISE_CURSOR_NEW INTO @CONTRACTGROUP_NEW1  
END  
CLOSE @EXCHANGEWISE_CURSOR_NEW  
DEALLOCATE @EXCHANGEWISE_CURSOR_NEW  
  
DROP TABLE #CONTRACTNO                                      
--print 11111   
-----------------------/* Changes for IPFT */CHANGE done Dt 01 OCT 2024--------------------------

IF (CONVERT(DATETIME,@FROMDATE,109) > 'OCT  1 2024')
	BEGIN 
	ALTER TABLE #CONTRACT
	ADD IPFT_CHRG NUMERIC (18,4)

	ALTER TABLE #CONTRACT
	ADD SRNO INT IDENTITY(1,1)




	--DECLARE @SRNO INT = 0

	UPDATE #CONTRACT
	SET IPFT_CHRG=0.0 --,@SRNO=SRNO=@SRNO+1


	IF (@CONTRACTGROUP='CASHFNO')

	BEGIN 


	SELECT	PARTY_CODE,SETT_NO,SETT_TYPE,CONTRACTNO,SELL_BUY,IPFT_CHRG=SUM(IPFT_CHRG),ORDER_NO,TRADE_NO
	INTO	#CASH_IPFT FROM TBL_ADDITIONAL_TAX_DATA  (NOLOCK) 
	WHERE	SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59' AND TRDTYPE='N'
	GROUP BY
			PARTY_CODE,SETT_NO,SETT_TYPE,CONTRACTNO,SELL_BUY,ORDER_NO,TRADE_NO

	CREATE NONCLUSTERED INDEX [IDXCONTC] ON [DBO].[#CASH_IPFT] (    
	 [PARTY_CODE],[SETT_NO],[SETT_TYPE],    
	 --[ISIN],    
	 [CONTRACTNO],
	 [SELL_BUY]  ,ORDER_NO,TRADE_NO  
	 ) 

	--SELECT	SRNO=MAX(SRNO),PARTY_CODE,SETT_NO,SETT_TYPE,CONTRACTNO,SELL_BUY,IPFT_CHRG=CONVERT(NUMERIC(18,4),0)
	--INTO	#CONTRACT_CASH FROM #CONTRACT WHERE EXCHANGE ='NSE' AND SEGMENT = 'CAPITAL'
	--GROUP BY PARTY_CODE,SETT_NO,SETT_TYPE,CONTRACTNO,SELL_BUY


	--CREATE NONCLUSTERED INDEX [IDXCONTC22] ON [DBO].[#CONTRACT_CASH] (    
	-- [PARTY_CODE],[SETT_NO],[SETT_TYPE],    
	-- --[ISIN],    
	-- [CONTRACTNO],
	-- [SELL_BUY],
	-- [SRNO]    
	-- ) 

	UPDATE	#CONTRACT SET IPFT_CHRG = ISNULL(S.IPFT_CHRG,0) 
	FROM	#CASH_IPFT S (NOLOCK)
	WHERE	#CONTRACT.PARTY_CODE = S.PARTY_CODE
			AND #CONTRACT.SETT_NO = S.SETT_NO
			AND #CONTRACT.SETT_TYPE = S.SETT_TYPE
			AND #CONTRACT.CONTRACTNO = S.CONTRACTNO
			AND #CONTRACT.SELL_BUY = S.SELL_BUY
			AND #CONTRACT.ORDER_NO=S.ORDER_NO
			AND #CONTRACT.Trade_no=S.Trade_no


	--UPDATE	#CONTRACT SET IPFT_CHRG = ISNULL(#CONTRACT_CASH.IPFT_CHRG,0) 
	--FROM	#CONTRACT_CASH
	--WHERE	#CONTRACT_CASH.SRNO = #CONTRACT.SRNO


	SELECT	PARTY_CODE,CONTRACTNO,SELL_BUY,IPFT_CHRG=SUM(IPFT_CHRG),ORDER_NO,TRADE_NO
	INTO	#FNO_IPFT 
	FROM	[ANGELFO].NSEFO.DBO.TBL_ADDITIONAL_TAX_DATA with (NOLOCK) 
	WHERE	SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59' AND TRDTYPE='N'
	GROUP BY
			PARTY_CODE,CONTRACTNO,SELL_BUY,ORDER_NO,TRADE_NO


	CREATE NONCLUSTERED INDEX [IDXCONT11] ON [DBO].[#FNO_IPFT] (    
		[PARTY_CODE],    
		--[SCRIPNAME],    
		[CONTRACTNO],
		[SELL_BUY]    ,ORDER_NO,TRADE_NO
		) 


	--SELECT	SRNO=MAX(SRNO),PARTY_CODE,CONTRACTNO,SELL_BUY,IPFT_CHRG=CONVERT(NUMERIC(18,4),0)
	--INTO	#CONTRACT_1 FROM #CONTRACT 
	--WHERE	EXCHANGE ='NSE' AND SEGMENT = 'FUTURES' AND LEFT(BFCF_FLAG,2)='BT'
	--GROUP BY 
	--		PARTY_CODE,CONTRACTNO,SELL_BUY

	--CREATE NONCLUSTERED INDEX [IDXCONT12] ON [DBO].[#CONTRACT_1] (    
	--	[PARTY_CODE],    
	--	--[SCRIPNAME],    
	--	[CONTRACTNO],
	--	[SELL_BUY],
	--	[SRNO]    ,ORDER_NO,TRADE_NO
	--	) 

	UPDATE	#CONTRACT SET IPFT_CHRG = ISNULL(S.IPFT_CHRG,0)
	FROM	#FNO_IPFT S (NOLOCK)
	WHERE	#CONTRACT.PARTY_CODE = S.PARTY_CODE
			AND #CONTRACT.CONTRACTNO = S.CONTRACTNO
			AND #CONTRACT.SELL_BUY = S.SELL_BUY
			AND #CONTRACT.ORDER_NO=S.ORDER_NO
			AND #CONTRACT.Trade_no=S.Trade_no
			AND EXCHANGE ='NSE' AND SEGMENT = 'FUTURES' --AND LEFT(BFCF_FLAG,2)='BT'

   UPDATE C SET  IPFT_CHRG = ROUND((MARKETAMT*0.000005),4)  FROM #CONTRACT C (NOLOCK) 
   WHERE EXCHANGE ='NSE' AND SEGMENT ='FUTURES'
   AND ORDER_NO IN ('EXPIRY CLOSED','ASSIGNMENT') AND QTY <> 0 



    END

	--UPDATE	#CONTRACT SET IPFT_CHRG = ISNULL(#CONTRACT_1.IPFT_CHRG,0) 
	--FROM	#CONTRACT_1
	--WHERE	#CONTRACT_1.SRNO = #CONTRACT.SRNO


	SELECT	PARTY_CODE,CONTRACTNO,SELL_BUY,IPFT_CHRG=SUM(IPFT_CHRG),ORDER_NO,TRADE_NO 
	INTO	#CURFO_IPFT 
	FROM	[ANGELFO].NSECURFO.DBO.TBL_ADDITIONAL_TAX_DATA WITH (NOLOCK) 
	WHERE	SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59' AND TRDTYPE='N'
	GROUP BY
			PARTY_CODE,CONTRACTNO,SELL_BUY,ORDER_NO,TRADE_NO


	CREATE NONCLUSTERED INDEX [IDXCONT111] ON [DBO].[#CURFO_IPFT] (    
		[PARTY_CODE],    
		--[SCRIPNAME],    
		[CONTRACTNO],
		[SELL_BUY]   ,ORDER_NO,TRADE_NO 
		) 

	--SELECT	SRNO=MAX(SRNO),PARTY_CODE,CONTRACTNO,SELL_BUY,IPFT_CHRG=CONVERT(NUMERIC(18,4),0)
	--INTO	#CONTRACT_CURFO FROM #CONTRACT 
	--WHERE	EXCHANGE ='NSX' AND SEGMENT = 'FUTURES' AND LEFT(BFCF_FLAG,2)='BT'
	--GROUP BY PARTY_CODE,CONTRACTNO,SELL_BUY

	--CREATE NONCLUSTERED INDEX [IDXCONT222] ON [DBO].[#CONTRACT_CURFO] (    
	--	[PARTY_CODE],    
	--	--[SCRIPNAME],    
	--	[CONTRACTNO],
	--	[SELL_BUY],
	--	[SRNO]    
	--	) 


	UPDATE	#CONTRACT SET IPFT_CHRG = ISNULL(S.IPFT_CHRG,0)
	FROM	#CURFO_IPFT S (NOLOCK)
	WHERE	#CONTRACT_CURFO.PARTY_CODE = S.PARTY_CODE
			AND #CONTRACT_CURFO.CONTRACTNO = S.CONTRACTNO
			AND #CONTRACT_CURFO.SELL_BUY = S.SELL_BUY
			AND #CONTRACT.ORDER_NO=S.ORDER_NO
			AND #CONTRACT.Trade_no=S.Trade_no
			AND EXCHANGE ='NSX' AND SEGMENT = 'FUTURES' -- AND LEFT(BFCF_FLAG,2)='BT'


   UPDATE C SET  IPFT_CHRG = ROUND((MARKETAMT*0.000005),4)  FROM #CONTRACT C (NOLOCK) 
   WHERE EXCHANGE ='NSX' AND SEGMENT ='FUTURES'
   AND ORDER_NO IN ('EXPIRY CLOSED','ASSIGNMENT') AND QTY <> 0 


	--UPDATE	#CONTRACT SET IPFT_CHRG = ISNULL(#CONTRACT_CURFO.IPFT_CHRG,0) 
	--FROM	#CONTRACT_CURFO
	--WHERE	#CONTRACT_CURFO.SRNO = #CONTRACT.SRNO


	DROP TABLE #CASH_IPFT
	DROP TABLE #CONTRACT_CASH
	DROP TABLE #FNO_IPFT
	DROP TABLE #CONTRACT_1
	DROP TABLE #CURFO_IPFT
	DROP TABLE #CONTRACT_CURFO


	--DROP TABLE #TBL_ADDITIONAL_TAX_DATA
	--DROP TABLE #TBL_ADDITIONAL_TAX_DATA_FO


	ALTER TABLE #CONTRACT
	DROP COLUMN SRNO
END
--------------------------------------/* Changes for IPFT */ ---------------------------------------





--------------------------------- COMMON CONTRACT NO UPDATE ENDS HERE ----------------------------         
DELETE                                      
FROM COMMON_CONTRACT_DATA                                      
WHERE SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59'                                      
AND PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY                                      
AND EXISTS (SELECT DISTINCT EXCHANGE FROM #EXCHANGE_NEW C WHERE C.EXCHANGE = LTRIM(RTRIM(COMMON_CONTRACT_DATA.EXCHANGE))+LTRIM(RTRIM(COMMON_CONTRACT_DATA.SEGMENT)))  

-----SET IDENTITY_INSERT COMMON_CONTRACT_DATA OFF                                      
INSERT INTO COMMON_CONTRACT_DATA                                      
SELECT * 
FROM #CONTRACT                                      
ORDER BY PARTY_CODE,                                      
 EXCHANGE,                                      
 SEGMENT,                                      
 SCRIPNAME     
------- SET IDENTITY_INSERT COMMON_CONTRACT_DATA ON                                     
                                      
/* FOR LOG OF USER*/                            
DECLARE @EXCHANGE VARCHAR(20)                                      
DECLARE @DESC VARCHAR(MAX)                                      
DECLARE @SEGMENT VARCHAR(20)                                      
                                      
SELECT DISTINCT EXCHANGE,                                      
 SEGMENT,                                      
 EXCHANGE_DET = EXCHANGE + '-' + SEGMENT                                      
INTO #EXCHANGE                                      
FROM COMMON_CONTRACT_DATA                                      
WHERE SAUDA_DATE BETWEEN @FROMDATE AND @FROMDATE + ' 23:59:59'                                      
AND EXISTS (SELECT DISTINCT EXCHANGE FROM #EXCHANGE_NEW C WHERE C.EXCHANGE = LTRIM(RTRIM(COMMON_CONTRACT_DATA.EXCHANGE))+LTRIM(RTRIM(COMMON_CONTRACT_DATA.SEGMENT)))  
ORDER BY EXCHANGE,                                      
 SEGMENT                                      
                                      
ALTER TABLE #EXCHANGE                                      
                                      
ALTER COLUMN EXCHANGE_DET VARCHAR(MAX)                                      
                                      
SET @EXCHANGE = ''                                      
SET @DESC = ''                                     
SET @SEGMENT = ''                                      
                                      
UPDATE #EXCHANGE                                     
SET @DESC = EXCHANGE_DET = @DESC + '|' + EXCHANGE_DET,                              
 @EXCHANGE = EXCHANGE,                                      
 @SEGMENT = SEGMENT                                      
                                      
DECLARE @DESCRIPTION VARCHAR(MAX)                                      
                                      
SET @DESCRIPTION = (                                      
  SELECT MAX(EXCHANGE_DET)                                      
  FROM #EXCHANGE                                      
  )                                      
                                    
IF LEN(@DESCRIPTION) > 0                                      
BEGIN                                      
 INSERT INTO [COMMONCN_PROCESS_LOG]                                      
 VALUES (                                      
  @FROMDATE,                                  
  @USERNAME,                                      
  @DESCRIPTION,                                      
  GETDATE()                                      
  )                         
END                                      
                                 
/* END FOR LOG OF USER*/                                 
                                
                                
--EXEC PROC_MARING_REPORT_NEW  @FROMDATE    
  
 UPDATE COMMON_CONTRACT_DATA SET TRADE_TIME = '16:00:00'  WHERE SAUDA_DATE >= @FROMDATE  AND SAUDA_DATE <= @FROMDATE  + ' 23:59' 
  AND SETT_TYPE IN ('A','AD','AC','X') AND CONTRACTNO = '0000000' AND TRADE_TIME = '11:00:00'
  
  
UPDATE CLIENT_BROK_DETAILS  
SET DEACTIVE_VALUE = 'R',DEACTIVE_REMARKS = '',MODIFIEDBY = 'CCN',MODIFIEDON = GETDATE()  
FROM COMMON_CONTRACT_DATA , CLIENT_BROK_DETAILS  
WHERE COMMON_CONTRACT_DATA.SAUDA_DATE >= @FROMDATE  
AND COMMON_CONTRACT_DATA.SAUDA_DATE <= @FROMDATE   + ' 23:59' 
AND CLIENT_BROK_DETAILS.CL_CODE=COMMON_CONTRACT_DATA.PARTY_CODE  
AND CLIENT_BROK_DETAILS.DEACTIVE_VALUE = 'D'  
AND CLIENT_BROK_DETAILS.INACTIVE_FROM >= GETDATE()  
AND  CLIENT_BROK_DETAILS.EXCHANGE NOT IN ('NCX','MCX')                            
                                     
COMMIT                 

INSERT INTO CCN_STATUS (SAUDA_DATE,PROCESS_FOR,PROCESS_START_DATE,PROCESS_END_DATE) 
SELECT SAUDA_DATE=@FROMDATE,PROCESS_FOR=@CONTRACTGROUP,PROCESS_START_DATE=@SDDATE,PROCESS_END_DATE =GETDATE()
                     
                                      
DROP TABLE #PARTY                                      
                     
DROP TABLE #CONTRACT                                      
                                      
DROP TABLE #CLIENT_BROK_DETAILS                                      
                                      
DROP TABLE #MTOM_FNO                                      
                                      
DROP TABLE #EXCHANGE   
set xact_abort off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_ACMASTFLAG
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ALL_ACMASTFLAG] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))        
        
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'        
    Select distinct Party_code into #T4 from MSAJAG..settlement with (nolock)  where Sauda_date >=cast(getdate() as date) 
select  party_code from #T4 where party_code not in (select cltcode from account.dbo.acmast with (nolock) )

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_ACMASTFLAG_BSE
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ALL_ACMASTFLAG_BSE] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))        
        
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'        
    Select distinct Party_code into #T1 from ANGELBSECM.bsedb_ab.dbo.settlement with (nolock)  where Sauda_date >=cast(getdate() as date) 
select party_code from #T1 where party_code not in (select cltcode from account.dbo.acmast  with (nolock) )

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_BATCH_GENERATION_COMM_UAT
-- --------------------------------------------------
    
CREATE PROCEDURE PROC_ALL_BATCH_GENERATION_COMM_UAT (@RUNDTE DATETIME,@BATCH INT)    
    
AS    


--EXEC PROC_ALL_BATCH_GENERATION_COMM_UAT 'JUL 24 2023','145'    
    
/* DELETE OLD DATA FROM BATCH FOLDER */    
DECLARE @N AS VARCHAR(2) = '0'    
DECLARE @PATH AS VARCHAR(200) =  'J:\BACKOFFICE\ALLOCATION\BATCH_FILES_UAT'    
DECLARE @DELETESQL AS VARCHAR(512)    
SET @DELETESQL = 'FORFILES /P "' + @PATH + '" /S /M *.* /D -' + @N + ' /C "CMD /C DEL @PATH"'    
EXEC MASTER.DBO.XP_CMDSHELL @DELETESQL, NO_OUTPUT     
    
    
IF OBJECT_ID(N'tempdb..#MCX_DATA') IS NOT NULL    
BEGIN     
DROP TABLE #MCX_DATA    
END    
  
SELECT A.* ,(CASE WHEN B.INACTIVE_FROM LIKE '%2049%' THEN 'Y' ELSE 'N' END)  AS 'MCX_ACTIVE'  
INTO TBL_ALLOCATION_REPORTING_FILE  
FROM MSAJAG.DBO.TBL_ALLOCATION_REPORTING A LEFT JOIN MSAJAG.dbo.CLIENT_BROK_DETAILS B ON A.CLIENT_CODE=B.CL_CODE AND EXCHANGE='MCX' AND SEGMENT='FUTURES'  
---MCX BATCH GENERATION     
SELECT ROW_NUMBER() OVER (ORDER BY CLIENT_CODE ASC) AS SRNO,RPTDATE=REPLACE(LEFT(CONVERT(varchar,@RUNDTE,13),11),' ','-'),
SEGMENT='CO',CM_CODE='12685',TM_CODE='12685',FILER1='',CLIENT_CODE,    
ATYPE='C',ALLCATION_AMT=ROUND(CASE WHEN SHORATGE1 > MCX_UPLOAD THEN MCX_UPLOAD ELSE  SHORATGE1 END,2),    
FILER2='',FILER3='',FILER4='',FILER5='',FILER6='',FILER7='',UPLOAD='A'  into #MCX_DATA  
FROM TBL_ALLOCATION_REPORTING_FILE  WHERE SHORATGE1 > 0 AND MCX_UPLOAD > 0 AND MCX_ACTIVE='Y'  
    
 
/* GENERATE BATCH FILES */    
  
TRUNCATE TABLE DUSTBIN.DBO.ALLSPLIT    
INSERT INTO DUSTBIN.DBO.ALLSPLIT    
SELECT RPTDATE+','+SEGMENT+','+CM_CODE+','+TM_CODE+',,'+CLIENT_CODE+','+ATYPE+','+CONVERT(VARCHAR,ALLCATION_AMT)+',,,,,,,'+UPLOAD     
FROM #MCX_DATA WHERE ALLCATION_AMT <> 0    
    
DECLARE @DIRCOLLNAMEAM VARCHAR(100) = 'J:\BACKOFFICE\ALLOCATION\BATCH_FILES_UAT\' +'MCCLCOLL_12685_' + REPLACE(CONVERT(VARCHAR(11),@RUNDTE,105),'-','') +    
CASE WHEN LEN(@BATCH)=1 THEN '.00' WHEN LEN(@BATCH)=2 THEN '.0'  ELSE '.' END + CONVERT(VARCHAR,@BATCH)     
    
DECLARE @DIRCOLLSTMTAM NVARCHAR(4000) = 'SELECT ALL_DATA FROM DUSTBIN.DBO.ALLSPLIT'    
    
DECLARE @DIRCOLLBCPAM VARCHAR(4000) = 'BCP "' + @DIRCOLLSTMTAM + '" QUERYOUT "' + @DIRCOLLNAMEAM + '" -c -t"," -r"\n" -T'    
    
EXEC MASTER..XP_CMDSHELL @DIRCOLLBCPAM, NO_OUTPUT  
  
DROP TABLE TBL_ALLOCATION_REPORTING_FILE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_SETTLEMENT_BSE
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ALL_SETTLEMENT_BSE] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))        
        
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'        
    select count(1) AS BSE_CAPITAL_SETTLEMENT_COUNT from ANGELBSECM.BSEDB_AB.DBO.settlement with (nolock) where Sauda_Date >=CAST(GETDATE() AS date)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_SETTLEMENT_NSE
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ALL_SETTLEMENT_NSE] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))        
        
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'        
    select count(1) AS NSE_CAPITAL_SETTLEMENT_COUNT from MSAJAG..settlement with (nolock) where Sauda_Date >=CAST(GETDATE() AS date)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_SETTMASTFLAG
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ALL_SETTMASTFLAG] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))        
        
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'        
    select  sett_type,party_code,scrip_cd ,pos=sum(case when Sell_buy=1 Then Tradeqty else Tradeqty*-1 end)
 from MSAJAG..settlement with (Nolock) where sauda_date >=cast(getdate() as date)
 and Settflag in (2,3)
 group by sett_type,party_code,scrip_cd
 Having sum(case when Sell_buy=1 Then Tradeqty else Tradeqty*-1 end) <>0

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ALL_SETTMASTFLAG_BSE
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ALL_SETTMASTFLAG_BSE] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))        
        
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'        
    select  sett_type,party_code,scrip_cd ,pos=sum(case when Sell_buy=1 Then Tradeqty else Tradeqty*-1 end)
 from anand.bsedb_ab.dbo.settlement with (Nolock) where sauda_date >=cast(getdate() as date)
 and Settflag in (2,3)
 group by sett_type,party_code,scrip_cd
 Having sum(case when Sell_buy=1 Then Tradeqty else Tradeqty*-1 end) <>0

GO

-- --------------------------------------------------
-- PROCEDURE dbo.proc_Auction_Turnovertax_process
-- --------------------------------------------------
Create ProC proc_Auction_Turnovertax_process (@sett_no varchar(11),@sett_type varchar(2))
As
Begin
Update S Set turn_tax=Round((Tradeqty*MarketRate*0.00297/100),4),NSerTax=(Round((Tradeqty*MarketRate*0.00297/100),4)*18/100),
Service_tax=(Round((Tradeqty*MarketRate*0.00297/100),4)*18/100)
from settlement S where sett_no = @sett_no and sett_type=@sett_type   And AuctionPart like 'F%' and MarketRate <>0
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_CLIENT_COLLATREAL_PROCESS
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_CLIENT_COLLATREAL_PROCESS]      
@PROCESSTYPE VARCHAR(20)='' ,  
 @RUNDATE VARCHAR(11)     
    
AS    
  
select * from ALLOCATE_TEMP_NEW_HRISHI(nolock)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_COLL_RECO_UPLOAD_BKP_03MAY2024
-- --------------------------------------------------
         
CREATE PROC [dbo].[PROC_COLL_RECO_UPLOAD_BKP_03MAY2024] (@TDATE VARCHAR(10), @FILEFOR VARCHAR(20), @FILETYPE VARCHAR(50), @PROGID VARCHAR(50), @UNAME VARCHAR(50),@FILENAME VARCHAR(500) = '')        
        
AS    

--Altered SP by Akshay M for SRE-22996 
        
-- EXEC PROC_COLL_RECO_UPLOAD '09/04/2018', '', '', '1234567890', ''        
DECLARE @RECCNT INT,        
  @FILEDATE DATETIME,        
  @EXCHANGE VARCHAR(3),        
  @SEGMENT VARCHAR(7),        
  @BSEMEMBERCODE VARCHAR(10)        
        
SELECT @BSEMEMBERCODE = MEMBERCODE FROM AngelBSECM.BSEDB_AB.DBO.OWNER WITH (NOLOCK)       
        
SELECT TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD        
INTO #DATA        
FROM TBL_CLIENT_COLL_RECO WITH (NOLOCK)              
WHERE 1 = 2         
       
  
IF @FILENAME LIKE '%CollDetailed%' or @FILENAME LIKE '%Collalloc%'        
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     '', '',        
     .DBO.PIECE(FILE_DATA,',',1),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',4),         
     .DBO.PIECE(FILE_DATA,',',5),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',1),'0') NOT LIKE 'CM Code'        
 and ISNULL(.DBO.PIECE(FILE_DATA,',',1),'0') NOT LIKE 'All amounts in Rs.%'        
END        
        
IF @FILENAME LIKE '%WEBALLO%' or @FILENAME LIKE '%After_Deallocation%'    
  
	BEGIN
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     'MCX', 'FUTURES',        
     .DBO.PIECE(FILE_DATA,',',2),        
     .DBO.PIECE(FILE_DATA,',',4),         
     .DBO.PIECE(FILE_DATA,',',6),         
    -- .DBO.PIECE(FILE_DATA,',',13)
	REPLACE(REPLACE(.DBO.PIECE(FILE_DATA,',',13),'"',''),',',''),    
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME,
      REPLACE(REPLACE(.DBO.PIECE(FILE_DATA,',',22),'"',''),',',''),
    REPLACE(REPLACE(.DBO.PIECE(FILE_DATA,',',23),'"',''),',','')
   --.DBO.PIECE(FILE_DATA,',',22),
   --.DBO.PIECE(FILE_DATA,',',23)
    -- (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) END),        
     --(CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',23)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',23)))) END)        
 FROM FILEDATA        
 WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',2),'0') NOT IN ('CM Code','Clearing Member Code','')
 --WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',2),'0') NOT LIKE 'CM Code'           
 
 
 UPDATE #DATA SET TMCODE = CMCODE WHERE TMCODE = ''        
END        
        
IF @FILENAME LIKE '%ClientNetEffective%'         
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     'NCX', 'FUTURES',        
     .DBO.PIECE(FILE_DATA,',',1),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     .DBO.PIECE(FILE_DATA,',',4),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME,           
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) END),        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) END)        
 FROM FILEDATA        
 WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',1),'0') NOT LIKE 'CM Code'        
         
 UPDATE #DATA SET TMCODE = CMCODE WHERE TMCODE = ''         
END        
        
IF @FILENAME LIKE '%C_CC01%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'CAPITAL',        
     '',        
     '',         
     .DBO.PIECE(FILE_DATA,',',1),         
     .DBO.PIECE(FILE_DATA,',',2),         
     @FILENAME,UPLOAD_ON = GETDATE(),     
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
END        
        
IF @FILENAME LIKE '%F_CC01%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
         
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'FUTURES',        
     '',        
     '',         
     .DBO.PIECE(FILE_DATA,',',1),         
     .DBO.PIECE(FILE_DATA,',',2),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
END        
        
IF @FILENAME LIKE '%X_CC01%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSX', 'FUTURES',        
     '',        
     '',         
     .DBO.PIECE(FILE_DATA,',',1),         
     .DBO.PIECE(FILE_DATA,',',2),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
END        
        
        
        
IF @FILENAME LIKE '%C_CC02%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'CAPITAL',        
     '',         
     (CASE WHEN .DBO.PIECE(FILE_DATA,',',1) = .DBO.PIECE(FILE_DATA,',',2) THEN '' ELSE .DBO.PIECE(FILE_DATA,',',1) END),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
         
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = TMCODE         
END        
        
IF @FILENAME LIKE '%F_CC02%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'FUTURES',        
     '',        
     (CASE WHEN .DBO.PIECE(FILE_DATA,',',1) = .DBO.PIECE(FILE_DATA,',',2) THEN '' ELSE .DBO.PIECE(FILE_DATA,',',1) END),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
        
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = TMCODE         
END        
        
IF @FILENAME LIKE '%X_CC02%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSX', 'FUTURES',        
     '',        
     (CASE WHEN .DBO.PIECE(FILE_DATA,',',1) = .DBO.PIECE(FILE_DATA,',',2) THEN '' ELSE .DBO.PIECE(FILE_DATA,',',1) END),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
        
     
      
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
        
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = TMCODE         
END        
        
IF @FILENAME LIKE '%ClientAllocation_'+LTRIM(RTRIM(@BSEMEMBERCODE))+'%'         
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     'BSE', .DBO.PIECE(FILE_DATA,',',2),        
     .DBO.PIECE(FILE_DATA,',',3),        
     .DBO.PIECE(FILE_DATA,',',4),        
     .DBO.PIECE(FILE_DATA,',',6),         
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',12)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',12)))) END)-        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',10)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',10)))) END),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME,        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) END),        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) END)        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
 AND .DBO.PIECE(FILE_DATA,',',4) = @BSEMEMBERCODE        
        
 UPDATE #DATA SET EXCHANGE = 'BSX', SEGMENT = 'FUTURES' WHERE SEGMENT LIKE '%CURR%' OR SEGMENT LIKE '%CDX%'        
 UPDATE #DATA SET EXCHANGE = 'BCX', SEGMENT = 'FUTURES' WHERE SEGMENT LIKE '%COMM%'         
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = 'OWN'         
 /*        
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT  */        
END        
        
SELECT @RECCNT = 0         
SELECT @RECCNT = ISNULL(COUNT(1),0) FROM #DATA        
        
IF @RECCNT > 0         
BEGIN         
 IF @FILENAME LIKE '%CollDetailed%' or @FILENAME LIKE '%Collalloc%'        
 BEGIN        
  UPDATE #DATA SET EXCHANGE = 'NSE', SEGMENT = 'CAPITAL' WHERE  @FILENAME NOT LIKE '%FO%' AND @FILENAME NOT LIKE '%MCD%'        
          
  UPDATE #DATA SET EXCHANGE = 'NSE', SEGMENT = 'FUTURES' WHERE   @FILENAME LIKE '%FO%'        
          
  UPDATE #DATA SET EXCHANGE = 'NSX', SEGMENT = 'FUTURES' WHERE  @FILENAME LIKE '%MCD%'        
        
  UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = 'PROPRIETARY'        
 END        


 CREATE INDEX EXCHANGE ON #DATA (EXCHANGE,SEGMENT)
     
 DELETE FROM TBL_CLIENT_COLL_RECO        
 WHERE TRANSDATE= CONVERT(DATETIME,@TDATE,103)        
 AND EXISTS (SELECT EXCHANGE FROM #DATA WHERE #DATA.EXCHANGE = TBL_CLIENT_COLL_RECO.EXCHANGE AND #DATA.SEGMENT = TBL_CLIENT_COLL_RECO.SEGMENT)        
        
 INSERT INTO TBL_CLIENT_COLL_RECO        
 SELECT * FROM #DATA        
END        
         
SELECT STRMSGCODE = 1, STRMSG = CONVERT(VARCHAR,@RECCNT) + ' RECORD(S) UPLOADED.'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_COLL_RECO_UPLOAD_BKP_04Mar2024SRE-22996
-- --------------------------------------------------
         
CREATE PROC [dbo].[PROC_COLL_RECO_UPLOAD_BKP_04Mar2024SRE-22996] (@TDATE VARCHAR(10), @FILEFOR VARCHAR(20), @FILETYPE VARCHAR(50), @PROGID VARCHAR(50), @UNAME VARCHAR(50),@FILENAME VARCHAR(500) = '')        
        
AS        
        
-- EXEC PROC_COLL_RECO_UPLOAD '09/04/2018', '', '', '1234567890', ''        
DECLARE @RECCNT INT,        
  @FILEDATE DATETIME,        
  @EXCHANGE VARCHAR(3),        
  @SEGMENT VARCHAR(7),        
  @BSEMEMBERCODE VARCHAR(10)        
        
SELECT @BSEMEMBERCODE = MEMBERCODE FROM AngelBSECM.BSEDB_AB.DBO.OWNER WITH (NOLOCK)       
        
SELECT TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD        
INTO #DATA        
FROM TBL_CLIENT_COLL_RECO WITH (NOLOCK)              
WHERE 1 = 2         
       
  
IF @FILENAME LIKE '%CollDetailed%' or @FILENAME LIKE '%Collalloc%'        
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     '', '',        
     .DBO.PIECE(FILE_DATA,',',1),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',4),         
     .DBO.PIECE(FILE_DATA,',',5),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',1),'0') NOT LIKE 'CM Code'        
 and ISNULL(.DBO.PIECE(FILE_DATA,',',1),'0') NOT LIKE 'All amounts in Rs.%'        
END        
        
IF @FILENAME LIKE '%WEBALLO%'         
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     'MCX', 'FUTURES',        
     .DBO.PIECE(FILE_DATA,',',2),        
     .DBO.PIECE(FILE_DATA,',',4),         
     .DBO.PIECE(FILE_DATA,',',6),         
     .DBO.PIECE(FILE_DATA,',',10),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME,        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',19)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',19)))) END),        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',20)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',20)))) END)        
 FROM FILEDATA        
 WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',2),'0') NOT LIKE 'CM Code'        
         
 UPDATE #DATA SET TMCODE = CMCODE WHERE TMCODE = ''         
END        
        
IF @FILENAME LIKE '%ClientNetEffective%'         
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     'NCX', 'FUTURES',        
     .DBO.PIECE(FILE_DATA,',',1),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     .DBO.PIECE(FILE_DATA,',',4),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME,           
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) END),        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',22)))) END)        
 FROM FILEDATA        
 WHERE PROGID = @PROGID AND ISNULL(.DBO.PIECE(FILE_DATA,',',1),'0') NOT LIKE 'CM Code'        
         
 UPDATE #DATA SET TMCODE = CMCODE WHERE TMCODE = ''         
END        
        
IF @FILENAME LIKE '%C_CC01%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'CAPITAL',        
     '',        
     '',         
     .DBO.PIECE(FILE_DATA,',',1),         
     .DBO.PIECE(FILE_DATA,',',2),         
     @FILENAME,UPLOAD_ON = GETDATE(),     
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
END        
        
IF @FILENAME LIKE '%F_CC01%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
         
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'FUTURES',        
     '',        
     '',         
     .DBO.PIECE(FILE_DATA,',',1),         
     .DBO.PIECE(FILE_DATA,',',2),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
END        
        
IF @FILENAME LIKE '%X_CC01%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSX', 'FUTURES',        
     '',        
     '',         
     .DBO.PIECE(FILE_DATA,',',1),         
     .DBO.PIECE(FILE_DATA,',',2),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
END        
        
        
        
IF @FILENAME LIKE '%C_CC02%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'CAPITAL',        
     '',         
     (CASE WHEN .DBO.PIECE(FILE_DATA,',',1) = .DBO.PIECE(FILE_DATA,',',2) THEN '' ELSE .DBO.PIECE(FILE_DATA,',',1) END),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
         
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = TMCODE         
END        
        
IF @FILENAME LIKE '%F_CC02%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSE', 'FUTURES',        
     '',        
     (CASE WHEN .DBO.PIECE(FILE_DATA,',',1) = .DBO.PIECE(FILE_DATA,',',2) THEN '' ELSE .DBO.PIECE(FILE_DATA,',',1) END),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
         
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
        
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = TMCODE         
END        
        
IF @FILENAME LIKE '%X_CC02%'         
BEGIN        
 SELECT @FILEDATE = CONVERT(DATETIME,LEFT(LEFT(RIGHT(@FILENAME,12),8),2) + '/' + RIGHT(LEFT(LEFT(RIGHT(@FILENAME,12),8),4),2) + '/' + LEFT(RIGHT(@FILENAME,8),4),103)        
        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY)        
 SELECT @FILEDATE,         
     'NSX', 'FUTURES',        
     '',        
     (CASE WHEN .DBO.PIECE(FILE_DATA,',',1) = .DBO.PIECE(FILE_DATA,',',2) THEN '' ELSE .DBO.PIECE(FILE_DATA,',',1) END),        
     .DBO.PIECE(FILE_DATA,',',2),         
     .DBO.PIECE(FILE_DATA,',',3),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
        
     
      
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT         
        
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = TMCODE         
END        
        
IF @FILENAME LIKE '%ClientAllocation_'+LTRIM(RTRIM(@BSEMEMBERCODE))+'%'         
BEGIN        
 INSERT INTO #DATA (TRANSDATE,EXCHANGE,SEGMENT,CMCODE,TMCODE,CLIENTCODE,AMOUNT,RECO_FILENAME,UPLOAD_ON,UPLOAD_BY,Total_Collateral_EOD,Eligible_Collateral_EOD)        
 SELECT CONVERT(DATETIME,@TDATE,103),         
     'BSE', .DBO.PIECE(FILE_DATA,',',2),        
     .DBO.PIECE(FILE_DATA,',',3),        
     .DBO.PIECE(FILE_DATA,',',4),        
     .DBO.PIECE(FILE_DATA,',',6),         
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',12)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',12)))) END)-        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',10)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',10)))) END),         
     @FILENAME,UPLOAD_ON = GETDATE(),        
   UPLOAD_BY = @UNAME,        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) END),        
     (CASE WHEN LEN(LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) = 0 THEN 0 ELSE CONVERT(FLOAT,LTRIM(RTRIM(.DBO.PIECE(FILE_DATA,',',13)))) END)        
 FROM FILEDATA        
 WHERE PROGID = @PROGID          
 AND .DBO.PIECE(FILE_DATA,',',4) = @BSEMEMBERCODE        
        
 UPDATE #DATA SET EXCHANGE = 'BSX', SEGMENT = 'FUTURES' WHERE SEGMENT LIKE '%CURR%' OR SEGMENT LIKE '%CDX%'        
 UPDATE #DATA SET EXCHANGE = 'BCX', SEGMENT = 'FUTURES' WHERE SEGMENT LIKE '%COMM%'         
 UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = 'OWN'         
 /*        
 UPDATE #DATA SET TMCODE = D.TMCODE FROM TBL_CMCC_DETAIL D        
 WHERE CONVERT(DATETIME,@TDATE,103) BETWEEN FROM_DATE AND TO_DATE         
 AND D.EXCHANGE = #DATA.EXCHANGE AND D.SEGMENT = #DATA.SEGMENT  */        
END        
        
SELECT @RECCNT = 0         
SELECT @RECCNT = ISNULL(COUNT(1),0) FROM #DATA        
        
IF @RECCNT > 0         
BEGIN         
 IF @FILENAME LIKE '%CollDetailed%' or @FILENAME LIKE '%Collalloc%'        
 BEGIN        
  UPDATE #DATA SET EXCHANGE = 'NSE', SEGMENT = 'CAPITAL' WHERE  @FILENAME NOT LIKE '%FO%' AND @FILENAME NOT LIKE '%MCD%'        
          
  UPDATE #DATA SET EXCHANGE = 'NSE', SEGMENT = 'FUTURES' WHERE   @FILENAME LIKE '%FO%'        
          
  UPDATE #DATA SET EXCHANGE = 'NSX', SEGMENT = 'FUTURES' WHERE  @FILENAME LIKE '%MCD%'        
        
  UPDATE #DATA SET CLIENTCODE = '' WHERE CLIENTCODE = 'PROPRIETARY'        
 END        


 CREATE INDEX EXCHANGE ON #DATA (EXCHANGE,SEGMENT)
     
 DELETE FROM TBL_CLIENT_COLL_RECO        
 WHERE TRANSDATE= CONVERT(DATETIME,@TDATE,103)        
 AND EXISTS (SELECT EXCHANGE FROM #DATA WHERE #DATA.EXCHANGE = TBL_CLIENT_COLL_RECO.EXCHANGE AND #DATA.SEGMENT = TBL_CLIENT_COLL_RECO.SEGMENT)        
        
 INSERT INTO TBL_CLIENT_COLL_RECO        
 SELECT * FROM #DATA        
END        
         
SELECT STRMSGCODE = 1, STRMSG = CONVERT(VARCHAR,@RECCNT) + ' RECORD(S) UPLOADED.'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_DISABLE_MCDX_FUTURES_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_DISABLE_MCDX_FUTURES_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))              
              
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'              
    EXEC ANGELCOMMODITY.msdb.dbo.sp_update_job    
@job_name='MCX FUTURES AUTO PROCESS SETTLEMENT',@enabled = 0    
select JOB_STATUS='MULTI COMMODITY AUTOMATION JOB IS SUCCESSFULLY DISABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_DISABLE_NCDX_FUTURES_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_DISABLE_NCDX_FUTURES_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))              
              
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'              
    EXEC ANGELCOMMODITY.msdb.dbo.sp_update_job    
@job_name='NCX FUTURES AUTO PROCESS SETTLEMENT',@enabled = 0    
select JOB_STATUS='NATIONAL COMMODITY AUTOMATION JOB IS SUCCESSFULLY DISABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_DISABLE_NSE_CAPITAL_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_DISABLE_NSE_CAPITAL_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))          
          
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'          
    EXEC ANAND1.msdb.dbo.sp_update_job
@job_name='NSE CASH AUTO PROCESS SETTLEMENT',@enabled = 0
select JOB_STATUS='NSE-CAPITAL AUTOMATION JOB IS SUCCESSFULLY DISABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_DISABLE_NSE_CURRENCY_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_DISABLE_NSE_CURRENCY_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))            
            
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'            
    EXEC ANGELFO.msdb.dbo.sp_update_job  
@job_name='NSE CURRENCY AUTO PROCESS SETTLEMENT',@enabled = 0  
select JOB_STATUS='NSE-CURRENCY AUTOMATION JOB IS SUCCESSFULLY DISABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_DISABLE_NSE_FUTURES_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_DISABLE_NSE_FUTURES_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))            
            
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'            
    EXEC ANGELFO.msdb.dbo.sp_update_job  
@job_name='NSE FUTURES AUTO PROCESS SETTLEMENT',@enabled = 0  
select JOB_STATUS='NSE-FUTURES AUTOMATION JOB IS SUCCESSFULLY DISABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ENABLE_MCDX_FUTURES_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ENABLE_MCDX_FUTURES_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))              
              
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'              
    EXEC ANGELCOMMODITY.msdb.dbo.sp_update_job    
@job_name='MCX FUTURES AUTO PROCESS SETTLEMENT',@enabled = 1    
select JOB_STATUS='MULTI COMMODITY AUTOMATION JOB IS SUCCESSFULLY ENABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ENABLE_NCDX_FUTURES_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ENABLE_NCDX_FUTURES_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))              
              
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'              
    EXEC ANGELCOMMODITY.msdb.dbo.sp_update_job    
@job_name='NCX FUTURES AUTO PROCESS SETTLEMENT',@enabled = 1    
select JOB_STATUS='NATIONAL COMMODITY AUTOMATION JOB IS SUCCESSFULLY ENABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ENABLE_NSE_CAPITAL_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ENABLE_NSE_CAPITAL_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))          
          
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'          
    EXEC ANAND1.msdb.dbo.sp_update_job
@job_name='NSE CASH AUTO PROCESS SETTLEMENT',@enabled = 1
select JOB_STATUS='NSE-CAPITAL AUTOMATION JOB IS SUCCESSFULLY ENABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ENABLE_NSE_CURRENCY_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ENABLE_NSE_CURRENCY_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))            
            
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'            
    EXEC ANGELFO.msdb.dbo.sp_update_job  
@job_name='NSE CURRENCY AUTO PROCESS SETTLEMENT',@enabled = 1  
select JOB_STATUS='NSE-CURRENCY AUTOMATION JOB IS SUCCESSFULLY ENABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_ENABLE_NSE_FUTURES_JOB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_ENABLE_NSE_FUTURES_JOB] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))            
            
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'            
    EXEC ANGELFO.msdb.dbo.sp_update_job  
@job_name='NSE FUTURES AUTO PROCESS SETTLEMENT',@enabled = 1  
select JOB_STATUS='NSE-FUTURES AUTOMATION JOB IS SUCCESSFULLY ENABLED'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_MARGIN_MG13_UP_UDIFF_EOD_BKUP_26JUL2024
-- --------------------------------------------------



CREATE PROC [dbo].[PROC_MARGIN_MG13_UP_UDIFF_EOD_BKUP_26JUL2024]   
(
	@FILENAME VARCHAR(100),
	@TRADEDATE VARCHAR(11),
	@PROCID VARCHAR(50)=''
)  
AS  
/*
	PROC TO IMPORT F&O MARGIN FILE
	EXEC PROC_MARGIN_MG13_UP_UDIFF_EOD 'D:/Backoffice/MARGIN/Margin_NCL_CD_0_TM_06769_20240304_F_0000.CSV','04/03/2024',''

*/

IF LEN(@TRADEDATE) = 10 AND CHARINDEX('/', @TRADEDATE) > 0
BEGIN
	SET @TRADEDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @TRADEDATE, 103), 109)
END

 
--TRUNCATE TABLE FOMARGINNEW_IMP_STD

DECLARE @STRSQL VARCHAR(MAX)

CREATE TABLE #TBL_CMMARGINNEW_UDIFF_EOD
	(
	Sgmt	VARCHAR(2),
	Src		VARCHAR(5),
	RptgDt	DATETIME,
	BizDt	DATETIME,
	TradRegnOrgn VARCHAR(1),
	Lvl		VARCHAR(1),
	ClrMmbId VARCHAR(20),
	BrkrOrCtdnPtcptId VARCHAR(20),
	ClntTp VARCHAR(1),
	ClntId VARCHAR(20),
	ISIN VARCHAR(20),
	TckrSymb VARCHAR(30),
	SttlmTp VARCHAR(20),
	SctiesSttlmTxId VARCHAR(20),
	SctySrs VARCHAR(20),
	FinInstrmId VARCHAR(20),
	FinInstrmTp VARCHAR(20),
	XpryDt DATETIME,
	StrkPric VARCHAR(20),
	OptnTp VARCHAR(20),
	ValAtRskMrgn VARCHAR(20),
	SPANMrgn VARCHAR(20),
	LossMrgn VARCHAR(20),
	PrmAmt VARCHAR(20),
	CnsltdCrstllsdOblgtnMrg VARCHAR(20),
	DlvrySttlmtMrgn VARCHAR(20),
	SpclMrgn VARCHAR(20),
	SpclCshMrgn VARCHAR(20),
	TndrMrgn VARCHAR(20),
	AddtlMrgn VARCHAR(20),
	MrkToMktNetd VARCHAR(20),
	MinMrgn VARCHAR(20),
	SPANMrgnMin VARCHAR(20),
	XtrmLossMrgnMin VARCHAR(20),
	AggtPeakLbltyRptd VARCHAR(20),
	EndOfDayRqrmntRptd VARCHAR(20),
	TtlMrgnAsPerActlParams VARCHAR(20),
	TtlBuyTradgVol VARCHAR(20),
	TtlBuyTrfVal VARCHAR(20),
	TtlSellTradgVol VARCHAR(20),
	TtlSellTrfVal VARCHAR(20),
	NetOpnQty VARCHAR(20),
	NetOpnVal VARCHAR(20),
	CncntrtnMrgn VARCHAR(20),
	DvlmntMrgn VARCHAR(20),
	CrossMrgnBnftForSPAN VARCHAR(20),
	CrossMrgnBnftForELM VARCHAR(20),
	Rmks	VARCHAR(20),
	Rsvd1	VARCHAR(20),
	Rsvd2	VARCHAR(20),
	Rsvd3	VARCHAR(20),
	Rsvd4	VARCHAR(20)
	)

IF @PROCID <> ''
BEGIN
	INSERT INTO #TBL_CMMARGINNEW_UDIFF_EOD
	SELECT 
		Sgmt	= DBO.PIECE(FILE_DATA,',',1),
		Src		= DBO.PIECE(FILE_DATA,',',2),
		MARGINDATE	= DBO.PIECE(FILE_DATA,',',3),
		BizDt	= DBO.PIECE(FILE_DATA,',',4),
		TradRegnOrgn = DBO.PIECE(FILE_DATA,',',5),
		Lvl		= DBO.PIECE(FILE_DATA,',',6),
		ClrMmbId = DBO.PIECE(FILE_DATA,',',7),
		BrkrOrCtdnPtcptId = DBO.PIECE(FILE_DATA,',',8),
		ClntTp = DBO.PIECE(FILE_DATA,',',9),
		PARTY_CODE = DBO.PIECE(FILE_DATA,',',10),
		ISIN = DBO.PIECE(FILE_DATA,',',11),
		TckrSymb = DBO.PIECE(FILE_DATA,',',12),
		SttlmTp = DBO.PIECE(FILE_DATA,',',13),
		SctiesSttlmTxId = DBO.PIECE(FILE_DATA,',',14),
		SctySrs = DBO.PIECE(FILE_DATA,',',15),
		FinInstrmId = DBO.PIECE(FILE_DATA,',',16),
		FinInstrmTp = DBO.PIECE(FILE_DATA,',',17),
		XpryDt = DBO.PIECE(FILE_DATA,',',18),
		StrkPric = DBO.PIECE(FILE_DATA,',',19),
		OptnTp = DBO.PIECE(FILE_DATA,',',20),
		ValAtRskMrgn = DBO.PIECE(FILE_DATA,',',21),
		SPANMrgn = DBO.PIECE(FILE_DATA,',',22),
		LossMrgn = DBO.PIECE(FILE_DATA,',',23),
		PrmAmt = DBO.PIECE(FILE_DATA,',',24),
		CnsltdCrstllsdOblgtnMrg = DBO.PIECE(FILE_DATA,',',25),
		DlvrySttlmtMrgn = DBO.PIECE(FILE_DATA,',',26),
		SpclMrgn = DBO.PIECE(FILE_DATA,',',27),
		SpclCshMrgn = DBO.PIECE(FILE_DATA,',',28),
		TndrMrgn = DBO.PIECE(FILE_DATA,',',29),
		AddtlMrgn = DBO.PIECE(FILE_DATA,',',30),
		MrkToMktNetd = DBO.PIECE(FILE_DATA,',',31),
		MinMrgn = DBO.PIECE(FILE_DATA,',',32),
		SPANMrgnMin = DBO.PIECE(FILE_DATA,',',33),
		XtrmLossMrgnMin = DBO.PIECE(FILE_DATA,',',34),
		AggtPeakLbltyRptd = DBO.PIECE(FILE_DATA,',',35),
		EndOfDayRqrmntRptd = DBO.PIECE(FILE_DATA,',',36),
		TtlMrgnAsPerActlParams = DBO.PIECE(FILE_DATA,',',37),
		TtlBuyTradgVol = DBO.PIECE(FILE_DATA,',',38),
		TtlBuyTrfVal = DBO.PIECE(FILE_DATA,',',39),
		TtlSellTradgVol = DBO.PIECE(FILE_DATA,',',40),
		TtlSellTrfVal = DBO.PIECE(FILE_DATA,',',41),
		NetOpnQty = DBO.PIECE(FILE_DATA,',',42),
		NetOpnVal = DBO.PIECE(FILE_DATA,',',43),
		CncntrtnMrgn = DBO.PIECE(FILE_DATA,',',44),
		DvlmntMrgn = DBO.PIECE(FILE_DATA,',',45),
		CrossMrgnBnftForSPAN = DBO.PIECE(FILE_DATA,',',46),
		CrossMrgnBnftForELM = DBO.PIECE(FILE_DATA,',',47),
		Rmks	= DBO.PIECE(FILE_DATA,',',48),
		Rsvd1	= DBO.PIECE(FILE_DATA,',',49),
		Rsvd2	= DBO.PIECE(FILE_DATA,',',50),
		Rsvd3	= DBO.PIECE(FILE_DATA,',',51),
		Rsvd4	= DBO.PIECE(FILE_DATA,',',52)
	FROM 
		CLASSFILEUPD 
	WHERE 
		SESSION_ID = @PROCID
		AND DBO.PIECE(FILE_DATA,',',1) <> 'Sgmt'
	
	DELETE FROM CLASSFILEUPD WHERE SESSION_ID = @PROCID
END
ELSE
BEGIN
	--CREATE TABLE #TBL_FOMARGINNEW_IMP_UDIFF
	--	(
	--	FILE_DATA	VARCHAR(MAX)
	--	)
	
	--SET @STRSQL = 'BULK INSERT #TBL_FOMARGINNEW_IMP_UDIFF FROM ''' + @FILENAME  + '''  WITH ( FIELDTERMINATOR = '','', ROWTERMINATOR = ''\N'' )'        
	SET @STRSQL = 'BULK INSERT #TBL_CMMARGINNEW_UDIFF_EOD FROM ''' + @FILENAME + '''  WITH ( FIELDTERMINATOR = '','', FIRSTROW = 2, ROWTERMINATOR = ''\n'' )'
	PRINT @STRSQL
	EXEC(@STRSQL) 
END

DELETE FROM TBL_CMMARGINNEW_UDIFF_EOD WHERE MARGINDATE >= @TRADEDATE AND MARGINDATE <= @TRADEDATE + ' 23:59'

INSERT	INTO TBL_CMMARGINNEW_UDIFF_EOD
SELECT	*
FROM 	#TBL_CMMARGINNEW_UDIFF_EOD 
WHERE	Sgmt <> 'Sgmt'
 
DROP TABLE #TBL_CMMARGINNEW_UDIFF_EOD
  
DELETE FROM TBL_CMMARGIN 
WHERE MARGINDATE BETWEEN @TRADEDATE AND @TRADEDATE + ' 23:59'
 

IF RIGHT(REPLACE(@FILENAME,'|',''),10) = 'P_0000.CSV' 
	BEGIN
			INSERT INTO TBL_CMMARGIN 
			SELECT	MARGINDATE,
					PARTY_CODE,
					VARMARGIN = ISNULL(ValAtRskMrgn,0) + ISNULL(LossMrgn,0),
					EXTREME_LOSS_MARGIN = ISNULL(MinMrgn,0),
					ADDITIONAL_MARGIN = ISNULL(AddtlMrgn,0),
					MTOM_LOSS = ISNULL(MrkToMktNetd,0),
					TOTAL_MARGIN = ISNULL(MinMrgn,0) + ISNULL(AddtlMrgn,0) + ISNULL(MrkToMktNetd,0) ,
					CL_FLAG = 'C', 
					UPLOAD_ON = GETDATE(),
					UPLOAD_BY = 'SYSTEM',
					TOTAL_MARGIN_VAR =  ISNULL(TtlMrgnAsPerActlParams,0),
					PEAKMARGIN = ISNULL(AggtPeakLbltyRptd,0)
			FROM	TBL_CMMARGINNEW_UDIFF_EOD
			WHERE	MARGINDATE >= @TRADEDATE AND MARGINDATE <= @TRADEDATE + ' 23:59'
			AND LVL = 'U'
			AND ABS(ISNULL(ValAtRskMrgn,0) + ISNULL(LossMrgn,0)) + ABS(ISNULL(MinMrgn,0)) + ABS(ISNULL(AddtlMrgn,0)) 
				+ ABS(ISNULL(MrkToMktNetd,0)) + ABS(isnull(EndOfDayRqrmntRptd,0)) + ABS(isnull(AggtPeakLbltyRptd,0)) <> 0
	END
ELSE
BEGIN
			INSERT INTO TBL_CMMARGIN 
			SELECT	MARGINDATE,
					PARTY_CODE,
					VARMARGIN = ValAtRskMrgn + LossMrgn,
					EXTREME_LOSS_MARGIN = MinMrgn,
					ADDITIONAL_MARGIN = AddtlMrgn,
					MTOM_LOSS = MrkToMktNetd,
					TOTAL_MARGIN = EndOfDayRqrmntRptd,
					CL_FLAG = 'C', 
					UPLOAD_ON = GETDATE(),
					UPLOAD_BY = 'SYSTEM',
					TOTAL_MARGIN_VAR =  TtlMrgnAsPerActlParams,
					PEAKMARGIN = AggtPeakLbltyRptd 
			FROM	TBL_CMMARGINNEW_UDIFF_EOD
			WHERE	MARGINDATE >= @TRADEDATE AND MARGINDATE <= @TRADEDATE + ' 23:59'
					AND LVL = 'P'
					AND ABS(ValAtRskMrgn + LossMrgn) + ABS(MinMrgn) + ABS(AddtlMrgn) + ABS(MrkToMktNetd) + ABS(EndOfDayRqrmntRptd) + ABS(AggtPeakLbltyRptd) <> 0
END 

DELETE FROM TBL_MG02 
WHERE MARGIN_DATE BETWEEN @TRADEDATE AND @TRADEDATE + ' 23:59' 

SELECT * INTO #TBL_MG02 FROM TBL_MG02 WHERE 1 = 2

INSERT INTO #TBL_MG02 
SELECT MARGINDATE,
	   REC_TYPE = '10',
	   PARTY_CODE,
	   SCRIP_CD = TckrSymb,
	   Series = SctySrs,
	   Sett_Type = CASE WHEN SttlmTp = 'NOR1' THEN 'M' 
				        WHEN SttlmTp = 'TFT1' THEN 'Z' ELSE '' END,
	   SETT_NO = SctiesSttlmTxId,
	   BUYQTY = TtlBuyTradgVol,
	   BUYAMT = TtlBuyTrfVal,
	   SELLQTY = TtlSellTradgVol,
	   SELLAMT = TtlSellTrfVal,
	   NETQTY = NetOpnQty,
	   NETAMT = NetOpnVal,
	   CL_RATE = 0.00,
	   MTOM = MrkToMktNetd,
	   VARAMT = ValAtRskMrgn + LossMrgn,
	   MINIMUM_MARGIN = MinMrgn,
	   ADNL_MRG = AddtlMrgn 
FROM	TBL_CMMARGINNEW_UDIFF_EOD
WHERE	MARGINDATE >= @TRADEDATE AND MARGINDATE <= @TRADEDATE + ' 23:59'
		AND LVL = 'U'

UPDATE M SET M.CL_RATE = C.CL_RATE
FROM #TBL_MG02 M INNER JOIN CLOSING C
ON M.MARGIN_DATE = C.SYSDATE
AND M.SCRIP_CD = C.SCRIP_CD
AND M.SERIES = C.SERIES
WHERE M.CL_RATE = 0

INSERT INTO TBL_MG02
SELECT * FROM #TBL_MG02

--EXEC V2_PROCESS_STATUS_LOG_UPD @TRADEDATE,'AMRGIMP','','AUTO_PROCESS',''

/*------------------------------------- END OF THE PROC ------------------------*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_PENDING_OBL_BSEDB_DUST
-- --------------------------------------------------
  
  
  
CREATE PROC [dbo].[PROC_PENDING_OBL_BSEDB_DUST]  
(  
 @TRANSDATE VARCHAR(11)  
)  
AS  
  
-- EXEC PROC_PENDING_OBL @TRANSDATE = 'FEB 18 2021'  
DECLARE @S_SETT_NO VARCHAR(7),  
  @S_SETT_TYPE VARCHAR(2),  
  @SETTCUR CURSOR  
     
DELETE FROM Dustbin.DBO.TBL_PENDING_OBL_BSEDB_DUST  
--WHERE TRANSDATE = @TRANSDATE  
  
SELECT SETT_NO,SETT_TYPE,REFNO,TCODE,TRTYPE,PARTY_CODE,SCRIP_CD,SERIES,QTY,FROMNO,TONO,CERTNO,FOLIONO,            
HOLDERNAME,REASON,DRCR,DELIVERED,ORGQTY,DPTYPE,DPID,CLTDPID,BRANCHCD,PARTIPANTCODE,SLIPNO,BATCHNO,            
ISETT_NO,ISETT_TYPE,SHARETYPE,TRANSDATE,FILLER1,FILLER2,FILLER3,BDPTYPE,BDPID,BCLTDPID,FILLER4,FILLER5            
INTO #DELTRANS_DATA             
FROM [ANGELDEMAT].BSEDB.dbo.DELTRANS            
WHERE 1 = 2             
   
SELECT SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE,              
BUYQTY=QTY,              
SELLQTY=QTY              
INTO #DELCLT             
FROM [ANGELDEMAT].BSEDB.dbo.DELIVERYCLT            
WHERE 1 = 2         
            
SELECT * INTO #SETT_MST FROM [ANGELDEMAT].BSEDB.dbo.SETT_MST    
WHERE SEC_PAYIN > @TRANSDATE AND START_DATE <= @TRANSDATE + ' 23:59'  
AND SETT_TYPE IN ('D','C','FD')  
  
SET @SETTCUR = CURSOR FOR            
SELECT SETT_NO,SETT_TYPE FROM #SETT_MST            
ORDER BY SETT_NO    
OPEN @SETTCUR            
FETCH NEXT FROM @SETTCUR INTO @S_SETT_NO, @S_SETT_TYPE            
WHILE @@FETCH_STATUS = 0             
BEGIN            
 INSERT INTO #DELTRANS_DATA             
 SELECT SETT_NO,SETT_TYPE,REFNO,TCODE,TRTYPE,PARTY_CODE,SCRIP_CD,SERIES,QTY,FROMNO,TONO,CERTNO,FOLIONO,            
 HOLDERNAME,REASON,DRCR,DELIVERED,ORGQTY,DPTYPE,DPID,CLTDPID,BRANCHCD,PARTIPANTCODE,SLIPNO,BATCHNO,            
 ISETT_NO,ISETT_TYPE,SHARETYPE,TRANSDATE,FILLER1,FILLER2,FILLER3,BDPTYPE,BDPID,BCLTDPID,FILLER4,FILLER5             
 FROM [ANGELDEMAT].BSEDB.dbo.DELTRANS WITH(INDEX(DELHOLD), NOLOCK)            
 WHERE SETT_NO = @S_SETT_NO            
 AND SETT_TYPE = @S_SETT_TYPE            
 AND FILLER2 = 1             
 AND TRTYPE <> 906             
 AND PARTY_CODE <> 'BROKER'           
 AND TRANSDATE <= @TRANSDATE  
  
 /*  
 INSERT INTO #DELTRANS_DATA             
 SELECT SETT_NO,SETT_TYPE,REFNO,TCODE,TRTYPE,PARTY_CODE,SCRIP_CD,SERIES,QTY,FROMNO,TONO,CERTNO,FOLIONO,            
 HOLDERNAME,REASON,DRCR,DELIVERED,ORGQTY,DPTYPE,DPID,CLTDPID,BRANCHCD,PARTIPANTCODE,SLIPNO,BATCHNO,            
 ISETT_NO,ISETT_TYPE,SHARETYPE,TRANSDATE,FILLER1,FILLER2,FILLER3,BDPTYPE,BDPID,BCLTDPID,FILLER4,FILLER5             
 FROM DELTRANS_REPORT WITH(INDEX(DELHOLD), NOLOCK)            
 WHERE SETT_NO = @S_SETT_NO            
 AND SETT_TYPE = @S_SETT_TYPE            
 AND FILLER2 = 1             
 AND TRTYPE <> 906             
 AND PARTY_CODE <> 'BROKER'           
 AND TRANSDATE <= @TRANSDATE  
 */  
    
INSERT INTO #DELCLT  
SELECT SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE,              
BUYQTY=SUM(CASE WHEN INOUT = 'O' THEN QTY ELSE 0 END),              
SELLQTY=SUM(CASE WHEN INOUT = 'I' THEN QTY ELSE 0 END)  
FROM [ANGELDEMAT].BSEDB.dbo.DELIVERYCLT            
WHERE SETT_NO = @S_SETT_NO            
AND SETT_TYPE = @S_SETT_TYPE     
GROUP BY SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE            
  
UNION  
--INSERT INTO #DELCLT  
SELECT SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE,              
BUYQTY=SUM(CASE WHEN INOUT = 'O' THEN QTY ELSE 0 END),              
SELLQTY=SUM(CASE WHEN INOUT = 'I' THEN QTY ELSE 0 END)  
FROM [ANGELDEMAT].BSEDB.dbo.DELIVERYCLT_REPORT            
WHERE SETT_NO = @S_SETT_NO            
AND SETT_TYPE = @S_SETT_TYPE     
GROUP BY SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE     
                          
SELECT D.SETT_NO,D.SETT_TYPE,D.PARTY_CODE, D.SCRIP_CD,D.SERIES,              
BUYTRADEQTY = BUYQTY, BUYRECQTY=SUM(CASE WHEN DRCR = 'D' THEN ISNULL(DE.QTY,0) ELSE 0 END) ,              
SELLTRADEQTY = SELLQTY , SELLRECQTY=SUM(CASE WHEN DRCR = 'C' THEN ISNULL(DE.QTY,0) ELSE 0 END),          
FLAG = 0 , ISIN=CONVERT(VARCHAR(12),'')                      
INTO #DELAUCNEW FROM            
#DELCLT D LEFT OUTER JOIN #DELTRANS_DATA DE               
ON ( DE.SETT_NO = D.SETT_NO AND DE.SETT_TYPE = D.SETT_TYPE AND DE.SCRIP_CD = D.SCRIP_CD              
AND DE.SERIES = D.SERIES AND DE.PARTY_CODE = D.PARTY_CODE AND FILLER2 = 1 AND SHARETYPE <> (CASE WHEN D.SETT_TYPE NOT LIKE 'A%' THEN 'AUCTION' ELSE '' END) )              
WHERE  D.SETT_NO >= @S_SETT_NO AND D.SETT_NO <= @S_SETT_NO                
AND D.SETT_TYPE = @S_SETT_TYPE              
GROUP BY D.SETT_NO,D.SETT_TYPE,D.PARTY_CODE,D.SCRIP_CD,D.SERIES,BUYQTY,SELLQTY          
HAVING ( BUYQTY <> SUM(CASE WHEN DRCR = 'D' THEN ISNULL(DE.QTY,0) ELSE 0 END)               
    OR SELLQTY <> SUM(CASE WHEN DRCR = 'C' THEN ISNULL(DE.QTY,0) ELSE 0 END) )              
              
INSERT INTO #DELAUCNEW              
SELECT D.SETT_NO,D.SETT_TYPE,D.PARTY_CODE,D.SCRIP_CD,D.SERIES,              
BUYTRADEQTY = 0, BUYRECQTY=SUM(CASE WHEN DRCR = 'D' THEN ISNULL(D.QTY,0) ELSE 0 END) ,              
SELLTRADEQTY = 0, SELLRECQTY=SUM(CASE WHEN DRCR = 'C' THEN ISNULL(D.QTY,0) ELSE 0 END),          
FLAG = 0 , ISIN=CONVERT(VARCHAR(12),'')                      
FROM #DELTRANS_DATA D               
WHERE  D.SETT_NO >= @S_SETT_NO AND D.SETT_NO <= @S_SETT_NO                
AND D.SETT_TYPE = @S_SETT_TYPE      
AND FILLER2 = 1 AND SHARETYPE <> (CASE WHEN D.SETT_TYPE NOT LIKE 'A%' THEN 'AUCTION' ELSE '' END)            
AND D.PARTY_CODE NOT IN ( SELECT PARTY_CODE FROM #DELCLT DE              
     WHERE DE.SETT_NO = D.SETT_NO AND DE.SETT_TYPE = D.SETT_TYPE AND DE.SCRIP_CD = D.SCRIP_CD              
     AND DE.SERIES = D.SERIES AND DE.PARTY_CODE = D.PARTY_CODE  )              
GROUP BY D.SETT_NO,D.SETT_TYPE,D.PARTY_CODE,D.SCRIP_CD,D.SERIES          
HAVING SUM(CASE WHEN DRCR = 'D' THEN ISNULL(D.QTY,0) ELSE 0 END) <> SUM(CASE WHEN DRCR = 'C' THEN ISNULL(D.QTY,0) ELSE 0 END)              
  
IF @S_SETT_TYPE <> 'C'               
BEGIN               
              
 SELECT SETT_NO,SETT_TYPE,PARTY_CODE,SCRIP_CD,SERIES,BUYTRADEQTY,BUYRECQTY,SELLTRADEQTY,SELLRECQTY,              
 BUYSHORTAGE=(CASE WHEN ( BUYTRADEQTY - SELLTRADEQTY - BUYRECQTY + SELLRECQTY ) > 0               
            THEN ( BUYTRADEQTY - SELLTRADEQTY - BUYRECQTY + SELLRECQTY )              
     ELSE 0 END ) ,              
 SELLSHORTAGE=(CASE WHEN ( BUYTRADEQTY - SELLTRADEQTY - BUYRECQTY + SELLRECQTY ) < 0               
            THEN ABS( BUYTRADEQTY - SELLTRADEQTY - BUYRECQTY + SELLRECQTY )              
     ELSE 0 END ), CL_RATE = CONVERT(NUMERIC(18,4),0),          
FLAG = 0 , ISIN=CONVERT(VARCHAR(12),'')                          
 INTO #DELAUCSHORT FROM #DELAUCNEW              
 WHERE ( BUYTRADEQTY - SELLTRADEQTY - BUYRECQTY + SELLRECQTY ) <> 0               
    
  UPDATE #DELAUCSHORT SET ISIN=MULTIISIN.ISIN FROM MULTIISIN                    
  WHERE MULTIISIN.SCRIP_CD = #DELAUCSHORT.SCRIP_CD AND MULTIISIN.SERIES = #DELAUCSHORT.SERIES          
   AND VALID = 1           
  INSERT  INTO Dustbin.DBO.TBL_PENDING_OBL_BSEDB_DUST
 SELECT *,TRANSDATE=@TRANSDATE FROM #DELAUCSHORT              
 --WHERE SELLSHORTAGE > 0         
 ORDER BY SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE              
 DROP TABLE #DELAUCSHORT  
 END  
ELSE  
BEGIN  
SELECT SETT_NO,SETT_TYPE,PARTY_CODE,SCRIP_CD,SERIES,BUYTRADEQTY,BUYRECQTY,SELLTRADEQTY,SELLRECQTY,              
 BUYSHORTAGE=(CASE WHEN ( BUYTRADEQTY > BUYRECQTY )              
            THEN BUYTRADEQTY - BUYRECQTY               
   ELSE               
      CASE WHEN ( BUYTRADEQTY < BUYRECQTY )              
      THEN (CASE WHEN ( SELLTRADEQTY < SELLRECQTY AND (BUYRECQTY - BUYTRADEQTY - SELLRECQTY + SELLTRADEQTY) < 0 )                   
        THEN ABS(BUYRECQTY - BUYTRADEQTY - SELLRECQTY + SELLTRADEQTY)              
             ELSE 0               
          END )                
           ELSE (CASE WHEN SELLTRADEQTY < SELLRECQTY               
      THEN SELLRECQTY - SELLTRADEQTY                 
      ELSE 0 END ) END              
     END ),              
 SELLSHORTAGE=(CASE WHEN ( SELLTRADEQTY > SELLRECQTY )              
            THEN SELLTRADEQTY - SELLRECQTY               
 ELSE               
      CASE WHEN ( SELLTRADEQTY < SELLRECQTY )              
      THEN (CASE WHEN ( BUYTRADEQTY < BUYRECQTY AND (SELLRECQTY - SELLTRADEQTY - BUYRECQTY + BUYTRADEQTY ) < 0 )                   
        THEN ABS(SELLRECQTY - SELLTRADEQTY - BUYRECQTY + BUYTRADEQTY )              
     ELSE 0               
          END )                
           ELSE (CASE WHEN BUYTRADEQTY < BUYRECQTY               
      THEN BUYRECQTY - BUYTRADEQTY                 
      ELSE 0 END ) END              
     END ), CL_RATE = CONVERT(NUMERIC(18,4),0),          
 FLAG = 0 , ISIN=CONVERT(VARCHAR(12),'')                          
 INTO #DELAUCSHORT1 FROM #DELAUCNEW              
 WHERE ( (CASE WHEN ( SELLTRADEQTY > SELLRECQTY )              
            THEN SELLTRADEQTY - SELLRECQTY               
     ELSE               
      CASE WHEN ( SELLTRADEQTY < SELLRECQTY )              
      THEN (CASE WHEN ( BUYTRADEQTY < BUYRECQTY AND (SELLRECQTY - SELLTRADEQTY - BUYRECQTY + BUYTRADEQTY ) < 0 )                   
        THEN ABS(SELLRECQTY - SELLTRADEQTY - BUYRECQTY + BUYTRADEQTY )              
             ELSE 0               
          END )                
           ELSE (CASE WHEN BUYTRADEQTY < BUYRECQTY               
      THEN BUYRECQTY - BUYTRADEQTY                 
      ELSE 0 END ) END              
     END )  <> 0               
   OR                
  (CASE WHEN ( BUYTRADEQTY > BUYRECQTY )              
            THEN BUYTRADEQTY - BUYRECQTY               
     ELSE               
      CASE WHEN ( BUYTRADEQTY < BUYRECQTY )              
      THEN (CASE WHEN ( SELLTRADEQTY < SELLRECQTY AND (BUYRECQTY - BUYTRADEQTY - SELLRECQTY + SELLTRADEQTY) < 0 )                   
        THEN ABS(BUYRECQTY - BUYTRADEQTY - SELLRECQTY + SELLTRADEQTY)              
             ELSE 0               
          END )                
           ELSE (CASE WHEN SELLTRADEQTY < SELLRECQTY               
      THEN SELLRECQTY - SELLTRADEQTY                 
      ELSE 0 END ) END              
     END ) <> 0 )   
    
                      
  UPDATE #DELAUCSHORT1 SET ISIN=MULTIISIN.ISIN FROM [ANGELDEMAT].BSEDB.dbo.MULTIISIN                    
  WHERE MULTIISIN.SCRIP_CD = #DELAUCSHORT1.SCRIP_CD AND MULTIISIN.SERIES = #DELAUCSHORT1.SERIES          
   AND VALID = 1           
       
  INSERT  INTO Dustbin.DBO.TBL_PENDING_OBL_BSEDB_DUST         
  SELECT *,TRANSDATE=@TRANSDATE FROM #DELAUCSHORT1               
  --WHERE SELLSHORTAGE > 0           
  ORDER BY SETT_NO,SETT_TYPE,SCRIP_CD,SERIES,PARTY_CODE   
  DROP TABLE #DELAUCSHORT1   
END               
 DROP TABLE #DELAUCNEW                
 FETCH NEXT FROM @SETTCUR INTO @S_SETT_NO, @S_SETT_TYPE             
END            
CLOSE @SETTCUR            
DEALLOCATE @SETTCUR            
  
DROP TABLE #DELCLT  
DROP TABLE #DELTRANS_DATA  
DROP TABLE #SETT_MST

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PROC_RTB_TRADE_UPDATE_EOD
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_RTB_TRADE_UPDATE_EOD] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))              
              
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'    

BEGIN
SET @RUNDATE= CONVERT(varchar, getdate(), 23)

Update MSAJAG..V2_Business_Process set import_Trade='1',  Billing='1', Vbb='1', stt='1' where Business_Date=@RUNDATE and Sett_type in ('M', 'N', 'W', 'Z')

select JOB_STATUS='TRADE,BILLING,VBB,STT PROCESSES FLAG ARE SUCCESSFULLY UPDATED' 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Proc_Sett_Mst_Up_UDIFF
-- --------------------------------------------------

CREATE Proc [dbo].[Proc_Sett_Mst_Up_UDIFF](
	@FilePath Varchar(200), 
	@UpFlag Varchar(1), 
	@ROWTERMINATOR VARCHAR(10)='\n',
	@PROCID VARCHAR(50)='')    
AS
 	DECLARE @STRSQL VARCHAR(500)            
          
	SELECT SETT_TYPE,SETT_NO,START_DATE,END_DATE,FUNDS_PAYIN,FUNDS_PAYOUT,          
	SEC_PAYIN,SEC_PAYOUT,RECDATE=GETDATE(),FLAG1=CONVERT(VARCHAR(2),''), FLAG2='YY'          
	INTO #SETT_MST_BULK          
	FROM SETT_MST WHERE 1 = 2  

	ALTER TABLE #SETT_MST_BULK
	ALTER COLUMN SETT_TYPE VARCHAR(10)

	CREATE TABLE #SETT_MST_BULK_NEW
	(
		SGMT	VARCHAR (5),
		SRC	VARCHAR (10),
		TRADREGNORGN	VARCHAR(2),
		NSDLMKTTPANDID	VARCHAR(2),
		CSDLMKTTPANDID	VARCHAR(2),
		STTLMTP	VARCHAR(10),
		SCTIESSTTLMTXID	VARCHAR (10), 
		SPCLSCTIESSTTLMTXID VARCHAR (10),  
		ORGNLTRADDTTM VARCHAR(50),
		TRADENDDTTM VARCHAR(50),
		CTDNCONFDTTM VARCHAR(50),
		OBLGTNDTTM VARCHAR(50),
		FNDSPAYINDTANDTM VARCHAR(50),
		FNDSPAYOUTDTANDTM VARCHAR(50),
		SCTIESPAYINDTANDTM VARCHAR(50),
		SCTIESPAYOUTDTANDTM VARCHAR(50),
		AUCTNSTTLMTTP	VARCHAR(10),
		AUCTNSTTLMTNB	VARCHAR (10),
		RMKS	VARCHAR (150),
		RSVD1	VARCHAR (50),
		RSVD2	VARCHAR (50),
		RSVD3	VARCHAR (50),
		RSVD4	VARCHAR (50)
	)

	IF @PROCID <> ''
	BEGIN
		INSERT INTO #SETT_MST_BULK_NEW
		SELECT 
			DBO.PIECE(FILE_DATA,',',1),
			DBO.PIECE(FILE_DATA,',',2),
			DBO.PIECE(FILE_DATA,',',3),
			DBO.PIECE(FILE_DATA,',',4),
			DBO.PIECE(FILE_DATA,',',5),
			DBO.PIECE(FILE_DATA,',',6),
			DBO.PIECE(FILE_DATA,',',7),
			DBO.PIECE(FILE_DATA,',',8),
			DBO.PIECE(FILE_DATA,',',9),
			DBO.PIECE(FILE_DATA,',',10),
			DBO.PIECE(FILE_DATA,',',11),
			DBO.PIECE(FILE_DATA,',',12),
			DBO.PIECE(FILE_DATA,',',13),
			DBO.PIECE(FILE_DATA,',',14),
			DBO.PIECE(FILE_DATA,',',15),
			DBO.PIECE(FILE_DATA,',',16),
			DBO.PIECE(FILE_DATA,',',17),
			DBO.PIECE(FILE_DATA,',',18),
			DBO.PIECE(FILE_DATA,',',19),
			DBO.PIECE(FILE_DATA,',',20),
			DBO.PIECE(FILE_DATA,',',21),
			DBO.PIECE(FILE_DATA,',',22),
			DBO.PIECE(FILE_DATA,',',23)
		 FROM 
			CLASSFILEUPD
		 WHERE 
			SESSION_ID = @PROCID
			AND DBO.PIECE(FILE_DATA,',',1) NOT LIKE 'Sgmt%'

			DELETE FROM CLASSFILEUPD WHERE SESSION_ID = @PROCID
 
	END
	ELSE
	BEGIN
		IF @ROWTERMINATOR = '\n'       
		 SET @STRSQL = 'Bulk insert #SETT_MST_BULK_NEW from ''' + @FilePath  + '''  with ( FIELDTERMINATOR = '','', ROWTERMINATOR = ''0x0a'', FirstRow = 2 )'            
		ELSE      
		 SET @STRSQL = 'Bulk insert #SETT_MST_BULK_NEW from ''' + @FilePath  + '''  with ( FIELDTERMINATOR = '','', ROWTERMINATOR = ''0x0a'', FirstRow = 2 )'            
		EXEC(@STRSQL)  
		PRINT @STRSQL
	END
 
		UPDATE A SET STTLMTP = PROCESS_VALUE
		FROM #SETT_MST_BULK_NEW A,TBL_STANDARD_VALUES B
		WHERE A.STTLMTP = B.FIELD_VALUE
		AND FIELD_DESC='SETTLEMENTTYPE'
		AND EXCHANGE='NSE'
		AND SEGMENT='CAPITAL'


		

		
		INSERT INTO #SETT_MST_BULK
		SELECT 
			SETT_TYPE		= STTLMTP,
			SETT_NO			= SCTIESSTTLMTXID,
			START_DATE		= ORGNLTRADDTTM,
			END_DATE		= CAST(CONVERT(DATETIMEOFFSET,TRADENDDTTM,127) AS DATETIME) ,
			FUNDS_PAYIN		= CAST(CONVERT(DATETIMEOFFSET,FNDSPAYINDTANDTM,127) AS DATETIME) ,
			FUNDS_PAYOUT	= CAST(CONVERT(DATETIMEOFFSET,FNDSPAYOUTDTANDTM,127) AS DATETIME) ,          
			SEC_PAYIN		= CAST(CONVERT(DATETIMEOFFSET,SCTIESPAYINDTANDTM,127) AS DATETIME) ,
			SEC_PAYOUT		= CAST(CONVERT(DATETIMEOFFSET,SCTIESPAYOUTDTANDTM,127) AS DATETIME) ,
			RECDATE			= GETDATE(),
			FLAG1			= CONVERT(VARCHAR(2),''), 
			FLAG2			= 'YY'
		FROM 
		#SETT_MST_BULK_NEW
		

	/*FOR CLASS PLUS FILE COUNT PURPOSE*/
	TRUNCATE TABLE TMP_SETTMST_NEW
	INSERT INTO TMP_SETTMST_NEW
	SELECT * FROM #SETT_MST_BULK
	/*END*/          

	UPDATE #SETT_MST_BULK SET           
	END_DATE = LEFT(END_DATE,11) + ' 23:59:59',          
	FUNDS_PAYOUT = LEFT(FUNDS_PAYOUT,11) + ' 23:59:59',          
	SEC_PAYOUT = LEFT(FUNDS_PAYOUT,11) + ' 23:59:59'          


	UPDATE #SETT_MST_BULK SET SETT_TYPE = 'BX'
	WHERE SETT_TYPE = 'X'

	SET @UPFLAG='U'
	
          
	IF @UPFLAG = 'U'           
	BEGIN

	--SELECT @UPFLAG
	
	/* DELETE FROM SETT_MST
	 WHERE EXISTS (SELECT #SETT_MST_BULK.SETT_NO,#SETT_MST_BULK.SETT_TYPE FROM #SETT_MST_BULK           
	 WHERE SETT_MST.SETT_NO = #SETT_MST_BULK.SETT_NO          
	 AND SETT_MST.SETT_TYPE = #SETT_MST_BULK.SETT_TYPE)  */        

	 DELETE FROM #SETT_MST_BULK           
	 WHERE EXISTS (SELECT SETT_NO,SETT_TYPE FROM SETT_MST           
	 WHERE SETT_MST.SETT_NO = #SETT_MST_BULK.SETT_NO          
	 AND SETT_MST.SETT_TYPE = #SETT_MST_BULK.SETT_TYPE)          
          
	 INSERT INTO SETT_MST          
	 SELECT EXCHANGE='NSE',SETT_TYPE,SETT_NO,START_DATE,END_DATE,FUNDS_PAYIN,FUNDS_PAYOUT,SEC_PAYIN,SEC_PAYOUT,          
	 SERIES='EQ',MARKETTYPE=1          
	 FROM #SETT_MST_BULK  
	 
	END          
          
	IF @UPFLAG = 'O'           
	BEGIN   
	
	     
	 INSERT INTO #SETT_MST_BULK          
	 SELECT SETT_TYPE,SETT_NO,START_DATE,END_DATE,FUNDS_PAYIN,FUNDS_PAYOUT,SEC_PAYIN,          
	 SEC_PAYOUT,RECDATE=GETDATE(),FLAG1=0, FLAG2='YY'         
	 FROM SETT_MST           
	 WHERE SETT_NO NOT IN (SELECT SETT_NO FROM #SETT_MST_BULK           
	 WHERE SETT_NO = SETT_MST.SETT_NO          
	 AND SETT_TYPE = SETT_MST.SETT_TYPE)          
          
	 TRUNCATE TABLE SETT_MST          
 
	 INSERT INTO SETT_MST          
	 SELECT EXCHANGE='NSE',SETT_TYPE,SETT_NO,START_DATE,END_DATE,FUNDS_PAYIN,FUNDS_PAYOUT,SEC_PAYIN,SEC_PAYOUT,          
	 SERIES='EQ',MARKETTYPE=1          
	 FROM #SETT_MST_BULK          
          
	END 

	DROP TABLE #SETT_MST_BULK_NEW
	DROP TABLE #Sett_Mst_Bulk

GO

-- --------------------------------------------------
-- PROCEDURE dbo.RPT_CLIENT_COLL_ALLOC_UAT
-- --------------------------------------------------

CREATE PROC [dbo].[RPT_CLIENT_COLL_ALLOC_UAT]  
(  
 @RUNDATE VARCHAR(11),  
  @FLAG  INT = 0  
)  
AS  
DECLARE @PREVDATE VARCHAR(11),  
  @FILENAME VARCHAR(50),  
  @BATCHNO INT,  
  @SNO INT,  
  @NOOFREC INT,  
  @FILEREC INT,  
  @MEMBERCODE VARCHAR(10),  
  @CMCUR  CURSOR,  
  @ORG_MEMBERCODE VARCHAR(10)  
  
-- EXEC RPT_CLIENT_COLL_ALLOC @RUNDATE = 'FEB 10 2022'  
  
SET @SNO=0  
SET @FILEREC = 10000000  
  
IF (SELECT ISNULL(COUNT(1),0) FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE WHERE PROCESS_DT = @RUNDATE  
AND ALLOCATECASH > 0 ) <= 0   
BEGIN  
 SELECT * FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE WHERE 1 = 2  
 RETURN  
END  
SELECT @MEMBERCODE = MEMBERCODE, @ORG_MEMBERCODE = MEMBERCODE  FROM MSAJAG..OWNER   
  
SELECT @PREVDATE = ISNULL(MAX(PROCESS_DT),'APR  1 2020') FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE   
WHERE PROCESS_DT < @RUNDATE  
  
SELECT PARTY_CODE, SEGMENT_INDICATOR, CP_CODE, ACCOUNT_TYPE,   
P_ALLOCATECASH=(CASE WHEN ALLOCATECASH > 0 THEN ALLOCATECASH ELSE CONVERT(NUMERIC(18,2),0) END),  
C_ALLOCATECASH=CONVERT(NUMERIC(18,2),0),EXCHANGE,SEGMENT   
INTO #DATA FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE  
WHERE PROCESS_DT = @PREVDATE  
AND ALLOCATECASH > 0  
AND 1 = 2   
  
SELECT EXCHANGE, SEGMENT, PARTY_CODE=CLI_CODE,CP_CODE,UPLOAD_ON=MAX(UPLOAD_ON) INTO #ALLOC_SEG FROM MSAJAG..TBL_CLIENT_COLL_FILE   
WHERE FILEDATE = @RUNDATE AND BATCH_STATUS IN ('G','D')    
GROUP BY EXCHANGE, SEGMENT, CLI_CODE,CP_CODE  
  
CREATE INDEX #PARTY ON #ALLOC_SEG(EXCHANGE,SEGMENT,PARTY_CODE)  
  
INSERT INTO #DATA   
SELECT PARTY_CODE, SEGMENT_INDICATOR, CP_CODE, ACCOUNT_TYPE,   
P_ALLOCATECASH=(CASE WHEN ALLOCATECASH > 0 THEN ALLOCATECASH ELSE 0 END),  
C_ALLOCATECASH=CONVERT(NUMERIC(18,2),0),EXCHANGE,SEGMENT   
FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE   
WHERE PROCESS_DT = @PREVDATE  
AND ALLOCATECASH > 0  
AND EXCHANGE NOT IN (SELECT EXCHANGE FROM #ALLOC_SEG   
WHERE #ALLOC_SEG.EXCHANGE = TBL_CLIENT_COLL_ALLOCATE.EXCHANGE  
AND #ALLOC_SEG.SEGMENT = TBL_CLIENT_COLL_ALLOCATE.SEGMENT  
AND #ALLOC_SEG.PARTY_CODE = TBL_CLIENT_COLL_ALLOCATE.PARTY_CODE   
AND #ALLOC_SEG.CP_CODE = TBL_CLIENT_COLL_ALLOCATE.CP_CODE)  
AND 1 = (CASE WHEN(EXCHANGE = 'MCX' AND SEGMENT ='FUTURES') THEN 0 ELSE 1 END)  
AND 1 = (CASE WHEN(EXCHANGE = 'NCX' AND SEGMENT ='FUTURES') THEN 0 ELSE 1 END)   
AND EXCHANGE NOT IN ('NSE','NSX','BSE','BSX','BCX')  
   
INSERT INTO #DATA   
SELECT PARTY_CODE=(CASE WHEN LEN(CLIENTCODE) > 10 THEN '' ELSE CLIENTCODE END), SEGMENT_INDICATOR='',   
CP_CODE=(CASE WHEN LEN(CLIENTCODE) > 10 THEN CLIENTCODE ELSE '' END),   
ACCOUNT_TYPE=(CASE WHEN CLIENTCODE = '' THEN 'P' ELSE 'C' END),   
P_ALLOCATECASH=AMOUNT,  
C_ALLOCATECASH=CONVERT(NUMERIC(18,2),0),EXCHANGE,SEGMENT   
FROM MSAJAG..TBL_CLIENT_COLL_RECO  
WHERE TRANSDATE = @RUNDATE     
AND EXCHANGE IN ('MCX','NCX','BSE','BSX','BCX')  
  
INSERT INTO #DATA   
SELECT PARTY_CODE=(CASE WHEN LEN(CLIENTCODE) > 10 THEN '' ELSE CLIENTCODE END), SEGMENT_INDICATOR='',   
CP_CODE=(CASE WHEN LEN(CLIENTCODE) > 10 THEN CLIENTCODE ELSE '' END),   
ACCOUNT_TYPE=(CASE WHEN CLIENTCODE = '' THEN 'P' ELSE 'C' END),   
P_ALLOCATECASH=AMOUNT,  
C_ALLOCATECASH=CONVERT(NUMERIC(18,2),0),EXCHANGE,SEGMENT   
FROM MSAJAG..TBL_CLIENT_COLL_RECO  
WHERE TRANSDATE = @PREVDATE     
AND EXCHANGE IN ('NSE','NSX')  
AND EXCHANGE NOT IN (SELECT EXCHANGE FROM #ALLOC_SEG   
WHERE #ALLOC_SEG.EXCHANGE = TBL_CLIENT_COLL_RECO.EXCHANGE  
AND #ALLOC_SEG.SEGMENT = TBL_CLIENT_COLL_RECO.SEGMENT  
AND #ALLOC_SEG.PARTY_CODE = (CASE WHEN LEN(TBL_CLIENT_COLL_RECO.CLIENTCODE) <= 10 THEN TBL_CLIENT_COLL_RECO.CLIENTCODE ELSE '' END)  
AND #ALLOC_SEG.CP_CODE = (CASE WHEN LEN(TBL_CLIENT_COLL_RECO.CLIENTCODE) > 10 THEN TBL_CLIENT_COLL_RECO.CLIENTCODE ELSE '' END))  
  
UPDATE #DATA SET SEGMENT_INDICATOR = SEG_TYPE  
FROM MSAJAG..TBL_CMCC_DETAIL T  
WHERE @RUNDATE BETWEEN FROM_DATE AND TO_DATE   
AND #DATA.EXCHANGE = T.EXCHANGE AND #DATA.SEGMENT = T.SEGMENT   
  
INSERT INTO #DATA   
SELECT PARTY_CODE=CLI_CODE, SEGMENT_INDICATOR, CP_CODE, ACCOUNT_TYPE,   
P_ALLOCATECASH=(CASE WHEN AMOUNT > 0 THEN AMOUNT ELSE 0 END),  
C_ALLOCATECASH=CONVERT(NUMERIC(18,2),0),EXCHANGE,SEGMENT   
FROM MSAJAG..TBL_CLIENT_COLL_FILE WITH(NOLOCK)  
WHERE FIlEDATE = @RUNDATE  AND BATCH_STATUS IN ('G','D')  
AND AMOUNT > 0   
AND EXISTS (SELECT EXCHANGE FROM #ALLOC_SEG WITH(NOLOCK)  
WHERE #ALLOC_SEG.EXCHANGE = TBL_CLIENT_COLL_FILE.EXCHANGE  
AND #ALLOC_SEG.SEGMENT = TBL_CLIENT_COLL_FILE.SEGMENT  
AND #ALLOC_SEG.PARTY_CODE = TBL_CLIENT_COLL_FILE.CLI_CODE   
AND #ALLOC_SEG.CP_CODE = TBL_CLIENT_COLL_FILE.CP_CODE   
AND #ALLOC_SEG.UPLOAD_ON = TBL_CLIENT_COLL_FILE.UPLOAD_ON)  
AND EXCHANGE NOT IN ('MCX','NCX','BSE','BSX','BCX')  
  
INSERT INTO #DATA   
SELECT PARTY_CODE, SEGMENT_INDICATOR, CP_CODE, ACCOUNT_TYPE,   
P_ALLOCATECASH=CONVERT(NUMERIC(18,2),0),  
C_ALLOCATECASH=(CASE WHEN ALLOCATECASH > 0 THEN ALLOCATECASH ELSE 0 END),EXCHANGE,SEGMENT   
FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE  
WHERE PROCESS_DT = @RUNDATE  
AND ALLOCATECASH > 0   
   
IF @FLAG = 0 OR @FLAG = 1   
BEGIN   
 SELECT FILENAME='WORKING_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
 DATA='PARTY_CODE,CLEARING_PAN,TRADING_PAN,CP_CODE,CP_PAN,CLIENT_PAN,ACCOUNT_TYPE,SEGMENT_INDICATOR,'+  
  'EXCHANGE,SEGMENT,CLIENTCOLL_ORG,CLIENTCOLLCASH,CLIENTCOLLNONCASH,REPLD_NONCASH,REPLD_NONCASHEQ,'+  
  'MARGIN,MARGIN_SHORT_EXCESS,PEAK_MARGIN,UPFRONT_MARGIN,ALLOCATECASH,ALLOCATENONCASH,'+  
  'BALANCECASH,BALANCENONCASH,PROCASH,CLIENTCASH,BALANCEPROFUNDSHORT,EPNAMOUNT,'+  
  'EXCESSCOLL,BLOCKFUND',FLAG=1  
  INTO #WORKINGDATA  
 UNION ALL  
 SELECT  FILENAME='WORKING_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
 LTRIM(RTRIM(CONVERT(VARCHAR,PARTY_CODE)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,CLEARING_PAN)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,TRADING_PAN)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,CP_CODE)))+','+  
 LTRIM(RTRIM(CONVERT(VARCHAR,CP_PAN)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,CLIENT_PAN)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,ACCOUNT_TYPE)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,SEGMENT_INDICATOR)))+','+  
 LTRIM(RTRIM(CONVERT(VARCHAR,EXCHANGE)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,SEGMENT)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,CLIENTCOLL_ORG)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,CLIENTCOLLCASH)))+','+  
 LTRIM(RTRIM(CONVERT(VARCHAR,CLIENTCOLLNONCASH)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,REPLD_NONCASH)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,REPLD_NONCASHEQ)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,MARGIN)))+','+  
 LTRIM(RTRIM(CONVERT(VARCHAR,MARGIN_SHORT_EXCESS)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,PEAK_MARGIN)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,UPFRONT_MARGIN)))+','+   
 LTRIM(RTRIM(CONVERT(VARCHAR,PROCASH+CC_CM_CASH)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,ALLOCATENONCASH)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,BALANCECASH)))+','+  
 LTRIM(RTRIM(CONVERT(VARCHAR,BALANCENONCASH)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,PROCASH)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,CC_CM_CASH)))+','+  
 LTRIM(RTRIM(CONVERT(VARCHAR,TOTALMARGIN)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,MARGINRATIO)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,EXCESSCOLL)))+','+LTRIM(RTRIM(CONVERT(VARCHAR,BLOCKFUND))),FLAG=2  
 FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE  
 WHERE PROCESS_DT= @RUNDATE    
   
 SELECT FILENAME,DATA FROM #WORKINGDATA  
 ORDER BY FLAG   
END  
  
SELECT [CURRENT DATE]=REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),106),' ','-'),  
    T.EXCHANGE, T.SEGMENT,   
    SEGMENT_INDICATOR,  
    [CM CODE]=CMCODE,  
    [TM CODE]=(CASE WHEN ACCOUNT_TYPE = 'P' THEN '' ELSE TMCODE END),  
    [CP CODE]=CP_CODE,  
    [CLI CODE]=PARTY_CODE,  
 [ACCOUNT TYPE]=ACCOUNT_TYPE,  
 AMOUNT=SUM(C_ALLOCATECASH),   
 FILLER1='',  
 FILLER2='',  
 FILLER3='',  
 FILLER4='',  
 FILLER5='',  
 FILLER6='',  
 ACTION=(CASE WHEN SUM(C_ALLOCATECASH)-SUM(P_ALLOCATECASH) > 0 THEN 'U' ELSE 'D' END)  
 INTO #FILEDATA_NSE  
FROM #DATA T, MSAJAG..TBL_CMCC_DETAIL C  
WHERE @RUNDATE BETWEEN FROM_DATE AND TO_DATE  
AND T.EXCHANGE = C.EXCHANGE AND T.SEGMENT=C.SEGMENT  
AND T.EXCHANGE IN ('NSE','NSX','NCE')  
GROUP BY CMCODE, TMCODE, T.EXCHANGE, T.SEGMENT, SEGMENT_INDICATOR, PARTY_CODE, CP_CODE, ACCOUNT_TYPE  
HAVING SUM(C_ALLOCATECASH) <> SUM(P_ALLOCATECASH)  
ORDER BY CMCODE, TMCODE, ACTION, PARTY_CODE, SEGMENT_INDICATOR  
  
SELECT * INTO #FILEDATA   
FROM #FILEDATA_NSE  
WHERE 1 = 2   
  
SELECT * INTO #FILEDATA_D  
FROM #FILEDATA_NSE  
WHERE 1 = 2   
  
ALTER TABLE #FILEDATA  
ADD SNO INT IDENTITY(1,1)  
  
ALTER TABLE #FILEDATA_D  
ADD SNO INT IDENTITY(1,1)  
  
INSERT INTO #FILEDATA  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_NSE  
WHERE ACTION='D'  
ORDER BY ACTION, EXCHANGE, SEGMENT, [CLI CODE]  
  
INSERT INTO #FILEDATA_D  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_NSE  
WHERE ACTION='U'  
ORDER BY ACTION, EXCHANGE, SEGMENT, [CLI CODE]  
  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
 SELECT FILENME='NSEFULLFILE_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
 [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE],   
 [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
 FROM #FILEDATA  
 UNION ALL  
 SELECT FILENME='NSEFULLFILE_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
 [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE],   
 [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
 FROM #FILEDATA_D  
 ORDER BY 7   
END  
  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
SET @NOOFREC = 0  
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA  
WHERE [CM CODE] = @ORG_MEMBERCODE  
AND ACTION = 'D'  
IF @NOOFREC > 0   
BEGIN  
 SET @CMCUR = CURSOR FOR  
 SELECT DISTINCT [CM CODE] FROM #FILEDATA  
 WHERE [CM CODE] = @ORG_MEMBERCODE  
 AND ACTION = 'D'  
 OPEN @CMCUR  
 FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 WHILE @@FETCH_STATUS = 0  
 BEGIN   
  SELECT @BATCHNO = 0      
  SET @SNO = 0    
      
  SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
  WHERE FLDFILENO = @MEMBERCODE      
  AND FLDFILEDATE = @RUNDATE    
   
  WHILE @SNO < @NOOFREC  
  BEGIN  
   SET @BATCHNO = @BATCHNO + 1   
   SET @FILENAME = @MEMBERCODE + '_ALLOC_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'.T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4)  
  
   SELECT FILENAME=@FILENAME,  
   [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE],   
   [TM CODE] = (CASE WHEN [ACCOUNT TYPE] = 'P' THEN '' ELSE [TM CODE] END), [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
   FROM #FILEDATA  
   WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
   AND [CM CODE] = @MEMBERCODE  
   AND ACTION = 'D'  
   ORDER BY SNO   
     
   INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE   
   SELECT FILENAME=@FILENAME,  
   [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
   @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
   FROM #FILEDATA  
   WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
   AND [CM CODE] = @MEMBERCODE  
   AND ACTION = 'D'  
   ORDER BY SNO       
     
   SET @SNO = @SNO + @FILEREC  
  END  
  
  INSERT INTO MSAJAG..ASIANFILEBATCHNO      
  SELECT @MEMBERCODE, @BATCHNO, @RUNDATE, GETDATE()  
  
  FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 END  
END  
  
  
SET @NOOFREC = 0  
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_D  
WHERE [CM CODE] = @ORG_MEMBERCODE  
AND ACTION = 'U'  
IF @NOOFREC > 0   
BEGIN  
 SET @CMCUR = CURSOR FOR  
 SELECT DISTINCT [CM CODE] FROM #FILEDATA_D  
 WHERE [CM CODE] = @ORG_MEMBERCODE  
 AND ACTION = 'U'  
 OPEN @CMCUR  
 FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 WHILE @@FETCH_STATUS = 0  
 BEGIN   
  SELECT @BATCHNO = 0      
  SELECT @SNO = 0    
      
  SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
  WHERE FLDFILENO = @MEMBERCODE      
  AND FLDFILEDATE = @RUNDATE    
   
  WHILE @SNO < @NOOFREC  
  BEGIN  
   SET @BATCHNO = @BATCHNO + 1   
   SET @FILENAME = @MEMBERCODE + '_ALLOC_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'.T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4)  
  
   SELECT FILENAME=@FILENAME,  
   [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE],   
   [TM CODE] = (CASE WHEN [ACCOUNT TYPE] = 'P' THEN '' ELSE [TM CODE] END), [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
   FROM #FILEDATA_D  
   WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
   AND [CM CODE] = @MEMBERCODE  
   AND ACTION = 'U'  
   ORDER BY SNO   
     
   INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE   
   SELECT FILENAME=@FILENAME,  
   [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
   @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
   FROM #FILEDATA_D  
   WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
   AND [CM CODE] = @MEMBERCODE  
   AND ACTION = 'U'  
   ORDER BY SNO       
     
   SET @SNO = @SNO + @FILEREC  
  END  
  
  INSERT INTO MSAJAG..ASIANFILEBATCHNO      
  SELECT @MEMBERCODE, @BATCHNO, @RUNDATE, GETDATE()  
  
  FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 END  
END  
  
SET @NOOFREC = 0  
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA  
WHERE [CM CODE] <> @ORG_MEMBERCODE  
IF @NOOFREC > 0   
BEGIN  
 SET @CMCUR = CURSOR FOR  
 SELECT DISTINCT [CM CODE] FROM #FILEDATA  
 WHERE [CM CODE] <> @ORG_MEMBERCODE  
 OPEN @CMCUR  
 FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 WHILE @@FETCH_STATUS = 0  
 BEGIN   
  SELECT @BATCHNO = 0      
  SET @SNO = 0    
      
  SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
  WHERE FLDFILENO = @MEMBERCODE      
  AND FLDFILEDATE = @RUNDATE    
    
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = @MEMBERCODE + '_ALLOC_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'.T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4)  
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA  
  WHERE [CM CODE] = @MEMBERCODE  
  ORDER BY SNO   
     
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE   
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA  
  WHERE [CM CODE] = @MEMBERCODE  
  ORDER BY SNO       
      
  INSERT INTO MSAJAG..ASIANFILEBATCHNO      
  SELECT @MEMBERCODE, @BATCHNO, @RUNDATE, GETDATE()  
  
  FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 END  
END  
  
  
SET @NOOFREC = 0  
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_D  
WHERE [CM CODE] <> @ORG_MEMBERCODE  
IF @NOOFREC > 0   
BEGIN  
 SET @CMCUR = CURSOR FOR  
 SELECT DISTINCT [CM CODE] FROM #FILEDATA_D  
 WHERE [CM CODE] <> @ORG_MEMBERCODE  
 OPEN @CMCUR  
 FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 WHILE @@FETCH_STATUS = 0  
 BEGIN   
  SELECT @BATCHNO = 0      
  SET @SNO = 0    
      
  SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
  WHERE FLDFILENO = @MEMBERCODE      
  AND FLDFILEDATE = @RUNDATE    
    
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = @MEMBERCODE + '_ALLOC_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'.T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4)  
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_D  
  WHERE [CM CODE] = @MEMBERCODE  
  ORDER BY SNO   
     
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE   
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_D  
  WHERE [CM CODE] = @MEMBERCODE  
  ORDER BY SNO       
      
  INSERT INTO MSAJAG..ASIANFILEBATCHNO      
  SELECT @MEMBERCODE, @BATCHNO, @RUNDATE, GETDATE()  
  
  FETCH NEXT FROM @CMCUR INTO @MEMBERCODE  
 END  
END  
END  
  
SELECT [CURRENT DATE]=REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),106),' ','-'),  
    T.EXCHANGE, T.SEGMENT,  
    SEGMENT_INDICATOR,  
    [CM CODE]=CMCODE,  
    [TM CODE]=(CASE WHEN ACCOUNT_TYPE = 'P' THEN '' ELSE TMCODE END),  
    [CP CODE]=CP_CODE,  
    [CLI CODE]=PARTY_CODE,  
 [ACCOUNT TYPE]=ACCOUNT_TYPE,  
 AMOUNT=SUM(C_ALLOCATECASH),   
 FILLER1='',  
 FILLER2='',  
 FILLER3='',  
 FILLER4='',  
 FILLER5='',  
 FILLER6='',  
 ACTION='A',  
 ORDERACTION=(CASE WHEN SUM(C_ALLOCATECASH)-SUM(P_ALLOCATECASH) > 0 THEN 'U' ELSE 'D' END),  
 P_ALLOCATECASH = SUM(P_ALLOCATECASH)  
 INTO #FILEDATA_BSE  
FROM #DATA T, MSAJAG..TBL_CMCC_DETAIL C  
WHERE @RUNDATE BETWEEN FROM_DATE AND TO_DATE  
AND T.EXCHANGE = C.EXCHANGE AND T.SEGMENT=C.SEGMENT  
AND T.EXCHANGE IN ('BSE','BSX','BCX')  
GROUP BY CMCODE, TMCODE, T.EXCHANGE, T.SEGMENT, SEGMENT_INDICATOR, PARTY_CODE, CP_CODE, ACCOUNT_TYPE  
HAVING SUM(C_ALLOCATECASH) <> SUM(P_ALLOCATECASH)  
ORDER BY ACTION, CMCODE, TMCODE, PARTY_CODE, SEGMENT_INDICATOR  
  
SELECT EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], AMOUNT, P_ALLOCATECASH, DIFFAMT = CONVERT(NUMERIC(18,3),0)  
INTO #PRODIFF_ICCL FROM #FILEDATA_BSE WHERE [ACCOUNT TYPE]='P'  
  
INSERT INTO #PRODIFF_ICCL  
SELECT DISTINCT EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE] = '', [ACCOUNT TYPE] = 'P', AMOUNT=0,   
P_ALLOCATECASH = 0,  
DIFF=0  
FROM #FILEDATA_BSE  
WHERE EXCHANGE NOT IN (SELECT EXCHANGE FROM #PRODIFF_ICCL WHERE #PRODIFF_ICCL.EXCHANGE = #FILEDATA_BSE.EXCHANGE  
AND #PRODIFF_ICCL.SEGMENT = #FILEDATA_BSE.SEGMENT)  
  
UPDATE #PRODIFF_ICCL SET DIFFAMT = #PRODIFF_ICCL.AMOUNT + AMT  
FROM (SELECT EXCHANGE, SEGMENT, AMT=SUM(P_ALLOCATECASH-AMOUNT) FROM #FILEDATA_BSE  
   WHERE ORDERACTION = 'D' AND [ACCOUNT TYPE] <> 'P'  
   GROUP BY EXCHANGE, SEGMENT )A  
WHERE #PRODIFF_ICCL.EXCHANGE = A.EXCHANGE  
AND #PRODIFF_ICCL.SEGMENT = A.SEGMENT  
AND #PRODIFF_ICCL.[ACCOUNT TYPE]='P'  
  
DELETE FROM #FILEDATA_BSE  
WHERE [ACCOUNT TYPE] = 'P'  
  
INSERT INTO #FILEDATA_BSE  
SELECT [CURRENT DATE]=REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),106),' ','-'),  
EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], AMOUNT=AMOUNT+DIFFAMT,   
FILLER1='',  
FILLER2='',  
FILLER3='',  
FILLER4='',  
FILLER5='',  
FILLER6='',  
ACTION='A',  
ORDERACTION = 'D',  
P_ALLOCATECASH = 0  
FROM #PRODIFF_ICCL  
  
INSERT INTO #FILEDATA_BSE  
SELECT [CURRENT DATE]=REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),106),' ','-'),  
EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], AMOUNT=AMOUNT,   
FILLER1='',  
FILLER2='',  
FILLER3='',  
FILLER4='',  
FILLER5='',  
FILLER6='',  
ACTION='A',  
ORDERACTION = 'U',  
P_ALLOCATECASH = 0  
FROM #PRODIFF_ICCL  
   
SELECT * INTO #FILEDATA_ICCL   
FROM #FILEDATA_BSE  
WHERE 1 = 2   
  
ALTER TABLE #FILEDATA_ICCL  
ADD SNO INT IDENTITY(1,1)  
  
SELECT * INTO #FILEDATA_ICCL_D  
FROM #FILEDATA_BSE  
WHERE 1 = 2   
  
ALTER TABLE #FILEDATA_ICCL_D  
ADD SNO INT IDENTITY(1,1)  
  
INSERT INTO #FILEDATA_ICCL  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION], [ORDERACTION],[P_ALLOCATECASH]  
FROM #FILEDATA_BSE WHERE ORDERACTION = 'D'    
ORDER BY EXCHANGE, SEGMENT, ORDERACTION, [CLI CODE] DESC  
  
INSERT INTO #FILEDATA_ICCL_D  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION], [ORDERACTION],[P_ALLOCATECASH]  
FROM #FILEDATA_BSE WHERE ORDERACTION = 'U'  
ORDER BY EXCHANGE, SEGMENT, ORDERACTION, [CLI CODE] ASC  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
SELECT FILENME='BSEFULLFILE_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
[CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_ICCL  
UNION ALL  
SELECT FILENME='BSEFULLFILE_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
[CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_ICCL_D  
ORDER BY 7  
END  
  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
SET @NOOFREC = 0   
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_ICCL  
WHERE ORDERACTION = 'D'  
IF @NOOFREC > 0   
BEGIN  
 SET @FILEREC = 50000  
 SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #FILEDATA_ICCL  
 SELECT @BATCHNO = 0      
 SET @SNO = 0    
      
 SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
 WHERE FLDFILENO = 'BSECLTCOLL'      
 AND FLDFILEDATE = @RUNDATE    
   
 WHILE @SNO < @NOOFREC  
 BEGIN  
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = 'ICCLCOLL_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'_'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4) + '.CSV'  
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_ICCL  
  WHERE ORDERACTION = 'D'  
  AND SNO > @SNO AND SNO <= @SNO + @FILEREC  
  ORDER BY SNO   
    
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_ICCL  
  WHERE ORDERACTION = 'D'  
  AND SNO > @SNO AND SNO <= @SNO + @FILEREC  
  ORDER BY SNO   
  
  SET @SNO = @SNO + @FILEREC  
 END  
  
 INSERT INTO MSAJAG..ASIANFILEBATCHNO      
 SELECT 'BSECLTCOLL', @BATCHNO, @RUNDATE, GETDATE()  
END  
  
  
SET @NOOFREC = 0   
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_ICCL_D  
WHERE ORDERACTION = 'U'  
IF @NOOFREC > 0   
BEGIN  
 SET @FILEREC = 50000  
 SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #FILEDATA_ICCL_D  
 SELECT @BATCHNO = 0      
 SET @SNO = 0    
      
 SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
 WHERE FLDFILENO = 'BSECLTCOLL'      
 AND FLDFILEDATE = @RUNDATE    
   
 WHILE @SNO < @NOOFREC  
 BEGIN  
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = 'ICCLCOLL_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'_'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4) + '.CSV'  
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_ICCL_D  
  WHERE ORDERACTION = 'U'  
  AND SNO > @SNO AND SNO <= @SNO + @FILEREC  
  ORDER BY SNO   
    
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_ICCL_D  
  WHERE ORDERACTION = 'U'  
  AND SNO > @SNO AND SNO <= @SNO + @FILEREC  
  ORDER BY SNO   
  
  SET @SNO = @SNO + @FILEREC  
 END  
  
 INSERT INTO MSAJAG..ASIANFILEBATCHNO      
 SELECT 'BSECLTCOLL', @BATCHNO, @RUNDATE, GETDATE()  
END  
END  
  
SELECT [CURRENT DATE]=REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),106),' ','-'),  
    T.EXCHANGE, T.SEGMENT,  
    SEGMENT_INDICATOR,  
    [CM CODE]=CMCODE,  
    [TM CODE]=(CASE WHEN ACCOUNT_TYPE = 'P' THEN '' ELSE TMCODE END),  
    [CP CODE]=CP_CODE,  
    [CLI CODE]=PARTY_CODE,  
 [ACCOUNT TYPE]=ACCOUNT_TYPE,  
 AMOUNT=SUM(C_ALLOCATECASH),   
 FILLER1='',  
 FILLER2='',  
 FILLER3='',  
 FILLER4='',  
 FILLER5='',  
 FILLER6='',  
 ACTION='',  
 ORDERACTION=(CASE WHEN SUM(C_ALLOCATECASH)-SUM(P_ALLOCATECASH) > 0 THEN 'U' ELSE 'D' END)  
 INTO #FILEDATA_NCDX_TMP  
FROM #DATA T, MSAJAG..TBL_CMCC_DETAIL C  
WHERE @RUNDATE BETWEEN FROM_DATE AND TO_DATE  
AND T.EXCHANGE = C.EXCHANGE AND T.SEGMENT=C.SEGMENT  
AND T.EXCHANGE IN ('NCX')  
GROUP BY CMCODE, TMCODE, T.EXCHANGE, T.SEGMENT, SEGMENT_INDICATOR, PARTY_CODE, CP_CODE, ACCOUNT_TYPE  
HAVING SUM(C_ALLOCATECASH) <> SUM(P_ALLOCATECASH)  
ORDER BY CMCODE, TMCODE, ACTION, PARTY_CODE, SEGMENT_INDICATOR  
  
SELECT * INTO #FILEDATA_NCDX   
FROM #FILEDATA_NCDX_TMP  
WHERE 1 = 2   
  
ALTER TABLE #FILEDATA_NCDX  
ADD SNO INT IDENTITY(1,1)  
  
INSERT INTO #FILEDATA_NCDX  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION], [ORDERACTION]  
FROM #FILEDATA_NCDX_TMP  
ORDER BY EXCHANGE, SEGMENT, ORDERACTION, [CLI CODE]  
  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
SELECT FILENME='NCDXFULLFILE_'+REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','')+'.CSV',  
[CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_NCDX  
ORDER BY SNO   
END  
  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
SET @NOOFREC = 0  
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_NCDX  
WHERE ORDERACTION = 'D'  
IF @NOOFREC > 0   
BEGIN  
 SET @FILEREC = 50000  
 SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #FILEDATA_NCDX  
 SELECT @BATCHNO = 0      
 SET @SNO = 0    
      
 SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
 WHERE FLDFILENO = 'NCXCLTCOLL'      
 AND FLDFILEDATE = @RUNDATE    
   
 WHILE @SNO < @NOOFREC  
 BEGIN  
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = 'NCCL_ALLOC_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'_T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4) + '.CSV'  
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_NCDX  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND ORDERACTION = 'D'  
  ORDER BY SNO   
    
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_NCDX  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND ORDERACTION = 'D'  
  ORDER BY SNO   
  
  SET @SNO = @SNO + @FILEREC  
 END  
  
 INSERT INTO MSAJAG..ASIANFILEBATCHNO      
 SELECT 'NCXCLTCOLL', @BATCHNO, @RUNDATE, GETDATE()  
END  
  
SET @NOOFREC = 0  
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_NCDX  
WHERE ORDERACTION = 'U'  
IF @NOOFREC > 0   
BEGIN  
 SET @FILEREC = 50000  
 SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #FILEDATA_NCDX  
 SELECT @BATCHNO = 0      
 SET @SNO = 0    
      
 SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
 WHERE FLDFILENO = 'NCXCLTCOLL'      
 AND FLDFILEDATE = @RUNDATE    
   
 WHILE @SNO < @NOOFREC  
 BEGIN  
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = 'NCCL_ALLOC_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'_T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4) + '.CSV'  
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_NCDX  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND ORDERACTION = 'U'  
  ORDER BY SNO   
    
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_NCDX  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND ORDERACTION = 'U'  
  ORDER BY SNO   
  
  SET @SNO = @SNO + @FILEREC  
 END  
  
 INSERT INTO MSAJAG..ASIANFILEBATCHNO      
 SELECT 'NCXCLTCOLL', @BATCHNO, @RUNDATE, GETDATE()  
END  
END  
  
SELECT * INTO #NCDX_REPLD   
FROM MSAJAG..TBL_CLIENT_COLL_ALLOCATE  
WHERE PROCESS_DT= @RUNDATE    
AND REPLD_NONCASH + REPLD_NONCASHEQ > 0   
AND EXCHANGE = 'NCX' AND SEGMENT = 'FUTURES'  
--IF @FLAG = 0 OR @FLAG = 2   
--BEGIN   
--SET @NOOFREC = 0  
  
--ALTER TABLE #NCDX_REPLD  
--ADD SNO INT IDENTITY(1,1)  
  
--SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #NCDX_REPLD  
--IF @NOOFREC > 0   
--BEGIN  
-- SET @FILEREC = 50000  
-- SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #NCDX_REPLD  
-- SELECT @BATCHNO = 0      
-- SET @SNO = 0    
      
-- SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM ASIANFILEBATCHNO      
-- WHERE FLDFILENO = 'NCXCLTPLD'      
-- AND FLDFILEDATE = @RUNDATE    
   
-- WHILE @SNO < @NOOFREC  
-- BEGIN  
--  SET @BATCHNO = @BATCHNO + 1   
--  SET @FILENAME = 'NCCL_NCASHLMT_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'_T'+RIGHT('0000'+CONVERT(VARCHAR,@BATCHNO),4) + '.CSV'  
  
--  SELECT FILENAME=@FILENAME,  
--  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
--  FROM #NCDX_REPLD  
--  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
--  ORDER BY SNO   
  
--  SET @SNO = @SNO + @FILEREC  
-- END  
  
-- INSERT INTO ASIANFILEBATCHNO      
-- SELECT 'NCXCLTPLD', @BATCHNO, @RUNDATE, GETDATE()  
--END  
--END  
  
SELECT [CURRENT DATE]=REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),106),' ','-'),  
    T.EXCHANGE, T.SEGMENT,  
    SEGMENT_INDICATOR,  
    [CM CODE]=CMCODE,  
    [TM CODE]=(CASE WHEN ACCOUNT_TYPE = 'P' THEN '' ELSE TMCODE END),  
    [CP CODE]=CP_CODE,  
    [CLI CODE]=PARTY_CODE,  
 [ACCOUNT TYPE]=ACCOUNT_TYPE,  
 AMOUNT=ABS(SUM(C_ALLOCATECASH)-SUM(P_ALLOCATECASH)),   
 FILLER1='',  
 FILLER2='',  
 FILLER3='',  
 FILLER4='',  
 FILLER5='',  
 FILLER6='',  
 ACTION=(CASE WHEN SUM(C_ALLOCATECASH)-SUM(P_ALLOCATECASH) > 0 THEN 'A' ELSE 'D' END)  
 INTO #FILEDATA_MCDX_NEW  
FROM #DATA T, MSAJAG..TBL_CMCC_DETAIL C  
WHERE @RUNDATE BETWEEN FROM_DATE AND TO_DATE  
AND T.EXCHANGE = C.EXCHANGE AND T.SEGMENT=C.SEGMENT  
AND T.EXCHANGE IN ('MCX')  
GROUP BY CMCODE, TMCODE, T.EXCHANGE, T.SEGMENT, SEGMENT_INDICATOR, PARTY_CODE, CP_CODE, ACCOUNT_TYPE  
HAVING SUM(C_ALLOCATECASH) <> SUM(P_ALLOCATECASH)  
ORDER BY CMCODE, TMCODE, ACTION DESC, PARTY_CODE, SEGMENT_INDICATOR  
  
SELECT * INTO #FILEDATA_MCDX FROM #FILEDATA_MCDX_NEW WHERE 1 = 2   
  
ALTER TABLE #FILEDATA_MCDX  
ADD SNO INT IDENTITY(1,1)  
  
SELECT * INTO #FILEDATA_MCDX_D FROM #FILEDATA_MCDX_NEW WHERE 1 = 2   
  
ALTER TABLE #FILEDATA_MCDX_D  
ADD SNO INT IDENTITY(1,1)  
  
INSERT INTO #FILEDATA_MCDX  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_MCDX_NEW WHERE [ACTION] = 'D'  
ORDER BY EXCHANGE, SEGMENT, ACTION DESC, [CLI CODE]  
   
INSERT INTO #FILEDATA_MCDX_D  
SELECT [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
FROM #FILEDATA_MCDX_NEW WHERE [ACTION] = 'A'  
ORDER BY EXCHANGE, SEGMENT, ACTION DESC, [CLI CODE]  
IF @FLAG = 0 OR @FLAG = 2   
BEGIN   
SET @NOOFREC = 0   
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_MCDX  
WHERE [ACTION] = 'D'  
IF @NOOFREC > 0   
BEGIN  
 SET @FILEREC = 10000-- @NOOFREC  
 SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #FILEDATA_MCDX   
 SELECT @BATCHNO = 0     
 SET @SNO = 0    
      
 SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
 WHERE FLDFILENO = 'MCXCLTCOLL'      
 AND FLDFILEDATE = @RUNDATE    
   
 WHILE @SNO < @NOOFREC  
 BEGIN  
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = 'MCCLCOLL_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'.'+RIGHT('000'+CONVERT(VARCHAR,@BATCHNO),3)   
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_MCDX  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND [ACTION] = 'D'  
  ORDER BY SNO   
    
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_MCDX  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND [ACTION] = 'D'  
  ORDER BY SNO   
  
  SET @SNO = @SNO + @FILEREC  
 END  
  
 INSERT INTO MSAJAG..ASIANFILEBATCHNO      
 SELECT 'MCXCLTCOLL', @BATCHNO, @RUNDATE, GETDATE()  
END  
  
SET @NOOFREC = 0   
  
SELECT @NOOFREC = ISNULL(COUNT(1),0) FROM #FILEDATA_MCDX_D  
WHERE [ACTION] = 'A'  
IF @NOOFREC > 0   
BEGIN  
 SET @FILEREC = 10000-- @NOOFREC    
 SELECT TOP 1  @MEMBERCODE = [CM CODE] FROM #FILEDATA_MCDX_D   
 SELECT @BATCHNO = 0     
 SET @SNO = 0    
      
 SELECT @BATCHNO = ISNULL(MAX(FLDBATCHNO),0) FROM MSAJAG..ASIANFILEBATCHNO      
 WHERE FLDFILENO = 'MCXCLTCOLL'      
 AND FLDFILEDATE = @RUNDATE    
   
 WHILE @SNO < @NOOFREC  
 BEGIN  
  SET @BATCHNO = @BATCHNO + 1   
  SET @FILENAME = 'MCCLCOLL_' + @MEMBERCODE + '_' + REPLACE(CONVERT(VARCHAR,CONVERT(DATETIME,@RUNDATE),103),'/','') +'.'+RIGHT('000'+CONVERT(VARCHAR,@BATCHNO),3)   
  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION]  
  FROM #FILEDATA_MCDX_D  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND [ACTION] = 'A'  
  ORDER BY SNO   
    
  INSERT INTO MSAJAG..TBL_CLIENT_COLL_FILE  
  SELECT FILENAME=@FILENAME,  
  [CURRENT DATE], EXCHANGE, SEGMENT, [SEGMENT_INDICATOR], [CM CODE], [TM CODE], [CP CODE], [CLI CODE], [ACCOUNT TYPE], [AMOUNT], [FILLER1], [FILLER2], [FILLER3], [FILLER4], [FILLER5], [FILLER6], [ACTION],  
  @BATCHNO,'CLASSBO','',GETDATE(),'G','','',GETDATE()   
  FROM #FILEDATA_MCDX_D  
  WHERE SNO > @SNO AND SNO <= @SNO + @FILEREC  
  AND [ACTION] = 'A'  
  ORDER BY SNO   
  
  SET @SNO = @SNO + @FILEREC  
 END  
  
 INSERT INTO MSAJAG..ASIANFILEBATCHNO      
 SELECT 'MCXCLTCOLL', @BATCHNO, @RUNDATE, GETDATE()  
END  
END  
  
DROP TABLE #FILEDATA  
DROP TABLE #FILEDATA_ICCL  
DROP TABLE #FILEDATA_NCDX  
DROP TABLE #FILEDATA_MCDX  
DROP TABLE #NCDX_REPLD  
DROP TABLE #DATA

GO

-- --------------------------------------------------
-- PROCEDURE dbo.RPT_DAILY_MG13_BKUP_28JUN2024
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[RPT_DAILY_MG13_BKUP_28JUN2024] (@RUNDATE VARCHAR(11),@PARTY VARCHAR(11),@RPT VARCHAR(11))  
  
AS ---- EXEC RPT_EXCHANGE_PEAK_MARGIN 'AUG 27 2021','GRMB131','NSECM'  
  
IF @RPT = 'NSECM'  
BEGIN  
  
SELECT [Trade Date]=CONVERT(VARCHAR(11),MARGINDATE,105),[Client Code]=PARTY_CODE,[VAR margin + Extreme Loss margin]=VARMARGIN,  
[Minimum Margin]=EXTREME_LOSS_MARGIN,[Additional Margin]=ADDITIONAL_MARGIN,[MTM Loss]=MTOM_LOSS,  
[Total Actual Margin ]=TOTAL_MARGIN_VAR,[Total Margin to be Collected]=TOTAL_MARGIN,Peakmargin,[Client Flag]=CL_FLAG,Exchange='NSECM'  
FROM MSAJAG.DBO.TBL_CMMARGIN WITH (NOLOCK)  
WHERE MARGINDATE BETWEEN @RUNDATE AND @RUNDATE + ' 23:59'  
AND PARTY_CODE = @PARTY  
ORDER BY PARTY_CODE  
  
END  
  
IF @RPT = 'NSEFO'  
BEGIN  
SELECT [Trade Date]=convert(varchar(11),mdate,105),[Client Code]=party_code,[Span Margin]=spreadmargin,  
Filler=NonSpreadMargin,[Extreme Loss Margin]=mtom,[Delivery margin]=DEL_MARGIN,[Cystallized Obligation]=mtomloss,  
[Total Margin to be Collected]=TotalMargin,Peakmargin,[Client Flag]=Cl_Type,Exchange='NSEFO'  
from ANGELFO.NSEFO.DBO.FOMARGINNEW with (nolock)  
WHERE MDATE BETWEEN @RUNDATE AND @RUNDATE + ' 23:59'   
AND PARTY_CODE = @PARTY  
ORDER BY PARTY_CODE  
END  
  
IF @RPT = 'NSECD'  
BEGIN  
select [Trade Date]=convert(varchar(11),mdate,105),[Client Code]=party_code,[Span Margin]=spreadmargin,  
Filler=nonspreadmargin,[Extreme Loss Margin]=mtom,[Cystallized Obligation]=mtomloss,[Total Margin to be Collected]=totalmargin,Peakmargin,  
[Client Flag]=cl_type,Exchange='NSECD'  
from angelfo.nsecurfo.dbo.fomarginnew with (nolock)   
WHERE MDATE BETWEEN @RUNDATE AND @RUNDATE + ' 23:59'   
AND PARTY_CODE = @PARTY  
END  
  
IF @RPT = 'MCDX'  
BEGIN  
/*
SELECT [Trade Date]=convert(varchar(11),mdate,105),[Client Code]=party_code,[Initial Mrgin]=PMARGIN,[Other Margin]=0,MTM=MTOM,  
Reserved=0,Reserved=0,[MTM Collected]=PMARGINAMOUNT,[Initial Margin Collected]=TOTALMARGIN,[Other Margin Collected]=0,[Peak Margin Threshold %]=75,  
[Peak Margin]=SPREADMARGIN,Segments='MCDX'  
FROM ANGELCOMMODITY.MCDX.DBO.FOMARGINNEW WITH (NOLOCK)   
WHERE MDATE BETWEEN @RUNDATE AND @RUNDATE + ' 23:59'  
AND PARTY_CODE = @PARTY  
*/

SELECT [TRADE DATE]=CONVERT(VARCHAR(11),MDATE,105),[CLIENT CODE]=PARTY_CODE,[INITIAL MRGIN]=REGULARMARGIN,[OTHER MARGIN]=0,MTM=MTOMMARGIN,  
RESERVED=0,RESERVED=0,[MTM COLLECTED]=MTOMMARGIN,[INITIAL MARGIN COLLECTED]=REGULARMARGIN,[OTHER MARGIN COLLECTED]=0,
[PEAK MARGIN THRESHOLD %]=PEAKMARGIN_THRESHOLD,  
[PEAK MARGIN]=PEAKMARGIN,SEGMENTS='MCDX'  
FROM ANGELCOMMODITY.MCDX.DBO.FOMARGINNEW_DATA WITH (NOLOCK)   
WHERE MDATE BETWEEN @RUNDATE AND @RUNDATE + ' 23:59'  
AND PARTY_CODE = @PARTY  

END  
  
IF @RPT = 'NCDX'  
BEGIN  
SELECT [Trade Date]=convert(varchar(11),mdate,105),[Client Code]=party_code,[Initial Mrgin (Initial + Extreme Loss)]=PMARGIN,[Peak Initial Mrgin]=PSPANMARGIN,  
[Other Margin]=ADDMARGIN,MTM=MTOM,[Upfront initial Mrgn Collected]=TOTALMARGIN,[Peak Initial Mrgn Collected]=SPREADMARGIN,  
[Other Margins Collected by T+2]=MARGINPERCENT,[MTM (Gains)/ Loss Collected By T+2]=0,[Shortfall in Initial Mrgn]=0,  
[Shortfall in Peak Mrgn]=0,[Shortfall in Other Mrgn]=0,[Shortfall in MTM (Gain)/Loss]=0,  
Segments='NCDX'  
FROM ANGELCOMMODITY.NCDX.DBO.FOMARGINNEW WITH (NOLOCK)  
WHERE MDATE BETWEEN @RUNDATE AND @RUNDATE + ' 23:59'  
AND PARTY_CODE = @PARTY  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.RUNFROMFRONTEND
-- --------------------------------------------------

CREATE PROC RUNFROMFRONTEND
AS
 
--EXEC dbo.sp_start_job N'SQL JOB TEST' ;  -- NOT WORKING
EXEC msdb.dbo.sp_start_job N'SQL JOB TEST';

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ACC_LASTTRADE_DATA
-- --------------------------------------------------
          
---- // USE DUSTBIN   --- // ANAND1                          
---- // DESCRIPTION :- ACCOUNT CREATION DATE AND LAST TRADING DATE. ---> CREATED BY HRISHI    
                          
CREATE PROC [dbo].[USP_ACC_LASTTRADE_DATA]
AS
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                           
SET @PATH='J:\Backoffice\SL_AUTO\DHANESH_M\INPUT\CODE.CSV'                            
                       
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL                      
    DROP TABLE #CODE          
CREATE TABLE #CODE (CLTCODE VARCHAR(50))            
                          
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''          
SET @SQL2=' WITH          
    (                            
           FIRSTROW = 1,                            
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                            
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                            
           TABLOCK                            
    )'                            
                          
SET @SQLFINAL= @SQL + @SQL2                            
PRINT @SQLFINAL                            
EXEC (@SQLFINAL)                          
          
--SELECT TOP 10 * FROM #CODE            
--SELECT TOP 10 * FROM #DATA        
    

IF OBJECT_ID(N'tempdb..#CHECK') IS NOT NULL                      
DROP TABLE #CHECK

SELECT CL_CODE,CONVERT(VARCHAR(10),MIN(ACTIVE_DATE),105) AS  ACTIVE_DATE, CONVERT(VARCHAR(10),'') AS  LAST_TRD_DT
INTO #CHECK
FROM #CODE , MSAJAG.DBO.CLIENT_BROK_DETAILS WHERE CL_CODE = CLTCODE
GROUP BY CL_CODE

IF OBJECT_ID(N'tempdb..#CHECK1') IS NOT NULL                      
DROP TABLE #CHECK1

SELECT  C.CLTCODE, CONVERT(VARCHAR(10),MAX(VDT),105) AS  LAST_TRD_DT
INTO #CHECK1
FROM #CODE C , ACCOUNT..LEDGER_ALL L WHERE C.CLTCODE = L.CLTCODE
GROUP BY  C.CLTCODE

UPDATE #CHECK SET LAST_TRD_DT = #CHECK1.LAST_TRD_DT FROM #CHECK1 WHERE CL_CODE = CLTCODE


IF OBJECT_ID(N'DUSTBIN..TBL_LASTTRADEDATE_DATA') IS NOT NULL                      
DROP TABLE TBL_LASTTRADEDATE_DATA 

SELECT * INTO DUSTBIN.DBO.TBL_LASTTRADEDATE_DATA FROM #CHECK

--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_LASTTRADEDATE_DATA


DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')            
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\DHANESH_M\OUTPUT\' +'LASTTRADE_DATA_' + @RPT_DATE + '.CSV'            
DECLARE @ALL VARCHAR(MAX)            
            
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CL_CODE'''',''''ACTIVE_DATE'''',''''LAST_TRD_DT'''''        
  
    
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_LASTTRADEDATE_DATA'           
PRINT @ALL            
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'            
PRINT @ALL            
EXEC(@ALL)            

DROP TABLE #CODE             
DROP TABLE #CHECK            
DROP TABLE #CHECK1           
DROP TABLE DUSTBIN.DBO.TBL_LASTTRADEDATE_DATA            
                          
SELECT 'CLIENT CREATE AND LAST TRADE DATE DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ALLOCATION_CC01_IMPORT
-- --------------------------------------------------

-- // CREATED BY HRISHI / AKSHAY ON 23-05-2023
-- // DESCREPTION IMPORT ALLOCATION_CC01 FILE INTO DUSTBIN TABLE

--DECLARE @DATE AS DATETIME='2023-05-23', @PATH VARCHAR (100)='J:\Backoffice\IMPORT\Risk\C_CC01_12798_22052023.csv', @EXCHANGE VARCHAR(3)='NSE',@SEGMENT VARCHAR(7)='CAPITAL'  

CREATE PROC USP_ALLOCATION_CC01_IMPORT (@DATE AS DATETIME, @PATH VARCHAR (100), @EXCHANGE VARCHAR(3),@SEGMENT VARCHAR(7) )

AS

DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX)

--SET @PATH='J:\Backoffice\HRISHI\Test.csv'

CREATE TABLE #TEMP (PARTY VARCHAR(10),FILLER1 MONEY ,FILLER2 MONEY,FILLER3 MONEY,FILLER4 MONEY,FILLER5 MONEY)

SET @SQL='BULK INSERT  #TEMP FROM ' + ''''+ @PATH +''''
      
SET @SQL2=' WITH
    (
           FIRSTROW = 1,
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER
           ROWTERMINATOR = ''0x0a'',   --USE TO SHIFT THE CONTROL TO NEXT ROW
           TABLOCK
    )'

SET @SQLFINAL= @SQL + @SQL2
PRINT @SQLFINAL

EXEC (@SQLFINAL)

INSERT INTO ALLOCATE_TEMP_NEW_HRISHI
SELECT  @DATE,PARTY,@EXCHANGE,@SEGMENT,FILLER1,'' FROM #TEMP

SELECT 'PROCESS HAS BEEN COMPLETED'

DROP TABLE #TEMP

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Angel_nri_Data_lec_allfiles_UAT
-- --------------------------------------------------

--use 196-- inhouse                                                    
--exec [usp_Angel_nri_Data_lec_allfiles_UAT] '25/01/2024',0                
             
CREATE proc [dbo].[usp_Angel_nri_Data_lec_allfiles_UAT]              
(              
@SDATE  AS VARCHAR(11),                                                
@BANKID AS INT                                
)              
As              
Begin              
              
                       
  --insert into #output                    
  --Exec master.dbo.xp_cmdshell 'NET USE \\196.1.115.147\IPC$ /USER:Administrator Winw0rld@1604'                      
              
truncate table tbl_NSEBSE_HEADER_yesHdfcbnk              
truncate table tbl_NSEBSE_Details_yesHdfcbnk              
exec Angel_nri_data_lec_new_15may2023 @SDATE,1,@BANKID,'NSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,2,@BANKID,'NSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,1,@BANKID,'BSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,2,@BANKID,'BSE'              
              
  SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103))          
        
  --declare @SDATE as varchar(11)=CONVERT(VARCHAR(11), CONVERT(DATETIME,'07/12/2023', 103))       
              
--  select *,CONVERT(money,0.00)as NetAmt,CONVERT(varchar,'')as CONTRACTNO_NEW into #aa from tbl_NSEBSE_HEADER_yesHdfcbnk            
             
-- update a set a.CONTRACTNO_NEW=b.CONTRACTNO_NEW,a.NetAmt=b.netAmount from #aa a,            
--(select CONTRACTNO_NEW,sum(netAmount) netAmount,party_code,sauda_date from MSAjag.dbo.common_contract_data b with(nolock) group by            
--CONTRACTNO_NEW,party_code,sauda_date) b where a.sauda_date=b.sauda_date and b.SAUDA_DATE=@SDATE and a.party_code=b.party_code            
            
 select *,CONVERT(money,0.00)as NetAmt,CONVERT(varchar,'')as CONTRACTNO_NEW,CONVERT(money,0.00) as NETRAte,CONVERT(money,0.00) as             
  Brokerage into #aa from tbl_NSEBSE_HEADER_yesHdfcbnk -- where party_code='ZR1196R'             
       
 SELECT PARTY_CODE,SCRIP_CD,sauda_date,scrip_name,isin,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,            
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)            
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=             
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,            
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =             
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +            
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN             
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,            
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),            
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD)          
into #check  from [Anand].bsedb_ab.dbo.CMBILLVALAN S with(nolock) where --party_code='ZR1196R' and            
 sauda_date=@SDATE           
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,sauda_date,scrip_name,ISIN,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT        
      
      
alter table #check      
alter column MEMBERTYPE varchar(10)      
      
 insert into #check      
  SELECT PARTY_CODE,SCRIP_CD,sauda_date,scrip_name,isin,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,            
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)            
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=             
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,            
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =             
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +            
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN             
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,            
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),            
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD)            
FROM MSAJAG.dbo.CMBILLVALAN S with(nolock) where --party_code='ZR1196R' and            
 sauda_date=@SDATE           
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,sauda_date,scrip_name,ISIN,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT            
      
--#check where party_Code='ZR1672R' -- 4757610      
         
 select PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,isin,SCRIPNAME into #contract from MSAjag.dbo.common_contract_data with(nolock) where sauda_date=@SDATE --and party_code='zr1196r'             
       
 --insert into #contract       
 --select PARTY_CODE,SAUDA_DATE,CONTRACTNO,isin,SCRIPNAME from [Anand].bsedb_ab.dbo.contract_data with(nolock) where sauda_date=@SDATE      
      
 alter table #check add CONTRACTNO_NEW varchar(100)             
            
 update a set a.CONTRACTNO_NEW=b.CONTRACTNO_NEW from #check a,            
#contract b where a.PARTY_CODE=b.PARTY_CODE and a.sauda_date=b.SAUDA_DATE and a.isin=b.isin and            
 left(a.SCRIP_NAME,18)=left(b.SCRIPNAME,18)            
            
  select a.PARTY_CODE,a.SAUDA_DATE,a.SELL_BUY,a.CONTRACTNO,EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,NO_OF_TRANSACTIONS,            
 TOTALAMT,TYPE,nseSett_no2,nseBank,rbi_refno,CliPISNo,CliBnkAcc,cliBankBranch,angelAcc,c.CONTRACTNO_NEW            
,b.DPid1,b.cltdpID1,b.Short_Name,c.SCRIP_CD,c.EXCHANGE,c.ISIN,c.SCRIP_NAME,c.BUYDELIVERYCHRG+c.SELLDELIVERYCHRG as Brokearge,c.PTRADEDQTY+c.STRADEDQTY as Qty,c.PMARKETRATE+c.SMARKETRATE as Rate,            
c.BILLPAMT+c.BILLSAMT as ExactAmount,c.PNETRATE+c.SNETRATE as Weighted,case when PMARKETRATE<>0 and PTRADEDQTY<>0 then (c.PMARKETRATE*PTRADEDQTY) when SMARKETRATE<>0 and STRADEDQTY<>0 then (SMARKETRATE*STRADEDQTY) end as TotalMarketVal,c.SERVICE_TAX+c.TURN_TAX+c.SEBI_TAX+c.BROKER_CHRG as OtherCharges,            
 c.SETT_NO,c.INS_CHRG as nsestt into #final from #aa a join  #check c on a.party_code=c.party_code     and a.SETT_NO=C.Sett_no and             
 A.contractno=c.Contractno              
 left outer join [Intranet].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                     
                    
            
              
   truncate table tbl_NRILecYesHdfc_temp             
   select * into ##Header from tbl_NRILecYesHdfc_temp where 1=2            
     insert into ##Header(Fldcol,BankName)            
  select 'Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Bank''s Branch Name,Broker Name,Date of Receipt /payment,Demat Debit /Credit Date,Broker A/C No' as Fldcol,''            
            
   insert into tbl_NRILecYesHdfc_temp              
select distinct nseBank+','+Convert(varchar,SAUDA_DATE,103)+','+PARTY_CODE+','+DPid1 +','+cast(right(cltdpID1,8) as varchar) +','+Short_Name +','+Exchange +','+isnull(nseSett_no2,'') +','+                    
     CONVERT(VARCHAR,isnull(CONTRACTNO_NEW,''))+','+ltrim(rtrim(SCRIP_CD))+','+Ltrim(Rtrim(Isnull(ISIN,'')))+','+                    
     left(SCRIP_NAME,75)+','+CASE WHEN Sell_Buy = 1 THEN 'B'  WHEN Sell_Buy = 2 THEN 'S'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,sum(QTY)))) +','+ Convert(Varchar,avg(Weighted))+','+cast((CONVERT(DEC(15,2),avg(TotalMarketVal))) as varchar)            
  +','+  Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), avg(RATE))))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), sum(Brokearge)))))+','+                         
        CONVERT(VARCHAR,CONVERT(DEC(10,2),Isnull(sum(OtherCharges),0)))+','+                    
    -- cast(Ltrim(Rtrim(CONVERT(DEC(10,2),sum(TotalMarketVal+Brokearge+OtherCharges)))) as varchar)            
   CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),Case when Sell_Buy = 1 THEN sum((TotalMarketVal+Brokearge+OtherCharges)) else sum(TotalMarketVal-Brokearge-OtherCharges) end))            
  +','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(NseStt, 0))))+','+       
  CONVERT(VARCHAR,(CONVERT(DECIMAL(14, 2),(Case when Sell_Buy = 1 THEN sum(TotalMarketVal+Brokearge+OtherCharges)+Sum(Isnull(NseStt, 0)) else sum(TotalMarketVal-Brokearge-OtherCharges)-Sum(Isnull(NseStt, 0)) end)))) +','        
    -- CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),ABS(sum(ExactAmount))))+','            
  +isnull(rbi_refno,'')+','+isnull(CliPISNo,'')+','+isnull(CliBnkAcc,'')+','+case when nseBank like 'HDFC%' then 'Tulsiani' else cliBankBranch end+','+'Angel One Ltd'+','+               
  CASE WHEN Sell_Buy = 1 THEN  Convert(varchar,(sauda_date +1),103)  WHEN Sell_Buy = 2 THEN Convert(varchar,(sauda_date+2),103)  END+','+                    
      CASE WHEN Sell_Buy = 1 THEN  Convert(varchar,(sauda_date +1),103)  WHEN Sell_Buy = 2 THEN Convert(varchar,(sauda_date+2),103)  END +','+angelAcc,nseBank                    
     from #final group by  PARTY_CODE, SAUDA_DATE ,DPid1 ,right(cltdpID1,8) ,Short_Name ,                    
     CONVERT(VARCHAR, isnull(CONTRACTNO_NEW,'')) ,ISIN,                   
     SCRIP_NAME,SCRIP_CD,                    
     nseBank,rbi_refno,Sell_Buy,CliPISNo,              
  CliBnkAcc,cliBankBranch,angelAcc,Exchange,isnull(nseSett_no2,'')              
            
              
              
  declare @BCPCOMMAND1 as varchar(5000)               
     DECLARE @hdfcfilename2 as varchar(1000)              
     DECLARE @Yesfilename2 as varchar(1000)              
     declare @link as varchar(2000)=''                    
              
    if ((select count(1) from tbl_NRILecYesHdfc_temp where bankname like '%HDFC%')>0)                    
    Begin                    
    SET @hdfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\HDFC_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                     
    SET @BCPCOMMAND1 = 'BCP "select Fldcol from ##Header union all select FLDCOL from DUSTBIN.dbo.tbl_NRILecYesHdfc_temp where bankname like ''%HDFC%''" QUERYOUT "'                                                
    -- print(@BCPCOMMAND1)                                          
   SET @BCPCOMMAND1 = @BCPCOMMAND1 + @hdfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                   
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                     
  -- set @link=@link +'<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                    
  select '<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                    
   End              
              
  if ((select count(1) from tbl_NRILecYesHdfc_temp where bankname like '%YES%')>0)                    
      Begin                    
        SET @YESfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\HRISHI\NRI_CLIENTS\YES_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                     
        SET @BCPCOMMAND1 = 'BCP "select Fldcol from ##Header union all select FLDCOL from DUSTBIN.dbo.tbl_NRILecYesHdfc_temp where bankname like ''%YES%''" QUERYOUT "'                                                
       -- print(@BCPCOMMAND1)                                          
       SET @BCPCOMMAND1 = @BCPCOMMAND1 + @YESfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                      
       EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                     
       --set @link=@link +'<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                        
        select '<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                    
      End              
 Drop table ##Header              
               
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Angel_nri_Data_lec_allfiles_UAT_BKP
-- --------------------------------------------------

--use 196-- inhouse                                                    
--exec [usp_Angel_nri_Data_lec_allfiles_UAT] '25/01/2024',0                
             
CREATE proc [dbo].[usp_Angel_nri_Data_lec_allfiles_UAT_BKP]              
(              
@SDATE  AS VARCHAR(11),                                                
@BANKID AS INT                                
)              
As              
Begin              
              
                       
  --insert into #output                    
  --Exec master.dbo.xp_cmdshell 'NET USE \\196.1.115.147\IPC$ /USER:Administrator Winw0rld@1604'                      
              
truncate table tbl_NSEBSE_HEADER_yesHdfcbnk              
truncate table tbl_NSEBSE_Details_yesHdfcbnk              
exec Angel_nri_data_lec_new_15may2023 @SDATE,1,@BANKID,'NSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,2,@BANKID,'NSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,1,@BANKID,'BSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,2,@BANKID,'BSE'              
              
  SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103))          
        
  --declare @SDATE as varchar(11)=CONVERT(VARCHAR(11), CONVERT(DATETIME,'07/12/2023', 103))       
              
--  select *,CONVERT(money,0.00)as NetAmt,CONVERT(varchar,'')as CONTRACTNO_NEW into #aa from tbl_NSEBSE_HEADER_yesHdfcbnk            
             
-- update a set a.CONTRACTNO_NEW=b.CONTRACTNO_NEW,a.NetAmt=b.netAmount from #aa a,            
--(select CONTRACTNO_NEW,sum(netAmount) netAmount,party_code,sauda_date from MSAjag.dbo.common_contract_data b with(nolock) group by            
--CONTRACTNO_NEW,party_code,sauda_date) b where a.sauda_date=b.sauda_date and b.SAUDA_DATE=@SDATE and a.party_code=b.party_code            
            
 select *,CONVERT(money,0.00)as NetAmt,CONVERT(varchar,'')as CONTRACTNO_NEW,CONVERT(money,0.00) as NETRAte,CONVERT(money,0.00) as             
  Brokerage into #aa from tbl_NSEBSE_HEADER_yesHdfcbnk -- where party_code='ZR1196R'             
       
 SELECT PARTY_CODE,SCRIP_CD,sauda_date,scrip_name,isin,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,            
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)            
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=             
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,            
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =             
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +            
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN             
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,            
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),            
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD)          
into #check  from [Anand].bsedb_ab.dbo.CMBILLVALAN S with(nolock) where --party_code='ZR1196R' and            
 sauda_date=@SDATE           
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,sauda_date,scrip_name,ISIN,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT        
      
      
alter table #check      
alter column MEMBERTYPE varchar(10)      
      
 insert into #check      
  SELECT PARTY_CODE,SCRIP_CD,sauda_date,scrip_name,isin,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,            
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)            
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=             
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,            
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =             
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +            
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN             
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,            
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),            
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD)            
FROM MSAJAG.dbo.CMBILLVALAN S with(nolock) where --party_code='ZR1196R' and            
 sauda_date=@SDATE           
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,sauda_date,scrip_name,ISIN,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT            
      
--#check where party_Code='ZR1672R' -- 4757610      
         
 select PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,isin,SCRIPNAME into #contract from MSAjag.dbo.common_contract_data with(nolock) where sauda_date=@SDATE --and party_code='zr1196r'             
       
 --insert into #contract       
 --select PARTY_CODE,SAUDA_DATE,CONTRACTNO,isin,SCRIPNAME from [Anand].bsedb_ab.dbo.contract_data with(nolock) where sauda_date=@SDATE      
      
 alter table #check add CONTRACTNO_NEW varchar(100)             
            
 update a set a.CONTRACTNO_NEW=b.CONTRACTNO_NEW from #check a,            
#contract b where a.PARTY_CODE=b.PARTY_CODE and a.sauda_date=b.SAUDA_DATE and a.isin=b.isin and            
 left(a.SCRIP_NAME,18)=left(b.SCRIPNAME,18)            
            
  select a.PARTY_CODE,a.SAUDA_DATE,a.SELL_BUY,a.CONTRACTNO,EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,NO_OF_TRANSACTIONS,            
 TOTALAMT,TYPE,nseSett_no2,nseBank,rbi_refno,CliPISNo,CliBnkAcc,cliBankBranch,angelAcc,c.CONTRACTNO_NEW            
,b.DPid1,b.cltdpID1,b.Short_Name,c.SCRIP_CD,c.EXCHANGE,c.ISIN,c.SCRIP_NAME,c.BUYDELIVERYCHRG+c.SELLDELIVERYCHRG as Brokearge,c.PTRADEDQTY+c.STRADEDQTY as Qty,c.PMARKETRATE+c.SMARKETRATE as Rate,            
c.BILLPAMT+c.BILLSAMT as ExactAmount,c.PNETRATE+c.SNETRATE as Weighted,case when PMARKETRATE<>0 and PTRADEDQTY<>0 then (c.PMARKETRATE*PTRADEDQTY) when SMARKETRATE<>0 and STRADEDQTY<>0 then (SMARKETRATE*STRADEDQTY) end as TotalMarketVal,c.SERVICE_TAX+c.TURN_TAX+c.SEBI_TAX+c.BROKER_CHRG as OtherCharges,            
 c.SETT_NO,c.INS_CHRG as nsestt into #final from #aa a join  #check c on a.party_code=c.party_code     and a.SETT_NO=C.Sett_no and             
 A.contractno=c.Contractno              
 left outer join [Intranet].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                     
                    
            
              
   truncate table tbl_NRILecYesHdfc_temp             
   select * into ##Header from tbl_NRILecYesHdfc_temp where 1=2            
     insert into ##Header(Fldcol,BankName)            
  select 'Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Bank''s Branch Name,Broker Name,Date of Receipt /payment,Demat Debit /Credit Date,Broker A/C No' as Fldcol,''            
            
   insert into tbl_NRILecYesHdfc_temp              
select distinct nseBank+','+Convert(varchar,SAUDA_DATE,103)+','+PARTY_CODE+','+DPid1 +','+cast(right(cltdpID1,8) as varchar) +','+Short_Name +','+Exchange +','+isnull(nseSett_no2,'') +','+                    
     CONVERT(VARCHAR,isnull(CONTRACTNO_NEW,''))+','+ltrim(rtrim(SCRIP_CD))+','+Ltrim(Rtrim(Isnull(ISIN,'')))+','+                    
     left(SCRIP_NAME,75)+','+CASE WHEN Sell_Buy = 1 THEN 'B'  WHEN Sell_Buy = 2 THEN 'S'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,sum(QTY)))) +','+ Convert(Varchar,avg(Weighted))+','+cast((CONVERT(DEC(15,2),avg(TotalMarketVal))) as varchar)            
  +','+  Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), avg(RATE))))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), sum(Brokearge)))))+','+                         
        CONVERT(VARCHAR,CONVERT(DEC(10,2),Isnull(sum(OtherCharges),0)))+','+                    
    -- cast(Ltrim(Rtrim(CONVERT(DEC(10,2),sum(TotalMarketVal+Brokearge+OtherCharges)))) as varchar)            
   CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),Case when Sell_Buy = 1 THEN sum((TotalMarketVal+Brokearge+OtherCharges)) else sum(TotalMarketVal-Brokearge-OtherCharges) end))            
  +','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(NseStt, 0))))+','+       
  CONVERT(VARCHAR,(CONVERT(DECIMAL(14, 2),(Case when Sell_Buy = 1 THEN sum(TotalMarketVal+Brokearge+OtherCharges)+Sum(Isnull(NseStt, 0)) else sum(TotalMarketVal-Brokearge-OtherCharges)-Sum(Isnull(NseStt, 0)) end)))) +','        
    -- CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),ABS(sum(ExactAmount))))+','            
  +isnull(rbi_refno,'')+','+isnull(CliPISNo,'')+','+isnull(CliBnkAcc,'')+','+case when nseBank like 'HDFC%' then 'Tulsiani' else cliBankBranch end+','+'Angel One Ltd'+','+               
  CASE WHEN Sell_Buy = 1 THEN  Convert(varchar,(sauda_date +1),103)  WHEN Sell_Buy = 2 THEN Convert(varchar,(sauda_date+2),103)  END+','+                    
      CASE WHEN Sell_Buy = 1 THEN  Convert(varchar,(sauda_date +1),103)  WHEN Sell_Buy = 2 THEN Convert(varchar,(sauda_date+2),103)  END +','+angelAcc,nseBank                    
     from #final group by  PARTY_CODE, SAUDA_DATE ,DPid1 ,right(cltdpID1,8) ,Short_Name ,                    
     CONVERT(VARCHAR, isnull(CONTRACTNO_NEW,'')) ,ISIN,                   
     SCRIP_NAME,SCRIP_CD,                    
     nseBank,rbi_refno,Sell_Buy,CliPISNo,              
  CliBnkAcc,cliBankBranch,angelAcc,Exchange,isnull(nseSett_no2,'')              
            
              
              
  declare @BCPCOMMAND1 as varchar(5000)               
     DECLARE @hdfcfilename2 as varchar(1000)              
     DECLARE @Yesfilename2 as varchar(1000)              
     declare @link as varchar(2000)=''                    
              
    if ((select count(1) from tbl_NRILecYesHdfc_temp where bankname like '%HDFC%')>0)                    
    Begin                    
    SET @hdfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\HDFC_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                     
    SET @BCPCOMMAND1 = 'BCP "select Fldcol from ##Header union all select FLDCOL from Inhouse.dbo.tbl_NRILecYesHdfc_temp where bankname like ''%HDFC%''" QUERYOUT "'                                                
    -- print(@BCPCOMMAND1)                                          
   SET @BCPCOMMAND1 = @BCPCOMMAND1 + @hdfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                   
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                     
  -- set @link=@link +'<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                    
  select '<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                    
   End              
              
  if ((select count(1) from tbl_NRILecYesHdfc_temp where bankname like '%YES%')>0)                    
      Begin                    
        SET @YESfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\YES_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                     
        SET @BCPCOMMAND1 = 'BCP "select Fldcol from ##Header union all select FLDCOL from Inhouse.dbo.tbl_NRILecYesHdfc_temp where bankname like ''%YES%''" QUERYOUT "'                                                
       -- print(@BCPCOMMAND1)                                          
       SET @BCPCOMMAND1 = @BCPCOMMAND1 + @YESfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                      
       EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                     
       --set @link=@link +'<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                        
        select '<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                    
      End              
 Drop table ##Header              
               
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Angel_nri_Data_lec_allfiles_UAT_BKP_09MAY2025
-- --------------------------------------------------

--use 196-- inhouse                                                    
--exec [usp_Angel_nri_Data_lec_allfiles_UAT] '25/01/2024',0                
             
CREATE proc [dbo].[usp_Angel_nri_Data_lec_allfiles_UAT_BKP_09MAY2025]              
(              
@SDATE  AS VARCHAR(11),                                                
@BANKID AS INT                                
)              
As              
Begin              
              
                       
  --insert into #output                    
  --Exec master.dbo.xp_cmdshell 'NET USE \\196.1.115.147\IPC$ /USER:Administrator Winw0rld@1604'                      
              
truncate table tbl_NSEBSE_HEADER_yesHdfcbnk              
truncate table tbl_NSEBSE_Details_yesHdfcbnk              
exec Angel_nri_data_lec_new_15may2023 @SDATE,1,@BANKID,'NSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,2,@BANKID,'NSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,1,@BANKID,'BSE'              
exec Angel_nri_data_lec_new_15may2023 @SDATE,2,@BANKID,'BSE'              
              
  SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103))          
        
  --declare @SDATE as varchar(11)=CONVERT(VARCHAR(11), CONVERT(DATETIME,'07/12/2023', 103))       
              
--  select *,CONVERT(money,0.00)as NetAmt,CONVERT(varchar,'')as CONTRACTNO_NEW into #aa from tbl_NSEBSE_HEADER_yesHdfcbnk            
             
-- update a set a.CONTRACTNO_NEW=b.CONTRACTNO_NEW,a.NetAmt=b.netAmount from #aa a,            
--(select CONTRACTNO_NEW,sum(netAmount) netAmount,party_code,sauda_date from MSAjag.dbo.common_contract_data b with(nolock) group by            
--CONTRACTNO_NEW,party_code,sauda_date) b where a.sauda_date=b.sauda_date and b.SAUDA_DATE=@SDATE and a.party_code=b.party_code            
            
 select *,CONVERT(money,0.00)as NetAmt,CONVERT(varchar,'')as CONTRACTNO_NEW,CONVERT(money,0.00) as NETRAte,CONVERT(money,0.00) as             
  Brokerage into #aa from tbl_NSEBSE_HEADER_yesHdfcbnk -- where party_code='ZR1196R'             
       
 SELECT PARTY_CODE,SCRIP_CD,sauda_date,scrip_name,isin,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,            
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)            
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=             
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,            
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =             
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +            
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN             
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,            
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),            
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD)          
into #check  from [Anand].bsedb_ab.dbo.CMBILLVALAN S with(nolock) where --party_code='ZR1196R' and            
 sauda_date=@SDATE           
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,sauda_date,scrip_name,ISIN,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT        
      
      
alter table #check      
alter column MEMBERTYPE varchar(10)      
      
 insert into #check      
  SELECT PARTY_CODE,SCRIP_CD,sauda_date,scrip_name,isin,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,            
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)            
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=             
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,            
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =             
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,            
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +            
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN             
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,            
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),            
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD)            
FROM MSAJAG.dbo.CMBILLVALAN S with(nolock) where --party_code='ZR1196R' and            
 sauda_date=@SDATE           
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,sauda_date,scrip_name,ISIN,CONTRACTNO,SETT_NO,EXCHANGE,            
SEGMENT            
      
--#check where party_Code='ZR1672R' -- 4757610      
         
 select PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,isin,SCRIPNAME into #contract from MSAjag.dbo.common_contract_data with(nolock) where sauda_date=@SDATE --and party_code='zr1196r'             
       
 --insert into #contract       
 --select PARTY_CODE,SAUDA_DATE,CONTRACTNO,isin,SCRIPNAME from [Anand].bsedb_ab.dbo.contract_data with(nolock) where sauda_date=@SDATE      
      
 alter table #check add CONTRACTNO_NEW varchar(100)             
            
 update a set a.CONTRACTNO_NEW=b.CONTRACTNO_NEW from #check a,            
#contract b where a.PARTY_CODE=b.PARTY_CODE and a.sauda_date=b.SAUDA_DATE and a.isin=b.isin and            
 left(a.SCRIP_NAME,18)=left(b.SCRIPNAME,18)            
            
  select a.PARTY_CODE,a.SAUDA_DATE,a.SELL_BUY,a.CONTRACTNO,EDUCESS,EXCHAGE_LEVIES,STT,STAMPDUTY,MINBROKERAGE,NO_OF_TRANSACTIONS,            
 TOTALAMT,TYPE,nseSett_no2,nseBank,rbi_refno,CliPISNo,CliBnkAcc,cliBankBranch,angelAcc,c.CONTRACTNO_NEW            
,b.DPid1,b.cltdpID1,b.Short_Name,c.SCRIP_CD,c.EXCHANGE,c.ISIN,c.SCRIP_NAME,c.BUYDELIVERYCHRG+c.SELLDELIVERYCHRG as Brokearge,c.PTRADEDQTY+c.STRADEDQTY as Qty,c.PMARKETRATE+c.SMARKETRATE as Rate,            
c.BILLPAMT+c.BILLSAMT as ExactAmount,c.PNETRATE+c.SNETRATE as Weighted,case when PMARKETRATE<>0 and PTRADEDQTY<>0 then (c.PMARKETRATE*PTRADEDQTY) when SMARKETRATE<>0 and STRADEDQTY<>0 then (SMARKETRATE*STRADEDQTY) end as TotalMarketVal,c.SERVICE_TAX+c.TURN_TAX+c.SEBI_TAX+c.BROKER_CHRG as OtherCharges,            
 c.SETT_NO,c.INS_CHRG as nsestt into #final from #aa a join  #check c on a.party_code=c.party_code     and a.SETT_NO=C.Sett_no and             
 A.contractno=c.Contractno              
 left outer join [Intranet].Risk.dbo.client_Details b with (nolock) on a.PARTY_CODE=b.party_code                     
                    
            
              
   truncate table tbl_NRILecYesHdfc_temp             
   select * into ##Header from tbl_NRILecYesHdfc_temp where 1=2            
     insert into ##Header(Fldcol,BankName)            
  select 'Bank Name,Trade Date,Trading ID,DP ID,Demat A/c No,Investor Name,Exchange,Settlement No,Contract No,Scrip Code,ISIN Number,Scrip Name,Buy/Sell,Quantity,Weighted Average Market Rate,Total Market Value,Net Rate,Brokerage Value,Other Charges,Net Purchase/Sale Value,STT on Buy & Sale,Exact amount paid by / to  the customer (for purchase/sale),RBI Approval No,PIS Account No,Saving Bank Account No,Bank''s Branch Name,Broker Name,Date of Receipt /payment,Demat Debit /Credit Date,Broker A/C No' as Fldcol,''            
            
   insert into tbl_NRILecYesHdfc_temp              
select distinct nseBank+','+Convert(varchar,SAUDA_DATE,103)+','+PARTY_CODE+','+DPid1 +','+cast(right(cltdpID1,8) as varchar) +','+Short_Name +','+Exchange +','+isnull(nseSett_no2,'') +','+                    
     CONVERT(VARCHAR,isnull(CONTRACTNO_NEW,''))+','+ltrim(rtrim(SCRIP_CD))+','+Ltrim(Rtrim(Isnull(ISIN,'')))+','+                    
     left(SCRIP_NAME,75)+','+CASE WHEN Sell_Buy = 1 THEN 'B'  WHEN Sell_Buy = 2 THEN 'S'  END +','+Ltrim(Rtrim(CONVERT(VARCHAR,sum(QTY)))) +','+ Convert(Varchar,avg(Weighted))+','+cast((CONVERT(DEC(15,2),avg(TotalMarketVal))) as varchar)            
  +','+  Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(15,2), avg(RATE))))) +','+Ltrim(Rtrim(CONVERT(VARCHAR,CONVERT(DEC(10,2), sum(Brokearge)))))+','+                         
        CONVERT(VARCHAR,CONVERT(DEC(10,2),Isnull(sum(OtherCharges),0)))+','+                    
    -- cast(Ltrim(Rtrim(CONVERT(DEC(10,2),sum(TotalMarketVal+Brokearge+OtherCharges)))) as varchar)            
   CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),Case when Sell_Buy = 1 THEN sum((TotalMarketVal+Brokearge+OtherCharges)) else sum(TotalMarketVal-Brokearge-OtherCharges) end))            
  +','+ CONVERT(VARCHAR,CONVERT(DECIMAL(14, 2),Sum(Isnull(NseStt, 0))))+','+       
  CONVERT(VARCHAR,(CONVERT(DECIMAL(14, 2),(Case when Sell_Buy = 1 THEN sum(TotalMarketVal+Brokearge+OtherCharges)+Sum(Isnull(NseStt, 0)) else sum(TotalMarketVal-Brokearge-OtherCharges)-Sum(Isnull(NseStt, 0)) end)))) +','        
    -- CONVERT(VARCHAR,CONVERT(DECIMAL(14,2),ABS(sum(ExactAmount))))+','            
  +isnull(rbi_refno,'')+','+isnull(CliPISNo,'')+','+isnull(CliBnkAcc,'')+','+case when nseBank like 'HDFC%' then 'Tulsiani' else cliBankBranch end+','+'Angel One Ltd'+','+               
  CASE WHEN Sell_Buy = 1 THEN  Convert(varchar,(sauda_date +1),103)  WHEN Sell_Buy = 2 THEN Convert(varchar,(sauda_date+2),103)  END+','+                    
      CASE WHEN Sell_Buy = 1 THEN  Convert(varchar,(sauda_date +1),103)  WHEN Sell_Buy = 2 THEN Convert(varchar,(sauda_date+2),103)  END +','+angelAcc,nseBank                    
     from #final group by  PARTY_CODE, SAUDA_DATE ,DPid1 ,right(cltdpID1,8) ,Short_Name ,                    
     CONVERT(VARCHAR, isnull(CONTRACTNO_NEW,'')) ,ISIN,                   
     SCRIP_NAME,SCRIP_CD,                    
     nseBank,rbi_refno,Sell_Buy,CliPISNo,              
  CliBnkAcc,cliBankBranch,angelAcc,Exchange,isnull(nseSett_no2,'')              
            
              
              
  declare @BCPCOMMAND1 as varchar(5000)               
     DECLARE @hdfcfilename2 as varchar(1000)              
     DECLARE @Yesfilename2 as varchar(1000)              
     declare @link as varchar(2000)=''                    
              
    if ((select count(1) from tbl_NRILecYesHdfc_temp where bankname like '%HDFC%')>0)                    
    Begin                    
    SET @hdfcfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\HDFC_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                     
    SET @BCPCOMMAND1 = 'BCP "select Fldcol from ##Header union all select FLDCOL from Inhouse.dbo.tbl_NRILecYesHdfc_temp where bankname like ''%HDFC%''" QUERYOUT "'                                                
    -- print(@BCPCOMMAND1)                                          
   SET @BCPCOMMAND1 = @BCPCOMMAND1 + @hdfcfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                   
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                     
  -- set @link=@link +'<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                    
  select '<a href='+replace(@hdfcfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC</a><br>'                    
   End              
              
  if ((select count(1) from tbl_NRILecYesHdfc_temp where bankname like '%YES%')>0)                    
      Begin                    
        SET @YESfilename2 = '\\INHOUSELIVEAPP1-FS.angelone.in\upload1\NRI_CLients\YES_'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                     
        SET @BCPCOMMAND1 = 'BCP "select Fldcol from ##Header union all select FLDCOL from Inhouse.dbo.tbl_NRILecYesHdfc_temp where bankname like ''%YES%''" QUERYOUT "'                                                
       -- print(@BCPCOMMAND1)                                          
       SET @BCPCOMMAND1 = @BCPCOMMAND1 + @YESfilename2 + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                      
       EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1                     
       --set @link=@link +'<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                        
        select '<a href='+replace(@YESfilename2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- Yes Bank</a><br>'                    
      End              
 Drop table ##Header              
               
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_B2C_DATA
-- --------------------------------------------------
    
---- // USE DUSTBIN   --- // ANAND1                    
---- // DESCRIPTION :- B2B / B2C DATA. CREATED BY HRISHI                    
                    
CREATE PROC [dbo].[USP_B2B_B2C_DATA]  
AS    
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                     
SET @PATH='J:\Backoffice\SL_AUTO\B2B_B2C\INPUT\B2B_B2C_CODE.CSV'                      
                 
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL                
    DROP TABLE #CODE    
CREATE TABLE #CODE (CLTCODE VARCHAR(50))      
                    
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''    
SET @SQL2=' WITH    
    (                      
           FIRSTROW = 1,                      
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                      
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                      
           TABLOCK                      
    )'                      
                    
SET @SQLFINAL= @SQL + @SQL2                      
PRINT @SQLFINAL                      
EXEC (@SQLFINAL)                    
    
--SELECT TOP 10 * FROM #CODE      
      
IF OBJECT_ID(N'DUSTBIN..TBL_B2B_B2C_DATA') IS NOT NULL                
DROP TABLE TBL_B2B_B2C_DATA      
  
SELECT V.*   
INTO TBL_B2B_B2C_DATA  
FROM MSAJAG..VW_BTB_BTC V INNER JOIN #CODE C ON V.CL_CODE=C.CLTCODE  
      
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_B2B_B2C_DATA        
      
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')      
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\B2B_B2C\OUTPUT\' +'B2B_B2C_DATA_' + @RPT_DATE + '.CSV'      
DECLARE @ALL VARCHAR(MAX)      
      
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CL_CODE'''',''''B2B_B2C'''''      
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_B2B_B2C_DATA'      
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.TBL_CALLING_DATA'      
PRINT @ALL      
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'      
PRINT @ALL      
EXEC(@ALL)      
                    
DROP TABLE #CODE      
DROP TABLE DUSTBIN.DBO.TBL_B2B_B2C_DATA      
                    
SELECT 'B2B / B2C DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BOTEAM
-- --------------------------------------------------

CREATE PROC USP_BOTEAM (@ID VARCHAR (20))  
AS  
BEGIN  
  
SELECT * FROM BOTEAM WHERE ID=@ID
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BUYBACK_LEC
-- --------------------------------------------------

/*
----.91 USE DUSTBIN / INHOUSE
CREATED BY :- HRISHI ON 24-10-2025
DESCREPTION:- BUYBACK LEC FOR ALL BANKS
*/

CREATE PROC [dbo].[USP_BUYBACK_LEC] ( @SDATE AS VARCHAR(11) )
AS
BEGIN

SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103))  
--DECLARE @SDATE AS VARCHAR(11)='AUG  8 2025'   --, @CODE VARCHAR (50)='ZR0050096R'

SELECT PARTY_CODE,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,                        
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,                        
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)                        
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=                         
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,                        
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                        
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =                         
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                        
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +                        
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN                         
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,                        
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),                        
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD),SERIES        
INTO #CMBILLVALAN_NSE  
FROM MSAJAG.DBO.CMBILLVALAN S WITH(NOLOCK)         
WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN (SELECT CL_CODE FROM MSAJAG.DBO.CLIENT1 WHERE CL_TYPE ='NRI') AND SETT_TYPE='BX' AND SUB_BROKER NOT IN ('NKAB')
--WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN ( @CODE )
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,SEGMENT,SERIES        
  
SELECT PARTY_CODE,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,                        
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,                        
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)                        

+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=                         
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,                        
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                        
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =                         
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                        
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +                        
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN                         
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,                        
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),                        
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD),SERIES        
INTO #CMBILLVALAN_BSE        
FROM ANGELBSECM.BSEDB_AB.DBO.CMBILLVALAN S WITH(NOLOCK)         
WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN (SELECT CL_CODE FROM MSAJAG.DBO.CLIENT1 WHERE CL_TYPE ='NRI') AND SETT_TYPE='OB' and SUB_BROKER NOT IN ('NKAB')
--WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN ( @CODE )
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,SEGMENT,SERIES 

--SELECT * FROM #CMBILLVALAN_NSE        
--SELECT * FROM #CMBILLVALAN_BSE WHERE PARTY_CODE IN ('ZR1577R','ZR1297R')

----> NSE START        
SELECT * INTO #MAIN_DATA_NSE FROM #CMBILLVALAN_NSE WHERE CONTRACTNO<>'0000000'              
SELECT * INTO #C_ZERO_NSE FROM #CMBILLVALAN_NSE WHERE CONTRACTNO='0000000'            
        
SELECT M.PARTY_CODE, M.SCRIP_CD,M.SAUDA_DATE,M.SCRIP_NAME,M.ISIN,M.CONTRACTNO,M.SETT_NO,M.SETT_TYPE,M.EXCHANGE,M.SEGMENT,M.LONG_NAME,(M.PTRADEDQTY+Z.PTRADEDQTY) AS PTRADEDQTY,        
(M.PTRADEDAMT+Z.PTRADEDAMT) AS PTRADEDAMT, (M.STRADEDQTY+Z.STRADEDQTY) AS STRADEDQTY, (M.STRADEDAMT+Z.STRADEDAMT) AS STRADEDAMT, (M.BUYBROKERAGE+Z.BUYBROKERAGE) AS BUYBROKERAGE,        
(M.SELBROKERAGE+Z.SELBROKERAGE) AS SELBROKERAGE,(M.BUYDELIVERYCHRG+Z.BUYDELIVERYCHRG) AS BUYDELIVERYCHRG,(M.SELLDELIVERYCHRG+Z.SELLDELIVERYCHRG) AS SELLDELIVERYCHRG,M.CLIENTTYPE,        
(M.BILLPAMT+Z.BILLPAMT) AS BILLPAMT,(M.BILLSAMT+Z.BILLSAMT) AS BILLSAMT,(M.PMARKETRATE+Z.PMARKETRATE) AS PMARKETRATE,(M.SMARKETRATE+Z.SMARKETRATE) AS SMARKETRATE,        
(M.PNETRATE+Z.PNETRATE) AS PNETRATE,(M.SNETRATE+Z.SNETRATE) AS SNETRATE,(M.TRDAMT+Z.TRDAMT) AS TRDAMT,(M.DELAMT+Z.DELAMT) AS DELAMT,(M.SERINEX+Z.SERINEX) AS SERINEX,        
(M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EXSERVICE_TAX+Z.EXSERVICE_TAX) AS EXSERVICE_TAX,(M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX,        
(M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG,(M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG,(M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG,M.MEMBERTYPE,M.COMPANYNAME, (M.PNL+Z.PNL) AS PNL,M.SERIES        
INTO #ACTUAL_CN_ZERO            
FROM #MAIN_DATA_NSE M INNER JOIN #C_ZERO_NSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD        
        
DELETE FROM #MAIN_DATA_NSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_NSE)            
        
INSERT INTO #MAIN_DATA_NSE            
SELECT * FROM #ACTUAL_CN_ZERO           
----> NSE END        
        
----> BSE START        
SELECT * INTO #MAIN_DATA_BSE FROM #CMBILLVALAN_BSE WHERE CONTRACTNO<>'0000000'              
SELECT * INTO #C_ZERO_BSE FROM #CMBILLVALAN_BSE WHERE CONTRACTNO='0000000'            
        
SELECT M.PARTY_CODE, M.SCRIP_CD,M.SAUDA_DATE,M.SCRIP_NAME,M.ISIN,M.CONTRACTNO,M.SETT_NO,M.SETT_TYPE,M.EXCHANGE,M.SEGMENT,M.LONG_NAME,(M.PTRADEDQTY+Z.PTRADEDQTY) AS PTRADEDQTY,        
(M.PTRADEDAMT+Z.PTRADEDAMT) AS PTRADEDAMT, (M.STRADEDQTY+Z.STRADEDQTY) AS STRADEDQTY, (M.STRADEDAMT+Z.STRADEDAMT) AS STRADEDAMT, (M.BUYBROKERAGE+Z.BUYBROKERAGE) AS BUYBROKERAGE,        
(M.SELBROKERAGE+Z.SELBROKERAGE) AS SELBROKERAGE,(M.BUYDELIVERYCHRG+Z.BUYDELIVERYCHRG) AS BUYDELIVERYCHRG,(M.SELLDELIVERYCHRG+Z.SELLDELIVERYCHRG) AS SELLDELIVERYCHRG,M.CLIENTTYPE,        
(M.BILLPAMT+Z.BILLPAMT) AS BILLPAMT,(M.BILLSAMT+Z.BILLSAMT) AS BILLSAMT,(M.PMARKETRATE+Z.PMARKETRATE) AS PMARKETRATE,(M.SMARKETRATE+Z.SMARKETRATE) AS SMARKETRATE,        
(M.PNETRATE+Z.PNETRATE) AS PNETRATE,(M.SNETRATE+Z.SNETRATE) AS SNETRATE,(M.TRDAMT+Z.TRDAMT) AS TRDAMT,(M.DELAMT+Z.DELAMT) AS DELAMT,(M.SERINEX+Z.SERINEX) AS SERINEX,        
(M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EXSERVICE_TAX+Z.EXSERVICE_TAX) AS EXSERVICE_TAX,(M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX,        
(M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG,(M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG,(M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG,M.MEMBERTYPE,M.COMPANYNAME, (M.PNL+Z.PNL) AS PNL,M.SERIES        
INTO #ACTUAL_CN_ZERO_BSE            
FROM #MAIN_DATA_BSE M INNER JOIN #C_ZERO_BSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD        
        
DELETE FROM #MAIN_DATA_BSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_BSE)        
        
INSERT INTO #MAIN_DATA_BSE        
SELECT * FROM #ACTUAL_CN_ZERO_BSE        
----> BSE END        

CREATE TABLE #MAIN_DATA             
(        
 PARTY_CODE VARCHAR (100),        
 SCRIP_CD VARCHAR (100),        
 SAUDA_DATE VARCHAR (11),        
 SCRIP_NAME VARCHAR (100),        
 ISIN VARCHAR (100),        
 CONTRACTNO VARCHAR (100),        
 SETT_NO VARCHAR (100),        
 SETT_TYPE VARCHAR (100),        
 EXCHANGE VARCHAR (100),        
 SEGMENT VARCHAR (100),        
 LONG_NAME VARCHAR (100),        
 PTRADEDQTY INT,        
 PTRADEDAMT MONEY,        
 STRADEDQTY INT,        
 STRADEDAMT MONEY,        
 BUYBROKERAGE MONEY,        
 SELBROKERAGE MONEY,        
 BUYDELIVERYCHRG MONEY,        
 SELLDELIVERYCHRG MONEY,        
 CLIENTTYPE VARCHAR (100),        
 BILLPAMT MONEY,        
 BILLSAMT MONEY,        
 PMARKETRATE MONEY,        
 SMARKETRATE MONEY,        
 PNETRATE MONEY,        
 SNETRATE MONEY,        
 TRDAMT MONEY,        
 DELAMT MONEY,        
 SERINEX MONEY,        
 SERVICE_TAX MONEY,        
 EXSERVICE_TAX MONEY,        
 TURN_TAX MONEY,        
 SEBI_TAX MONEY,        
 INS_CHRG MONEY,        
 BROKER_CHRG MONEY,        
 OTHER_CHRG MONEY,        
 MEMBERTYPE VARCHAR (100),        
 COMPANYNAME VARCHAR (100),        
 PNL MONEY,        
 SERIES VARCHAR (100)        
)        
        
INSERT INTO #MAIN_DATA            
SELECT * FROM #MAIN_DATA_NSE            
UNION ALL            
SELECT * FROM #MAIN_DATA_BSE            

SELECT *, CLIPISNO= CASE WHEN ( ISNULL(FLD_CLIENTPISAC,'0')='0') THEN FLD_NROPISNO  ELSE FLD_CLIENTPISAC END,            
CLIBNKACC= CASE WHEN (ISNULL(FLD_NREACNO,'0')='0') THEN FLD_NROACNO  ELSE FLD_NREACNO END
INTO #TBL_NRICLIENTMASTER             
FROM INTRANET.RISK.DBO.TBL_NRICLIENTMASTER WITH (NOLOCK)

SELECT * INTO #V_NriBank_Details FROM INTRANET.RISK.[dbo].[V_NriBank_Details]
SELECT * INTO #CLIENT_DETAILS FROM [INTRANET].RISK.DBO.CLIENT_DETAILS WHERE CL_TYPE='NRI'

SELECT PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,ISIN,SCRIPNAME,SUM(IPFT_CHRG) AS IPFT_CHRG INTO #CONTRACT    
FROM MSAJAG.DBO.COMMON_CONTRACT_DATA WITH(NOLOCK) WHERE SAUDA_DATE=@SDATE --AND PARTY_CODE IN ('ZR1703R')    
GROUP BY PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,ISIN,SCRIPNAME    

ALTER TABLE #MAIN_DATA ADD CONTRACTNO_NEW VARCHAR(100)    
ALTER TABLE #MAIN_DATA ADD IPFT MONEY
ALTER TABLE #MAIN_DATA ADD [BUY/SELL] VARCHAR (10)

UPDATE #MAIN_DATA SET [BUY/SELL]=CASE WHEN BILLPAMT<>'0.00' AND BILLSAMT='0.00' THEN 'B' ELSE 'S' END 
    
UPDATE A SET A.CONTRACTNO_NEW=B.CONTRACTNO_NEW, A.IPFT=B.IPFT_CHRG     
--SELECT A.PARTY_CODE,A.CONTRACTNO_NEW,B.CONTRACTNO_NEW, A.IPFT,B.IPFT_CHRG    
FROM #MAIN_DATA A, #CONTRACT B     
WHERE A.PARTY_CODE=B.PARTY_CODE AND A.SAUDA_DATE=B.SAUDA_DATE AND A.ISIN=B.ISIN     

------- HDFC AND YES BANK START

SELECT [BANK NAME]=V.FLD_BANKNAME,[TRADE DATE]=C.SAUDA_DATE, [TRADING ID]=C.PARTY_CODE, [DP ID]=SUBSTRING(N.FLD_DEMATACNO,1,8), [DEMAT A/C NO]=SUBSTRING(N.FLD_DEMATACNO,9,25),
[INVESTOR NAME]=B.SHORT_NAME, C.EXCHANGE, [SETTLEMENT NO]=C.SETT_NO, [CONTRACT NO]=C.CONTRACTNO_NEW, [SCRIP CODE]=C.SCRIP_CD, C.ISIN, C.SCRIP_NAME, [BUY/SELL], 
[QUANTITY]=C.PTRADEDQTY+C.STRADEDQTY, [WEIGHTED AVERAGE MARKET RATE]=ROUND(C.PNETRATE+C.SNETRATE,2),
[TOTAL MARKET VALUE]=ROUND (CASE WHEN PMARKETRATE<>0 AND PTRADEDQTY<>0 THEN (C.PMARKETRATE*PTRADEDQTY) WHEN SMARKETRATE<>0 AND STRADEDQTY<>0 THEN (SMARKETRATE*STRADEDQTY) END ,2),
[NET RATE]=ROUND (C.PMARKETRATE+C.SMARKETRATE ,2), BROKEARGE=ROUND(C.BUYDELIVERYCHRG+C.SELLDELIVERYCHRG, 2), [OTHER CHARGES]=ROUND(C.SERVICE_TAX+C.TURN_TAX+C.SEBI_TAX+C.BROKER_CHRG+C.IPFT, 2),
[NET PURCHASE/SALE VALUE]=ROUND((C.PMARKETRATE*PTRADEDQTY+C.BUYDELIVERYCHRG+C.SELLDELIVERYCHRG+C.SERVICE_TAX+C.TURN_TAX+C.SEBI_TAX+C.BROKER_CHRG+C.IPFT),2), 
[STT ON BUY & SALE]=C.INS_CHRG,
[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]= ROUND((C.PMARKETRATE*PTRADEDQTY+C.BUYDELIVERYCHRG+C.SELLDELIVERYCHRG+C.SERVICE_TAX+C.TURN_TAX+C.SEBI_TAX+C.BROKER_CHRG+C.IPFT+C.INS_CHRG),2),
[RBI APPROVAL NO]=ISNULL(N.RBI_REFNO,''),
[PIS ACCOUNT NO]=N.CLIPISNO, [SAVING BANK ACCOUNT NO]=N.CLIBNKACC, [BANK BRANCH NAME]=V.FLD_BRANCHLOCATION, [BROKER NAME]='ANGEL ONE LTD',
[DATE OF RECEIPT /PAYMENT]=CASE WHEN [BUY/SELL]= 'B' THEN CONVERT(VARCHAR,DATEADD(DAY, 1, SAUDA_DATE),103) WHEN [BUY/SELL]= 'S' THEN CONVERT(VARCHAR,DATEADD(DAY, 2, SAUDA_DATE),103) END,
[DEMAT DEBIT /CREDIT DATE]=CASE WHEN [BUY/SELL]= 'B' THEN CONVERT(VARCHAR,DATEADD(DAY, 1, SAUDA_DATE),103) WHEN [BUY/SELL]= 'S' THEN CONVERT(VARCHAR,DATEADD(DAY, 2, SAUDA_DATE),103) END,
[BROKER A/C NO]=V.Fld_BankPISAc
INTO #FINAL_HDFC_YES 
FROM #MAIN_DATA C LEFT JOIN #TBL_NRICLIENTMASTER N ON N.FLD_CLIENTCODE=C.PARTY_CODE LEFT JOIN #V_NRIBANK_DETAILS V ON V.FLD_CLIENTCODE=N.FLD_CLIENTCODE
LEFT OUTER JOIN #CLIENT_DETAILS B WITH (NOLOCK) ON C.PARTY_CODE=B.PARTY_CODE
--WHERE C.PARTY_CODE IN ('ZR1577R','ZR0050096R')

TRUNCATE TABLE DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_HDFC_YES

INSERT INTO DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_HDFC_YES
SELECT [BANK NAME], CONVERT(VARCHAR,[TRADE DATE],103) AS [TRADE DATE], CONVERT(VARCHAR,[TRADING ID]) AS [TRADING ID], CONVERT(VARCHAR,[DP ID]) AS [DP ID],
CONVERT(VARCHAR,[DEMAT A/C NO]) AS [DEMAT A/C NO], CONVERT(VARCHAR,[INVESTOR NAME]) AS [INVESTOR NAME], CONVERT(VARCHAR,[EXCHANGE]) AS [EXCHANGE], CONVERT(VARCHAR,[SETTLEMENT NO]) AS [SETTLEMENT NO],
CONVERT(VARCHAR,[CONTRACT NO]) AS [CONTRACT NO], CONVERT(VARCHAR,[SCRIP CODE]) AS [SCRIP CODE], CONVERT(VARCHAR,[ISIN]) AS [ISIN], CONVERT(VARCHAR,[SCRIP_NAME]) AS [SCRIP_NAME],
CONVERT(VARCHAR,[BUY/SELL]) AS [BUY/SELL], CONVERT(VARCHAR,[QUANTITY]) AS [QUANTITY], CONVERT(VARCHAR,[WEIGHTED AVERAGE MARKET RATE]) AS [WEIGHTED AVERAGE MARKET RATE],
CONVERT(VARCHAR,[TOTAL MARKET VALUE]) AS [TOTAL MARKET VALUE], CONVERT(VARCHAR,[NET RATE]) AS [NET RATE], CONVERT(VARCHAR,[BROKEARGE]) AS [BROKEARGE], 
CONVERT(VARCHAR,[OTHER CHARGES]) AS [OTHER CHARGES], CONVERT(VARCHAR,[NET PURCHASE/SALE VALUE]) AS [NET PURCHASE/SALE VALUE], CONVERT(VARCHAR,[STT ON BUY & SALE]) AS [STT ON BUY & SALE],
CONVERT(VARCHAR,[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]) AS [EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)],
CONVERT(VARCHAR,[RBI APPROVAL NO]) AS [RBI APPROVAL NO], CONVERT(VARCHAR,[PIS ACCOUNT NO]) AS [PIS ACCOUNT NO], CONVERT(VARCHAR,[SAVING BANK ACCOUNT NO]) AS [SAVING BANK ACCOUNT NO],
CONVERT(VARCHAR,[BANK BRANCH NAME]) AS [BANK BRANCH NAME], CONVERT(VARCHAR,[BROKER NAME]) AS [BROKER NAME], CONVERT(VARCHAR,[DATE OF RECEIPT /PAYMENT]) AS [DATE OF RECEIPT /PAYMENT],
CONVERT(VARCHAR,[DEMAT DEBIT /CREDIT DATE]) AS [DEMAT DEBIT /CREDIT DATE], CONVERT(VARCHAR,[BROKER A/C NO]) AS [BROKER A/C NO]
FROM #FINAL_HDFC_YES


IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_HDFC_YES where [BANK NAME] like '%hdfc%')>0)                          
 BEGIN          
  DECLARE @FILENAME1 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\HDFC_BUYBACK_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                       
  DECLARE @ALL1 VARCHAR(MAX)                                
                                
  SET @ALL1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''[BANK NAME]'''',''''[TRADE DATE]'''',''''[TRADING ID]'''',''''[DP ID]'''',''''[DEMAT A/C NO]'''',''''[INVESTOR NAME]'''',''''[EXCHANGE]'''',''''[SETTLEMENT NO]'''',''''[CONTRACT NO]'''',''''[SCRIP CODE]'''',''''[ISIN]'''',''''[SCRIP_NAME]'''',''''[BUY/SELL]'''',''''[QUANTITY]'''',''''[WEIGHTED AVERAGE MARKET RATE]'''',''''[TOTAL MARKET VALUE]'''',''''[NET RATE]'''',''''[BROKEARGE]'''',''''[OTHER CHARGES]'''',''''[NET PURCHASE/SALE VALUE]'''',''''[STT ON BUY & SALE]'''',''''[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]'''',''''[RBI APPROVAL NO]'''',''''[PIS ACCOUNT NO]'''',''''[SAVING BANK ACCOUNT NO]'''',''''[BANK BRANCH NAME]'''',''''[BROKER NAME]'''',''''[DATE OF RECEIPT /PAYMENT]'''',''''[DEMAT DEBIT /CREDIT DATE]'''',''''[BROKER A/C NO]'''''
  SET @ALL1 = @ALL1+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_HDFC_YES WHERE [BANK NAME] like ''''%hdfc%'''''                              
  --PRINT @ALL1                                
  SET @ALL1=@ALL1+' " QUERYOUT ' +@FILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                                
  PRINT @ALL1                                
  EXEC(@ALL1)          
  SELECT '<a href='+replace(@FILENAME1,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC Bank</a><br>'   
 END

 IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_HDFC_YES where [BANK NAME] like '%YES%')>0)                          
 BEGIN          
  DECLARE @FILENAME2 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\YES_BUYBACK_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                       
  DECLARE @ALL2 VARCHAR(MAX)                                
                                
  SET @ALL2 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''[BANK NAME]'''',''''[TRADE DATE]'''',''''[TRADING ID]'''',''''[DP ID]'''',''''[DEMAT A/C NO]'''',''''[INVESTOR NAME]'''',''''[EXCHANGE]'''',''''[SETTLEMENT NO]'''',''''[CONTRACT NO]'''',''''[SCRIP CODE]'''',''''[ISIN]'''',''''[SCRIP_NAME]'''',''''[BUY/SELL]'''',''''[QUANTITY]'''',''''[WEIGHTED AVERAGE MARKET RATE]'''',''''[TOTAL MARKET VALUE]'''',''''[NET RATE]'''',''''[BROKEARGE]'''',''''[OTHER CHARGES]'''',''''[NET PURCHASE/SALE VALUE]'''',''''[STT ON BUY & SALE]'''',''''[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]'''',''''[RBI APPROVAL NO]'''',''''[PIS ACCOUNT NO]'''',''''[SAVING BANK ACCOUNT NO]'''',''''[BANK BRANCH NAME]'''',''''[BROKER NAME]'''',''''[DATE OF RECEIPT /PAYMENT]'''',''''[DEMAT DEBIT /CREDIT DATE]'''',''''[BROKER A/C NO]'''''
  SET @ALL2 = @ALL2+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_HDFC_YES WHERE [BANK NAME] like ''''%YES%'''''                              
  --PRINT @ALL2
  SET @ALL2=@ALL2+' " QUERYOUT ' +@FILENAME2+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                                
  PRINT @ALL2                                
  EXEC(@ALL2)          
  SELECT '<a href='+replace(@FILENAME2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- YES Bank</a><br>'   
 END  
------- HDFC AND YES BANK END

------- KOTAK BANK START

SELECT N.CLIPISNO AS BANK_ACC_NO, SCHEME='OFFLINE', M.PARTY_CODE AS CLIENT_CODE, CLIENT_NAME =M.LONG_NAME, M.SAUDA_DATE AS TRADE_DATE,VALAN=M.SETT_TYPE+'/'+M.SETT_NO,        
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN 'B' ELSE 'S' END AS DEAL_TYPE, M.ISIN, M.SCRIP_NAME AS SCRIPNAME,      
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PTRADEDQTY ELSE STRADEDQTY END AS QUANTITY,        
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PNETRATE ELSE SNETRATE END AS GROSS_RATE,     
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN BUYDELIVERYCHRG ELSE SELLDELIVERYCHRG END AS BROKERAGE,        
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PMARKETRATE ELSE SMARKETRATE END AS NET_RATE,    
    --CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN BILLPAMT ELSE BILLSAMT END AS AMOUNT,    
--CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN (PMARKETRATE*PTRADEDQTY)+BUYDELIVERYCHRG+(SERVICE_TAX+TURN_TAX+SEBI_TAX+BROKER_CHRG+IPFT)     
--     ELSE (SMARKETRATE*STRADEDQTY)-SELLDELIVERYCHRG-(SERVICE_TAX+TURN_TAX+SEBI_TAX+BROKER_CHRG+IPFT) END AS AMOUNT,    
    
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN M.TRDAMT+BUYDELIVERYCHRG+(M.SERVICE_TAX+M.TURN_TAX+M.SEBI_TAX+M.BROKER_CHRG+M.IPFT)+INS_CHRG    
ELSE M.TRDAMT-SELLDELIVERYCHRG-(M.SERVICE_TAX+M.TURN_TAX+M.SEBI_TAX+M.BROKER_CHRG+M.IPFT)-INS_CHRG END AS AMOUNT,
INS_CHRG AS STT, TXN_TYPE='0', DP_ID=SUBSTRING(N.FLD_DEMATACNO,9,25),SHORT_GAIN='0', SHORT_LOSS='0', LONG_GAIN='0', LONG_LOSS='0', TDS='0', PMS_PRODUCT='0',      
M.CONTRACTNO_NEW AS CONTRACT_NUMBER, M.SERVICE_TAX, EDUCATION_CESS='0', EXCHANGE_LEVY='0', M.BROKER_CHRG AS STAMPDUTY, --M.OTHER_CHRG AS OTHER_CHARGES,       
(M.TURN_TAX+M.SEBI_TAX+M.IPFT) AS OTHER_CHARGES, -- ADDED ON 15 JUL 2025     
DEPOSITORY_ID=SUBSTRING(N.FLD_DEMATACNO,1,8), M.SETT_TYPE AS SETTLEMENT_TYPE, M.SETT_NO AS SETTLEMENT_NUMBER, SETTLEMENT_DATE=DATEADD(DAY,1,      
CONVERT(DATE,M.SAUDA_DATE)), SEBI_REG_NO1='CDSL REGISTERATION #', SEBI_SUB_CATEGORY=M.CLIENTTYPE, INSTRUMENT_SUB_TYPE=M.SERIES, PANNO='-', NON_PINS_ACCOUNT=N.CLIBNKACC        
INTO #FINAL_KOTAK        
FROM #MAIN_DATA M LEFT JOIN #TBL_NRICLIENTMASTER N ON M.PARTY_CODE = N.FLD_CLIENTCODE
WHERE Fld_BankId='102'  --FOR KOTAK CLIENTS ONLY

UPDATE #FINAL_KOTAK SET CLIENT_NAME=C.LONG_NAME FROM #FINAL_KOTAK F INNER JOIN #CLIENT_DETAILS C ON F.CLIENT_CODE=C.CL_CODE     

TRUNCATE TABLE DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_KOTAK

INSERT INTO DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_KOTAK
SELECT BANK_ACC_NO,SCHEME,CLIENT_CODE,CLIENT_NAME,TRADE_DATE,VALAN,DEAL_TYPE, ISIN, SCRIPNAME, CAST(QUANTITY AS VARCHAR (100)) AS QUANTITY, CAST(GROSS_RATE AS VARCHAR (100)) AS GROSS_RATE,          
CAST(BROKERAGE AS VARCHAR (100)) AS BROKERAGE, CAST(NET_RATE AS VARCHAR (100)) AS NET_RATE,CAST(AMOUNT AS VARCHAR (100)) AS AMOUNT, CAST(STT AS VARCHAR (100)) AS STT, TXN_TYPE,DP_ID,SHORT_GAIN,          
SHORT_LOSS,LONG_GAIN,LONG_LOSS,TDS,PMS_PRODUCT,CONTRACT_NUMBER,CAST(SERVICE_TAX AS VARCHAR (100)) AS SERVICE_TAX, EDUCATION_CESS,EXCHANGE_LEVY,CAST(STAMPDUTY AS VARCHAR (100)) AS STAMPDUTY,          
CAST(OTHER_CHARGES AS VARCHAR (100)) AS OTHER_CHARGES, DEPOSITORY_ID,SETTLEMENT_TYPE,SETTLEMENT_NUMBER,CAST(SETTLEMENT_DATE AS VARCHAR (100)) AS SETTLEMENT_DATE,SEBI_REG_NO1,          
SEBI_SUB_CATEGORY,INSTRUMENT_SUB_TYPE,PANNO,NON_PINS_ACCOUNT          
FROM #FINAL_KOTAK

IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_KOTAK)>0)                          
 BEGIN          
  DECLARE @FILENAME3 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\KOTAK_BUYBACK_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                       
  DECLARE @ALL3 VARCHAR(MAX)                                
                                
  SET @ALL3 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''BANK_ACC_NO'''',''''SCHEME'''',''''CLIENT_CODE'''',''''CLIENT_NAME'''',''''TRADE_DATE'''',''''VALAN'''',''''DEAL_TYPE'''',''''ISIN'''',''''SCRIPNAME'''',''''QUANTITY'''',''''GROSS_RATE'''',''''BROKERAGE'''',''''NET_RATE'''',''''AMOUNT'''',''''STT'''',''''TXN_TYPE'''',''''DP_ID'''',''''SHORT_GAIN'''',''''SHORT_LOSS'''',''''LONG_GAIN'''',''''LONG_LOSS'''',''''TDS'''',''''PMS_PRODUCT'''',''''CONTRACT_NUMBER'''',''''SERVICE_TAX'''',''''EDUCATION_CESS'''',''''EXCHANGE_LEVY'''',''''STAMPDUTY'''',''''OTHER_CHARGES'''',''''DEPOSITORY_ID'''',''''SETTLEMENT_TYPE'''',''''SETTLEMENT_NUMBER'''',''''SETTLEMENT_DATE'''',''''SEBI_REG_NO1'''',''''SEBI_SUB_CATEGORY'''',''''INSTRUMENT_SUB_TYPE'''',''''PANNO'''',''''NON_PINS_ACCOUNT'''''
  SET @ALL3 = @ALL3+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_NRI_BUYBACK_LEC_KOTAK'                              
  --PRINT @ALL3                                
  SET @ALL3=@ALL3+' " QUERYOUT ' +@FILENAME3+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                                
  PRINT @ALL3                                
  EXEC(@ALL3)          
  SELECT '<a href='+replace(@FILENAME3,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- KOTAK Bank</a><br>'   
 END

------- KOTAK BANK END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BUYBACK_TDS_UPLOAD
-- --------------------------------------------------

/*
DEVELOPED BY:- HRISHI ON 06-11-2025  ORE-4961
DESCRIPTION:- TO UPLOAD TDS FILE FOR BUYBACK LEC
*/


CREATE PROC [USP_BUYBACK_TDS_UPLOAD]  ( @FILENAME AS VARCHAR(50) )
AS

BEGIN

--DECLARE @FILENAME VARCHAR(50) ='TANLA_TDS.xls'

TRUNCATE TABLE TBL_TDS_UPLOAD_BUYBACK_LEC

DECLARE @FILEPATH VARCHAR(500)=''
SET @FILEPATH ='\\INHOUSELIVEAPP1-FS.ANGELONE.IN\D\UPLOAD1\NRIFiles\BUYBACK_LEC_TDS\'+@FILENAME+''

declare @sql nvarchar(4000) = 'bulk insert tbl_tds_upload_buyback_lec from ''' + @filepath + ''' with ( fieldterminator ='','', rowterminator =''\n'',firstrow=2 )';
PRINT @SQL
EXEC(@SQL)

SELECT 'FILE UPLOAD SUCCESSFULLY...'

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CALLING_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1              
---- // DESCRIPTION :- VISHAL J RAUT REQUIRED DP DATA. CREATED BY HRISHI              
              
CREATE PROC [dbo].[USP_CALLING_DATA]              
AS              
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)               
SET @PATH='J:\BACKOFFICE\SL_AUTO\PRADEEP\INPUT\CALLING_DATA.CSV'                
           
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL          
    DROP TABLE #CODE          
CREATE TABLE #CODE (CLTCODE VARCHAR(50))
              
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''              
SET @SQL2=' WITH                
    (                
           FIRSTROW = 1,                
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                
           TABLOCK                
    )'                
              
SET @SQLFINAL= @SQL + @SQL2                
PRINT @SQLFINAL                
EXEC (@SQLFINAL)              
              
--SELECT TOP 10 * FROM #CODE

IF OBJECT_ID(N'DUSTBIN..TBL_CALLING_DATA') IS NOT NULL          
DROP TABLE TBL_CALLING_DATA

SELECT CL_CODE,BRANCH_CD,EMAIL,LONG_NAME,MOBILE_PAGER,SUB_BROKER,(CASE WHEN B2C='Y'THEN 'B2C'ELSE 'B2B'END)AS B2B_B2C
INTO TBL_CALLING_DATA
FROM INTRANET.RISK.DBO.CLIENT_DETAILS CD INNER JOIN #CODE C ON CD.CL_CODE=C.CLTCODE          

--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_CALLING_DATA  

DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\PRADEEP\OUTPUT\' +'CALLING_DATA_' + @RPT_DATE + '.CSV'
DECLARE @ALL VARCHAR(MAX)

SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CL_CODE'''',''''BRANCH_CD'''',''''EMAIL'''',''''LONG_NAME'''',''''MOBILE_PAGER'''',''''SUB_BROKER'''',''''B2B_B2C'''''
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_CALLING_DATA'
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.TBL_CALLING_DATA'
PRINT @ALL
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'
PRINT @ALL
EXEC(@ALL)
              
--DROP TABLE #CODE
--DROP TABLE TBL_CALLING_DATA
              
SELECT 'CALLING DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CC01_FILESTATUS
-- --------------------------------------------------
  
-- // CREATE BY HIRSHI / AKSHAY ON 23-05-2023  
-- // DECREPTION FOR ALLOCATION CC01 FILE STATUS   
  
  
CREATE PROC [dbo].[USP_CC01_FILESTATUS] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))    
AS  
  
SELECT DISTINCT EXCHANGE,SEGMENT,COUNT(1) 'FILE RECORDS',SUM(ALLOCATECASH) 'SUM_ALLOCATECASH' FROM DUSTBIN.DBO.ALLOCATE_TEMP_NEW WHERE CONVERT(date,PROCESS_DT)=@RUNDATE  
 GROUP BY EXCHANGE,SEGMENT

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CCE_REPORT_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1                        
---- // DESCRIPTION :- SANDIP TOTE DATA. CREATED BY HRISHI                        
                        
CREATE PROC [dbo].[USP_CCE_REPORT_DATA]                        
AS          
          
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                         
SET @PATH='J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\INPUT\CCE_DATE.txt'                          
                     
 IF OBJECT_ID(N'tempdb..#DATE') IS NOT NULL                    
    DROP TABLE #DATE                    
CREATE TABLE #DATE (FDATE VARCHAR(50))                        
                        
SET @SQL='BULK INSERT  #DATE FROM ' + ''''+ @PATH +''''                        
SET @SQL2=' WITH                          
    (                          
           FIRSTROW = 1,                          
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                          
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                          
           TABLOCK                          
    )'                          
                        
SET @SQLFINAL= @SQL + @SQL2                          
PRINT @SQLFINAL                          
EXEC (@SQLFINAL)                        
                        
--SELECT TOP 10 * FROM #DATE
                    
 IF OBJECT_ID(N'tempdb..#DATA') IS NOT NULL                    
 DROP TABLE #DATA                    
          
DECLARE @FDATE VARCHAR(11),@TDATE VARCHAR(11),@MDATE VARCHAR(11)          
SELECT @MDATE=FDATE FROM #DATE          
--PRINT @MDATE          
          
SELECT @FDATE = MAX(MARGINDATE),@TDATE = MAX(MARGINDATE)           
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_PEAK_DETAIL A WITH (NOLOCK) WHERE  MARGINDATE <= @MDATE          
          
IF OBJECT_ID(N'tempdb..#MARGIN_PEAK') IS NOT NULL                    
DROP TABLE #MARGIN_PEAK          
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,TDAY_LEDGER = SUM(TDAY_LEDGER),TDAY_MARGIN = SUM(TDAY_MARGIN),TDAY_CASHCOLL = SUM(TDAY_CASHCOLL),          
TDAY_NONCASH = SUM(TDAY_NONCASH),TDAY_MTM = SUM(TDAY_MTM)                       
INTO #MARGIN_PEAK                              
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_PEAK_DETAIL A WITH (NOLOCK) WHERE  MARGINDATE BETWEEN @FDATE AND @TDATE + ' 23:59'                        
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE  ORDER BY MARGINDATE,A.PARTY_CODE                          
          
SET  @FDATE = @MDATE          
SET  @TDATE = @MDATE          
          
DELETE #MARGIN_PEAK WHERE PARTY_CODE IN ('12798','BBBB','ERROR')          
          
IF OBJECT_ID(N'tempdb..#EXCHANGE_CLINETS_DISTINCT_MAR_PEAK') IS NOT NULL          
DROP TABLE #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK          
SELECT DISTINCT PARTY_CODE AS CL_CODE INTO #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK FROM #MARGIN_PEAK WHERE (TDAY_MARGIN <> 0 OR TDAY_MTM <> 0 )          
          
CREATE INDEX CLIIDX ON #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK(CL_CODE)          
          
DELETE #MARGIN_PEAK WHERE PARTY_CODE NOT IN (SELECT CL_CODE FROM #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK)          
          
IF OBJECT_ID(N'tempdb..#MARGIN_FINAL_PEAK') IS NOT NULL          
DROP TABLE #MARGIN_FINAL_PEAK          
SELECT PARTY_CODE,SUM(TDAY_LEDGER) AS M_LEDGER_PEAK INTO #MARGIN_FINAL_PEAK FROM #MARGIN_PEAK GROUP BY PARTY_CODE          
          
IF OBJECT_ID(N'tempdb..#CCE_MAR') IS NOT NULL          
DROP TABLE #CCE_MAR          
SELECT REPORT_DATE,SNO INTO #CCE_MAR FROM ACCOUNT.DBO.CLIENT_CASH_DETAILS(NOLOCK) WHERE REPORT_DATE BETWEEN @FDATE AND @TDATE + ' 23:59'          
          
IF OBJECT_ID(N'tempdb..#CCERPT_MAR') IS NOT NULL                    
DROP TABLE #CCERPT_MAR          
SELECT REPORT_DATE,UCC=LTRIM(RTRIM(ISNULL(PARTY_CODE, ''))),            
EXCHANGE=CASE WHEN L.EXCHANGE='MTF' THEN 'MTF' ELSE 'BROKING' END,EDT_BAL=ROUND(L.EDT_BAL,2),PEAK_FINANCIAL_LEDGER          
INTO #CCERPT_MAR            
FROM #CCE_MAR C, ACCOUNT.DBO.CLIENT_CASH_LED_BALANCES L WITH (NOLOCK) WHERE C.SNO = L.SNO            
AND EXCHANGE <> 'MTF'            
          
DELETE FROM #CCERPT_MAR WHERE UCC='BBBB'          
          
IF OBJECT_ID(N'tempdb..#CASHREPORTING_MAR_PEAK') IS NOT NULL                    
DROP TABLE #CASHREPORTING_MAR_PEAK          
SELECT REPORT_DATE,UCC=LTRIM(RTRIM(ISNULL(UCC, ''))),EDT_BAL=SUM(EDT_BAL),          
PEAK_FINANCIAL_LEDGER = SUM(PEAK_FINANCIAL_LEDGER)          
INTO #CASHREPORTING_MAR_PEAK            
FROM #CCERPT_MAR , #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK WHERE UCC BETWEEN 'A' AND 'ZZZZZZZZZZZZZZZZZ9999'           
AND UCC = CL_CODE          
GROUP BY REPORT_DATE,UCC            
          
          
--------------------------------------------------------------------------------------------------------------------------------------                    
IF OBJECT_ID(N'DUSTBIN..TBL_MARGIN_PEAK') IS NOT NULL  -- PEAK MARGIN        
DROP TABLE TBL_MARGIN_PEAK      
      
SELECT EXCHANGE,SEGMENT,PARTY_CODE,CONVERT(VARCHAR,MARGINDATE,23) AS 'MARGINDATE',CONVERT(VARCHAR,TDAY_LEDGER) AS 'TDAY_LEDGER',CONVERT(VARCHAR,TDAY_MARGIN) AS 'TDAY_MARGIN',      
CONVERT(VARCHAR,TDAY_CASHCOLL) AS 'TDAY_CASHCOLL',CONVERT(VARCHAR,TDAY_NONCASH) AS 'TDAY_NONCASH',CONVERT(VARCHAR,TDAY_MTM) AS 'TDAY_MTM'       
INTO DUSTBIN.DBO.TBL_MARGIN_PEAK      
FROM #MARGIN_PEAK ORDER BY 3       
          
IF OBJECT_ID(N'DUSTBIN..TBL_CASHREPORTING_MAR_PEAK') IS NOT NULL  -- PEAK LED CCE      
DROP TABLE TBL_CASHREPORTING_MAR_PEAK      
      
SELECT CONVERT(VARCHAR,REPORT_DATE,23) AS 'REPORT_DATE',UCC,CONVERT(VARCHAR,EDT_BAL) AS 'EDT_BAL',CONVERT(VARCHAR,PEAK_FINANCIAL_LEDGER) AS 'PEAK_FINANCIAL_LEDGER'      
INTO DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK      
FROM #CASHREPORTING_MAR_PEAK ORDER BY 2      
          
IF OBJECT_ID(N'DUSTBIN..TBL_REC_PAY') IS NOT NULL                    
DROP TABLE TBL_REC_PAY          
;WITH CTE AS (          
SELECT CLTCODE,SUM(CASE WHEN VTYP = 2 THEN VAMT ELSE 0 END) AS REC,SUM(CASE WHEN VTYP = 3 THEN VAMT ELSE 0 END) AS PAY          
FROM ACCOUNT.DBO.LEDGER L WITH (NOLOCK),#CASHREPORTING_MAR_PEAK M WHERE L.CLTCODE = M.UCC AND VDT BETWEEN @FDATE AND @TDATE + ' 23:59:59'          
GROUP BY CLTCODE )      
      
SELECT CLTCODE,CONVERT(VARCHAR,REC) AS 'REC',CONVERT(VARCHAR,PAY) AS 'PAY' INTO DUSTBIN.DBO.TBL_REC_PAY FROM CTE  WHERE (REC <> 0 OR PAY <> 0) ORDER BY 1 -- REC AND PAYMENT      
------------------------------------------------------------------------------------------------------------------------------------          
      
--SELECT TOP 10 * FROM TBL_MARGIN_PEAK      
--SELECT TOP 10 * FROM TBL_CASHREPORTING_MAR_PEAK      
--SELECT TOP 10 * FROM TBL_REC_PAY      
      
DROP TABLE #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK          
DROP TABLE #CCERPT_MAR          
DROP TABLE #CASHREPORTING_MAR_PEAK          
DROP TABLE #CCE_MAR          
DROP TABLE #MARGIN_FINAL_PEAK          
DROP TABLE #MARGIN_PEAK       
          
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_MARGIN_PEAK          
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK          
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_REC_PAY          
            
------ // 1st FILE GENERATION      
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')          
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT\' +'CCE_MARGIN_PEAK_DATA' + '.CSV'      
DECLARE @ALL VARCHAR(MAX)      
          
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''EXCHANGE'''',''''SEGMENT'''',''''PARTY_CODE'''',''''MARGINDATE'''',''''TDAY_LEDGER'''',''''TDAY_MARGIN'''',''''TDAY_CASHCOLL'''',''''TDAY_NONCASH'''',''''TDAY_MTM'''''          
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_MARGIN_PEAK'                        
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.TBL_MARGIN_PEAK'               
--PRINT @ALL          
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL          
EXEC(@ALL)          
      
---- // 2nd FILE GENERATION      
DECLARE @FILENAME1 VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT\' +'CCE_CASHREPORTING_MAR_PEAK_DATA' + '.CSV'          
DECLARE @ALL1 VARCHAR(MAX)          
          
SET @ALL1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT_DATE'''',''''UCC'''',''''EDT_BAL'''',''''PEAK_FINANCIAL_LEDGER'''''          
SET @ALL1 = @ALL1+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK'                          
--PRINT @ALL1          
SET @ALL1=@ALL1+' " QUERYOUT ' +@FILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL1          
EXEC(@ALL1)          
      
------ // 3rd FILE GENERATION      
DECLARE @FILENAME2 VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT\' +'CCE_REC_PAY_DATA' + '.CSV'          
DECLARE @ALL2 VARCHAR(MAX)          
          
SET @ALL2 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CLTCODE'''',''''REC'''',''''PAY'''''      
SET @ALL2 = @ALL2+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_REC_PAY'                              
--PRINT @ALL2      
SET @ALL2=@ALL2+' " QUERYOUT ' +@FILENAME2+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL2          
EXEC(@ALL2)          
          
DROP TABLE DUSTBIN.DBO.TBL_MARGIN_PEAK          
DROP TABLE DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK          
DROP TABLE DUSTBIN.DBO.TBL_REC_PAY          
                        
SELECT 'CCE REPORTING FILES EXPORTED TO CCE REPORTING FILES EXPORTED TO J:\\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT FOLDER' AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CCE_REPORT_DATA_BKP_23APR2024
-- --------------------------------------------------

---- // USE DUSTBIN   --- // ANAND1                        
---- // DESCRIPTION :- SANDIP TOTE DATA. CREATED BY HRISHI                        
                        
CREATE PROC [dbo].[USP_CCE_REPORT_DATA_BKP_23APR2024]                        
AS          
          
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                         
SET @PATH='J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\INPUT\CCE_DATE.txt'                          
                     
 IF OBJECT_ID(N'tempdb..#DATE') IS NOT NULL                    
    DROP TABLE #DATE                    
CREATE TABLE #DATE (FDATE VARCHAR(50))                        
                        
SET @SQL='BULK INSERT  #DATE FROM ' + ''''+ @PATH +''''                        
SET @SQL2=' WITH                          
    (                          
           FIRSTROW = 1,                          
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                          
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                          
           TABLOCK                          
    )'                          
                        
SET @SQLFINAL= @SQL + @SQL2                          
PRINT @SQLFINAL                          
EXEC (@SQLFINAL)                        
                        
--SELECT TOP 10 * FROM #DATE
                    
 IF OBJECT_ID(N'tempdb..#DATA') IS NOT NULL                    
 DROP TABLE #DATA                    
          
DECLARE @FDATE VARCHAR(11),@TDATE VARCHAR(11),@MDATE VARCHAR(11)          
SELECT @MDATE=FDATE FROM #DATE          
--PRINT @MDATE          
          
SELECT @FDATE = MAX(MARGINDATE),@TDATE = MAX(MARGINDATE)           
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_PEAK_DETAIL A WITH (NOLOCK) WHERE  MARGINDATE <= @MDATE          
          
IF OBJECT_ID(N'tempdb..#MARGIN_PEAK') IS NOT NULL                    
DROP TABLE #MARGIN_PEAK          
SELECT A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE,TDAY_LEDGER = SUM(TDAY_LEDGER),TDAY_MARGIN = SUM(TDAY_MARGIN),TDAY_CASHCOLL = SUM(TDAY_CASHCOLL),          
TDAY_NONCASH = SUM(TDAY_NONCASH),TDAY_MTM = SUM(TDAY_MTM)                       
INTO #MARGIN_PEAK                              
FROM MSAJAG.DBO.TBL_COMBINE_REPORTING_PEAK_DETAIL A WITH (NOLOCK) WHERE  MARGINDATE BETWEEN @FDATE AND @TDATE + ' 23:59'                        
GROUP BY A.EXCHANGE,A.SEGMENT,A.PARTY_CODE,MARGINDATE  ORDER BY MARGINDATE,A.PARTY_CODE                          
          
SET  @FDATE = @MDATE          
SET  @TDATE = @MDATE          
          
DELETE #MARGIN_PEAK WHERE PARTY_CODE IN ('12798','BBBB','ERROR')          
          
IF OBJECT_ID(N'tempdb..#EXCHANGE_CLINETS_DISTINCT_MAR_PEAK') IS NOT NULL          
DROP TABLE #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK          
SELECT DISTINCT PARTY_CODE AS CL_CODE INTO #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK FROM #MARGIN_PEAK WHERE (TDAY_MARGIN <> 0 OR TDAY_MTM <> 0 )          
          
CREATE INDEX CLIIDX ON #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK(CL_CODE)          
          
DELETE #MARGIN_PEAK WHERE PARTY_CODE NOT IN (SELECT CL_CODE FROM #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK)          
          
IF OBJECT_ID(N'tempdb..#MARGIN_FINAL_PEAK') IS NOT NULL          
DROP TABLE #MARGIN_FINAL_PEAK          
SELECT PARTY_CODE,SUM(TDAY_LEDGER) AS M_LEDGER_PEAK INTO #MARGIN_FINAL_PEAK FROM #MARGIN_PEAK GROUP BY PARTY_CODE          
          
IF OBJECT_ID(N'tempdb..#CCE_MAR') IS NOT NULL          
DROP TABLE #CCE_MAR          
SELECT REPORT_DATE,SNO INTO #CCE_MAR FROM ACCOUNT.DBO.CLIENT_CASH_DETAILS(NOLOCK) WHERE REPORT_DATE BETWEEN @FDATE AND @TDATE + ' 23:59'          
          
IF OBJECT_ID(N'tempdb..#CCERPT_MAR') IS NOT NULL                    
DROP TABLE #CCERPT_MAR          
SELECT REPORT_DATE,UCC=LTRIM(RTRIM(ISNULL(PARTY_CODE, ''))),            
EXCHANGE=CASE WHEN L.EXCHANGE='MTF' THEN 'MTF' ELSE 'BROKING' END,EDT_BAL=ROUND(L.EDT_BAL,2),PEAK_FINANCIAL_LEDGER          
INTO #CCERPT_MAR            
FROM #CCE_MAR C, ACCOUNT.DBO.CLIENT_CASH_LED_BALANCES L WITH (NOLOCK) WHERE C.SNO = L.SNO            
AND EXCHANGE <> 'MTF'            
          
DELETE FROM #CCERPT_MAR WHERE UCC='BBBB'          
          
IF OBJECT_ID(N'tempdb..#CASHREPORTING_MAR_PEAK') IS NOT NULL                    
DROP TABLE #CASHREPORTING_MAR_PEAK          
SELECT REPORT_DATE,UCC=LTRIM(RTRIM(ISNULL(UCC, ''))),EDT_BAL=SUM(EDT_BAL),          
PEAK_FINANCIAL_LEDGER = SUM(PEAK_FINANCIAL_LEDGER)          
INTO #CASHREPORTING_MAR_PEAK            
FROM #CCERPT_MAR , #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK WHERE UCC BETWEEN 'A' AND 'ZZZZZZZZZZZZZZZZZ9999'           
AND UCC = CL_CODE          
GROUP BY REPORT_DATE,UCC            
          
          
--------------------------------------------------------------------------------------------------------------------------------------                    
IF OBJECT_ID(N'DUSTBIN..TBL_MARGIN_PEAK') IS NOT NULL  -- PEAK MARGIN        
DROP TABLE TBL_MARGIN_PEAK      
      
SELECT EXCHANGE,SEGMENT,PARTY_CODE,CONVERT(VARCHAR,MARGINDATE,23) AS 'MARGINDATE',CONVERT(VARCHAR,TDAY_LEDGER) AS 'TDAY_LEDGER',CONVERT(VARCHAR,TDAY_MARGIN) AS 'TDAY_MARGIN',      
CONVERT(VARCHAR,TDAY_CASHCOLL) AS 'TDAY_CASHCOLL',CONVERT(VARCHAR,TDAY_NONCASH) AS 'TDAY_NONCASH',CONVERT(VARCHAR,TDAY_MTM) AS 'TDAY_MTM'       
INTO DUSTBIN.DBO.TBL_MARGIN_PEAK      
FROM #MARGIN_PEAK ORDER BY 3       
          
IF OBJECT_ID(N'DUSTBIN..TBL_CASHREPORTING_MAR_PEAK') IS NOT NULL  -- PEAK LED CCE      
DROP TABLE TBL_CASHREPORTING_MAR_PEAK      
      
SELECT CONVERT(VARCHAR,REPORT_DATE,23) AS 'REPORT_DATE',UCC,CONVERT(VARCHAR,EDT_BAL) AS 'EDT_BAL',CONVERT(VARCHAR,PEAK_FINANCIAL_LEDGER) AS 'PEAK_FINANCIAL_LEDGER'      
INTO DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK      
FROM #CASHREPORTING_MAR_PEAK ORDER BY 2      
          
IF OBJECT_ID(N'DUSTBIN..TBL_REC_PAY') IS NOT NULL                    
DROP TABLE TBL_REC_PAY          
;WITH CTE AS (          
SELECT CLTCODE,SUM(CASE WHEN VTYP = 2 THEN VAMT ELSE 0 END) AS REC,SUM(CASE WHEN VTYP = 3 THEN VAMT ELSE 0 END) AS PAY          
FROM ACCOUNT.DBO.LEDGER L WITH (NOLOCK),#CASHREPORTING_MAR_PEAK M WHERE L.CLTCODE = M.UCC AND VDT BETWEEN @FDATE AND @TDATE + ' 23:59:59'          
GROUP BY CLTCODE )      
      
SELECT CLTCODE,CONVERT(VARCHAR,REC) AS 'REC',CONVERT(VARCHAR,PAY) AS 'PAY' INTO DUSTBIN.DBO.TBL_REC_PAY FROM CTE  WHERE (REC <> 0 OR PAY <> 0) ORDER BY 1 -- REC AND PAYMENT      
------------------------------------------------------------------------------------------------------------------------------------          
      
--SELECT TOP 10 * FROM TBL_MARGIN_PEAK      
--SELECT TOP 10 * FROM TBL_CASHREPORTING_MAR_PEAK      
--SELECT TOP 10 * FROM TBL_REC_PAY      
      
DROP TABLE #EXCHANGE_CLINETS_DISTINCT_MAR_PEAK          
DROP TABLE #CCERPT_MAR          
DROP TABLE #CASHREPORTING_MAR_PEAK          
DROP TABLE #CCE_MAR          
DROP TABLE #MARGIN_FINAL_PEAK          
DROP TABLE #MARGIN_PEAK       
          
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_MARGIN_PEAK          
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK          
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_REC_PAY          
            
------ // 1st FILE GENERATION      
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')          
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT\' +'CCE_MARGIN_PEAK_DATA' + '.CSV'      
DECLARE @ALL VARCHAR(MAX)      
          
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''EXCHANGE'''',''''SEGMENT'''',''''PARTY_CODE'''',''''MARGINDATE'''',''''TDAY_LEDGER'''',''''TDAY_MARGIN'''',''''TDAY_CASHCOLL'''',''''TDAY_NONCASH'''',''''TDAY_MTM'''''          
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_MARGIN_PEAK'                        
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.TBL_MARGIN_PEAK'               
--PRINT @ALL          
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL          
EXEC(@ALL)          
      
---- // 2nd FILE GENERATION      
DECLARE @FILENAME1 VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT\' +'CCE_CASHREPORTING_MAR_PEAK_DATA' + '.CSV'          
DECLARE @ALL1 VARCHAR(MAX)          
          
SET @ALL1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''REPORT_DATE'''',''''UCC'''',''''EDT_BAL'''',''''PEAK_FINANCIAL_LEDGER'''''          
SET @ALL1 = @ALL1+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK'                          
--PRINT @ALL1          
SET @ALL1=@ALL1+' " QUERYOUT ' +@FILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL1          
EXEC(@ALL1)          
      
------ // 3rd FILE GENERATION      
DECLARE @FILENAME2 VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT\' +'CCE_REC_PAY_DATA' + '.CSV'          
DECLARE @ALL2 VARCHAR(MAX)          
          
SET @ALL2 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CLTCODE'''',''''REC'''',''''PAY'''''      
SET @ALL2 = @ALL2+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_REC_PAY'                              
--PRINT @ALL2      
SET @ALL2=@ALL2+' " QUERYOUT ' +@FILENAME2+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL2          
EXEC(@ALL2)          
          
DROP TABLE DUSTBIN.DBO.TBL_MARGIN_PEAK          
DROP TABLE DUSTBIN.DBO.TBL_CASHREPORTING_MAR_PEAK          
DROP TABLE DUSTBIN.DBO.TBL_REC_PAY          
                        
SELECT 'CCE REPORTING FILES EXPORTED TO CCE REPORTING FILES EXPORTED TO J:\\Backoffice\SL_AUTO\SANDIP_T\CCE_PEAK_DATA\OUTPUT FOLDER' AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CCE_RUN
-- --------------------------------------------------
    
CREATE PROCEDURE USP_CCE_RUN @ACTION VARCHAR (50)
AS    
DECLARE @DATE VARCHAR(20) , @DATE1 VARCHAR(20) , @SQL VARCHAR (100) , @SQL1 VARCHAR (100) --,@ACTION VARCHAR (50)='T_DAY'  
BEGIN

IF @ACTION='T_DAY'
BEGIN
SELECT @DATE=SUBSTRING(CONVERT(VARCHAR, GETDATE(), 100), 1, 11)    
PRINT @DATE 
  
DECLARE @BODYCONTENT VARCHAR(MAX),@SUB VARCHAR(500), @XML NVARCHAR(MAX)   
SET @SUB = 'CCE PROCESS STATUS MAIL - '+ CONVERT(VARCHAR(11),GETDATE(),105)    
  
SET @BODYCONTENT ='<P>Dear All,</P>    
<H3><P>CCE PROCESS JOB STATUS</P></H3>    
<HTML><BODY>    
<TABLE BORDER = 1>    
<TR>    
<TH style="background-color:#00de54;"> CCE PROCESS STARTED FOR '+@DATE+' </TH>    
</TR>    
</TABLE>    
</BODY></HTML>    
<br>    
<P>Regards,</P>    
<P>BO SUPPORT TEAM,</P>'

SET @BODYCONTENT = @BODYCONTENT +'</TABLE></BODY></HTML>'    
    
PRINT @BODYCONTENT            
          
EXEC MSDB.DBO.SP_SEND_DBMAIL                         
@PROFILE_NAME='BO SUPPORT',                         
@RECIPIENTS='HRISHIKESH.YERUNKAR@ANGELBROKING.COM',    
@COPY_RECIPIENTS ='',              
@BLIND_COPY_RECIPIENTS='HRISHIKESH.YERUNKAR@ANGELBROKING.COM',                        
@SUBJECT=@SUB,                        
@BODY=@BODYCONTENT,                        
@IMPORTANCE = 'HIGH',                        
@BODY_FORMAT ='HTML'   
    
SET @SQL='EXEC ACCOUNT.DBO.GET_AUDIT_DATA_NEW_CURRENT '''+@DATE+''', ''0000'', ''ZZZZZZ'''    
PRINT @SQL    

END
----EXEC (@SQL)    

IF @ACTION='P_DAY'
BEGIN

SELECT @DATE1=SUBSTRING(CONVERT(VARCHAR, GETDATE()-1, 100), 1, 11)    
PRINT @DATE1
  
DECLARE @BODYCONTENT1 VARCHAR(MAX),@SUB1 VARCHAR(500), @XML1 NVARCHAR(MAX)    
SET @SUB1 = 'CCE PROCESS STATUS MAIL - '+ CONVERT(VARCHAR(11),GETDATE(),105)    
  
SET @BODYCONTENT1 ='<P>Dear All,</P>    
<H3><P>CCE PROCESS JOB STATUS</P></H3>    
<HTML><BODY>    
<TABLE BORDER = 1>    
<TR>    
<TH style="background-color:#00de54;"> CCE PROCESS STARTED FOR '+@DATE1+' </TH>    
</TR>    
</TABLE>    
</BODY></HTML>    
<br>    
<P>Regards,</P>    
<P>BO SUPPORT TEAM,</P>'        
    
SET @BODYCONTENT1 = @BODYCONTENT1 +'</TABLE></BODY></HTML>'    
    
PRINT @BODYCONTENT1            
          
EXEC MSDB.DBO.SP_SEND_DBMAIL                         
@PROFILE_NAME='BO SUPPORT',                         
@RECIPIENTS='HRISHIKESH.YERUNKAR@ANGELBROKING.COM',    
@COPY_RECIPIENTS ='',              
@BLIND_COPY_RECIPIENTS='HRISHIKESH.YERUNKAR@ANGELBROKING.COM',                        
@SUBJECT=@SUB1,                        
@BODY=@BODYCONTENT1,                        
@IMPORTANCE = 'HIGH',                        
@BODY_FORMAT ='HTML'
    
SET @SQL1='EXEC ACCOUNT.DBO.GET_AUDIT_DATA_NEW_CURRENT '''+@DATE1+''', ''0000'', ''ZZZZZZ'''    
PRINT @SQL1    
    
----EXEC (@SQL1)    
    
END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CLIENT_COLL_ALLOCATE
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANGELNSECM                        
---- // DESCRIPTION :- BHAGYASHREE PRADHAN REQUIREMENT. CREATED BY HRISHI                        
-- EXEC [USP_CLIENT_COLL_ALLOCATE]  
        
CREATE PROC [dbo].[USP_CLIENT_COLL_ALLOCATE] (@DATE DATE)

--DECLARE @DATE DATE='MAY 16 2024'
AS  

SELECT CONVERT(DATE,PROCESS_DT) AS PROCESS_DT,PARTY_CODE,SEGMENT_INDICATOR,REPLD_NONCASH,CLIENTCOLLNONCASH ,PROCASH FROM MSAJAG.DBO.TBL_CLIENT_COLL_ALLOCATE WITH (NOLOCK)
WHERE PROCESS_DT = @DATE
AND (REPLD_NONCASH <> 0 OR CLIENTCOLLNONCASH <> 0 ) AND PARTY_CODE <> ''
ORDER BY PROCESS_DT,PARTY_CODE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DEFAULTID_DATA_RPT
-- --------------------------------------------------
              
---- // USE DUSTBIN   --- // 196.1.115.196                              
---- // DESCRIPTION :- MTF PLEDGE DATA REQUESTED BY SWAPNIL TADGE AND CREATED BY HRISHI        
                              
CREATE PROC [dbo].[USP_DEFAULTID_DATA_RPT]  
AS  
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                               
SET @PATH='J:\Backoffice\SL_AUTO\SWAPNIL_T\DEFAULT_ID_DATA\INPUT\INPUT.txt'                                
  
IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL    
DROP TABLE #CODE  
  
CREATE TABLE #CODE (CODE VARCHAR(100))  
  
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''              
SET @SQL2=' WITH              
    (                                
           FIRSTROW = 1,                                
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                                
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                                
           TABLOCK                                
    )'                                
  
SET @SQLFINAL= @SQL + @SQL2                                
PRINT @SQLFINAL                                
EXEC (@SQLFINAL)                              
              
--SELECT TOP 10 * FROM #CODE
--SELECT TOP 10 * FROM #DATA  
  
IF OBJECT_ID(N'tempdb..#SSIS_DEFAULT') IS NOT NULL  
DROP TABLE #SSIS_DEFAULT  
  
CREATE TABLE #SSIS_DEFAULT (EXCHANGE VARCHAR (10),CL_CODE VARCHAR (10),PARTY_CODE VARCHAR (10),Instru INT,BankID VARCHAR (8),Cltdpid VARCHAR (20),Depository VARCHAR (7),DefDp INT)  
  
INSERT INTO #SSIS_DEFAULT  
SELECT 'NSE'AS EXCHANGE,* FROM [ANGELDEMAT].MSAJAG.DBO.CLIENT4 WHERE DefDp='1'AND Depository IN ('CDSL','NSDL')    
AND Cl_code IN (SELECT * FROM #CODE WHERE code IS NOT NULL )    
UNION ALL    
SELECT 'BSE'AS EXCHANGE,* FROM [ANGELDEMAT].BSEDB.DBO.CLIENT4 WHERE DefDp='1'AND Depository IN ('CDSL','NSDL')    
AND Cl_code IN (SELECT * FROM #CODE WHERE code IS NOT NULL)  
  
IF OBJECT_ID(N'DUSTBIN..TBL_DEFAULTID_DATA') IS NOT NULL                          
DROP TABLE TBL_DEFAULTID_DATA  
  
SELECT DISTINCT A.EXCHANGE,A.CL_CODE,A.PARTY_CODE,CONVERT(VARCHAR,A.INSTRU) AS INSTRU,A.BANKID,A.CLTDPID,A.DEPOSITORY,CONVERT(VARCHAR,A.DEFDP) AS DEFDP  
,CLIENT_CODE,FIRST_HOLD_NAME,STATUS AS DP_STATUS,CONVERT(VARCHAR (11),ACTIVE_DATE) AS DP_ACTIVE_DATE,POA_VER  
INTO DUSTBIN.DBO.TBL_DEFAULTID_DATA  
FROM #SSIS_DEFAULT A  LEFT OUTER JOIN  [AGMUBODPL3].DMAT.CITRUS_USR.TBL_CLIENT_MASTER B ON A.CLTDPID=B.CLIENT_CODE     
  
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_DEFAULTID_DATA  
                
--DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')  
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SWAPNIL_T\DEFAULT_ID_DATA\OUTPUT\' +'DEFAULT_ID_DATA' + '.CSV'  
DECLARE @ALL VARCHAR(MAX)    
    
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''EXCHANGE'''',''''CL_CODE'''',''''PARTY_CODE'''',''''Instru'''',''''BankID'''',''''Cltdpid'''',''''Depository'''',''''DefDp'''',''''CLIENT_CODE'''',''''FIRST_HOLD_NAME'''',''''DP_STATUS'''',''''DP_ACTIVE_dATE'''',''''POA_VER'''''    
    
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_DEFAULTID_DATA'               
PRINT @ALL                
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'    
PRINT @ALL                
EXEC(@ALL)    
  
DROP TABLE #CODE  
DROP TABLE #SSIS_DEFAULT  
DROP TABLE DUSTBIN.DBO.TBL_DEFAULTID_DATA  
                              
SELECT 'DEFAULT ID DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DP_FREEZE_DATA
-- --------------------------------------------------
        
---- // USE DUSTBIN   --- // ANAND1                        
---- // DESCRIPTION :- DP FREEZED DATA. CREATED BY HRISHI  
                        
CREATE PROC [dbo].[USP_DP_FREEZE_DATA]      
AS        
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                         
SET @PATH='J:\Backoffice\SL_AUTO\SANJAY_M\DP_FREEZE_DATA\INPUT\CODE.CSV'                          
                     
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL                    
    DROP TABLE #CODE        
CREATE TABLE #CODE (CODE VARCHAR(50))          
                        
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''        
SET @SQL2=' WITH        
    (                          
           FIRSTROW = 1,                          
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                          
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                          
           TABLOCK                          
    )'                          
                        
SET @SQLFINAL= @SQL + @SQL2                          
PRINT @SQLFINAL                          
EXEC (@SQLFINAL)                        
        
--SELECT TOP 10 * FROM #CODE          
--SELECT TOP 10 * FROM #DATA      
  
  
 IF OBJECT_ID(N'tempdb..#DATA') IS NOT NULL                    
DROP TABLE #DATA    
CREATE TABLE #DATA (DPAM_BBO_CODE VARCHAR(100) , ANGEL_DP_ID VARCHAR(100) , FREEZEID VARCHAR(100) ,FREEZERMKS VARCHAR(100))    
  
INSERT INTO #DATA  
SELECT DPAM.DPAM_BBO_CODE,DPAM.DPAM_SBA_NO AS ANGEL_DP_ID ,DPS8_PC4.FREEZEID,DPS8_PC4.FREEZERMKS   
FROM AngelDP5.DMAT.CITRUS_USR.DP_ACCT_MSTR DPAM   
INNER JOIN AngelDP5.DMAT.CITRUS_USR.DPS8_PC4 DPS8_PC4 ON DPS8_PC4.BOID = DPAM.DPAM_SBA_NO  
INNER JOIN #CODE T ON DPAM.DPAM_BBO_CODE=T.CODE  
UNION ALL  
SELECT DPAM.DPAM_BBO_CODE,DPAM.DPAM_SBA_NO AS ANGEL_DP_ID,DPS8_PC4.FREEZEID,DPS8_PC4.FREEZERMKS  
FROM AGMUBODPL3.DMAT.CITRUS_USR.DP_ACCT_MSTR DPAM   
INNER JOIN AGMUBODPL3.DMAT.CITRUS_USR.DPS8_PC4 DPS8_PC4 ON DPS8_PC4.BOID = DPAM.DPAM_SBA_NO  
INNER JOIN #CODE T ON DPAM.DPAM_BBO_CODE=T.CODE  
UNION ALL  
SELECT DPAM.DPAM_BBO_CODE,DPAM.DPAM_SBA_NO AS ANGEL_DP_ID,DPS8_PC4.FREEZEID,DPS8_PC4.FREEZERMKS   
FROM ATMUMBODPL03.DMAT.CITRUS_USR.DP_ACCT_MSTR DPAM   
INNER JOIN ATMUMBODPL03.DMAT.CITRUS_USR.DPS8_PC4 DPS8_PC4 ON DPS8_PC4.BOID = DPAM.DPAM_SBA_NO  
INNER JOIN #CODE T ON DPAM.DPAM_BBO_CODE=T.CODE  
UNION ALL  
SELECT DPAM.DPAM_BBO_CODE,DPAM.DPAM_SBA_NO AS ANGEL_DP_ID,DPS8_PC4.FREEZEID,DPS8_PC4.FREEZERMKS   
FROM AngelDP5.DMAT.CITRUS_USR.DP_ACCT_MSTR DPAM   
INNER JOIN AngelDP5.DMAT.CITRUS_USR.DPS8_PC4 DPS8_PC4 ON DPS8_PC4.BOID = DPAM.DPAM_SBA_NO  
INNER JOIN #CODE T ON DPAM.DPAM_SBA_NO=T.CODE  
UNION ALL  
SELECT DPAM.DPAM_BBO_CODE,DPAM.DPAM_SBA_NO AS ANGEL_DP_ID,DPS8_PC4.FREEZEID,DPS8_PC4.FREEZERMKS   
FROM AGMUBODPL3.DMAT.CITRUS_USR.DP_ACCT_MSTR DPAM   
INNER JOIN AGMUBODPL3.DMAT.CITRUS_USR.DPS8_PC4 DPS8_PC4 ON DPS8_PC4.BOID = DPAM.DPAM_SBA_NO  
INNER JOIN #CODE T ON DPAM.DPAM_SBA_NO=T.CODE  
UNION ALL  
SELECT DPAM.DPAM_BBO_CODE,DPAM.DPAM_SBA_NO AS ANGEL_DP_ID,DPS8_PC4.FREEZEID,DPS8_PC4.FREEZERMKS   
FROM ATMUMBODPL03.DMAT.CITRUS_USR.DP_ACCT_MSTR DPAM   
INNER JOIN ATMUMBODPL03.DMAT.CITRUS_USR.DPS8_PC4 DPS8_PC4 ON DPS8_PC4.BOID = DPAM.DPAM_SBA_NO  
INNER JOIN #CODE T ON DPAM.DPAM_SBA_NO=T.CODE  
  
IF OBJECT_ID(N'DUSTBIN..TBL_DPFREEZE_DATA') IS NOT NULL                    
DROP TABLE TBL_DPFREEZE_DATA  
  
SELECT T.ANGEL_DP_ID,T.FREEZEID,T.FREEZERMKS,B.CL_CODE, CONVERT(VARCHAR,ACTIVE_DATE,21) AS 'ACTIVE_DATE', CONVERT(VARCHAR,INACTIVE_FROM,21) AS 'INACTIVE_FROM', B.EXCHANGE, B.SEGMENT,  
(CASE WHEN B.INACTIVE_FROM LIKE '%2049%' THEN 'ACTIVE' ELSE 'INACTIVE' END) AS STATUS ,  
(CASE WHEN  B.Deactive_value='I' THEN 'INACTIVE' +' ('+B.Deactive_value + ')'  
   WHEN B.Deactive_value='D' THEN 'DORMANT'  +' ('+B.Deactive_value + ')'  
   WHEN B.Deactive_value='R' THEN 'REACIVATION'  +' ('+B.Deactive_value + ')'  
   WHEN B.Deactive_value='C' THEN 'AS PER CLOSURE REQ'  +' ('+B.Deactive_value + ')'  
   ELSE B.Deactive_value END) AS 'ACTIVE/INACTIVE_STATUS'  
INTO TBL_DPFREEZE_DATA  
FROM ANGELNSECM.MSAJAG.DBO.CLIENT_BROK_DETAILS B INNER JOIN #DATA T ON T.DPAM_BBO_CODE=B.CL_CODE  
  
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_DPFREEZE_DATA            
          
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')          
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SANJAY_M\DP_FREEZE_DATA\OUTPUT\' +'DP_FREEZED_DATA_' + @RPT_DATE + '.CSV'          
DECLARE @ALL VARCHAR(MAX)          
          
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''ANGEL_DP_ID'''',''''FREEZEID'''',''''FREEZERMKS'''',''''CL_CODE'''',''''ACTIVE_DATE'''',''''INACTIVE_FROM'''',''''EXCHANGE'''',''''SEGMENT'''',''''STATUS'''',''''ACTIVE/INACTIVE_STATUS'''''        
  
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_DPFREEZE_DATA'         
PRINT @ALL          
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'          
PRINT @ALL          
EXEC(@ALL)          
                        
DROP TABLE #CODE          
DROP TABLE #DATA         
DROP TABLE DUSTBIN.DBO.TBL_DPFREEZE_DATA          
                        
SELECT 'DP FREEZED DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DP_IPO_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1	              
---- // DESCRIPTION :- VISHAL J RAUT REQUIRED DP DATA. CREATED BY HRISHI              
              
CREATE PROC [dbo].[USP_DP_IPO_DATA]              
AS              
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)               
SET @PATH='J:\BACKOFFICE\SL_AUTO\VISHAL\DP_IPO_DATA\INPUT\DP_ID.CSV'                
           
 IF OBJECT_ID(N'tempdb..#DP_ID') IS NOT NULL          
    DROP TABLE #DP_ID          
CREATE TABLE #DP_ID (CLTCODE VARCHAR(50))              
              
SET @SQL='BULK INSERT  #DP_ID FROM ' + ''''+ @PATH +''''              
SET @SQL2=' WITH                
    (                
           FIRSTROW = 1,                
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                
           TABLOCK                
    )'                
              
SET @SQLFINAL= @SQL + @SQL2                
PRINT @SQLFINAL                
EXEC (@SQLFINAL)              
              
--SELECT TOP 10 * FROM #DP_ID      
--SELECT TOP 10 * FROM #DATA      
          
 IF OBJECT_ID(N'tempdb..#DATA') IS NOT NULL          
 DROP TABLE #DATA          

SELECT DEMAT_CODE=CLIENT_CODE,TRADING_CODE=NISE_PARTY_CODE,                  
BRANCH_CODE=CONVERT(VARCHAR(50),''),SUB_BROKER=CONVERT(VARCHAR(50),''),REGION=CONVERT(VARCHAR(50),''),BTB_BTC=CONVERT(VARCHAR(10),'')                 
INTO #DATA                  
FROM AngelDP4.DMAT.CITRUS_USR.TBL_CLIENT_MASTER WITH (NOLOCK)  , #DP_ID WHERE CLIENT_CODE = CLTCODE

--SELECT DEMAT_CODE=CLIENT_CODE,TRADING_CODE=NISE_PARTY_CODE,                ---------// COMMENTED ON 21 JUN 2024 --- Vishal EMAIL ORE-3767
--BRANCH_CODE=CONVERT(VARCHAR(50),''),SUB_BROKER=CONVERT(VARCHAR(50),''),REGION=CONVERT(VARCHAR(50),''),BTB_BTC=CONVERT(VARCHAR(10),'')               
--INTO #DATA                
--FROM AGMUBODPL3.DMAT.CITRUS_USR.TBL_CLIENT_MASTER WITH (NOLOCK)  , #DP_ID WHERE CLIENT_CODE = CLTCODE              
              
--INSERT INTO #DATA
--SELECT DEMAT_CODE=CLIENT_CODE,TRADING_CODE=NISE_PARTY_CODE,                
--BRANCH_CODE=CONVERT(VARCHAR(50),''),SUB_BROKER=CONVERT(VARCHAR(50),''),REGION=CONVERT(VARCHAR(50),''),BTB_BTC=CONVERT(VARCHAR(10),'')              
--FROM AngelDP5.DMAT.CITRUS_USR.TBL_CLIENT_MASTER WITH (NOLOCK)  , #DP_ID WHERE CLIENT_CODE = CLTCODE               
              
--INSERT INTO #DATA              
--SELECT DEMAT_CODE=CLIENT_CODE,TRADING_CODE=NISE_PARTY_CODE,                
--BRANCH_CODE=CONVERT(VARCHAR(50),''),SUB_BROKER=CONVERT(VARCHAR(50),''),REGION=CONVERT(VARCHAR(50),''),BTB_BTC=CONVERT(VARCHAR(10),'')              
--FROM ATMUMBODPL03.DMAT.CITRUS_USR.TBL_CLIENT_MASTER WITH (NOLOCK)  , #DP_ID WHERE CLIENT_CODE = CLTCODE      ---------// COMMENTED ON 21 JUN 2024 --- Vishal EMAIL ORE-3767   

--SELECT * FROM #DATA
--SELECT * FROM #NEWDATA

IF OBJECT_ID(N'tempdb..#NEWDATA') IS NOT NULL          
DROP TABLE #NEWDATA 
SELECT D.TRADING_CODE,CD.BRANCH_CD,CD.SUB_BROKER,CD.REGION,(CASE WHEN B2C='Y'THEN 'B2C'ELSE 'B2B'END)AS B2B_B2C
INTO #NEWDATA
FROM #DATA D INNER JOIN INTRANET.RISK.DBO.CLIENT_DETAILS B ON D.TRADING_CODE = B.CL_CODE
INNER JOIN MSAJAG.DBO.CLIENT_DETAILS CD ON CD.CL_CODE=D.TRADING_CODE --4 sec
--WHERE TRADING_CODE in ('R607440','D326844')


UPDATE #DATA SET BRANCH_CODE=N.BRANCH_CD, SUB_BROKER=N.SUB_BROKER, REGION=N.REGION, BTB_BTC=N.B2B_B2C FROM #NEWDATA N INNER JOIN #DATA D ON D.TRADING_CODE=N.TRADING_CODE --0 sec


--UPDATE #DATA SET BRANCH_CODE = BC,SUB_BROKER=SB,BTB_BTC=B2B_B2C,REGION = B.REGION FROM #DATA A,                
--(SELECT CL_CODE,BC=B.BRANCH_CD,SB=B.SUB_BROKER,REGION,(CASE WHEN B2C='Y'THEN 'B2C'ELSE 'B2B'END)AS B2B_B2C,LTD=ISNULL(CONVERT(VARCHAR(11),B.COMB_LAST_DATE,105),'')               
--FROM MSAJAG.DBO.CLIENT_DETAILS B WITH (NOLOCK)) B 
--WHERE A.TRADING_CODE = B.CL_CODE                
                  
ALTER TABLE #DATA ADD TRD_ACT_DT VARCHAR(11) , TRD_DEAVT_DT VARCHAR(11)              
              
;WITH CTE AS              
(SELECT CLIENT_BROK_DETAILS.CL_CODE,MIN(ACTIVE_DATE) AS ACTIVE_DATE,MAX(INACTIVE_FROM) AS INACTIVE_FROM FROM MSAJAG.DBO.CLIENT_BROK_DETAILS WITH (NOLOCK),#DATA              
WHERE MSAJAG.DBO.CLIENT_BROK_DETAILS.CL_CODE = #DATA.TRADING_CODE GROUP BY CLIENT_BROK_DETAILS.CL_CODE)              
              
UPDATE #DATA SET TRD_ACT_DT = ACTIVE_DATE , TRD_DEAVT_DT = INACTIVE_FROM FROM  #DATA ,              
CTE WHERE CL_CODE = TRADING_CODE              
          
IF OBJECT_ID(N'DUSTBIN..DP_IPO_DATA') IS NOT NULL          
DROP TABLE DP_IPO_DATA          

SELECT  DEMAT_CODE=''''+DEMAT_CODE,TRADING_CODE,BRANCH_CODE,SUB_BROKER,REGION,BTB_BTC,              
CASE WHEN TRD_DEAVT_DT LIKE '%2049%' THEN 'ACTIVE' ELSE 'INACTIVE' END AS  TRD_AVT_STATUS              
INTO DP_IPO_DATA              
FROM #DATA ORDER BY 1        --0 Sec      
              
--DECLARE @REPORTDATE VARCHAR(11), @QRY NVARCHAR(4000), @MAINQRY VARCHAR(4000), @DPATH VARCHAR (MAX)              
--SET @REPORTDATE=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')              
--SET @DPATH= 'J:\BACKOFFICE\HRISHI\AUTOMATION\OUTPUT\' +'DP_IPO_DATA_' + @REPORTDATE + '.CSV'                  
--SET @QRY = 'SELECT ''''DEMAT_CODE'''',''''TRADING_CODE'''',''''BRANCH_CODE'''',''''SUB_BROKER'''',''''REGION'''',''''BTB_BTC'''',''''TRD_AVT_STATUS'''' UNION ALL SELECT * FROM DUSTBIN.DBO.DP_IPO_DATA'                  
--SET @MAINQRY= 'BCP "' + @QRY + '" QUERYOUT ' + @DPATH + ' -C -T"," -C -T"," -R"\N" -T'                    
--PRINT @MAINQRY                  
----EXEC MASTER..XP_CMDSHELL @MAINQRY, NO_OUTPUT              
              
              
--SELECT * FROM DUSTBIN.DBO.DP_IPO_DATA  
  
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')              
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\VISHAL\DP_IPO_DATA\OUTPUT\' +'DP_IPO_DATA_' + @RPT_DATE + '.CSV'               
DECLARE @ALL VARCHAR(MAX)              
              
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''DEMAT_CODE'''',''''TRADING_CODE'''',''''BRANCH_CODE'''',''''SUB_BROKER'''',''''REGION'''',''''BTB_BTC'''',''''TRD_AVT_STATUS'''''              
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.DP_IPO_DATA'              
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.DP_IPO_DATA'     
PRINT @ALL              
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'              
PRINT @ALL              
EXEC(@ALL)         
              
            
DROP TABLE #DATA               
DROP TABLE #NEWDATA             
----DROP TABLE DP_IPO_DATA              
              
SELECT 'DP IPO FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GLCODE_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1                      
---- // DESCRIPTION :- SWAPNIL KANK NEED FRONTEND FOR LEDGER DATA. CREATED BY HRISHI                      
-- EXEC [USP_GLCODE_DATA]
      
CREATE PROC [dbo].[USP_GLCODE_DATA]  
AS
    
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                             
SET @PATH='J:\Backoffice\SL_AUTO\SWAPNIL_K\GLCODE_DATA\INPUT\DATE.txt'                              
    
IF OBJECT_ID(N'tempdb..#INPUT_DATA') IS NOT NULL                        
DROP TABLE #INPUT_DATA    
--CREATE TABLE #INPUT_DATA (GLCODE VARCHAR(50),FDATE DATE,TDATE DATE)  ---- COMENTED ON 26 FEB 2024
CREATE TABLE #INPUT_DATA (FDATE DATE,TDATE DATE)    
                            
SET @SQL='BULK INSERT #INPUT_DATA FROM ' + ''''+ @PATH +''''                            
SET @SQL2=' WITH                              
    (                              
           FIRSTROW = 1,                              
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                              
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                              
           TABLOCK                              
    )'                              
                            
SET @SQLFINAL= @SQL + @SQL2                              
PRINT @SQLFINAL                              
EXEC (@SQLFINAL)                            
                            
--SELECT TOP 10 * FROM #INPUT_DATA  

DECLARE @FDATE DATE , @TDATE DATE

SET @FDATE=(SELECT TOP 1 FDATE FROM #INPUT_DATA)
PRINT @FDATE
SELECT @TDATE=(SELECT TOP 1 TDATE FROM #INPUT_DATA)
PRINT @TDATE

select * INTO #TEMP
from ACCOUNT.DBO.Ledger L with (nolock) --INNER JOIN #INPUT_DATA I ON L.CLTCODE=I.GLCODE  ---- COMENTED ON 26 FEB 2024
where --vtyp='8' and  ---- COMENTED ON 26 FEB 2024
ENTEREDBY in ('e78077','B_E87195','B_e78077','e65199','B_e65199','E87195','cs0509','B_cs0509','M_e87195','M_e78077','M_e65199','e_cs0509') 
and CONVERT(DATE,VDT) Between @FDATE and @TDATE
and CHECKEDBY <>'Offline'
  
--  DROP TABLE #TEMP

--SELECT * FROM #TEMP
  
IF OBJECT_ID(N'DUSTBIN..TBL_GLCODE_DATA') IS NOT NULL                  
DROP TABLE DUSTBIN.DBO.TBL_GLCODE_DATA        
      
SELECT CONVERT(VARCHAR(20),VTYP) AS VTYP,VNO,CONVERT(VARCHAR(11),EDT) AS EDT,CONVERT(VARCHAR(20),LNO) AS LNO,ACNAME,DRCR,CONVERT(VARCHAR(30),VAMT) AS VAMT,CONVERT(VARCHAR(11),VDT) AS VDT,VNO1,REFNO,CONVERT(VARCHAR(30),BALAMT) AS BALAMT
,CONVERT(VARCHAR(20),NODAYS) AS NODAYS,CONVERT(VARCHAR(11),CDT) AS CDT,CLTCODE,BOOKTYPE,ENTEREDBY,CONVERT(VARCHAR,PDT) AS PDT,CHECKEDBY,CONVERT(VARCHAR(20),ACTNODAYS) AS ACTNODAYS,NARRATION
INTO DUSTBIN.DBO.TBL_GLCODE_DATA       
FROM #TEMP      
      
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_GLCODE_DATA
        
--DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')        
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SWAPNIL_K\GLCODE_DATA\OUTPUT\' +'GLCODE_DATA' + '.CSV'      
DECLARE @ALL VARCHAR(MAX)        
        
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''VTYP'''',''''VNO'''',''''EDT'''',''''LNO'''',''''ACNAME'''',''''DRCR'''',''''VAMT'''',''''VDT'''',''''VNO1'''',''''REFNO'''',''''BALAMT'''',''''NODAYS'''',''''CDT'''',''''CLTCODE'''',''''BOOKTYPE'''',''''ENTEREDBY'''',''''PDT'''',''''CHECKEDBY'''',''''ACTNODAYS'''',''''NARRATION'''''        
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_GLCODE_DATA'      
PRINT @ALL        
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'        
PRINT @ALL        
EXEC(@ALL)        
    
DROP TABLE #TEMP    
DROP TABLE #INPUT_DATA    
    
SELECT 'GLCODE DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INACTIVE_CODE_MCX
-- --------------------------------------------------
    
---- // USE DUSTBIN   --- // ANAND1                    
---- // DESCRIPTION :- VISHAL J RAUT REQUIRED DP DATA. CREATED BY HRISHI                    
                    
CREATE PROC [dbo].[USP_INACTIVE_CODE_MCX]    
AS    
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                     
SET @PATH='J:\Backoffice\SL_AUTO\INACTIVE_CODE\MCX\INPUT\INACTIVE_CODE.CSV'                      
                 
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL                
    DROP TABLE #CODE    
CREATE TABLE #CODE (CLTCODE VARCHAR(50))      
                    
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''    
SET @SQL2=' WITH    
    (                      
           FIRSTROW = 1,                      
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                      
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                      
           TABLOCK                      
    )'                      
                    
SET @SQLFINAL= @SQL + @SQL2                      
PRINT @SQLFINAL                      
EXEC (@SQLFINAL)                    
    
--SELECT TOP 10 * FROM #CODE      
      
IF OBJECT_ID(N'DUSTBIN..TBL_INACTIVE_CODE_MCX') IS NOT NULL                
DROP TABLE TBL_INACTIVE_CODE_MCX      
      
SELECT DISTINCT A.CL_CODE,A.SHORT_NAME, B.Exchange, B.Segment, CONVERT(VARCHAR,B.ACTIVE_DATE,101) AS ACTIVE_DATE,CONVERT(VARCHAR,B.INACTIVE_FROM,101) AS INACTIVE_FROM, (CASE WHEN b.INACTIVE_FROM LIKE '%2049%' THEN 'ACTIVE' ELSE 'INACTIVE' END) AS STATUS,
B.Deactive_Remarks , B.Deactive_value
INTO TBL_INACTIVE_CODE_MCX   
FROM MSAJAG.DBO.CLIENT_DETAILS A INNER JOIN MSAJAG.DBO.CLIENT_BROK_DETAILS B ON A.CL_CODE = B.CL_CODE 
INNER JOIN #CODE C ON C.CLTCODE=A.CL_CODE and B.Exchange in ('MCX') and  B.Segment='FUTURES'

Alter table TBL_INACTIVE_CODE_MCX add  last_trade_date varchar(12)

--Alter table TBL_INACTIVE_CODE_MCX  ALTER COLUMN  last_trade_date varchar(12)



SELECT PARTY_CODE,LAST_TRADE_DATE=MAX(SAUDA_DATE)  into #last_trade_mcx 
FROM ANGELCOMMODITY.MCDX.DBO.FOBILLVALAN WITH (NOLOCK)  
WHERE PARTY_CODE IN (SELECT * FROM #CODE)-- AND EXCHANGE='BSXFO'  
GROUP BY PARTY_CODE  



update M  set M.last_trade_date=N.LAST_TRADE_DATE from TBL_INACTIVE_CODE_MCX  M ,#last_trade_mcx N
where M.CL_CODE=N.PARTY_CODE



  
  --SELECT TOP 10 * FROM  MSAJAG.DBO.CLIENT_BROK_DETAILS 
      
--SELECT distinct  last_trade_date FROM DUSTBIN.DBO.TBL_INACTIVE_CODE_MCX  where   last_trade_date is null    
      
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')      
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\INACTIVE_CODE\MCX\OUTPUT\' +'INACTIVE_CODE_MCX_' + @RPT_DATE + '.CSV'      
DECLARE @ALL VARCHAR(MAX)      
      
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CL_CODE'''',''''SHORT_NAME'''',''''Exchange'''',''''Segment'''',''''ACTIVE_DATE'''',''''INACTIVE_FROM'''',''''STATUS'''',''''Deactive_Remarks'''',''''Deactive_value'''',''''Last_Trade_Date'''''      
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_INACTIVE_CODE_MCX'      
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.TBL_CALLING_DATA'      
PRINT @ALL      
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'      
PRINT @ALL      
EXEC(@ALL)      
                    
--DROP TABLE #CODE      
--DROP TABLE TBL_INACTIVE_CODE_MCX      
                    
SELECT 'INACTIVE CODE MCX DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INACTIVE_CODE_MCX_01APR2025
-- --------------------------------------------------
    
---- // USE DUSTBIN   --- // ANAND1                    
---- // DESCRIPTION :- VISHAL J RAUT REQUIRED DP DATA. CREATED BY HRISHI                    
                    
CREATE PROC [dbo].[USP_INACTIVE_CODE_MCX_01APR2025]    
AS    
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                     
SET @PATH='J:\Backoffice\SL_AUTO\INACTIVE_CODE\MCX\INPUT\INACTIVE_CODE.CSV'                      
                 
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL                
    DROP TABLE #CODE    
CREATE TABLE #CODE (CLTCODE VARCHAR(50))      
                    
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''    
SET @SQL2=' WITH    
    (                      
           FIRSTROW = 1,                      
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                      
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                      
           TABLOCK                      
    )'                      
                    
SET @SQLFINAL= @SQL + @SQL2                      
PRINT @SQLFINAL                      
EXEC (@SQLFINAL)                    
    
--SELECT TOP 10 * FROM #CODE      
      
IF OBJECT_ID(N'DUSTBIN..TBL_INACTIVE_CODE_MCX') IS NOT NULL                
DROP TABLE TBL_INACTIVE_CODE_MCX      
      
SELECT DISTINCT A.CL_CODE,A.SHORT_NAME, B.Exchange, B.Segment, CONVERT(VARCHAR,B.ACTIVE_DATE,101) AS ACTIVE_DATE,CONVERT(VARCHAR,B.INACTIVE_FROM,101) AS INACTIVE_FROM, (CASE WHEN b.INACTIVE_FROM LIKE '%2049%' THEN 'ACTIVE' ELSE 'INACTIVE' END) AS STATUS,
B.Deactive_Remarks , B.Deactive_value
INTO TBL_INACTIVE_CODE_MCX   
FROM MSAJAG.DBO.CLIENT_DETAILS A INNER JOIN MSAJAG.DBO.CLIENT_BROK_DETAILS B ON A.CL_CODE = B.CL_CODE 
INNER JOIN #CODE C ON C.CLTCODE=A.CL_CODE and B.Exchange in ('MCX') and  B.Segment='FUTURES'
  
  --SELECT TOP 10 * FROM  MSAJAG.DBO.CLIENT_BROK_DETAILS 
      
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_INACTIVE_CODE_MCX        
      
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')      
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\INACTIVE_CODE\MCX\OUTPUT\' +'INACTIVE_CODE_MCX_' + @RPT_DATE + '.CSV'      
DECLARE @ALL VARCHAR(MAX)      
      
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CL_CODE'''',''''SHORT_NAME'''',''''Exchange'''',''''Segment'''',''''ACTIVE_DATE'''',''''INACTIVE_FROM'''',''''STATUS'''',''''Deactive_Remarks'''',''''Deactive_value'''''      
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_INACTIVE_CODE_MCX'      
--SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT * FROM DUSTBIN.DBO.TBL_CALLING_DATA'      
PRINT @ALL      
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'      
PRINT @ALL      
EXEC(@ALL)      
                    
--DROP TABLE #CODE      
--DROP TABLE TBL_INACTIVE_CODE_MCX      
                    
SELECT 'INACTIVE CODE MCX DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_LEC_KOTAK
-- --------------------------------------------------
----.91 USE DUSTBIN / INHOUSE          
          
CREATE PROC [dbo].[USP_LEC_KOTAK] ( @SDATE AS VARCHAR(11) )          
AS          
BEGIN        
    
---- EXEC USP_LEC_KOTAK 'JUN 10 2025'    
--DECLARE @SDATE AS VARCHAR(11)='JUL 17 2025'          
      
SELECT PARTY_CODE,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,                      
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,                      
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)                      
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=                       
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,                      
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                      
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =                       
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                      
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +                      
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN                       
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,                      
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),                      
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD),SERIES      
INTO #CMBILLVALAN_NSE      
FROM MSAJAG.DBO.CMBILLVALAN S WITH(NOLOCK)       
WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN (SELECT CL_CODE FROM MSAJAG.DBO.CLIENT1 WHERE CL_TYPE ='NRI')  --AND PARTY_CODE IN ('ZR510','ZR0050098R')      
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,SEGMENT,SERIES      
      
SELECT PARTY_CODE,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,                      
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,                      
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)                      
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=                       
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,                      
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                      
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =                       
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                      
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +                      
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN                       
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,                      
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),                      
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD),SERIES      
INTO #CMBILLVALAN_BSE      
FROM ANGELBSECM.BSEDB_AB.DBO.CMBILLVALAN S WITH(NOLOCK)       
WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN (SELECT CL_CODE FROM MSAJAG.DBO.CLIENT1 WHERE CL_TYPE ='NRI')  --AND PARTY_CODE IN ('ZR510','ZR0050098R')  
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,SEGMENT,SERIES       
      
--SELECT * FROM #CMBILLVALAN_NSE      
--SELECT * FROM #CMBILLVALAN_BSE      
      
----> NSE START      
SELECT * INTO #MAIN_DATA_NSE FROM #CMBILLVALAN_NSE WHERE CONTRACTNO<>'0000000'            
SELECT * INTO #C_ZERO_NSE FROM #CMBILLVALAN_NSE WHERE CONTRACTNO='0000000'          
      
SELECT M.PARTY_CODE, M.SCRIP_CD,M.SAUDA_DATE,M.SCRIP_NAME,M.ISIN,M.CONTRACTNO,M.SETT_NO,M.SETT_TYPE,M.EXCHANGE,M.SEGMENT,M.LONG_NAME,(M.PTRADEDQTY+Z.PTRADEDQTY) AS PTRADEDQTY,      
(M.PTRADEDAMT+Z.PTRADEDAMT) AS PTRADEDAMT, (M.STRADEDQTY+Z.STRADEDQTY) AS STRADEDQTY, (M.STRADEDAMT+Z.STRADEDAMT) AS STRADEDAMT, (M.BUYBROKERAGE+Z.BUYBROKERAGE) AS BUYBROKERAGE,      
(M.SELBROKERAGE+Z.SELBROKERAGE) AS SELBROKERAGE,(M.BUYDELIVERYCHRG+Z.BUYDELIVERYCHRG) AS BUYDELIVERYCHRG,(M.SELLDELIVERYCHRG+Z.SELLDELIVERYCHRG) AS SELLDELIVERYCHRG,M.CLIENTTYPE,      
(M.BILLPAMT+Z.BILLPAMT) AS BILLPAMT,(M.BILLSAMT+Z.BILLSAMT) AS BILLSAMT,(M.PMARKETRATE+Z.PMARKETRATE) AS PMARKETRATE,(M.SMARKETRATE+Z.SMARKETRATE) AS SMARKETRATE,      
(M.PNETRATE+Z.PNETRATE) AS PNETRATE,(M.SNETRATE+Z.SNETRATE) AS SNETRATE,(M.TRDAMT+Z.TRDAMT) AS TRDAMT,(M.DELAMT+Z.DELAMT) AS DELAMT,(M.SERINEX+Z.SERINEX) AS SERINEX,      
(M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EXSERVICE_TAX+Z.EXSERVICE_TAX) AS EXSERVICE_TAX,(M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX,      
(M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG,(M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG,(M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG,M.MEMBERTYPE,M.COMPANYNAME, (M.PNL+Z.PNL) AS PNL,M.SERIES      
INTO #ACTUAL_CN_ZERO          
FROM #MAIN_DATA_NSE M INNER JOIN #C_ZERO_NSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD      
      
DELETE FROM #MAIN_DATA_NSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_NSE)          
      
INSERT INTO #MAIN_DATA_NSE          
SELECT * FROM #ACTUAL_CN_ZERO         
----> NSE END      
      
----> BSE START      
SELECT * INTO #MAIN_DATA_BSE FROM #CMBILLVALAN_BSE WHERE CONTRACTNO<>'0000000'            
SELECT * INTO #C_ZERO_BSE FROM #CMBILLVALAN_BSE WHERE CONTRACTNO='0000000'          
      
SELECT M.PARTY_CODE, M.SCRIP_CD,M.SAUDA_DATE,M.SCRIP_NAME,M.ISIN,M.CONTRACTNO,M.SETT_NO,M.SETT_TYPE,M.EXCHANGE,M.SEGMENT,M.LONG_NAME,(M.PTRADEDQTY+Z.PTRADEDQTY) AS PTRADEDQTY,      
(M.PTRADEDAMT+Z.PTRADEDAMT) AS PTRADEDAMT, (M.STRADEDQTY+Z.STRADEDQTY) AS STRADEDQTY, (M.STRADEDAMT+Z.STRADEDAMT) AS STRADEDAMT, (M.BUYBROKERAGE+Z.BUYBROKERAGE) AS BUYBROKERAGE,      
(M.SELBROKERAGE+Z.SELBROKERAGE) AS SELBROKERAGE,(M.BUYDELIVERYCHRG+Z.BUYDELIVERYCHRG) AS BUYDELIVERYCHRG,(M.SELLDELIVERYCHRG+Z.SELLDELIVERYCHRG) AS SELLDELIVERYCHRG,M.CLIENTTYPE,      
(M.BILLPAMT+Z.BILLPAMT) AS BILLPAMT,(M.BILLSAMT+Z.BILLSAMT) AS BILLSAMT,(M.PMARKETRATE+Z.PMARKETRATE) AS PMARKETRATE,(M.SMARKETRATE+Z.SMARKETRATE) AS SMARKETRATE,      
(M.PNETRATE+Z.PNETRATE) AS PNETRATE,(M.SNETRATE+Z.SNETRATE) AS SNETRATE,(M.TRDAMT+Z.TRDAMT) AS TRDAMT,(M.DELAMT+Z.DELAMT) AS DELAMT,(M.SERINEX+Z.SERINEX) AS SERINEX,      
(M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EXSERVICE_TAX+Z.EXSERVICE_TAX) AS EXSERVICE_TAX,(M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX,      
(M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG,(M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG,(M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG,M.MEMBERTYPE,M.COMPANYNAME, (M.PNL+Z.PNL) AS PNL,M.SERIES      
INTO #ACTUAL_CN_ZERO_BSE          
FROM #MAIN_DATA_BSE M INNER JOIN #C_ZERO_BSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD      
      
DELETE FROM #MAIN_DATA_BSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_BSE)      
      
INSERT INTO #MAIN_DATA_BSE      
SELECT * FROM #ACTUAL_CN_ZERO_BSE      
----> BSE END      
      
CREATE TABLE #MAIN_DATA           
(      
 PARTY_CODE VARCHAR (100),      
 SCRIP_CD VARCHAR (100),      
 SAUDA_DATE VARCHAR (11),      
 SCRIP_NAME VARCHAR (100),      
 ISIN VARCHAR (100),      
 CONTRACTNO VARCHAR (100),      
 SETT_NO VARCHAR (100),      
 SETT_TYPE VARCHAR (100),      
 EXCHANGE VARCHAR (100),      
 SEGMENT VARCHAR (100),      
 LONG_NAME VARCHAR (100),      
 PTRADEDQTY INT,      
 PTRADEDAMT MONEY,      
 STRADEDQTY INT,      
 STRADEDAMT MONEY,      
 BUYBROKERAGE MONEY,      
 SELBROKERAGE MONEY,      
 BUYDELIVERYCHRG MONEY,      
 SELLDELIVERYCHRG MONEY,      
 CLIENTTYPE VARCHAR (100),      
 BILLPAMT MONEY,      
 BILLSAMT MONEY,      
 PMARKETRATE MONEY,      
 SMARKETRATE MONEY,      
 PNETRATE MONEY,      
 SNETRATE MONEY,      
 TRDAMT MONEY,      
 DELAMT MONEY,      
 SERINEX MONEY,      
 SERVICE_TAX MONEY,      
 EXSERVICE_TAX MONEY,      
 TURN_TAX MONEY,      
 SEBI_TAX MONEY,      
 INS_CHRG MONEY,      
 BROKER_CHRG MONEY,      
 OTHER_CHRG MONEY,      
 MEMBERTYPE VARCHAR (100),      
 COMPANYNAME VARCHAR (100),      
 PNL MONEY,      
 SERIES VARCHAR (100)      
)      
      
INSERT INTO #MAIN_DATA          
SELECT * FROM #MAIN_DATA_NSE          
UNION ALL          
SELECT * FROM #MAIN_DATA_BSE          
      
SELECT FLD_CLIENTCODE, CLIPISNO= CASE WHEN ( ISNULL(FLD_CLIENTPISAC,'0')='0') THEN FLD_NROPISNO  ELSE FLD_CLIENTPISAC END,          
CLIBNKACC= CASE WHEN (ISNULL(FLD_NREACNO,'0')='0') THEN FLD_NROACNO  ELSE FLD_NREACNO END, RBI_REFNO ,FLD_DEMATACNO        
INTO #TBL_NRICLIENTMASTER           
FROM INTRANET.RISK.DBO.TBL_NRICLIENTMASTER WITH (NOLOCK)      
  
----SELECT FLD_BANKNAME,FLD_BRANCHLOCATION,CASE WHEN '1'='1' THEN FLD_BANKPISAC ELSE FLD_ANGELACC END ,*  
----FROM INTRANET.RISK.DBO.V_NRIBANK_DETAILS WITH (NOLOCK) WHERE FLD_CLIENTCODE = 'ZR510'                       
----SELECT * FROM  INTRANET.RISK.DBO.TBL_NRICLIENTMASTER WITH (NOLOCK)  WHERE FLD_CLIENTCODE = 'ZR510'           
  
SELECT PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,ISIN,SCRIPNAME,SUM(IPFT_CHRG) AS IPFT_CHRG INTO #CONTRACT  
FROM MSAJAG.DBO.COMMON_CONTRACT_DATA WITH(NOLOCK) WHERE SAUDA_DATE=@SDATE --AND PARTY_CODE IN ('ZR1703R')  
GROUP BY PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,ISIN,SCRIPNAME  
  
ALTER TABLE #MAIN_DATA ADD CONTRACTNO_NEW VARCHAR(100)  
ALTER TABLE #MAIN_DATA ADD IPFT MONEY  
  
UPDATE A SET A.CONTRACTNO_NEW=B.CONTRACTNO_NEW, A.IPFT=B.IPFT_CHRG   
--SELECT A.PARTY_CODE,A.CONTRACTNO_NEW,B.CONTRACTNO_NEW, A.IPFT,B.IPFT_CHRG  
FROM #MAIN_DATA A, #CONTRACT B   
WHERE A.PARTY_CODE=B.PARTY_CODE AND A.SAUDA_DATE=B.SAUDA_DATE AND A.ISIN=B.ISIN   
  
  
SELECT N.CLIPISNO AS BANK_ACC_NO, SCHEME='OFFLINE', M.PARTY_CODE AS CLIENT_CODE, CLIENT_NAME =M.LONG_NAME, M.SAUDA_DATE AS TRADE_DATE,VALAN=M.SETT_TYPE+'/'+M.SETT_NO,      
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN 'B' ELSE 'S' END AS DEAL_TYPE, M.ISIN, M.SCRIP_NAME AS SCRIPNAME,    
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PTRADEDQTY ELSE STRADEDQTY END AS QUANTITY,      
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PNETRATE ELSE SNETRATE END AS GROSS_RATE,   
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN BUYDELIVERYCHRG ELSE SELLDELIVERYCHRG END AS BROKERAGE,      
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PMARKETRATE ELSE SMARKETRATE END AS NET_RATE,  
  
--CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN BILLPAMT ELSE BILLSAMT END AS AMOUNT,  
--CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN (PMARKETRATE*PTRADEDQTY)+BUYDELIVERYCHRG+(SERVICE_TAX+TURN_TAX+SEBI_TAX+BROKER_CHRG+IPFT)   
--     ELSE (SMARKETRATE*STRADEDQTY)-SELLDELIVERYCHRG-(SERVICE_TAX+TURN_TAX+SEBI_TAX+BROKER_CHRG+IPFT) END AS AMOUNT,  
  
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN M.TRDAMT+BUYDELIVERYCHRG+(M.SERVICE_TAX+M.TURN_TAX+M.SEBI_TAX+M.BROKER_CHRG+M.IPFT)+INS_CHRG  
ELSE M.TRDAMT-SELLDELIVERYCHRG-(M.SERVICE_TAX+M.TURN_TAX+M.SEBI_TAX+M.BROKER_CHRG+M.IPFT)-INS_CHRG END AS AMOUNT, --- ADDED ON 15 JUL 2025  
  
INS_CHRG AS STT, TXN_TYPE='0', DP_ID=SUBSTRING(N.FLD_DEMATACNO,9,25),SHORT_GAIN='0', SHORT_LOSS='0', LONG_GAIN='0', LONG_LOSS='0', TDS='0', PMS_PRODUCT='0',    
M.CONTRACTNO_NEW AS CONTRACT_NUMBER, M.SERVICE_TAX, EDUCATION_CESS='0', EXCHANGE_LEVY='0', M.BROKER_CHRG AS STAMPDUTY, --M.OTHER_CHRG AS OTHER_CHARGES,     
(M.TURN_TAX+M.SEBI_TAX+M.IPFT) AS OTHER_CHARGES, -- ADDED ON 15 JUL 2025   
DEPOSITORY_ID=SUBSTRING(N.FLD_DEMATACNO,1,8), M.SETT_TYPE AS SETTLEMENT_TYPE, M.SETT_NO AS SETTLEMENT_NUMBER, SETTLEMENT_DATE=DATEADD(DAY,1,    
CONVERT(DATE,M.SAUDA_DATE)), SEBI_REG_NO1='CDSL REGISTERATION #', SEBI_SUB_CATEGORY=M.CLIENTTYPE, INSTRUMENT_SUB_TYPE=M.SERIES, PANNO='-', NON_PINS_ACCOUNT=N.CLIBNKACC      
INTO #FINAL_DATA      
FROM #MAIN_DATA M LEFT JOIN #TBL_NRICLIENTMASTER N ON M.PARTY_CODE = N.FLD_CLIENTCODE      
  
--SELECT PARTY_CODE,PMARKETRATE,PTRADEDQTY,PMARKETRATE*PTRADEDQTY AS TotalMarketVal,SMARKETRATE,STRADEDQTY,SMARKETRATE*STRADEDQTY AS TotalMarketVal_SEL FROM #MAIN_DATA--15175.00--14850.00  
--SELECT SERVICE_TAX,TURN_TAX,SEBI_TAX,BROKER_CHRG,IPFT ,c.SERVICE_TAX+c.TURN_TAX+c.SEBI_TAX+c.BROKER_CHRG+c.IPFT as OtherCharges FROM #MAIN_DATA c  
  
SELECT * INTO #CLIENT_DETAILS FROM INTRANET.RISK.DBO.CLIENT_DETAILS WHERE CL_TYPE IN ('NRI')      
ALTER TABLE #FINAL_DATA ALTER COLUMN CLIENT_NAME VARCHAR (100)      
      
UPDATE #FINAL_DATA SET CLIENT_NAME=C.LONG_NAME FROM #FINAL_DATA F INNER JOIN #CLIENT_DETAILS C ON F.CLIENT_CODE=C.CL_CODE          
  
--SELECT * FROM #FINAL_DATA        
      
TRUNCATE TABLE DUSTBIN..TBL_NRILECKOTAK_TEMP    
    
INSERT INTO DUSTBIN..TBL_NRILECKOTAK_TEMP        
SELECT BANK_ACC_NO,SCHEME,CLIENT_CODE,CLIENT_NAME,TRADE_DATE,VALAN,DEAL_TYPE, ISIN, SCRIPNAME, CAST(QUANTITY AS VARCHAR (100)) AS QUANTITY, CAST(GROSS_RATE AS VARCHAR (100)) AS GROSS_RATE,        
CAST(BROKERAGE AS VARCHAR (100)) AS BROKERAGE, CAST(NET_RATE AS VARCHAR (100)) AS NET_RATE,CAST(AMOUNT AS VARCHAR (100)) AS AMOUNT, CAST(STT AS VARCHAR (100)) AS STT, TXN_TYPE,DP_ID,SHORT_GAIN,        
SHORT_LOSS,LONG_GAIN,LONG_LOSS,TDS,PMS_PRODUCT,CONTRACT_NUMBER,CAST(SERVICE_TAX AS VARCHAR (100)) AS SERVICE_TAX, EDUCATION_CESS,EXCHANGE_LEVY,CAST(STAMPDUTY AS VARCHAR (100)) AS STAMPDUTY,        
CAST(OTHER_CHARGES AS VARCHAR (100)) AS OTHER_CHARGES, DEPOSITORY_ID,SETTLEMENT_TYPE,SETTLEMENT_NUMBER,CAST(SETTLEMENT_DATE AS VARCHAR (100)) AS SETTLEMENT_DATE,SEBI_REG_NO1,        
SEBI_SUB_CATEGORY,INSTRUMENT_SUB_TYPE,PANNO,NON_PINS_ACCOUNT        
FROM #FINAL_DATA        
        
SELECT * FROM TBL_NRILECKOTAK_TEMP        
        
DECLARE @FILENAME1 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\HRISHI\NRI_CLIENTS\KOTAK_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                     
DECLARE @ALL1 VARCHAR(MAX)                              
                              
SET @ALL1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''BANK_ACC_NO'''',''''SCHEME'''',''''CLIENT_CODE'''',''''CLIENT_NAME'''',''''TRADE_DATE'''',''''VALAN'''',''''DEAL_TYPE'''',''''ISIN'''',''''SCRIPNAME'''',''''QUANTITY'''',''''GROSS_RATE'''',''''BROKERAGE'''',''''NET_RATE'''',''''AMOUNT'''',''''STT'''',''''TXN_TYPE'''',''''DP_ID'''',''''SHORT_GAIN'''',''''SHORT_LOSS'''',''''LONG_GAIN'''',''''LONG_LOSS'''',''''TDS'''',''''PMS_PRODUCT'''',''''CONTRACT_NUMBER'''',''''SERVICE_TAX'''',''''EDUCATION_CESS'''',''''EXCHANGE_LEVY'''',''''STAMPDUTY'''',''''OTHER_CHARGES'''',''''DEPOSITORY_ID'''',''''SETTLEMENT_TYPE'''',''''SETTLEMENT_NUMBER'''',''''SETTLEMENT_DATE'''',''''SEBI_REG_NO1'''',''''SEBI_SUB_CATEGORY'''',''''INSTRUMENT_SUB_TYPE'''',''''PANNO'''',''''NON_PINS_ACCOUNT'''''        
SET @ALL1 = @ALL1+ ' UNION ALL SELECT * FROM DUSTBIN..TBL_NRILECKOTAK_TEMP'                            
--PRINT @ALL1                              
SET @ALL1=@ALL1+' " QUERYOUT ' +@FILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                              
PRINT @ALL1                              
EXEC(@ALL1)        
        
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_LEC_KOTAK_BKP_09JUN2025
-- --------------------------------------------------
--.91 USE DUSTBIN / INHOUSE    
    
CREATE PROC USP_LEC_KOTAK_BKP_09JUN2025 ( @SDATE AS VARCHAR(11) )    
AS    
BEGIN  
    
--DECLARE @SDATE AS VARCHAR(11)='MAY 29 2025'    
DECLARE @@SETT_NO VARCHAR(8) ,@@SETT_NO1 VARCHAR(8)    
    
SELECT @@SETT_NO = SETT_NO FROM MSAJAG.DBO.SETT_MST WITH (NOLOCK) WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='M'    
SELECT @@SETT_NO1 = SETT_NO FROM MSAJAG.DBO.SETT_MST WITH (NOLOCK) WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE ='N'    
    
SELECT 'NSECM' AS EXCHANGE,A.* INTO #CONTRACTDATA_NSE     
FROM MSAJAG.DBO.CONTRACT_DATA A WITH (NOLOCK) WHERE SETT_NO IN (@@SETT_NO,@@SETT_NO1)    
AND PARTY_CODE IN (SELECT CL_CODE FROM MSAJAG.DBO.CLIENT1 WHERE CL_TYPE ='NRI')  --AND PARTY_CODE IN ('ZR1463N','ZR1494N')  
AND SCRIP_CD <>'BROKERAGE'    
    
DECLARE @@SETT_NO_BSE VARCHAR(8) ,@@SETT_NO1_BSE VARCHAR(8)    
SELECT @@SETT_NO_BSE = SETT_NO FROM ANGELBSECM.BSEDB_AB.DBO.SETT_MST WITH (NOLOCK) WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE IN ('D','C')    
SELECT @@SETT_NO1_BSE = SETT_NO FROM ANGELBSECM.BSEDB_AB.DBO.SETT_MST WITH (NOLOCK) WHERE START_DATE LIKE @SDATE+'%'  AND SETT_TYPE IN ('RD','RC')    
    
SELECT 'BSECM' AS EXCHANGE,A.* INTO #CONTRACTDATA_BSE    
FROM ANGELBSECM.BSEDB_AB.DBO.CONTRACT_DATA A WITH (NOLOCK) WHERE SETT_NO IN (@@SETT_NO_BSE, @@SETT_NO1_BSE) AND SETT_TYPE IN ('D','C','RD','RC') AND (PQTY+SQTY)! = 0    
AND PARTY_CODE IN (SELECT CL_CODE FROM ANGELBSECM.BSEDB_AB.DBO.CLIENT1 WHERE CL_TYPE ='NRI')   --AND PARTY_CODE IN ('ZR1463N','ZR1494N')  
    
--SELECT * FROM #CONTRACTDATA_NSE WHERE PARTY_CODE='ZR1529R'    
--SELECT * FROM #CONTRACTDATA_BSE    
    
----> NSE START    
    
SELECT EXCHANGE, CONTRACTNO, PARTY_CODE, SAUDA_DATE, SCRIP_CD, SERIES, SCRIPNAME, SELL_BUY, SUM(BROKER_CHRG) AS BROKER_CHRG , SUM(TURN_TAX) AS TURN_TAX, SUM (SEBI_TAX) AS SEBI_TAX,    
SUM(OTHER_CHRG) AS OTHER_CHRG, SUM(INS_CHRG) AS INS_CHRG, SUM (SERVICE_TAX) AS SERVICE_TAX, SUM(NSERTAX) AS NSERTAX, SUM(PQTY) AS PQTY, SUM(SQTY) AS SQTY,  
AVG(PRATE) AS PRATE, AVG(SRATE) AS SRATE, AVG(PNETRATE) AS PNETRATE, AVG(SNETRATE) AS SNETRATE, SUM(PAMT) AS PAMT, SUM(SAMT) AS SAMT, SUM(BROKERAGE) AS BROKERAGE, SETT_NO, SETT_TYPE ,ISIN    
INTO #DATA_NSE    
FROM #CONTRACTDATA_NSE    
--WHERE PARTY_CODE='ZR1529R' OR (PARTY_CODE='ZR1248R' and SCRIP_CD IN ('PGEL','KITEX'))    
GROUP BY EXCHANGE, CONTRACTNO, PARTY_CODE, SAUDA_DATE, SCRIP_CD, SERIES, SCRIPNAME, SELL_BUY, SETT_NO, SETT_TYPE ,ISIN    
    
SELECT * INTO #MAIN_DATA_NSE FROM #DATA_NSE WHERE CONTRACTNO<>'0'      
SELECT * INTO #C_ZERO_NSE FROM #DATA_NSE WHERE CONTRACTNO='0'     
    
--SELECT * FROM #DATA_NSE WHERE PARTY_CODE='ZR1463N'    
--SELECT * FROM #MAIN_DATA_NSE WHERE PARTY_CODE='ZR1463N'    
--SELECT * FROM #C_ZERO_NSE WHERE PARTY_CODE='ZR1463N'    
    
SELECT M.EXCHANGE, M.CONTRACTNO, M.PARTY_CODE, M.SAUDA_DATE, M.SCRIP_CD, M.SERIES, M.SCRIPNAME, M.SELL_BUY, (M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG, (M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,  
(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX, (M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG, (M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG, (M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX, (M.NSERTAX+Z.NSERTAX) AS NSERTAX,  
(M.PQTY+Z.PQTY) AS PQTY, (M.SQTY+Z.SQTY) AS SQTY, (M.PRATE+Z.PRATE) AS PRATE, (M.SRATE+Z.SRATE) AS SRATE, (M.PNETRATE+Z.PNETRATE) AS PNETRATE, (M.SNETRATE+Z.SNETRATE) AS SNETRATE, (M.PAMT+Z.PAMT) AS PAMT,  
(M.SAMT+Z.SAMT) AS SAMT, (M.BROKERAGE+Z.BROKERAGE) AS BROKERAGE, M.SETT_NO, M.SETT_TYPE, M.ISIN  
INTO #ACTUAL_CN_ZERO    
FROM #MAIN_DATA_NSE M INNER JOIN #C_ZERO_NSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD AND Z.SELL_BUY=M.SELL_BUY  
--WHERE M.PARTY_CODE='ZR1529R'    
    
DELETE FROM #MAIN_DATA_NSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_NSE)    
     
INSERT INTO #MAIN_DATA_NSE    
SELECT * FROM #ACTUAL_CN_ZERO    
  
----> NSE END    
    
----> BSE START    
   
SELECT EXCHANGE, CONTRACTNO, PARTY_CODE, SAUDA_DATE, SCRIP_CD, SERIES, SCRIPNAME, SELL_BUY, SUM(BROKER_CHRG) AS BROKER_CHRG , SUM(TURN_TAX) AS TURN_TAX, SUM (SEBI_TAX) AS SEBI_TAX,    
SUM(OTHER_CHRG) AS OTHER_CHRG, SUM(INS_CHRG) AS INS_CHRG, SUM (SERVICE_TAX) AS SERVICE_TAX, SUM(NSERTAX) AS NSERTAX, SUM(PQTY) AS PQTY, SUM(SQTY) AS SQTY,  
AVG(PRATE) AS PRATE, AVG(SRATE) AS SRATE, AVG(PNETRATE) AS PNETRATE, AVG(SNETRATE) AS SNETRATE, SUM(PAMT) AS PAMT, SUM(SAMT) AS SAMT, SUM(BROKERAGE) AS BROKERAGE, SETT_NO, SETT_TYPE ,ISIN    
INTO #DATA_BSE    
FROM #CONTRACTDATA_BSE    
--WHERE PARTY_CODE='ZR1529R' OR (PARTY_CODE='ZR1248R' and SCRIP_CD IN ('PGEL','KITEX'))    
GROUP BY EXCHANGE, CONTRACTNO, PARTY_CODE, SAUDA_DATE, SCRIP_CD, SERIES, SCRIPNAME, SELL_BUY, SETT_NO, SETT_TYPE ,ISIN    
    
SELECT * INTO #MAIN_DATA_BSE FROM #DATA_BSE WHERE CONTRACTNO<>'0'      
SELECT * INTO #C_ZERO_BSE FROM #DATA_BSE WHERE CONTRACTNO='0'     
    
--SELECT * FROM #DATA_BSE WHERE PARTY_CODE='ZR1529R'    
--SELECT * FROM #MAIN_DATA_BSE WHERE PARTY_CODE='ZR1529R'    
--SELECT * FROM #C_ZERO_BSE WHERE PARTY_CODE='ZR1529R'    
  
SELECT M.EXCHANGE, M.CONTRACTNO, M.PARTY_CODE, M.SAUDA_DATE, M.SCRIP_CD, M.SERIES, M.SCRIPNAME, M.SELL_BUY, (M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG, (M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,  
(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX, (M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG, (M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG, (M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX, (M.NSERTAX+Z.NSERTAX) AS NSERTAX,  
(M.PQTY+Z.PQTY) AS PQTY, (M.SQTY+Z.SQTY) AS SQTY, (M.PRATE+Z.PRATE) AS PRATE, (M.SRATE+Z.SRATE) AS SRATE, (M.PNETRATE+Z.PNETRATE) AS PNETRATE, (M.SNETRATE+Z.SNETRATE) AS SNETRATE, (M.PAMT+Z.PAMT) AS PAMT,  
(M.SAMT+Z.SAMT) AS SAMT, (M.BROKERAGE+Z.BROKERAGE) AS BROKERAGE, M.SETT_NO, M.SETT_TYPE, M.ISIN  
INTO #ACTUAL_CN_ZERO_BSE    
FROM #MAIN_DATA_BSE M INNER JOIN #C_ZERO_BSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD AND Z.SELL_BUY=M.SELL_BUY  
--WHERE M.PARTY_CODE='ZR1529R'    
    
DELETE FROM #MAIN_DATA_BSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_BSE)    
     
INSERT INTO #MAIN_DATA_BSE    
SELECT * FROM #ACTUAL_CN_ZERO_BSE    
  
----> BSE END    
    
CREATE TABLE #MAIN_DATA     
(    
 EXCHANGE VARCHAR (100),    
 CONTRACTNO VARCHAR (100),    
 PARTY_CODE VARCHAR (100),    
 SAUDA_DATE VARCHAR (11),    
 SCRIP_CD VARCHAR (100),    
 SERIES VARCHAR (100),    
 SCRIPNAME VARCHAR (100),    
 SELL_BUY INT,    
 BROKER_CHRG MONEY,    
 TURN_TAX MONEY,    
 SEBI_TAX MONEY,    
 OTHER_CHRG MONEY,    
 INS_CHRG MONEY,    
 SERVICE_TAX MONEY,    
 NSERTAX MONEY,    
 PQTY INT,    
 SQTY INT,    
 PRATE MONEY,    
 SRATE MONEY,    
 PNETRATE MONEY,    
 SNETRATE MONEY,    
 PAMT MONEY,    
 SAMT MONEY,    
 BROKERAGE MONEY,    
 SETT_NO VARCHAR (100),    
 SETT_TYPE VARCHAR (100),    
 ISIN VARCHAR (100),    
)    
    
INSERT INTO #MAIN_DATA    
SELECT * FROM #MAIN_DATA_NSE    
UNION ALL    
SELECT * FROM #MAIN_DATA_BSE    
    
SELECT FLD_CLIENTCODE, CLIPISNO= CASE WHEN ( ISNULL(FLD_CLIENTPISAC,'0')='0') THEN FLD_NROPISNO  ELSE FLD_CLIENTPISAC END,    
CLIBNKACC= CASE WHEN (ISNULL(FLD_NREACNO,'0')='0') THEN FLD_NROACNO  ELSE FLD_NREACNO END, RBI_REFNO ,FLD_DEMATACNO  
INTO #TBL_NRICLIENTMASTER     
FROM INTRANET.RISK.DBO.TBL_NRICLIENTMASTER WITH (NOLOCK)    
  
--SELECT * FROM #TBL_NRICLIENTMASTER WHERE FLD_CLIENTCODE IN ('ZR1463N','ZR1494N')  
  
SELECT N.CLIPISNO AS BANK_ACC_NO, SCHEME='OFFLINE', M.PARTY_CODE AS CLIENT_CODE, CLIENT_NAME ='', M.SAUDA_DATE AS TRADE_DATE,VALAN=M.SETT_TYPE+'/'+M.SETT_NO,    
CASE WHEN M.SELL_BUY='1' THEN 'B' ELSE 'S' END AS DEAL_TYPE, M.ISIN, M.SCRIPNAME, CASE WHEN M.SELL_BUY='1' THEN PQTY ELSE SQTY END AS QUANTITY,    
CASE WHEN M.SELL_BUY='1' THEN PRATE ELSE SRATE END AS GROSS_RATE, M.BROKERAGE, CASE WHEN M.SELL_BUY='1' THEN PNETRATE ELSE SNETRATE END AS NET_RATE,    
CASE WHEN M.SELL_BUY='1' THEN PAMT ELSE SAMT END AS AMOUNT, INS_CHRG AS STT,TXN_TYPE='0',  
DP_ID=SUBSTRING(N.FLD_DEMATACNO,9,25), SHORT_GAIN='0', SHORT_LOSS='0', LONG_GAIN='0', LONG_LOSS='0', TDS='0', PMS_PRODUCT='0',    
M.CONTRACTNO AS CONTRACT_NUMBER, M.SERVICE_TAX, EDUCATION_CESS='0', EXCHANGE_LEVY='0', M.BROKER_CHRG AS STAMPDUTY, M.OTHER_CHRG AS OTHER_CHARGES, DEPOSITORY_ID=SUBSTRING(N.FLD_DEMATACNO,1,8), M.SETT_TYPE AS SETTLEMENT_TYPE,    
M.SETT_NO AS SETTLEMENT_NUMBER, SETTLEMENT_DATE=DATEADD(DAY,1,CONVERT(DATE,M.SAUDA_DATE)), SEBI_REG_NO1='CDSL REGISTERATION #', SEBI_SUB_CATEGORY='NRE', INSTRUMENT_SUB_TYPE=SERIES, PANNO='-', NON_PINS_ACCOUNT=N.CLIBNKACC    
INTO #FINAL_DATA    
FROM #MAIN_DATA M LEFT JOIN #TBL_NRICLIENTMASTER N ON M.PARTY_CODE = N.FLD_CLIENTCODE    
--WHERE M.PARTY_CODE IN ('BH039N') AND M.EXCHANGE='NSECM'    
ORDER BY M.PARTY_CODE,M.SCRIP_CD    
  
SELECT * INTO #CLIENT_DETAILS FROM INTRANET.RISK.DBO.CLIENT_DETAILS WHERE CL_TYPE IN ('NRI')    
ALTER TABLE #FINAL_DATA ALTER COLUMN CLIENT_NAME VARCHAR (100)    
    
UPDATE #FINAL_DATA SET CLIENT_NAME=C.LONG_NAME FROM #FINAL_DATA F INNER JOIN #CLIENT_DETAILS C ON F.CLIENT_CODE=C.CL_CODE    
    
TRUNCATE TABLE DUSTBIN..TBL_NRILECKOTAK_TEMP  
  
--SELECT * FROM #FINAL_DATA  
  
INSERT INTO DUSTBIN..TBL_NRILECKOTAK_TEMP  
SELECT BANK_ACC_NO,SCHEME,CLIENT_CODE,CLIENT_NAME,TRADE_DATE,VALAN,DEAL_TYPE, ISIN, SCRIPNAME, CAST(QUANTITY AS VARCHAR (100)) AS QUANTITY, CAST(GROSS_RATE AS VARCHAR (100)) AS GROSS_RATE,  
CAST(BROKERAGE AS VARCHAR (100)) AS BROKERAGE, CAST(NET_RATE AS VARCHAR (100)) AS NET_RATE,CAST(AMOUNT AS VARCHAR (100)) AS AMOUNT, CAST(STT AS VARCHAR (100)) AS STT, TXN_TYPE,DP_ID,SHORT_GAIN,  
SHORT_LOSS,LONG_GAIN,LONG_LOSS,TDS,PMS_PRODUCT,CONTRACT_NUMBER,CAST(SERVICE_TAX AS VARCHAR (100)) AS SERVICE_TAX, EDUCATION_CESS,EXCHANGE_LEVY,CAST(STAMPDUTY AS VARCHAR (100)) AS STAMPDUTY,  
CAST(OTHER_CHARGES AS VARCHAR (100)) AS OTHER_CHARGES, DEPOSITORY_ID,SETTLEMENT_TYPE,SETTLEMENT_NUMBER,CAST(SETTLEMENT_DATE AS VARCHAR (100)) AS SETTLEMENT_DATE,SEBI_REG_NO1,  
SEBI_SUB_CATEGORY,INSTRUMENT_SUB_TYPE,PANNO,NON_PINS_ACCOUNT  
FROM #FINAL_DATA  
  
--SELECT * FROM TBL_NRILECKOTAK_TEMP  
  
DECLARE @FILENAME1 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\HRISHI\NRI_CLIENTS\KOTAK_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'               
DECLARE @ALL1 VARCHAR(MAX)                        
                        
SET @ALL1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''BANK_ACC_NO'''',''''SCHEME'''',''''CLIENT_CODE'''',''''CLIENT_NAME'''',''''TRADE_DATE'''',''''VALAN'''',''''DEAL_TYPE'''',''''ISIN'''',''''SCRIPNAME'''',''''QUANTITY'''',''''GROSS_RATE'''',''''BROKERAGE'''',''''NET_RATE'''',''''AMOUNT'''',''''STT'''',''''TXN_TYPE'''',''''DP_ID'''',''''SHORT_GAIN'''',''''SHORT_LOSS'''',''''LONG_GAIN'''',''''LONG_LOSS'''',''''TDS'''',''''PMS_PRODUCT'''',''''CONTRACT_NUMBER'''',''''SERVICE_TAX'''',''''EDUCATION_CESS'''',''''EXCHANGE_LEVY'''',''''STAMPDUTY'''',''''OTHER_CHARGES'''',''''DEPOSITORY_ID'''',''''SETTLEMENT_TYPE'''',''''SETTLEMENT_NUMBER'''',''''SETTLEMENT_DATE'''',''''SEBI_REG_NO1'''',''''SEBI_SUB_CATEGORY'''',''''INSTRUMENT_SUB_TYPE'''',''''PANNO'''',''''NON_PINS_ACCOUNT'''''  
SET @ALL1 = @ALL1+ ' UNION ALL SELECT * FROM DUSTBIN..TBL_NRILECKOTAK_TEMP'                      
--PRINT @ALL1                        
SET @ALL1=@ALL1+' " QUERYOUT ' +@FILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                        
PRINT @ALL1                        
EXEC(@ALL1)  
  
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_LEDGER_BILL_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1                  
---- // DESCRIPTION :- ANAND GOLATKAR NEED LEDGER BILL DATA. CREATED BY HRISHI                  
-- EXEC [USP_LEDGER_BILL_DATA] 'FEB  8 2024'  
  
CREATE PROC [dbo].[USP_LEDGER_BILL_DATA]
AS

DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                         
SET @PATH='J:\Backoffice\SL_AUTO\ANAND_G\LEDGER_BILL_DATA\INPUT\DATE.TXT'                          

IF OBJECT_ID(N'tempdb..#LEDGER_DATE') IS NOT NULL                    
DROP TABLE #LEDGER_DATE
CREATE TABLE #LEDGER_DATE (FDATE VARCHAR(50))
                        
SET @SQL='BULK INSERT #LEDGER_DATE FROM ' + ''''+ @PATH +''''                        
SET @SQL2=' WITH                          
    (                          
           FIRSTROW = 1,                          
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                          
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                          
           TABLOCK                          
    )'                          
                        
SET @SQLFINAL= @SQL + @SQL2                          
PRINT @SQLFINAL                          
EXEC (@SQLFINAL)                        
                        
--SELECT TOP 10 * FROM #LEDGER_DATE

DECLARE @FDATE VARCHAR(11)
SELECT @FDATE=FDATE FROM #LEDGER_DATE          
PRINT @FDATE
  
SELECT CONVERT(VARCHAR(11),EDT) AS 'BILL_DATE' ,CLTCODE,EXCHANGE, AMT= SUM(CASE WHEN DRCR ='D' THEN VAMT ELSE VAMT*-1 END)   
INTO #TEMP  
FROM ACCOUNT.DBO.LEDGER_ALL WITH (NOLOCK) WHERE EDT = @FDATE AND VTYP='15'      
GROUP BY CLTCODE,EXCHANGE,CONVERT(VARCHAR(11),EDT)  
  
IF OBJECT_ID(N'DUSTBIN..TBL_LEDGER_BILL_DATA') IS NOT NULL              
DROP TABLE TBL_LEDGER_BILL_DATA    
  
SELECT BILL_DATE,CLTCODE,EXCHANGE,CONVERT(VARCHAR,AMT) AS AMT   
INTO DUSTBIN.DBO.TBL_LEDGER_BILL_DATA   
FROM #TEMP  
  
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_LEDGER_BILL_DATA  
    
--DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')    
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\ANAND_G\LEDGER_BILL_DATA\OUTPUT\' +'LEDGER_BILL_DATA' + '.CSV'  
DECLARE @ALL VARCHAR(MAX)    
    
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''BILL_DATE'''',''''CLTCODE'''',''''EXCHANGE'''',''''AMT'''''    
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_LEDGER_BILL_DATA'  
PRINT @ALL    
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'    
PRINT @ALL    
EXEC(@ALL)    

DROP TABLE #TEMP
DROP TABLE #LEDGER_DATE

SELECT 'LEDGER BILL DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MTF_BILL_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1                    
---- // DESCRIPTION :- ANAND GOLATKAR NEED MTF BILL DATA. CREATED BY HRISHI                    
-- EXEC [USP_MTF_BILL_DATA] 'FEB  8 2024'    
    
CREATE PROC [dbo].[USP_MTF_BILL_DATA]
AS  
  
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                           
SET @PATH='J:\Backoffice\SL_AUTO\ANAND_G\MTF_BILL_DATA\INPUT\DATE.TXT'                            
  
IF OBJECT_ID(N'tempdb..#MTF_DATE') IS NOT NULL                      
DROP TABLE #MTF_DATE  
CREATE TABLE #MTF_DATE (FDATE VARCHAR(50))  
                          
SET @SQL='BULK INSERT #MTF_DATE FROM ' + ''''+ @PATH +''''                          
SET @SQL2=' WITH                            
    (                            
           FIRSTROW = 1,                            
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                            
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                            
           TABLOCK                            
    )'                            
                          
SET @SQLFINAL= @SQL + @SQL2                            
PRINT @SQLFINAL                            
EXEC (@SQLFINAL)                          
                          
--SELECT TOP 10 * FROM #MTF_DATE  
  
DECLARE @FDATE VARCHAR(11)  
SELECT @FDATE=FDATE FROM #MTF_DATE            
PRINT @FDATE  

SELECT PARTY_CODE, COLL=SUM(NETAMT),LED=MAX(MTFLEDBAL)
INTO #TEMP
FROM MTFTRADE.DBO.TBL_MTF_DATA WHERE SAUDA_DATE =@FDATE
GROUP BY PARTY_CODE


IF OBJECT_ID(N'DUSTBIN..TBL_MTF_BILL_DATA') IS NOT NULL                
DROP TABLE DUSTBIN.DBO.TBL_MTF_BILL_DATA      
    
SELECT PARTY_CODE, CONVERT(VARCHAR(20),COLL) AS COLL, CONVERT(VARCHAR(20),LED) AS LED
INTO DUSTBIN.DBO.TBL_MTF_BILL_DATA     
FROM #TEMP    
    
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_MTF_BILL_DATA
      
--DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')      
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\ANAND_G\MTF_BILL_DATA\OUTPUT\' +'MTF_BILL_DATA' + '.CSV'    
DECLARE @ALL VARCHAR(MAX)      
      
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''PARTY_CODE'''',''''COLL'''',''''LED'''''      
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_MTF_BILL_DATA'    
PRINT @ALL      
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'      
PRINT @ALL      
EXEC(@ALL)      
  
DROP TABLE #TEMP  
DROP TABLE #MTF_DATE  
  
SELECT 'MTF BILL DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MTF_PLEDGE_RPT
-- --------------------------------------------------
            
---- // USE DUSTBIN   --- // 196.1.115.196                            
---- // DESCRIPTION :- MTF PLEDGE DATA REQUESTED BY SWAPNIL TADGE AND CREATED BY HRISHI      
                            
CREATE PROC USP_MTF_PLEDGE_RPT  
AS            
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                             
SET @PATH='J:\Backoffice\SL_AUTO\SWAPNIL_T\MTF_PLEDGE_RPT\INPUT\INPUT.txt'                              
  
 IF OBJECT_ID(N'tempdb..#CODE') IS NOT NULL  
    DROP TABLE #CODE            
CREATE TABLE #CODE (CODE VARCHAR(50))              
                            
SET @SQL='BULK INSERT #CODE FROM ' + ''''+ @PATH +''''            
SET @SQL2=' WITH            
    (                              
           FIRSTROW = 1,                              
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                              
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                              
           TABLOCK                              
    )'                              
                            
SET @SQLFINAL= @SQL + @SQL2                              
PRINT @SQLFINAL                              
EXEC (@SQLFINAL)                            
            
--SELECT TOP 10 * FROM #CODE              
--SELECT TOP 10 * FROM #DATA          
  
--SELECT COUNT(1) FROM [ANGELDEMAT].MSAJAG.DBO.TBL_POA_PLD_ADNL P INNER JOIN #CODE C ON P.SETT_NO=C.CODE  
  
IF OBJECT_ID(N'DUSTBIN..TBL_MTF_PLEDGE_DATA') IS NOT NULL                        
DROP TABLE TBL_MTF_PLEDGE_DATA   
  
SELECT SETT_NO,SETT_TYPE,PARTY_CODE,SCRIP_CD,SERIES,CERTNO,DPID,CLTDPID  
,CONVERT(VARCHAR(10), QTY) AS QTY  
,CAST(RTRIM(DELIVERED) AS VARCHAR(10)) AS DELIVERED  
,CONVERT(VARCHAR(16), FOLIONO) AS FOLIONO  
,CONVERT(VARCHAR(10), SLIPNO) AS SLIPNO ,BATCHNO  
,CONVERT(VARCHAR,EXEDATE,21) AS 'EXEDATE',CONVERT(VARCHAR,TRANSDATE,21) AS 'TRANSDATE'  
,CONVERT(VARCHAR,PROCESSDATE,21) AS 'PROCESSDATE' ,INST_TYPE  
,CONVERT(VARCHAR(10), CL_RATE) AS CL_RATE  
,CONVERT(VARCHAR(10), VARRATE) AS VARRATE ,BOID,PLDNO,UPLOAD_STATUS,SUCCESSFLAG  
,CONVERT(VARCHAR(10), PAYQTY) AS PAYQTY  
,CASE WHEN FOLIONO=BATCHNO THEN 'ONLINE' ELSE 'OFFLINE' END AS 'STATUS'   
INTO TBL_MTF_PLEDGE_DATA  
FROM [ANGELDEMAT].MSAJAG.DBO.TBL_POA_PLD_ADNL P INNER JOIN #CODE C ON P.SETT_NO=C.CODE  


  
--SELECT TOP 10 * FROM DUSTBIN.DBO.TBL_MTF_PLEDGE_DATA  
--SELECT TOP 10 * FROM [ANGELDEMAT].MSAJAG.DBO.TBL_POA_PLD_ADNL WHERE SETT_NO='2024003'  
              
DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')              
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\SWAPNIL_T\MTF_PLEDGE_RPT\OUTPUT\' +'MTF_PLEDGE_DATA.CSV'              
DECLARE @ALL VARCHAR(MAX)  
  
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''SETT_NO'''',''''SETT_TYPE'''',''''PARTY_CODE'''',''''SCRIP_CD'''',''''SERIES'''',''''CERTNO'''',''''DPID'''',''''CLTDPID'''',''''QTY'''',''''DELIVERED'''',''''FOLIONO'''',''''SLIPNO'''',''''BATCHNO'''',''''EXEDATE'''',''''TRANSDATE'''',''''PROCESSDATE'''',''''INST_TYPE'''',''''CL_RATE'''',''''VARRATE'''',''''BOID'''',''''PLDNO'''',''''UPLOAD_STATUS'''',''''SUCCESSFLAG'''',''''PAYQTY'''',''''STATUS'''''  
  
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_MTF_PLEDGE_DATA'             
PRINT @ALL              
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'  
PRINT @ALL              
EXEC(@ALL)  
  
DROP TABLE #CODE  
DROP TABLE DUSTBIN.DBO.TBL_MTF_PLEDGE_DATA  
                            
SELECT 'MTF PLEDGE DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NKAB_LEC
-- --------------------------------------------------


/*
----.91 USE DUSTBIN / INHOUSE
CREATED BY :- HRISHI ON 02-12-2025
DESCREPTION:- NKAB CLIENTS LEC FOR ALL BANKS
*/

CREATE PROC [dbo].[USP_NKAB_LEC] ( @SDATE AS VARCHAR(11) )
AS
BEGIN

SET @SDATE = CONVERT(VARCHAR(11), CONVERT(DATETIME, @SDATE, 103)) ----// 28/10/2025
--DECLARE @SDATE AS VARCHAR(11)='JAN  8 2026'   --, @CODE VARCHAR (50)='ZR0050096R'

SELECT PARTY_CODE,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,                          
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,                          
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)                          
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=                           
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,                          
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                          
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =                           
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                          
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +                          
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN                           
SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,                          
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),                          
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD),SERIES          
INTO #CMBILLVALAN_NSE    
FROM MSAJAG.DBO.CMBILLVALAN S WITH(NOLOCK)           
WHERE SAUDA_DATE=@SDATE AND SUB_BROKER IN ('BHKWT','BH','NKAB')
--WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN ( @CODE )  
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,SEGMENT,SERIES          
    
SELECT PARTY_CODE,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,                          
SEGMENT, LONG_NAME=PARTY_NAME,PTRADEDQTY = SUM(PQTYTRD + PQTYDEL) ,PTRADEDAMT = SUM(PAMTTRD + PAMTDEL) ,                          
STRADEDQTY = SUM(SQTYTRD + SQTYDEL), STRADEDAMT = SUM((CASE WHEN SQTYTRD = 0 AND SAMTTRD <> 0 THEN -SAMTTRD ELSE SAMTTRD END)                          
+ (CASE WHEN SQTYDEL = 0 AND SAMTDEL <> 0 THEN -SAMTDEL ELSE SAMTDEL END)), BUYBROKERAGE = SUM(PBROKTRD) , SELBROKERAGE=                           
SUM(SBROKTRD) , BUYDELIVERYCHRG = SUM(PBROKDEL), SELLDELIVERYCHRG = SUM(SBROKDEL), CLIENTTYPE, BILLPAMT = SUM(PAMT) ,                          
 BILLSAMT = SUM(SAMT) , PMARKETRATE = ( SUM(PRATE) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                          
 SMARKETRATE = ( SUM(SRATE) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ),  PNETRATE =                           
( SUM(PAMTTRD + PAMTDEL) / CASE WHEN SUM(PQTYTRD + PQTYDEL) > 0 THEN SUM(PQTYTRD + PQTYDEL) ELSE 1 END) ,                          
SNETRATE = ( SUM((CASE WHEN SQTYTRD =0 AND SAMTTRD<>0 THEN -SAMTTRD ELSE SAMTTRD END) +                          
(CASE WHEN SQTYDEL=0 AND SAMTDEL<>0 THEN -SAMTDEL ELSE SAMTDEL END)) / (CASE WHEN SUM(SQTYTRD + SQTYDEL) > 0 THEN SUM(SQTYTRD + SQTYDEL) ELSE 1 END ) ), TRDAMT= SUM(TRDAMT) ,
DELAMT=SUM(DELAMT), SERINEX=SUM(SERINEX),SERVICE_TAX= SUM(SERVICE_TAX) ,                          
EXSERVICE_TAX= SUM(EXSERVICE_TAX),TURN_TAX=SUM(TURN_TAX),SEBI_TAX=SUM(SEBI_TAX),INS_CHRG=SUM(INS_CHRG),BROKER_CHRG=SUM(BROKER_CHRG),                          
OTHER_CHRG=SUM(OTHER_CHRG), MEMBERTYPE,COMPANYNAME,PNL = SUM(SAMTTRD-PAMTTRD),SERIES          
INTO #CMBILLVALAN_BSE          
FROM ANGELBSECM.BSEDB_AB.DBO.CMBILLVALAN S WITH(NOLOCK)           
WHERE SAUDA_DATE=@SDATE AND SUB_BROKER IN ('BHKWT','BH','NKAB')
--WHERE SAUDA_DATE=@SDATE AND PARTY_CODE IN ( @CODE )  
GROUP BY S.PARTY_CODE, PARTY_NAME,CLIENTTYPE ,MEMBERTYPE,COMPANYNAME,SCRIP_CD,SAUDA_DATE,SCRIP_NAME,ISIN,CONTRACTNO,SETT_NO,SETT_TYPE,EXCHANGE,SEGMENT,SERIES   
  
--SELECT * FROM #CMBILLVALAN_NSE          
--SELECT * FROM #CMBILLVALAN_BSE WHERE PARTY_CODE IN ('ZR1577R','ZR1297R')  
  
----> NSE START          
SELECT * INTO #MAIN_DATA_NSE FROM #CMBILLVALAN_NSE WHERE CONTRACTNO<>'0000000'                
SELECT * INTO #C_ZERO_NSE FROM #CMBILLVALAN_NSE WHERE CONTRACTNO='0000000'              
          
SELECT M.PARTY_CODE, M.SCRIP_CD,M.SAUDA_DATE,M.SCRIP_NAME,M.ISIN,M.CONTRACTNO,M.SETT_NO,M.SETT_TYPE,M.EXCHANGE,M.SEGMENT,M.LONG_NAME,(M.PTRADEDQTY+Z.PTRADEDQTY) AS PTRADEDQTY,          
(M.PTRADEDAMT+Z.PTRADEDAMT) AS PTRADEDAMT, (M.STRADEDQTY+Z.STRADEDQTY) AS STRADEDQTY, (M.STRADEDAMT+Z.STRADEDAMT) AS STRADEDAMT, (M.BUYBROKERAGE+Z.BUYBROKERAGE) AS BUYBROKERAGE,          
(M.SELBROKERAGE+Z.SELBROKERAGE) AS SELBROKERAGE,(M.BUYDELIVERYCHRG+Z.BUYDELIVERYCHRG) AS BUYDELIVERYCHRG,(M.SELLDELIVERYCHRG+Z.SELLDELIVERYCHRG) AS SELLDELIVERYCHRG,M.CLIENTTYPE,          
(M.BILLPAMT+Z.BILLPAMT) AS BILLPAMT,(M.BILLSAMT+Z.BILLSAMT) AS BILLSAMT,(M.PMARKETRATE+Z.PMARKETRATE) AS PMARKETRATE,(M.SMARKETRATE+Z.SMARKETRATE) AS SMARKETRATE,          
(M.PNETRATE+Z.PNETRATE) AS PNETRATE,(M.SNETRATE+Z.SNETRATE) AS SNETRATE,(M.TRDAMT+Z.TRDAMT) AS TRDAMT,(M.DELAMT+Z.DELAMT) AS DELAMT,(M.SERINEX+Z.SERINEX) AS SERINEX,          
(M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EXSERVICE_TAX+Z.EXSERVICE_TAX) AS EXSERVICE_TAX,(M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX,          
(M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG,(M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG,(M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG,M.MEMBERTYPE,M.COMPANYNAME, (M.PNL+Z.PNL) AS PNL,M.SERIES          
INTO #ACTUAL_CN_ZERO              
FROM #MAIN_DATA_NSE M INNER JOIN #C_ZERO_NSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD          
          
DELETE FROM #MAIN_DATA_NSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_NSE)              
          
INSERT INTO #MAIN_DATA_NSE              
SELECT * FROM #ACTUAL_CN_ZERO             
----> NSE END          
          
----> BSE START          
SELECT * INTO #MAIN_DATA_BSE FROM #CMBILLVALAN_BSE WHERE CONTRACTNO<>'0000000'                
SELECT * INTO #C_ZERO_BSE FROM #CMBILLVALAN_BSE WHERE CONTRACTNO='0000000'              
          
SELECT M.PARTY_CODE, M.SCRIP_CD,M.SAUDA_DATE,M.SCRIP_NAME,M.ISIN,M.CONTRACTNO,M.SETT_NO,M.SETT_TYPE,M.EXCHANGE,M.SEGMENT,M.LONG_NAME,(M.PTRADEDQTY+Z.PTRADEDQTY) AS PTRADEDQTY,          
(M.PTRADEDAMT+Z.PTRADEDAMT) AS PTRADEDAMT, (M.STRADEDQTY+Z.STRADEDQTY) AS STRADEDQTY, (M.STRADEDAMT+Z.STRADEDAMT) AS STRADEDAMT, (M.BUYBROKERAGE+Z.BUYBROKERAGE) AS BUYBROKERAGE,          
(M.SELBROKERAGE+Z.SELBROKERAGE) AS SELBROKERAGE,(M.BUYDELIVERYCHRG+Z.BUYDELIVERYCHRG) AS BUYDELIVERYCHRG,(M.SELLDELIVERYCHRG+Z.SELLDELIVERYCHRG) AS SELLDELIVERYCHRG,M.CLIENTTYPE,          
(M.BILLPAMT+Z.BILLPAMT) AS BILLPAMT,(M.BILLSAMT+Z.BILLSAMT) AS BILLSAMT,(M.PMARKETRATE+Z.PMARKETRATE) AS PMARKETRATE,(M.SMARKETRATE+Z.SMARKETRATE) AS SMARKETRATE,          
(M.PNETRATE+Z.PNETRATE) AS PNETRATE,(M.SNETRATE+Z.SNETRATE) AS SNETRATE,(M.TRDAMT+Z.TRDAMT) AS TRDAMT,(M.DELAMT+Z.DELAMT) AS DELAMT,(M.SERINEX+Z.SERINEX) AS SERINEX,          
(M.SERVICE_TAX+Z.SERVICE_TAX) AS SERVICE_TAX,(M.EXSERVICE_TAX+Z.EXSERVICE_TAX) AS EXSERVICE_TAX,(M.TURN_TAX+Z.TURN_TAX) AS TURN_TAX,(M.SEBI_TAX+Z.SEBI_TAX) AS SEBI_TAX,          
(M.INS_CHRG+Z.INS_CHRG) AS INS_CHRG,(M.BROKER_CHRG+Z.BROKER_CHRG) AS BROKER_CHRG,(M.OTHER_CHRG+Z.OTHER_CHRG) AS OTHER_CHRG,M.MEMBERTYPE,M.COMPANYNAME, (M.PNL+Z.PNL) AS PNL,M.SERIES          
INTO #ACTUAL_CN_ZERO_BSE              
FROM #MAIN_DATA_BSE M INNER JOIN #C_ZERO_BSE Z ON Z.PARTY_CODE=M.PARTY_CODE AND Z.SETT_TYPE=M.SETT_TYPE AND Z.SCRIP_CD=M.SCRIP_CD          
          
DELETE FROM #MAIN_DATA_BSE WHERE PARTY_CODE IN (SELECT PARTY_CODE FROM #C_ZERO_BSE)          
          
INSERT INTO #MAIN_DATA_BSE          
SELECT * FROM #ACTUAL_CN_ZERO_BSE          
----> BSE END          
  
CREATE TABLE #MAIN_DATA               
(          
 PARTY_CODE VARCHAR (100),          
 SCRIP_CD VARCHAR (100),          
 SAUDA_DATE VARCHAR (11),          
 SCRIP_NAME VARCHAR (100),          
 ISIN VARCHAR (100),          
 CONTRACTNO VARCHAR (100),          
 SETT_NO VARCHAR (100),          
 SETT_TYPE VARCHAR (100),          
 EXCHANGE VARCHAR (100),          
 SEGMENT VARCHAR (100),          
 LONG_NAME VARCHAR (100),          
 PTRADEDQTY INT,          
 PTRADEDAMT MONEY,          
 STRADEDQTY INT,          
 STRADEDAMT MONEY,          
 BUYBROKERAGE MONEY,          
 SELBROKERAGE MONEY,          
 BUYDELIVERYCHRG MONEY,          
 SELLDELIVERYCHRG MONEY,          
 CLIENTTYPE VARCHAR (100),          
 BILLPAMT MONEY,          
 BILLSAMT MONEY,          
 PMARKETRATE MONEY,          
 SMARKETRATE MONEY,          
 PNETRATE MONEY,          
 SNETRATE MONEY,          
 TRDAMT MONEY,          
 DELAMT MONEY,          
 SERINEX MONEY,          
 SERVICE_TAX MONEY,          
 EXSERVICE_TAX MONEY,          
 TURN_TAX MONEY,          
 SEBI_TAX MONEY,          
 INS_CHRG MONEY,          
 BROKER_CHRG MONEY,          
 OTHER_CHRG MONEY,          
 MEMBERTYPE VARCHAR (100),          
 COMPANYNAME VARCHAR (100),          
 PNL MONEY,          
 SERIES VARCHAR (100)          
)          
          
INSERT INTO #MAIN_DATA              
SELECT * FROM #MAIN_DATA_NSE              
UNION ALL              
SELECT * FROM #MAIN_DATA_BSE              
  
SELECT *, CLIPISNO= CASE WHEN ( ISNULL(FLD_CLIENTPISAC,'0')='0') THEN FLD_NROPISNO  ELSE FLD_CLIENTPISAC END,              
CLIBNKACC= CASE WHEN (ISNULL(FLD_NREACNO,'0')='0') THEN FLD_NROACNO  ELSE FLD_NREACNO END  
INTO #TBL_NRICLIENTMASTER               
FROM INTRANET.RISK.DBO.TBL_NRICLIENTMASTER WITH (NOLOCK)  
  
SELECT * INTO #V_NriBank_Details FROM INTRANET.RISK.[dbo].[V_NriBank_Details]  
SELECT * INTO #CLIENT_DETAILS FROM [INTRANET].RISK.DBO.CLIENT_DETAILS WHERE CL_TYPE='NRI'  
  
SELECT PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,ISIN,SCRIPNAME,SUM(IPFT_CHRG) AS IPFT_CHRG INTO #CONTRACT      
FROM MSAJAG.DBO.COMMON_CONTRACT_DATA WITH(NOLOCK) WHERE SAUDA_DATE=@SDATE --AND PARTY_CODE IN ('ZR1703R')      
GROUP BY PARTY_CODE,SAUDA_DATE,CONTRACTNO_NEW,ISIN,SCRIPNAME      
  
ALTER TABLE #MAIN_DATA ADD CONTRACTNO_NEW VARCHAR(100)      
ALTER TABLE #MAIN_DATA ADD IPFT MONEY  
ALTER TABLE #MAIN_DATA ADD [BUY/SELL] VARCHAR (10)  
  
UPDATE #MAIN_DATA SET [BUY/SELL]=CASE WHEN BILLPAMT<>'0.00' AND BILLSAMT='0.00' THEN 'B' ELSE 'S' END   
      
UPDATE A SET A.CONTRACTNO_NEW=B.CONTRACTNO_NEW, A.IPFT=B.IPFT_CHRG       
--SELECT A.PARTY_CODE,A.CONTRACTNO_NEW,B.CONTRACTNO_NEW, A.IPFT,B.IPFT_CHRG      
FROM #MAIN_DATA A, #CONTRACT B       
WHERE A.PARTY_CODE=B.PARTY_CODE AND A.SAUDA_DATE=B.SAUDA_DATE AND A.ISIN=B.ISIN       

------- HDFC AND YES BANK START

SELECT [BANK NAME]=V.FLD_BANKNAME,[TRADE DATE]=C.SAUDA_DATE, [TRADING ID]=C.PARTY_CODE, [DP ID]=SUBSTRING(N.FLD_DEMATACNO,1,8), [DEMAT A/C NO]=SUBSTRING(N.FLD_DEMATACNO,9,25),
[INVESTOR NAME]=B.SHORT_NAME, C.EXCHANGE, [SETTLEMENT NO]=C.SETT_NO, [CONTRACT NO]=C.CONTRACTNO_NEW, [SCRIP CODE]=C.SCRIP_CD, C.ISIN, C.SCRIP_NAME, [BUY/SELL], 
[QUANTITY]=C.PTRADEDQTY+C.STRADEDQTY, [WEIGHTED AVERAGE MARKET RATE]=ROUND(C.PNETRATE+C.SNETRATE,2),
[TOTAL MARKET VALUE]=ROUND (CASE WHEN PMARKETRATE<>0 AND PTRADEDQTY<>0 THEN (C.PMARKETRATE*PTRADEDQTY) WHEN SMARKETRATE<>0 AND STRADEDQTY<>0 THEN (SMARKETRATE*STRADEDQTY) END ,2),
[NET RATE]=ROUND (C.PMARKETRATE+C.SMARKETRATE ,2), BROKEARGE=ROUND(C.BUYDELIVERYCHRG+C.SELLDELIVERYCHRG, 2), [OTHER CHARGES]=ROUND(C.SERVICE_TAX+C.TURN_TAX+C.SEBI_TAX+C.BROKER_CHRG+C.IPFT, 2),
[NET PURCHASE/SALE VALUE]=ROUND((C.PMARKETRATE*PTRADEDQTY+C.BUYDELIVERYCHRG+C.SELLDELIVERYCHRG+C.SERVICE_TAX+C.TURN_TAX+C.SEBI_TAX+C.BROKER_CHRG+C.IPFT),2), 
[STT ON BUY & SALE]=C.INS_CHRG,
[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]= ROUND((C.PMARKETRATE*PTRADEDQTY+C.BUYDELIVERYCHRG+C.SELLDELIVERYCHRG+C.SERVICE_TAX+C.TURN_TAX+C.SEBI_TAX+C.BROKER_CHRG+C.IPFT+C.INS_CHRG),2),
[RBI APPROVAL NO]=ISNULL(N.RBI_REFNO,''),
[PIS ACCOUNT NO]=N.CLIPISNO, [SAVING BANK ACCOUNT NO]=N.CLIBNKACC, [BANK BRANCH NAME]=V.FLD_BRANCHLOCATION, [BROKER NAME]='ANGEL ONE LTD',
[DATE OF RECEIPT /PAYMENT]=CASE WHEN [BUY/SELL]= 'B' THEN CONVERT(VARCHAR,DATEADD(DAY, 1, SAUDA_DATE),103) WHEN [BUY/SELL]= 'S' THEN CONVERT(VARCHAR,DATEADD(DAY, 2, SAUDA_DATE),103) END,
[DEMAT DEBIT /CREDIT DATE]=CASE WHEN [BUY/SELL]= 'B' THEN CONVERT(VARCHAR,DATEADD(DAY, 1, SAUDA_DATE),103) WHEN [BUY/SELL]= 'S' THEN CONVERT(VARCHAR,DATEADD(DAY, 2, SAUDA_DATE),103) END,
[BROKER A/C NO]= CASE WHEN [BUY/SELL]= 'B'THEN V.Fld_BankPISAc ELSE V.Fld_AngelAcc END
INTO #FINAL_HDFC_YES 
FROM #MAIN_DATA C LEFT JOIN #TBL_NRICLIENTMASTER N ON N.FLD_CLIENTCODE=C.PARTY_CODE LEFT JOIN #V_NRIBANK_DETAILS V ON V.FLD_CLIENTCODE=N.FLD_CLIENTCODE
LEFT OUTER JOIN #CLIENT_DETAILS B WITH (NOLOCK) ON C.PARTY_CODE=B.PARTY_CODE
--WHERE C.PARTY_CODE IN ('ZR1577R','ZR0050096R')

TRUNCATE TABLE DUSTBIN.DBO.TBL_NRI_NKAB_LEC_HDFC_YES

INSERT INTO DUSTBIN.DBO.TBL_NRI_NKAB_LEC_HDFC_YES
SELECT [BANK NAME], CONVERT(VARCHAR(10), CONVERT(DATE, [TRADE DATE], 113),105) AS [TRADE DATE], CONVERT(VARCHAR,[TRADING ID]) AS [TRADING ID], CONVERT(VARCHAR,[DP ID]) AS [DP ID],
CONVERT(VARCHAR,[DEMAT A/C NO]) AS [DEMAT A/C NO], CONVERT(VARCHAR,[INVESTOR NAME]) AS [INVESTOR NAME], CONVERT(VARCHAR,[EXCHANGE]) AS [EXCHANGE], CONVERT(VARCHAR,[SETTLEMENT NO]) AS [SETTLEMENT NO],
CONVERT(VARCHAR,[CONTRACT NO]) AS [CONTRACT NO], CONVERT(VARCHAR,[SCRIP CODE]) AS [SCRIP CODE], CONVERT(VARCHAR,[ISIN]) AS [ISIN], CONVERT(VARCHAR,[SCRIP_NAME]) AS [SCRIP_NAME],
CONVERT(VARCHAR,[BUY/SELL]) AS [BUY/SELL], CONVERT(VARCHAR,[QUANTITY]) AS [QUANTITY], CONVERT(VARCHAR,[WEIGHTED AVERAGE MARKET RATE]) AS [WEIGHTED AVERAGE MARKET RATE],
CONVERT(VARCHAR,[TOTAL MARKET VALUE]) AS [TOTAL MARKET VALUE], CONVERT(VARCHAR,[NET RATE]) AS [NET RATE], CONVERT(VARCHAR,[BROKEARGE]) AS [BROKEARGE], 
CONVERT(VARCHAR,[OTHER CHARGES]) AS [OTHER CHARGES], CONVERT(VARCHAR,[NET PURCHASE/SALE VALUE]) AS [NET PURCHASE/SALE VALUE], CONVERT(VARCHAR,[STT ON BUY & SALE]) AS [STT ON BUY & SALE],
CONVERT(VARCHAR,[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]) AS [EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)],
CONVERT(VARCHAR,[RBI APPROVAL NO]) AS [RBI APPROVAL NO], CONVERT(VARCHAR,[PIS ACCOUNT NO]) AS [PIS ACCOUNT NO], CONVERT(VARCHAR,[SAVING BANK ACCOUNT NO]) AS [SAVING BANK ACCOUNT NO],
CONVERT(VARCHAR,[BANK BRANCH NAME]) AS [BANK BRANCH NAME], CONVERT(VARCHAR,[BROKER NAME]) AS [BROKER NAME], CONVERT(VARCHAR,[DATE OF RECEIPT /PAYMENT]) AS [DATE OF RECEIPT /PAYMENT],
CONVERT(VARCHAR,[DEMAT DEBIT /CREDIT DATE]) AS [DEMAT DEBIT /CREDIT DATE], CONVERT(VARCHAR,[BROKER A/C NO]) AS [BROKER A/C NO]
FROM #FINAL_HDFC_YES


IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_HDFC_YES where [BANK NAME] like '%hdfc%')>0)                          
 BEGIN          
  DECLARE @FILENAME1 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\HDFC_NKAB_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                       
  DECLARE @ALL1 VARCHAR(MAX)                                
                                
  SET @ALL1 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''[BANK NAME]'''',''''[TRADE DATE]'''',''''[TRADING ID]'''',''''[DP ID]'''',''''[DEMAT A/C NO]'''',''''[INVESTOR NAME]'''',''''[EXCHANGE]'''',''''[SETTLEMENT NO]'''',''''[CONTRACT NO]'''',''''[SCRIP CODE]'''',''''[ISIN]'''',''''[SCRIP_NAME]'''',''''[BUY/SELL]'''',''''[QUANTITY]'''',''''[WEIGHTED AVERAGE MARKET RATE]'''',''''[TOTAL MARKET VALUE]'''',''''[NET RATE]'''',''''[BROKEARGE]'''',''''[OTHER CHARGES]'''',''''[NET PURCHASE/SALE VALUE]'''',''''[STT ON BUY & SALE]'''',''''[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]'''',''''[RBI APPROVAL NO]'''',''''[PIS ACCOUNT NO]'''',''''[SAVING BANK ACCOUNT NO]'''',''''[BANK BRANCH NAME]'''',''''[BROKER NAME]'''',''''[DATE OF RECEIPT /PAYMENT]'''',''''[DEMAT DEBIT /CREDIT DATE]'''',''''[BROKER A/C NO]'''''
  SET @ALL1 = @ALL1+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_HDFC_YES WHERE [BANK NAME] like ''''%hdfc%'''''                              
  --PRINT @ALL1                                
  SET @ALL1=@ALL1+' " QUERYOUT ' +@FILENAME1+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                                
  PRINT @ALL1                                
  EXEC(@ALL1)          
  SELECT '<a href='+replace(@FILENAME1,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- HDFC Bank</a><br>'   
 END

 IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_HDFC_YES where [BANK NAME] like '%YES%')>0)                          
 BEGIN          
  DECLARE @FILENAME2 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\YES_NKAB_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                       
  DECLARE @ALL2 VARCHAR(MAX)                                
                                
  SET @ALL2 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''[BANK NAME]'''',''''[TRADE DATE]'''',''''[TRADING ID]'''',''''[DP ID]'''',''''[DEMAT A/C NO]'''',''''[INVESTOR NAME]'''',''''[EXCHANGE]'''',''''[SETTLEMENT NO]'''',''''[CONTRACT NO]'''',''''[SCRIP CODE]'''',''''[ISIN]'''',''''[SCRIP_NAME]'''',''''[BUY/SELL]'''',''''[QUANTITY]'''',''''[WEIGHTED AVERAGE MARKET RATE]'''',''''[TOTAL MARKET VALUE]'''',''''[NET RATE]'''',''''[BROKEARGE]'''',''''[OTHER CHARGES]'''',''''[NET PURCHASE/SALE VALUE]'''',''''[STT ON BUY & SALE]'''',''''[EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)]'''',''''[RBI APPROVAL NO]'''',''''[PIS ACCOUNT NO]'''',''''[SAVING BANK ACCOUNT NO]'''',''''[BANK BRANCH NAME]'''',''''[BROKER NAME]'''',''''[DATE OF RECEIPT /PAYMENT]'''',''''[DEMAT DEBIT /CREDIT DATE]'''',''''[BROKER A/C NO]'''''
  SET @ALL2 = @ALL2+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_HDFC_YES WHERE [BANK NAME] like ''''%YES%'''''                              
  --PRINT @ALL2
  SET @ALL2=@ALL2+' " QUERYOUT ' +@FILENAME2+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                                
  PRINT @ALL2                                
  EXEC(@ALL2)          
  SELECT '<a href='+replace(@FILENAME2,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- YES Bank</a><br>'   
 END  
------- HDFC AND YES BANK END

------- KOTAK BANK START

SELECT N.CLIPISNO AS BANK_ACC_NO, SCHEME='OFFLINE', M.PARTY_CODE AS CLIENT_CODE, CLIENT_NAME =M.LONG_NAME, M.SAUDA_DATE AS TRADE_DATE,VALAN=M.SETT_TYPE+'/'+M.SETT_NO,        
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN 'B' ELSE 'S' END AS DEAL_TYPE, M.ISIN, M.SCRIP_NAME AS SCRIPNAME,      
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PTRADEDQTY ELSE STRADEDQTY END AS QUANTITY,        
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PNETRATE ELSE SNETRATE END AS GROSS_RATE,     
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN BUYDELIVERYCHRG ELSE SELLDELIVERYCHRG END AS BROKERAGE,        
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN PMARKETRATE ELSE SMARKETRATE END AS NET_RATE,    
    --CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN BILLPAMT ELSE BILLSAMT END AS AMOUNT,    
--CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN (PMARKETRATE*PTRADEDQTY)+BUYDELIVERYCHRG+(SERVICE_TAX+TURN_TAX+SEBI_TAX+BROKER_CHRG+IPFT)     
--     ELSE (SMARKETRATE*STRADEDQTY)-SELLDELIVERYCHRG-(SERVICE_TAX+TURN_TAX+SEBI_TAX+BROKER_CHRG+IPFT) END AS AMOUNT,    
    
CASE WHEN M.BILLPAMT<>'0.00' AND M.BILLSAMT='0.00' THEN M.TRDAMT+BUYDELIVERYCHRG+(M.SERVICE_TAX+M.TURN_TAX+M.SEBI_TAX+M.BROKER_CHRG+M.IPFT)+INS_CHRG    
ELSE M.TRDAMT-SELLDELIVERYCHRG-(M.SERVICE_TAX+M.TURN_TAX+M.SEBI_TAX+M.BROKER_CHRG+M.IPFT)-INS_CHRG END AS AMOUNT,
INS_CHRG AS STT, TXN_TYPE='0', DP_ID=SUBSTRING(N.FLD_DEMATACNO,9,25),SHORT_GAIN='0', SHORT_LOSS='0', LONG_GAIN='0', LONG_LOSS='0', TDS='0', PMS_PRODUCT='0',      
M.CONTRACTNO_NEW AS CONTRACT_NUMBER, M.SERVICE_TAX, EDUCATION_CESS='0', EXCHANGE_LEVY='0', M.BROKER_CHRG AS STAMPDUTY, --M.OTHER_CHRG AS OTHER_CHARGES,       
(M.TURN_TAX+M.SEBI_TAX+M.IPFT) AS OTHER_CHARGES, -- ADDED ON 15 JUL 2025     
DEPOSITORY_ID=SUBSTRING(N.FLD_DEMATACNO,1,8), M.SETT_TYPE AS SETTLEMENT_TYPE, M.SETT_NO AS SETTLEMENT_NUMBER, SETTLEMENT_DATE=DATEADD(DAY,1,      
CONVERT(DATE,M.SAUDA_DATE)), SEBI_REG_NO1='CDSL REGISTERATION #', SEBI_SUB_CATEGORY=M.CLIENTTYPE, INSTRUMENT_SUB_TYPE=M.SERIES, PANNO='-', NON_PINS_ACCOUNT=N.CLIBNKACC        
INTO #FINAL_KOTAK        
FROM #MAIN_DATA M LEFT JOIN #TBL_NRICLIENTMASTER N ON M.PARTY_CODE = N.FLD_CLIENTCODE
WHERE Fld_BankId='102'  --FOR KOTAK CLIENTS ONLY

UPDATE #FINAL_KOTAK SET CLIENT_NAME=C.LONG_NAME FROM #FINAL_KOTAK F INNER JOIN #CLIENT_DETAILS C ON F.CLIENT_CODE=C.CL_CODE     

TRUNCATE TABLE DUSTBIN.DBO.TBL_NRI_NKAB_LEC_KOTAK

INSERT INTO DUSTBIN.DBO.TBL_NRI_NKAB_LEC_KOTAK
SELECT BANK_ACC_NO,SCHEME,CLIENT_CODE,CLIENT_NAME,TRADE_DATE,VALAN,DEAL_TYPE, ISIN, SCRIPNAME, CAST(QUANTITY AS VARCHAR (100)) AS QUANTITY, CAST(GROSS_RATE AS VARCHAR (100)) AS GROSS_RATE,          
CAST(BROKERAGE AS VARCHAR (100)) AS BROKERAGE, CAST(NET_RATE AS VARCHAR (100)) AS NET_RATE,CAST(AMOUNT AS VARCHAR (100)) AS AMOUNT, CAST(STT AS VARCHAR (100)) AS STT, TXN_TYPE,DP_ID,SHORT_GAIN,          
SHORT_LOSS,LONG_GAIN,LONG_LOSS,TDS,PMS_PRODUCT,CONTRACT_NUMBER,CAST(SERVICE_TAX AS VARCHAR (100)) AS SERVICE_TAX, EDUCATION_CESS,EXCHANGE_LEVY,CAST(STAMPDUTY AS VARCHAR (100)) AS STAMPDUTY,          
CAST(OTHER_CHARGES AS VARCHAR (100)) AS OTHER_CHARGES, DEPOSITORY_ID,SETTLEMENT_TYPE,SETTLEMENT_NUMBER,CAST(SETTLEMENT_DATE AS VARCHAR (100)) AS SETTLEMENT_DATE,SEBI_REG_NO1,          
SEBI_SUB_CATEGORY,INSTRUMENT_SUB_TYPE,PANNO,NON_PINS_ACCOUNT          
FROM #FINAL_KOTAK

IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_KOTAK)>0)                          
 BEGIN          
  DECLARE @FILENAME3 VARCHAR(100) = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\KOTAK_NKAB_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.CSV'                       
  DECLARE @ALL3 VARCHAR(MAX)                                
                                
  SET @ALL3 = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''BANK_ACC_NO'''',''''SCHEME'''',''''CLIENT_CODE'''',''''CLIENT_NAME'''',''''TRADE_DATE'''',''''VALAN'''',''''DEAL_TYPE'''',''''ISIN'''',''''SCRIPNAME'''',''''QUANTITY'''',''''GROSS_RATE'''',''''BROKERAGE'''',''''NET_RATE'''',''''AMOUNT'''',''''STT'''',''''TXN_TYPE'''',''''DP_ID'''',''''SHORT_GAIN'''',''''SHORT_LOSS'''',''''LONG_GAIN'''',''''LONG_LOSS'''',''''TDS'''',''''PMS_PRODUCT'''',''''CONTRACT_NUMBER'''',''''SERVICE_TAX'''',''''EDUCATION_CESS'''',''''EXCHANGE_LEVY'''',''''STAMPDUTY'''',''''OTHER_CHARGES'''',''''DEPOSITORY_ID'''',''''SETTLEMENT_TYPE'''',''''SETTLEMENT_NUMBER'''',''''SETTLEMENT_DATE'''',''''SEBI_REG_NO1'''',''''SEBI_SUB_CATEGORY'''',''''INSTRUMENT_SUB_TYPE'''',''''PANNO'''',''''NON_PINS_ACCOUNT'''''
  SET @ALL3 = @ALL3+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_KOTAK'                              
  --PRINT @ALL3                                
  SET @ALL3=@ALL3+' " QUERYOUT ' +@FILENAME3+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'                                
  PRINT @ALL3                                
  EXEC(@ALL3)          
  SELECT '<a href='+replace(@FILENAME3,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- KOTAK Bank</a><br>'   
 END

------- KOTAK BANK END

------- ALL BANK STARTS

SELECT V.Fld_BankName AS 'BANKNAME', 'H' AS 'HEAD', PARTY_CODE, REPLACE(CONVERT(date,(M.SAUDA_DATE),112),'-','') AS SAUDA_DATE, CONTRACTNO, 
ROUND(SERVICE_TAX,2) AS SERVICE_TAX, '0' AS 'HARD_CODE1',ROUND(TURN_TAX,2) AS TURN_TAX, ROUND(INS_CHRG,2) AS 'STT', OTHER_CHARGES=ROUND(BROKER_CHRG,2),
ROUND(SEBI_TAX,2) AS SEBI_TAX, '1' AS 'NO_OF_TRADE', 
NET_AMOUNT= CASE WHEN [BUY/SELL]='S' THEN ROUND(M.BILLSAMT,2) WHEN [BUY/SELL]='B' THEN M.BILLPAMT END,DP_ACCOUNT=SUBSTRING(N.FLD_DEMATACNO,1,8), 
DP_ACCOUNT2=SUBSTRING(N.FLD_DEMATACNO,9,25), EXCHANGE, [BUY/SELL], 'A' AS 'HARD_CODE2', 'T1' AS 'HARD_CODE3', M.SETT_NO, 
SETT_DATE=REPLACE(CONVERT(date,(DATEADD(day,2,M.SAUDA_DATE)),112),'-','')
INTO #HEAD_DATA
FROM #MAIN_DATA M 
LEFT JOIN #TBL_NRICLIENTMASTER N ON M.PARTY_CODE=N.FLD_CLIENTCODE
LEFT JOIN #V_NRIBANK_DETAILS V ON M.PARTY_CODE=V.Fld_ClientCode
--WHERE PARTY_CODE IN ('ZR1577R','ZR1297R','ZR844R')

SELECT V.Fld_BankName AS 'BANKNAME', 'T' AS 'HEAD', PARTY_CODE, CONTRACTNO, [BUY/SELL], M.ISIN, M.STRADEDQTY, SMARKETRATE, SELLDELIVERYCHRG, STRADEDAMT, SCRIP_NAME
INTO #TAIL_DATA
FROM #MAIN_DATA M LEFT JOIN #V_NRIBANK_DETAILS V ON M.PARTY_CODE=V.Fld_ClientCode
--WHERE PARTY_CODE IN ('ZR1577R','ZR1297R','ZR844R')

TRUNCATE TABLE DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS

INSERT INTO DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS
SELECT BANKNAME, PARTY_CODE, HEAD,
'H' +','+ PARTY_CODE +','+ SAUDA_DATE +','+ CONTRACTNO +','+ CAST(CONVERT(DEC(20,2),SERVICE_TAX) AS VARCHAR) +','+ '0' +','+ 
CAST(CONVERT(DEC(20,2),TURN_TAX) AS VARCHAR) +','+ 
CAST(CONVERT(DEC(20,2),STT) AS VARCHAR) +','+ CAST(CONVERT(DEC(20,2),OTHER_CHARGES) AS VARCHAR) +','+ CAST(CONVERT(DEC(20,2),SEBI_TAX) AS VARCHAR) +','+ 
NO_OF_TRADE +','+ CAST(CONVERT(DEC(20,2),NET_AMOUNT) AS VARCHAR) +','+ DP_ACCOUNT	+','+ DP_ACCOUNT2 +','+EXCHANGE +','+ [BUY/SELL] +','+ 
HARD_CODE2 +','+ HARD_CODE3 +','+ SETT_NO +','+ SETT_DATE AS 'DATA'
FROM #HEAD_DATA
UNION ALL
SELECT BANKNAME, PARTY_CODE, HEAD,
'T' +','+ PARTY_CODE +','+ CONTRACTNO +','+ [BUY/SELL] +','+ ISIN +','+ CAST(STRADEDQTY AS VARCHAR) +','+ CAST(SMARKETRATE AS VARCHAR) +','+ 
CAST(CONVERT(DEC(20,4),SELLDELIVERYCHRG) AS VARCHAR) +','+ CAST(CONVERT(DEC(20,4),STRADEDAMT) AS VARCHAR) +','+ SCRIP_NAME AS 'DATA'
FROM #TAIL_DATA

----SELECT * FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS ORDER BY PARTY_CODE

DECLARE @AXISFILENAME AS VARCHAR(200)
DECLARE @BCPCOMMAND1 AS VARCHAR(1000)
IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS WHERE BANKNAME LIKE '%AXIS%')>0)                          
     BEGIN                          
      SET @AXISFILENAME = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\AXIS_NKAB_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.TXT'                           
      SET @BCPCOMMAND1 = 'BCP "SELECT DETAILS FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS WHERE BANKNAME LIKE ''%AXIS%'' ORDER BY PARTY_CODE,HEAD" QUERYOUT "'                          
      SET @BCPCOMMAND1 = @BCPCOMMAND1 + @AXISFILENAME + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
      EXEC MASTER..XP_CMDSHELL @BCPCOMMAND1
	 END
SELECT '<a href='+replace(@AXISFILENAME,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- AXIS_NKAB</a><br>'

DECLARE @INDUSINDFILENAME AS VARCHAR(200)
DECLARE @BCPCOMMAND2 AS VARCHAR(1000)
IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS WHERE BANKNAME LIKE '%INDUSIND%')>0)                          
     BEGIN                          
      SET @INDUSINDFILENAME = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\INDUSIND_NKAB_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.TXT'                           
      SET @BCPCOMMAND2 = 'BCP "SELECT DETAILS FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS WHERE BANKNAME LIKE ''%INDUSIND%'' ORDER BY PARTY_CODE,HEAD" QUERYOUT "'                          
      SET @BCPCOMMAND2 = @BCPCOMMAND2 + @INDUSINDFILENAME + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
      EXEC MASTER..XP_CMDSHELL @BCPCOMMAND2
	 END
SELECT '<a href='+replace(@INDUSINDFILENAME,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- INDUSIND_NKAB</a><br>'

DECLARE @IDFCFILENAME AS VARCHAR(200)
DECLARE @BCPCOMMAND3 AS VARCHAR(1000)
IF ((SELECT COUNT(1) FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS WHERE BANKNAME LIKE '%IDFC%')>0)                          
     BEGIN                          
      SET @IDFCFILENAME = '\\INHOUSELIVEAPP1-FS.ANGELONE.IN\UPLOAD1\NRI_CLIENTS\IDFC_NKAB_'+REPLACE (CONVERT (VARCHAR(12),GETDATE(),103),'/','')+'.TXT'                           
      SET @BCPCOMMAND3 = 'BCP "SELECT DETAILS FROM DUSTBIN.DBO.TBL_NRI_NKAB_LEC_ALLBANKS WHERE BANKNAME LIKE ''%IDFC%'' ORDER BY PARTY_CODE,HEAD" QUERYOUT "'                          
      SET @BCPCOMMAND3 = @BCPCOMMAND3 + @IDFCFILENAME + '" -c -t, -SABVSNSECM.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
      EXEC MASTER..XP_CMDSHELL @BCPCOMMAND3
	 END
SELECT '<a href='+replace(@IDFCFILENAME,'\\INHOUSELIVEAPP1-FS.angelone.in','')+'>Right click and save -- IDFC_NKAB</a><br>'

------- ALL BANK END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PAYIN_OUT_KOTAK
-- --------------------------------------------------

CREATE PROC USP_PAYIN_OUT_KOTAK (@SDATE VARCHAR (11) , @ACTION VARCHAR (100))
AS

--EXEC USP_PAYIN_OUT_KOTAK @SDATE='JUN  8 2025' , @ACTION='PAYIN'
BEGIN

IF @ACTION='PAYIN'
BEGIN
SELECT SR_NO='1', BR_CODE='3866775', [NAME OF THE A/C HOLDER]='TEST_PAYIN', [ACCOUNT NO.]='007', AMOUNT='1007', STATUS='NRI', SETT_NO='NSE/007', [TRADE DATE]=@SDATE
END

IF @ACTION='PAYOUT'
BEGIN
SELECT SR_NO='1', BR_CODE='3948169', [NAME OF THE A/C HOLDER]='TEST_PAYOUT', [ACCOUNT NO.]='007', AMOUNT='1007', STATUS='NRI', SETT_NO='NSE/007', [TRADE DATE]=@SDATE
END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PROC_SETTLEMENT_CALC
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_PROC_SETTLEMENT_CALC] (@RUNDATE VARCHAR(11),@REPORT VARCHAR(10))                  
                  
AS  --- EXEC PROC_ALL_REPORT_STATUS 'SEP 12 2022'                  
 Declare @sett_no varchar(7),@date varchar(20)  
Select @sett_no=Sett_No from MSAJAG..sett_mst where start_date =Convert(Varchar(11),getdate(),120) and sett_type='M'  
select @date=Convert(Varchar(11),getdate(),120)  
  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'M', 'BILLING', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'M', 'CONTRACTPOP', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'M', 'POSTING', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'M', 'STT', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'M', 'VALAN', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'M', 'VBB', '', '0', '1900-01-01 00:00:00.000', '', '')  
  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'Z', 'BILLING', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'Z', 'CONTRACTPOP', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'Z', 'POSTING', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'Z', 'STT', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'Z', 'VALAN', '', '0', '1900-01-01 00:00:00.000', '', '')  
Insert into MSAJAG.DBO.V2_Process_Status_Log values ('NSE', 'CAPITAL', @date, @sett_no, 'Z', 'VBB', '', '0', '1900-01-01 00:00:00.000', '', '')   
  
select Status='Settlement Calender is successfully updated'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PROC_UPDATE_ISIN
-- --------------------------------------------------
        
CREATE PROC [dbo].[USP_PROC_UPDATE_ISIN] (@ISIN varchar(30),@Sett_No int ,@Sett_type Varchar(2),@Scripname Varchar(max),@Sauda_Date varchar(30))        
AS        
         
 BEGIN         
        
 update MSAJAG..COMMON_CONTRACT_DATA set ISIN=@ISIN where Sauda_Date >=@Sauda_Date        
and Sauda_Date <=@Sauda_Date + ' 23:59:59' and Sett_no=@Sett_No        
and Sett_type=@Sett_type and Scripname=@Scripname and ISIN=''        

SELECT 'ISIN '+ @ISIN + ' IS UPDATED SUCESSFULLY...!!!' AS STATUS      
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_rdb_nse_mastar_sync_BKP_04SEP2024_SRE_30317
-- --------------------------------------------------

CREATE PROC [dbo].[usp_rdb_nse_mastar_sync_BKP_04SEP2024_SRE_30317]
(@DATE AS DATETIME)  
AS BEGIN  
    
DELETE FROM MSAJAG.DBO.SETTLEMENT WHERE SAUDA_DATE >=@DATE AND SAUDA_DATE <=@DATE +' 23:59' AND SETT_TYPE IN ('N','W','M','Z')
  
 
INSERT INTO  SETTLEMENT  
SELECT CONTRACTNO=CONTRACTNO_SEG,BILLNO=DENSE_RANK()OVER(ORDER BY SETT_NO,SETT_DESC,PARTY_CODE),TRADE_NO,PARTY_CODE,SCRIP_CD,USER_ID=USERID,TRADEQTY=QTY,AUCTIONPART='N',MARKETTYPE='0',SERIES,ORDER_NO,  
MARKETRATE=MARKET_RATE,SAUDA_DATE=CONVERT(DATETIME,TRADE_TIME),TABLE_NO=0,LINE_NO=0,VAL_PERC=0,NORMAL=0,DAY_PUC=0,DAY_SALES=0,SETT_PURCH=0,SETT_SALES=0,  
SELL_BUY=BUYSELL,SETTFLAG=(CASE WHEN TRADE_TYPE = 'T' THEN BUYSELL+1 ELSE BUYSELL+3 END),BROKAPPLIED=NET_RATE_PER_UNIT,  
NETRATE=(CASE WHEN BUYSELL = 1 THEN MARKET_RATE+NET_RATE_PER_UNIT ELSE MARKET_RATE-NET_RATE_PER_UNIT END),  
AMOUNT=QTY*MARKET_RATE,INS_CHRG=STT,TURN_TAX,OTHER_CHRG=0,SEBI_TAX=SEBIFEE,BROKER_CHRG=STAMPDUTY,SERVICE_TAX,TRADE_AMOUNT=QTY*MARKET_RATE,  
BILLFLAG=(CASE WHEN TRADE_TYPE = 'T' THEN BUYSELL+1 ELSE BUYSELL+3 END),SETT_NO,NBROKAPP=NET_RATE_PER_UNIT,  
NSERTAX=SERVICE_TAX,N_NETRATE=(CASE WHEN BUYSELL = 1 THEN MARKET_RATE+NET_RATE_PER_UNIT ELSE MARKET_RATE-NET_RATE_PER_UNIT END),  
SETT_TYPE=SETT_DESC,PARTIPANTCODE=MEMID,STATUS='11',PRO_CLI='1',CPID=CONVERT(VARCHAR(20),CONVERT(DATETIME,ORDER_TIME ),113),
INSTRUMENT=1,BOOKTYPE=1,BRANCH_ID=PARTY_CODE,TMARK=TRADE_TYPE,  
SCHEME=0,DUMMY1=MARKET_RATE,  
DUMMY2=0   
FROM PCNORDERDETAILS_RTB(NOLOCK)  
WHERE TRADE_DATE=@DATE  AND  SEGMENT ='NSE CM'  AND SETT_DESC IN ('N','W','M','Z')
  
   
DELETE FROM CHARGES_DETAIL WHERE CD_SAUDA_DATE=@DATE  AND CD_SETT_TYPE IN ('N','W','M','Z')
 
INSERT INTO CHARGES_DETAIL  
SELECT CD_PARTY_CODE =PARTY_CODE,CD_SETT_NO=SETT_NO,CD_SETT_TYPE=SETT_TYPE ,CD_SAUDA_DATE=TRADE_DATE,CD_CONTRACTNO=CONTRACTNO,CD_TRADE_NO='',  
CD_ORDER_NO =P.ORDER_NO,  
CD_SCRIP_CD =SCRIP_CD,CD_SERIES=SERIES,  
CD_BUYRATE=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(TRADE_PRICE AS MONEY) ELSE  0 END ),  
CD_SELLRATE=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(TRADE_PRICE AS MONEY) ELSE 0 END ) ,  
CD_TRDBUY_QTY= (CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_QTY=(CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_QTY =(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_QTY=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDBUYBROKERAGE=(CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TRDSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY) ELSE 0 END )ELSE 0 END),  
CD_DELBUYBROKERAGE =(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_DELSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TOTALBROKERAGE=BROKERAGE,CD_TRDBUYSERTAX=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),  
CD_TRDSELLSERTAX=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),CD_DELBUYSERTAX=0,CD_DELSELLSERTAX=0,  
CD_TOTALSERTAX=CAST(BROKERAGE AS MONEY)*18/100,  
CD_TRDBUY_TURNOVER= (CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_TURNOVER= (CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_COMPUTATION_LEVEL=(CASE WHEN ORDER_NO <>'' THEN 'O'ELSE '' END),  
CD_MIN_BROKAMT='0',CD_MAX_BROKAMT='0',CD_MIN_SCRIPAMT='0',CD_MAX_SCRIPAMT='0',CD_TIMESTAMP=GETDATE()  
FROM PRORDERWISEDETAILS_RTB P  WHERE TRADE_DATE =@DATE   
AND  SEGMENT ='NSE CM'  AND SETT_TYPE IN ('N','W','M','Z')
  
 
INSERT INTO CHARGES_DETAIL  
SELECT  CD_PARTY_CODE =PARTY_CODE,CD_SETT_NO=SETT_NO,CD_SETT_TYPE=SETT_TYPE ,CD_SAUDA_DATE=TRADE_DATE,CD_CONTRACTNO=CONTRACTNO,CD_TRADE_NO='',  
CD_ORDER_NO =P.ORDER_NO,  
CD_SCRIP_CD ='BROKERAGE',CD_SERIES='EQ',  
CD_BUYRATE=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(TRADE_PRICE AS MONEY) ELSE  0 END ),  
CD_SELLRATE=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(TRADE_PRICE AS MONEY) ELSE 0 END ) ,  
CD_TRDBUY_QTY= (CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_QTY=(CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_QTY =(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_QTY=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDBUYBROKERAGE=(CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TRDSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY) ELSE 0 END )ELSE 0 END),  
CD_DELBUYBROKERAGE =CAST(BROKERAGE AS MONEY),  
CD_DELSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TOTALBROKERAGE=BROKERAGE,CD_TRDBUYSERTAX=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),  
CD_TRDSELLSERTAX=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),
CD_DELBUYSERTAX=CAST(BROKERAGE AS MONEY)*18/100,
CD_DELSELLSERTAX=0,  
CD_TOTALSERTAX=CAST(BROKERAGE AS MONEY)*18/100,  
CD_TRDBUY_TURNOVER= (CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_TURNOVER= (CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_COMPUTATION_LEVEL=(CASE WHEN ORDER_NO <>'' THEN 'O'ELSE '' END),  
CD_MIN_BROKAMT='0',CD_MAX_BROKAMT='0',CD_MIN_SCRIPAMT='0',CD_MAX_SCRIPAMT='0',CD_TIMESTAMP=GETDATE()  
 FROM PRORDERWISEDETAILS_RTB P WHERE TRADE_DATE =@DATE   
AND  SEGMENT ='NSE CM' AND SECURITY_NAME LIKE '%ADDITIONAL%'  AND  SETT_TYPE IN ('N','W','M','Z')
  

UPDATE T SET TRADE_TYPE ='S' FROM TBL_STAMP_DATA_RTB  T WHERE SAUDA_DATE=@DATE AND TRADE_TYPE <> 'S'  
  

DELETE TBL_STAMP_DATA WHERE  SAUDA_DATE= @DATE AND  SETT_TYPE IN ('N','W','M','Z')

INSERT INTO TBL_STAMP_DATA
SELECT *  FROM TBL_STAMP_DATA_RTB WHERE SAUDA_DATE=@DATE AND SETT_TYPE  IN ('N','W','M','Z')
 

DELETE STT_CLIENTDETAIL WHERE  SAUDA_DATE= @DATE AND SETT_TYPE  IN ('N','W','M','Z')  

INSERT INTO  STT_CLIENTDETAIL
SELECT *  FROM STT_CLIENTDETAIL_RTB WHERE SAUDA_DATE=@DATE AND SETT_TYPE NOT IN ('C','D','RD','RC')  

DELETE TBL_TOT_DETAIL WHERE  SAUDA_DATE= @DATE

INSERT INTO TBL_TOT_DETAIL
SELECT SETT_NO,SETT_TYPE,SAUDA_DATE,CONTRACTNO,PARTY_CODE,SCRIP_CD,SERIES,TURN_TAX,CHARGE_PER=ISNULL(CHARGE_PER,'0.0001')
  FROM TBL_TOT_DETAIL_RTB WHERE SAUDA_DATE=@DATE AND SETT_TYPE  IN ('N','W','M','Z')
 


--INSERT INTO AngelBSECM.BSEDB_AB.DBO.STT_CLIENTDETAIL 
--SELECT * FROM STT_CLIENTDETAIL WHERE CAST (SAUDA_DATE AS DATE)=@DATE AND SETT_TYPE IN ('C','D','RD','RC')  
--DELETE FROM STT_CLIENTDETAIL WHERE CAST (SAUDA_DATE AS DATE)=@DATE AND SETT_TYPE IN ('C','D','RD','RC')  

DELETE FROM CHARGES_DETAIL 
WHERE CD_SAUDA_DATE =@DATE AND ISNULL(CD_SERIES,'')=''


DECLARE @CONTNO VARCHAR(8)
SELECT @CONTNO= MAX(CONVERT(INT,CONTRACTNO))  FROM   SETTLEMENT WHERE SAUDA_DATE >=@DATE AND SAUDA_DATE <=@DATE +' 23:59'

UPDATE  CONTGEN SET CONTRACTNO=@CONTNO WHERE @DATE BETWEEN START_DATE AND END_DATE 



SELECT * INTO #ORDER FROM  TRADE_CUSTOM_BROKERAGE T  (NOLOCK) WHERE SAUDA_DATE =@DATE AND T.TABLE_NO >0 AND EXCHANGE ='NSE' 

CREATE INDEX #PARTY ON #ORDER(PARTY_CODE,ORDER_NO,TRADE_NO,SETT_TYPE,SETT_NO)

UPDATE H SET TABLE_NO=	T.TABLE_NO, LINE_NO	= T.LINE_NO, VAL_PERC=T.VAL_PERC,	NORMAL=T.NORMAL,	DAY_PUC	= T.DAY_PUC ,DAY_SALES=T.DAY_SALES,
SETT_PURCH=	T.SETT_PURCH ,SETT_SALES=T.SETT_SALES
  FROM #ORDER T  (NOLOCK),
 SETTLEMENT H (NOLOCK) WHERE 
 H.PARTY_CODE=T.PARTY_CODE  AND T.SETT_NO=H.SETT_NO AND H.SETT_TYPE =T.SETT_TYPE 
 AND H.ORDER_NO =T.ORDER_NO AND H.TRADE_NO =T.TRADE_NO 
AND T.SAUDA_DATE =@DATE AND H.TABLE_NO ='0'



END

---Added logic below for NRI to update contgen number

 Select party_code ,row_number()over(order by party_code) sno into #temp  from (
Select Distinct party_code,sell_buy  from settlement (Nolock) where sauda_date >=@DATE and sauda_date <=@DATE + ' 23:59'
and party_code in (select cl_code from client1 where cl_type ='NRI') )a
Group by party_code
having count(1) >1


IF ((select count(1) from #temp)=0)

BEGIN
PRINT 'No Record Found'
END

ELSE

BEGIN
 Alter table #temp
 add contno int

Declare @curcontno int
 Select @curcontno=ContractNo from Contgen where getdate() between Start_Date and end_date
 update #temp set contno =@curcontno +sno


update N set ContractNo =contno  from settlement n (Nolock) , #temp t where sauda_date >=@DATE and sauda_date <=@DATE + ' 23:59'
and n.party_code=t.party_code and sell_buy =2


 DECLAre @maxsno int
 select @maxsno = (Select max(contno) from #temp)
update  Contgen  set ContractNo= @maxsno where getdate() between Start_Date and end_date

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_rdb_nse_mastar_sync_BKP_SEP032024
-- --------------------------------------------------

CREATE PROC [dbo].[usp_rdb_nse_mastar_sync_BKP_SEP032024]  
(@DATE AS DATETIME)  
AS BEGIN  
    
DELETE FROM MSAJAG.DBO.SETTLEMENT WHERE SAUDA_DATE >=@DATE AND SAUDA_DATE <=@DATE +' 23:59' AND SETT_TYPE IN ('N','W','M','Z')
  
 
INSERT INTO  SETTLEMENT  
SELECT CONTRACTNO=CONTRACTNO_SEG,BILLNO=DENSE_RANK()OVER(ORDER BY SETT_NO,SETT_DESC,PARTY_CODE),TRADE_NO,PARTY_CODE,SCRIP_CD,USER_ID=USERID,TRADEQTY=QTY,AUCTIONPART='N',MARKETTYPE='0',SERIES,ORDER_NO,  
MARKETRATE=MARKET_RATE,SAUDA_DATE=CONVERT(DATETIME,TRADE_TIME),TABLE_NO=0,LINE_NO=0,VAL_PERC=0,NORMAL=0,DAY_PUC=0,DAY_SALES=0,SETT_PURCH=0,SETT_SALES=0,  
SELL_BUY=BUYSELL,SETTFLAG=(CASE WHEN TRADE_TYPE = 'T' THEN BUYSELL+1 ELSE BUYSELL+3 END),BROKAPPLIED=NET_RATE_PER_UNIT,  
NETRATE=(CASE WHEN BUYSELL = 1 THEN MARKET_RATE+NET_RATE_PER_UNIT ELSE MARKET_RATE-NET_RATE_PER_UNIT END),  
AMOUNT=QTY*MARKET_RATE,INS_CHRG=STT,TURN_TAX,OTHER_CHRG=0,SEBI_TAX=SEBIFEE,BROKER_CHRG=STAMPDUTY,SERVICE_TAX,TRADE_AMOUNT=QTY*MARKET_RATE,  
BILLFLAG=(CASE WHEN TRADE_TYPE = 'T' THEN BUYSELL+1 ELSE BUYSELL+3 END),SETT_NO,NBROKAPP=NET_RATE_PER_UNIT,  
NSERTAX=SERVICE_TAX,N_NETRATE=(CASE WHEN BUYSELL = 1 THEN MARKET_RATE+NET_RATE_PER_UNIT ELSE MARKET_RATE-NET_RATE_PER_UNIT END),  
SETT_TYPE=SETT_DESC,PARTIPANTCODE=MEMID,STATUS='11',PRO_CLI='1',CPID=CONVERT(VARCHAR(20),CONVERT(DATETIME,ORDER_TIME ),113),
INSTRUMENT=1,BOOKTYPE=1,BRANCH_ID=PARTY_CODE,TMARK=TRADE_TYPE,  
SCHEME=0,DUMMY1=MARKET_RATE,  
DUMMY2=0   
FROM PCNORDERDETAILS_RTB(NOLOCK)  
WHERE TRADE_DATE=@DATE  AND  SEGMENT ='NSE CM'  AND SETT_DESC IN ('N','W','M','Z')
  
   
DELETE FROM CHARGES_DETAIL WHERE CD_SAUDA_DATE=@DATE  AND CD_SETT_TYPE IN ('N','W','M','Z')
 
INSERT INTO CHARGES_DETAIL  
SELECT CD_PARTY_CODE =PARTY_CODE,CD_SETT_NO=SETT_NO,CD_SETT_TYPE=SETT_TYPE ,CD_SAUDA_DATE=TRADE_DATE,CD_CONTRACTNO=CONTRACTNO,CD_TRADE_NO='',  
CD_ORDER_NO =P.ORDER_NO,  
CD_SCRIP_CD =SCRIP_CD,CD_SERIES=SERIES,  
CD_BUYRATE=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(TRADE_PRICE AS MONEY) ELSE  0 END ),  
CD_SELLRATE=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(TRADE_PRICE AS MONEY) ELSE 0 END ) ,  
CD_TRDBUY_QTY= (CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_QTY=(CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_QTY =(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_QTY=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDBUYBROKERAGE=(CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TRDSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY) ELSE 0 END )ELSE 0 END),  
CD_DELBUYBROKERAGE =(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_DELSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TOTALBROKERAGE=BROKERAGE,CD_TRDBUYSERTAX=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),  
CD_TRDSELLSERTAX=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),CD_DELBUYSERTAX=0,CD_DELSELLSERTAX=0,  
CD_TOTALSERTAX=CAST(BROKERAGE AS MONEY)*18/100,  
CD_TRDBUY_TURNOVER= (CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_TURNOVER= (CASE WHEN INTRA_DELFLAG ='T' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_COMPUTATION_LEVEL=(CASE WHEN ORDER_NO <>'' THEN 'O'ELSE '' END),  
CD_MIN_BROKAMT='0',CD_MAX_BROKAMT='0',CD_MIN_SCRIPAMT='0',CD_MAX_SCRIPAMT='0',CD_TIMESTAMP=GETDATE()  
FROM PRORDERWISEDETAILS_RTB P  WHERE TRADE_DATE =@DATE   
AND  SEGMENT ='NSE CM'  AND SETT_TYPE IN ('N','W','M','Z')
  
 
INSERT INTO CHARGES_DETAIL  
SELECT  CD_PARTY_CODE =PARTY_CODE,CD_SETT_NO=SETT_NO,CD_SETT_TYPE=SETT_TYPE ,CD_SAUDA_DATE=TRADE_DATE,CD_CONTRACTNO=CONTRACTNO,CD_TRADE_NO='',  
CD_ORDER_NO =P.ORDER_NO,  
CD_SCRIP_CD ='BROKERAGE',CD_SERIES='EQ',  
CD_BUYRATE=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(TRADE_PRICE AS MONEY) ELSE  0 END ),  
CD_SELLRATE=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(TRADE_PRICE AS MONEY) ELSE 0 END ) ,  
CD_TRDBUY_QTY= (CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_QTY=(CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_QTY =(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_QTY=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT) ELSE 0 END ) ELSE 0 END),  
CD_TRDBUYBROKERAGE=(CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TRDSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY) ELSE 0 END )ELSE 0 END),  
CD_DELBUYBROKERAGE =CAST(BROKERAGE AS MONEY),  
CD_DELSELLBROKERAGE=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)  ELSE 0 END )ELSE 0 END),  
CD_TOTALBROKERAGE=BROKERAGE,CD_TRDBUYSERTAX=(CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),  
CD_TRDSELLSERTAX=(CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(BROKERAGE AS MONEY)*18/100 ELSE 0 END ),
CD_DELBUYSERTAX=CAST(BROKERAGE AS MONEY)*18/100,
CD_DELSELLSERTAX=0,  
CD_TOTALSERTAX=CAST(BROKERAGE AS MONEY)*18/100,  
CD_TRDBUY_TURNOVER= (CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_TRDSELL_TURNOVER= (CASE WHEN INTRA_DELFLAG ='I' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELBUY_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='1' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_DELSELL_TURNOVER=(CASE WHEN INTRA_DELFLAG ='D' THEN (CASE WHEN BUY_SELL_FLAG ='2' THEN CAST(QTY AS FLOAT)*CAST(TRADE_PRICE AS MONEY)  ELSE 0 END ) ELSE 0 END),  
CD_COMPUTATION_LEVEL=(CASE WHEN ORDER_NO <>'' THEN 'O'ELSE '' END),  
CD_MIN_BROKAMT='0',CD_MAX_BROKAMT='0',CD_MIN_SCRIPAMT='0',CD_MAX_SCRIPAMT='0',CD_TIMESTAMP=GETDATE()  
 FROM PRORDERWISEDETAILS_RTB P WHERE TRADE_DATE =@DATE   
AND  SEGMENT ='NSE CM' AND SECURITY_NAME LIKE '%ADDITIONAL%'  AND  SETT_TYPE IN ('N','W','M','Z')
  

UPDATE T SET TRADE_TYPE ='S' FROM TBL_STAMP_DATA_RTB  T WHERE SAUDA_DATE=@DATE AND TRADE_TYPE <> 'S'  
  

DELETE TBL_STAMP_DATA WHERE  SAUDA_DATE= @DATE AND  SETT_TYPE IN ('N','W','M','Z')

INSERT INTO TBL_STAMP_DATA
SELECT *  FROM TBL_STAMP_DATA_RTB WHERE SAUDA_DATE=@DATE AND SETT_TYPE  IN ('N','W','M','Z')
 

DELETE STT_CLIENTDETAIL WHERE  SAUDA_DATE= @DATE AND SETT_TYPE  IN ('N','W','M','Z')  

INSERT INTO  STT_CLIENTDETAIL
SELECT *  FROM STT_CLIENTDETAIL_RTB WHERE SAUDA_DATE=@DATE AND SETT_TYPE NOT IN ('C','D','RD','RC')  

DELETE TBL_TOT_DETAIL WHERE  SAUDA_DATE= @DATE

INSERT INTO TBL_TOT_DETAIL
SELECT SETT_NO,SETT_TYPE,SAUDA_DATE,CONTRACTNO,PARTY_CODE,SCRIP_CD,SERIES,TURN_TAX,CHARGE_PER=ISNULL(CHARGE_PER,'0.0001')
  FROM TBL_TOT_DETAIL_RTB WHERE SAUDA_DATE=@DATE AND SETT_TYPE  IN ('N','W','M','Z')
 


--INSERT INTO AngelBSECM.BSEDB_AB.DBO.STT_CLIENTDETAIL 
--SELECT * FROM STT_CLIENTDETAIL WHERE CAST (SAUDA_DATE AS DATE)=@DATE AND SETT_TYPE IN ('C','D','RD','RC')  
--DELETE FROM STT_CLIENTDETAIL WHERE CAST (SAUDA_DATE AS DATE)=@DATE AND SETT_TYPE IN ('C','D','RD','RC')  

DELETE FROM CHARGES_DETAIL 
WHERE CD_SAUDA_DATE =@DATE AND ISNULL(CD_SERIES,'')=''

DECLARE @CONTNO VARCHAR(8)
SELECT @CONTNO= MAX(CONVERT(INT,CONTRACTNO))  FROM   SETTLEMENT WHERE SAUDA_DATE >=@DATE AND SAUDA_DATE <=@DATE +' 23:59'

UPDATE  CONTGEN SET CONTRACTNO=@CONTNO WHERE @DATE BETWEEN START_DATE AND END_DATE 



SELECT * INTO #ORDER FROM  TRADE_CUSTOM_BROKERAGE T  (NOLOCK) WHERE SAUDA_DATE =@DATE AND T.TABLE_NO >0 AND EXCHANGE ='NSE' 

CREATE INDEX #PARTY ON #ORDER(PARTY_CODE,ORDER_NO,TRADE_NO,SETT_TYPE,SETT_NO)

UPDATE H SET TABLE_NO=	T.TABLE_NO, LINE_NO	= T.LINE_NO, VAL_PERC=T.VAL_PERC,	NORMAL=T.NORMAL,	DAY_PUC	= T.DAY_PUC ,DAY_SALES=T.DAY_SALES,
SETT_PURCH=	T.SETT_PURCH ,SETT_SALES=T.SETT_SALES
  FROM #ORDER T  (NOLOCK),
 SETTLEMENT H (NOLOCK) WHERE 
 H.PARTY_CODE=T.PARTY_CODE  AND T.SETT_NO=H.SETT_NO AND H.SETT_TYPE =T.SETT_TYPE 
 AND H.ORDER_NO =T.ORDER_NO AND H.TRADE_NO =T.TRADE_NO 
AND T.SAUDA_DATE =@DATE AND H.TABLE_NO ='0'

END

---Added logic below for NRI to update contgen number

 Select party_code ,row_number()over(order by party_code) sno into #temp  from (
Select Distinct party_code,sell_buy  from settlement (Nolock) where sauda_date >=@DATE and sauda_date <=@DATE + ' 23:59'
and party_code in (select cl_code from client1 where cl_type ='NRI') )a
Group by party_code
having count(1) >1


IF ((select count(1) from #temp)=0)

BEGIN
PRINT 'No Record Found'
END

ELSE

BEGIN
 Alter table #temp
 add contno int

Declare @curcontno int
 Select @curcontno=ContractNo from Contgen where getdate() between Start_Date and end_date
 update #temp set contno =@curcontno +sno


update N set ContractNo =contno  from settlement n (Nolock) , #temp t where sauda_date >=@DATE and sauda_date <=@DATE + ' 23:59'
and n.party_code=t.party_code and sell_buy =2


 DECLAre @maxsno int
 select @maxsno = (Select max(contno) from #temp)
update  Contgen  set ContractNo= @maxsno where getdate() between Start_Date and end_date

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPT_BANK_RECO_REPORT_ANG
-- --------------------------------------------------
---- // RUN AT .91 USE DUSTBIN
---- // VISHAL DOSHI FRONTEND

/*
DESCRIPTION:- CREATED BY HRISHI ON JUL 24 2024 FOR AVOID BO DEPENDENCY
REQUESTED BY:- VISHAL DOSHI
SRE / ORE:- ORE-3852
*/

CREATE PROCEDURE USP_RPT_BANK_RECO_REPORT_ANG (@FDATE DATE)

AS
BEGIN
----DECLARE FDATE='JUL 23 2024'

CREATE TABLE #TEMPDATA
(
SRNO INT,
[BANK NAME] VARCHAR (255),
DETAILS VARCHAR (255),
BANKCODE VARCHAR (255),
[TYPE OF ACCOUNT] VARCHAR (255),
SEGMENT VARCHAR (255),
[NAME] VARCHAR (255),
[BANK STATEMENT BALANCE] VARCHAR (255),
[BANK BOOK BALANCE] VARCHAR (255),
[CHQ. DEPOSITED BUT NOT CREDITED] VARCHAR (255),
[CHQ. ISSUED BUT NOT DEBITED] VARCHAR (255),
DIFF VARCHAR (255),
[TALLY/ UNTALLY] VARCHAR (255),
REMARKS VARCHAR (255)
)

----CREATE INDEX IDX_#TEMPDATA ON #TEMPDATA (SRNO, [BANK NAME], BANKCODE) 

INSERT INTO #TEMPDATA
EXEC ACCOUNT.DBO.BANK_RECO_REPORT_ANG@FDATE

--SELECT * FROM #TEMPDATA

IF OBJECT_ID(N'DUSTBIN..TBL_BANK_RECO_REPORT_ANG_DATA') IS NOT NULL
DROP TABLE DUSTBIN.DBO.TBL_BANK_RECO_REPORT_ANG_DATA

SELECT CONVERT (VARCHAR (10),SRNO) AS SRNO, [BANK NAME], DETAILS, BANKCODE, [TYPE OF ACCOUNT], SEGMENT, [NAME], [BANK STATEMENT BALANCE],
[BANK BOOK BALANCE], [CHQ. DEPOSITED BUT NOT CREDITED], [CHQ. ISSUED BUT NOT DEBITED], DIFF, [TALLY/ UNTALLY], REMARKS 
INTO DUSTBIN.DBO.TBL_BANK_RECO_REPORT_ANG_DATA
FROM #TEMPDATA

----SELECT * FROM DUSTBIN.DBO.TBL_BANK_RECO_REPORT_ANG_DATA

DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\EXPORT\RECO_FILES_AUTO\' +'BANK_RECO_REPORT_ANG_DATA' + '.CSV'
----DECLARE @FDATE DATE ='JUL 24 2024'
DECLARE @ALL VARCHAR(MAX)

SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''SRNO'''',''''[BANK NAME]'''',''''DETAILS'''',''''BANKCODE'''',''''[TYPE OF ACCOUNT]'''',''''SEGMENT'''',''''[NAME]'''',''''[BANK STATEMENT BALANCE]'''',''''[BANK BOOK BALANCE]'''',''''[CHQ. DEPOSITED BUT NOT CREDITED]'''',''''[CHQ. ISSUED BUT NOT DEBITED]'''',''''DIFF'''',''''[TALLY/ UNTALLY]'''',''''REMARKS'''''
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_BANK_RECO_REPORT_ANG_DATA'          
PRINT @ALL            
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'
PRINT @ALL            
EXEC(@ALL)            

SELECT 'BANK_RECO_REPORT_ANG DATA FILE EXPORTED TO ' + @FILENAME + ' FOR DATE ' + CONVERT (VARCHAR(11),@FDATE,0) AS REMARKS

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPT_CLIENT_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // .91                                
---- // DESCRIPTION :- REQUEST FROM DARSHANA GOGRI (COMPLIANCE TEAM). CREATED BY HRISHI                                
-- EXEC [USP_CLIENT_DATA]          
                
CREATE PROC [dbo].[USP_RPT_CLIENT_DATA]        
AS
              
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                                       
SET @PATH='J:\BACKOFFICE\SL_AUTO\PMLA_REPORTS\CLIENT_DATA\INPUT\INPUT.TXT'                                        
              
IF OBJECT_ID(N'TEMPDB..#INPUT_DATA') IS NOT NULL                                  
DROP TABLE #INPUT_DATA        
        
CREATE TABLE #INPUT_DATA (CODE VARCHAR (100))        
                                      
SET @SQL='BULK INSERT #INPUT_DATA FROM ' + ''''+ @PATH +''''                                      
SET @SQL2=' WITH                                        
    (                                        
           FIRSTROW = 1,                                        
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                                        
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                                        
           TABLOCK                                        
    )'                                        
        
SET @SQLFINAL= @SQL + @SQL2        
PRINT @SQLFINAL        
EXEC (@SQLFINAL)        
          
            
IF OBJECT_ID(N'DUSTBIN..TBL_CL_DETAILS_DATA') IS NOT NULL                            
DROP TABLE DUSTBIN.DBO.TBL_CL_DETAILS_DATA                  
        
--SELECT C.CL_CODE,C.LONG_NAME,CONVERT(VARCHAR(11),C.DOB,103) AS DOB,C.L_STATE       
--INTO DUSTBIN.DBO.TBL_CL_DETAILS_DATA        
--FROM MSAJAG.DBO.CLIENT_DETAILS C INNER JOIN #INPUT_DATA I ON C.CL_CODE=I.CODE   

--PII DATA FIELD LIKE DOB, MOBILE NO,PAN NO AND EMAIL CANNOT BE GIVEN AS PER COMPLIANCE.



SELECT C.CL_CODE,(CASE WHEN B.B2C='Y'THEN 'B2C'ELSE 'B2B'END)AS B2B_B2C ,C.BRANCH_CD,C.SUB_BROKER,C.LONG_NAME,
REPLACE(C.L_ADDRESS1, ',', ' ') AS ADDRESS1,REPLACE(C.L_ADDRESS2, ',', ' ') AS ADDRESS2,REPLACE(C.L_ADDRESS3, ',', ' ') AS ADDRESS3,C.L_CITY,C.L_STATE,C.L_ZIP,C.CL_TYPE
,C.CL_STATUS,C.GST_NO,PAN_GIR_NO='',MOBILE_PAGER='',EMAIL='',DOB='' 
INTO DUSTBIN.DBO.TBL_CL_DETAILS_DATA        
FROM MSAJAG.DBO.CLIENT_DETAILS C INNER JOIN #INPUT_DATA I ON C.CL_CODE=I.CODE 
INNER JOIN [INTRANET].RISK.DBO.CLIENT_DETAILS B ON B.CL_CODE=I.CODE


--SELECT TOP 10 * FROM [INTRANET].RISK.DBO.CLIENT_DETAILS        

--DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')        
DECLARE @FILENAME VARCHAR(100) = 'J:\BACKOFFICE\SL_AUTO\PMLA_REPORTS\CLIENT_DATA\OUTPUT\' +'CLIENT_DATA' + '.CSV'        
DECLARE @ALL VARCHAR(MAX)                  
                  
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''CL_CODE'''',''''B2B_B2C'''',''''BRANCH_CD'''',''''SUB_BROKER'''',''''LONG_NAME'''',''''L_ADDRESS1'''',''''L_ADDRESS2'''',''''L_ADDRESS3'''',''''L_CITY'''',''''L_STATE'''',''''L_ZIP'''',''''CL_TYPE'''',''''CL_STATUS'''',''''GST_NO'''',''''PAN_GIR_NO'''',''''MOBILE_PAGER'''',''''EMAIL'''',''''DOB'''''
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.TBL_CL_DETAILS_DATA'                
PRINT @ALL                  
set @all=@all+' " queryout ' +@filename+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'
PRINT @ALL                  
EXEC(@ALL)                  
        
DROP TABLE #INPUT_DATA              
              
SELECT 'CLIENT DETAILS DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPT_CLIENT_LOG
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>


--- exec   USP_RPT_CLIENT_LOG @cl_code= 'U16622'
-- =============================================
CREATE PROCEDURE [dbo].[USP_RPT_CLIENT_LOG]



 @cl_code  varchar (50)
 
AS
BEGIN
Select  cl_code,segment,exchange ,deactive_remarks,deactive_value,edit_on,edit_by,systemdate,active_date,modifiedby,modifiedon ,InActive_From,Status,
CheckActiveClient from msajag.dbo.client_brok_details_log where cl_code=@cl_code order by Edit_on desc
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPT_PRAK_MARGIN_CNT
-- --------------------------------------------------

--// RUN AT .91 USE DUSTBIN
--// DESCRIPTION :- COUNT OF PEAK MARGIN DATA FOR ALL SEGMENT AS PER REQUEST BY PRAMILA SHELAR.

CREATE PROC [dbo].[USP_RPT_PRAK_MARGIN_CNT] (@FDATE DATE)
AS
BEGIN
--DECLARE @FDATE DATE='JUL  8 2024'

--Select 'MCDX' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE,UPLOAD_ON from ANGELCOMMODITY.MCDX.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE,UPLOAD_ON
--UNION ALL
--Select 'NCDX' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE,UPLOAD_ON from ANGELCOMMODITY.NCDX.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE,UPLOAD_ON
--UNION ALL
--Select 'NCE' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE,UPLOAD_ON from ANGELCOMMODITY.NCE.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE,UPLOAD_ON
--UNION ALL
--SELECT 'NSECM' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MARGINDATE,UPLOAD_ON FROM ANGELNSECM.MSAJAG.DBO.TBL_CMMARGIN_INTRADAY with (nolock) where MARGINDATE = @FDATE GROUP BY MARGINDATE,UPLOAD_ON
--UNION ALL
--Select 'NSEFO' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE,UPLOAD_ON from ANGELFO.NSEFO.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE,UPLOAD_ON
--UNION ALL
--Select 'NSECURFO' AS 'SEGMENT' , COUNT(1) AS 'COUNT', MDATE,UPLOAD_ON from ANGELFO.NSECURFO.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE,UPLOAD_ON


Select 'MCDX' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE from ANGELCOMMODITY.MCDX.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE
UNION ALL
Select 'NCDX' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE from ANGELCOMMODITY.NCDX.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE
UNION ALL
Select 'NCE' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE from ANGELCOMMODITY.NCE.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE
UNION ALL
SELECT 'NSECM' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MARGINDATE FROM ANGELNSECM.MSAJAG.DBO.TBL_CMMARGIN_INTRADAY with (nolock) where MARGINDATE = @FDATE GROUP BY MARGINDATE
UNION ALL
Select 'NSEFO' AS 'SEGMENT' ,COUNT(1) AS 'COUNT', MDATE from ANGELFO.NSEFO.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE
UNION ALL
Select 'NSECURFO' AS 'SEGMENT' , COUNT(1) AS 'COUNT', MDATE from ANGELFO.NSECURFO.DBO.FOMARGINNEW_INTRADAY with (nolock) where MDATE = @FDATE GROUP BY MDATE

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPTTEST
-- --------------------------------------------------
  
  
  
CREATE PROC USP_RPTTEST  
AS  
  
BEGIN  
  
SELECT 'HELLO ANGLE' AS 'TITLE'  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_tbl_200_curfo
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE usp_tbl_200_curfo
@f varchar(30)
AS
begin
select * from tbl_200_curfo where f=@f
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_TESTSSRS
-- --------------------------------------------------

CREATE PROC USP_TESTSSRS @DATE DATE
AS
SELECT * FROM BOTEAM WHERE JOINDATE =@DATE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_TRADE_#_$_DATA
-- --------------------------------------------------
---- // USE DUSTBIN   --- // ANAND1                      
---- // DESCRIPTION :- SHASHI SONI TRADE DETAIL OF $ AND # DATA. CREATED BY HRISHI                      
-- EXEC [USP_TRADE_#_$_DATA]
      
CREATE PROC [dbo].[USP_TRADE_#_$_DATA]
AS    
    
DECLARE @SQL VARCHAR (MAX) ,@SQL2 VARCHAR (MAX), @SQLFINAL VARCHAR (MAX) , @PATH VARCHAR (MAX)                             
SET @PATH='J:\Backoffice\SL_AUTO\RAVINDRA_R\TRADE_$_#_DATA\INPUT\DATE.TXT'                              
    
IF OBJECT_ID(N'tempdb..#FDATE') IS NOT NULL                        
DROP TABLE #FDATE    
CREATE TABLE #FDATE (FDATE VARCHAR(50))    
                            
SET @SQL='BULK INSERT #FDATE FROM ' + ''''+ @PATH +''''                            
SET @SQL2=' WITH                              
    (                              
           FIRSTROW = 1,                              
           FIELDTERMINATOR = '','',  --CSV FIELD DELIMITER                              
           ROWTERMINATOR = ''\n'',   --USE TO SHIFT THE CONTROL TO NEXT ROW                              
           TABLOCK                              
    )'                              
                            
SET @SQLFINAL= @SQL + @SQL2                              
PRINT @SQLFINAL                              
EXEC (@SQLFINAL)                            
                            
--SELECT TOP 10 * FROM #FDATE    
    
DECLARE @FDATE VARCHAR(11)    
SELECT @FDATE=FDATE FROM #FDATE              
PRINT @FDATE    

SELECT SAUDA_DATE,PARTY_CODE,BRANCH_CD,SUB_BROKER,ORDER_NO,ORDER_TIME,TRADE_NO,TRADE_TIME,SCRIPNAME,QTY,SELL_BUY,MARKETRATE,REMARK_ID,REMARK_DESC,EXCHANGE,SEGMENT,USER_ID
INTO #TEMP
FROM MSAJAG.DBO.COMMON_CONTRACT_DATA WHERE SAUDA_DATE =@FDATE AND REMARK_DESC <> '' AND TRADE_NO<>''

--SELECT * FROM #TEMP
  
IF OBJECT_ID(N'DUSTBIN..[TBL_TRADE_#_$_DATA]') IS NOT NULL                  
DROP TABLE DUSTBIN.DBO.TBL_TRADE_#_$_DATA        
      
SELECT CONVERT(VARCHAR(11),SAUDA_DATE) AS SAUDA_DATE,PARTY_CODE,BRANCH_CD,SUB_BROKER,ORDER_NO,ORDER_TIME,TRADE_NO,TRADE_TIME,SCRIPNAME,CONVERT(VARCHAR(20),QTY) AS QTY,SELL_BUY
,CONVERT(VARCHAR(20),MARKETRATE) AS MARKETRATE,REMARK_ID,REMARK_DESC,EXCHANGE,SEGMENT,USER_ID
INTO DUSTBIN.DBO.[TBL_TRADE_#_$_DATA]       
FROM #TEMP
      
--SELECT TOP 10 * FROM DUSTBIN.DBO.[TBL_TRADE_#_$_DATA] 
        
--DECLARE @RPT_DATE VARCHAR(30)=REPLACE(CONVERT(VARCHAR(10),GETDATE(),3),'/','')        
DECLARE @FILENAME VARCHAR(100) = 'J:\Backoffice\SL_AUTO\RAVINDRA_R\TRADE_$_#_DATA\OUTPUT\' +'TRADE_$_#_DATA' + '.CSV'      
DECLARE @ALL VARCHAR(MAX)        
        
SET @ALL = 'EXEC MASTER.DBO.XP_CMDSHELL ''BCP "SELECT ''''SAUDA_DATE'''',''''PARTY_CODE'''',''''BRANCH_CD'''',''''SUB_BROKER'''',''''ORDER_NO'''',''''ORDER_TIME'''',''''TRADE_NO'''',''''TRADE_TIME'''',''''SCRIPNAME'''',''''QTY'''',''''SELL_BUY'''',''''MARKETRATE'''',''''REMARK_ID'''',''''REMARK_DESC'''',''''EXCHANGE'''',''''SEGMENT'''',''''USER_ID'''''        
SET @ALL = @ALL+ ' UNION ALL SELECT * FROM DUSTBIN.DBO.[TBL_TRADE_#_$_DATA]'      
PRINT @ALL        
SET @ALL=@ALL+' " QUERYOUT ' +@FILENAME+ ' -c -t"," -c -t"," -r"\n" -T'', NO_OUTPUT'        
PRINT @ALL        
EXEC(@ALL)        
    
DROP TABLE #TEMP    
DROP TABLE #FDATE    
    
SELECT 'TRADE_$_# DATA FILE EXPORTED TO ' + @FILENAME AS 'REMARK'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USPSSREDATE
-- --------------------------------------------------

CREATE PROC USPSSREDATE (@FDATE VARCHAR(11),@TDATE VARCHAR(11))
AS

SELECT @FDATE AS ' FROM_DATE' , @TDATE AS 'TO_DATE'

GO

-- --------------------------------------------------
-- TABLE dbo.03014_25032022
-- --------------------------------------------------
CREATE TABLE [dbo].[03014_25032022]
(
    [CLTCODE] NVARCHAR(100) NOT NULL,
    [VAMT] NVARCHAR(100) NOT NULL,
    [DRCR] NVARCHAR(50) NOT NULL,
    [VTYP] NVARCHAR(100) NOT NULL,
    [VNO] NVARCHAR(100) NOT NULL,
    [BOOKTYPE] NVARCHAR(100) NOT NULL,
    [NODAY] NVARCHAR(100) NOT NULL,
    [MISSTATUS] NVARCHAR(100) NOT NULL,
    [VDT] NVARCHAR(100) NOT NULL,
    [EDT] NVARCHAR(100) NOT NULL,
    [CDT] NVARCHAR(100) NOT NULL,
    [RELDT] NVARCHAR(100) NOT NULL,
    [DDNO] NVARCHAR(100) NOT NULL,
    [NARRATION] NVARCHAR(100) NOT NULL,
    [ENTEREDBY] NVARCHAR(50) NOT NULL,
    [CATEGORY] NVARCHAR(50) NOT NULL,
    [RECOSTATUS] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AccountSLBS_BKP_09Aug2024
-- --------------------------------------------------
CREATE TABLE [dbo].[AccountSLBS_BKP_09Aug2024]
(
    [Costname] CHAR(35) NOT NULL,
    [Costcode] SMALLINT NOT NULL,
    [Catcode] SMALLINT NOT NULL,
    [Grpcode] VARCHAR(20) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.adds
-- --------------------------------------------------
CREATE TABLE [dbo].[adds]
(
    [adr] VARCHAR(1500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.adr1
-- --------------------------------------------------
CREATE TABLE [dbo].[adr1]
(
    [adr] VARCHAR(1500) NULL,
    [C1] VARCHAR(8000) NULL,
    [c2] VARCHAR(8000) NULL,
    [c3] VARCHAR(8000) NULL,
    [c4] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.adr2
-- --------------------------------------------------
CREATE TABLE [dbo].[adr2]
(
    [adr] VARCHAR(1500) NULL,
    [C1] VARCHAR(8000) NULL,
    [c2] VARCHAR(8000) NULL,
    [c3] VARCHAR(8000) NULL,
    [c4] VARCHAR(8000) NULL,
    [c5] VARCHAR(8000) NULL,
    [c6] VARCHAR(8000) NULL,
    [c7] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.allocate_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[allocate_temp]
(
    [party_code] VARCHAR(11) NULL,
    [toal_amt] MONEY NULL,
    [temp] MONEY NULL,
    [temp1] MONEY NULL,
    [temp2] MONEY NULL,
    [temp3] MONEY NULL,
    [Exchange] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.allocate_temp__new03122025
-- --------------------------------------------------
CREATE TABLE [dbo].[allocate_temp__new03122025]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.allocate_temp_03122025
-- --------------------------------------------------
CREATE TABLE [dbo].[allocate_temp_03122025]
(
    [party_code] VARCHAR(11) NULL,
    [toal_amt] MONEY NULL,
    [temp] MONEY NULL,
    [temp1] MONEY NULL,
    [temp2] MONEY NULL,
    [temp3] MONEY NULL,
    [Exchange] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.allocate_temp_NEW
-- --------------------------------------------------
CREATE TABLE [dbo].[allocate_temp_NEW]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_04082023
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_04082023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_20241004
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_20241004]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_BKP_05JUL2024
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_BKP_05JUL2024]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_BKP_18MAR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_BKP_18MAR2024]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_BKP18NOV2024
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_BKP18NOV2024]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_HRISHI
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_HRISHI]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLOCATE_TEMP_NEW_HRISHI_04082023
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLOCATE_TEMP_NEW_HRISHI_04082023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(15) NULL,
    [SEGMENT] VARCHAR(15) NULL,
    [ALLOCATECASH] MONEY NULL,
    [Exchange1] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLSPLIT
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLSPLIT]
(
    [ALL_DATA] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLSPLIT_20072023
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLSPLIT_20072023]
(
    [ALL_DATA] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ANGLIN01RPT_140640341660103049888
-- --------------------------------------------------
CREATE TABLE [dbo].[ANGLIN01RPT_140640341660103049888]
(
    [Business_Date] DATE NULL,
    [VA_Number] NVARCHAR(50) NULL,
    [Channel] SMALLINT NULL,
    [Transaction_Amount] FLOAT NULL,
    [Transaction_Details_1] NVARCHAR(50) NULL,
    [Transaction_Details_2] NVARCHAR(1) NULL,
    [Transaction_Details_3] NVARCHAR(50) NULL,
    [Transaction_Details_4] NVARCHAR(50) NULL,
    [Transaction_Details_5] NVARCHAR(50) NULL,
    [Transaction_Details_6] NVARCHAR(100) NULL,
    [Transaction_Details_7] NVARCHAR(50) NULL,
    [Transaction_Details_8] NVARCHAR(50) NULL,
    [Transaction_Details_9] NVARCHAR(50) NULL,
    [Transaction_Details_10] NVARCHAR(1) NULL,
    [Transaction_Details_11] NVARCHAR(1) NULL,
    [Transaction_Details_12] NVARCHAR(1) NULL,
    [Transaction_Details_13] NVARCHAR(1) NULL,
    [Transaction_Details_14] NVARCHAR(1) NULL,
    [Transaction_Details_15] NVARCHAR(1) NULL,
    [Transaction_Details_16] NVARCHAR(1) NULL,
    [Transaction_Details_17] NVARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ANGLIN01RPT_140642631660103949545
-- --------------------------------------------------
CREATE TABLE [dbo].[ANGLIN01RPT_140642631660103949545]
(
    [Business_Date] DATE NULL,
    [VA_Number] NVARCHAR(50) NULL,
    [Channel] SMALLINT NULL,
    [Transaction_Amount] FLOAT NULL,
    [Transaction_Details_1] NVARCHAR(50) NULL,
    [Transaction_Details_2] NVARCHAR(1) NULL,
    [Transaction_Details_3] NVARCHAR(50) NULL,
    [Transaction_Details_4] NVARCHAR(50) NULL,
    [Transaction_Details_5] NVARCHAR(50) NULL,
    [Transaction_Details_6] NVARCHAR(100) NULL,
    [Transaction_Details_7] NVARCHAR(50) NULL,
    [Transaction_Details_8] NVARCHAR(50) NULL,
    [Transaction_Details_9] NVARCHAR(50) NULL,
    [Transaction_Details_10] NVARCHAR(1) NULL,
    [Transaction_Details_11] NVARCHAR(1) NULL,
    [Transaction_Details_12] NVARCHAR(1) NULL,
    [Transaction_Details_13] NVARCHAR(1) NULL,
    [Transaction_Details_14] NVARCHAR(1) NULL,
    [Transaction_Details_15] NVARCHAR(1) NULL,
    [Transaction_Details_16] NVARCHAR(1) NULL,
    [Transaction_Details_17] NVARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.asba_ledger_bak
-- --------------------------------------------------
CREATE TABLE [dbo].[asba_ledger_bak]
(
    [CLTCODE] VARCHAR(20) NOT NULL,
    [VDT_BAL] MONEY NOT NULL,
    [EDT_BAL] MONEY NOT NULL,
    [BALANCE_DATE] DATETIME NOT NULL,
    [UPDATEDBY] VARCHAR(25) NULL,
    [UPDATE_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AsianFileType_30MAY2023
-- --------------------------------------------------
CREATE TABLE [dbo].[AsianFileType_30MAY2023]
(
    [fldFileNo] VARCHAR(2) NOT NULL,
    [fldFileType] VARCHAR(50) NULL,
    [fldFileName] VARCHAR(20) NULL,
    [fldProcName] VARCHAR(200) NULL,
    [FLDFILEHEADER] INT NULL,
    [FLDFILEFOOTER] INT NULL,
    [fldFileFor] VARCHAR(20) NULL,
    [fldFileSeperator] VARCHAR(1) NULL,
    [fldFEILDHEADER] INT NULL,
    [fldROUNDING] INT NULL,
    [fldFileFormat] VARCHAR(5) NULL,
    [FLDPARAMETER] INT NOT NULL,
    [fldFixedHeader] VARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AsianFileType_BKP_28042023
-- --------------------------------------------------
CREATE TABLE [dbo].[AsianFileType_BKP_28042023]
(
    [fldFileNo] VARCHAR(2) NOT NULL,
    [fldFileType] VARCHAR(50) NULL,
    [fldFileName] VARCHAR(20) NULL,
    [fldProcName] VARCHAR(200) NULL,
    [FLDFILEHEADER] INT NULL,
    [FLDFILEFOOTER] INT NULL,
    [fldFileFor] VARCHAR(20) NULL,
    [fldFileSeperator] VARCHAR(1) NULL,
    [fldFEILDHEADER] INT NULL,
    [fldROUNDING] INT NULL,
    [fldFileFormat] VARCHAR(5) NULL,
    [FLDPARAMETER] INT NOT NULL,
    [fldFixedHeader] VARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AUDIT_CLCODE
-- --------------------------------------------------
CREATE TABLE [dbo].[AUDIT_CLCODE]
(
    [CL_CODE] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AUDIT_CLTCODE
-- --------------------------------------------------
CREATE TABLE [dbo].[AUDIT_CLTCODE]
(
    [CL_CODE] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.b2b_pricing_communication
-- --------------------------------------------------
CREATE TABLE [dbo].[b2b_pricing_communication]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [EMAIL] VARCHAR(50) NULL,
    [MOBILE_PAGER] VARCHAR(40) NULL,
    [BROK_PLAN] VARCHAR(100) NULL,
    [B2C] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.b2b_pricing_communication_1
-- --------------------------------------------------
CREATE TABLE [dbo].[b2b_pricing_communication_1]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [EMAIL] VARCHAR(50) NULL,
    [MOBILE_PAGER] VARCHAR(40) NULL,
    [BROK_PLAN] VARCHAR(100) NULL,
    [B2C] VARCHAR(1) NULL,
    [sNo] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_ASIANFILEBATCHNO_26102023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_ASIANFILEBATCHNO_26102023]
(
    [FldFileNo] VARCHAR(10) NULL,
    [fldBatchNo] INT NULL,
    [fldFileDate] DATETIME NULL,
    [fldSystemDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CCE_UNCLAIMED_CLIENT_FUNDS_ANG_02052023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CCE_UNCLAIMED_CLIENT_FUNDS_ANG_02052023]
(
    [TRADING_PAN] VARCHAR(50) NULL,
    [REPORT_DATE] DATETIME NULL,
    [UCC] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(50) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [SEGMENT_INDICATOR] VARCHAR(7) NOT NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [VDT_BAL] MONEY NULL,
    [EDT_BAL] MONEY NULL,
    [PEAK_FINANCIAL_LEDGER] MONEY NULL,
    [BG] MONEY NULL,
    [FDR] MONEY NULL,
    [GOV_IND_SEC] MONEY NULL,
    [GILT_FUNDS] MONEY NULL,
    [EPI_LEDGER] MONEY NULL,
    [POOL_ACCOUNT] MONEY NULL,
    [CHQ_DEPOSITS] MONEY NULL,
    [CHQ_ISSUE] MONEY NULL,
    [COMM_VALUE] MONEY NULL,
    [LAST_SETT_DATE] VARCHAR(20) NULL,
    [OPEN_BILL1] MONEY NULL,
    [OPEN_BILL2] MONEY NULL,
    [MARGIN_REQ] MONEY NULL,
    [CASH_COLL_MTF_POSITIONS] VARCHAR(30) NULL,
    [UNCLAIMED_CLIENT_FUNDS] VARCHAR(3) NOT NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_12122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_12122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_24012024
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_24012024]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_05122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_05122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_06122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_06122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_061220231
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_061220231]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_11122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_11122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_121220231
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_121220231]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_24012024
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_24012024]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_12062023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_12062023]
(
    [SP_SrNo] INT IDENTITY(1,1) NOT NULL,
    [SP_Party_Code] VARCHAR(10) NOT NULL,
    [SP_Computation_Level] CHAR(1) NOT NULL,
    [SP_Inst_Type] VARCHAR(3) NOT NULL,
    [SP_Scrip] VARCHAR(12) NOT NULL,
    [SP_Scheme_Id] INT NOT NULL,
    [SP_Trd_Type] VARCHAR(3) NOT NULL,
    [SP_Scheme_Type] CHAR(1) NOT NULL,
    [SP_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Buy_Brok_Type] CHAR(1) NULL,
    [SP_Sell_Brok_Type] CHAR(1) NULL,
    [SP_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Sell_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Sell_Brok] NUMERIC(18, 4) NULL,
    [SP_Value_From] NUMERIC(18, 4) NOT NULL,
    [SP_Value_To] NUMERIC(18, 4) NOT NULL,
    [SP_TurnOverOn] VARCHAR(7) NOT NULL,
    [SP_Brok_ComputeOn] CHAR(1) NOT NULL,
    [SP_Brok_ComputeType] CHAR(1) NOT NULL,
    [SP_Min_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Min_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Date_From] DATETIME NOT NULL,
    [SP_Date_To] DATETIME NOT NULL,
    [SP_CreatedBy] VARCHAR(20) NOT NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SP_ModifiedBy] VARCHAR(20) NOT NULL,
    [SP_ModifiedOn] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_13062023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_13062023]
(
    [SP_SrNo] INT IDENTITY(1,1) NOT NULL,
    [SP_Party_Code] VARCHAR(10) NOT NULL,
    [SP_Computation_Level] CHAR(1) NOT NULL,
    [SP_Inst_Type] VARCHAR(3) NOT NULL,
    [SP_Scrip] VARCHAR(12) NOT NULL,
    [SP_Scheme_Id] INT NOT NULL,
    [SP_Trd_Type] VARCHAR(3) NOT NULL,
    [SP_Scheme_Type] CHAR(1) NOT NULL,
    [SP_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Buy_Brok_Type] CHAR(1) NULL,
    [SP_Sell_Brok_Type] CHAR(1) NULL,
    [SP_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Sell_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Sell_Brok] NUMERIC(18, 4) NULL,
    [SP_Value_From] NUMERIC(18, 4) NOT NULL,
    [SP_Value_To] NUMERIC(18, 4) NOT NULL,
    [SP_TurnOverOn] VARCHAR(7) NOT NULL,
    [SP_Brok_ComputeOn] CHAR(1) NOT NULL,
    [SP_Brok_ComputeType] CHAR(1) NOT NULL,
    [SP_Min_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Min_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Date_From] DATETIME NOT NULL,
    [SP_Date_To] DATETIME NOT NULL,
    [SP_CreatedBy] VARCHAR(20) NOT NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SP_ModifiedBy] VARCHAR(20) NOT NULL,
    [SP_ModifiedOn] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_TBL_CLIENT_COLL_FILE_26102023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_TBL_CLIENT_COLL_FILE_26102023]
(
    [UPD_FILENAME] VARCHAR(100) NULL,
    [FILEDATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [SEGMENT_INDICATOR] VARCHAR(5) NULL,
    [CM_CODE] VARCHAR(20) NULL,
    [TM_CODE] VARCHAR(20) NULL,
    [CP_CODE] VARCHAR(20) NULL,
    [CLI_CODE] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] VARCHAR(5) NULL,
    [AMOUNT] NUMERIC(18, 2) NULL,
    [FILLER1] VARCHAR(7) NULL,
    [FILLER2] VARCHAR(7) NULL,
    [FILLER3] VARCHAR(7) NULL,
    [FILLER4] VARCHAR(7) NULL,
    [FILLER5] VARCHAR(7) NULL,
    [FILLER6] VARCHAR(7) NULL,
    [ACTION_TYPE] VARCHAR(7) NULL,
    [BATCHNO] VARCHAR(7) NULL,
    [SOURCE_FROM] VARCHAR(7) NULL,
    [UPLOAD_BY] VARCHAR(50) NULL,
    [UPLOAD_ON] DATETIME NULL,
    [BATCH_STATUS] VARCHAR(7) NULL,
    [RESPONSE_CODE] VARCHAR(500) NULL,
    [RESPONSE_BY] VARCHAR(100) NULL,
    [RESPONSE_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_TBL_CMCC_DATA_06122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_TBL_CMCC_DATA_06122023]
(
    [TRANSDATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [ACCOUNT_TYPE] VARCHAR(1) NULL,
    [ALLOC_LEVEL] VARCHAR(2) NULL,
    [FDAMOUNT] NUMERIC(18, 4) NULL,
    [CASHAMOUNT] NUMERIC(18, 4) NULL,
    [BGAMOUNT] NUMERIC(18, 4) NULL,
    [ENTEREDBY] VARCHAR(50) NULL,
    [ENTEREDON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_TBL_COMBINE_REPORTING_PEAK_06122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_TBL_COMBINE_REPORTING_PEAK_06122023]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_CASH] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_CASH] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_CASH] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_TBL_COMBINE_REPORTING_PEAK_19122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_TBL_COMBINE_REPORTING_PEAK_19122023]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_CASH] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_CASH] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_CASH] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_TBL_COMBINE_REPORTING_PEAK_DETAIL_06122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_TBL_COMBINE_REPORTING_PEAK_DETAIL_06122023]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T_MARGINAVL] NUMERIC(18, 4) NULL,
    [T_MTMAVL] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_TBL_COMBINE_REPORTING_PEAK_DETAIL_19122023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_TBL_COMBINE_REPORTING_PEAK_DETAIL_19122023]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T_MARGINAVL] NUMERIC(18, 4) NULL,
    [T_MTMAVL] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_V2_TBL_COLLATERAL_MARGIN_COMBINE_31012024
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_V2_TBL_COLLATERAL_MARGIN_COMBINE_31012024]
(
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [COLL_TYPE] VARCHAR(6) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [ISIN] VARCHAR(20) NULL,
    [QTY] NUMERIC(18, 4) NULL,
    [FD_TYPE] VARCHAR(1) NULL,
    [FD_BG_NO] VARCHAR(20) NULL,
    [AMOUNT] MONEY NULL,
    [FINALAMOUNT] MONEY NULL,
    [BANK_CODE] VARCHAR(15) NULL,
    [MRG_CL_RATE] MONEY NULL,
    [MRG_AMOUNT] MONEY NULL,
    [MRG_HAIRCUT] MONEY NULL,
    [MRG_VAR_MARGIN] MONEY NULL,
    [MRG_FINALAMOUNT] MONEY NULL,
    [RMS_CL_RATE] MONEY NULL,
    [RMS_HAIRCUT] MONEY NULL,
    [RMS_AMOUNT] MONEY NULL,
    [RMS_FINALAMOUNT] MONEY NULL,
    [CASH_NCASH] VARCHAR(2) NULL,
    [PERCENTAGECASH] NUMERIC(18, 2) NULL,
    [PERECNTAGENONCASH] NUMERIC(18, 2) NULL,
    [MRG_CASH] NUMERIC(18, 2) NULL,
    [MRG_NONCASH] NUMERIC(18, 2) NULL,
    [RMS_CASH] NUMERIC(18, 2) NULL,
    [RMS_NONCASH] NUMERIC(18, 2) NULL,
    [MRG_EFFECTIVECOLL] NUMERIC(18, 2) NULL,
    [RMS_EFFECTIVECOLL] NUMERIC(18, 2) NULL,
    [MARGIN_CALL] MONEY NULL,
    [LEDGER_AMT] MONEY NULL,
    [RELEASE_QTY] INT NULL,
    [RELEASE_AMT] MONEY NULL,
    [RECORD_TYPE] INT NULL,
    [effdate] DATETIME NULL,
    [createdon] DATETIME NULL,
    [EXCHANGE_ORG] VARCHAR(3) NULL,
    [SEGMENT_ORG] VARCHAR(7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bal_2122
-- --------------------------------------------------
CREATE TABLE [dbo].[bal_2122]
(
    [Cltcode] VARCHAR(10) NOT NULL,
    [vtyp] SMALLINT NOT NULL,
    [Vamt] MONEY NULL,
    [EXCHANGE] VARCHAR(5) NOT NULL,
    [Fin_year] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANK_PURPOSE_MASTER_BKP_06042023
-- --------------------------------------------------
CREATE TABLE [dbo].[BANK_PURPOSE_MASTER_BKP_06042023]
(
    [BANKCODE] VARCHAR(255) NULL,
    [BANKNAME] VARCHAR(255) NULL,
    [ACCOUNTNO] VARCHAR(255) NULL,
    [EXCHANGE] VARCHAR(50) NULL,
    [SEGMENT] VARCHAR(255) NULL,
    [PURPOSE] VARCHAR(255) NULL,
    [BANK_IFSC] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANK_PURPOSE_MASTER_BKP_16APR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[BANK_PURPOSE_MASTER_BKP_16APR2024]
(
    [BANKCODE] VARCHAR(255) NULL,
    [BANKNAME] VARCHAR(255) NULL,
    [ACCOUNTNO] VARCHAR(255) NULL,
    [EXCHANGE] VARCHAR(50) NULL,
    [SEGMENT] VARCHAR(255) NULL,
    [PURPOSE] VARCHAR(255) NULL,
    [BANK_IFSC] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANK_RECO_BALANCE_ANG
-- --------------------------------------------------
CREATE TABLE [dbo].[BANK_RECO_BALANCE_ANG]
(
    [RECODATE] DATETIME NOT NULL,
    [SEGMENT] VARCHAR(20) NOT NULL,
    [BANKCODE] VARCHAR(20) NOT NULL,
    [BANKBAL] NUMERIC(18, 2) NULL,
    [BOOKBAL] NUMERIC(18, 2) NULL,
    [DIFFBAL] NUMERIC(18, 2) NULL,
    [DRAMT] NUMERIC(18, 2) NULL,
    [CRAMT] NUMERIC(18, 2) NULL,
    [TOTDIFFBAL] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Bankcodechanges_20220518
-- --------------------------------------------------
CREATE TABLE [dbo].[Bankcodechanges_20220518]
(
    [Old_Bank_code] SMALLINT NULL,
    [New_Bank_code] SMALLINT NULL,
    [CLTCODE] VARCHAR(150) NULL,
    [VDT] DATE NULL,
    [VDT_TIME] TIME NULL,
    [VNO] BIGINT NULL,
    [NARRATION] VARCHAR(150) NULL,
    [EXCHANGE] VARCHAR(150) NULL,
    [VAMT] INT NULL,
    [DRCR] NVARCHAR(50) NULL,
    [DDNO] BIGINT NULL,
    [VTYP] TINYINT NULL,
    [Entry_DAte] VARCHAR(150) NULL,
    [ENTEREDBY] VARCHAR(150) NULL,
    [RELDT] VARCHAR(150) NULL,
    [BOOKTYPE] VARCHAR(150) NULL,
    [SHORT_NAME] VARCHAR(150) NULL,
    [REGION] VARCHAR(150) NULL,
    [BRANCH_CD] VARCHAR(150) NULL,
    [SUB_BROKER] VARCHAR(150) NULL,
    [BANK_NAME] VARCHAR(150) NULL,
    [AC_NUM] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANKRECO
-- --------------------------------------------------
CREATE TABLE [dbo].[BANKRECO]
(
    [Cltcode] VARCHAR(10) NULL,
    [BookDate] DATETIME NULL,
    [Description] VARCHAR(50) NULL,
    [Amount] MONEY NULL,
    [DrCr] VARCHAR(1) NULL,
    [ValueDate] DATETIME NULL,
    [ReferenceNo] VARCHAR(30) NULL,
    [StatusId] VARCHAR(15) NULL,
    [StatusName] VARCHAR(25) NULL,
    [LoginName] VARCHAR(25) NULL,
    [CrossReferenceNo] VARCHAR(20) NULL,
    [Status] VARCHAR(9) NULL,
    [MicrNo] INT NULL,
    [Dummy1] VARCHAR(20) NULL,
    [Dummy2] VARCHAR(20) NULL,
    [BR_SNo] BIGINT IDENTITY(1,1) NOT NULL,
    [CMS_SrNo] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANKRECO_17Feb2022
-- --------------------------------------------------
CREATE TABLE [dbo].[BANKRECO_17Feb2022]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [BANK_CODE] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [NARRATION] VARCHAR(100) NULL,
    [EXCHANGE] VARCHAR(100) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] VARCHAR(100) NULL,
    [DDNO] VARCHAR(100) NULL,
    [VTYP] VARCHAR(100) NULL,
    [Entry_DAte] VARCHAR(100) NULL,
    [ENTEREDBY] VARCHAR(100) NULL,
    [RELDT2] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANKRECONDATA_20220217
-- --------------------------------------------------
CREATE TABLE [dbo].[BANKRECONDATA_20220217]
(
    [CLTCODE] VARCHAR(100) NOT NULL,
    [VDT] VARCHAR(100) NOT NULL,
    [BANK_CODE] VARCHAR(100) NOT NULL,
    [RELDT] VARCHAR(100) NOT NULL,
    [VNO] VARCHAR(100) NOT NULL,
    [NARRATION] VARCHAR(100) NOT NULL,
    [EXCHANGE] VARCHAR(100) NOT NULL,
    [VAMT] VARCHAR(100) NOT NULL,
    [DRCR] VARCHAR(100) NOT NULL,
    [DDNO] VARCHAR(100) NOT NULL,
    [VTYP] VARCHAR(100) NOT NULL,
    [Entry_DAte] VARCHAR(100) NOT NULL,
    [ENTEREDBY] VARCHAR(100) NOT NULL,
    [RELDT2] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BILlDESK_recd_19_02_2022_EDT_RELDT
-- --------------------------------------------------
CREATE TABLE [dbo].[BILlDESK_recd_19_02_2022_EDT_RELDT]
(
    [CLTCODE] VARCHAR(150) NULL,
    [CLTCODE2] VARCHAR(150) NULL,
    [VDT] VARCHAR(150) NULL,
    [VDT_TIME] VARCHAR(150) NULL,
    [VNO] VARCHAR(150) NULL,
    [NARRATION] VARCHAR(150) NULL,
    [EXCHANGE] VARCHAR(150) NULL,
    [VAMT] VARCHAR(150) NULL,
    [DRCR] VARCHAR(150) NULL,
    [DDNO] VARCHAR(150) NULL,
    [VTYP] VARCHAR(150) NULL,
    [Entry_DAte] VARCHAR(150) NULL,
    [ENTEREDBY] VARCHAR(150) NULL,
    [RELDT] VARCHAR(150) NULL,
    [BOOKTYPE] VARCHAR(150) NULL,
    [SHORT_NAME] VARCHAR(150) NULL,
    [REGION] VARCHAR(150) NULL,
    [BRANCH_CD] VARCHAR(150) NULL,
    [SUB_BROKER] VARCHAR(150) NULL,
    [BANK_NAME] VARCHAR(150) NULL,
    [AC_NUM] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_04JAN2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_04JAN2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_16AUG2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_16AUG2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_18JAN2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_18JAN2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_18oct2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_18oct2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22APR2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22APR2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22FEB2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22FEB2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22jul2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22jul2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22JUN2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22JUN2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22MAR2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22MAR2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22NOV2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22NOV2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_22NOV2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_22NOV2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_23aug2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_23aug2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_23jun2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_23jun2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_23MAR2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_23MAR2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_23MARCH2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_23MARCH2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_24aug2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_24aug2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_24JAN2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_24JAN2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_24jan2026_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_24jan2026_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_25MAY2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_25MAY2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_26APR2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_26APR2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_26JUL2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_26JUL2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_26may2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_26may2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_26OCT2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_26OCT2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_27dec2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_27dec2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_27sep2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_27sep2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_28JUN2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_28JUN2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_28SEP2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_28SEP2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_29DEC2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_29DEC2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_29MAR2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_29MAR2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_29sep2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_29sep2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_30NOV2024_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_30NOV2024_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_30sep2023_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_30sep2023_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bkp_31MAY2025_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bkp_31MAY2025_sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BOTEAM
-- --------------------------------------------------
CREATE TABLE [dbo].[BOTEAM]
(
    [ID] INT NULL,
    [Name] VARCHAR(50) NULL,
    [Joindate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BOTEAMNEW
-- --------------------------------------------------
CREATE TABLE [dbo].[BOTEAMNEW]
(
    [ID] INT NULL,
    [Name] VARCHAR(50) NULL,
    [Joindate] DATETIME NULL,
    [NEW] VARCHAR(4) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BROK_DATA_28NOV2025
-- --------------------------------------------------
CREATE TABLE [dbo].[BROK_DATA_28NOV2025]
(
    [SP_PARTY_CODE] VARCHAR(10) NOT NULL,
    [MCDX_SP_SCHEME_ID] INT NOT NULL,
    [MCDX_MIN_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MAX_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MIN_CRUDEOIL_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MAX_CRUDEOIL_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MIN_GOLD_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MAX_GOLD_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MIN_SILVER_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MAX_SILVER_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MIN_ZINC_ALL] NUMERIC(38, 4) NULL,
    [MCDX_MAX_ZINC_ALL] NUMERIC(38, 4) NULL,
    [NCDX_SP_SCHEME_ID] INT NOT NULL,
    [NCDX_MIN_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MAX_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MIN_CRUDEOIL_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MAX_CRUDEOIL_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MIN_GOLD_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MAX_GOLD_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MIN_SILVER_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MAX_SILVER_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MIN_ZINC_ALL] NUMERIC(38, 4) NULL,
    [NCDX_MAX_ZINC_ALL] NUMERIC(38, 4) NULL,
    [NCE_SP_SCHEME_ID] INT NOT NULL,
    [NCE_MIN_ALL] NUMERIC(38, 4) NULL,
    [NCE_MAX_ALL] NUMERIC(38, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Brokchangenew
-- --------------------------------------------------
CREATE TABLE [dbo].[Brokchangenew]
(
    [partycode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CCD_1
-- --------------------------------------------------
CREATE TABLE [dbo].[CCD_1]
(
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL,
    [CONTRACTNO] VARCHAR(10) NULL,
    [CONTRACTNO_NEW] VARCHAR(10) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [SETT_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] BIGINT NULL,
    [TMARK] VARCHAR(1) NULL,
    [SELL_BUY] VARCHAR(1) NULL,
    [MARKETRATE] MONEY NULL,
    [MARKETAMT] MONEY NULL,
    [BROKERAGE] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [NETAMOUNT] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [OTHER_CHRG] MONEY NULL,
    [NETAMOUNTALL] MONEY NULL,
    [BROK] MONEY NULL,
    [NETRATE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [BROKERSEBIREGNO] VARCHAR(20) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [CINNO] VARCHAR(100) NULL,
    [SETTTYPE_DESC] VARCHAR(35) NULL,
    [BFCF_FLAG] VARCHAR(6) NULL,
    [CONTRACT_HEADER_DET] VARCHAR(200) NULL,
    [REMARK] VARCHAR(100) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [USER_ID] VARCHAR(20) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [NETOBLIGATION] MONEY NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [TRADER] VARCHAR(25) NULL,
    [AREA] VARCHAR(25) NULL,
    [REGION] VARCHAR(25) NULL,
    [FAMILY] VARCHAR(15) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [PARTYNAME] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [OFF_PHONE1] VARCHAR(50) NULL,
    [OFF_PHONE2] VARCHAR(50) NULL,
    [PAN_GIR_NO] VARCHAR(15) NULL,
    [MAPIDID] VARCHAR(20) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [SEBI_NO] VARCHAR(25) NULL,
    [PARTICIPANT_CODE] VARCHAR(16) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [SERVICE_CHRG] TINYINT NULL,
    [PRINTF] TINYINT NULL,
    [PRICEUNIT] VARCHAR(20) NULL,
    [QTY_UNIT] VARCHAR(20) NULL,
    [ISIN] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CCD_2
-- --------------------------------------------------
CREATE TABLE [dbo].[CCD_2]
(
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL,
    [CONTRACTNO] VARCHAR(10) NULL,
    [CONTRACTNO_NEW] VARCHAR(10) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [SETT_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] BIGINT NULL,
    [TMARK] VARCHAR(1) NULL,
    [SELL_BUY] VARCHAR(1) NULL,
    [MARKETRATE] MONEY NULL,
    [MARKETAMT] MONEY NULL,
    [BROKERAGE] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [NETAMOUNT] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [OTHER_CHRG] MONEY NULL,
    [NETAMOUNTALL] MONEY NULL,
    [BROK] MONEY NULL,
    [NETRATE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [BROKERSEBIREGNO] VARCHAR(20) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [CINNO] VARCHAR(100) NULL,
    [SETTTYPE_DESC] VARCHAR(35) NULL,
    [BFCF_FLAG] VARCHAR(6) NULL,
    [CONTRACT_HEADER_DET] VARCHAR(200) NULL,
    [REMARK] VARCHAR(100) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [USER_ID] VARCHAR(20) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [NETOBLIGATION] MONEY NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [TRADER] VARCHAR(25) NULL,
    [AREA] VARCHAR(25) NULL,
    [REGION] VARCHAR(25) NULL,
    [FAMILY] VARCHAR(15) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [PARTYNAME] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [OFF_PHONE1] VARCHAR(50) NULL,
    [OFF_PHONE2] VARCHAR(50) NULL,
    [PAN_GIR_NO] VARCHAR(15) NULL,
    [MAPIDID] VARCHAR(20) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [SEBI_NO] VARCHAR(25) NULL,
    [PARTICIPANT_CODE] VARCHAR(16) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [SERVICE_CHRG] TINYINT NULL,
    [PRINTF] TINYINT NULL,
    [PRICEUNIT] VARCHAR(20) NULL,
    [QTY_UNIT] VARCHAR(20) NULL,
    [ISIN] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ChangeDeactivateFlagC
-- --------------------------------------------------
CREATE TABLE [dbo].[ChangeDeactivateFlagC]
(
    [CL_CODE] NVARCHAR(50) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [SEGMENT] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ChangeItoD
-- --------------------------------------------------
CREATE TABLE [dbo].[ChangeItoD]
(
    [CODE] VARCHAR(50) NULL,
    [Exchange] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CHARGES_DETAIL_BKUP_03APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[CHARGES_DETAIL_BKUP_03APR2023]
(
    [CD_SrNo] INT IDENTITY(1,1) NOT NULL,
    [CD_Party_Code] VARCHAR(10) NOT NULL,
    [CD_Sett_No] VARCHAR(7) NOT NULL,
    [CD_Sett_Type] VARCHAR(2) NOT NULL,
    [CD_Sauda_Date] DATETIME NOT NULL,
    [CD_ContractNo] VARCHAR(14) NULL,
    [CD_Trade_No] VARCHAR(14) NOT NULL,
    [CD_Order_No] VARCHAR(16) NULL,
    [CD_Scrip_Cd] VARCHAR(12) NOT NULL,
    [CD_Series] VARCHAR(3) NOT NULL,
    [CD_BuyRate] MONEY NOT NULL,
    [CD_SellRate] MONEY NOT NULL,
    [CD_TrdBuy_Qty] INT NOT NULL,
    [CD_TrdSell_Qty] INT NOT NULL,
    [CD_DelBuy_Qty] INT NOT NULL,
    [CD_DelSell_Qty] INT NOT NULL,
    [CD_TrdBuyBrokerage] MONEY NOT NULL,
    [CD_TrdSellBrokerage] MONEY NOT NULL,
    [CD_DelBuyBrokerage] MONEY NOT NULL,
    [CD_DelSellBrokerage] MONEY NOT NULL,
    [CD_TotalBrokerage] MONEY NOT NULL,
    [CD_TrdBuySerTax] MONEY NOT NULL,
    [CD_TrdSellSerTax] MONEY NOT NULL,
    [CD_DelBuySerTax] MONEY NOT NULL,
    [CD_DelSellSerTax] MONEY NOT NULL,
    [CD_TotalSerTax] MONEY NOT NULL,
    [CD_TrdBuy_TurnOver] MONEY NOT NULL,
    [CD_TrdSell_TurnOver] MONEY NOT NULL,
    [CD_DelBuy_TurnOver] MONEY NOT NULL,
    [CD_DelSell_TurnOver] MONEY NOT NULL,
    [CD_Computation_Level] CHAR(1) NOT NULL,
    [CD_Min_BrokAmt] MONEY NOT NULL,
    [CD_Max_BrokAmt] MONEY NOT NULL,
    [CD_Min_ScripAmt] MONEY NOT NULL,
    [CD_Max_ScripAmt] MONEY NOT NULL,
    [CD_TimeStamp] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CHARGES_DETAIL_BKUP_17DEC2024
-- --------------------------------------------------
CREATE TABLE [dbo].[CHARGES_DETAIL_BKUP_17DEC2024]
(
    [CD_SrNo] INT IDENTITY(1,1) NOT NULL,
    [CD_Party_Code] VARCHAR(10) NOT NULL,
    [CD_Sett_No] VARCHAR(7) NOT NULL,
    [CD_Sett_Type] VARCHAR(2) NOT NULL,
    [CD_Sauda_Date] DATETIME NOT NULL,
    [CD_ContractNo] VARCHAR(14) NULL,
    [CD_Trade_No] VARCHAR(14) NOT NULL,
    [CD_Order_No] VARCHAR(16) NULL,
    [CD_Scrip_Cd] VARCHAR(12) NOT NULL,
    [CD_Series] VARCHAR(3) NOT NULL,
    [CD_BuyRate] MONEY NOT NULL,
    [CD_SellRate] MONEY NOT NULL,
    [CD_TrdBuy_Qty] INT NOT NULL,
    [CD_TrdSell_Qty] INT NOT NULL,
    [CD_DelBuy_Qty] INT NOT NULL,
    [CD_DelSell_Qty] INT NOT NULL,
    [CD_TrdBuyBrokerage] MONEY NOT NULL,
    [CD_TrdSellBrokerage] MONEY NOT NULL,
    [CD_DelBuyBrokerage] MONEY NOT NULL,
    [CD_DelSellBrokerage] MONEY NOT NULL,
    [CD_TotalBrokerage] MONEY NOT NULL,
    [CD_TrdBuySerTax] MONEY NOT NULL,
    [CD_TrdSellSerTax] MONEY NOT NULL,
    [CD_DelBuySerTax] MONEY NOT NULL,
    [CD_DelSellSerTax] MONEY NOT NULL,
    [CD_TotalSerTax] MONEY NOT NULL,
    [CD_TrdBuy_TurnOver] MONEY NOT NULL,
    [CD_TrdSell_TurnOver] MONEY NOT NULL,
    [CD_DelBuy_TurnOver] MONEY NOT NULL,
    [CD_DelSell_TurnOver] MONEY NOT NULL,
    [CD_Computation_Level] CHAR(1) NOT NULL,
    [CD_Min_BrokAmt] MONEY NOT NULL,
    [CD_Max_BrokAmt] MONEY NOT NULL,
    [CD_Min_ScripAmt] MONEY NOT NULL,
    [CD_Max_ScripAmt] MONEY NOT NULL,
    [CD_TimeStamp] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CHECKBROK01112023
-- --------------------------------------------------
CREATE TABLE [dbo].[CHECKBROK01112023]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [EXCH] VARCHAR(10) NOT NULL,
    [BROK_SCHEME] TINYINT NULL,
    [TRD_BROK] INT NULL,
    [DEL_BROK] INT NULL,
    [CASH_VBB_TRD] VARCHAR(2) NOT NULL,
    [CASH_VBB_DEL] VARCHAR(2) NOT NULL,
    [FUT_OPT_BROK] INT NULL,
    [FUT_FUT_FIN_BROK] INT NULL,
    [FUT_OPT_EXC] INT NULL,
    [FUT_BROK_APPLICABLE] INT NULL,
    [OPT_VBB_TRD] VARCHAR(2) NOT NULL,
    [OPT_VBB_DEL] VARCHAR(2) NOT NULL,
    [INACTIVE_FROM] VARCHAR(10) NULL,
    [ACTIVE_DATE] VARCHAR(10) NULL,
    [DEACTIVE_VALUE] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLI_BROK_CHANGE
-- --------------------------------------------------
CREATE TABLE [dbo].[CLI_BROK_CHANGE]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [TRD_BROK] INT NULL,
    [DEL_BROK] INT NULL,
    [FUT_BROK] INT NULL,
    [FUT_FUT_FIN_BROK] INT NULL,
    [FUT_OPT_BROK] INT NULL,
    [FUT_OPT_EXC] INT NULL,
    [ACTIVE_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details_02122023
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details_02122023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details_bak_12112022
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details_bak_12112022]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details_bak_20230429
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details_bak_20230429]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_07NOV2023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_07NOV2023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_19062023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_19062023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL,
    [CODE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_20220802
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_20220802]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_23062023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_23062023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_24072023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_24072023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_26OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_26OCT2023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_27OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_27OCT2023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_BKP_28NOV2024
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_BKP_28NOV2024]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL,
    [CODE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BROK_DETAILS_dor_19112022
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BROK_DETAILS_dor_19112022]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details_M1045277
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details_M1045277]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details_mcx10jan2023
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details_mcx10jan2023]
(
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_BSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_BSEFO]
(
    [SNO] BIGINT NULL,
    [Cl_Code] VARCHAR(10) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [Brok_Scheme] TINYINT NULL,
    [Trd_Brok] INT NULL,
    [Del_Brok] INT NULL,
    [Ser_Tax] TINYINT NULL,
    [Ser_Tax_Method] TINYINT NULL,
    [Credit_Limit] INT NOT NULL,
    [InActive_From] DATETIME NULL,
    [Print_Options] TINYINT NULL,
    [No_Of_Copies] INT NULL,
    [Participant_Code] VARCHAR(15) NULL,
    [Custodian_Code] VARCHAR(50) NULL,
    [Inst_Contract] CHAR(1) NULL,
    [Round_Style] INT NULL,
    [STP_Provider] VARCHAR(5) NULL,
    [STP_Rp_Style] INT NULL,
    [Market_Type] INT NULL,
    [Multiplier] INT NULL,
    [Charged] INT NULL,
    [Maintenance] INT NULL,
    [Reqd_By_Exch] INT NULL,
    [Reqd_By_Broker] INT NULL,
    [Client_Rating] VARCHAR(10) NULL,
    [Debit_Balance] CHAR(1) NULL,
    [Inter_Sett] CHAR(1) NULL,
    [TRD_STT] MONEY NULL,
    [Trd_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Trd_Sebi_Fees] NUMERIC(18, 6) NULL,
    [Trd_Stamp_Duty] MONEY NULL,
    [Trd_Other_Chrgs] MONEY NULL,
    [Trd_Eff_Dt] DATETIME NULL,
    [Del_Stt] MONEY NULL,
    [Del_Tran_Chrgs] NUMERIC(18, 6) NULL,
    [Del_SEBI_Fees] NUMERIC(18, 6) NULL,
    [Del_Stamp_Duty] MONEY NULL,
    [Del_Other_Chrgs] MONEY NULL,
    [Del_Eff_Dt] DATETIME NULL,
    [Rounding_Method] VARCHAR(10) NULL,
    [Round_To_Digit] TINYINT NULL,
    [Round_To_Paise] INT NULL,
    [Fut_Brok] INT NULL,
    [Fut_Opt_Brok] INT NULL,
    [Fut_Fut_Fin_Brok] INT NULL,
    [Fut_Opt_Exc] INT NULL,
    [Fut_Brok_Applicable] INT NULL,
    [Fut_Stt] SMALLINT NULL,
    [Fut_Tran_Chrgs] SMALLINT NULL,
    [Fut_Sebi_Fees] SMALLINT NULL,
    [Fut_Stamp_Duty] SMALLINT NULL,
    [Fut_Other_Chrgs] SMALLINT NULL,
    [Status] CHAR(1) NULL,
    [Modifiedon] DATETIME NULL,
    [Modifiedby] VARCHAR(25) NULL,
    [Imp_Status] TINYINT NULL,
    [Pay_B3B_Payment] CHAR(1) NULL,
    [Pay_Bank_name] VARCHAR(50) NULL,
    [Pay_Branch_name] VARCHAR(50) NULL,
    [Pay_AC_No] VARCHAR(10) NULL,
    [Pay_payment_Mode] CHAR(1) NULL,
    [Brok_Eff_Date] DATETIME NULL,
    [Inst_Trd_Brok] INT NULL,
    [Inst_Del_Brok] INT NULL,
    [SYSTEMDATE] DATETIME NULL,
    [Active_Date] DATETIME NULL,
    [CheckActiveClient] VARCHAR(1) NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_ACTIVE_LOG_13FEB24
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_ACTIVE_LOG_13FEB24]
(
    [CLTCODE] VARCHAR(10) NULL,
    [STATUS_FROM_DATE] DATETIME NULL,
    [STATUS_TO_DATE] DATETIME NULL,
    [STATUS_FLAG] VARCHAR(10) NULL,
    [UPD_TIME] DATETIME NULL,
    [UNAME] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_ACTIVE_LOG_BKP_20220531
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_ACTIVE_LOG_BKP_20220531]
(
    [CLTCODE] VARCHAR(10) NULL,
    [STATUS_FROM_DATE] DATETIME NULL,
    [STATUS_TO_DATE] DATETIME NULL,
    [STATUS_FLAG] VARCHAR(10) NULL,
    [UPD_TIME] DATETIME NULL,
    [UNAME] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_ACTIVE_LOG_bkp_20220608
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_ACTIVE_LOG_bkp_20220608]
(
    [CLTCODE] VARCHAR(10) NULL,
    [STATUS_FROM_DATE] DATETIME NULL,
    [STATUS_TO_DATE] DATETIME NULL,
    [STATUS_FLAG] VARCHAR(10) NULL,
    [UPD_TIME] DATETIME NULL,
    [UNAME] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_ACTIVE_LOG_BKP_20220616
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_ACTIVE_LOG_BKP_20220616]
(
    [CLTCODE] VARCHAR(10) NULL,
    [STATUS_FROM_DATE] DATETIME NULL,
    [STATUS_TO_DATE] DATETIME NULL,
    [STATUS_FLAG] VARCHAR(10) NULL,
    [UPD_TIME] DATETIME NULL,
    [UNAME] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_DETAILS_28Jan23_TO_6FEB23
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_DETAILS_28Jan23_TO_6FEB23]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [TRADING_PAN] VARCHAR(50) NULL,
    [UCC] VARCHAR(10) NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(50) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CL_TYPE] VARCHAR(50) NULL,
    [REPORT_DATE] DATETIME NULL,
    [LAST_SETT_DATE] VARCHAR(20) NULL,
    [RUNDATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_DETAILS_BKUP_08MAY2023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_DETAILS_BKUP_08MAY2023]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [TRADING_PAN] VARCHAR(50) NULL,
    [UCC] VARCHAR(10) NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(50) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CL_TYPE] VARCHAR(50) NULL,
    [REPORT_DATE] DATETIME NULL,
    [LAST_SETT_DATE] VARCHAR(20) NULL,
    [RUNDATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_LED_BALANCES_28Jan23_TO_6FEB23
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_LED_BALANCES_28Jan23_TO_6FEB23]
(
    [SNO] BIGINT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [VDT_BAL] MONEY NULL,
    [EDT_BAL] MONEY NULL,
    [OPEN_BILL1] MONEY NULL,
    [OPEN_BILL2] MONEY NULL,
    [CHQ_DEPOSITS] MONEY NULL,
    [CHQ_ISSUE] MONEY NULL,
    [MARGIN_REQ] MONEY NULL,
    [PEAK_FINANCIAL_LEDGER] MONEY NULL,
    [BG] MONEY NULL,
    [FDR] MONEY NULL,
    [GOV_IND_SEC] MONEY NULL,
    [Gilt_funds] MONEY NULL,
    [EPI_LEDGER] MONEY NULL,
    [POOL_ACCOUNT] MONEY NULL,
    [LEDACCOUNT] MONEY NULL,
    [COMM_VALUE] MONEY NULL,
    [CASH_COLL_MTF_POSITIONS] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_CASH_LED_BALANCES_bkup_26DEC2022
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_CASH_LED_BALANCES_bkup_26DEC2022]
(
    [SNO] BIGINT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [VDT_BAL] MONEY NULL,
    [EDT_BAL] MONEY NULL,
    [OPEN_BILL1] MONEY NULL,
    [OPEN_BILL2] MONEY NULL,
    [CHQ_DEPOSITS] MONEY NULL,
    [CHQ_ISSUE] MONEY NULL,
    [MARGIN_REQ] MONEY NULL,
    [PEAK_FINANCIAL_LEDGER] MONEY NULL,
    [BG] MONEY NULL,
    [FDR] MONEY NULL,
    [GOV_IND_SEC] MONEY NULL,
    [Gilt_funds] MONEY NULL,
    [EPI_LEDGER] MONEY NULL,
    [POOL_ACCOUNT] MONEY NULL,
    [LEDACCOUNT] MONEY NULL,
    [COMM_VALUE] MONEY NULL,
    [CASH_COLL_MTF_POSITIONS] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_code
-- --------------------------------------------------
CREATE TABLE [dbo].[client_code]
(
    [cl_Code] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_14122023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_14122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [pcode] VARCHAR(10) NULL,
    [amt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_20230705
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_20230705]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_A100130
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_A100130]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_A100131
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_A100131]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_bak_0808
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_bak_0808]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_bkp_15122023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_bkp_15122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_BKP_20220222_23
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_BKP_20220222_23]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_BKP_20221012
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_BKP_20221012]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_dec162023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_dec162023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_100720231
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_100720231]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_14122023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_14122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL,
    [pcode] VARCHAR(10) NULL,
    [amt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_26062023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_26062023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_bak_0808
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_bak_0808]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_bkp_15122023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_NEW_bkp_15122023]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UNCLEAR_RECEIPT] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_REC_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_TM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_RET_BY_CM] NUMERIC(18, 3) NULL,
    [GOV_SEC_TBILL_PLACED_BY_NCL] NUMERIC(18, 3) NULL,
    [BG_FUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_RET_WITH_CM] NUMERIC(18, 3) NULL,
    [BG_FUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [BG_NONFUNDED_PLACED_WITH_NCL] NUMERIC(18, 3) NULL,
    [SETTLEMENT_AMOUNT] NUMERIC(18, 3) NULL,
    [UNCLAIM_CL_FUNDS] VARCHAR(10) NULL,
    [CASH_COLL_MTF_POSITION] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_ORG_BKP_20220222_23
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_ORG_BKP_20220222_23]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_COLLATERAL_REPORTING_DETAILS_TODAY_BKP_20220727
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_COLLATERAL_REPORTING_DETAILS_TODAY_BKP_20220727]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [MTOM] NUMERIC(18, 3) NULL,
    [VDT_LEDGER] NUMERIC(18, 3) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [PEAK_LEDGER] NUMERIC(18, 3) NULL,
    [BG_REC_TM] NUMERIC(18, 3) NULL,
    [FD_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_REC_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_REC_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_REC_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_REC_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_REC_TM] NUMERIC(18, 3) NULL,
    [LIEU_EPI_LEDGER_CLTM] NUMERIC(18, 3) NULL,
    [POOL_ACCOUNT_CLTM] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [BG_RET_TM] NUMERIC(18, 3) NULL,
    [FD_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_TM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_TM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_TM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_TM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_TM] NUMERIC(18, 3) NULL,
    [CASH_WCM] NUMERIC(18, 3) NULL,
    [BG_WCM] NUMERIC(18, 3) NULL,
    [FD_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WCM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WCM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_WCM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WCM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_WCM] NUMERIC(18, 3) NULL,
    [CASH_RET_WCM] NUMERIC(18, 3) NULL,
    [BG_RET_CM] NUMERIC(18, 3) NULL,
    [FD_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_RET_CM] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_RET_CM] NUMERIC(18, 3) NULL,
    [NONAPPROVED_SEC_RET_RET_CM] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_RET_CM] NUMERIC(18, 3) NULL,
    [OTHER_COLL_RET_CM] NUMERIC(18, 3) NULL,
    [CASH_WNCL] NUMERIC(18, 3) NULL,
    [BG_WNCL] NUMERIC(18, 3) NULL,
    [FD_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_CASH_WNCL] NUMERIC(18, 3) NULL,
    [APPROVED_SEC_NONCASH_WNCL] NUMERIC(18, 3) NULL,
    [CC_APPROVED_COMM_WNCL] NUMERIC(18, 3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_custom_brok
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_custom_brok]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [B2c] VARCHAR(1) NULL,
    [Intraday_first_leg_percentage] VARCHAR(100) NULL,
    [Intraday_first_leg_Value] VARCHAR(100) NULL,
    [Intraday_Second_leg_percentage] VARCHAR(100) NULL,
    [Intraday_Second_leg_Value] VARCHAR(100) NULL,
    [Delivery_Brokerage_percentage] VARCHAR(100) NULL,
    [Delivery_Brokerage_Value] VARCHAR(100) NULL,
    [NSEFO_Futures_first_leg] VARCHAR(100) NULL,
    [NSEFO_Futures_Second_leg] VARCHAR(100) NULL,
    [Options_Nifty] VARCHAR(100) NULL,
    [Options_banknifty] VARCHAR(100) NULL,
    [Options_Options_all] VARCHAR(100) NULL,
    [NSX_Futures_first_leg] VARCHAR(100) NULL,
    [NSX_Futures_Second_leg] VARCHAR(100) NULL,
    [NSX_Options] VARCHAR(100) NULL,
    [MCX_Futures_first_leg] VARCHAR(100) NULL,
    [MCX_Futures_Second_leg] VARCHAR(100) NULL,
    [MCX_Options_gold] VARCHAR(100) NULL,
    [MCX_Options_Silver] VARCHAR(100) NULL,
    [MCX__Options_all] VARCHAR(100) NULL,
    [MCX_Options_Zinc] VARCHAR(100) NULL,
    [MCX_Options_CRUDEOIL] VARCHAR(100) NULL,
    [MCX_Options_Copper] VARCHAR(100) NULL,
    [dummy1] VARCHAR(50) NULL,
    [dummy2] VARCHAR(50) NULL,
    [dummy3] VARCHAR(50) NULL,
    [dummy4] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_details_backup_0707
-- --------------------------------------------------
CREATE TABLE [dbo].[client_details_backup_0707]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_details_BKP_19OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[client_details_BKP_19OCT2023]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_details_BKP_19OCT2024
-- --------------------------------------------------
CREATE TABLE [dbo].[client_details_BKP_19OCT2024]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Details_BKP_20221126
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Details_BKP_20221126]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Details_BKP_26042023
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Details_BKP_26042023]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_DETAILSBKP_03062023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_DETAILSBKP_03062023]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_DETAILSBKP_03062023_2
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_DETAILSBKP_03062023_2]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_LIST_sege_01092023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_LIST_sege_01092023]
(
    [CLTCODE] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_MASTER_UCC_DATA_BKP_02062023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_MASTER_UCC_DATA_BKP_02062023]
(
    [CODE] VARCHAR(50) NULL,
    [SRNO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [UPDATIONFLAG] VARCHAR(1) NULL,
    [RELATIONSHIP] VARCHAR(3) NULL,
    [MASTERPAN] VARCHAR(10) NULL,
    [TYPEOFFACILITY] VARCHAR(1) NULL,
    [CATEGORY] VARCHAR(3) NULL,
    [FATHERNAME] VARCHAR(105) NULL,
    [GENDER] VARCHAR(1) NULL,
    [NATIONALITY] VARCHAR(2) NULL,
    [NATIONALITY_OTHER] VARCHAR(100) NULL,
    [PAN_EXEMPT] VARCHAR(2) NULL,
    [PAN_EXEMPT_CATEGORY] VARCHAR(2) NULL,
    [AADHAR_UID] VARCHAR(20) NULL,
    [IN_PERSON] VARCHAR(1) NULL,
    [IN_PERSON_DATE] DATETIME NULL,
    [PEP] VARCHAR(3) NULL,
    [DATE_OF_DECLARATION] DATETIME NULL,
    [GROSS_INCOME] VARCHAR(2) NULL,
    [NET_WORTH] NUMERIC(30, 2) NULL,
    [NET_WORTH_DATE] DATETIME NULL,
    [PROOF_OF_ID] VARCHAR(2) NULL,
    [PROOF_OF_ADDRESS] VARCHAR(2) NULL,
    [OCCUPATION] VARCHAR(2) NULL,
    [OCCUPATION_OTHER] VARCHAR(50) NULL,
    [MARITALSTATUS] VARCHAR(2) NULL,
    [DATEOFCOMMENCMENT] DATETIME NULL,
    [PLACEOFINCORPRATION] VARCHAR(100) NULL,
    [STATUS] VARCHAR(2) NULL,
    [STATUS_OTHER] VARCHAR(50) NULL,
    [RES_STATUS_IND] VARCHAR(2) NULL,
    [DOCUMENTS] VARCHAR(1) NULL,
    [PERMFOREIGN_STATE] VARCHAR(30) NULL,
    [PERMFOREIGN_COUNTRY] VARCHAR(30) NULL,
    [PERMFOREIGN_ADDRESS_PROFF] VARCHAR(4) NULL,
    [PERMFOREIGN_REFID] VARCHAR(100) NULL,
    [PERMFOREIGN_REFID_DATE] DATETIME NULL,
    [PLACEOFCOMM] VARCHAR(100) NULL,
    [FORMNO] VARCHAR(20) NULL,
    [COR_ADDRESS_PROOF_REF_DATE] DATETIME NULL,
    [COR_ADD_PROOF_REF_ID] VARCHAR(100) NULL,
    [TRADE_CATEGORY] VARCHAR(25) NULL,
    [PROOF_ADDRESS_COMM] VARCHAR(25) NULL,
    [GROSS_ANN_COMM] VARCHAR(25) NULL,
    [PEP_COMM] VARCHAR(25) NULL,
    [OCCUPATION_COMM] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET1] VARCHAR(50) NULL,
    [PROOF_ADDRESS_DET2] VARCHAR(100) NULL,
    [PROOF_ADDRESS_DET3] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET4] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET5] VARCHAR(25) NULL,
    [COMM_OCC_OTHER] VARCHAR(25) NULL,
    [PANEXEMPTPROOF] VARCHAR(2) NULL,
    [PROOF_NUMBER] VARCHAR(25) NULL,
    [ISSUE_PLACE] VARCHAR(100) NULL,
    [ISSUE_DATE] DATETIME NULL,
    [GROSS_DATE] DATETIME NULL,
    [STATUS_REMARKS] VARCHAR(100) NULL,
    [PARTNERS_KARTA_UID] VARCHAR(10) NULL,
    [PARTNERS_CO_PARCENER_UID] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_MASTER_UCC_DATA_BKP_07072023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_MASTER_UCC_DATA_BKP_07072023]
(
    [SRNO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [UPDATIONFLAG] VARCHAR(1) NULL,
    [RELATIONSHIP] VARCHAR(3) NULL,
    [MASTERPAN] VARCHAR(10) NULL,
    [TYPEOFFACILITY] VARCHAR(1) NULL,
    [CATEGORY] VARCHAR(3) NULL,
    [FATHERNAME] VARCHAR(105) NULL,
    [GENDER] VARCHAR(1) NULL,
    [NATIONALITY] VARCHAR(2) NULL,
    [NATIONALITY_OTHER] VARCHAR(100) NULL,
    [PAN_EXEMPT] VARCHAR(2) NULL,
    [PAN_EXEMPT_CATEGORY] VARCHAR(2) NULL,
    [AADHAR_UID] VARCHAR(20) NULL,
    [IN_PERSON] VARCHAR(1) NULL,
    [IN_PERSON_DATE] DATETIME NULL,
    [PEP] VARCHAR(3) NULL,
    [DATE_OF_DECLARATION] DATETIME NULL,
    [GROSS_INCOME] VARCHAR(2) NULL,
    [NET_WORTH] NUMERIC(30, 2) NULL,
    [NET_WORTH_DATE] DATETIME NULL,
    [PROOF_OF_ID] VARCHAR(2) NULL,
    [PROOF_OF_ADDRESS] VARCHAR(2) NULL,
    [OCCUPATION] VARCHAR(2) NULL,
    [OCCUPATION_OTHER] VARCHAR(50) NULL,
    [MARITALSTATUS] VARCHAR(2) NULL,
    [DATEOFCOMMENCMENT] DATETIME NULL,
    [PLACEOFINCORPRATION] VARCHAR(100) NULL,
    [STATUS] VARCHAR(2) NULL,
    [STATUS_OTHER] VARCHAR(50) NULL,
    [RES_STATUS_IND] VARCHAR(2) NULL,
    [DOCUMENTS] VARCHAR(1) NULL,
    [PERMFOREIGN_STATE] VARCHAR(30) NULL,
    [PERMFOREIGN_COUNTRY] VARCHAR(30) NULL,
    [PERMFOREIGN_ADDRESS_PROFF] VARCHAR(4) NULL,
    [PERMFOREIGN_REFID] VARCHAR(100) NULL,
    [PERMFOREIGN_REFID_DATE] DATETIME NULL,
    [PLACEOFCOMM] VARCHAR(100) NULL,
    [FORMNO] VARCHAR(20) NULL,
    [COR_ADDRESS_PROOF_REF_DATE] DATETIME NULL,
    [COR_ADD_PROOF_REF_ID] VARCHAR(100) NULL,
    [TRADE_CATEGORY] VARCHAR(25) NULL,
    [PROOF_ADDRESS_COMM] VARCHAR(25) NULL,
    [GROSS_ANN_COMM] VARCHAR(25) NULL,
    [PEP_COMM] VARCHAR(25) NULL,
    [OCCUPATION_COMM] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET1] VARCHAR(50) NULL,
    [PROOF_ADDRESS_DET2] VARCHAR(100) NULL,
    [PROOF_ADDRESS_DET3] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET4] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET5] VARCHAR(25) NULL,
    [COMM_OCC_OTHER] VARCHAR(25) NULL,
    [PANEXEMPTPROOF] VARCHAR(2) NULL,
    [PROOF_NUMBER] VARCHAR(25) NULL,
    [ISSUE_PLACE] VARCHAR(100) NULL,
    [ISSUE_DATE] DATETIME NULL,
    [GROSS_DATE] DATETIME NULL,
    [STATUS_REMARKS] VARCHAR(100) NULL,
    [PARTNERS_KARTA_UID] VARCHAR(10) NULL,
    [PARTNERS_CO_PARCENER_UID] VARCHAR(10) NULL,
    [CODE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_MASTER_UCC_DATA_BKP_08_05_2023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_MASTER_UCC_DATA_BKP_08_05_2023]
(
    [SRNO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [UPDATIONFLAG] VARCHAR(1) NULL,
    [RELATIONSHIP] VARCHAR(3) NULL,
    [MASTERPAN] VARCHAR(10) NULL,
    [TYPEOFFACILITY] VARCHAR(1) NULL,
    [CATEGORY] VARCHAR(3) NULL,
    [FATHERNAME] VARCHAR(105) NULL,
    [GENDER] VARCHAR(1) NULL,
    [NATIONALITY] VARCHAR(2) NULL,
    [NATIONALITY_OTHER] VARCHAR(100) NULL,
    [PAN_EXEMPT] VARCHAR(2) NULL,
    [PAN_EXEMPT_CATEGORY] VARCHAR(2) NULL,
    [AADHAR_UID] VARCHAR(20) NULL,
    [IN_PERSON] VARCHAR(1) NULL,
    [IN_PERSON_DATE] DATETIME NULL,
    [PEP] VARCHAR(3) NULL,
    [DATE_OF_DECLARATION] DATETIME NULL,
    [GROSS_INCOME] VARCHAR(2) NULL,
    [NET_WORTH] NUMERIC(30, 2) NULL,
    [NET_WORTH_DATE] DATETIME NULL,
    [PROOF_OF_ID] VARCHAR(2) NULL,
    [PROOF_OF_ADDRESS] VARCHAR(2) NULL,
    [OCCUPATION] VARCHAR(2) NULL,
    [OCCUPATION_OTHER] VARCHAR(50) NULL,
    [MARITALSTATUS] VARCHAR(2) NULL,
    [DATEOFCOMMENCMENT] DATETIME NULL,
    [PLACEOFINCORPRATION] VARCHAR(100) NULL,
    [STATUS] VARCHAR(2) NULL,
    [STATUS_OTHER] VARCHAR(50) NULL,
    [RES_STATUS_IND] VARCHAR(2) NULL,
    [DOCUMENTS] VARCHAR(1) NULL,
    [PERMFOREIGN_STATE] VARCHAR(30) NULL,
    [PERMFOREIGN_COUNTRY] VARCHAR(30) NULL,
    [PERMFOREIGN_ADDRESS_PROFF] VARCHAR(4) NULL,
    [PERMFOREIGN_REFID] VARCHAR(100) NULL,
    [PERMFOREIGN_REFID_DATE] DATETIME NULL,
    [PLACEOFCOMM] VARCHAR(100) NULL,
    [FORMNO] VARCHAR(20) NULL,
    [COR_ADDRESS_PROOF_REF_DATE] DATETIME NULL,
    [COR_ADD_PROOF_REF_ID] VARCHAR(100) NULL,
    [TRADE_CATEGORY] VARCHAR(25) NULL,
    [PROOF_ADDRESS_COMM] VARCHAR(25) NULL,
    [GROSS_ANN_COMM] VARCHAR(25) NULL,
    [PEP_COMM] VARCHAR(25) NULL,
    [OCCUPATION_COMM] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET1] VARCHAR(50) NULL,
    [PROOF_ADDRESS_DET2] VARCHAR(100) NULL,
    [PROOF_ADDRESS_DET3] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET4] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET5] VARCHAR(25) NULL,
    [COMM_OCC_OTHER] VARCHAR(25) NULL,
    [PANEXEMPTPROOF] VARCHAR(2) NULL,
    [PROOF_NUMBER] VARCHAR(25) NULL,
    [ISSUE_PLACE] VARCHAR(100) NULL,
    [ISSUE_DATE] DATETIME NULL,
    [GROSS_DATE] DATETIME NULL,
    [STATUS_REMARKS] VARCHAR(100) NULL,
    [PARTNERS_KARTA_UID] VARCHAR(10) NULL,
    [PARTNERS_CO_PARCENER_UID] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_master_ucc_data_BKP_20220704
-- --------------------------------------------------
CREATE TABLE [dbo].[client_master_ucc_data_BKP_20220704]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [UPDATIONFLAG] VARCHAR(1) NULL,
    [RELATIONSHIP] VARCHAR(3) NULL,
    [MASTERPAN] VARCHAR(10) NULL,
    [TYPEOFFACILITY] VARCHAR(1) NULL,
    [CATEGORY] VARCHAR(3) NULL,
    [FATHERNAME] VARCHAR(105) NULL,
    [GENDER] VARCHAR(1) NULL,
    [NATIONALITY] VARCHAR(2) NULL,
    [NATIONALITY_OTHER] VARCHAR(100) NULL,
    [PAN_EXEMPT] VARCHAR(2) NULL,
    [PAN_EXEMPT_CATEGORY] VARCHAR(2) NULL,
    [AADHAR_UID] VARCHAR(20) NULL,
    [IN_PERSON] VARCHAR(1) NULL,
    [IN_PERSON_DATE] DATETIME NULL,
    [PEP] VARCHAR(3) NULL,
    [DATE_OF_DECLARATION] DATETIME NULL,
    [GROSS_INCOME] VARCHAR(2) NULL,
    [NET_WORTH] NUMERIC(30, 2) NULL,
    [NET_WORTH_DATE] DATETIME NULL,
    [PROOF_OF_ID] VARCHAR(2) NULL,
    [PROOF_OF_ADDRESS] VARCHAR(2) NULL,
    [OCCUPATION] VARCHAR(2) NULL,
    [OCCUPATION_OTHER] VARCHAR(50) NULL,
    [MARITALSTATUS] VARCHAR(2) NULL,
    [DATEOFCOMMENCMENT] DATETIME NULL,
    [PLACEOFINCORPRATION] VARCHAR(100) NULL,
    [STATUS] VARCHAR(2) NULL,
    [STATUS_OTHER] VARCHAR(50) NULL,
    [RES_STATUS_IND] VARCHAR(2) NULL,
    [DOCUMENTS] VARCHAR(1) NULL,
    [PERMFOREIGN_STATE] VARCHAR(30) NULL,
    [PERMFOREIGN_COUNTRY] VARCHAR(30) NULL,
    [PERMFOREIGN_ADDRESS_PROFF] VARCHAR(4) NULL,
    [PERMFOREIGN_REFID] VARCHAR(100) NULL,
    [PERMFOREIGN_REFID_DATE] DATETIME NULL,
    [PLACEOFCOMM] VARCHAR(100) NULL,
    [FORMNO] VARCHAR(20) NULL,
    [COR_ADDRESS_PROOF_REF_DATE] DATETIME NULL,
    [COR_ADD_PROOF_REF_ID] VARCHAR(100) NULL,
    [TRADE_CATEGORY] VARCHAR(25) NULL,
    [PROOF_ADDRESS_COMM] VARCHAR(25) NULL,
    [GROSS_ANN_COMM] VARCHAR(25) NULL,
    [PEP_COMM] VARCHAR(25) NULL,
    [OCCUPATION_COMM] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET1] VARCHAR(50) NULL,
    [PROOF_ADDRESS_DET2] VARCHAR(100) NULL,
    [PROOF_ADDRESS_DET3] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET4] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET5] VARCHAR(25) NULL,
    [COMM_OCC_OTHER] VARCHAR(25) NULL,
    [PANEXEMPTPROOF] VARCHAR(2) NULL,
    [PROOF_NUMBER] VARCHAR(25) NULL,
    [ISSUE_PLACE] VARCHAR(100) NULL,
    [ISSUE_DATE] DATETIME NULL,
    [GROSS_DATE] DATETIME NULL,
    [STATUS_REMARKS] VARCHAR(100) NULL,
    [PARTNERS_KARTA_UID] VARCHAR(10) NULL,
    [PARTNERS_CO_PARCENER_UID] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_MASTER_UCC_DATA_BKP_24042023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_MASTER_UCC_DATA_BKP_24042023]
(
    [SRNO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [UPDATIONFLAG] VARCHAR(1) NULL,
    [RELATIONSHIP] VARCHAR(3) NULL,
    [MASTERPAN] VARCHAR(10) NULL,
    [TYPEOFFACILITY] VARCHAR(1) NULL,
    [CATEGORY] VARCHAR(3) NULL,
    [FATHERNAME] VARCHAR(105) NULL,
    [GENDER] VARCHAR(1) NULL,
    [NATIONALITY] VARCHAR(2) NULL,
    [NATIONALITY_OTHER] VARCHAR(100) NULL,
    [PAN_EXEMPT] VARCHAR(2) NULL,
    [PAN_EXEMPT_CATEGORY] VARCHAR(2) NULL,
    [AADHAR_UID] VARCHAR(20) NULL,
    [IN_PERSON] VARCHAR(1) NULL,
    [IN_PERSON_DATE] DATETIME NULL,
    [PEP] VARCHAR(3) NULL,
    [DATE_OF_DECLARATION] DATETIME NULL,
    [GROSS_INCOME] VARCHAR(2) NULL,
    [NET_WORTH] NUMERIC(30, 2) NULL,
    [NET_WORTH_DATE] DATETIME NULL,
    [PROOF_OF_ID] VARCHAR(2) NULL,
    [PROOF_OF_ADDRESS] VARCHAR(2) NULL,
    [OCCUPATION] VARCHAR(2) NULL,
    [OCCUPATION_OTHER] VARCHAR(50) NULL,
    [MARITALSTATUS] VARCHAR(2) NULL,
    [DATEOFCOMMENCMENT] DATETIME NULL,
    [PLACEOFINCORPRATION] VARCHAR(100) NULL,
    [STATUS] VARCHAR(2) NULL,
    [STATUS_OTHER] VARCHAR(50) NULL,
    [RES_STATUS_IND] VARCHAR(2) NULL,
    [DOCUMENTS] VARCHAR(1) NULL,
    [PERMFOREIGN_STATE] VARCHAR(30) NULL,
    [PERMFOREIGN_COUNTRY] VARCHAR(30) NULL,
    [PERMFOREIGN_ADDRESS_PROFF] VARCHAR(4) NULL,
    [PERMFOREIGN_REFID] VARCHAR(100) NULL,
    [PERMFOREIGN_REFID_DATE] DATETIME NULL,
    [PLACEOFCOMM] VARCHAR(100) NULL,
    [FORMNO] VARCHAR(20) NULL,
    [COR_ADDRESS_PROOF_REF_DATE] DATETIME NULL,
    [COR_ADD_PROOF_REF_ID] VARCHAR(100) NULL,
    [TRADE_CATEGORY] VARCHAR(25) NULL,
    [PROOF_ADDRESS_COMM] VARCHAR(25) NULL,
    [GROSS_ANN_COMM] VARCHAR(25) NULL,
    [PEP_COMM] VARCHAR(25) NULL,
    [OCCUPATION_COMM] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET1] VARCHAR(50) NULL,
    [PROOF_ADDRESS_DET2] VARCHAR(100) NULL,
    [PROOF_ADDRESS_DET3] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET4] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET5] VARCHAR(25) NULL,
    [COMM_OCC_OTHER] VARCHAR(25) NULL,
    [PANEXEMPTPROOF] VARCHAR(2) NULL,
    [PROOF_NUMBER] VARCHAR(25) NULL,
    [ISSUE_PLACE] VARCHAR(100) NULL,
    [ISSUE_DATE] DATETIME NULL,
    [GROSS_DATE] DATETIME NULL,
    [STATUS_REMARKS] VARCHAR(100) NULL,
    [PARTNERS_KARTA_UID] VARCHAR(10) NULL,
    [PARTNERS_CO_PARCENER_UID] VARCHAR(10) NULL,
    [CODE] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_MASTER_UCC_DATA_BKP_26072023
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_MASTER_UCC_DATA_BKP_26072023]
(
    [SRNO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [UPDATIONFLAG] VARCHAR(1) NULL,
    [RELATIONSHIP] VARCHAR(3) NULL,
    [MASTERPAN] VARCHAR(10) NULL,
    [TYPEOFFACILITY] VARCHAR(1) NULL,
    [CATEGORY] VARCHAR(3) NULL,
    [FATHERNAME] VARCHAR(105) NULL,
    [GENDER] VARCHAR(1) NULL,
    [NATIONALITY] VARCHAR(2) NULL,
    [NATIONALITY_OTHER] VARCHAR(100) NULL,
    [PAN_EXEMPT] VARCHAR(2) NULL,
    [PAN_EXEMPT_CATEGORY] VARCHAR(2) NULL,
    [AADHAR_UID] VARCHAR(20) NULL,
    [IN_PERSON] VARCHAR(1) NULL,
    [IN_PERSON_DATE] DATETIME NULL,
    [PEP] VARCHAR(3) NULL,
    [DATE_OF_DECLARATION] DATETIME NULL,
    [GROSS_INCOME] VARCHAR(2) NULL,
    [NET_WORTH] NUMERIC(30, 2) NULL,
    [NET_WORTH_DATE] DATETIME NULL,
    [PROOF_OF_ID] VARCHAR(2) NULL,
    [PROOF_OF_ADDRESS] VARCHAR(2) NULL,
    [OCCUPATION] VARCHAR(2) NULL,
    [OCCUPATION_OTHER] VARCHAR(50) NULL,
    [MARITALSTATUS] VARCHAR(2) NULL,
    [DATEOFCOMMENCMENT] DATETIME NULL,
    [PLACEOFINCORPRATION] VARCHAR(100) NULL,
    [STATUS] VARCHAR(2) NULL,
    [STATUS_OTHER] VARCHAR(50) NULL,
    [RES_STATUS_IND] VARCHAR(2) NULL,
    [DOCUMENTS] VARCHAR(1) NULL,
    [PERMFOREIGN_STATE] VARCHAR(30) NULL,
    [PERMFOREIGN_COUNTRY] VARCHAR(30) NULL,
    [PERMFOREIGN_ADDRESS_PROFF] VARCHAR(4) NULL,
    [PERMFOREIGN_REFID] VARCHAR(100) NULL,
    [PERMFOREIGN_REFID_DATE] DATETIME NULL,
    [PLACEOFCOMM] VARCHAR(100) NULL,
    [FORMNO] VARCHAR(20) NULL,
    [COR_ADDRESS_PROOF_REF_DATE] DATETIME NULL,
    [COR_ADD_PROOF_REF_ID] VARCHAR(100) NULL,
    [TRADE_CATEGORY] VARCHAR(25) NULL,
    [PROOF_ADDRESS_COMM] VARCHAR(25) NULL,
    [GROSS_ANN_COMM] VARCHAR(25) NULL,
    [PEP_COMM] VARCHAR(25) NULL,
    [OCCUPATION_COMM] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET1] VARCHAR(50) NULL,
    [PROOF_ADDRESS_DET2] VARCHAR(100) NULL,
    [PROOF_ADDRESS_DET3] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET4] VARCHAR(25) NULL,
    [PROOF_ADDRESS_DET5] VARCHAR(25) NULL,
    [COMM_OCC_OTHER] VARCHAR(25) NULL,
    [PANEXEMPTPROOF] VARCHAR(2) NULL,
    [PROOF_NUMBER] VARCHAR(25) NULL,
    [ISSUE_PLACE] VARCHAR(100) NULL,
    [ISSUE_DATE] DATETIME NULL,
    [GROSS_DATE] DATETIME NULL,
    [STATUS_REMARKS] VARCHAR(100) NULL,
    [PARTNERS_KARTA_UID] VARCHAR(10) NULL,
    [PARTNERS_CO_PARCENER_UID] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_mismatch_bo
-- --------------------------------------------------
CREATE TABLE [dbo].[client_mismatch_bo]
(
    [client_code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_mismatch_bo_new
-- --------------------------------------------------
CREATE TABLE [dbo].[client_mismatch_bo_new]
(
    [client_code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_mismatch_bo-new-eod
-- --------------------------------------------------
CREATE TABLE [dbo].[client_mismatch_bo-new-eod]
(
    [client_code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLient_wise_Gst_Check
-- --------------------------------------------------
CREATE TABLE [dbo].[CLient_wise_Gst_Check]
(
    [party_code] VARCHAR(15) NULL,
    [exchange] VARCHAR(3) NULL,
    [segment] VARCHAR(10) NULL,
    [cgst] NUMERIC(38, 6) NULL,
    [SGST] NUMERIC(38, 6) NULL,
    [UGST] NUMERIC(38, 6) NULL,
    [IGST] NUMERIC(38, 6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client4_196_MSAJAG_bkp_20220114
-- --------------------------------------------------
CREATE TABLE [dbo].[client4_196_MSAJAG_bkp_20220114]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client4_196_MSAJAG_bkp_20220120
-- --------------------------------------------------
CREATE TABLE [dbo].[client4_196_MSAJAG_bkp_20220120]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client4_BKUP_03DEC2024_1248PM
-- --------------------------------------------------
CREATE TABLE [dbo].[Client4_BKUP_03DEC2024_1248PM]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client4_P59556
-- --------------------------------------------------
CREATE TABLE [dbo].[Client4_P59556]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client4_rajeev_200123
-- --------------------------------------------------
CREATE TABLE [dbo].[Client4_rajeev_200123]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client4_S258421
-- --------------------------------------------------
CREATE TABLE [dbo].[Client4_S258421]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client5_29_05_2023
-- --------------------------------------------------
CREATE TABLE [dbo].[client5_29_05_2023]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [Inactivefrom] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientbrokdata
-- --------------------------------------------------
CREATE TABLE [dbo].[clientbrokdata]
(
    [cl_code] VARCHAR(20) NULL,
    [SRNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientbrokdata1
-- --------------------------------------------------
CREATE TABLE [dbo].[clientbrokdata1]
(
    [cl_code] VARCHAR(20) NULL,
    [SRNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENTDATA_1
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENTDATA_1]
(
    [CLTCODE] VARCHAR(16) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENTDATA_2
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENTDATA_2]
(
    [CLTCODE] VARCHAR(16) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLS_WEBCONFIG_SETTING_BKUP_31AUG2024
-- --------------------------------------------------
CREATE TABLE [dbo].[CLS_WEBCONFIG_SETTING_BKUP_31AUG2024]
(
    [KEYNAME] VARCHAR(50) NULL,
    [KEYVALUE] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CMBILLVALAN_BKP_04102024
-- --------------------------------------------------
CREATE TABLE [dbo].[CMBILLVALAN_BKP_04102024]
(
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(3) NOT NULL,
    [BILLNO] VARCHAR(10) NULL,
    [CONTRACTNO] VARCHAR(10) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PARTY_NAME] VARCHAR(50) NULL,
    [SCRIP_CD] VARCHAR(12) NOT NULL,
    [SERIES] VARCHAR(3) NOT NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [ISIN] VARCHAR(12) NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [PQTYTRD] INT NULL,
    [PAMTTRD] MONEY NULL,
    [PQTYDEL] INT NULL,
    [PAMTDEL] MONEY NULL,
    [SQTYTRD] INT NULL,
    [SAMTTRD] MONEY NULL,
    [SQTYDEL] INT NULL,
    [SAMTDEL] MONEY NULL,
    [PBROKTRD] MONEY NULL,
    [SBROKTRD] MONEY NULL,
    [PBROKDEL] MONEY NULL,
    [SBROKDEL] MONEY NULL,
    [FAMILY] VARCHAR(10) NULL,
    [FAMILY_NAME] VARCHAR(50) NULL,
    [TERMINAL_ID] VARCHAR(10) NOT NULL,
    [CLIENTTYPE] VARCHAR(10) NULL,
    [TRADETYPE] VARCHAR(3) NOT NULL,
    [TRADER] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [PARTICIPANTCODE] VARCHAR(15) NULL,
    [PAMT] MONEY NOT NULL,
    [SAMT] MONEY NOT NULL,
    [PRATE] MONEY NULL,
    [SRATE] MONEY NULL,
    [TRDAMT] MONEY NULL,
    [DELAMT] MONEY NULL,
    [SERINEX] SMALLINT NULL,
    [SERVICE_TAX] MONEY NULL,
    [EXSERVICE_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [OTHER_CHRG] MONEY NULL,
    [REGION] VARCHAR(50) NULL,
    [START_DATE] VARCHAR(11) NULL,
    [END_DATE] VARCHAR(11) NULL,
    [UPDATE_DATE] VARCHAR(11) NULL,
    [STATUS_NAME] VARCHAR(15) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [MEMBERTYPE] VARCHAR(6) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [DUMMY1] VARCHAR(1) NULL,
    [DUMMY2] VARCHAR(1) NULL,
    [DUMMY3] VARCHAR(1) NULL,
    [DUMMY4] MONEY NULL,
    [DUMMY5] MONEY NULL,
    [AREA] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cn_test
-- --------------------------------------------------
CREATE TABLE [dbo].[cn_test]
(
    [ORDERBYFLAG] VARCHAR(155) NULL,
    [CONTRACTNO] VARCHAR(10) NULL,
    [CONTRACTNO_NEW] VARCHAR(10) NULL,
    [SAUDA_DATE] VARCHAR(30) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [SETT_DATE] VARCHAR(11) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [PARTYNAME] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [OFF_PHONE1] VARCHAR(50) NULL,
    [OFF_PHONE2] VARCHAR(50) NULL,
    [PAN_GIR_NO] VARCHAR(15) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] BIGINT NULL,
    [TMARK] VARCHAR(1) NULL,
    [SELL_BUY] VARCHAR(4) NOT NULL,
    [MARKETRATE] MONEY NULL,
    [MARKETAMT] MONEY NULL,
    [BROKERAGE] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [NETAMOUNT] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [IPFT_CHRG] NUMERIC(18, 4) NULL,
    [OTHER_CHRG] MONEY NULL,
    [NETAMOUNTALL] MONEY NULL,
    [PRINTF] TINYINT NULL,
    [BROK] MONEY NULL,
    [NETRATE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [BROKERSEBIREGNO] VARCHAR(20) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [CINNO] VARCHAR(100) NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [TRADER] VARCHAR(25) NULL,
    [AREA] VARCHAR(25) NULL,
    [REGION] VARCHAR(25) NULL,
    [FAMILY] VARCHAR(15) NULL,
    [MAPIDID] VARCHAR(20) NULL,
    [SEBI_NO] VARCHAR(25) NULL,
    [PARTICIPANT_CODE] VARCHAR(16) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [SERVICE_CHRG] TINYINT NULL,
    [SETTTYPE_DESC] VARCHAR(35) NULL,
    [BFCF_FLAG] VARCHAR(6) NULL,
    [CONTRACT_HEADER_DET] VARCHAR(200) NULL,
    [REMARK] VARCHAR(1) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [NETOBLIGATION] MONEY NULL,
    [SETTLEMENT_DET] VARCHAR(600) NULL,
    [CONTRACTNO_DET] VARCHAR(600) NULL,
    [BROKERSEBIREGNO_DET] VARCHAR(600) NULL,
    [MEMBERCODE_DET] VARCHAR(600) NULL,
    [CIN_DET] VARCHAR(600) NULL,
    [NETAMOUNTEX] NUMERIC(20, 6) NULL,
    [SEBI_TAXEX] NUMERIC(18, 4) NULL,
    [TURN_TAXEX] NUMERIC(18, 4) NULL,
    [BROKER_CHRGEX] NUMERIC(18, 4) NULL,
    [IPFT_CHRGEX] NUMERIC(18, 4) NULL,
    [OTHER_CHRGEX] NUMERIC(18, 4) NULL,
    [INS_CHRGEX] NUMERIC(18, 4) NULL,
    [SERVICE_TAXEX] NUMERIC(18, 4) NULL,
    [SCRIPNAME_NEW] VARCHAR(300) NULL,
    [REMARK_DET] VARCHAR(300) NULL,
    [ISIN] VARCHAR(12) NULL,
    [CGST_TAXEX] NUMERIC(18, 6) NULL,
    [SGST_TAXEX] NUMERIC(18, 6) NULL,
    [IGST_TAXEX] NUMERIC(18, 6) NULL,
    [UGST_TAXEX] NUMERIC(18, 6) NULL,
    [CGST] NUMERIC(18, 6) NULL,
    [SGST] NUMERIC(18, 6) NULL,
    [IGST] NUMERIC(18, 6) NULL,
    [UGST] NUMERIC(18, 6) NULL,
    [CLGSTNO] VARCHAR(30) NULL,
    [GSTFLAG] INT NULL,
    [CGST_PER] NUMERIC(18, 2) NULL,
    [SGST_PER] NUMERIC(18, 2) NULL,
    [IGST_PER] NUMERIC(18, 2) NULL,
    [UGST_PER] NUMERIC(18, 2) NULL,
    [TARGETSTATE] VARCHAR(30) NULL,
    [SOURCESTATE] VARCHAR(30) NULL,
    [STATE_CODE] VARCHAR(30) NULL,
    [DEAL_CLIENT_ADD] VARCHAR(MAX) NULL,
    [TGST_NO] VARCHAR(30) NULL,
    [TPAN_NO] VARCHAR(30) NULL,
    [TDESC_SERVICE] VARCHAR(100) NULL,
    [TACC_SERVICE_NO] VARCHAR(50) NULL,
    [TAXABLE_VALUE] NUMERIC(18, 4) NULL,
    [BROKERAGE_TAXEX] NUMERIC(18, 4) NULL,
    [FOREIGN_PRICE] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CNT_Mod_02072025
-- --------------------------------------------------
CREATE TABLE [dbo].[CNT_Mod_02072025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CNT_Mod_12062025
-- --------------------------------------------------
CREATE TABLE [dbo].[CNT_Mod_12062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CNT_Mod_12062025_1
-- --------------------------------------------------
CREATE TABLE [dbo].[CNT_Mod_12062025_1]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CNT_Mod_1505
-- --------------------------------------------------
CREATE TABLE [dbo].[CNT_Mod_1505]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL,
    [userId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CNT_Mod_16052025
-- --------------------------------------------------
CREATE TABLE [dbo].[CNT_Mod_16052025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL,
    [Narration] VARCHAR(50) NULL,
    [userId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CNT_NOTInBO_08092025
-- --------------------------------------------------
CREATE TABLE [dbo].[CNT_NOTInBO_08092025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.collateral_10042023
-- --------------------------------------------------
CREATE TABLE [dbo].[collateral_10042023]
(
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(20) NOT NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Trans_Date] DATETIME NOT NULL,
    [Cash] MONEY NOT NULL,
    [NonCash] MONEY NOT NULL,
    [ActualCash] MONEY NULL,
    [ActualNonCash] MONEY NULL,
    [EffectiveColl] MONEY NULL,
    [Active] TINYINT NULL,
    [TCode] NUMERIC(18, 0) NULL,
    [Remarks] VARCHAR(100) NULL,
    [LoginName] VARCHAR(25) NULL,
    [LoginTime] DATETIME NULL,
    [TotalFd] MONEY NULL,
    [TotalBg] MONEY NULL,
    [TotalSec] MONEY NULL,
    [TotalMargin] MONEY NULL,
    [OrgCash] MONEY NULL,
    [OrgNonCash] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CollateralDetails_10042023
-- --------------------------------------------------
CREATE TABLE [dbo].[CollateralDetails_10042023]
(
    [EffDate] DATETIME NULL,
    [Exchange] VARCHAR(3) NULL,
    [Segment] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(12) NULL,
    [Series] VARCHAR(3) NULL,
    [Isin] VARCHAR(20) NULL,
    [Cl_Rate] MONEY NULL,
    [Amount] MONEY NULL,
    [Qty] NUMERIC(18, 0) NULL,
    [HairCut] MONEY NULL,
    [FinalAmount] MONEY NULL,
    [PercentageCash] NUMERIC(18, 2) NULL,
    [PerecntageNonCash] NUMERIC(18, 2) NULL,
    [Receive_Date] DATETIME NULL,
    [Maturity_Date] DATETIME NULL,
    [Coll_Type] VARCHAR(6) NULL,
    [ClientType] VARCHAR(3) NULL,
    [Remarks] VARCHAR(50) NULL,
    [LoginName] VARCHAR(20) NULL,
    [LoginTime] DATETIME NULL,
    [Cash_Ncash] VARCHAR(2) NULL,
    [Group_Code] VARCHAR(15) NULL,
    [Fd_Bg_No] VARCHAR(20) NULL,
    [Bank_Code] VARCHAR(15) NULL,
    [Fd_Type] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CollateralDetails_bak_17072023
-- --------------------------------------------------
CREATE TABLE [dbo].[CollateralDetails_bak_17072023]
(
    [EffDate] DATETIME NULL,
    [Exchange] VARCHAR(3) NULL,
    [Segment] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(12) NULL,
    [Series] VARCHAR(3) NULL,
    [Isin] VARCHAR(20) NULL,
    [Cl_Rate] MONEY NULL,
    [Amount] MONEY NULL,
    [Qty] NUMERIC(18, 0) NULL,
    [HairCut] MONEY NULL,
    [FinalAmount] MONEY NULL,
    [PercentageCash] NUMERIC(18, 2) NULL,
    [PerecntageNonCash] NUMERIC(18, 2) NULL,
    [Receive_Date] DATETIME NULL,
    [Maturity_Date] DATETIME NULL,
    [Coll_Type] VARCHAR(6) NULL,
    [ClientType] VARCHAR(3) NULL,
    [Remarks] VARCHAR(50) NULL,
    [LoginName] VARCHAR(20) NULL,
    [LoginTime] DATETIME NULL,
    [Cash_Ncash] VARCHAR(2) NULL,
    [Group_Code] VARCHAR(15) NULL,
    [Fd_Bg_No] VARCHAR(20) NULL,
    [Bank_Code] VARCHAR(15) NULL,
    [Fd_Type] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Common_contract_Data_03JUL2025
-- --------------------------------------------------
CREATE TABLE [dbo].[Common_contract_Data_03JUL2025]
(
    [PARTY_CODE] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.COMPANY_MASTER_SETTING_BKUP_20Mar2024
-- --------------------------------------------------
CREATE TABLE [dbo].[COMPANY_MASTER_SETTING_BKUP_20Mar2024]
(
    [COMPANYNAME] VARCHAR(100) NULL,
    [SEGMENT_DESCRIPTION] VARCHAR(100) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(20) NULL,
    [SHAREDB] VARCHAR(20) NULL,
    [SHARESERVER] VARCHAR(15) NULL,
    [ACCOUNTDB] VARCHAR(20) NULL,
    [ACCOUNTSERVER] VARCHAR(15) NULL,
    [GROUPID] VARCHAR(10) NULL,
    [DEFAULTSEGMENT] BIT NULL,
    [ORDER_SEGMENT] INT NULL,
    [DISPLAY_EXCHANGE] VARCHAR(25) NULL,
    [DISPLAY_SEGMENT] VARCHAR(50) NULL,
    [CMS_CODE] VARCHAR(20) NULL,
    [BANK_CODE] VARCHAR(10) NULL,
    [Multicompany] TINYINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ContGen_15062023
-- --------------------------------------------------
CREATE TABLE [dbo].[ContGen_15062023]
(
    [ContractNo] VARCHAR(8) NULL,
    [Start_Date] DATETIME NULL,
    [End_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Contractnote_Daily_05JUN2023
-- --------------------------------------------------
CREATE TABLE [dbo].[Contractnote_Daily_05JUN2023]
(
    [ORDERBYFLAG] VARCHAR(155) NULL,
    [CONTRACTNO] VARCHAR(10) NULL,
    [CONTRACTNO_NEW] VARCHAR(10) NULL,
    [SAUDA_DATE] VARCHAR(30) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [SETT_DATE] VARCHAR(11) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [PARTYNAME] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [OFF_PHONE1] VARCHAR(50) NULL,
    [OFF_PHONE2] VARCHAR(50) NULL,
    [PAN_GIR_NO] VARCHAR(15) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] BIGINT NULL,
    [TMARK] VARCHAR(1) NULL,
    [SELL_BUY] VARCHAR(4) NOT NULL,
    [MARKETRATE] MONEY NULL,
    [MARKETAMT] MONEY NULL,
    [BROKERAGE] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [NETAMOUNT] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [OTHER_CHRG] MONEY NULL,
    [NETAMOUNTALL] MONEY NULL,
    [PRINTF] TINYINT NULL,
    [BROK] MONEY NULL,
    [NETRATE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [BROKERSEBIREGNO] VARCHAR(20) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [CINNO] VARCHAR(100) NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [TRADER] VARCHAR(25) NULL,
    [AREA] VARCHAR(25) NULL,
    [REGION] VARCHAR(25) NULL,
    [FAMILY] VARCHAR(15) NULL,
    [MAPIDID] VARCHAR(20) NULL,
    [SEBI_NO] VARCHAR(25) NULL,
    [PARTICIPANT_CODE] VARCHAR(16) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [SERVICE_CHRG] TINYINT NULL,
    [SETTTYPE_DESC] VARCHAR(35) NULL,
    [BFCF_FLAG] VARCHAR(6) NULL,
    [CONTRACT_HEADER_DET] VARCHAR(200) NULL,
    [REMARK] VARCHAR(1) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [NETOBLIGATION] MONEY NULL,
    [SETTLEMENT_DET] VARCHAR(600) NULL,
    [CONTRACTNO_DET] VARCHAR(600) NULL,
    [BROKERSEBIREGNO_DET] VARCHAR(600) NULL,
    [MEMBERCODE_DET] VARCHAR(600) NULL,
    [CIN_DET] VARCHAR(600) NULL,
    [NETAMOUNTEX] NUMERIC(20, 6) NULL,
    [SEBI_TAXEX] NUMERIC(18, 4) NULL,
    [TURN_TAXEX] NUMERIC(18, 4) NULL,
    [BROKER_CHRGEX] NUMERIC(18, 4) NULL,
    [OTHER_CHRGEX] NUMERIC(18, 4) NULL,
    [INS_CHRGEX] NUMERIC(18, 4) NULL,
    [SERVICE_TAXEX] NUMERIC(18, 4) NULL,
    [SCRIPNAME_NEW] VARCHAR(300) NULL,
    [REMARK_DET] VARCHAR(300) NULL,
    [ISIN] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Contractnote_Daily_BKP_20220901
-- --------------------------------------------------
CREATE TABLE [dbo].[Contractnote_Daily_BKP_20220901]
(
    [ORDERBYFLAG] VARCHAR(155) NULL,
    [CONTRACTNO] VARCHAR(10) NULL,
    [CONTRACTNO_NEW] VARCHAR(10) NULL,
    [SAUDA_DATE] VARCHAR(30) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [SETT_DATE] VARCHAR(11) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [PARTYNAME] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [OFF_PHONE1] VARCHAR(50) NULL,
    [OFF_PHONE2] VARCHAR(50) NULL,
    [PAN_GIR_NO] VARCHAR(15) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] BIGINT NULL,
    [TMARK] VARCHAR(1) NULL,
    [SELL_BUY] VARCHAR(4) NOT NULL,
    [MARKETRATE] MONEY NULL,
    [MARKETAMT] MONEY NULL,
    [BROKERAGE] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [NETAMOUNT] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [OTHER_CHRG] MONEY NULL,
    [NETAMOUNTALL] MONEY NULL,
    [PRINTF] TINYINT NULL,
    [BROK] MONEY NULL,
    [NETRATE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [BROKERSEBIREGNO] VARCHAR(20) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [CINNO] VARCHAR(100) NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [TRADER] VARCHAR(25) NULL,
    [AREA] VARCHAR(25) NULL,
    [REGION] VARCHAR(25) NULL,
    [FAMILY] VARCHAR(15) NULL,
    [MAPIDID] VARCHAR(20) NULL,
    [SEBI_NO] VARCHAR(25) NULL,
    [PARTICIPANT_CODE] VARCHAR(16) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [SERVICE_CHRG] TINYINT NULL,
    [SETTTYPE_DESC] VARCHAR(35) NULL,
    [BFCF_FLAG] VARCHAR(6) NULL,
    [CONTRACT_HEADER_DET] VARCHAR(200) NULL,
    [REMARK] VARCHAR(1) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [NETOBLIGATION] MONEY NULL,
    [SETTLEMENT_DET] VARCHAR(600) NULL,
    [CONTRACTNO_DET] VARCHAR(600) NULL,
    [BROKERSEBIREGNO_DET] VARCHAR(600) NULL,
    [MEMBERCODE_DET] VARCHAR(600) NULL,
    [CIN_DET] VARCHAR(600) NULL,
    [NETAMOUNTEX] NUMERIC(20, 6) NULL,
    [SEBI_TAXEX] NUMERIC(18, 4) NULL,
    [TURN_TAXEX] NUMERIC(18, 4) NULL,
    [BROKER_CHRGEX] NUMERIC(18, 4) NULL,
    [OTHER_CHRGEX] NUMERIC(18, 4) NULL,
    [INS_CHRGEX] NUMERIC(18, 4) NULL,
    [SERVICE_TAXEX] NUMERIC(18, 4) NULL,
    [SCRIPNAME_NEW] VARCHAR(300) NULL,
    [REMARK_DET] VARCHAR(300) NULL,
    [ISIN] VARCHAR(12) NULL,
    [CGST_TAXEX] NUMERIC(18, 6) NULL,
    [SGST_TAXEX] NUMERIC(18, 6) NULL,
    [IGST_TAXEX] NUMERIC(18, 6) NULL,
    [UGST_TAXEX] NUMERIC(18, 6) NULL,
    [CGST] NUMERIC(18, 6) NULL,
    [SGST] NUMERIC(18, 6) NULL,
    [IGST] NUMERIC(18, 6) NULL,
    [UGST] NUMERIC(18, 6) NULL,
    [CLGSTNO] VARCHAR(30) NULL,
    [GSTFLAG] INT NULL,
    [CGST_PER] NUMERIC(18, 2) NULL,
    [SGST_PER] NUMERIC(18, 2) NULL,
    [IGST_PER] NUMERIC(18, 2) NULL,
    [UGST_PER] NUMERIC(18, 2) NULL,
    [TARGETSTATE] VARCHAR(30) NULL,
    [SOURCESTATE] VARCHAR(30) NULL,
    [STATE_CODE] VARCHAR(30) NULL,
    [DEAL_CLIENT_ADD] VARCHAR(MAX) NULL,
    [TGST_NO] VARCHAR(30) NULL,
    [TPAN_NO] VARCHAR(30) NULL,
    [TDESC_SERVICE] VARCHAR(100) NULL,
    [TACC_SERVICE_NO] VARCHAR(50) NULL,
    [TAXABLE_VALUE] NUMERIC(18, 4) NULL,
    [BROKERAGE_TAXEX] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.costmast_09AUG2024
-- --------------------------------------------------
CREATE TABLE [dbo].[costmast_09AUG2024]
(
    [COSTNAME] CHAR(35) NOT NULL,
    [COSTCODE] SMALLINT NOT NULL,
    [CATCODE] SMALLINT NULL,
    [grpcode] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CUR_CLIENT_CASH_DETAILS_DATA_15012024
-- --------------------------------------------------
CREATE TABLE [dbo].[CUR_CLIENT_CASH_DETAILS_DATA_15012024]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [TRADING_PAN] VARCHAR(50) NULL,
    [UCC] VARCHAR(10) NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(50) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CL_TYPE] VARCHAR(50) NULL,
    [REPORT_DATE] DATETIME NULL,
    [LAST_SETT_DATE] VARCHAR(20) NULL,
    [RUNDATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CUR_CLIENT_CASH_LED_BALANCES_DATA_15012024
-- --------------------------------------------------
CREATE TABLE [dbo].[CUR_CLIENT_CASH_LED_BALANCES_DATA_15012024]
(
    [SNO] BIGINT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [VDT_BAL] MONEY NULL,
    [EDT_BAL] MONEY NULL,
    [OPEN_BILL1] MONEY NULL,
    [OPEN_BILL2] MONEY NULL,
    [CHQ_DEPOSITS] MONEY NULL,
    [CHQ_ISSUE] MONEY NULL,
    [MARGIN_REQ] MONEY NULL,
    [PEAK_FINANCIAL_LEDGER] MONEY NULL,
    [BG] MONEY NULL,
    [FDR] MONEY NULL,
    [GOV_IND_SEC] MONEY NULL,
    [Gilt_funds] MONEY NULL,
    [EPI_LEDGER] MONEY NULL,
    [POOL_ACCOUNT] MONEY NULL,
    [LEDACCOUNT] MONEY NULL,
    [COMM_VALUE] MONEY NULL,
    [CASH_COLL_MTF_POSITIONS] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DAILYDATA_LIVE
-- --------------------------------------------------
CREATE TABLE [dbo].[DAILYDATA_LIVE]
(
    [TABLENAME] VARCHAR(20) NULL,
    [DATE] DATE NULL,
    [CNT] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DATA48GL
-- --------------------------------------------------
CREATE TABLE [dbo].[DATA48GL]
(
    [LNAME] VARCHAR(100) NULL,
    [LNAME2] VARCHAR(100) NULL,
    [actyp] VARCHAR(10) NOT NULL,
    [accat] VARCHAR(1) NOT NULL,
    [familycd] VARCHAR(5) NOT NULL,
    [CODE] VARCHAR(20) NULL,
    [LNAME3] VARCHAR(100) NULL,
    [grpcode] VARCHAR(11) NOT NULL,
    [BookType] VARCHAR(1) NOT NULL,
    [MicrNo] VARCHAR(1) NOT NULL,
    [branchcode] VARCHAR(3) NOT NULL,
    [Btobpayment] VARCHAR(1) NOT NULL,
    [Paymode] VARCHAR(1) NOT NULL,
    [Pobankname] VARCHAR(9) NOT NULL,
    [Pobranch] VARCHAR(1) NOT NULL,
    [Pobankcode] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dataledger
-- --------------------------------------------------
CREATE TABLE [dbo].[dataledger]
(
    [cl_code] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DB_USERS
-- --------------------------------------------------
CREATE TABLE [dbo].[DB_USERS]
(
    [userid] INT NULL,
    [username] VARCHAR(50) NULL,
    [password] VARBINARY(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.deliveryclt_F_29032023
-- --------------------------------------------------
CREATE TABLE [dbo].[deliveryclt_F_29032023]
(
    [Sett_no] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(2) NOT NULL,
    [scrip_cd] VARCHAR(12) NOT NULL,
    [series] VARCHAR(3) NOT NULL,
    [Party_code] VARCHAR(10) NOT NULL,
    [Qty] INT NOT NULL,
    [Inout] VARCHAR(2) NOT NULL,
    [Branch_Cd] VARCHAR(10) NULL,
    [PartipantCode] VARCHAR(10) NULL,
    [I_ISIN] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_20220221_196_MSAJAG
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_20220221_196_MSAJAG]
(
    [SNo] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_20220221_197_BSEDB
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_20220221_197_BSEDB]
(
    [SNo] NUMERIC(18, 0) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL,
    [PRIORITYFLAG] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_20220221_197_MSAJAG
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_20220221_197_MSAJAG]
(
    [SNo] NUMERIC(18, 0) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL,
    [PRIORITYFLAG] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_20220221_201_BSEDB_AB
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_20220221_201_BSEDB_AB]
(
    [SNo] NUMERIC(18, 0) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_ROLLBACK_20220225_196_MSAJAG
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_ROLLBACK_20220225_196_MSAJAG]
(
    [SNo] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_ROLLBACK_20220225_197_BSEDB
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_ROLLBACK_20220225_197_BSEDB]
(
    [SNo] NUMERIC(18, 0) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL,
    [PRIORITYFLAG] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DELIVERYDP_BKP_ROLLBACK_20220225_197_MSAJAG
-- --------------------------------------------------
CREATE TABLE [dbo].[DELIVERYDP_BKP_ROLLBACK_20220225_197_MSAJAG]
(
    [SNo] NUMERIC(18, 0) NOT NULL,
    [DpType] VARCHAR(4) NULL,
    [DpId] VARCHAR(16) NULL,
    [DpCltNo] VARCHAR(16) NULL,
    [Description] VARCHAR(50) NULL,
    [ACCOUNTTYPE] VARCHAR(4) NULL,
    [LICENCENO] VARCHAR(20) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [DIVACNO] VARCHAR(10) NULL,
    [STATUS_FLAG] VARCHAR(1) NULL,
    [PRIORITYFLAG] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.delnet_2023097
-- --------------------------------------------------
CREATE TABLE [dbo].[delnet_2023097]
(
    [Sett_no] VARCHAR(7) NOT NULL,
    [Sett_type] CHAR(2) NOT NULL,
    [scrip_cd] VARCHAR(12) NOT NULL,
    [series] CHAR(2) NOT NULL,
    [Qty] INT NOT NULL,
    [Inout] VARCHAR(2) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DMSSSS
-- --------------------------------------------------
CREATE TABLE [dbo].[DMSSSS]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [DATE] VARCHAR(11) NULL,
    [NSECM LED BALANCE] VARCHAR(100) NULL,
    [NSECM LED BALANCE2] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dormant_19112022
-- --------------------------------------------------
CREATE TABLE [dbo].[dormant_19112022]
(
    [CL_CODE] VARCHAR(50) NULL,
    [REGION] VARCHAR(50) NULL,
    [BRANCH_CD] VARCHAR(50) NULL,
    [SUB_BROKER] VARCHAR(50) NULL,
    [B2C] VARCHAR(50) NULL,
    [TYPE_ACC] VARCHAR(50) NULL,
    [LAST_TRANS1] VARCHAR(50) NULL,
    [HOLDING1] VARCHAR(50) NULL,
    [HOLDING_DP] VARCHAR(50) NULL,
    [ACTIVE_DATE] VARCHAR(50) NULL,
    [SRNO] VARCHAR(50) NULL,
    [OmneManagerID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dormant1911
-- --------------------------------------------------
CREATE TABLE [dbo].[dormant1911]
(
    [CL_CODE] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dormant191122
-- --------------------------------------------------
CREATE TABLE [dbo].[dormant191122]
(
    [CL_CODE] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DormantSuspendClient_11112022
-- --------------------------------------------------
CREATE TABLE [dbo].[DormantSuspendClient_11112022]
(
    [CL_code] VARCHAR(50) NULL,
    [OmneManagerID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DP_Charges_for_Accrual
-- --------------------------------------------------
CREATE TABLE [dbo].[DP_Charges_for_Accrual]
(
    [Party_Code] VARCHAR(10) NULL,
    [DPID] VARCHAR(20) NULL,
    [Amc_Charge] MONEY NULL,
    [trans_charge] MONEY NULL,
    [total_Charges] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dp_details_amc
-- --------------------------------------------------
CREATE TABLE [dbo].[dp_details_amc]
(
    [trans_date] VARCHAR(10) NOT NULL,
    [HLD_AC_CODE] VARCHAR(16) NULL,
    [bsda] VARCHAR(3) NULL,
    [partycode] VARCHAR(15) NULL,
    [traded_flag] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DP_IPO_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[DP_IPO_DATA]
(
    [DEMAT_CODE] VARCHAR(17) NULL,
    [TRADING_CODE] VARCHAR(10) NULL,
    [BRANCH_CODE] VARCHAR(50) NULL,
    [SUB_BROKER] VARCHAR(50) NULL,
    [REGION] VARCHAR(50) NULL,
    [BTB_BTC] VARCHAR(10) NULL,
    [TRD_AVT_STATUS] VARCHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DP_Payout
-- --------------------------------------------------
CREATE TABLE [dbo].[DP_Payout]
(
    [DPID] VARCHAR(100) NOT NULL,
    [clcode] VARCHAR(50) NOT NULL,
    [Logdate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dp_rcs_dec
-- --------------------------------------------------
CREATE TABLE [dbo].[dp_rcs_dec]
(
    [CLTCODE] VARCHAR(10) NOT NULL,
    [amount] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [SEP_CHARges] MONEY NULL,
    [OCT_CHARges] MONEY NULL,
    [NOV_CHARges] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dp_rcs_dec_f
-- --------------------------------------------------
CREATE TABLE [dbo].[dp_rcs_dec_f]
(
    [CLTCODE] VARCHAR(10) NOT NULL,
    [amount] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [SEP_CHARges] MONEY NULL,
    [OCT_CHARges] MONEY NULL,
    [NOV_CHARges] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dphold_test
-- --------------------------------------------------
CREATE TABLE [dbo].[dphold_test]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [Cltdpid] VARCHAR(16) NULL,
    [SCRIP_CD] VARCHAR(12) NOT NULL,
    [SERIES] VARCHAR(3) NOT NULL,
    [qty] NUMERIC(38, 0) NULL,
    [certno] VARCHAR(16) NULL,
    [Trans_type] VARCHAR(5) NOT NULL,
    [Process_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DPID
-- --------------------------------------------------
CREATE TABLE [dbo].[DPID]
(
    [DP_ID] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EMDL_rectification
-- --------------------------------------------------
CREATE TABLE [dbo].[EMDL_rectification]
(
    [SNO] INT NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EXCHANGECCE_07MAY2024
-- --------------------------------------------------
CREATE TABLE [dbo].[EXCHANGECCE_07MAY2024]
(
    [CASHFILENAME] VARCHAR(200) NULL,
    [DATACASH] VARCHAR(MAX) NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.F_PS03_RCS
-- --------------------------------------------------
CREATE TABLE [dbo].[F_PS03_RCS]
(
    [foea_position_date] VARCHAR(50) NULL,
    [foea_desc] VARCHAR(50) NULL,
    [foea_segment_ind] VARCHAR(50) NULL,
    [foea_sett_type] VARCHAR(50) NULL,
    [foea_cm_code] VARCHAR(50) NULL,
    [foea_mem_type] VARCHAR(50) NULL,
    [foea_tm_code] VARCHAR(50) NULL,
    [foea_acc_type] VARCHAR(50) NULL,
    [foea_party_code] VARCHAR(50) NULL,
    [foea_inst_type] VARCHAR(50) NULL,
    [foea_symbol] VARCHAR(50) NULL,
    [foea_expirydate] VARCHAR(50) NULL,
    [foea_strike_price] VARCHAR(50) NULL,
    [foea_option_type] VARCHAR(50) NULL,
    [foea_cor_act_level] VARCHAR(50) NULL,
    [foea_preexall_longqty] VARCHAR(50) NULL,
    [foea_preexall_shortqty] VARCHAR(50) NULL,
    [foea_exercise_qty] VARCHAR(50) NULL,
    [foea_alloc_qty] VARCHAR(50) NULL,
    [foea_postexall_longqty] VARCHAR(50) NULL,
    [foea_postexall_shortqty] VARCHAR(50) NULL,
    [foea_Brought_Forward_long_Quantity] VARCHAR(50) NULL,
    [foea_Brought_Forward_long_Value] VARCHAR(50) NULL,
    [foea_Brought_Forward_Short_Quantity] VARCHAR(50) NULL,
    [foea_Brought_Forward_Short_Value] VARCHAR(50) NULL,
    [foea_Day_Buy_Open_Quantity] VARCHAR(50) NULL,
    [foea_Day_Buy_Open_Value] VARCHAR(50) NULL,
    [foea_Day_Sell_Open_Quantity] VARCHAR(50) NULL,
    [foea_Day_Sell_Open_Value] VARCHAR(50) NULL,
    [foea_preexall_longValue] VARCHAR(50) NULL,
    [foea_preexall_ShortValue] VARCHAR(50) NULL,
    [foea_postexall_longValue] VARCHAR(50) NULL,
    [foea_postexall_shortvalue] VARCHAR(50) NULL,
    [foea_SettlementPrice] VARCHAR(50) NULL,
    [foea_NetPremium] VARCHAR(50) NULL,
    [foea_Daily_MTM_Settlement_Value] VARCHAR(50) NULL,
    [foea_Futures_Final_Settlement_Value] VARCHAR(50) NULL,
    [foea_Exercised_Assigned_Value] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.final_02022026
-- --------------------------------------------------
CREATE TABLE [dbo].[final_02022026]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [year_fy] INT NULL,
    [Month_FY] INT NULL,
    [stt] MONEY NULL,
    [turn_tax] MONEY NULL,
    [other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Service_tax] MONEY NULL,
    [TRD_TYPE] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FINAL_PEAK_BENEFIT_Check
-- --------------------------------------------------
CREATE TABLE [dbo].[FINAL_PEAK_BENEFIT_Check]
(
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(2) NOT NULL,
    [TRANSDATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [SCRIP_CD] VARCHAR(12) NOT NULL,
    [SERIES] VARCHAR(3) NOT NULL,
    [SELLQTY] NUMERIC(38, 3) NULL,
    [EPNQTY_CC] NUMERIC(38, 3) NULL,
    [NONEPNQTY] NUMERIC(38, 3) NULL,
    [MARGIN_REQUIREMENT] NUMERIC(38, 4) NULL,
    [SELLAMOUNT] NUMERIC(38, 4) NULL,
    [SQOFFAMT] NUMERIC(38, 4) NULL,
    [CASHBENEFIT] NUMERIC(38, 6) NULL,
    [MARGIN_BENEFIT] NUMERIC(38, 6) NULL,
    [Free_QTY] FLOAT NULL,
    [mar_qty] FLOAT NULL,
    [mar_value] MONEY NULL,
    [mar_payin] FLOAT NULL,
    [ISIN] VARCHAR(20) NULL,
    [mar_benefit] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.finaltest_hold
-- --------------------------------------------------
CREATE TABLE [dbo].[finaltest_hold]
(
    [party_code] VARCHAR(10) NULL,
    [DPID] VARCHAR(20) NULL,
    [Scrip_Cd] VARCHAR(20) NULL,
    [series] VARCHAR(5) NULL,
    [ISIN] VARCHAR(16) NULL,
    [Free_QTY] FLOAT NULL,
    [CUSPA_QTY] FLOAT NULL,
    [Pledge_Qty] FLOAT NULL,
    [unsettled_qty] FLOAT NULL,
    [Payin_Qty] FLOAT NULL,
    [Pledge_Payin_Qty] FLOAT NULL,
    [Process_Date] DATETIME NULL,
    [pending_Qty] FLOAT NULL,
    [haricut] FLOAT NULL,
    [haircut] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FNO_TRADE_RCS
-- --------------------------------------------------
CREATE TABLE [dbo].[FNO_TRADE_RCS]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [amt] MONEY NULL,
    [EPI_Balance] MONEY NULL,
    [NON_CASH_COll] MONEY NULL,
    [TDATE] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FOMARGINNEW_LEDGERBAL_BKP_20221125
-- --------------------------------------------------
CREATE TABLE [dbo].[FOMARGINNEW_LEDGERBAL_BKP_20221125]
(
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL,
    [MARGINDATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [LEDBAL] MONEY NULL,
    [UPDATED_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FOMARGINNEW_LEDGERBAL_bkup_01DEC2022
-- --------------------------------------------------
CREATE TABLE [dbo].[FOMARGINNEW_LEDGERBAL_bkup_01DEC2022]
(
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL,
    [MARGINDATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [LEDBAL] MONEY NULL,
    [UPDATED_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.fund_movements_ledger_stg
-- --------------------------------------------------
CREATE TABLE [dbo].[fund_movements_ledger_stg]
(
    [vtyp] SMALLINT NOT NULL,
    [actionSegment] VARCHAR(20) NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL DEFAULT (getdate()),
    [edt] DATETIME NOT NULL DEFAULT (getdate()),
    [created_at] DATETIME NULL,
    [created_by] VARCHAR(20) NULL,
    [Valid] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.fut_ledger
-- --------------------------------------------------
CREATE TABLE [dbo].[fut_ledger]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_11092023
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_11092023]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO_04052024
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO_04052024]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO_08JAN2023
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO_08JAN2023]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO_11sep2023
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO_11sep2023]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO_14012026
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO_14012026]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO_18May2023
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO_18May2023]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO_18-May-2023
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO_18-May-2023]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GENERATE_SNO05102023
-- --------------------------------------------------
CREATE TABLE [dbo].[GENERATE_SNO05102023]
(
    [SRNO] INT NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.globals_BKUP_16MAY202
-- --------------------------------------------------
CREATE TABLE [dbo].[globals_BKUP_16MAY202]
(
    [year] VARCHAR(4) NULL,
    [exchange] VARCHAR(3) NULL,
    [service_tax] NUMERIC(5, 2) NULL,
    [service_tax_ac] VARCHAR(30) NULL,
    [turnover_ac] INT NULL,
    [sebi_turn_ac] INT NULL,
    [broker_note_ac] INT NULL,
    [other_chrg_ac] INT NULL,
    [exchange_gl_ac] VARCHAR(30) NULL,
    [year_start_dt] DATETIME NULL,
    [year_end_dt] DATETIME NULL,
    [CESS_Tax] NUMERIC(10, 4) NULL,
    [TrdBuyTrans] NUMERIC(18, 4) NULL,
    [TrdSellTrans] NUMERIC(18, 4) NULL,
    [DelBuyTrans] NUMERIC(18, 4) NULL,
    [DelSellTrans] NUMERIC(18, 4) NULL,
    [EDUCESSTAX] NUMERIC(18, 4) NULL,
    [STT_TAX_AC] INT NULL,
    [ETFSELLTRANS] NUMERIC(18, 4) NULL,
    [SBCCHARGE] NUMERIC(18, 4) NULL,
    [KRISHICHARGE] NUMERIC(18, 4) NULL,
    [RTSELLTRANS] NUMERIC(18, 4) NULL,
    [WRSELLTRANS] NUMERIC(18, 4) NULL,
    [IPFTCHRG] NUMERIC(18, 4) NULL,
    [IPFTCHRG_INS] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Globals_BKUP_20230419
-- --------------------------------------------------
CREATE TABLE [dbo].[Globals_BKUP_20230419]
(
    [year] VARCHAR(4) NULL,
    [exchange] VARCHAR(3) NULL,
    [service_tax] NUMERIC(5, 2) NULL,
    [service_tax_ac] VARCHAR(30) NULL,
    [turnover_ac] INT NULL,
    [sebi_turn_ac] INT NULL,
    [broker_note_ac] INT NULL,
    [other_chrg_ac] INT NULL,
    [exchange_gl_ac] VARCHAR(30) NULL,
    [year_start_dt] DATETIME NULL,
    [year_end_dt] DATETIME NULL,
    [CESS_Tax] NUMERIC(10, 4) NULL,
    [TrdBuyTrans] NUMERIC(18, 4) NULL,
    [TrdSellTrans] NUMERIC(18, 4) NULL,
    [DelBuyTrans] NUMERIC(18, 4) NULL,
    [DelSellTrans] NUMERIC(18, 4) NULL,
    [EDUCESSTAX] NUMERIC(18, 4) NULL,
    [STT_TAX_AC] INT NULL,
    [ETFSELLTRANS] NUMERIC(18, 4) NULL,
    [SBCCHARGE] NUMERIC(18, 4) NULL,
    [KRISHICHARGE] NUMERIC(18, 4) NULL,
    [RTSELLTRANS] NUMERIC(18, 4) NULL,
    [WRSELLTRANS] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GLOBALS_BKUP_30SEP2024
-- --------------------------------------------------
CREATE TABLE [dbo].[GLOBALS_BKUP_30SEP2024]
(
    [year] VARCHAR(4) NULL,
    [exchange] VARCHAR(3) NULL,
    [service_tax] NUMERIC(5, 2) NULL,
    [service_tax_ac] VARCHAR(30) NULL,
    [turnover_ac] INT NULL,
    [sebi_turn_ac] INT NULL,
    [broker_note_ac] INT NULL,
    [other_chrg_ac] INT NULL,
    [exchange_gl_ac] VARCHAR(30) NULL,
    [year_start_dt] DATETIME NULL,
    [year_end_dt] DATETIME NULL,
    [CESS_Tax] NUMERIC(10, 4) NULL,
    [TrdBuyTrans] NUMERIC(18, 4) NULL,
    [TrdSellTrans] NUMERIC(18, 4) NULL,
    [DelBuyTrans] NUMERIC(18, 4) NULL,
    [DelSellTrans] NUMERIC(18, 4) NULL,
    [EDUCESSTAX] NUMERIC(18, 4) NULL,
    [STT_TAX_AC] INT NULL,
    [ETFSELLTRANS] NUMERIC(18, 4) NULL,
    [SBCCHARGE] NUMERIC(18, 4) NULL,
    [KRISHICHARGE] NUMERIC(18, 4) NULL,
    [RTSELLTRANS] NUMERIC(18, 4) NULL,
    [WRSELLTRANS] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Gst_Change
-- --------------------------------------------------
CREATE TABLE [dbo].[Gst_Change]
(
    [sno] BIGINT NULL,
    [Cl_Code] VARCHAR(10) NOT NULL,
    [l_state] VARCHAR(50) NULL,
    [GST_LOcation] VARCHAR(100) NULL,
    [L_GST] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.HDFCBANK_03032022
-- --------------------------------------------------
CREATE TABLE [dbo].[HDFCBANK_03032022]
(
    [EXCHNAGE] VARCHAR(100) NULL,
    [CLTCODE] VARCHAR(100) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [EDT] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [DDNO] VARCHAR(100) NULL,
    [RELDT2] VARCHAR(100) NULL,
    [NARRATION] NVARCHAR(50) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.HDFCBANK20220302
-- --------------------------------------------------
CREATE TABLE [dbo].[HDFCBANK20220302]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [NARRATION] VARCHAR(100) NULL,
    [EXCHANGE] VARCHAR(100) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] VARCHAR(100) NULL,
    [DDNO] VARCHAR(100) NULL,
    [VTYP] VARCHAR(100) NULL,
    [RELDT2] VARCHAR(100) NULL,
    [Entry_DAte] VARCHAR(100) NULL,
    [ENTEREDBY] VARCHAR(100) NULL,
    [BOOKTYPE] VARCHAR(100) NULL,
    [SHORT_NAME] NVARCHAR(1) NULL,
    [REGION] NVARCHAR(1) NULL,
    [BRANCH_CD] NVARCHAR(1) NULL,
    [SUB_BROKER] NVARCHAR(1) NULL,
    [BANK_NAME] NVARCHAR(1) NULL,
    [AC_NUM] NVARCHAR(1) NULL,
    [EDT1] NVARCHAR(1) NULL,
    [EDT_TIME1] NVARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.HISTORY_28APR2025
-- --------------------------------------------------
CREATE TABLE [dbo].[HISTORY_28APR2025]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.history_CRCC1017
-- --------------------------------------------------
CREATE TABLE [dbo].[history_CRCC1017]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.History_MC81
-- --------------------------------------------------
CREATE TABLE [dbo].[History_MC81]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.HRISHI_TEST
-- --------------------------------------------------
CREATE TABLE [dbo].[HRISHI_TEST]
(
    [ID] INT NULL,
    [NAME] VARCHAR(100) NULL,
    [ADDRESS] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ICICI16022022
-- --------------------------------------------------
CREATE TABLE [dbo].[ICICI16022022]
(
    [EXCHNAGE] VARCHAR(100) NOT NULL,
    [CLTCODE] VARCHAR(100) NOT NULL,
    [VAMT] VARCHAR(100) NOT NULL,
    [DRCR] VARCHAR(100) NOT NULL,
    [VTYP] VARCHAR(100) NOT NULL,
    [VNO] VARCHAR(100) NOT NULL,
    [BOOKTYPE] VARCHAR(100) NOT NULL,
    [NODAY] VARCHAR(100) NOT NULL,
    [MISSTATUS] VARCHAR(100) NOT NULL,
    [VDT] VARCHAR(100) NOT NULL,
    [EDT] VARCHAR(100) NOT NULL,
    [CDT] VARCHAR(100) NOT NULL,
    [RELDT] VARCHAR(100) NOT NULL,
    [DDNO] VARCHAR(100) NOT NULL,
    [NARRATION] VARCHAR(100) NOT NULL,
    [ENTEREDBY] NVARCHAR(50) NOT NULL,
    [CATEGORY] NVARCHAR(50) NOT NULL,
    [RECOSTATUS] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.JVPNC
-- --------------------------------------------------
CREATE TABLE [dbo].[JVPNC]
(
    [SRNO] INT NOT NULL,
    [VDT] VARCHAR(10) NULL,
    [EDT] VARCHAR(10) NULL,
    [CLTCODE] VARCHAR(50) NULL,
    [DRCR] VARCHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [NARRATION] VARCHAR(504) NULL,
    [BRANCH] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.KOTAKLEC_SAMPLE_15JUL2025
-- --------------------------------------------------
CREATE TABLE [dbo].[KOTAKLEC_SAMPLE_15JUL2025]
(
    [PARTY_CODE] VARCHAR(50) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [SELL_BUY] INT NULL,
    [CONTRACTNO] VARCHAR(50) NULL,
    [EDUCESS] INT NULL,
    [EXCHAGE_LEVIES] DECIMAL(18, 4) NULL,
    [STT] DECIMAL(18, 4) NULL,
    [STAMPDUTY] DECIMAL(18, 4) NULL,
    [MINBROKERAGE] DECIMAL(18, 4) NULL,
    [NO_OF_TRANSACTIONS] INT NULL,
    [TOTALAMT] DECIMAL(18, 2) NULL,
    [TYPE] VARCHAR(5) NULL,
    [nseSett_no2] VARCHAR(50) NULL,
    [nseBank] VARCHAR(50) NULL,
    [rbi_refno] VARCHAR(50) NULL,
    [CliPISNo] VARCHAR(50) NULL,
    [CliBnkAcc] VARCHAR(50) NULL,
    [cliBankBranch] VARCHAR(100) NULL,
    [angelAcc] VARCHAR(50) NULL,
    [CONTRACTNO_NEW] VARCHAR(100) NULL,
    [DPid1] VARCHAR(16) NULL,
    [cltdpID1] VARCHAR(16) NULL,
    [Short_Name] VARCHAR(21) NULL,
    [SCRIP_CD] VARCHAR(12) NOT NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [ISIN] VARCHAR(12) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [Brokearge] MONEY NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [ExactAmount] MONEY NULL,
    [Weighted] MONEY NULL,
    [TotalMarketVal] MONEY NULL,
    [OtherCharges] MONEY NULL,
    [SETT_NO] VARCHAR(7) NOT NULL,
    [nsestt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.led_020224
-- --------------------------------------------------
CREATE TABLE [dbo].[led_020224]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.lED_bAL_TEST_SIVA
-- --------------------------------------------------
CREATE TABLE [dbo].[lED_bAL_TEST_SIVA]
(
    [CLTCODE] VARCHAR(10) NOT NULL,
    [PARTY_NAME] VARCHAR(100) NULL,
    [ENTITY_LEVEL] VARCHAR(20) NULL,
    [ENTITY_CODE] VARCHAR(25) NULL,
    [VDTBAL] MONEY NOT NULL,
    [EDTBAL] MONEY NOT NULL,
    [FDT_RECEIPT] MONEY NOT NULL,
    [FDT_PAYMENTS] MONEY NOT NULL,
    [MARGIN_BAL] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.led_mtf
-- --------------------------------------------------
CREATE TABLE [dbo].[led_mtf]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NULL,
    [edt] DATETIME NULL,
    [lno] INT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL,
    [COMP_NAME] VARCHAR(50) NULL,
    [UPDDATE] DATETIME NULL,
    [DBACTION] VARCHAR(20) NULL,
    [SNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.led_sebi
-- --------------------------------------------------
CREATE TABLE [dbo].[led_sebi]
(
    [Filename] VARCHAR(80) NULL,
    [Data] VARCHAR(8000) NULL,
    [SNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledg_mtf_09082024
-- --------------------------------------------------
CREATE TABLE [dbo].[ledg_mtf_09082024]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledg_nse_09082024
-- --------------------------------------------------
CREATE TABLE [dbo].[ledg_nse_09082024]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_02Feb2024
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_02Feb2024]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ledger_04122023
-- --------------------------------------------------
CREATE TABLE [dbo].[Ledger_04122023]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_06102025
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_06102025]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_17102023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_17102023]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_20230406
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_20230406]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_20241002_cash
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_20241002_cash]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_20241002_mtf
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_20241002_mtf]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_20250508
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_20250508]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_2211_mtf
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_2211_mtf]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_26072023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_26072023]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_30012024
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_30012024]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_bak_0304
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_bak_0304]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_BKP_20220222_ICICIBANK_EDT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_BKP_20220222_ICICIBANK_EDT_UPDATE]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_bkp_20220406
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_bkp_20220406]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_BKP_20220427
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_BKP_20220427]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_BKP_20220518
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_BKP_20220518]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_BKP_20220518_NEWFILE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_BKP_20220518_NEWFILE]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_BKP_20220609
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_BKP_20220609]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_bkp_20220715
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_bkp_20220715]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER_BKP_20220721
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER_BKP_20220721]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_mtf_04122023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_mtf_04122023]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_ReferAndEarn
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_ReferAndEarn]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_TFTRADE_20250508
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_TFTRADE_20250508]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger1_20230406
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger1_20230406]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger1_26072023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger1_26072023]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger1_BKP_18_08_2023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger1_BKP_18_08_2023]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220102_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220102_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220102_REL_DT_UPDATE_Vtype3
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220102_REL_DT_UPDATE_Vtype3]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220106_REL_DT_UPDATE_Vtype3
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220106_REL_DT_UPDATE_Vtype3]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger1_bkp_20220201
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger1_bkp_20220201]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220212_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220212_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220214_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220214_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220215_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220215_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220217_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220217_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220218_ICICI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220218_ICICI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220218_SBIBANK_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220218_SBIBANK_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220218_SBIBANK_REL_DT_UPDATE_New
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220218_SBIBANK_REL_DT_UPDATE_New]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220219_SBIBANK_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220219_SBIBANK_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220220_SBIBANK_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220220_SBIBANK_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220222_ICICIBANK_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220222_ICICIBANK_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220222_SBI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220222_SBI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220223_SBI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220223_SBI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220224_SBI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220224_SBI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220301_SBI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220301_SBI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220302_HDFC_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220302_HDFC_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220302_SBI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220302_SBI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220303_HDFC_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220303_HDFC_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220328_ICICIBANK_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220328_ICICIBANK_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220330_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220330_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220510_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220510_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220518_REL_DT_UPDATE_Vtype23
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220518_REL_DT_UPDATE_Vtype23]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220609_REL_DT_UPDATE_Vtype3
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220609_REL_DT_UPDATE_Vtype3]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220901_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220901_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220901_REL_DT_UPDATE_Vtype3
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220901_REL_DT_UPDATE_Vtype3]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220919_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220919_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220920_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220920_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_20220921_REL_DT_UPDATE_Vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_20220921_REL_DT_UPDATE_Vtype2]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LEDGER1_BKP_21220222_SBI_REL_DT_UPDATE
-- --------------------------------------------------
CREATE TABLE [dbo].[LEDGER1_BKP_21220222_SBI_REL_DT_UPDATE]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ledger1_BKUP_08MAY2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Ledger1_BKUP_08MAY2024]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ledger1_BKUP_13SEP2025
-- --------------------------------------------------
CREATE TABLE [dbo].[Ledger1_BKUP_13SEP2025]
(
    [bnkname] VARCHAR(100) NULL,
    [brnname] VARCHAR(100) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(30) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(100) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger2_26072023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger2_26072023]
(
    [vtype] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [camt] MONEY NULL,
    [costcode] SMALLINT NULL,
    [BookType] CHAR(2) NULL,
    [cltcode] VARCHAR(10) NULL,
    [Sno] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger3_26072023
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger3_26072023]
(
    [naratno] INT NOT NULL,
    [narr] VARCHAR(234) NULL,
    [refno] CHAR(12) NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [BookType] CHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LOADER_CHECK_CLIENT5
-- --------------------------------------------------
CREATE TABLE [dbo].[LOADER_CHECK_CLIENT5]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [BIRTHDATE] DATETIME NULL,
    [SEX] CHAR(1) NULL,
    [ACTIVEFROM] DATETIME NULL,
    [INTERACTMODE] TINYINT NULL,
    [REPATRIATAC] INT NOT NULL,
    [REPATRIATBANK] NUMERIC(18, 0) NULL,
    [REPATRIATACNO] VARCHAR(30) NULL,
    [INTRODUCER] VARCHAR(30) NULL,
    [APPROVER] VARCHAR(30) NULL,
    [KYCFORM] TINYINT NULL,
    [BANKCERT] TINYINT NULL,
    [PASSPORT] INT NOT NULL,
    [PASSPORTDTL] VARCHAR(30) NULL,
    [VOTERSID] INT NOT NULL,
    [VOTERSIDDTL] VARCHAR(30) NULL,
    [ITRETURN] INT NOT NULL,
    [ITRETURNDTL] VARCHAR(30) NULL,
    [DRIVELICEN] INT NOT NULL,
    [DRIVELICENDTL] VARCHAR(30) NULL,
    [RATIONCARD] INT NOT NULL,
    [RATIONCARDDTL] VARCHAR(30) NULL,
    [CORPDTLRECD] TINYINT NULL,
    [CORPDEED] TINYINT NULL,
    [ANUALREPORT] TINYINT NULL,
    [NETWORTHCERT] TINYINT NULL,
    [INACTIVEFROM] DATETIME NULL,
    [P_ADDRESS1] VARCHAR(50) NULL,
    [P_ADDRESS2] VARCHAR(50) NULL,
    [P_ADDRESS3] VARCHAR(50) NULL,
    [P_CITY] VARCHAR(40) NULL,
    [P_STATE] VARCHAR(50) NULL,
    [P_NATION] VARCHAR(15) NULL,
    [P_PHONE] VARCHAR(15) NULL,
    [P_ZIP] VARCHAR(10) NULL,
    [ADDEMAILID] VARCHAR(230) NULL,
    [PASSPORTDATEOFISSUE] DATETIME NULL,
    [PASSPORTPLACEOFISSUE] VARCHAR(30) NULL,
    [VOTERIDDATEOFISSUE] DATETIME NULL,
    [VOTERIDPLACEOFISSUE] VARCHAR(30) NULL,
    [ITRETURNDATEOFFILING] DATETIME NULL,
    [LICENCENODATEOFISSUE] DATETIME NULL,
    [LICENCENOPLACEOFISSUE] VARCHAR(30) NULL,
    [RATIONCARDDATEOFISSUE] DATETIME NULL,
    [RATIONCARDPLACEOFISSUE] VARCHAR(30) NULL,
    [CLIENT_AGRE_DT] DATETIME NULL,
    [REGR_NO] VARCHAR(50) NULL,
    [REGR_PLACE] VARCHAR(50) NULL,
    [REGR_DATE] DATETIME NULL,
    [REGR_AUTH] VARCHAR(50) NULL,
    [INTROD_CLIENT_ID] VARCHAR(50) NULL,
    [INTROD_RELATION] VARCHAR(50) NULL,
    [ANY_OTHER_ACC] VARCHAR(50) NULL,
    [SETT_MODE] VARCHAR(50) NULL,
    [DEALING_WITH_OTHRER_TM] VARCHAR(50) NOT NULL,
    [SYSTUMDATE] DATETIME NULL,
    [PASSPORTEXPDATE] DATETIME NULL,
    [DRIVEEXPDATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MAPPING_TABLE
-- --------------------------------------------------
CREATE TABLE [dbo].[MAPPING_TABLE]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [VBB_ID] VARCHAR(10) NULL,
    [SCHEME_NAME] VARCHAR(50) NULL,
    [FROM_TURNOVER] NUMERIC(18, 9) NULL,
    [TO_TURNOVER] NUMERIC(18, 9) NULL,
    [MIN_BROK] NUMERIC(18, 9) NULL,
    [MAX_BROK] NUMERIC(18, 9) NULL,
    [FROM_DATE] DATETIME NULL,
    [TO_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [TRD_SCHEME_ID] VARCHAR(10) NULL,
    [DEL_SCHEME_ID] VARCHAR(10) NULL,
    [DEL_FROM_TURNOVER] NUMERIC(18, 9) NULL,
    [DEL_TO_TURNOVER] NUMERIC(18, 9) NULL,
    [DEL_MIN_BROK] NUMERIC(18, 9) NULL,
    [DEL_MAX_BROK] NUMERIC(18, 9) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MARGIN_Peak_Ledger_Test
-- --------------------------------------------------
CREATE TABLE [dbo].[MARGIN_Peak_Ledger_Test]
(
    [MArgindate] DATETIME NULL,
    [Party_code] VARCHAR(20) NULL,
    [Bill_Reversal] MONEY NULL,
    [Jv_Reversal] MONEY NULL,
    [Exchange] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MARGIN_PROV_FINAL_SUMMARY_sep3
-- --------------------------------------------------
CREATE TABLE [dbo].[MARGIN_PROV_FINAL_SUMMARY_sep3]
(
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [P_SAUDADATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [PROV] VARCHAR(1) NULL,
    [SHORTAGE] NUMERIC(18, 2) NULL,
    [PENALTY_AMT] NUMERIC(18, 2) NULL,
    [POSITION_TYPE] VARCHAR(5) NULL,
    [LAST_SAUDA_DATE] VARCHAR(11) NOT NULL,
    [PENALTY_PERC] NUMERIC(18, 2) NULL,
    [EOD_MAR] NUMERIC(18, 2) NULL,
    [PEAK_MAR] NUMERIC(18, 2) NULL,
    [MTM_MAR] NUMERIC(18, 2) NULL,
    [EOD_SHRT] NUMERIC(18, 2) NULL,
    [PEAK_SHRT] NUMERIC(18, 2) NULL,
    [MTM_SHRT] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mismatch_net_payable_segmentwise-new
-- --------------------------------------------------
CREATE TABLE [dbo].[mismatch_net_payable_segmentwise-new]
(
    [exchange] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [client_code] VARCHAR(50) NULL,
    [net_payable_modernized] VARCHAR(50) NULL,
    [net_payable_backoffice] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_ctd_28Dec2023
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_ctd_28Dec2023]
(
    [party_code] VARCHAR(40) NOT NULL,
    [request_id] DECIMAL(20, 0) NOT NULL,
    [isin] VARCHAR(20) NOT NULL,
    [symbol] VARCHAR(30) NULL,
    [qty] INT NULL,
    [remark] VARCHAR(50) NULL,
    [amount] DECIMAL(15, 3) NULL,
    [request_date] DATE NOT NULL,
    [sauda_date] DATETIME NOT NULL,
    [batchtime] VARCHAR(40) NULL,
    [isfilegenerated] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_led_020224
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_led_020224]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_ledger_0501
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_ledger_0501]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_ledger_2211
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_ledger_2211]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_mmq_Scrip_wise
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_mmq_Scrip_wise]
(
    [SAUDA_DATE] VARCHAR(30) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [DIFF_NETAMT] NUMERIC(38, 2) NULL,
    [MMQQTY] NUMERIC(38, 0) NULL,
    [MMQ_VALUE] NUMERIC(38, 6) NULL,
    [Available_CM] NUMERIC(38, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_mmq_value
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_mmq_value]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [netamount] NUMERIC(38, 2) NULL,
    [MMQ_VALUE] NUMERIC(38, 4) NULL,
    [Available_CM] NUMERIC(38, 2) NULL,
    [Ledger_bal] MONEY NULL,
    [position_val] MONEY NULL,
    [process_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_nse_ledger_0501
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_nse_ledger_0501]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtf_pos
-- --------------------------------------------------
CREATE TABLE [dbo].[mtf_pos]
(
    [ORGBUYDATE] VARCHAR(30) NULL,
    [PROCESSDATE] VARCHAR(30) NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [LONG_NAME] VARCHAR(1) NOT NULL,
    [SCRIP_NAME] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MARKETVALUE] MONEY NULL,
    [NETVALUE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [HAIRCUT] NUMERIC(18, 4) NULL,
    [MTOMLOSS] NUMERIC(18, 4) NULL,
    [MARG_REQ] NUMERIC(18, 4) NULL,
    [TOTAL_REQ] NUMERIC(18, 4) NULL,
    [OPENDAY] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_POS_18092025
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_POS_18092025]
(
    [party_code] VARCHAR(10) NULL,
    [NSE_pOS_VAL] MONEY NULL,
    [BSE_pOS_VAL] MONEY NULL,
    [LED_Bal] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_PURCHASE_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_PURCHASE_DATA]
(
    [TRADEDATE] DATETIME NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SCRIP_CD] VARCHAR(10) NULL,
    [SERIES] VARCHAR(5) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [SELL_BUY] INT NULL,
    [ISIN] VARCHAR(16) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [Valid] INT NULL,
    [DUMMY1] VARCHAR(10) NULL,
    [DUMMY2] VARCHAR(10) NULL,
    [DUMMY3] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_PURCHASE_DATA_BKUP_12APR2025
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_PURCHASE_DATA_BKUP_12APR2025]
(
    [TRADEDATE] DATETIME NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SCRIP_CD] VARCHAR(10) NULL,
    [SERIES] VARCHAR(5) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [SELL_BUY] INT NULL,
    [ISIN] VARCHAR(16) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [Valid] INT NULL,
    [DUMMY1] VARCHAR(10) NULL,
    [DUMMY2] VARCHAR(10) NULL,
    [DUMMY3] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_test_12dec2023
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_test_12dec2023]
(
    [processdate] DATETIME NULL,
    [recordcnt] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_test_ledger_fo
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_test_ledger_fo]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_test_ledger_mtf
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_test_ledger_mtf]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_test_ledger_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_test_ledger_nse]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_test_tbl_mtf_data
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_test_tbl_mtf_data]
(
    [SNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [CURR_CL_RATE] NUMERIC(18, 4) NULL,
    [HAIRCUT] NUMERIC(18, 4) NULL,
    [MARGIN_REQ] NUMERIC(18, 4) NULL,
    [MTOM_LOSS] NUMERIC(18, 4) NULL,
    [FOMARGIN] NUMERIC(18, 4) NULL,
    [CMLEDBAL] NUMERIC(18, 4) NULL,
    [MTFLEDBAL] NUMERIC(18, 4) NULL,
    [FOLEDBAL] NUMERIC(18, 4) NULL,
    [CMCASHEQCOLLATERAL] NUMERIC(18, 4) NULL,
    [CMCASHCOLLATERAL] NUMERIC(18, 4) NULL,
    [CMNONCASHCOLLATERAL] NUMERIC(18, 4) NULL,
    [CMNONCASHCOLLATERAL_MTF] NUMERIC(18, 4) NULL,
    [CMDEBITHOLD] NUMERIC(18, 4) NULL,
    [CMDEBITHOLD_MTF] NUMERIC(18, 4) NULL,
    [CMOPENPOS] NUMERIC(18, 4) NULL,
    [MTFCASHEQCOLLATERAL] NUMERIC(18, 4) NULL,
    [MTFCASHCOLLATERAL] NUMERIC(18, 4) NULL,
    [MTFNONCASHCOLLATERAL] NUMERIC(18, 4) NULL,
    [FOCASHEQCOLLATERAL] NUMERIC(18, 4) NULL,
    [FOCASHCOLLATERAL] NUMERIC(18, 4) NULL,
    [FONONCASHCOLLATERAL] NUMERIC(18, 4) NULL,
    [FONONCASHCOLLATERAL_MTF] NUMERIC(18, 4) NULL,
    [NET_AVL_FUND] NUMERIC(18, 4) NULL,
    [POAHOLDING] NUMERIC(18, 4) NULL,
    [POAHOLDING_MTF] NUMERIC(18, 4) NULL,
    [SELLSHORT] NUMERIC(18, 4) NULL,
    [CASHDEBITADJ] NUMERIC(18, 4) NULL,
    [CASHNONCASHADJ] NUMERIC(18, 4) NULL,
    [FONONCASHADJ] NUMERIC(18, 4) NULL,
    [CASHLEDADJ] NUMERIC(18, 4) NULL,
    [FOLEDBALADJ] NUMERIC(18, 4) NULL,
    [POAADJ] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_test_tbl_product_hold_data
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_test_tbl_product_hold_data]
(
    [SRNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [SETT_NO] CHAR(7) NOT NULL,
    [SETT_TYPE] CHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [ISIN] VARCHAR(16) NULL,
    [QTY] NUMERIC(38, 0) NULL,
    [SEC_PAYIN] DATETIME NULL,
    [START_DATE] DATETIME NULL,
    [ORGQTY] NUMERIC(38, 0) NULL,
    [HOLDFLAG] VARCHAR(20) NULL,
    [CL_RATE] NUMERIC(18, 4) NULL,
    [HAIRCUT] NUMERIC(18, 4) NULL,
    [FOGFLAG] INT NULL,
    [MTFHAIRCUT] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MtfExchangeFileData_20250926
-- --------------------------------------------------
CREATE TABLE [dbo].[MtfExchangeFileData_20250926]
(
    [Srn] BIGINT NOT NULL,
    [NextDate] BIGINT NULL,
    [NextCash] BIGINT NULL,
    [ReportingDate] DATETIME NULL,
    [Party_code] VARCHAR(10) NULL,
    [ExchangeSegment] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NULL,
    [SERIES] VARCHAR(4) NULL,
    [BODQty] INT NULL,
    [BodValue] MONEY NULL,
    [DayBuyQty] INT NULL,
    [DayBuyValue] MONEY NULL,
    [DaySellQty] INT NULL,
    [DaySellValue] MONEY NULL,
    [EodQty] INT NULL,
    [EodValue] MONEY NULL,
    [EodAdjustValue] MONEY NULL,
    [EodCashCollateralDiff] MONEY NULL,
    [AdjBuyCash] MONEY NULL,
    [AdjSellCash] MONEY NULL,
    [ADJCashCollateral] MONEY NULL,
    [MtFLedgerBalance] MONEY NULL,
    [YesterdayCashCollateral] MONEY NULL,
    [CashCollateral] MONEY NULL,
    [PleadgedFlag] VARCHAR(10) NULL,
    [ClientAmount] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtfledger_bak_0304
-- --------------------------------------------------
CREATE TABLE [dbo].[mtfledger_bak_0304]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [edt] DATETIME NULL,
    [lno] INT NOT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NOT NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NOT NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NOT NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(234) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicltid_196_MSAJAG_bkp_20220114
-- --------------------------------------------------
CREATE TABLE [dbo].[multicltid_196_MSAJAG_bkp_20220114]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicltid_196_MSAJAG_bkp_20220120
-- --------------------------------------------------
CREATE TABLE [dbo].[multicltid_196_MSAJAG_bkp_20220120]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicltid_201_BSEDB_AB_bkp_20220114
-- --------------------------------------------------
CREATE TABLE [dbo].[multicltid_201_BSEDB_AB_bkp_20220114]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MULTICLTID_BKP_19MAR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[MULTICLTID_BKP_19MAR2024]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL,
    [DDPIFLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultiCltId_P59556
-- --------------------------------------------------
CREATE TABLE [dbo].[MultiCltId_P59556]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL,
    [DDPIFLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicltid_rajeev_200123
-- --------------------------------------------------
CREATE TABLE [dbo].[multicltid_rajeev_200123]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL,
    [DDPIFLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultiCltId_S258421
-- --------------------------------------------------
CREATE TABLE [dbo].[MultiCltId_S258421]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL,
    [DDPIFLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicltid02052024
-- --------------------------------------------------
CREATE TABLE [dbo].[multicltid02052024]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL,
    [DDPIFLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicltid30042024
-- --------------------------------------------------
CREATE TABLE [dbo].[multicltid30042024]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [CltDpNo] VARCHAR(16) NOT NULL,
    [DpId] VARCHAR(16) NOT NULL,
    [Introducer] VARCHAR(100) NULL,
    [DpType] VARCHAR(4) NOT NULL,
    [Def] INT NOT NULL,
    [DDPIFLAG] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multicompany_23FEB2024
-- --------------------------------------------------
CREATE TABLE [dbo].[multicompany_23FEB2024]
(
    [BrokerId] VARCHAR(6) NULL,
    [CompanyName] VARCHAR(100) NULL,
    [Exchange] VARCHAR(3) NULL,
    [Segment] VARCHAR(20) NULL,
    [MemberType] VARCHAR(3) NULL,
    [MemberCode] VARCHAR(15) NULL,
    [ShareDb] VARCHAR(20) NULL,
    [ShareServer] VARCHAR(15) NULL,
    [ShareIP] VARCHAR(15) NULL,
    [AccountDb] VARCHAR(20) NULL,
    [AccountServer] VARCHAR(15) NULL,
    [AccountIP] VARCHAR(15) NULL,
    [DefaultDb] VARCHAR(20) NULL,
    [DefaultDbServer] VARCHAR(20) NULL,
    [DefaultDbIP] VARCHAR(15) NULL,
    [DefaultClient] INT NULL,
    [PANGIR_No] VARCHAR(30) NULL,
    [PrimaryServer] VARCHAR(10) NULL,
    [Filler2] VARCHAR(10) NULL,
    [dbusername] VARCHAR(25) NULL,
    [dbpassword] VARCHAR(25) NULL,
    [FLDSRNO] TINYINT NULL,
    [Segment_Description] VARCHAR(100) NULL,
    [APPSHARE_ROOTFLDR_NAME] VARCHAR(20) NULL,
    [CATEGORY] VARCHAR(50) NULL,
    [CONTRACTGROUP] VARCHAR(10) NULL,
    [PAYMENT_BANK] VARCHAR(10) NULL,
    [ExchangeGroup] VARCHAR(25) NULL,
    [License] VARCHAR(500) NULL,
    [ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multiisin__CLNINDIA
-- --------------------------------------------------
CREATE TABLE [dbo].[multiisin__CLNINDIA]
(
    [Scrip_cd] VARCHAR(12) NULL,
    [Series] CHAR(2) NULL,
    [Isin] VARCHAR(20) NULL,
    [Valid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultiIsin_14AUg2025
-- --------------------------------------------------
CREATE TABLE [dbo].[MultiIsin_14AUg2025]
(
    [Scrip_cd] VARCHAR(12) NULL,
    [Series] CHAR(2) NULL,
    [Isin] VARCHAR(20) NULL,
    [Valid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MULTIISIN_30SEP2024
-- --------------------------------------------------
CREATE TABLE [dbo].[MULTIISIN_30SEP2024]
(
    [Scrip_cd] VARCHAR(12) NULL,
    [Series] CHAR(2) NULL,
    [Isin] VARCHAR(20) NULL,
    [Valid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultiIsin_BKP_20_01_23_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[MultiIsin_BKP_20_01_23_NSE]
(
    [Scrip_cd] VARCHAR(12) NULL,
    [Series] CHAR(2) NULL,
    [Isin] VARCHAR(20) NULL,
    [Valid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultiIsin_BKP_20230731_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[MultiIsin_BKP_20230731_NSE]
(
    [Scrip_cd] VARCHAR(12) NULL,
    [Series] CHAR(2) NULL,
    [Isin] VARCHAR(20) NULL,
    [Valid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultiIsin_INE501Y01019
-- --------------------------------------------------
CREATE TABLE [dbo].[MultiIsin_INE501Y01019]
(
    [Scrip_cd] VARCHAR(12) NULL,
    [Series] CHAR(2) NULL,
    [Isin] VARCHAR(20) NULL,
    [Valid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ncms_add_22aug2023
-- --------------------------------------------------
CREATE TABLE [dbo].[ncms_add_22aug2023]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [trader] VARCHAR(20) NULL,
    [long_name] VARCHAR(100) NULL,
    [short_name] VARCHAR(21) NOT NULL,
    [l_address1] VARCHAR(40) NOT NULL,
    [l_city] VARCHAR(40) NULL,
    [l_address2] VARCHAR(40) NULL,
    [l_state] VARCHAR(50) NULL,
    [l_address3] VARCHAR(40) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [ward_no] VARCHAR(50) NULL,
    [sebi_regn_no] VARCHAR(25) NULL,
    [res_phone1] VARCHAR(15) NULL,
    [res_phone2] VARCHAR(15) NULL,
    [off_phone1] VARCHAR(15) NULL,
    [off_phone2] VARCHAR(15) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [fax] VARCHAR(15) NULL,
    [email] VARCHAR(50) NULL,
    [cl_type] VARCHAR(3) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL,
    [family] VARCHAR(10) NOT NULL,
    [region] VARCHAR(50) NULL,
    [area] VARCHAR(10) NULL,
    [p_address1] VARCHAR(50) NULL,
    [p_city] VARCHAR(40) NULL,
    [p_address2] VARCHAR(50) NULL,
    [p_state] VARCHAR(50) NULL,
    [p_address3] VARCHAR(50) NULL,
    [p_nation] VARCHAR(15) NULL,
    [p_zip] VARCHAR(10) NULL,
    [p_phone] VARCHAR(15) NULL,
    [addemailid] VARCHAR(230) NULL,
    [sex] CHAR(1) NULL,
    [dob] DATETIME NULL,
    [introducer] VARCHAR(30) NULL,
    [approver] VARCHAR(30) NULL,
    [interactmode] TINYINT NULL,
    [passport_no] VARCHAR(30) NULL,
    [passport_issued_at] VARCHAR(30) NULL,
    [passport_issued_on] DATETIME NULL,
    [passport_expires_on] DATETIME NULL,
    [licence_no] VARCHAR(30) NULL,
    [licence_issued_at] VARCHAR(30) NULL,
    [licence_issued_on] DATETIME NULL,
    [licence_expires_on] DATETIME NULL,
    [rat_card_no] VARCHAR(30) NULL,
    [rat_card_issued_at] VARCHAR(30) NULL,
    [rat_card_issued_on] DATETIME NULL,
    [votersid_no] VARCHAR(30) NULL,
    [votersid_issued_at] VARCHAR(30) NULL,
    [votersid_issued_on] DATETIME NULL,
    [it_return_yr] VARCHAR(30) NULL,
    [it_return_filed_on] DATETIME NULL,
    [regr_no] VARCHAR(50) NULL,
    [regr_at] VARCHAR(50) NULL,
    [regr_on] DATETIME NULL,
    [regr_authority] VARCHAR(50) NULL,
    [client_agreement_on] DATETIME NULL,
    [sett_mode] VARCHAR(50) NULL,
    [dealing_with_other_tm] VARCHAR(50) NULL,
    [other_ac_no] VARCHAR(50) NULL,
    [introducer_id] VARCHAR(50) NULL,
    [introducer_relation] VARCHAR(50) NULL,
    [repatriat_bank] NUMERIC(18, 0) NULL,
    [repatriat_bank_ac_no] VARCHAR(30) NULL,
    [chk_kyc_form] TINYINT NULL,
    [chk_corporate_deed] TINYINT NULL,
    [chk_bank_certificate] TINYINT NULL,
    [chk_annual_report] TINYINT NULL,
    [chk_networth_cert] TINYINT NULL,
    [chk_corp_dtls_recd] TINYINT NULL,
    [Bank_Name] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [AC_Type] VARCHAR(10) NULL,
    [AC_Num] VARCHAR(20) NULL,
    [Depository1] VARCHAR(7) NULL,
    [DpId1] VARCHAR(16) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [Poa1] CHAR(1) NULL,
    [Depository2] VARCHAR(7) NULL,
    [DpId2] VARCHAR(16) NULL,
    [CltDpId2] VARCHAR(16) NULL,
    [Poa2] CHAR(1) NULL,
    [Depository3] VARCHAR(7) NULL,
    [DpId3] VARCHAR(16) NULL,
    [CltDpId3] VARCHAR(16) NULL,
    [Poa3] CHAR(1) NULL,
    [rel_mgr] VARCHAR(10) NULL,
    [c_group] VARCHAR(10) NULL,
    [sbu] VARCHAR(10) NULL,
    [Status] CHAR(1) NULL,
    [Imp_Status] TINYINT NULL,
    [ModifidedBy] VARCHAR(25) NULL,
    [ModifidedOn] DATETIME NULL,
    [Bank_id] NUMERIC(18, 0) NULL,
    [Mapin_id] VARCHAR(12) NULL,
    [UCC_Code] VARCHAR(12) NULL,
    [Micr_No] VARCHAR(10) NULL,
    [Director_name] VARCHAR(200) NULL,
    [paylocation] VARCHAR(20) NULL,
    [FMCode] VARCHAR(10) NULL,
    [INCOME_SLAB] INT NULL,
    [NETWORTH_SLAB] INT NULL,
    [PARENTCODE] VARCHAR(10) NULL,
    [PRODUCTCODE] VARCHAR(10) NULL,
    [RES_PHONE1_STD] VARCHAR(5) NULL,
    [RES_PHONE2_STD] VARCHAR(5) NULL,
    [OFF_PHONE1_STD] VARCHAR(5) NULL,
    [OFF_PHONE2_STD] VARCHAR(5) NULL,
    [P_PHONE_STD] VARCHAR(5) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NestOrderNo
-- --------------------------------------------------
CREATE TABLE [dbo].[NestOrderNo]
(
    [UserId] VARCHAR(50) NULL,
    [NestOrderNo] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NriBse
-- --------------------------------------------------
CREATE TABLE [dbo].[NriBse]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [TradeQty] INT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Sell_Buy] INT NOT NULL,
    [NbrokApp] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Turn_tax] MONEY NULL,
    [Other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [MarketRate] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NRIBSE_04JUL2025
-- --------------------------------------------------
CREATE TABLE [dbo].[NRIBSE_04JUL2025]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [TradeQty] INT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Sell_Buy] INT NOT NULL,
    [NbrokApp] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Turn_tax] MONEY NULL,
    [Other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [MarketRate] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NRIBSE_BKP_24JUN2025
-- --------------------------------------------------
CREATE TABLE [dbo].[NRIBSE_BKP_24JUN2025]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [TradeQty] INT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Sell_Buy] INT NOT NULL,
    [NbrokApp] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Turn_tax] MONEY NULL,
    [Other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [MarketRate] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NriNse
-- --------------------------------------------------
CREATE TABLE [dbo].[NriNse]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [TradeQty] INT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Sell_Buy] INT NOT NULL,
    [NbrokApp] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Turn_tax] MONEY NULL,
    [Other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [MarketRate] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NRINSE_04JUL2025
-- --------------------------------------------------
CREATE TABLE [dbo].[NRINSE_04JUL2025]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [TradeQty] INT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Sell_Buy] INT NOT NULL,
    [NbrokApp] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Turn_tax] MONEY NULL,
    [Other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [MarketRate] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NRINSE_BKP_24JUN2025
-- --------------------------------------------------
CREATE TABLE [dbo].[NRINSE_BKP_24JUN2025]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [TradeQty] INT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Sell_Buy] INT NOT NULL,
    [NbrokApp] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Turn_tax] MONEY NULL,
    [Other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [MarketRate] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process]
(
    [Data_text] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_03JULY2025
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_03JULY2025]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_29122023
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_29122023]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_live_bkp_07feb
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_live_bkp_07feb]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_test
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_test]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_test_final
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_test_final]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_test_missing
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_test_missing]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_bulk_process_test1
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_bulk_process_test1]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse_scrip
-- --------------------------------------------------
CREATE TABLE [dbo].[nse_scrip]
(
    [Token] INT NULL,
    [Symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(51) NULL,
    [A1] VARCHAR(52) NULL,
    [A2] VARCHAR(53) NULL,
    [A3] VARCHAR(54) NULL,
    [A4] VARCHAR(55) NULL,
    [A5] VARCHAR(56) NULL,
    [Active] VARCHAR(57) NULL,
    [A7] VARCHAR(58) NULL,
    [A8] VARCHAR(59) NULL,
    [A9] VARCHAR(60) NULL,
    [A10] VARCHAR(61) NULL,
    [A11] VARCHAR(62) NULL,
    [A12] VARCHAR(63) NULL,
    [A13] VARCHAR(64) NULL,
    [A14] VARCHAR(65) NULL,
    [A15] VARCHAR(66) NULL,
    [A16] VARCHAR(67) NULL,
    [A17] VARCHAR(68) NULL,
    [A18] VARCHAR(69) NULL,
    [A19] VARCHAR(70) NULL,
    [A20] VARCHAR(71) NULL,
    [A21] VARCHAR(72) NULL,
    [A22] VARCHAR(73) NULL,
    [A23] VARCHAR(74) NULL,
    [A24] VARCHAR(75) NULL,
    [A25] VARCHAR(76) NULL,
    [A26] VARCHAR(77) NULL,
    [A27] VARCHAR(78) NULL,
    [A28] VARCHAR(79) NULL,
    [A29] VARCHAR(80) NULL,
    [A30] VARCHAR(81) NULL,
    [A31] VARCHAR(82) NULL,
    [A32] VARCHAR(83) NULL,
    [A33] VARCHAR(84) NULL,
    [A34] VARCHAR(85) NULL,
    [A35] VARCHAR(86) NULL,
    [A36] VARCHAR(87) NULL,
    [A37] VARCHAR(88) NULL,
    [A38] VARCHAR(89) NULL,
    [A39] VARCHAR(90) NULL,
    [A40] VARCHAR(91) NULL,
    [A41] VARCHAR(92) NULL,
    [A42] VARCHAR(93) NULL,
    [A43] VARCHAR(94) NULL,
    [A44] VARCHAR(95) NULL,
    [A45] VARCHAR(96) NULL,
    [A46] VARCHAR(97) NULL,
    [A47] VARCHAR(98) NULL,
    [A48] VARCHAR(99) NULL,
    [A49] VARCHAR(100) NULL,
    [A50] VARCHAR(101) NULL,
    [ISIN] VARCHAR(102) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014BACKENDRECODT07052022
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014BACKENDRECODT07052022]
(
    [EXCHNAGE] NVARCHAR(150) NULL,
    [CLTCODE] NVARCHAR(150) NULL,
    [KEYYY] NVARCHAR(150) NULL,
    [RECO_PERSON] NVARCHAR(150) NULL,
    [VAMT] FLOAT NULL,
    [DRCR] NVARCHAR(150) NULL,
    [VTYP] TINYINT NULL,
    [VNO] NVARCHAR(150) NULL,
    [BOOKTYPE] NVARCHAR(150) NULL,
    [NODAY] NVARCHAR(150) NULL,
    [MISSTATUS] NVARCHAR(150) NULL,
    [VDT] DATE NULL,
    [EDT] DATE NULL,
    [CDT] DATETIME2 NULL,
    [RELDT] DATETIME2 NULL,
    [DDNO] NVARCHAR(150) NULL,
    [NARRATION] NVARCHAR(150) NULL,
    [ENTEREDBY] NVARCHAR(150) NULL,
    [CATEGORY] NVARCHAR(150) NULL,
    [RECOSTATUS] NVARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014BACKENDRECODT09062022DR
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014BACKENDRECODT09062022DR]
(
    [EXCHNAGE] NVARCHAR(100) NULL,
    [CLTCODE] NVARCHAR(100) NULL,
    [VAMT] FLOAT NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] TINYINT NULL,
    [VNO] BIGINT NULL,
    [BOOKTYPE] TINYINT NULL,
    [NODAY] TINYINT NULL,
    [MISSTATUS] NVARCHAR(100) NULL,
    [VDT] DATE NULL,
    [EDT] DATE NULL,
    [CDT] DATETIME2 NULL,
    [RELDT] DATETIME2 NULL,
    [DDNO] NVARCHAR(100) NULL,
    [NARRATION] NVARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [CATEGORY] NVARCHAR(50) NULL,
    [RECOSTATUS] NVARCHAR(50) NULL,
    [column19] NVARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014BACKENDRECODT18052022PAYOUT
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014BACKENDRECODT18052022PAYOUT]
(
    [EXCHNAGE] NVARCHAR(150) NULL,
    [CLTCODE] VARCHAR(50) NULL,
    [KEYY] NVARCHAR(150) NULL,
    [RECO_PERSON] NVARCHAR(150) NULL,
    [VAMT] NVARCHAR(100) NULL,
    [DRCR] NVARCHAR(150) NULL,
    [VTYP] VARCHAR(50) NULL,
    [VNO] VARCHAR(50) NULL,
    [BOOKTYPE] VARCHAR(50) NULL,
    [NODAY] VARCHAR(50) NULL,
    [MISSTATUS] VARCHAR(501) NULL,
    [VDT] VARCHAR(50) NULL,
    [EDT] VARCHAR(50) NULL,
    [CDT] VARCHAR(50) NULL,
    [RELDT] VARCHAR(50) NULL,
    [DDNO] NVARCHAR(100) NULL,
    [NARRATION] NVARCHAR(1100) NULL,
    [ENTEREDBY] NVARCHAR(150) NULL,
    [CATEGORY] NVARCHAR(150) NULL,
    [RECOSTATUS] NVARCHAR(510) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nse03014backendrecodt21062022dr
-- --------------------------------------------------
CREATE TABLE [dbo].[nse03014backendrecodt21062022dr]
(
    [EXCHNAGE] NVARCHAR(50) NULL,
    [CLTCODE] NVARCHAR(50) NULL,
    [VAMT] NVARCHAR(50) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] NVARCHAR(50) NULL,
    [VNO] NVARCHAR(50) NULL,
    [BOOKTYPE] NVARCHAR(50) NULL,
    [NODAY] NVARCHAR(50) NULL,
    [MISSTATUS] NVARCHAR(50) NULL,
    [VDT] NVARCHAR(50) NULL,
    [EDT] NVARCHAR(50) NULL,
    [CDT] NVARCHAR(50) NULL,
    [RELDT] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [NARRATION] NVARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [CATEGORY] NVARCHAR(50) NULL,
    [RECOSTATUS] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014BACKENDRECODT29082022PAYOUT
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014BACKENDRECODT29082022PAYOUT]
(
    [EXCHNAGE] NVARCHAR(100) NULL,
    [CLTCODE] NVARCHAR(100) NULL,
    [VAMT] NVARCHAR(100) NULL,
    [DRCR] NVARCHAR(100) NULL,
    [VTYP] NVARCHAR(100) NULL,
    [VNO] NVARCHAR(100) NULL,
    [BOOKTYPE] NVARCHAR(100) NULL,
    [NODAY] NVARCHAR(100) NULL,
    [MISSTATUS] NVARCHAR(100) NULL,
    [VDT] NVARCHAR(100) NULL,
    [EDT] NVARCHAR(100) NULL,
    [CDT] NVARCHAR(100) NULL,
    [RELDT] NVARCHAR(100) NULL,
    [DDNO] NVARCHAR(100) NULL,
    [NARRATION] NVARCHAR(1000) NULL,
    [ENTEREDBY] NVARCHAR(100) NULL,
    [CATEGORY] NVARCHAR(100) NULL,
    [RECOSTATUS] NVARCHAR(100) NULL,
    [column19] NVARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014BACKENDRECODT29082022RTGSCANCEL
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014BACKENDRECODT29082022RTGSCANCEL]
(
    [EXCHNAGE] NVARCHAR(150) NULL,
    [CLTCODE] NVARCHAR(150) NULL,
    [VAMT] NVARCHAR(150) NULL,
    [DRCR] NVARCHAR(150) NULL,
    [VTYP] NVARCHAR(150) NULL,
    [VNO] NVARCHAR(150) NULL,
    [BOOKTYPE] NVARCHAR(150) NULL,
    [NODAY] NVARCHAR(150) NULL,
    [MISSTATUS] NVARCHAR(150) NULL,
    [VDT] NVARCHAR(150) NULL,
    [EDT] NVARCHAR(150) NULL,
    [CDT] NVARCHAR(150) NULL,
    [RELDT] NVARCHAR(150) NULL,
    [DDNO] NVARCHAR(150) NULL,
    [NARRATION] NVARCHAR(150) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [CATEGORY] NVARCHAR(50) NULL,
    [RECOSTATUS] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014RECO06042022
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014RECO06042022]
(
    [EXCHNAGE] NVARCHAR(50) NULL,
    [CLTCODE] NVARCHAR(50) NULL,
    [VAMT] NVARCHAR(50) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] NVARCHAR(50) NULL,
    [VNO] NVARCHAR(50) NULL,
    [BOOKTYPE] NVARCHAR(50) NULL,
    [NODAY] NVARCHAR(50) NULL,
    [MISSTATUS] NVARCHAR(50) NULL,
    [VDT] NVARCHAR(50) NULL,
    [EDT] NVARCHAR(50) NULL,
    [CDT] NVARCHAR(50) NULL,
    [RELDT] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [NARRATION] NVARCHAR(1000) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [CATEGORY] NVARCHAR(50) NULL,
    [RECOSTATUS] NVARCHAR(50) NULL,
    [column19] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03014RTGSCANCELDT11042022
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03014RTGSCANCELDT11042022]
(
    [EXCHNAGE] NVARCHAR(150) NULL,
    [CLTCODE] NVARCHAR(150) NULL,
    [VAMT] NVARCHAR(150) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] NVARCHAR(150) NULL,
    [VNO] NVARCHAR(150) NULL,
    [BOOKTYPE] NVARCHAR(150) NULL,
    [NODAY] NVARCHAR(150) NULL,
    [MISSTATUS] NVARCHAR(150) NULL,
    [VDT] NVARCHAR(150) NULL,
    [EDT] NVARCHAR(150) NULL,
    [CDT] NVARCHAR(150) NULL,
    [RELDT] NVARCHAR(150) NULL,
    [DDNO] NVARCHAR(150) NULL,
    [NARRATION] NVARCHAR(150) NULL,
    [ENTEREDBY] NVARCHAR(150) NULL,
    [CATEGORY] NVARCHAR(150) NULL,
    [RECOSTATUS] NVARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03041BACKENDRECODT17092022RTGSCANCEL
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03041BACKENDRECODT17092022RTGSCANCEL]
(
    [EXCHNAGE] NVARCHAR(100) NULL,
    [CLTCODE] NVARCHAR(100) NULL,
    [VAMT] NVARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] NVARCHAR(100) NULL,
    [VNO] NVARCHAR(100) NULL,
    [BOOKTYPE] NVARCHAR(100) NULL,
    [NODAY] NVARCHAR(100) NULL,
    [MISSTATUS] NVARCHAR(100) NULL,
    [VDT] NVARCHAR(100) NULL,
    [EDT] NVARCHAR(100) NULL,
    [CDT] NVARCHAR(100) NULL,
    [RELDT] NVARCHAR(100) NULL,
    [DDNO] NVARCHAR(100) NULL,
    [NARRATION] NVARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [CATEGORY] NVARCHAR(50) NULL,
    [RECOSTATUS] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03041BACKENDRECODT19092022RTGSCANCEL
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03041BACKENDRECODT19092022RTGSCANCEL]
(
    [EXCHNAGE] VARCHAR(1000) NULL,
    [CLTCODE] VARCHAR(1000) NULL,
    [VAMT] VARCHAR(1000) NULL,
    [DRCR] VARCHAR(1000) NULL,
    [VTYP] VARCHAR(1000) NULL,
    [VNO] VARCHAR(1000) NULL,
    [BOOKTYPE] VARCHAR(100) NULL,
    [NODAY] VARCHAR(100) NULL,
    [MISSTATUS] VARCHAR(1000) NULL,
    [VDT] VARCHAR(100) NULL,
    [EDT] VARCHAR(100) NULL,
    [CDT] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [DDNO] VARCHAR(1000) NULL,
    [NARRATION] VARCHAR(1000) NULL,
    [ENTEREDBY] VARCHAR(100) NULL,
    [CATEGORY] VARCHAR(100) NULL,
    [RECOSTATUS] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE03041BACKENDRECODT20092022RTGSCANCEL
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE03041BACKENDRECODT20092022RTGSCANCEL]
(
    [EXCHNAGE] NVARCHAR(50) NULL,
    [CLTCODE] VARCHAR(100) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] VARCHAR(100) NULL,
    [VNO] BIGINT NULL,
    [BOOKTYPE] VARCHAR(100) NULL,
    [NODAY] VARCHAR(100) NULL,
    [MISSTATUS] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [EDT] VARCHAR(100) NULL,
    [CDT] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [DDNO] VARCHAR(100) NULL,
    [NARRATION] VARCHAR(100) NULL,
    [ENTEREDBY] VARCHAR(100) NULL,
    [CATEGORY] VARCHAR(100) NULL,
    [RECOSTATUS] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSESLBS_Sett_MST_FULL_BKUP_23MAR2025
-- --------------------------------------------------
CREATE TABLE [dbo].[NSESLBS_Sett_MST_FULL_BKUP_23MAR2025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Start_Date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [Markettype] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OccupationUpdationTradingAccount
-- --------------------------------------------------
CREATE TABLE [dbo].[OccupationUpdationTradingAccount]
(
    [APPLICATION_NO] NVARCHAR(50) NULL,
    [DPID] BIGINT NULL,
    [ACTIVE_DATE] DATE NULL,
    [PARTY_CODE] NVARCHAR(50) NULL,
    [PANNO] NVARCHAR(50) NULL,
    [OCCUPATION_in_DP] NVARCHAR(50) NULL,
    [OCCUPATION_Trading] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN1410
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN1410]
(
    [File1] VARCHAR(50) NULL,
    [File2] VARCHAR(50) NULL,
    [File3] VARCHAR(50) NULL,
    [File4] VARCHAR(50) NULL,
    [File5] VARCHAR(50) NULL,
    [File6] VARCHAR(50) NULL,
    [File7] VARCHAR(50) NULL,
    [File8] VARCHAR(50) NULL,
    [File9] VARCHAR(50) NULL,
    [File10] VARCHAR(50) NULL,
    [File11] VARCHAR(50) NULL,
    [File12] VARCHAR(50) NULL,
    [File13] VARCHAR(50) NULL,
    [File14] VARCHAR(50) NULL,
    [File15] VARCHAR(50) NULL,
    [File16] VARCHAR(50) NULL,
    [File17] VARCHAR(50) NULL,
    [File18] VARCHAR(50) NULL,
    [File19] VARCHAR(50) NULL,
    [File20] VARCHAR(50) NULL,
    [File21] VARCHAR(50) NULL,
    [File22] VARCHAR(50) NULL,
    [File23] VARCHAR(50) NULL,
    [File24] VARCHAR(50) NULL,
    [File25] VARCHAR(50) NULL,
    [File26] VARCHAR(50) NULL,
    [File27] VARCHAR(50) NULL,
    [File28] VARCHAR(50) NULL,
    [File29] VARCHAR(50) NULL,
    [File30] VARCHAR(50) NULL,
    [File31] VARCHAR(50) NULL,
    [File32] VARCHAR(50) NULL,
    [File33] VARCHAR(50) NULL,
    [File34] VARCHAR(50) NULL,
    [File35] VARCHAR(50) NULL,
    [File36] VARCHAR(50) NULL,
    [File37] VARCHAR(50) NULL,
    [File38] VARCHAR(50) NULL,
    [File39] VARCHAR(50) NULL,
    [File40] VARCHAR(50) NULL,
    [File41] VARCHAR(50) NULL,
    [File42] VARCHAR(50) NULL,
    [File43] VARCHAR(50) NULL,
    [File44] VARCHAR(50) NULL,
    [File45] VARCHAR(50) NULL,
    [File46] VARCHAR(50) NULL,
    [File47] VARCHAR(50) NULL,
    [File48] VARCHAR(50) NULL,
    [File49] VARCHAR(50) NULL,
    [File50] VARCHAR(50) NULL,
    [File51] VARCHAR(50) NULL,
    [File52] VARCHAR(50) NULL,
    [File53] VARCHAR(50) NULL,
    [File54] VARCHAR(50) NULL,
    [File55] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN1410_new
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN1410_new]
(
    [File1] VARCHAR(50) NULL,
    [File2] VARCHAR(50) NULL,
    [File3] VARCHAR(50) NULL,
    [File4] VARCHAR(50) NULL,
    [File5] VARCHAR(50) NULL,
    [File6] VARCHAR(50) NULL,
    [File7] VARCHAR(50) NULL,
    [File8] VARCHAR(50) NULL,
    [File9] VARCHAR(50) NULL,
    [File10] VARCHAR(50) NULL,
    [File11] VARCHAR(50) NULL,
    [File12] VARCHAR(50) NULL,
    [File13] VARCHAR(50) NULL,
    [File14] VARCHAR(50) NULL,
    [File15] VARCHAR(50) NULL,
    [File16] VARCHAR(50) NULL,
    [File17] VARCHAR(50) NULL,
    [File18] VARCHAR(50) NULL,
    [File19] VARCHAR(50) NULL,
    [File20] VARCHAR(50) NULL,
    [File21] VARCHAR(50) NULL,
    [File22] VARCHAR(50) NULL,
    [File23] VARCHAR(50) NULL,
    [File24] VARCHAR(50) NULL,
    [File25] VARCHAR(50) NULL,
    [File26] VARCHAR(50) NULL,
    [File27] VARCHAR(50) NULL,
    [File28] VARCHAR(50) NULL,
    [File29] VARCHAR(50) NULL,
    [File30] VARCHAR(50) NULL,
    [File31] VARCHAR(50) NULL,
    [File32] VARCHAR(50) NULL,
    [File33] VARCHAR(50) NULL,
    [File34] VARCHAR(50) NULL,
    [File35] VARCHAR(50) NULL,
    [File36] VARCHAR(50) NULL,
    [File37] VARCHAR(50) NULL,
    [File38] VARCHAR(50) NULL,
    [File39] VARCHAR(50) NULL,
    [File40] VARCHAR(50) NULL,
    [File41] VARCHAR(50) NULL,
    [File42] VARCHAR(50) NULL,
    [File43] VARCHAR(50) NULL,
    [File44] VARCHAR(50) NULL,
    [File45] VARCHAR(50) NULL,
    [File46] VARCHAR(50) NULL,
    [File47] VARCHAR(50) NULL,
    [File48] VARCHAR(50) NULL,
    [File49] VARCHAR(50) NULL,
    [File50] VARCHAR(50) NULL,
    [File51] VARCHAR(50) NULL,
    [File52] VARCHAR(50) NULL,
    [File53] VARCHAR(50) NULL,
    [File54] VARCHAR(50) NULL,
    [File55] VARCHAR(50) NULL,
    [File_No] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.omny1410
-- --------------------------------------------------
CREATE TABLE [dbo].[omny1410]
(
    [File1] VARCHAR(50) NULL,
    [File2] VARCHAR(50) NULL,
    [File3] VARCHAR(50) NULL,
    [File4] VARCHAR(50) NULL,
    [File5] VARCHAR(50) NULL,
    [File6] VARCHAR(50) NULL,
    [File7] VARCHAR(50) NULL,
    [File8] VARCHAR(50) NULL,
    [File9] VARCHAR(50) NULL,
    [File10] VARCHAR(50) NULL,
    [File11] VARCHAR(50) NULL,
    [File12] VARCHAR(50) NULL,
    [File13] VARCHAR(50) NULL,
    [File14] VARCHAR(50) NULL,
    [File15] VARCHAR(50) NULL,
    [File16] VARCHAR(50) NULL,
    [File17] VARCHAR(50) NULL,
    [File18] VARCHAR(50) NULL,
    [File19] VARCHAR(50) NULL,
    [File20] VARCHAR(50) NULL,
    [File21] VARCHAR(50) NULL,
    [File22] VARCHAR(50) NULL,
    [File23] VARCHAR(50) NULL,
    [File24] VARCHAR(50) NULL,
    [File25] VARCHAR(50) NULL,
    [File26] VARCHAR(50) NULL,
    [File27] VARCHAR(50) NULL,
    [File28] VARCHAR(50) NULL,
    [File29] VARCHAR(50) NULL,
    [File30] VARCHAR(50) NULL,
    [File31] VARCHAR(50) NULL,
    [File32] VARCHAR(50) NULL,
    [File33] VARCHAR(50) NULL,
    [File34] VARCHAR(50) NULL,
    [File35] VARCHAR(50) NULL,
    [File36] VARCHAR(50) NULL,
    [File37] VARCHAR(50) NULL,
    [File38] VARCHAR(50) NULL,
    [File39] VARCHAR(50) NULL,
    [File40] VARCHAR(50) NULL,
    [File41] VARCHAR(50) NULL,
    [File42] VARCHAR(50) NULL,
    [File43] VARCHAR(50) NULL,
    [File44] VARCHAR(50) NULL,
    [File45] VARCHAR(50) NULL,
    [File46] VARCHAR(50) NULL,
    [File47] VARCHAR(50) NULL,
    [File48] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OMNY1410_new
-- --------------------------------------------------
CREATE TABLE [dbo].[OMNY1410_new]
(
    [File1] VARCHAR(50) NULL,
    [File2] VARCHAR(50) NULL,
    [File3] VARCHAR(50) NULL,
    [File4] VARCHAR(50) NULL,
    [File5] VARCHAR(50) NULL,
    [File6] VARCHAR(50) NULL,
    [File7] VARCHAR(50) NULL,
    [File8] VARCHAR(50) NULL,
    [File9] VARCHAR(50) NULL,
    [File10] VARCHAR(50) NULL,
    [File11] VARCHAR(50) NULL,
    [File12] VARCHAR(50) NULL,
    [File13] VARCHAR(50) NULL,
    [File14] VARCHAR(50) NULL,
    [File15] VARCHAR(50) NULL,
    [File16] VARCHAR(50) NULL,
    [File17] VARCHAR(50) NULL,
    [File18] VARCHAR(50) NULL,
    [File19] VARCHAR(50) NULL,
    [File20] VARCHAR(50) NULL,
    [File21] VARCHAR(50) NULL,
    [File22] VARCHAR(50) NULL,
    [File23] VARCHAR(50) NULL,
    [File24] VARCHAR(50) NULL,
    [File25] VARCHAR(50) NULL,
    [File26] VARCHAR(50) NULL,
    [File27] VARCHAR(50) NULL,
    [File28] VARCHAR(50) NULL,
    [File29] VARCHAR(50) NULL,
    [File30] VARCHAR(50) NULL,
    [File31] VARCHAR(50) NULL,
    [File32] VARCHAR(50) NULL,
    [File33] VARCHAR(50) NULL,
    [File34] VARCHAR(50) NULL,
    [File35] VARCHAR(50) NULL,
    [File36] VARCHAR(50) NULL,
    [File37] VARCHAR(50) NULL,
    [File38] VARCHAR(50) NULL,
    [File39] VARCHAR(50) NULL,
    [File40] VARCHAR(50) NULL,
    [File41] VARCHAR(50) NULL,
    [File42] VARCHAR(50) NULL,
    [File43] VARCHAR(50) NULL,
    [File44] VARCHAR(50) NULL,
    [File45] VARCHAR(50) NULL,
    [File46] VARCHAR(50) NULL,
    [File47] VARCHAR(50) NULL,
    [File48] VARCHAR(50) NULL,
    [File_No] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.open_pos
-- --------------------------------------------------
CREATE TABLE [dbo].[open_pos]
(
    [party_code] VARCHAR(10) NULL,
    [PRODUCT_CODE] VARCHAR(7) NULL,
    [Series_code] VARCHAR(22) NULL,
    [Qty] INT NULL,
    [EXPIRYDATE] DATETIME NULL,
    [sddate] DATETIME NULL,
    [Cl_rate] MONEY NULL,
    [Series_id] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.order_jv
-- --------------------------------------------------
CREATE TABLE [dbo].[order_jv]
(
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC]
(
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL,
    [SR_NO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_23oct2025_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_23oct2025_MCX]
(
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_bkp
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_bkp]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_bkp_20220113
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_bkp_20220113]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20220127
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20220127]
(
    [SR_NO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20220128
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20220128]
(
    [SR_NO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_bkp_20220128to0208
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_bkp_20220128to0208]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20220131
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20220131]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20220201
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20220201]
(
    [SR_NO] INT NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20220616
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20220616]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20220617
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20220617]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKP_20230314_DUplicateValue
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKP_20230314_DUplicateValue]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL,
    [RNK] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKUP_24JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKUP_24JAN2024]
(
    [SR_NO] BIGINT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_BKUP_29JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_BKUP_29JAN2024]
(
    [SR_NO] BIGINT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_Staging_9th_to_20thMay
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_Staging_9th_to_20thMay]
(
    [SR_NO] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL,
    [USERID] VARCHAR(20) NULL,
    [ACC_ID] VARCHAR(20) NULL,
    [OrderSource] VARCHAR(30) NULL,
    [Remarks] VARCHAR(100) NULL,
    [OLD_ORDER_TYPE] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORDER_TRANS_JV_CALC_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[ORDER_TRANS_JV_CALC_TEMP]
(
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Otemp
-- --------------------------------------------------
CREATE TABLE [dbo].[Otemp]
(
    [PARTY_CODE] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [PRODUCT_TYPE] VARCHAR(50) NULL,
    [ORDER_NO] VARCHAR(50) NULL,
    [ORDER_TYPE] VARCHAR(50) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_FLAG] VARCHAR(25) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [STATE] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.owner_bkup_16Dec2023
-- --------------------------------------------------
CREATE TABLE [dbo].[owner_bkup_16Dec2023]
(
    [Company] VARCHAR(80) NOT NULL,
    [Addr1] VARCHAR(30) NULL,
    [Addr2] VARCHAR(30) NULL,
    [Phone] VARCHAR(50) NULL,
    [Zip] VARCHAR(6) NULL,
    [city] VARCHAR(20) NULL,
    [MemberCode] VARCHAR(15) NULL,
    [BankName] VARCHAR(50) NULL,
    [BankAdd] VARCHAR(50) NULL,
    [csdlId] VARCHAR(10) NULL,
    [Cdaccno] VARCHAR(10) NULL,
    [DpId] VARCHAR(10) NULL,
    [CltAccNo] VARCHAR(10) NULL,
    [Mainbroker] CHAR(1) NULL,
    [Maxpartylen] TINYINT NULL,
    [Preprintchq] CHAR(1) NULL,
    [Table_No] SMALLINT NULL,
    [Sub_TableNo] SMALLINT NULL,
    [Std_rate] SMALLINT NULL,
    [P_to_P] SMALLINT NULL,
    [demat_tableno] SMALLINT NULL,
    [AlbmCf_tableno] SMALLINT NULL,
    [MF_tableno] SMALLINT NULL,
    [SB_tableno] SMALLINT NULL,
    [brok1_tableno] SMALLINT NULL,
    [brok2_tableno] SMALLINT NULL,
    [brok3_tableno] SMALLINT NULL,
    [Terminal] VARCHAR(10) NULL,
    [tscheme] TINYINT NULL,
    [dispcharge] TINYINT NULL,
    [Brok_Inc_STax] TINYINT NULL,
    [def_scheme] CHAR(1) NULL,
    [brok_scheme] TINYINT NULL,
    [ContCharge] TINYINT NULL,
    [MinContCharge] TINYINT NULL,
    [MarginMultiplier] TINYINT NULL,
    [dummy1] TINYINT NULL,
    [dummy2] TINYINT NULL,
    [Style] INT NULL,
    [ExchangeCode] VARCHAR(3) NULL,
    [BrokerSebiRegNo] VARCHAR(15) NULL,
    [CounterPart] VARCHAR(15) NULL,
    [CP_SebiRegNo] VARCHAR(15) NULL,
    [state] VARCHAR(50) NULL,
    [panno] VARCHAR(50) NULL,
    [AutoGenPartyCode] INT NULL,
    [Fax] VARCHAR(25) NULL,
    [KRA_TYPE] VARCHAR(4) NULL,
    [POS_CODE] VARCHAR(15) NULL,
    [EMAIL] VARCHAR(50) NULL,
    [WEBSITE_ID] VARCHAR(100) NULL,
    [COMPLIANCE_NAME] VARCHAR(50) NULL,
    [COMPLIANCE_EMAIL] VARCHAR(100) NULL,
    [COMPLIANCE_PHONE] VARCHAR(15) NULL,
    [SERVICES_TAXNO] VARCHAR(30) NULL,
    [CIN] VARCHAR(30) NULL,
    [COMMONSEBINO] VARCHAR(300) NULL,
    [COMMONMEMBERCODE] VARCHAR(300) NULL,
    [LOGO_FILE_PATH] VARCHAR(8000) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [SERVICE_DESCRIPTION] VARCHAR(100) NULL,
    [ACCOUNT_SERVICE_NO] VARCHAR(100) NULL,
    [COMMONMEMBERNAME] VARCHAR(250) NULL,
    [SEBI_INV_ADV_NO] VARCHAR(20) NULL,
    [SEBI_RES_ANLY_NO] VARCHAR(20) NULL,
    [BR_CMDPID] VARCHAR(300) NULL,
    [CLEARINGCODE] VARCHAR(10) NULL,
    [IGRIV_EMAIL] VARCHAR(100) NULL,
    [CORP_ADDR1] VARCHAR(50) NULL,
    [CORP_ADDR2] VARCHAR(50) NULL,
    [CORP_ADDR3] VARCHAR(50) NULL,
    [CORP_PHONE] VARCHAR(255) NULL,
    [CORP_ZIP] VARCHAR(50) NULL,
    [CORP_CITY] VARCHAR(50) NULL,
    [CORP_STATE] VARCHAR(50) NULL,
    [CORP_COUNTRY] VARCHAR(20) NULL,
    [GSTNO] VARCHAR(20) NULL,
    [SMTP_SRV_NAME] VARCHAR(100) NULL,
    [EXCHANGE_LISTING_CODE] VARCHAR(100) NULL,
    [DEPOSITORY_LISTING_CODE] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCN_Mismatch_30062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCN_Mismatch_30062025]
(
    [Party_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCN_Mod_30062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCN_Mod_30062025]
(
    [Party_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCN_NotInBO_30062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCN_NotInBO_30062025]
(
    [Party_code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_10062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_10062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_11062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_11062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_12062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_12062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_13062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_13062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_18062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_18062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_19062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_19062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PCNJC_Mod_20062025
-- --------------------------------------------------
CREATE TABLE [dbo].[PCNJC_Mod_20062025]
(
    [SerialNumber] VARCHAR(50) NULL,
    [vdt] VARCHAR(50) NULL,
    [edt] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [DRCR] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Phy_MF_data
-- --------------------------------------------------
CREATE TABLE [dbo].[Phy_MF_data]
(
    [Clientcode] VARCHAR(MAX) NULL,
    [ISIN] VARCHAR(MAX) NULL,
    [Scheme_Code] VARCHAR(MAX) NULL,
    [Foilo_Number] VARCHAR(MAX) NULL,
    [Inv_Value] VARCHAR(MAX) NULL,
    [Curr_value] VARCHAR(MAX) NULL,
    [Scheme_name] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pnl_data_bkp_19112022
-- --------------------------------------------------
CREATE TABLE [dbo].[pnl_data_bkp_19112022]
(
    [SNO] NUMERIC(18, 0) NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [MARGINDATE] DATETIME NOT NULL,
    [TRADETYPE] VARCHAR(2) NOT NULL,
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NOT NULL,
    [BSECODE] VARCHAR(12) NULL,
    [ISIN] VARCHAR(12) NULL,
    [USER_ID] VARCHAR(10) NOT NULL,
    [CONTRACTNO] VARCHAR(7) NOT NULL,
    [ORDER_NO] VARCHAR(16) NOT NULL,
    [TRADE_NO] VARCHAR(20) NOT NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [TRADEQTY] INT NOT NULL,
    [MARKETRATE] NUMERIC(18, 4) NOT NULL,
    [PNLRATE] NUMERIC(18, 4) NOT NULL,
    [MARKETTYPE] VARCHAR(2) NOT NULL,
    [SELL_BUY] INT NOT NULL,
    [INS_CHRG] NUMERIC(18, 4) NOT NULL,
    [TURN_TAX] NUMERIC(18, 4) NOT NULL,
    [OTHER_CHRG] NUMERIC(18, 4) NOT NULL,
    [SEBI_TAX] NUMERIC(18, 4) NOT NULL,
    [BROKER_CHRG] NUMERIC(18, 4) NOT NULL,
    [BILLFLAG] INT NOT NULL,
    [NBROKAPP] NUMERIC(18, 4) NOT NULL,
    [NSERTAX] NUMERIC(18, 4) NOT NULL,
    [N_NETRATE] NUMERIC(18, 4) NOT NULL,
    [OPPDATE] DATETIME NULL,
    [ORGDATE] DATETIME NULL,
    [RECTYPE] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcb_led_trg
-- --------------------------------------------------
CREATE TABLE [dbo].[rcb_led_trg]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL,
    [COMP_NAME] VARCHAR(50) NULL,
    [dbac] DATETIME NULL,
    [dbaction] VARCHAR(6) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_#b2c_cli
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_#b2c_cli]
(
    [branch_Cd] VARCHAR(10) NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [b2c] VARCHAR(1) NULL,
    [ACTIVE_ST] VARCHAR(10) NULL,
    [BRK_PLAN] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_#rcs
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_#rcs]
(
    [branch_Cd] VARCHAR(10) NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [b2c] VARCHAR(1) NULL,
    [ACTIVE_ST] VARCHAR(10) NULL,
    [BRK_PLAN] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_AMC_LED
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_AMC_LED]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_AMC_LED_f
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_AMC_LED_f]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_backend_change_edt
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_backend_change_edt]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NOT NULL,
    [vamt] MONEY NULL,
    [cltcode] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_dp_21jan2026_mtf
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_dp_21jan2026_mtf]
(
    [hld_hold_date] VARCHAR(8) NULL,
    [hld_ac_code] VARCHAR(20) NOT NULL,
    [hld_cat] VARCHAR(1) NOT NULL,
    [hld_isin_code] VARCHAR(20) NULL,
    [hld_ac_type] VARCHAR(1) NOT NULL,
    [FREE_QTY] NUMERIC(18, 5) NULL,
    [FREEZE_QTY] NUMERIC(18, 5) NULL,
    [PLEDGE_QTY] NUMERIC(18, 5) NULL,
    [DEMAT_PND_VER_QTY] NUMERIC(18, 5) NULL,
    [REMAT_PND_CONF_QTY] NUMERIC(18, 5) NULL,
    [DEMAT_PND_CONF_QTY] NUMERIC(18, 5) NULL,
    [SAFE_KEEPING_QTY] NUMERIC(18, 5) NULL,
    [LOCKIN_QTY] NUMERIC(18, 5) NULL,
    [ELIMINATION_QTY] NUMERIC(18, 5) NULL,
    [EARMARK_QTY] NUMERIC(18, 5) NULL,
    [AVAIL_LEND_QTY] NUMERIC(18, 5) NULL,
    [LEND_QTY] NUMERIC(18, 5) NULL,
    [BORROW_QTY] NUMERIC(18, 5) NULL,
    [netqty] NUMERIC(30, 5) NULL,
    [hld_ccid] VARCHAR(1) NOT NULL,
    [hld_market_type] VARCHAR(1) NOT NULL,
    [hld_settlement] VARCHAR(1) NOT NULL,
    [hld_blf] VARCHAR(1) NOT NULL,
    [hld_blc] VARCHAR(1) NOT NULL,
    [hld_lrd] VARCHAR(1) NOT NULL,
    [hld_pendingdt] VARCHAR(1) NOT NULL,
    [SecurityName] VARCHAR(282) NULL,
    [SecurityType] VARCHAR(250) NOT NULL,
    [Rate] NUMERIC(18, 3) NOT NULL,
    [Valuation] NUMERIC(38, 6) NULL,
    [HOLDINGDT] DATETIME NULL,
    [tradingid] VARCHAR(100) NULL,
    [branch] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_dp_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_dp_nse]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(9) NOT NULL,
    [Cltdpid] VARCHAR(20) NOT NULL,
    [Depository] VARCHAR(7) NOT NULL,
    [DefDp] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_ledger_08072024
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_ledger_08072024]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_mtf_pos_3101
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_mtf_pos_3101]
(
    [party_code] VARCHAR(10) NOT NULL,
    [scrip_cd] VARCHAR(12) NULL,
    [isin] VARCHAR(12) NULL,
    [MTF_position] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_sb_speedpro
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_sb_speedpro]
(
    [sub_broker] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RCS_TB
-- --------------------------------------------------
CREATE TABLE [dbo].[RCS_TB]
(
    [CLTCODE] VARCHAR(10) NOT NULL,
    [vamt] MONEY NULL,
    [v_type] VARCHAR(2) NOT NULL,
    [fin_year] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_temp_16012024
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_temp_16012024]
(
    [cltcode] VARCHAR(11) NULL,
    [Scfm_amt] MONEY NULL,
    [Tb_amt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_temp_Scfm_16012024
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_temp_Scfm_16012024]
(
    [cltcode] VARCHAR(100) NULL,
    [balance] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_temp_speedpro
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_temp_speedpro]
(
    [party_code] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rcs_temp_Tb_all_16012024
-- --------------------------------------------------
CREATE TABLE [dbo].[rcs_temp_Tb_all_16012024]
(
    [report_date] VARCHAR(100) NULL,
    [cltcode] VARCHAR(100) NULL,
    [clientname] VARCHAR(100) NULL,
    [panno] VARCHAR(100) NULL,
    [nsecm] VARCHAR(100) NULL,
    [bsecm] VARCHAR(100) NULL,
    [nsefo] VARCHAR(100) NULL,
    [nsecurfo] VARCHAR(100) NULL,
    [mcdxcd] VARCHAR(100) NULL,
    [mcdx] VARCHAR(100) NULL,
    [ncdx] VARCHAR(100) NULL,
    [bsefo] VARCHAR(100) NULL,
    [bsecd] VARCHAR(100) NULL,
    [mtf] VARCHAR(100) NULL,
    [slbm] VARCHAR(100) NULL,
    [total] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Recon_noncms_data_BKUP_05FEB22
-- --------------------------------------------------
CREATE TABLE [dbo].[Recon_noncms_data_BKUP_05FEB22]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [UPLOADID] NVARCHAR(50) NULL,
    [BANKACCOUNT] NVARCHAR(50) NULL,
    [BANKCODE] NVARCHAR(50) NULL,
    [Description] NVARCHAR(150) NULL,
    [LedgerBalance] NVARCHAR(50) NULL,
    [DrCr] NVARCHAR(50) NULL,
    [Amt] DECIMAL(20, 2) NULL,
    [ValueDate] DATETIME NULL,
    [ReferenceNo] NVARCHAR(50) NULL,
    [CLTACCOUNT] NVARCHAR(50) NULL,
    [CustomerReference] NVARCHAR(50) NULL,
    [TransaCtionDetail] NVARCHAR(800) NULL,
    [VNO] NVARCHAR(50) NULL,
    [VTYP] INT NULL,
    [BOOKTYPE] NVARCHAR(50) NULL,
    [MatchedFlag] BIT NULL,
    [UploadStatus] NVARCHAR(50) NULL,
    [UPLOADEDDATE] DATETIME NULL,
    [ModifiedDate] DATETIME NULL,
    [UPLOADBY] NVARCHAR(50) NULL,
    [BOOKDATE] DATETIME NULL,
    [CROSS_NO] BIGINT NULL,
    [MATCHCODE] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.reports_category
-- --------------------------------------------------
CREATE TABLE [dbo].[reports_category]
(
    [FLDCATEGORY] VARCHAR(10) NOT NULL,
    [FLDCATEGORYNAME] VARCHAR(1000) NULL,
    [FLDREPORTNAME] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ROS_CLCODE
-- --------------------------------------------------
CREATE TABLE [dbo].[ROS_CLCODE]
(
    [PARTY_CODE] VARCHAR(20) NULL,
    [ROW] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ROS_CLCODE_2
-- --------------------------------------------------
CREATE TABLE [dbo].[ROS_CLCODE_2]
(
    [ROWNUM] INT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sandeep
-- --------------------------------------------------
CREATE TABLE [dbo].[Sandeep]
(
    [CLTCODE] VARCHAR(10) NOT NULL,
    [vamt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_3042RECO_28_03_2022
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_3042RECO_28_03_2022]
(
    [EXCHNAGE] NVARCHAR(150) NULL,
    [CLTCODE] NVARCHAR(150) NULL,
    [VAMT] NVARCHAR(150) NULL,
    [DRCR] NVARCHAR(150) NULL,
    [VTYP] TINYINT NULL,
    [VNO] NVARCHAR(150) NULL,
    [VDT] DATE NULL,
    [EDT] DATE NULL,
    [CDT] DATETIME2 NULL,
    [RELDT] DATETIME2 NULL,
    [DDNO] INT NULL,
    [NARRATION] NVARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_DEPOSIT_PLEDGE_CLIENTS
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_DEPOSIT_PLEDGE_CLIENTS]
(
    [PARTY_CODE] VARCHAR(11) NULL,
    [ISIN] VARCHAR(20) NULL,
    [QTY] INT NULL,
    [BOID] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_18022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_18022022]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [BANK_CODE] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [NARRATION] NVARCHAR(100) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [VTYP] VARCHAR(100) NULL,
    [Entry_DAte] VARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [RELDT2] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_19022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_19022022]
(
    [CLTCODE] VARCHAR(100) NOT NULL,
    [VDT] VARCHAR(100) NOT NULL,
    [BANK_CODE] VARCHAR(100) NOT NULL,
    [RELDT] VARCHAR(100) NOT NULL,
    [VNO] VARCHAR(100) NOT NULL,
    [NARRATION] NVARCHAR(50) NOT NULL,
    [EXCHANGE] NVARCHAR(50) NOT NULL,
    [VAMT] VARCHAR(100) NOT NULL,
    [DRCR] NVARCHAR(50) NOT NULL,
    [DDNO] NVARCHAR(50) NOT NULL,
    [VTYP] VARCHAR(100) NOT NULL,
    [Entry_DAte] VARCHAR(100) NOT NULL,
    [ENTEREDBY] NVARCHAR(50) NOT NULL,
    [RELDT2] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_20022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_20022022]
(
    [CLTCODE] VARCHAR(100) NOT NULL,
    [VDT] VARCHAR(100) NOT NULL,
    [BANK_CODE] VARCHAR(100) NOT NULL,
    [RELDT] VARCHAR(100) NOT NULL,
    [VNO] VARCHAR(100) NOT NULL,
    [NARRATION] NVARCHAR(50) NOT NULL,
    [EXCHANGE] NVARCHAR(50) NOT NULL,
    [VAMT] VARCHAR(100) NOT NULL,
    [DRCR] NVARCHAR(50) NOT NULL,
    [DDNO] NVARCHAR(50) NOT NULL,
    [VTYP] VARCHAR(100) NOT NULL,
    [Entry_DAte] VARCHAR(100) NOT NULL,
    [ENTEREDBY] NVARCHAR(50) NOT NULL,
    [RELDT2] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_21022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_21022022]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [BANK_CODE] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [NARRATION] VARCHAR(100) NULL,
    [EXCHANGE] VARCHAR(100) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [VTYP] VARCHAR(100) NULL,
    [Entry_DAte] VARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [RELDT2] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_22022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_22022022]
(
    [CLTCODE] NVARCHAR(50) NULL,
    [VDT] DATE NULL,
    [BANK_CODE] SMALLINT NULL,
    [RELDT] DATE NULL,
    [VNO] BIGINT NULL,
    [NARRATION] NVARCHAR(100) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [VAMT] INT NULL,
    [DRCR] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [VTYP] TINYINT NULL,
    [Entry_DAte] DATETIME2 NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [RELDT2] DATE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_23022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_23022022]
(
    [CLTCODE] NVARCHAR(50) NOT NULL,
    [VDT] NVARCHAR(50) NOT NULL,
    [BANK_CODE] NVARCHAR(50) NOT NULL,
    [RELDT] NVARCHAR(50) NOT NULL,
    [VNO] NVARCHAR(50) NOT NULL,
    [NARRATION] NVARCHAR(50) NOT NULL,
    [EXCHANGE] NVARCHAR(50) NOT NULL,
    [VAMT] NVARCHAR(50) NOT NULL,
    [DRCR] NVARCHAR(50) NOT NULL,
    [DDNO] NVARCHAR(50) NOT NULL,
    [VTYP] NVARCHAR(50) NOT NULL,
    [Entry_DAte] NVARCHAR(50) NOT NULL,
    [ENTEREDBY] NVARCHAR(50) NOT NULL,
    [RELDT2] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIBANK_24022022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIBANK_24022022]
(
    [CLTCODE] VARCHAR(150) NULL,
    [VDT] VARCHAR(150) NULL,
    [BANK_CODE] VARCHAR(150) NULL,
    [RELDT] VARCHAR(150) NULL,
    [VNO] VARCHAR(150) NULL,
    [NARRATION] VARCHAR(150) NULL,
    [EXCHANGE] VARCHAR(150) NULL,
    [VAMT] VARCHAR(150) NULL,
    [DRCR] VARCHAR(150) NULL,
    [DDNO] VARCHAR(150) NULL,
    [VTYP] VARCHAR(150) NULL,
    [Entry_DAte] VARCHAR(150) NULL,
    [ENTEREDBY] VARCHAR(150) NULL,
    [RELDT2] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIRECO01032022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIRECO01032022]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [BANK_CODE] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [NARRATION] VARCHAR(100) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [VTYP] VARCHAR(100) NULL,
    [Entry_DAte] VARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [RELDT2] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBIRECO02032022
-- --------------------------------------------------
CREATE TABLE [dbo].[SBIRECO02032022]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] VARCHAR(100) NULL,
    [BANK_CODE] VARCHAR(100) NULL,
    [RELDT] VARCHAR(100) NULL,
    [VNO] VARCHAR(100) NULL,
    [NARRATION] NVARCHAR(50) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [VAMT] VARCHAR(100) NULL,
    [DRCR] NVARCHAR(50) NULL,
    [DDNO] NVARCHAR(50) NULL,
    [VTYP] VARCHAR(100) NULL,
    [Entry_DAte] VARCHAR(100) NULL,
    [ENTEREDBY] NVARCHAR(50) NULL,
    [RELDT2] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBRECO_30_03_2022_vtype2
-- --------------------------------------------------
CREATE TABLE [dbo].[SBRECO_30_03_2022_vtype2]
(
    [EXCHNAGE] NVARCHAR(150) NULL,
    [CLTCODE] NVARCHAR(150) NULL,
    [VAMT] FLOAT NULL,
    [DRCR] NVARCHAR(50) NULL,
    [VTYP] TINYINT NULL,
    [VNO] NVARCHAR(150) NULL,
    [BOOKTYPE] TINYINT NULL,
    [NODAY] TINYINT NULL,
    [MISSTATUS] DATE NULL,
    [VDT] DATE NULL,
    [EDT] DATE NULL,
    [CDT] DATETIME2 NULL,
    [RELDT] DATETIME2 NULL,
    [DDNO] INT NULL,
    [ffg] FLOAT NULL,
    [dddff] TINYINT NULL,
    [NARRATION] NVARCHAR(150) NULL,
    [ENTEREDBY] NVARCHAR(150) NULL,
    [CATEGORY] NVARCHAR(150) NULL,
    [RECOSTATUS] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBRECO_30_03_2022_vtype3
-- --------------------------------------------------
CREATE TABLE [dbo].[SBRECO_30_03_2022_vtype3]
(
    [EXCHNAGE] NVARCHAR(150) NOT NULL,
    [CLTCODE] NVARCHAR(150) NOT NULL,
    [VAMT] FLOAT NOT NULL,
    [DRCR] NVARCHAR(150) NOT NULL,
    [VTYP] TINYINT NOT NULL,
    [VNO] NVARCHAR(150) NOT NULL,
    [BOOKTYPE] TINYINT NOT NULL,
    [NODAY] TINYINT NOT NULL,
    [MISSTATUS] NVARCHAR(150) NOT NULL,
    [VDT] DATE NOT NULL,
    [EDT] DATE NOT NULL,
    [CDT] DATETIME2 NOT NULL,
    [RELDT] DATETIME2 NOT NULL,
    [DDNO] INT NOT NULL,
    [ffg] FLOAT NOT NULL,
    [dddff] TINYINT NOT NULL,
    [NARRATION] NVARCHAR(150) NOT NULL,
    [ENTEREDBY] NVARCHAR(150) NOT NULL,
    [CATEGORY] NVARCHAR(150) NOT NULL,
    [RECOSTATUS] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SCHEME_MASTER_NILESH
-- --------------------------------------------------
CREATE TABLE [dbo].[SCHEME_MASTER_NILESH]
(
    [SCHEME] VARCHAR(100) NULL,
    [B_PLAN] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip1_14AUg2025
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip1_14AUg2025]
(
    [co_code] VARCHAR(6) NOT NULL,
    [series] VARCHAR(3) NOT NULL,
    [short_name] VARCHAR(20) NOT NULL,
    [long_name] VARCHAR(50) NULL,
    [market_lot] INT NULL,
    [face_val] FLOAT NULL,
    [book_cl_dt] DATETIME NULL,
    [ex_div_dt] DATETIME NULL,
    [ex_bon_dt] DATETIME NULL,
    [ex_rit_dt] DATETIME NULL,
    [eqt_type] VARCHAR(3) NULL,
    [sub_type] VARCHAR(3) NULL,
    [agent_cd] VARCHAR(6) NULL,
    [demat_flag] SMALLINT NULL,
    [demat_date] DATETIME NOT NULL,
    [Res1] VARCHAR(10) NULL,
    [Res2] VARCHAR(10) NULL,
    [Res3] VARCHAR(10) NULL,
    [Res4] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip2_14AUg2025
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip2_14AUg2025]
(
    [co_code] VARCHAR(6) NOT NULL,
    [series] VARCHAR(3) NOT NULL,
    [exchange] VARCHAR(3) NOT NULL,
    [scrip_cd] VARCHAR(12) NOT NULL,
    [scrip_cat] VARCHAR(3) NULL,
    [no_del_fr] DATETIME NULL,
    [no_del_to] DATETIME NULL,
    [cl_rate] FLOAT NULL,
    [clos_rate_dt] DATETIME NULL,
    [min_trd_qty] INT NULL,
    [BseCode] VARCHAR(10) NULL,
    [Isin] VARCHAR(20) NULL,
    [delsc_cat] VARCHAR(3) NULL,
    [Sector] VARCHAR(10) NULL,
    [Track] VARCHAR(10) NULL,
    [CDOL_NO] VARCHAR(10) NULL,
    [res1] VARCHAR(10) NULL,
    [res2] VARCHAR(10) NULL,
    [res3] VARCHAR(10) NULL,
    [res4] VARCHAR(10) NULL,
    [GlobalCustodian] VARCHAR(10) NULL,
    [Common_Code] VARCHAR(25) NULL,
    [IndexName] VARCHAR(10) NULL,
    [Industry] VARCHAR(10) NULL,
    [Bloomberg] VARCHAR(10) NULL,
    [RicCode] VARCHAR(10) NULL,
    [Reuters] VARCHAR(10) NULL,
    [IES] VARCHAR(10) NULL,
    [NoofIssuedshares] NUMERIC(18, 4) NULL,
    [Status] VARCHAR(10) NULL,
    [ADRGDRRatio] NUMERIC(18, 4) NULL,
    [GEMultiple] NUMERIC(18, 4) NULL,
    [GroupforGE] INT NULL,
    [RBICeilingIndicatorFlag] VARCHAR(2) NULL,
    [RBICeilingIndicatorValue] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SCRIP2_22AUG
-- --------------------------------------------------
CREATE TABLE [dbo].[SCRIP2_22AUG]
(
    [co_code] VARCHAR(6) NOT NULL,
    [series] VARCHAR(3) NOT NULL,
    [exchange] VARCHAR(3) NOT NULL,
    [scrip_cd] VARCHAR(12) NOT NULL,
    [scrip_cat] VARCHAR(3) NULL,
    [no_del_fr] DATETIME NULL,
    [no_del_to] DATETIME NULL,
    [cl_rate] FLOAT NULL,
    [clos_rate_dt] DATETIME NULL,
    [min_trd_qty] INT NULL,
    [BseCode] VARCHAR(10) NULL,
    [Isin] VARCHAR(20) NULL,
    [delsc_cat] VARCHAR(3) NULL,
    [Sector] VARCHAR(10) NULL,
    [Track] VARCHAR(10) NULL,
    [CDOL_NO] VARCHAR(10) NULL,
    [res1] VARCHAR(10) NULL,
    [res2] VARCHAR(10) NULL,
    [res3] VARCHAR(10) NULL,
    [res4] VARCHAR(10) NULL,
    [GlobalCustodian] VARCHAR(10) NULL,
    [Common_Code] VARCHAR(25) NULL,
    [IndexName] VARCHAR(10) NULL,
    [Industry] VARCHAR(10) NULL,
    [Bloomberg] VARCHAR(10) NULL,
    [RicCode] VARCHAR(10) NULL,
    [Reuters] VARCHAR(10) NULL,
    [IES] VARCHAR(10) NULL,
    [NoofIssuedshares] NUMERIC(18, 4) NULL,
    [Status] VARCHAR(10) NULL,
    [ADRGDRRatio] NUMERIC(18, 4) NULL,
    [GEMultiple] NUMERIC(18, 4) NULL,
    [GroupforGE] INT NULL,
    [RBICeilingIndicatorFlag] VARCHAR(2) NULL,
    [RBICeilingIndicatorValue] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SEBI_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[SEBI_DATA]
(
    [party_code] VARCHAR(11) NULL,
    [cash_turnover] MONEY NULL,
    [cash_brokerage] MONEY NULL,
    [Fotrunover] MONEY NULL,
    [fobrokerage] MONEY NULL,
    [Currency_turnover] MONEY NULL,
    [currency_brokerage] MONEY NULL,
    [comm_turnover] MONEY NULL,
    [comm_brokerage] MONEY NULL,
    [FO_Turnover] MONEY NULL,
    [fo_brokerage] MONEY NULL,
    [fo_lots] MONEY NULL,
    [curopt_Turnover] MONEY NULL,
    [curopt_brokerage] MONEY NULL,
    [curopt_lots] MONEY NULL,
    [commopt_Turnover] MONEY NULL,
    [commopt_brokerage] MONEY NULL,
    [commopt_lots] MONEY NULL,
    [MONTh_year] VARCHAR(10) NULL,
    [FOBRok_type] VARCHAR(20) NULL,
    [CommBRok_type] VARCHAR(20) NULL,
    [CurBRok_type] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SegregationCollateralUpdation
-- --------------------------------------------------
CREATE TABLE [dbo].[SegregationCollateralUpdation]
(
    [PROCESS_DT] NVARCHAR(50) NULL,
    [PARTY_CODE] NVARCHAR(50) NULL,
    [EDT_LEDGER] NUMERIC(18, 3) NULL,
    [CASH_RET_TM] NUMERIC(18, 3) NULL,
    [SEGMENT] NVARCHAR(50) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [column7] NVARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SegregationofCollateralUpdation_20221013
-- --------------------------------------------------
CREATE TABLE [dbo].[SegregationofCollateralUpdation_20221013]
(
    [PROCESS_DT] NVARCHAR(50) NULL,
    [PARTY_CODE] NVARCHAR(50) NULL,
    [EDT_LEDGER] FLOAT NULL,
    [CASH_RET_TM] FLOAT NULL,
    [SEGMENT] NVARCHAR(50) NULL,
    [EXCHANGE] NVARCHAR(50) NULL,
    [column7] NVARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_11NOV2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_11NOV2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_16FEB2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_16FEB2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_19042025_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_19042025_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_19052025_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_19052025_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_19052025nseslbs_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_19052025nseslbs_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Start_Date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [Markettype] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_19072025_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_19072025_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_196_2023185
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_196_2023185]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_197_2023185
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_197_2023185]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_MST_2023086
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_MST_2023086]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_MST_2023088
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_MST_2023088]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_2024096
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_2024096]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_2024300_A
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_2024300_A]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_20DEC2025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_20DEC2025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_20SEP2025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_20SEP2025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_21JUN2025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_21JUN2025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_22022025_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_22022025_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_22042025_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_22042025_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_23032025_FULLBACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_23032025_FULLBACKUP]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_27Jan2026
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_27Jan2026]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_27thAPR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_27thAPR2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETT_MST_BKP_01NOV2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETT_MST_BKP_01NOV2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_BKP_08042023
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_BKP_08042023]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_12APR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_12APR2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETT_MST_BKP_196_05_11_2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETT_MST_BKP_196_05_11_2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_196_09_05_2023
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_196_09_05_2023]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_196_18082023
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_196_18082023]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_196_19_09_2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_196_19_09_2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_196_20_09_2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_196_20_09_2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_197_18082023
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_197_18082023]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_197_19_09_2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_197_19_09_2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp_2025201
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp_2025201]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKP_21FEB2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKP_21FEB2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_BKP_23AUG2024_NEW
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_BKP_23AUG2024_NEW]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETT_MST_BKP_24AUG2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETT_MST_BKP_24AUG2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETT_MST_BKP_26OCT2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETT_MST_BKP_26OCT2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETT_MST_BKP_27JUL2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETT_MST_BKP_27JUL2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp03022026
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp03022026]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp030422025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp030422025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp100922025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp100922025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp14052025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp14052025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp20022025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp20022025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp21022025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp21022025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp21022025_2025037
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp21022025_2025037]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp24102025
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp24102025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkp24102025new
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkp24102025new]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkup_01JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkup_01JAN2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_mst_BKUP_02AUG2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_mst_BKUP_02AUG2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETT_MST_BKUP_18NOV2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETT_MST_BKUP_18NOV2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_bkup_21NOV2023
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_bkup_21NOV2023]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst_bkup_23aug2024
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst_bkup_23aug2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_mst_bkup_25NOV2025
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_mst_bkup_25NOV2025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_BKUP_26JUL2024
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_BKUP_26JUL2024]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_MST_FULL_BKUP_23MAR2025
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_MST_FULL_BKUP_23MAR2025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sett_Mst_sre39736_26082025
-- --------------------------------------------------
CREATE TABLE [dbo].[Sett_Mst_sre39736_26082025]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst2024100
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst2024100]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst2024101
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst2024101]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_18102022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_18102022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_BKP_20220203
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_BKP_20220203]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Settlement_BKUP_03APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[Settlement_BKUP_03APR2023]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Settlement_BKUP_06APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[Settlement_BKUP_06APR2023]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_06NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_06NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_07NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_07NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_09NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_09NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_10APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_10APR2023]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_10NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_10NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_11APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_11APR2023]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_11NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_11NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_14_11_2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_14_11_2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Settlement_BKUP_16MAY2025
-- --------------------------------------------------
CREATE TABLE [dbo].[Settlement_BKUP_16MAY2025]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_16NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_16NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_17APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_17APR2023]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_17APR2023_1
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_17APR2023_1]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_17APR2023_bx
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_17APR2023_bx]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_17APR2023_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_17APR2023_nse]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SETTLEMENT_BKUP_17DEC2024
-- --------------------------------------------------
CREATE TABLE [dbo].[SETTLEMENT_BKUP_17DEC2024]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_17NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_17NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_18NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_18NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_21NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_21NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_22NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_22NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_23NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_23NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_24NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_24NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_24NOV2022_1
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_24NOV2022_1]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_25NOV2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_25NOV2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bkup_31May2022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bkup_31May2022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL,
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_bse_18102022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_bse_18102022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NULL,
    [Trade_no] VARCHAR(12) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NOT NULL,
    [Tradeqty] INT NULL,
    [AuctionPart] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL,
    [Series] VARCHAR(3) NOT NULL,
    [Order_no] VARCHAR(20) NULL,
    [MarketRate] MONEY NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NULL,
    [Normal] MONEY NULL,
    [Day_puc] MONEY NULL,
    [day_sales] MONEY NULL,
    [Sett_purch] MONEY NULL,
    [Sett_sales] MONEY NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NULL,
    [Brokapplied] MONEY NULL,
    [NetRate] NUMERIC(15, 7) NULL,
    [Amount] MONEY NULL,
    [Ins_chrg] MONEY NULL,
    [turn_tax] MONEY NULL,
    [other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Service_tax] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [Billflag] INT NULL,
    [sett_no] VARCHAR(7) NULL,
    [NBrokApp] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL,
    [sett_type] VARCHAR(3) NULL,
    [participantcode] CHAR(15) NULL,
    [status] CHAR(2) NULL,
    [pro_cli] VARCHAR(10) NULL,
    [cpid] VARCHAR(20) NULL,
    [instrument] VARCHAR(2) NULL,
    [bookType] VARCHAR(2) NULL,
    [branch_id] VARCHAR(15) NULL,
    [dummy1] VARCHAR(2) NULL,
    [dummy2] MONEY NULL,
    [tmark] CHAR(2) NULL,
    [Scheme] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement_nse_18102022
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement_nse_18102022]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NOT NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NULL,
    [Tradeqty] INT NOT NULL,
    [AuctionPart] VARCHAR(2) NOT NULL,
    [MarketType] VARCHAR(2) NOT NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NOT NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NOT NULL,
    [Normal] MONEY NOT NULL,
    [Day_puc] MONEY NOT NULL,
    [day_sales] MONEY NOT NULL,
    [Sett_purch] MONEY NOT NULL,
    [Sett_sales] MONEY NOT NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NOT NULL,
    [Brokapplied] MONEY NOT NULL,
    [NetRate] NUMERIC(15, 7) NOT NULL,
    [Amount] MONEY NOT NULL,
    [Ins_chrg] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [other_chrg] MONEY NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [Broker_chrg] MONEY NOT NULL,
    [Service_tax] MONEY NOT NULL,
    [Trade_amount] MONEY NOT NULL,
    [Billflag] INT NOT NULL,
    [sett_no] VARCHAR(7) NOT NULL,
    [NBrokApp] MONEY NOT NULL,
    [NSerTax] MONEY NOT NULL,
    [N_NetRate] NUMERIC(15, 7) NOT NULL,
    [sett_type] VARCHAR(3) NOT NULL,
    [Partipantcode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [Pro_Cli] INT NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] VARCHAR(2) NULL,
    [BookType] VARCHAR(2) NULL,
    [Branch_Id] VARCHAR(10) NULL,
    [TMark] VARCHAR(1) NULL,
    [Scheme] VARCHAR(2) NULL,
    [Dummy1] MONEY NULL,
    [Dummy2] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SQLJOBTEST
-- --------------------------------------------------
CREATE TABLE [dbo].[SQLJOBTEST]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [TIMEDATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.STT_CLIENTDETAIL_BKUP_03APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[STT_CLIENTDETAIL_BKUP_03APR2023]
(
    [RecType] INT NOT NULL,
    [Sett_no] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [ContractNo] VARCHAR(14) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Scrip_Cd] VARCHAR(12) NOT NULL,
    [Series] CHAR(3) NOT NULL,
    [Sauda_Date] DATETIME NOT NULL,
    [Branch_Id] VARCHAR(10) NOT NULL,
    [PDelPrice] MONEY NOT NULL,
    [PQtyDel] INT NOT NULL,
    [PAmtDel] MONEY NOT NULL,
    [PSTTDel] MONEY NOT NULL,
    [SDelPrice] MONEY NOT NULL,
    [SQtyDel] INT NOT NULL,
    [SAmtDel] MONEY NOT NULL,
    [SSTTDel] MONEY NOT NULL,
    [STrdPrice] MONEY NOT NULL,
    [SQtyTrd] INT NOT NULL,
    [SAmtTrd] MONEY NOT NULL,
    [SSTTTrd] MONEY NOT NULL,
    [TotalSTT] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_07Apr2023
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_07Apr2023]
(
    [PARTY_CODE] NVARCHAR(255) NULL,
    [EQBILL] FLOAT NULL,
    [MTFREV] FLOAT NULL,
    [BLOCK_AMT] FLOAT NULL,
    [F5] NVARCHAR(255) NULL,
    [F6] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_196
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_196]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL,
    [i] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_200_curfo
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_200_curfo]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_200_curofo
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_200_curofo]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_200_fo
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_200_fo]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_201
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_201]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_201BSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_201BSEFO]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_204MCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_204MCDX]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_204MCDXCDS
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_204MCDXCDS]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_204NCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_204NCDX]
(
    [a] VARCHAR(500) NULL,
    [b] VARCHAR(500) NULL,
    [c] VARCHAR(500) NULL,
    [d] VARCHAR(500) NULL,
    [e] VARCHAR(500) NULL,
    [f] VARCHAR(500) NULL,
    [g] VARCHAR(500) NULL,
    [h] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_AccountColsedandOCNCButDPmappedBothCode_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_AccountColsedandOCNCButDPmappedBothCode_temp]
(
    [PARTY_CODE] NVARCHAR(50) NULL,
    [CLIENT_NAME] NVARCHAR(500) NULL,
    [DPID] DATETIME2 NULL,
    [CLTDPNO] BIGINT NULL,
    [DPTYPE] NVARCHAR(50) NULL,
    [INACTIVE_DATE] DATE NULL,
    [DEACTIVE_VALUE] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_AGS_Code_Duplicate_DP_id
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_AGS_Code_Duplicate_DP_id]
(
    [Party_code] NVARCHAR(50) NULL,
    [CltDpNo] BIGINT NULL,
    [DpId] NVARCHAR(50) NULL,
    [Introducer] NVARCHAR(50) NULL,
    [DpType] NVARCHAR(50) NULL,
    [Def] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ALL_EPN_DATA_17042023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ALL_EPN_DATA_17042023]
(
    [EPN_DATE] DATETIME NOT NULL,
    [CLTCODE] VARCHAR(8000) NULL,
    [SYMBOL_NSE] VARCHAR(20) NULL,
    [SYMBOL_BSE] VARCHAR(20) NULL,
    [SERIES] VARCHAR(10) NULL,
    [NET_SELL_QTY] INT NULL,
    [SELL_AVG_PRICE] MONEY NULL,
    [TOTAL_HOLDING] MONEY NULL,
    [ISIN] VARCHAR(50) NULL,
    [MIN_QTY] MONEY NULL,
    [EPN_VALUE] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ALL_REPORT_STATUS_05092025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ALL_REPORT_STATUS_05092025]
(
    [SRNO] TINYINT NOT NULL,
    [ALLOCATION_FILES_PROCESS] NVARCHAR(50) NOT NULL,
    [STATUS] NVARCHAR(50) NOT NULL,
    [REPORT_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ALL_REPORT_STATUS_08JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ALL_REPORT_STATUS_08JAN2024]
(
    [SRNO] TINYINT NOT NULL,
    [REPORT_DATE] DATETIME NULL,
    [ALLOCATION_FILES_PROCESS] NVARCHAR(50) NOT NULL,
    [REPORT_STAUS] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ALL_REPORT_STATUS_BKP_13092023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ALL_REPORT_STATUS_BKP_13092023]
(
    [SRNO] TINYINT NOT NULL,
    [ALLOCATION_FILES_PROCESS] NVARCHAR(50) NOT NULL,
    [STATUS] NVARCHAR(50) NOT NULL,
    [REPORT_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AMC_REVERSAL_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AMC_REVERSAL_DATA]
(
    [ACCOUNT_NO] VARCHAR(50) NULL,
    [REVERSAL_AMT] FLOAT NULL,
    [TRADING_CODE] VARCHAR(20) NULL,
    [DPID] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AUTO_PROCESS_DETAIL
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AUTO_PROCESS_DETAIL]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [PROCESS_DATE] DATETIME NOT NULL,
    [BUSINESS_DATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(10) NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SUB_PROCESS_ID] INT NULL,
    [PROCESS_START_DATE] DATETIME NOT NULL,
    [PROCESS_STARTED_DATE] DATETIME NOT NULL,
    [PROCESS_END_DATE] DATETIME NOT NULL,
    [PROCESS_ENDED_DATE] DATETIME NOT NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [IS_DEPEND_ON_ORG] VARCHAR(200) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS] INT NOT NULL,
    [PROCESS_HALTED_AT] INT NOT NULL,
    [PROCESS_HALTED_REASON] VARCHAR(200) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_COUNT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [PROCESS_LAST_ALERT_DATE] DATETIME NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [ATTACHEMENT_FILE_NAME] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AUTO_PROCESS_DETAIL_27Sep2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AUTO_PROCESS_DETAIL_27Sep2023]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [PROCESS_DATE] DATETIME NOT NULL,
    [BUSINESS_DATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(10) NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SUB_PROCESS_ID] INT NULL,
    [PROCESS_START_DATE] DATETIME NOT NULL,
    [PROCESS_STARTED_DATE] DATETIME NOT NULL,
    [PROCESS_END_DATE] DATETIME NOT NULL,
    [PROCESS_ENDED_DATE] DATETIME NOT NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [IS_DEPEND_ON_ORG] VARCHAR(200) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS] INT NOT NULL,
    [PROCESS_HALTED_AT] INT NOT NULL,
    [PROCESS_HALTED_REASON] VARCHAR(200) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_COUNT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [PROCESS_LAST_ALERT_DATE] DATETIME NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [ATTACHEMENT_FILE_NAME] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AUTO_PROCESS_DETAIL_BKUP_02Mar2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AUTO_PROCESS_DETAIL_BKUP_02Mar2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [PROCESS_DATE] DATETIME NOT NULL,
    [BUSINESS_DATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(10) NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SUB_PROCESS_ID] INT NULL,
    [PROCESS_START_DATE] DATETIME NOT NULL,
    [PROCESS_STARTED_DATE] DATETIME NOT NULL,
    [PROCESS_END_DATE] DATETIME NOT NULL,
    [PROCESS_ENDED_DATE] DATETIME NOT NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [IS_DEPEND_ON_ORG] VARCHAR(200) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS] INT NOT NULL,
    [PROCESS_HALTED_AT] INT NOT NULL,
    [PROCESS_HALTED_REASON] VARCHAR(200) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_COUNT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [PROCESS_LAST_ALERT_DATE] DATETIME NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [ATTACHEMENT_FILE_NAME] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AUTO_PROCESS_MASTER_bak_20230927
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AUTO_PROCESS_MASTER_bak_20230927]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(20) NULL,
    [IS_FILE_BASED] VARCHAR(1) NULL,
    [PROCESS_FREQ] VARCHAR(10) NULL,
    [PROCESS_START_TIME] VARCHAR(10) NULL,
    [PROCESS_END_TIME] VARCHAR(10) NULL,
    [PROCESS_REPEAT_INTERVAL] VARCHAR(10) NULL,
    [FILE_DWLOAD_LOCATION] VARBINARY(8000) NULL,
    [FILE_DWLOAD_NAME] VARBINARY(8000) NULL,
    [FILE_DWLOAD_USERID] VARBINARY(8000) NULL,
    [FILE_DWLOAD_PWD] VARBINARY(8000) NULL,
    [FILE_DWLOAD_MAP_DRIVE] VARCHAR(100) NULL,
    [PROCESS_FILE_PATH] VARBINARY(8000) NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [PROCESS_FILE_MOVE_PATH] VARBINARY(8000) NULL,
    [PROCESS_SP_NAME] VARBINARY(8000) NULL,
    [PROCESS_CHECK_QUERY] VARBINARY(8000) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [FILE_INTERNET_LOCATION] VARCHAR(500) NULL,
    [FILE_INTERNAL_ISS_PATH] VARCHAR(500) NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [IS_ATTACHEMENT] INT NULL,
    [OTHER_DBDETAILS] VARCHAR(200) NULL,
    [OTHER_PROCESS_FOR] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AUTO_PROCESS_MASTER_BKP_23SEP2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AUTO_PROCESS_MASTER_BKP_23SEP2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(20) NULL,
    [IS_FILE_BASED] VARCHAR(1) NULL,
    [PROCESS_FREQ] VARCHAR(10) NULL,
    [PROCESS_START_TIME] VARCHAR(10) NULL,
    [PROCESS_END_TIME] VARCHAR(10) NULL,
    [PROCESS_REPEAT_INTERVAL] VARCHAR(10) NULL,
    [FILE_DWLOAD_LOCATION] VARBINARY(8000) NULL,
    [FILE_DWLOAD_NAME] VARBINARY(8000) NULL,
    [FILE_DWLOAD_USERID] VARBINARY(8000) NULL,
    [FILE_DWLOAD_PWD] VARBINARY(8000) NULL,
    [FILE_DWLOAD_MAP_DRIVE] VARCHAR(100) NULL,
    [PROCESS_FILE_PATH] VARBINARY(8000) NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [PROCESS_FILE_MOVE_PATH] VARBINARY(8000) NULL,
    [PROCESS_SP_NAME] VARBINARY(8000) NULL,
    [PROCESS_CHECK_QUERY] VARBINARY(8000) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [FILE_INTERNET_LOCATION] VARCHAR(500) NULL,
    [FILE_INTERNAL_ISS_PATH] VARCHAR(500) NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [IS_ATTACHEMENT] INT NULL,
    [OTHER_DBDETAILS] VARCHAR(200) NULL,
    [OTHER_PROCESS_FOR] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_AUTO_PROCESS_MASTER_BKP_28SEP2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_AUTO_PROCESS_MASTER_BKP_28SEP2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(20) NULL,
    [IS_FILE_BASED] VARCHAR(1) NULL,
    [PROCESS_FREQ] VARCHAR(10) NULL,
    [PROCESS_START_TIME] VARCHAR(10) NULL,
    [PROCESS_END_TIME] VARCHAR(10) NULL,
    [PROCESS_REPEAT_INTERVAL] VARCHAR(10) NULL,
    [FILE_DWLOAD_LOCATION] VARBINARY(8000) NULL,
    [FILE_DWLOAD_NAME] VARBINARY(8000) NULL,
    [FILE_DWLOAD_USERID] VARBINARY(8000) NULL,
    [FILE_DWLOAD_PWD] VARBINARY(8000) NULL,
    [FILE_DWLOAD_MAP_DRIVE] VARCHAR(100) NULL,
    [PROCESS_FILE_PATH] VARBINARY(8000) NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [PROCESS_FILE_MOVE_PATH] VARBINARY(8000) NULL,
    [PROCESS_SP_NAME] VARBINARY(8000) NULL,
    [PROCESS_CHECK_QUERY] VARBINARY(8000) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [FILE_INTERNET_LOCATION] VARCHAR(500) NULL,
    [FILE_INTERNAL_ISS_PATH] VARCHAR(500) NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [IS_ATTACHEMENT] INT NULL,
    [OTHER_DBDETAILS] VARCHAR(200) NULL,
    [OTHER_PROCESS_FOR] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_auto_process_master_BKUP_19May2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_auto_process_master_BKUP_19May2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(20) NULL,
    [IS_FILE_BASED] VARCHAR(1) NULL,
    [PROCESS_FREQ] VARCHAR(10) NULL,
    [PROCESS_START_TIME] VARCHAR(10) NULL,
    [PROCESS_END_TIME] VARCHAR(10) NULL,
    [PROCESS_REPEAT_INTERVAL] VARCHAR(10) NULL,
    [FILE_DWLOAD_LOCATION] VARBINARY(8000) NULL,
    [FILE_DWLOAD_NAME] VARBINARY(8000) NULL,
    [FILE_DWLOAD_USERID] VARBINARY(8000) NULL,
    [FILE_DWLOAD_PWD] VARBINARY(8000) NULL,
    [FILE_DWLOAD_MAP_DRIVE] VARCHAR(100) NULL,
    [PROCESS_FILE_PATH] VARBINARY(8000) NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [PROCESS_FILE_MOVE_PATH] VARBINARY(8000) NULL,
    [PROCESS_SP_NAME] VARBINARY(8000) NULL,
    [PROCESS_CHECK_QUERY] VARBINARY(8000) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [FILE_INTERNET_LOCATION] VARCHAR(500) NULL,
    [FILE_INTERNAL_ISS_PATH] VARCHAR(500) NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [IS_ATTACHEMENT] INT NULL,
    [OTHER_DBDETAILS] VARCHAR(200) NULL,
    [OTHER_PROCESS_FOR] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_auto_process_master_BKUP_25JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_auto_process_master_BKUP_25JAN2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(20) NULL,
    [IS_FILE_BASED] VARCHAR(1) NULL,
    [PROCESS_FREQ] VARCHAR(10) NULL,
    [PROCESS_START_TIME] VARCHAR(10) NULL,
    [PROCESS_END_TIME] VARCHAR(10) NULL,
    [PROCESS_REPEAT_INTERVAL] VARCHAR(10) NULL,
    [FILE_DWLOAD_LOCATION] VARBINARY(8000) NULL,
    [FILE_DWLOAD_NAME] VARBINARY(8000) NULL,
    [FILE_DWLOAD_USERID] VARBINARY(8000) NULL,
    [FILE_DWLOAD_PWD] VARBINARY(8000) NULL,
    [FILE_DWLOAD_MAP_DRIVE] VARCHAR(100) NULL,
    [PROCESS_FILE_PATH] VARBINARY(8000) NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [PROCESS_FILE_MOVE_PATH] VARBINARY(8000) NULL,
    [PROCESS_SP_NAME] VARBINARY(8000) NULL,
    [PROCESS_CHECK_QUERY] VARBINARY(8000) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [FILE_INTERNET_LOCATION] VARCHAR(500) NULL,
    [FILE_INTERNAL_ISS_PATH] VARCHAR(500) NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [IS_ATTACHEMENT] INT NULL,
    [OTHER_DBDETAILS] VARCHAR(200) NULL,
    [OTHER_PROCESS_FOR] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_auto_process_master_BKUP_MSAJAG_21DEC2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_auto_process_master_BKUP_MSAJAG_21DEC2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [PROCESS_TYPE] VARCHAR(30) NULL,
    [PROCESS_FOR] VARCHAR(30) NULL,
    [PROCESS_ID] INT NULL,
    [INTERNAL_PROCESS_ID] INT NULL,
    [SETT_NO] VARCHAR(20) NULL,
    [SETT_TYPE] VARCHAR(20) NULL,
    [IS_FILE_BASED] VARCHAR(1) NULL,
    [PROCESS_FREQ] VARCHAR(10) NULL,
    [PROCESS_START_TIME] VARCHAR(10) NULL,
    [PROCESS_END_TIME] VARCHAR(10) NULL,
    [PROCESS_REPEAT_INTERVAL] VARCHAR(10) NULL,
    [FILE_DWLOAD_LOCATION] VARBINARY(8000) NULL,
    [FILE_DWLOAD_NAME] VARBINARY(8000) NULL,
    [FILE_DWLOAD_USERID] VARBINARY(8000) NULL,
    [FILE_DWLOAD_PWD] VARBINARY(8000) NULL,
    [FILE_DWLOAD_MAP_DRIVE] VARCHAR(100) NULL,
    [PROCESS_FILE_PATH] VARBINARY(8000) NULL,
    [PROCESS_FILE_NAME] VARBINARY(8000) NULL,
    [PROCESS_FILE_MOVE_PATH] VARBINARY(8000) NULL,
    [PROCESS_SP_NAME] VARBINARY(8000) NULL,
    [PROCESS_CHECK_QUERY] VARBINARY(8000) NULL,
    [IS_DEPEND_ON] VARCHAR(200) NULL,
    [WAIT_PERIOD] VARCHAR(10) NULL,
    [APPROX_END_TIME] VARCHAR(10) NULL,
    [PROCESS_STATUS_ALERT] INT NULL,
    [PROCESS_STATUS_ALERT_INTERVAL] VARCHAR(10) NULL,
    [FILE_INTERNET_LOCATION] VARCHAR(500) NULL,
    [FILE_INTERNAL_ISS_PATH] VARCHAR(500) NULL,
    [PROCESS_OUTPUT_QUERY] VARCHAR(MAX) NULL,
    [IS_ATTACHEMENT] INT NULL,
    [OTHER_DBDETAILS] VARCHAR(200) NULL,
    [OTHER_PROCESS_FOR] VARCHAR(200) NULL,
    [PROCESS_ORDER_ID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_BANK_RECO_REPORT_ANG_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_BANK_RECO_REPORT_ANG_DATA]
(
    [SRNO] VARCHAR(10) NULL,
    [BANK NAME] VARCHAR(255) NULL,
    [DETAILS] VARCHAR(255) NULL,
    [BANKCODE] VARCHAR(255) NULL,
    [TYPE OF ACCOUNT] VARCHAR(255) NULL,
    [SEGMENT] VARCHAR(255) NULL,
    [NAME] VARCHAR(255) NULL,
    [BANK STATEMENT BALANCE] VARCHAR(255) NULL,
    [BANK BOOK BALANCE] VARCHAR(255) NULL,
    [CHQ. DEPOSITED BUT NOT CREDITED] VARCHAR(255) NULL,
    [CHQ. ISSUED BUT NOT DEBITED] VARCHAR(255) NULL,
    [DIFF] VARCHAR(255) NULL,
    [TALLY/ UNTALLY] VARCHAR(255) NULL,
    [REMARKS] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_BANK_RECO_REPORT_ANG_RPT_AUTO
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_BANK_RECO_REPORT_ANG_RPT_AUTO]
(
    [SRNO] VARCHAR(10) NULL,
    [BANK NAME] VARCHAR(100) NULL,
    [Details] VARCHAR(100) NULL,
    [BANKCODE] VARCHAR(100) NULL,
    [TYPE OF ACCOUNT] VARCHAR(100) NULL,
    [SEGMENT] VARCHAR(100) NULL,
    [NAME] VARCHAR(100) NULL,
    [BANK STATEMENT BALANCE] VARCHAR(100) NULL,
    [BANK BOOK BALANCE] VARCHAR(100) NULL,
    [CHQ. DEPOSITED BUT NOT CREDITED] VARCHAR(100) NULL,
    [CHQ. ISSUED BUT NOT DEBITED] VARCHAR(100) NULL,
    [DIFF] VARCHAR(100) NULL,
    [TALLY/ UNTALLY] VARCHAR(100) NULL,
    [REMARKS] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CALLING_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CALLING_DATA]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [EMAIL] VARCHAR(50) NULL,
    [LONG_NAME] VARCHAR(100) NULL,
    [MOBILE_PAGER] VARCHAR(40) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [B2B_B2C] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CAPITAL_MIS_EOD
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CAPITAL_MIS_EOD]
(
    [MDATE] VARCHAR(11) NULL,
    [PARTY_CODE] VARCHAR(30) NULL,
    [MAX_MARGIN] VARCHAR(30) NULL,
    [EPIAMOUNT] VARCHAR(30) NULL,
    [MAX_VDT] VARCHAR(30) NULL,
    [MAX_EDT] VARCHAR(30) NULL,
    [SUM OF HC MISMATCH] VARCHAR(30) NULL,
    [Sum of Excess Qty2] VARCHAR(30) NULL,
    [Max of Diff-VDT-EDT] VARCHAR(30) NULL,
    [Sum of RepledgeValue] VARCHAR(30) NULL,
    [Sum of StockINHand Value] VARCHAR(30) NULL,
    [Margin/2] VARCHAR(30) NULL,
    [Cash Shortfall] VARCHAR(30) NULL,
    [Non-cash shortfall] VARCHAR(30) NULL,
    [Cash Shortfall for 50:50] VARCHAR(30) NULL,
    [Sum of HC Mismatch-used] VARCHAR(30) NULL,
    [Sum of Excess Qty21] VARCHAR(30) NULL,
    [EPN] VARCHAR(30) NULL,
    [Sum of StockINHand Value1] VARCHAR(30) NULL,
    [Cash Shortfall for 50:501] VARCHAR(30) NULL,
    [Funds] VARCHAR(30) NULL,
    [PLEDGEFULLVAL1] VARCHAR(30) NULL,
    [REPLEDGEFULLVAL1] VARCHAR(30) NULL,
    [TOTALVALUE_CC] VARCHAR(30) NULL,
    [EXCESSTOTALVALUE_CC] VARCHAR(30) NULL,
    [FUNDS / MAX_MARGIN %] VARCHAR(30) NULL,
    [90 %] VARCHAR(30) NULL,
    [DIFF %] VARCHAR(30) NULL,
    [DIFF AMT] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CAPITAL_MIS_PEAK
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CAPITAL_MIS_PEAK]
(
    [MDATE] VARCHAR(11) NULL,
    [PARTY_CODE] VARCHAR(30) NULL,
    [MAX_MARGIN] VARCHAR(30) NULL,
    [EPIAMOUNT] VARCHAR(30) NULL,
    [MAX_VDT] VARCHAR(30) NULL,
    [MAX_EDT] VARCHAR(30) NULL,
    [SUM OF HC MISMATCH] VARCHAR(30) NULL,
    [SUM OF EXCESS QTY2] VARCHAR(30) NULL,
    [MAX OF DIFF-VDT-EDT] VARCHAR(30) NULL,
    [SUM OF REPLEDGEVALUE] VARCHAR(30) NULL,
    [SUM OF STOCKINHAND VALUE] VARCHAR(30) NULL,
    [MARGIN/2] VARCHAR(30) NULL,
    [CASH SHORTFALL] VARCHAR(30) NULL,
    [NON-CASH SHORTFALL] VARCHAR(30) NULL,
    [CASH SHORTFALL FOR 50:50] VARCHAR(30) NULL,
    [SUM OF HC MISMATCH-USED] VARCHAR(30) NULL,
    [SUM OF EXCESS QTY21] VARCHAR(30) NULL,
    [EPN] VARCHAR(30) NULL,
    [SUM OF STOCKINHAND VALUE1] VARCHAR(30) NULL,
    [CASH SHORTFALL FOR 50:501] VARCHAR(30) NULL,
    [FUNDS] VARCHAR(30) NULL,
    [PLEDGEFULLVAL1] VARCHAR(30) NULL,
    [REPLEDGEFULLVAL1] VARCHAR(30) NULL,
    [TOTALVALUE_CC] VARCHAR(30) NULL,
    [EXCESSTOTALVALUE_CC] VARCHAR(30) NULL,
    [FUNDS / MAX_MARGIN %] VARCHAR(30) NULL,
    [90 %] VARCHAR(30) NULL,
    [DIFF %] VARCHAR(30) NULL,
    [DIFF AMT] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CL_DETAILS_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CL_DETAILS_DATA]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [B2B_B2C] VARCHAR(3) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [LONG_NAME] VARCHAR(100) NULL,
    [ADDRESS1] VARCHAR(8000) NULL,
    [ADDRESS2] VARCHAR(8000) NULL,
    [ADDRESS3] VARCHAR(8000) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [CL_TYPE] VARCHAR(3) NOT NULL,
    [CL_STATUS] VARCHAR(3) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [PAN_GIR_NO] VARCHAR(1) NOT NULL,
    [MOBILE_PAGER] VARCHAR(1) NOT NULL,
    [EMAIL] VARCHAR(1) NOT NULL,
    [DOB] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLCODE
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLCODE]
(
    [CODE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_COLL_ALLOCATE
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_COLL_ALLOCATE]
(
    [PROCESS_DT] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLEARING_PAN] VARCHAR(10) NULL,
    [TRADING_PAN] VARCHAR(10) NULL,
    [CP_CODE] VARCHAR(12) NULL,
    [CP_PAN] VARCHAR(10) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] CHAR(1) NULL,
    [SEGMENT_INDICATOR] VARCHAR(3) NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [CLIENTCOLL_ORG] NUMERIC(18, 2) NULL,
    [CLIENTCOLLCASH] NUMERIC(18, 2) NULL,
    [CLIENTCOLLNONCASH] NUMERIC(18, 2) NULL,
    [REPLD_NONCASH] NUMERIC(18, 2) NULL,
    [REPLD_NONCASHEQ] NUMERIC(18, 2) NULL,
    [MARGIN] NUMERIC(18, 3) NULL,
    [MARGIN_SHORT_EXCESS] NUMERIC(18, 2) NULL,
    [PEAK_MARGIN] NUMERIC(18, 3) NULL,
    [UPFRONT_MARGIN] NUMERIC(18, 3) NULL,
    [ALLOCATECASH] NUMERIC(18, 2) NULL,
    [ALLOCATENONCASH] NUMERIC(18, 2) NULL,
    [BALANCECASH] NUMERIC(18, 2) NULL,
    [BALANCENONCASH] NUMERIC(18, 2) NULL,
    [PROCASH] NUMERIC(18, 2) NULL,
    [CC_CM_CASH] NUMERIC(18, 2) NULL,
    [TOTALMARGIN] NUMERIC(18, 2) NULL,
    [MARGINRATIO] NUMERIC(18, 2) NULL,
    [EXCESSCOLL] NUMERIC(18, 2) NULL,
    [RUNDATE] DATETIME NOT NULL,
    [BLOCKFUND] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_COLL_FILE_BKP_20221228
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_COLL_FILE_BKP_20221228]
(
    [UPD_FILENAME] VARCHAR(100) NULL,
    [FILEDATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [SEGMENT_INDICATOR] VARCHAR(5) NULL,
    [CM_CODE] VARCHAR(20) NULL,
    [TM_CODE] VARCHAR(20) NULL,
    [CP_CODE] VARCHAR(20) NULL,
    [CLI_CODE] VARCHAR(20) NULL,
    [ACCOUNT_TYPE] VARCHAR(5) NULL,
    [AMOUNT] NUMERIC(18, 2) NULL,
    [FILLER1] VARCHAR(7) NULL,
    [FILLER2] VARCHAR(7) NULL,
    [FILLER3] VARCHAR(7) NULL,
    [FILLER4] VARCHAR(7) NULL,
    [FILLER5] VARCHAR(7) NULL,
    [FILLER6] VARCHAR(7) NULL,
    [ACTION_TYPE] VARCHAR(7) NULL,
    [BATCHNO] VARCHAR(7) NULL,
    [SOURCE_FROM] VARCHAR(7) NULL,
    [UPLOAD_BY] VARCHAR(50) NULL,
    [UPLOAD_ON] DATETIME NULL,
    [BATCH_STATUS] VARCHAR(7) NULL,
    [RESPONSE_CODE] VARCHAR(500) NULL,
    [RESPONSE_BY] VARCHAR(100) NULL,
    [RESPONSE_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_COLL_RECO_03082025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_COLL_RECO_03082025]
(
    [TRANSDATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [CMCODE] VARCHAR(10) NULL,
    [TMCODE] VARCHAR(10) NULL,
    [CLIENTCODE] VARCHAR(20) NULL,
    [AMOUNT] NUMERIC(18, 4) NULL,
    [RECO_FILENAME] VARCHAR(500) NULL,
    [UPLOAD_ON] DATETIME NULL,
    [UPLOAD_BY] VARCHAR(50) NULL,
    [Total_Collateral_EOD] NUMERIC(18, 4) NULL,
    [Eligible_Collateral_EOD] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_COLL_RECO_03082025all
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_COLL_RECO_03082025all]
(
    [TRANSDATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [CMCODE] VARCHAR(10) NULL,
    [TMCODE] VARCHAR(10) NULL,
    [CLIENTCODE] VARCHAR(20) NULL,
    [AMOUNT] NUMERIC(18, 4) NULL,
    [RECO_FILENAME] VARCHAR(500) NULL,
    [UPLOAD_ON] DATETIME NULL,
    [UPLOAD_BY] VARCHAR(50) NULL,
    [Total_Collateral_EOD] NUMERIC(18, 4) NULL,
    [Eligible_Collateral_EOD] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_COLL_RECO_03082025all1
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_COLL_RECO_03082025all1]
(
    [TRANSDATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(7) NULL,
    [CMCODE] VARCHAR(10) NULL,
    [TMCODE] VARCHAR(10) NULL,
    [CLIENTCODE] VARCHAR(20) NULL,
    [AMOUNT] NUMERIC(18, 4) NULL,
    [RECO_FILENAME] VARCHAR(500) NULL,
    [UPLOAD_ON] DATETIME NULL,
    [UPLOAD_BY] VARCHAR(50) NULL,
    [Total_Collateral_EOD] NUMERIC(18, 4) NULL,
    [Eligible_Collateral_EOD] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_GST_DATA_BKP_20221126
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_GST_DATA_BKP_20221126]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NOT NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [LONG_NAME] VARCHAR(250) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_STATE] VARCHAR(100) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [L_NATION] VARCHAR(15) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [EFF_FROM_DATE] DATETIME NOT NULL,
    [EFF_TO_DATE] DATETIME NOT NULL,
    [CREATED_ON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CLIENT_GST_DATA_BKP_20221126_NSESLBS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CLIENT_GST_DATA_BKP_20221126_NSESLBS]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NOT NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [LONG_NAME] VARCHAR(250) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_STATE] VARCHAR(100) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [L_NATION] VARCHAR(15) NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [EFF_FROM_DATE] DATETIME NOT NULL,
    [EFF_TO_DATE] DATETIME NOT NULL,
    [CREATED_ON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CMMARGIN_INTRADAY_BKP_02_JUL_2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CMMARGIN_INTRADAY_BKP_02_JUL_2024]
(
    [FILECOUNTER] INT NOT NULL,
    [MARGINDATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [VARMARGIN] NUMERIC(18, 4) NULL,
    [MINIMUM_MARGIN] NUMERIC(18, 4) NULL,
    [ADDITIONAL_MARGIN] NUMERIC(18, 4) NULL,
    [MTOM_LOSS] NUMERIC(18, 4) NULL,
    [TOTAL_MARGIN_VAR] NUMERIC(18, 4) NULL,
    [TOTAL_MARGIN] NUMERIC(18, 4) NULL,
    [CL_FLAG] VARCHAR(1) NULL,
    [UPLOAD_ON] DATETIME NULL,
    [UPLOAD_BY] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CNT_Omnesys_File_PATH_APR082024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CNT_Omnesys_File_PATH_APR082024]
(
    [Id] INT NOT NULL,
    [FilePath] VARCHAR(200) NULL,
    [FIleName] VARCHAR(50) NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_CASH] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_CASH] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_CASH] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_BKUP_FEB10
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_BKUP_FEB10]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_CASH] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_CASH] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_CASH] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_DETAIL_BKUP_FEB10
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_DETAIL_BKUP_FEB10]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T_MARGINAVL] NUMERIC(18, 4) NULL,
    [T_MTMAVL] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_DETAIL_BKUP_FEB10_revised
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_DETAIL_BKUP_FEB10_revised]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T_MARGINAVL] NUMERIC(18, 4) NULL,
    [T_MTMAVL] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_DETAIL_INHOUSE_test
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_DETAIL_INHOUSE_test]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T_MARGINAVL] NUMERIC(18, 4) NULL,
    [T_MTMAVL] NUMERIC(18, 4) NULL,
    [OLDMARGIN] NUMERIC(18, 2) NULL,
    [NEWSHRT] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_DETAIL_test
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_DETAIL_test]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T_MARGINAVL] NUMERIC(18, 4) NULL,
    [T_MTMAVL] NUMERIC(18, 4) NULL,
    [OLDMARGIN] NUMERIC(18, 2) NULL,
    [NEWSHRT] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_FEB10_revised
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_FEB10_revised]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_CASH] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_CASH] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_CASH] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_PEAK_test
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_PEAK_test]
(
    [MARGINDATE] DATETIME NOT NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [TDAY_LEDGER] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN] NUMERIC(18, 4) NULL,
    [TDAY_MTM] NUMERIC(18, 4) NULL,
    [TDAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [TDAY_FDBG] NUMERIC(18, 4) NULL,
    [TDAY_CASH] NUMERIC(18, 4) NULL,
    [TDAY_NONCASH] NUMERIC(18, 4) NULL,
    [TDAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [TDAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T1DAY_MTM] NUMERIC(18, 4) NULL,
    [T1DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T1DAY_FDBG] NUMERIC(18, 4) NULL,
    [T1DAY_CASH] NUMERIC(18, 4) NULL,
    [T1DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T1DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T1DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_LEDGER] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN] NUMERIC(18, 4) NULL,
    [T2DAY_MTM] NUMERIC(18, 4) NULL,
    [T2DAY_CASHCOLL] NUMERIC(18, 4) NULL,
    [T2DAY_FDBG] NUMERIC(18, 4) NULL,
    [T2DAY_CASH] NUMERIC(18, 4) NULL,
    [T2DAY_NONCASH] NUMERIC(18, 4) NULL,
    [T2DAY_MARGIN_SHORT] NUMERIC(18, 4) NULL,
    [T2DAY_MTM_SHORT] NUMERIC(18, 4) NULL,
    [OLDMARGIN] NUMERIC(18, 2) NULL,
    [NEWSHRT] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CTCL_Terminal Data_2_Mar_22_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CTCL_Terminal Data_2_Mar_22_temp]
(
    [OdinId] NVARCHAR(50) NULL,
    [Final_SB_Tag] NVARCHAR(50) NULL,
    [Type] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CUSPA_RELEASE_PROCESS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CUSPA_RELEASE_PROCESS]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [LEDGER_BAL] MONEY NULL,
    [SHORTAGE_VAL] MONEY NULL,
    [ACCURVAL_BAL] MONEY NULL,
    [UNCLEAR_BAL] MONEY NULL,
    [CTD_VAL] MONEY NULL,
    [MARGIN_PLEDGE] MONEY NULL,
    [Marin_Req] MONEY NULL,
    [BILL_POST_CASH_FLAG] VARCHAR(1) NULL,
    [BILL_POST_FO_FLAG] VARCHAR(1) NULL,
    [MCDX_MTM] MONEY NULL,
    [NCDX_MTM] MONEY NULL,
    [NCE_MTM] MONEY NULL,
    [FO_MTM] MONEY NULL,
    [APPROVED_AMT] MONEY NULL,
    [CUSA_RELEASE_DATE] DATETIME NULL,
    [PROCESS_DATE] DATETIME NULL,
    [PROCESSED_BY] VARCHAR(50) NULL,
    [DUMMY1] VARCHAR(11) NULL,
    [DUMMY2] VARCHAR(11) NULL,
    [DUMMY3] VARCHAR(11) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CUSPA_SHARE_RELEASE_PROCESS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CUSPA_SHARE_RELEASE_PROCESS]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [PARTY_CODE] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(50) NULL,
    [SERIES] VARCHAR(5) NULL,
    [ISIN] VARCHAR(25) NULL,
    [HOLD_QTY] INT NULL,
    [RELEASE_QTY] INT NULL,
    [CUSA_RELEASE_DATE] DATETIME NULL,
    [PROCESS_DATE] DATETIME NULL,
    [PROCESSED_BY] VARCHAR(50) NULL,
    [DUMMY1] VARCHAR(11) NULL,
    [DUMMY2] VARCHAR(11) NULL,
    [DUMMY3] VARCHAR(11) NULL,
    [CL_Rate] MONEY NULL,
    [Var_Margin] MONEY NULL,
    [VAlue_Afterhaircut] MONEY NULL,
    [Sett_no] VARCHAR(20) NULL,
    [ORg_Sett_no] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_DMS_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_DMS_DATA]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [DATE] DATETIME NOT NULL,
    [NSECM LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [BSECM LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [NSEFO LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [BSEFO LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [NSECD LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [MCDX LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [NCDX LED BALANCE] NUMERIC(38, 4) NOT NULL,
    [MSEI LED BALANCE] MONEY NULL,
    [PLEDGE] MONEY NULL,
    [POOL EPN - VALUE OF SECURITIES AFTER HAIRCUT] MONEY NULL,
    [EPN UNDER FUNDS COLUMN] MONEY NULL,
    [MTF COLLATERAL] MONEY NULL,
    [TOTAL] MONEY NULL,
    [PAYMENT] MONEY NULL,
    [TOTAL PEAK BALANCE] MONEY NULL,
    [CLEAR LEDGER BALANCE AS PER DMS] MONEY NULL,
    [CLEAR LEDGER BALANCE AS PER CLIENT LEDGER] MONEY NULL,
    [CM_PEAK_1] MONEY NULL,
    [CM_PEAK_2] MONEY NULL,
    [CM_PEAK_3] MONEY NULL,
    [CM_PEAK_4] MONEY NULL,
    [COMMODITY_PEAK_1] MONEY NULL,
    [COMMODITY_PEAK_2] MONEY NULL,
    [COMMODITY_PEAK_3] MONEY NULL,
    [COMMODITY_PEAK_4] MONEY NULL,
    [NSEFO_PEAK_1] MONEY NULL,
    [NSEFO_PEAK_2] MONEY NULL,
    [NSEFO_PEAK_3] MONEY NULL,
    [NSEFO_PEAK_4] MONEY NULL,
    [NSECD_PEAK_1] MONEY NULL,
    [NSECD_PEAK_2] MONEY NULL,
    [NSECD_PEAK_3] MONEY NULL,
    [NSECD_PEAK_4] MONEY NULL,
    [MCDX_PEAK_1] MONEY NULL,
    [MCDX_PEAK_2] MONEY NULL,
    [MCDX_PEAK_3] MONEY NULL,
    [MCDX_PEAK_4] MONEY NULL,
    [MCDX_PEAK_5] MONEY NULL,
    [MCDX_PEAK_6] MONEY NULL,
    [MCDX_PEAK_7] MONEY NULL,
    [MCDX_PEAK_8] MONEY NULL,
    [NCDX_PEAK_1] MONEY NULL,
    [NCDX_PEAK_2] MONEY NULL,
    [NCDX_PEAK_3] MONEY NULL,
    [NCDX_PEAK_4] MONEY NULL,
    [NCDX_PEAK_5] MONEY NULL,
    [SUM_OF_PEAK_1] MONEY NULL,
    [SUM_OF_PEAK_2] MONEY NULL,
    [SUM_OF_PEAK_3] MONEY NULL,
    [SUM_OF_PEAK_4] MONEY NULL,
    [SUM_OF_PEAK_5] MONEY NULL,
    [SUM_OF_PEAK_6] MONEY NULL,
    [SUM_OF_PEAK_7] MONEY NULL,
    [SUM_OF_PEAK_8] MONEY NULL,
    [MAX PEAK MARGIN] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_DMS_REPORT_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_DMS_REPORT_DATA]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [DATE] VARCHAR(100) NULL,
    [NSECM LED BALANCE] VARCHAR(100) NULL,
    [BSECM LED BALANCE] VARCHAR(100) NULL,
    [NSEFO LED BALANCE] VARCHAR(100) NULL,
    [BSEFO LED BALANCE] VARCHAR(100) NULL,
    [NSECD LED BALANCE] VARCHAR(100) NULL,
    [MCDX LED BALANCE] VARCHAR(100) NULL,
    [NCDX LED BALANCE] VARCHAR(100) NULL,
    [MSEI LED BALANCE] VARCHAR(100) NULL,
    [PLEDGE] VARCHAR(100) NULL,
    [POOL EPN - VALUE OF SECURITIES AFTER HAIRCUT] VARCHAR(100) NULL,
    [EPN UNDER FUNDS COLUMN] VARCHAR(100) NULL,
    [MTF COLLATERAL] VARCHAR(100) NULL,
    [TOTAL] VARCHAR(100) NULL,
    [PAYMENT] VARCHAR(100) NULL,
    [TOTAL PEAK BALANCE] VARCHAR(100) NULL,
    [CLEAR LEDGER BALANCE AS PER DMS] VARCHAR(100) NULL,
    [CLEAR LEDGER BALANCE AS PER CLIENT LEDGER] VARCHAR(100) NULL,
    [CM_PEAK_1] VARCHAR(100) NULL,
    [CM_PEAK_2] VARCHAR(100) NULL,
    [CM_PEAK_3] VARCHAR(100) NULL,
    [CM_PEAK_4] VARCHAR(100) NULL,
    [COMMODITY_PEAK_1] VARCHAR(100) NULL,
    [COMMODITY_PEAK_2] VARCHAR(100) NULL,
    [COMMODITY_PEAK_3] VARCHAR(100) NULL,
    [COMMODITY_PEAK_4] VARCHAR(100) NULL,
    [NSEFO_PEAK_1] VARCHAR(100) NULL,
    [NSEFO_PEAK_2] VARCHAR(100) NULL,
    [NSEFO_PEAK_3] VARCHAR(100) NULL,
    [NSEFO_PEAK_4] VARCHAR(100) NULL,
    [NSECD_PEAK_1] VARCHAR(100) NULL,
    [NSECD_PEAK_2] VARCHAR(100) NULL,
    [NSECD_PEAK_3] VARCHAR(100) NULL,
    [NSECD_PEAK_4] VARCHAR(100) NULL,
    [MCDX_PEAK_1] VARCHAR(100) NULL,
    [MCDX_PEAK_2] VARCHAR(100) NULL,
    [MCDX_PEAK_3] VARCHAR(100) NULL,
    [MCDX_PEAK_4] VARCHAR(100) NULL,
    [MCDX_PEAK_5] VARCHAR(100) NULL,
    [MCDX_PEAK_6] VARCHAR(100) NULL,
    [MCDX_PEAK_7] VARCHAR(100) NULL,
    [MCDX_PEAK_8] VARCHAR(100) NULL,
    [NCDX_PEAK_1] VARCHAR(100) NULL,
    [NCDX_PEAK_2] VARCHAR(100) NULL,
    [NCDX_PEAK_3] VARCHAR(100) NULL,
    [NCDX_PEAK_4] VARCHAR(100) NULL,
    [NCDX_PEAK_5] VARCHAR(100) NULL,
    [SUM_OF_PEAK_1] VARCHAR(100) NULL,
    [SUM_OF_PEAK_2] VARCHAR(100) NULL,
    [SUM_OF_PEAK_3] VARCHAR(100) NULL,
    [SUM_OF_PEAK_4] VARCHAR(100) NULL,
    [SUM_OF_PEAK_5] VARCHAR(100) NULL,
    [SUM_OF_PEAK_6] VARCHAR(100) NULL,
    [SUM_OF_PEAK_7] VARCHAR(100) NULL,
    [SUM_OF_PEAK_8] VARCHAR(100) NULL,
    [MAX PEAK MARGIN] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_dormant_data
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_dormant_data]
(
    [CL_CODE] VARCHAR(50) NULL,
    [REGION] VARCHAR(50) NULL,
    [BRANCH_CD] VARCHAR(50) NULL,
    [SUB_BROKER] VARCHAR(50) NULL,
    [B2C] VARCHAR(50) NULL,
    [TYPE_ACC] VARCHAR(50) NULL,
    [LAST_TRANS1] VARCHAR(50) NULL,
    [HOLDING1] VARCHAR(50) NULL,
    [HOLDING_DP] VARCHAR(50) NULL,
    [ACTIVE_DATE] VARCHAR(50) NULL,
    [SRNO] VARCHAR(50) NULL,
    [OmneManagerID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Dormant_Omny
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Dormant_Omny]
(
    [Party_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_DPFREEZE_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_DPFREEZE_DATA]
(
    [ANGEL_DP_ID] VARCHAR(100) NULL,
    [FREEZEID] VARCHAR(100) NULL,
    [FREEZERMKS] VARCHAR(100) NULL,
    [CL_CODE] VARCHAR(10) NOT NULL,
    [ACTIVE_DATE] VARCHAR(30) NULL,
    [INACTIVE_FROM] VARCHAR(30) NULL,
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [STATUS] VARCHAR(8) NOT NULL,
    [ACTIVE/INACTIVE_STATUS] VARCHAR(22) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_EPN_BENEFIT_20250911
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_EPN_BENEFIT_20250911]
(
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(2) NOT NULL,
    [TRANSDATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [SCRIP_CD] VARCHAR(12) NOT NULL,
    [SERIES] VARCHAR(3) NOT NULL,
    [SELLQTY] NUMERIC(38, 3) NULL,
    [EPNQTY_CC] NUMERIC(38, 3) NULL,
    [NONEPNQTY] NUMERIC(38, 3) NULL,
    [MARGIN_REQUIREMENT] NUMERIC(38, 4) NULL,
    [SELLAMOUNT] NUMERIC(38, 4) NULL,
    [SQOFFAMT] NUMERIC(38, 4) NULL,
    [CASHBENEFIT] NUMERIC(38, 6) NULL,
    [MARGIN_BENEFIT] NUMERIC(38, 6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_EPN_BENEFIT_Bak_20250221
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_EPN_BENEFIT_Bak_20250221]
(
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(2) NOT NULL,
    [TRANSDATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [SCRIP_CD] VARCHAR(12) NOT NULL,
    [SERIES] VARCHAR(3) NOT NULL,
    [SELLQTY] NUMERIC(38, 3) NULL,
    [EPNQTY_CC] NUMERIC(38, 3) NULL,
    [NONEPNQTY] NUMERIC(38, 3) NULL,
    [MARGIN_REQUIREMENT] NUMERIC(38, 4) NULL,
    [SELLAMOUNT] NUMERIC(38, 4) NULL,
    [SQOFFAMT] NUMERIC(38, 4) NULL,
    [CASHBENEFIT] NUMERIC(38, 6) NULL,
    [MARGIN_BENEFIT] NUMERIC(38, 6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_EXCHG_SCRIP_MAP_10052023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_EXCHG_SCRIP_MAP_10052023]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [BSE_GROUP] VARCHAR(6) NULL,
    [SCRIP_NAME] VARCHAR(100) NULL,
    [NSE_SCRIP_CD] VARCHAR(12) NULL,
    [NSE_SERIES] VARCHAR(3) NULL,
    [FROM_DATE] DATETIME NULL,
    [TO_DATE] DATETIME NULL,
    [ADDED_ON] DATETIME NULL,
    [ADDED_BY] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_EXCHG_SCRIP_MAP_14AUg2025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_EXCHG_SCRIP_MAP_14AUg2025]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [BSE_GROUP] VARCHAR(6) NULL,
    [SCRIP_NAME] VARCHAR(100) NULL,
    [NSE_SCRIP_CD] VARCHAR(12) NULL,
    [NSE_SERIES] VARCHAR(3) NULL,
    [FROM_DATE] DATETIME NULL,
    [TO_DATE] DATETIME NULL,
    [ADDED_ON] DATETIME NULL,
    [ADDED_BY] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_EXCHG_SCRIP_MAP_544024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_EXCHG_SCRIP_MAP_544024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [BSE_GROUP] VARCHAR(6) NULL,
    [SCRIP_NAME] VARCHAR(100) NULL,
    [NSE_SCRIP_CD] VARCHAR(12) NULL,
    [NSE_SERIES] VARCHAR(3) NULL,
    [FROM_DATE] DATETIME NULL,
    [TO_DATE] DATETIME NULL,
    [ADDED_ON] DATETIME NULL,
    [ADDED_BY] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_GLCODE_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_GLCODE_DATA]
(
    [VTYP] VARCHAR(20) NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] VARCHAR(11) NULL,
    [LNO] VARCHAR(20) NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] VARCHAR(30) NULL,
    [VDT] VARCHAR(11) NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] VARCHAR(30) NULL,
    [NODAYS] VARCHAR(20) NULL,
    [CDT] VARCHAR(11) NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] VARCHAR(30) NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] VARCHAR(20) NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_08FEB2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_08FEB2024]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_BKP_15022023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_BKP_15022023]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_BKP_20220908
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_BKP_20220908]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_BKP_27OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_BKP_27OCT2023]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_bkup_01DEC2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_bkup_01DEC2023]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_bkup_11NOV2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_bkup_11NOV2023]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_bkup_12OCT2022
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_bkup_12OCT2022]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_bkup_21DEC2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_bkup_21DEC2023]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_bkup_21SEP2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_bkup_21SEP2023]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_HOLDING_USER_DT_DEC2022
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_HOLDING_USER_DT_DEC2022]
(
    [LOGINID] VARCHAR(50) NULL,
    [PASSWORDKEY] VARCHAR(100) NULL,
    [EXPIRES_IN] INT NULL,
    [LOGINLOGOUT] DATETIME NULL,
    [TOKENID] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_INACTIVE_CODE_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_INACTIVE_CODE_MCX]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [SHORT_NAME] VARCHAR(21) NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(7) NOT NULL,
    [ACTIVE_DATE] VARCHAR(30) NULL,
    [INACTIVE_FROM] VARCHAR(30) NULL,
    [STATUS] VARCHAR(8) NOT NULL,
    [Deactive_Remarks] VARCHAR(100) NULL,
    [Deactive_value] VARCHAR(1) NULL,
    [last_trade_date] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_INVOICE_NO_BKUP_04MAY2025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_INVOICE_NO_BKUP_04MAY2025]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [INV_FROM_DATE] DATETIME NULL,
    [INV_TO_DATE] DATETIME NULL,
    [STATECODE] VARCHAR(2) NULL,
    [LOCATIONCODE] VARCHAR(50) NULL,
    [INVOICE_CATEGORY] VARCHAR(10) NULL,
    [INV_NO] NUMERIC(18, 0) NULL,
    [RECORDFOR] VARCHAR(20) NULL,
    [INVOICE_TYPE] VARCHAR(20) NULL,
    [INVOICE_SERIES] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_INVOICE_NO_BKUP_30APR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_INVOICE_NO_BKUP_30APR2024]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [INV_FROM_DATE] DATETIME NULL,
    [INV_TO_DATE] DATETIME NULL,
    [STATECODE] VARCHAR(2) NULL,
    [LOCATIONCODE] VARCHAR(50) NULL,
    [INVOICE_CATEGORY] VARCHAR(10) NULL,
    [INV_NO] NUMERIC(18, 0) NULL,
    [RECORDFOR] VARCHAR(20) NULL,
    [INVOICE_TYPE] VARCHAR(20) NULL,
    [INVOICE_SERIES] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_LASTTRADE_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_LASTTRADE_DATA]
(
    [CL_CODE] VARCHAR(10) NOT NULL,
    [ACTIVE_DATE] VARCHAR(10) NULL,
    [LAST_TRD_DT] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_LEDGER_BILL_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_LEDGER_BILL_DATA]
(
    [BILL_DATE] VARCHAR(11) NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [EXCHANGE] VARCHAR(5) NOT NULL,
    [AMT] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Mcastudents
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Mcastudents]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Name] NVARCHAR(50) NULL,
    [Location] NVARCHAR(30) NULL,
    [Gender] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MCX_SHORT_ALLOC_INTRA_TMP_BKP_Jayant
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MCX_SHORT_ALLOC_INTRA_TMP_BKP_Jayant]
(
    [MARGINDATE] DATETIME NULL,
    [CMID] VARCHAR(20) NULL,
    [TMID] VARCHAR(20) NULL,
    [CLIENT_CODE] VARCHAR(20) NULL,
    [EOD_SHORT_ALLOC] NUMERIC(18, 4) NULL,
    [EXCESS_NCL] NUMERIC(18, 4) NULL,
    [EXCESS_ICCL] NUMERIC(18, 4) NULL,
    [EXCESS_NCCL] NUMERIC(18, 4) NULL,
    [EXCESS_MCCIL] NUMERIC(18, 4) NULL,
    [EPN_COMM] NUMERIC(18, 4) NULL,
    [ALLOC_PENDING] NUMERIC(18, 4) NULL,
    [WRONG_UCC] NUMERIC(18, 4) NULL,
    [WRING_CLIENT_CODE] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MCX_SHORT_ALLOC_INTRA_TMP_BLP_05MAY2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MCX_SHORT_ALLOC_INTRA_TMP_BLP_05MAY2023]
(
    [MARGINDATE] DATETIME NULL,
    [CMID] VARCHAR(20) NULL,
    [TMID] VARCHAR(20) NULL,
    [CLIENT_CODE] VARCHAR(20) NULL,
    [EOD_SHORT_ALLOC] NUMERIC(18, 4) NULL,
    [EXCESS_NCL] NUMERIC(18, 4) NULL,
    [EXCESS_ICCL] NUMERIC(18, 4) NULL,
    [EXCESS_NCCL] NUMERIC(18, 4) NULL,
    [EXCESS_MCCIL] NUMERIC(18, 4) NULL,
    [EPN_COMM] NUMERIC(18, 4) NULL,
    [ALLOC_PENDING] NUMERIC(18, 4) NULL,
    [WRONG_UCC] NUMERIC(18, 4) NULL,
    [WRING_CLIENT_CODE] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_BILL_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_BILL_DATA]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [COLL] VARCHAR(20) NULL,
    [LED] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING]
(
    [SNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING_04112024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING_04112024]
(
    [SNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING_09082024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING_09082024]
(
    [SNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING_bkp_20241001
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING_bkp_20241001]
(
    [SNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING_bkp_20250508
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING_bkp_20250508]
(
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING_bkp_20250513
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING_bkp_20250513]
(
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTF_MARKING_bkpp
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTF_MARKING_bkpp]
(
    [SNO] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [HOLDFLAG] VARCHAR(50) NULL,
    [RUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTR_OPEN_BALANCE_test
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTR_OPEN_BALANCE_test]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [M_BODQTY] INT NULL,
    [M_BODVALUE] NUMERIC(38, 2) NULL,
    [M_FRESHBQTY] INT NULL,
    [M_FRESHBUY] NUMERIC(38, 2) NULL,
    [M_FRESHSQTY] INT NULL,
    [M_FRESHSELL] NUMERIC(38, 2) NULL,
    [M_NETQTY] INT NULL,
    [M_NETAMOUNT] NUMERIC(38, 2) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [ISIN] VARCHAR(15) NULL,
    [BSECODE] VARCHAR(10) NULL,
    [MARGIN_REQ] NUMERIC(20, 4) NULL,
    [PAYIN_AMT] NUMERIC(20, 4) NULL,
    [MTM_AMT] NUMERIC(20, 4) NULL,
    [PAYIN_AMT_BAL] NUMERIC(20, 4) NULL,
    [M_QTY] INT NULL,
    [M_PRICE] NUMERIC(20, 4) NULL,
    [M_AMT] NUMERIC(20, 4) NULL,
    [M_ALLOC_BALANCE] NUMERIC(20, 4) NULL,
    [NF_QTY] INT NULL,
    [NF_AMT] NUMERIC(20, 4) NULL,
    [COLL_QTY] INT NULL,
    [HAIRCUT] NUMERIC(20, 4) NULL,
    [PRO_PER] NUMERIC(20, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MTR_REPORTING_03102025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MTR_REPORTING_03102025]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [M_BODQTY] INT NULL,
    [M_BODVALUE] NUMERIC(38, 2) NULL,
    [M_FRESHBQTY] INT NULL,
    [M_FRESHBUY] NUMERIC(38, 2) NULL,
    [M_FRESHSQTY] INT NULL,
    [M_FRESHSELL] NUMERIC(38, 2) NULL,
    [M_NETQTY] INT NULL,
    [M_NETAMOUNT] NUMERIC(38, 2) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [ISIN] VARCHAR(15) NULL,
    [BSECODE] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NONCASH_REPORT_BKP_20220222_23
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NONCASH_REPORT_BKP_20220222_23]
(
    [PROCESS_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [ISIN] VARCHAR(16) NULL,
    [QTY] NUMERIC(38, 0) NULL,
    [PLDQTY] INT NOT NULL,
    [REPLDQTY] INT NOT NULL,
    [CL_RATE] NUMERIC(18, 4) NULL,
    [HAIRCUT] NUMERIC(18, 4) NULL,
    [BDPID] VARCHAR(16) NULL,
    [BCLTDPID] VARCHAR(16) NULL,
    [BDPID1] VARCHAR(16) NULL,
    [BCLTDPID1] VARCHAR(16) NULL,
    [BDPID2] VARCHAR(16) NULL,
    [BCLTDPID2] VARCHAR(16) NULL,
    [PSNNO1] VARCHAR(16) NULL,
    [PSNNO2] VARCHAR(16) NULL,
    [PSNNO3] VARCHAR(16) NULL,
    [SEC_TYPE] VARCHAR(7) NOT NULL,
    [TM_APP_FLAG] VARCHAR(1) NOT NULL,
    [CM_APP_FLAG] VARCHAR(1) NOT NULL,
    [CC_APP_FLAG] VARCHAR(1) NOT NULL,
    [EXCHG_SEC] VARCHAR(50) NULL,
    [PLDEXCHG_SEC] VARCHAR(50) NULL,
    [REPLDEXCHG_SEC] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_BUYBACK_LEC
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_BUYBACK_LEC]
(
    [FLDCOL] VARCHAR(MAX) NULL,
    [BANKNAME] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_BUYBACK_LEC_ALLBANKS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_BUYBACK_LEC_ALLBANKS]
(
    [BANKNAME] VARCHAR(50) NULL,
    [PARTY_CODE] VARCHAR(50) NULL,
    [HEAD] VARCHAR(50) NULL,
    [DETAILS] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_BUYBACK_LEC_HDFC_YES
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_BUYBACK_LEC_HDFC_YES]
(
    [BANK NAME] VARCHAR(100) NULL,
    [TRADE DATE] VARCHAR(100) NULL,
    [TRADING ID] VARCHAR(100) NULL,
    [DP ID] VARCHAR(100) NULL,
    [DEMAT A/C NO] VARCHAR(100) NULL,
    [INVESTOR NAME] VARCHAR(300) NULL,
    [EXCHANGE] VARCHAR(100) NULL,
    [SETTLEMENT NO] VARCHAR(100) NULL,
    [CONTRACT NO] VARCHAR(100) NULL,
    [SCRIP CODE] VARCHAR(100) NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIP_NAME] VARCHAR(300) NULL,
    [BUY/SELL] VARCHAR(100) NULL,
    [QUANTITY] VARCHAR(100) NULL,
    [WEIGHTED AVERAGE MARKET RATE] VARCHAR(100) NULL,
    [TOTAL MARKET VALUE] VARCHAR(100) NULL,
    [NET RATE] VARCHAR(100) NULL,
    [BROKEARGE] VARCHAR(100) NULL,
    [OTHER CHARGES] VARCHAR(100) NULL,
    [NET PURCHASE/SALE VALUE] VARCHAR(100) NULL,
    [STT ON BUY & SALE] VARCHAR(100) NULL,
    [EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)] VARCHAR(100) NULL,
    [RBI APPROVAL NO] VARCHAR(100) NULL,
    [PIS ACCOUNT NO] VARCHAR(100) NULL,
    [SAVING BANK ACCOUNT NO] VARCHAR(100) NULL,
    [BANK BRANCH NAME] VARCHAR(100) NULL,
    [BROKER NAME] VARCHAR(100) NULL,
    [DATE OF RECEIPT /PAYMENT] VARCHAR(100) NULL,
    [DEMAT DEBIT /CREDIT DATE] VARCHAR(100) NULL,
    [BROKER A/C NO] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_BUYBACK_LEC_KOTAK
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_BUYBACK_LEC_KOTAK]
(
    [BANK_ACC_NO] VARCHAR(20) NULL,
    [SCHEME] VARCHAR(7) NOT NULL,
    [CLIENT_CODE] VARCHAR(100) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [VALAN] VARCHAR(201) NULL,
    [DEAL_TYPE] VARCHAR(1) NOT NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QUANTITY] VARCHAR(100) NULL,
    [GROSS_RATE] VARCHAR(100) NULL,
    [BROKERAGE] VARCHAR(100) NULL,
    [NET_RATE] VARCHAR(100) NULL,
    [AMOUNT] VARCHAR(100) NULL,
    [STT] VARCHAR(100) NULL,
    [TXN_TYPE] VARCHAR(1) NOT NULL,
    [DP_ID] VARCHAR(25) NULL,
    [SHORT_GAIN] VARCHAR(1) NOT NULL,
    [SHORT_LOSS] VARCHAR(1) NOT NULL,
    [LONG_GAIN] VARCHAR(1) NOT NULL,
    [LONG_LOSS] VARCHAR(1) NOT NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [PMS_PRODUCT] VARCHAR(1) NOT NULL,
    [CONTRACT_NUMBER] VARCHAR(100) NULL,
    [SERVICE_TAX] VARCHAR(100) NULL,
    [EDUCATION_CESS] VARCHAR(1) NOT NULL,
    [EXCHANGE_LEVY] VARCHAR(1) NOT NULL,
    [STAMPDUTY] VARCHAR(100) NULL,
    [OTHER_CHARGES] VARCHAR(100) NULL,
    [DEPOSITORY_ID] VARCHAR(8) NULL,
    [SETTLEMENT_TYPE] VARCHAR(100) NULL,
    [SETTLEMENT_NUMBER] VARCHAR(100) NULL,
    [SETTLEMENT_DATE] VARCHAR(100) NULL,
    [SEBI_REG_NO1] VARCHAR(20) NOT NULL,
    [SEBI_SUB_CATEGORY] VARCHAR(3) NOT NULL,
    [INSTRUMENT_SUB_TYPE] VARCHAR(100) NULL,
    [PANNO] VARCHAR(1) NOT NULL,
    [NON_PINS_ACCOUNT] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_NKAB_LEC_ALLBANKS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_NKAB_LEC_ALLBANKS]
(
    [BANKNAME] VARCHAR(50) NULL,
    [PARTY_CODE] VARCHAR(50) NULL,
    [HEAD] VARCHAR(50) NULL,
    [DETAILS] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_NKAB_LEC_HDFC_YES
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_NKAB_LEC_HDFC_YES]
(
    [BANK NAME] VARCHAR(100) NULL,
    [TRADE DATE] VARCHAR(100) NULL,
    [TRADING ID] VARCHAR(100) NULL,
    [DP ID] VARCHAR(100) NULL,
    [DEMAT A/C NO] VARCHAR(100) NULL,
    [INVESTOR NAME] VARCHAR(300) NULL,
    [EXCHANGE] VARCHAR(100) NULL,
    [SETTLEMENT NO] VARCHAR(100) NULL,
    [CONTRACT NO] VARCHAR(100) NULL,
    [SCRIP CODE] VARCHAR(100) NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIP_NAME] VARCHAR(300) NULL,
    [BUY/SELL] VARCHAR(100) NULL,
    [QUANTITY] VARCHAR(100) NULL,
    [WEIGHTED AVERAGE MARKET RATE] VARCHAR(100) NULL,
    [TOTAL MARKET VALUE] VARCHAR(100) NULL,
    [NET RATE] VARCHAR(100) NULL,
    [BROKEARGE] VARCHAR(100) NULL,
    [OTHER CHARGES] VARCHAR(100) NULL,
    [NET PURCHASE/SALE VALUE] VARCHAR(100) NULL,
    [STT ON BUY & SALE] VARCHAR(100) NULL,
    [EXACT AMOUNT PAID BY / TO  THE CUSTOMER (FOR PURCHASE/SALE)] VARCHAR(100) NULL,
    [RBI APPROVAL NO] VARCHAR(100) NULL,
    [PIS ACCOUNT NO] VARCHAR(100) NULL,
    [SAVING BANK ACCOUNT NO] VARCHAR(100) NULL,
    [BANK BRANCH NAME] VARCHAR(100) NULL,
    [BROKER NAME] VARCHAR(100) NULL,
    [DATE OF RECEIPT /PAYMENT] VARCHAR(100) NULL,
    [DEMAT DEBIT /CREDIT DATE] VARCHAR(100) NULL,
    [BROKER A/C NO] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRI_NKAB_LEC_KOTAK
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRI_NKAB_LEC_KOTAK]
(
    [BANK_ACC_NO] VARCHAR(20) NULL,
    [SCHEME] VARCHAR(7) NOT NULL,
    [CLIENT_CODE] VARCHAR(100) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [VALAN] VARCHAR(201) NULL,
    [DEAL_TYPE] VARCHAR(1) NOT NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QUANTITY] VARCHAR(100) NULL,
    [GROSS_RATE] VARCHAR(100) NULL,
    [BROKERAGE] VARCHAR(100) NULL,
    [NET_RATE] VARCHAR(100) NULL,
    [AMOUNT] VARCHAR(100) NULL,
    [STT] VARCHAR(100) NULL,
    [TXN_TYPE] VARCHAR(1) NOT NULL,
    [DP_ID] VARCHAR(25) NULL,
    [SHORT_GAIN] VARCHAR(1) NOT NULL,
    [SHORT_LOSS] VARCHAR(1) NOT NULL,
    [LONG_GAIN] VARCHAR(1) NOT NULL,
    [LONG_LOSS] VARCHAR(1) NOT NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [PMS_PRODUCT] VARCHAR(1) NOT NULL,
    [CONTRACT_NUMBER] VARCHAR(100) NULL,
    [SERVICE_TAX] VARCHAR(100) NULL,
    [EDUCATION_CESS] VARCHAR(1) NOT NULL,
    [EXCHANGE_LEVY] VARCHAR(1) NOT NULL,
    [STAMPDUTY] VARCHAR(100) NULL,
    [OTHER_CHARGES] VARCHAR(100) NULL,
    [DEPOSITORY_ID] VARCHAR(8) NULL,
    [SETTLEMENT_TYPE] VARCHAR(100) NULL,
    [SETTLEMENT_NUMBER] VARCHAR(100) NULL,
    [SETTLEMENT_DATE] VARCHAR(100) NULL,
    [SEBI_REG_NO1] VARCHAR(20) NOT NULL,
    [SEBI_SUB_CATEGORY] VARCHAR(3) NOT NULL,
    [INSTRUMENT_SUB_TYPE] VARCHAR(100) NULL,
    [PANNO] VARCHAR(1) NOT NULL,
    [NON_PINS_ACCOUNT] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NRILec_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NRILec_temp]
(
    [FLDCOL] VARCHAR(1000) NULL,
    [BankName] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NRILec_tempBKP
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NRILec_tempBKP]
(
    [FLDCOL] VARCHAR(1000) NULL,
    [BankName] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NRILECKOTAK_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NRILECKOTAK_TEMP]
(
    [BANK_ACC_NO] VARCHAR(20) NULL,
    [SCHEME] VARCHAR(7) NOT NULL,
    [CLIENT_CODE] VARCHAR(100) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [TRADE_DATE] VARCHAR(11) NULL,
    [VALAN] VARCHAR(201) NULL,
    [DEAL_TYPE] VARCHAR(1) NOT NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QUANTITY] VARCHAR(100) NULL,
    [GROSS_RATE] VARCHAR(100) NULL,
    [BROKERAGE] VARCHAR(100) NULL,
    [NET_RATE] VARCHAR(100) NULL,
    [AMOUNT] VARCHAR(100) NULL,
    [STT] VARCHAR(100) NULL,
    [TXN_TYPE] VARCHAR(1) NOT NULL,
    [DP_ID] VARCHAR(25) NULL,
    [SHORT_GAIN] VARCHAR(1) NOT NULL,
    [SHORT_LOSS] VARCHAR(1) NOT NULL,
    [LONG_GAIN] VARCHAR(1) NOT NULL,
    [LONG_LOSS] VARCHAR(1) NOT NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [PMS_PRODUCT] VARCHAR(1) NOT NULL,
    [CONTRACT_NUMBER] VARCHAR(100) NULL,
    [SERVICE_TAX] VARCHAR(100) NULL,
    [EDUCATION_CESS] VARCHAR(1) NOT NULL,
    [EXCHANGE_LEVY] VARCHAR(1) NOT NULL,
    [STAMPDUTY] VARCHAR(100) NULL,
    [OTHER_CHARGES] VARCHAR(100) NULL,
    [DEPOSITORY_ID] VARCHAR(8) NULL,
    [SETTLEMENT_TYPE] VARCHAR(100) NULL,
    [SETTLEMENT_NUMBER] VARCHAR(100) NULL,
    [SETTLEMENT_DATE] VARCHAR(100) NULL,
    [SEBI_REG_NO1] VARCHAR(20) NOT NULL,
    [SEBI_SUB_CATEGORY] VARCHAR(3) NOT NULL,
    [INSTRUMENT_SUB_TYPE] VARCHAR(100) NULL,
    [PANNO] VARCHAR(1) NOT NULL,
    [NON_PINS_ACCOUNT] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NRILecYesHdfc_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NRILecYesHdfc_temp]
(
    [FLDCOL] VARCHAR(1000) NULL,
    [BankName] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSE_REPORTING_07072025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSE_REPORTING_07072025]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [PROCESSDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSE_REPORTING_07092024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSE_REPORTING_07092024]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [PROCESSDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSE_REPORTING_09072024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSE_REPORTING_09072024]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [PROCESSDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSE_REPORTING_10072024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSE_REPORTING_10072024]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [PROCESSDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSE_REPORTING_11042025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSE_REPORTING_11042025]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [PROCESSDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSE_REPORTING_BKP_20221222
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSE_REPORTING_BKP_20221222]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BODQTY] INT NULL,
    [BODVALUE] NUMERIC(38, 2) NULL,
    [FRESHBQTY] INT NULL,
    [FRESHBUY] NUMERIC(38, 2) NULL,
    [FRESHSQTY] INT NULL,
    [FRESHSELL] NUMERIC(38, 2) NULL,
    [NETQTY] INT NULL,
    [NETAMOUNT] NUMERIC(38, 2) NULL,
    [PROCESSDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NSEBSE_Details_yesHdfcbnk
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NSEBSE_Details_yesHdfcbnk]
(
    [EXCHANGE] VARCHAR(50) NULL,
    [PARTY_CODE] VARCHAR(50) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [CONTRACTNO] VARCHAR(50) NULL,
    [TRANSACTION_TYPE] CHAR(1) NULL,
    [ISIN] VARCHAR(50) NULL,
    [qty] INT NULL,
    [Rate] DECIMAL(18, 6) NULL,
    [BROK_PERSCRIP] DECIMAL(18, 2) NULL,
    [TRANACTIONAMT] DECIMAL(18, 4) NULL,
    [Scripname] VARCHAR(100) NULL,
    [scripcode] VARCHAR(100) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [TRATE] DECIMAL(18, 6) NULL,
    [OtherCharges] DECIMAL(18, 6) NULL,
    [NseStt] DECIMAL(18, 6) NULL,
    [Othertax] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NSEBSE_HEADER_yesHdfcbnk
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NSEBSE_HEADER_yesHdfcbnk]
(
    [EXCHANGE] VARCHAR(50) NULL,
    [PARTY_CODE] VARCHAR(50) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [SELL_BUY] INT NULL,
    [CONTRACTNO] VARCHAR(50) NULL,
    [SERVICE_TAX] DECIMAL(18, 4) NULL,
    [EDUCESS] INT NULL,
    [EXCHAGE_LEVIES] DECIMAL(18, 4) NULL,
    [STT] DECIMAL(18, 4) NULL,
    [STAMPDUTY] DECIMAL(18, 4) NULL,
    [MINBROKERAGE] DECIMAL(18, 4) NULL,
    [OTHER_CHARGES] DECIMAL(18, 4) NULL,
    [NO_OF_TRANSACTIONS] INT NULL,
    [TOTALAMT] DECIMAL(18, 2) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [TYPE] VARCHAR(5) NULL,
    [nseSett_no2] VARCHAR(50) NULL,
    [nseBank] VARCHAR(50) NULL,
    [rbi_refno] VARCHAR(50) NULL,
    [CliPISNo] VARCHAR(50) NULL,
    [CliBnkAcc] VARCHAR(50) NULL,
    [cliBankBranch] VARCHAR(100) NULL,
    [angelAcc] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_RCS_250124
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_RCS_250124]
(
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [NETQTY] INT NULL,
    [TBL_POA_PLD_ADNL_QTY] NUMERIC(38, 0) NOT NULL,
    [HOLDINGQTY] NUMERIC(38, 0) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_BKP_202200727_COSMOFILMS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_BKP_202200727_COSMOFILMS]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_BKP_202200727_COSMOFIRST
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_BKP_202200727_COSMOFIRST]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_BKP_20220610
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_BKP_20220610]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_BKP_26052025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_BKP_26052025]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_BSE_BLANK
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_BSE_BLANK]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_CHECK_1607
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_CHECK_1607]
(
    [SNO] BIGINT IDENTITY(1,1) NOT NULL,
    [ORGSNO] BIGINT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [trade_no] VARCHAR(20) NULL,
    [order_no] VARCHAR(20) NULL,
    [UPDFLAG] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_PRODUCT_POSITION_OPEN_POS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_PRODUCT_POSITION_OPEN_POS]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Sett_Type] VARCHAR(3) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [PRODUCT_CODE] VARCHAR(20) NULL,
    [SCRIP_CD] VARCHAR(12) NULL,
    [SERIES] VARCHAR(3) NULL,
    [BSECODE] VARCHAR(6) NULL,
    [Sell_Buy] INT NOT NULL,
    [ISIN] VARCHAR(12) NULL,
    [QTY] INT NULL,
    [MKTAMT] MONEY NULL,
    [NETAMT] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [PAYIN_DATE] DATETIME NULL,
    [ADJUST_DATE] DATETIME NOT NULL,
    [TRANSTYPE] VARCHAR(5) NOT NULL,
    [PROCESSDATE] DATETIME NOT NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [Order_No] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN]
(
    [TRANS_DATE] DATETIME NULL,
    [EXE_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [PLEDGE_UNPLEDGE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [ORDDATE] VARCHAR(12) NULL,
    [DPID] VARCHAR(20) NULL,
    [CLTDPID] VARCHAR(20) NULL,
    [BDPID] VARCHAR(20) NULL,
    [BCLTDPID] VARCHAR(20) NULL,
    [BALQTY] BIGINT NULL,
    [DET_FLAG] BIGINT NULL,
    [INSERTED_ON] DATETIME NULL,
    [SRNO] NUMERIC(36, 0) IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_17JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_17JAN2024]
(
    [TRANS_DATE] VARCHAR(11) NULL,
    [EXE_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [L_ADDRESS1] VARCHAR(40) NOT NULL,
    [L_ADDRESS2] VARCHAR(40) NULL,
    [L_ADDRESS3] VARCHAR(40) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [FAMILY] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(1) NOT NULL,
    [PEND_OBL_ASONDATE] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_25FEB2025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_25FEB2025]
(
    [TRANS_DATE] VARCHAR(11) NULL,
    [EXE_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [L_ADDRESS1] VARCHAR(40) NOT NULL,
    [L_ADDRESS2] VARCHAR(40) NULL,
    [L_ADDRESS3] VARCHAR(40) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [FAMILY] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(1) NOT NULL,
    [PEND_OBL_ASONDATE] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_25NOV2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_25NOV2024]
(
    [TRANS_DATE] VARCHAR(11) NULL,
    [EXE_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [L_ADDRESS1] VARCHAR(40) NOT NULL,
    [L_ADDRESS2] VARCHAR(40) NULL,
    [L_ADDRESS3] VARCHAR(40) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [FAMILY] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(1) NOT NULL,
    [PEND_OBL_ASONDATE] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_26JUN2025
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_26JUN2025]
(
    [TRANS_DATE] VARCHAR(11) NULL,
    [EXE_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [L_ADDRESS1] VARCHAR(40) NOT NULL,
    [L_ADDRESS2] VARCHAR(40) NULL,
    [L_ADDRESS3] VARCHAR(40) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [FAMILY] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(1) NOT NULL,
    [PEND_OBL_ASONDATE] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_BKP_17NOV2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_BKP_17NOV2023]
(
    [TRANS_DATE] DATETIME NULL,
    [EXE_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [PLEDGE_UNPLEDGE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [ORDDATE] VARCHAR(12) NULL,
    [DPID] VARCHAR(20) NULL,
    [CLTDPID] VARCHAR(20) NULL,
    [BDPID] VARCHAR(20) NULL,
    [BCLTDPID] VARCHAR(20) NULL,
    [BALQTY] BIGINT NULL,
    [DET_FLAG] BIGINT NULL,
    [INSERTED_ON] DATETIME NULL,
    [SRNO] NUMERIC(36, 0) IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_MC81
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_MC81]
(
    [TRANS_DATE] DATETIME NULL,
    [EXE_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [PLEDGE_UNPLEDGE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [ORDDATE] VARCHAR(12) NULL,
    [DPID] VARCHAR(20) NULL,
    [CLTDPID] VARCHAR(20) NULL,
    [BDPID] VARCHAR(20) NULL,
    [BCLTDPID] VARCHAR(20) NULL,
    [BALQTY] BIGINT NULL,
    [DET_FLAG] BIGINT NULL,
    [INSERTED_ON] DATETIME NULL,
    [SRNO] NUMERIC(36, 0) IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_PART1
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_PART1]
(
    [TRANS_DATE] DATETIME NULL,
    [EXE_DATE] DATETIME NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [PLEDGE_UNPLEDGE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [ORDDATE] VARCHAR(12) NULL,
    [DPID] VARCHAR(20) NULL,
    [CLTDPID] VARCHAR(20) NULL,
    [BDPID] VARCHAR(20) NULL,
    [BCLTDPID] VARCHAR(20) NULL,
    [BALQTY] BIGINT NULL,
    [DET_FLAG] BIGINT NULL,
    [INSERTED_ON] DATETIME NULL,
    [SRNO] NUMERIC(36, 0) IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_PART1_NEW
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_PART1_NEW]
(
    [TRANS_DATE] VARCHAR(11) NULL,
    [EXE_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [L_ADDRESS1] VARCHAR(40) NOT NULL,
    [L_ADDRESS2] VARCHAR(40) NULL,
    [L_ADDRESS3] VARCHAR(40) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [FAMILY] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(1) NOT NULL,
    [PEND_OBL_ASONDATE] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_DUSTBIN_PART2_NEW
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_DUSTBIN_PART2_NEW]
(
    [TRANS_DATE] VARCHAR(11) NULL,
    [EXE_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(5) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_NAME] VARCHAR(100) NULL,
    [CLIENT_PAN] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(20) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(20) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(20) NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL,
    [SCRIP_NAME] VARCHAR(50) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(20) NULL,
    [POA_FLAG] VARCHAR(5) NULL,
    [TRANSACTION_TYPE] VARCHAR(20) NULL,
    [PURPOSE] VARCHAR(100) NULL,
    [ORDFLAG] BIGINT NULL,
    [L_ADDRESS1] VARCHAR(40) NOT NULL,
    [L_ADDRESS2] VARCHAR(40) NULL,
    [L_ADDRESS3] VARCHAR(40) NULL,
    [L_CITY] VARCHAR(40) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [FAMILY] VARCHAR(10) NOT NULL,
    [BRANCH_CD] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [GST_NO] VARCHAR(20) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(1) NOT NULL,
    [PEND_OBL_ASONDATE] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_NEWTEST
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_NEWTEST]
(
    [TRANSDATE] VARCHAR(30) NULL,
    [EXE_DATE] VARCHAR(30) NULL,
    [EXCHANGE] VARCHAR(30) NULL,
    [SEGMENT_TYPE] VARCHAR(30) NULL,
    [UCC_CODE] VARCHAR(50) NULL,
    [PARTY_CODE] VARCHAR(50) NULL,
    [CLIENT_NAME] VARCHAR(200) NULL,
    [CLIENT_PAN] VARCHAR(50) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(100) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(100) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(100) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(100) NULL,
    [SETT_NO] VARCHAR(100) NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIP_NAME] VARCHAR(200) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(100) NULL,
    [POA_FLAG] VARCHAR(100) NULL,
    [TRANSACTION_TYPE] VARCHAR(100) NULL,
    [PURPOSE] VARCHAR(200) NULL,
    [ORDFLAG] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(300) NULL,
    [L_ADDRESS2] VARCHAR(300) NULL,
    [L_ADDRESS3] VARCHAR(300) NULL,
    [L_CITY] VARCHAR(300) NULL,
    [L_STATE] VARCHAR(300) NULL,
    [L_ZIP] VARCHAR(300) NULL,
    [FAMILY] VARCHAR(50) NULL,
    [BRANCH_CD] VARCHAR(100) NULL,
    [SUB_BROKER] VARCHAR(100) NULL,
    [GST_NO] VARCHAR(100) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(500) NULL,
    [PEND_OBL_ASONDATE] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ROS_DATA_NEWTEST_2021TO2023BKP
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ROS_DATA_NEWTEST_2021TO2023BKP]
(
    [TRANSDATE] VARCHAR(30) NULL,
    [EXE_DATE] VARCHAR(30) NULL,
    [EXCHANGE] VARCHAR(30) NULL,
    [SEGMENT_TYPE] VARCHAR(30) NULL,
    [UCC_CODE] VARCHAR(50) NULL,
    [PARTY_CODE] VARCHAR(50) NULL,
    [CLIENT_NAME] VARCHAR(200) NULL,
    [CLIENT_PAN] VARCHAR(50) NULL,
    [MEMBER_DEMAT_ACC_9A] VARCHAR(100) NULL,
    [MEMBER_DEMAT_ACC_9B] VARCHAR(100) NULL,
    [COUNTERPARTY_DEMAT_ACC_10A] VARCHAR(100) NULL,
    [COUNTERPARTY_DEMAT_ACC_10B] VARCHAR(100) NULL,
    [SETT_NO] VARCHAR(100) NULL,
    [ISIN] VARCHAR(100) NULL,
    [SCRIP_NAME] VARCHAR(200) NULL,
    [QTY_DELIVERED] BIGINT NULL,
    [QTY_RECEIVED] BIGINT NULL,
    [BALANCE_QTY] BIGINT NULL,
    [TRF_REF_NO] VARCHAR(100) NULL,
    [POA_FLAG] VARCHAR(100) NULL,
    [TRANSACTION_TYPE] VARCHAR(100) NULL,
    [PURPOSE] VARCHAR(200) NULL,
    [ORDFLAG] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(300) NULL,
    [L_ADDRESS2] VARCHAR(300) NULL,
    [L_ADDRESS3] VARCHAR(300) NULL,
    [L_CITY] VARCHAR(300) NULL,
    [L_STATE] VARCHAR(300) NULL,
    [L_ZIP] VARCHAR(300) NULL,
    [FAMILY] VARCHAR(50) NULL,
    [BRANCH_CD] VARCHAR(100) NULL,
    [SUB_BROKER] VARCHAR(100) NULL,
    [GST_NO] VARCHAR(100) NULL,
    [GST_LOCATION] VARCHAR(100) NULL,
    [PDFFILENAME] VARCHAR(500) NULL,
    [PEND_OBL_ASONDATE] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_03APR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_03APR2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP_08JAN2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP_08JAN2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_SEBI_PAYOUT_CCE_REPORTING_BKP_11072023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_SEBI_PAYOUT_CCE_REPORTING_BKP_11072023]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP08APR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP08APR2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP09AUG2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP09AUG2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP09OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP09OCT2023]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP10AUG2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP10AUG2024]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP10OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP10OCT2023]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SEBI_PAYOUT_CCE_Reporting_BKP11OCT2023
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SEBI_PAYOUT_CCE_Reporting_BKP11OCT2023]
(
    [SNO] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(12) NULL,
    [SCCS_SettDate_Last] DATE NULL,
    [LastUpdatedDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_SLRPT_MASTER
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_SLRPT_MASTER]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [RPTNAME] VARCHAR(30) NULL,
    [SPNAME] VARCHAR(30) NULL,
    [SPPARAM] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_STAMP_DATA_BKUP_03APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_STAMP_DATA_BKUP_03APR2023]
(
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(3) NOT NULL,
    [CONTRACTNO] VARCHAR(14) NULL,
    [TRADE_TYPE] VARCHAR(1) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(10) NOT NULL,
    [SERIES] CHAR(3) NOT NULL,
    [BUYSQQTY] INT NULL,
    [SELLSQQTY] INT NULL,
    [BUYDELQTY] INT NULL,
    [SELLDELQTY] INT NULL,
    [BUYAVGRATE] NUMERIC(38, 2) NULL,
    [SELLAVGRATE] NUMERIC(38, 2) NULL,
    [BUYSQSTAMP] NUMERIC(38, 2) NULL,
    [SELLSQSTAMP] NUMERIC(38, 2) NULL,
    [BUYDELSTAMP] NUMERIC(38, 2) NULL,
    [SELLDELSTAMP] NUMERIC(38, 2) NULL,
    [TOTALSTAMP] NUMERIC(38, 2) NULL,
    [L_STATE] VARCHAR(100) NULL,
    [LASTRUNDATE] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_STT_SCRIP_BKP_20220324
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_STT_SCRIP_BKP_20220324]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [SCRIP_CD] VARCHAR(15) NULL,
    [DATEFROM] DATETIME NULL,
    [DATETO] DATETIME NULL,
    [ADDEDBY] VARCHAR(50) NULL,
    [ADDEDON] DATETIME NULL,
    [MODIFIEDBY] VARCHAR(50) NULL,
    [MODIFIEDON] DATETIME NULL,
    [SERIES] VARCHAR(3) NULL,
    [CHARGE_FLAG] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_TDS_UPLOAD_BUYBACK_LEC
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_TDS_UPLOAD_BUYBACK_LEC]
(
    [MEM_ID] INT NULL,
    [TRADER_ID] INT NULL,
    [SCRIPT_CODE] INT NULL,
    [SCRIPT_ID] VARCHAR(100) NULL,
    [Trd_Id] INT NULL,
    [CLIENT_CODE] VARCHAR(50) NULL,
    [BID_QTY] BIGINT NULL,
    [BID_RATE] BIGINT NULL,
    [ACPT_QTY] BIGINT NULL,
    [ACPT_RATE] BIGINT NULL,
    [TDS] NUMERIC(18, 0) NULL,
    [NET_AMT] NUMERIC(18, 0) NULL,
    [STATUS] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_TOT_DETAIL_BKUP_03APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_TOT_DETAIL_BKUP_03APR2023]
(
    [SETT_NO] VARCHAR(7) NOT NULL,
    [SETT_TYPE] VARCHAR(3) NOT NULL,
    [SAUDA_DATE] DATETIME NULL,
    [CONTRACTNO] VARCHAR(14) NULL,
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [SCRIP_CD] VARCHAR(10) NOT NULL,
    [SERIES] CHAR(2) NOT NULL,
    [TURN_TAX] MONEY NULL,
    [CHARGE_PER] NUMERIC(18, 6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_TRADE_#_$_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_TRADE_#_$_DATA]
(
    [SAUDA_DATE] VARCHAR(11) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] VARCHAR(20) NULL,
    [SELL_BUY] VARCHAR(1) NULL,
    [MARKETRATE] VARCHAR(20) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [USER_ID] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_TURNOVER_SLAB_BKUP_01APR2024
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_TURNOVER_SLAB_BKUP_01APR2024]
(
    [FROM_TOT] NUMERIC(18, 4) NULL,
    [TO_TOT] NUMERIC(18, 4) NULL,
    [CHARGE_PER] NUMERIC(18, 6) NULL,
    [FROMDATE] DATETIME NULL,
    [TODATE] DATETIME NULL,
    [CHARGE_TYPE] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_TURNOVER_SLAB_BKUP_03APR2023
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_TURNOVER_SLAB_BKUP_03APR2023]
(
    [FROM_TOT] NUMERIC(18, 4) NULL,
    [TO_TOT] NUMERIC(18, 4) NULL,
    [CHARGE_PER] NUMERIC(18, 6) NULL,
    [FROMDATE] DATETIME NULL,
    [TODATE] DATETIME NULL,
    [CHARGE_TYPE] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_VoucherDelete
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_VoucherDelete]
(
    [VNO] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbladmin_BKP_04052023
-- --------------------------------------------------
CREATE TABLE [dbo].[tbladmin_BKP_04052023]
(
    [fldauto_admin] INT IDENTITY(1,1) NOT NULL,
    [fldname] VARCHAR(30) NOT NULL,
    [fldpassword] VARCHAR(30) NOT NULL,
    [fldcompany] VARCHAR(50) NULL,
    [fldstname] VARCHAR(50) NULL,
    [fldstatus] VARCHAR(25) NOT NULL,
    [flddesc] VARCHAR(100) NULL,
    [FLDATTEMPTCNT] SMALLINT NULL,
    [Pwd_Expiry_Date] DATETIME NULL,
    [FLDMAXATTEMPT] SMALLINT NULL,
    [FLDUSERSTATUS] SMALLINT NULL,
    [FLDACCESSLVL] CHAR(1) NULL,
    [FLDIPADD] VARCHAR(2000) NULL,
    [FLDFIRSTLOGIN] CHAR(1) NULL,
    [FLDROLE] SMALLINT NULL,
    [FLDRIGHTS] SMALLINT NULL,
    [EDIT_FLAG] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblcatmenu_23Jun2023
-- --------------------------------------------------
CREATE TABLE [dbo].[tblcatmenu_23Jun2023]
(
    [fldauto] INT IDENTITY(1,1) NOT NULL,
    [fldreportcode] INT NOT NULL,
    [fldadminauto] INT NOT NULL,
    [fldcategorycode] VARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblPradnyausers_T0_Series_data
-- --------------------------------------------------
CREATE TABLE [dbo].[tblPradnyausers_T0_Series_data]
(
    [fldauto] INT IDENTITY(1,1) NOT NULL,
    [fldusername] VARCHAR(25) NULL,
    [fldpassword] VARCHAR(15) NULL,
    [fldfirstname] VARCHAR(25) NULL,
    [fldmiddlename] VARCHAR(25) NULL,
    [fldlastname] VARCHAR(25) NULL,
    [fldsex] VARCHAR(8) NULL,
    [fldaddress1] VARCHAR(40) NULL,
    [fldaddress2] VARCHAR(40) NULL,
    [fldphone1] VARCHAR(10) NULL,
    [fldphone2] VARCHAR(10) NULL,
    [fldcategory] VARCHAR(10) NOT NULL,
    [fldadminauto] INT NOT NULL,
    [fldstname] VARCHAR(50) NULL,
    [PWD_EXPIRY_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblPub
-- --------------------------------------------------
CREATE TABLE [dbo].[tblPub]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [FirstName] VARCHAR(50) NULL,
    [UpdatedOn] DATETIME NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblPub_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tblPub_1]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [FullName] VARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblPublisher
-- --------------------------------------------------
CREATE TABLE [dbo].[tblPublisher]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [FirstName] VARCHAR(50) NULL,
    [LastName] VARCHAR(50) NULL,
    [UpdatedOn] DATETIME NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblreports_BKP_19FEB2023
-- --------------------------------------------------
CREATE TABLE [dbo].[tblreports_BKP_19FEB2023]
(
    [fldreportcode] INT IDENTITY(1,1) NOT NULL,
    [fldreportname] VARCHAR(40) NULL,
    [fldpath] VARCHAR(100) NULL,
    [fldtarget] VARCHAR(25) NULL,
    [flddesc] VARCHAR(80) NULL,
    [fldreportgrp] VARCHAR(10) NULL,
    [fldmenugrp] VARCHAR(3) NULL,
    [fldstatus] VARCHAR(20) NULL,
    [fldorder] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBLSCRIPMARGIN_BKP_20221221_SRTRANSFIN_TO_SHRIRAMFIN
-- --------------------------------------------------
CREATE TABLE [dbo].[TBLSCRIPMARGIN_BKP_20221221_SRTRANSFIN_TO_SHRIRAMFIN]
(
    [scrip_cd] VARCHAR(12) NULL,
    [from_date] DATETIME NULL,
    [to_date] DATETIME NULL,
    [entered_by] VARCHAR(50) NULL,
    [entered_date] DATETIME NOT NULL,
    [Series] VARCHAR(3) NULL,
    [BseCode] VARCHAR(50) NULL,
    [ISIN] VARCHAR(20) NULL,
    [Scrip_Group] VARCHAR(2) NULL,
    [FUND_PER] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblusercontrolmaster_BKP_02MAY2024
-- --------------------------------------------------
CREATE TABLE [dbo].[tblusercontrolmaster_BKP_02MAY2024]
(
    [FLDAUTO] BIGINT NOT NULL,
    [FLDUSERID] INT NULL,
    [FLDPWDEXPIRY] INT NULL,
    [FLDMAXATTEMPT] SMALLINT NULL,
    [FLDATTEMPTCNT] SMALLINT NULL,
    [FLDSTATUS] SMALLINT NULL,
    [FLDLOGINFLAG] SMALLINT NULL,
    [FLDACCESSLVL] CHAR(1) NULL,
    [FLDIPADD] VARCHAR(2000) NULL,
    [FLDTIMEOUT] SMALLINT NULL,
    [FLDFIRSTLOGIN] CHAR(1) NULL,
    [FLDFORCELOGOUT] SMALLINT NULL,
    [FLD_MAC_ID] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_b2c
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_b2c]
(
    [party_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_dp
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_dp]
(
    [cltcode] VARCHAR(10) NULL,
    [cltdpno] VARCHAR(16) NULL,
    [dpid] VARCHAR(8) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_penalty
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_penalty]
(
    [party_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_sauda
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_sauda]
(
    [party_code] VARCHAR(12) NULL,
    [sno] VARCHAR(5) NULL,
    [Data_text] VARCHAR(MAX) NULL,
    [SRNO] INT NULL,
    [EXCHANGE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(11) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [OD_TIME] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_schme_party
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_schme_party]
(
    [party_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_sebi
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_sebi]
(
    [partycode] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_22072025
-- --------------------------------------------------
CREATE TABLE [dbo].[test_22072025]
(
    [VTYP] SMALLINT NOT NULL,
    [VNO] VARCHAR(12) NOT NULL,
    [EDT] DATETIME NULL,
    [LNO] INT NOT NULL,
    [ACNAME] VARCHAR(100) NULL,
    [DRCR] CHAR(1) NOT NULL,
    [VAMT] MONEY NULL,
    [VDT] DATETIME NOT NULL,
    [VNO1] VARCHAR(12) NULL,
    [REFNO] CHAR(12) NULL,
    [BALAMT] MONEY NOT NULL,
    [NODAYS] INT NULL,
    [CDT] DATETIME NULL,
    [CLTCODE] VARCHAR(10) NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [ENTEREDBY] VARCHAR(25) NULL,
    [PDT] DATETIME NULL,
    [CHECKEDBY] VARCHAR(25) NULL,
    [ACTNODAYS] INT NULL,
    [NARRATION] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_25Jul2025
-- --------------------------------------------------
CREATE TABLE [dbo].[test_25Jul2025]
(
    [exchange] VARCHAR(50) NULL,
    [segment] VARCHAR(50) NULL,
    [client_code] VARCHAR(50) NULL,
    [net_payable_modernized] VARCHAR(50) NULL,
    [net_payable_backoffice] VARCHAR(50) NULL,
    [JV] MONEY NULL,
    [payin] MONEY NULL,
    [remark] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_repl_nosync
-- --------------------------------------------------
CREATE TABLE [dbo].[test_repl_nosync]
(
    [id] INT NOT NULL,
    [name] VARCHAR(100) NULL,
    [currentdate] DATETIME NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.TEST0077
-- --------------------------------------------------
CREATE TABLE [dbo].[TEST0077]
(
    [CODE] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Trade_info
-- --------------------------------------------------
CREATE TABLE [dbo].[Trade_info]
(
    [Cltcode] VARCHAR(10) NOT NULL,
    [vtyp] SMALLINT NOT NULL,
    [vdt] DATETIME NULL,
    [vamt] MONEY NULL,
    [exchange] VARCHAR(5) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.trade_siva
-- --------------------------------------------------
CREATE TABLE [dbo].[trade_siva]
(
    [SRNO] BIGINT IDENTITY(1,1) NOT NULL,
    [CONTRACTNO] VARCHAR(10) NULL,
    [CONTRACTNO_NEW] VARCHAR(10) NULL,
    [SAUDA_DATE] DATETIME NULL,
    [SETT_NO] VARCHAR(10) NULL,
    [SETT_TYPE] VARCHAR(3) NULL,
    [SETT_DATE] VARCHAR(11) NULL,
    [EXCHANGE] VARCHAR(3) NULL,
    [SEGMENT] VARCHAR(10) NULL,
    [ORDER_NO] VARCHAR(20) NULL,
    [ORDER_TIME] VARCHAR(8) NULL,
    [TRADE_NO] VARCHAR(20) NULL,
    [TRADE_TIME] VARCHAR(8) NULL,
    [SCRIPNAME] VARCHAR(100) NULL,
    [QTY] BIGINT NULL,
    [TMARK] VARCHAR(1) NULL,
    [SELL_BUY] VARCHAR(1) NULL,
    [MARKETRATE] MONEY NULL,
    [MARKETAMT] MONEY NULL,
    [BROKERAGE] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [INS_CHRG] MONEY NULL,
    [NETAMOUNT] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [BROKER_CHRG] MONEY NULL,
    [OTHER_CHRG] MONEY NULL,
    [NETAMOUNTALL] MONEY NULL,
    [BROK] MONEY NULL,
    [NETRATE] MONEY NULL,
    [CL_RATE] MONEY NULL,
    [BROKERSEBIREGNO] VARCHAR(20) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [CINNO] VARCHAR(100) NULL,
    [SETTTYPE_DESC] VARCHAR(35) NULL,
    [BFCF_FLAG] VARCHAR(6) NULL,
    [CONTRACT_HEADER_DET] VARCHAR(200) NULL,
    [REMARK] VARCHAR(100) NULL,
    [COMPANYNAME] VARCHAR(100) NULL,
    [USER_ID] VARCHAR(20) NULL,
    [REMARK_ID] VARCHAR(1) NULL,
    [REMARK_DESC] VARCHAR(200) NULL,
    [NETOBLIGATION] MONEY NULL,
    [BRANCH_CD] VARCHAR(15) NULL,
    [SUB_BROKER] VARCHAR(15) NULL,
    [TRADER] VARCHAR(25) NULL,
    [AREA] VARCHAR(25) NULL,
    [REGION] VARCHAR(25) NULL,
    [FAMILY] VARCHAR(15) NULL,
    [PARTY_CODE] VARCHAR(15) NULL,
    [PARTYNAME] VARCHAR(100) NULL,
    [L_ADDRESS1] VARCHAR(100) NULL,
    [L_ADDRESS2] VARCHAR(100) NULL,
    [L_ADDRESS3] VARCHAR(100) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_CITY] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [OFF_PHONE1] VARCHAR(50) NULL,
    [OFF_PHONE2] VARCHAR(50) NULL,
    [PAN_GIR_NO] VARCHAR(15) NULL,
    [MAPIDID] VARCHAR(20) NULL,
    [UCC_CODE] VARCHAR(20) NULL,
    [SEBI_NO] VARCHAR(25) NULL,
    [PARTICIPANT_CODE] VARCHAR(16) NULL,
    [CL_TYPE] VARCHAR(3) NULL,
    [SERVICE_CHRG] TINYINT NULL,
    [PRINTF] TINYINT NULL,
    [PRICEUNIT] VARCHAR(20) NULL,
    [QTY_UNIT] VARCHAR(20) NULL,
    [ISIN] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Unclaimed Unsettled Client Funds-31st-Mar-2023
-- --------------------------------------------------
CREATE TABLE [dbo].[Unclaimed Unsettled Client Funds-31st-Mar-2023]
(
    [UNIQUE CLIENT CODE] VARCHAR(50) NULL,
    [Unclaimed Unsettled Client Funds] VARCHAR(50) NULL,
    [Client Bank Account No] VARCHAR(50) NULL,
    [LAST SETTLEMENT DATELAST SETTLEMENT DATE] VARCHAR(50) NULL,
    [LSTSTDT] DATETIME NULL,
    [SRNO] INT NULL,
    [ACTDATE] VARCHAR(10) NULL,
    [NETBAL] NUMERIC(18, 2) NULL,
    [NETBALMTF] NUMERIC(18, 2) NULL,
    [LSTSTDTNEW] DATETIME NULL,
    [LASTAMT] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UNMATCHED_17052022
-- --------------------------------------------------
CREATE TABLE [dbo].[UNMATCHED_17052022]
(
    [ROWID] INT NULL,
    [FILEUPLOADID] NVARCHAR(50) NULL,
    [UPLOADDATE] DATETIME2 NULL,
    [EDATE] DATETIME2 NULL,
    [VALUEDATE] DATETIME2 NULL,
    [MATCHEDDATE] DATETIME2 NULL,
    [SEGMENT] NVARCHAR(50) NULL,
    [BANK] NVARCHAR(50) NULL,
    [ARRANGEMENTTYPE] NVARCHAR(50) NULL,
    [BANKCODE] SMALLINT NULL,
    [BANKACCOUNT] BIGINT NULL,
    [ACCOUNTNO] NVARCHAR(1) NULL,
    [NARRATION] NVARCHAR(100) NULL,
    [CHEQUENO] BIGINT NULL,
    [DRCR] NVARCHAR(50) NULL,
    [BANKSTATEMENTAMOUNT] TINYINT NULL,
    [VOUCHERAMOUNT] INT NULL,
    [keyyy] BIGINT NULL,
    [vno] BIGINT NULL,
    [CLIENTCODE] INT NULL,
    [CLIENTNAME] TINYINT NULL,
    [STATUS] NVARCHAR(1) NULL,
    [CROSSREFNO] BIGINT NULL,
    [VOUCHERNO] NVARCHAR(1) NULL,
    [MATCHEDBY] NVARCHAR(1) NULL,
    [VOUCHERDATE] DATETIME2 NULL,
    [DEPOSITDATE] DATETIME2 NULL,
    [MATCHEDFLAG] NVARCHAR(50) NULL,
    [VNO2] NVARCHAR(1) NULL,
    [VTYP] TINYINT NULL,
    [BOOKTYPE] NVARCHAR(1) NULL,
    [TRAN_STATUS] NVARCHAR(50) NULL,
    [REPORT_FLAG] NVARCHAR(1) NULL,
    [UPLOADFILENAME] NVARCHAR(50) NULL,
    [UPLOADSTATUS] NVARCHAR(50) NULL,
    [FILEUPLOAD_SDATE] DATETIME2 NULL,
    [FILEUPLOAD_EDATE] DATETIME2 NULL,
    [USERNAME] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.V2_Business_Process_2025037
-- --------------------------------------------------
CREATE TABLE [dbo].[V2_Business_Process_2025037]
(
    [Business_Date] SMALLDATETIME NULL,
    [Sett_Type] VARCHAR(2) NOT NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Import_Trade] INT NULL,
    [Billing] INT NULL,
    [VBB] INT NULL,
    [STT] INT NULL,
    [Valan] INT NULL,
    [Contract] INT NULL,
    [Posting] INT NULL,
    [Open_Close] INT NULL,
    [ProcessDate] DATETIME NULL,
    [ProcessBy] VARCHAR(20) NULL,
    [LastUpdateDate] DATETIME NULL,
    [LastUpdateBy] VARCHAR(20) NULL,
    [MachineIP] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.V2_Business_Process_2026023
-- --------------------------------------------------
CREATE TABLE [dbo].[V2_Business_Process_2026023]
(
    [Business_Date] SMALLDATETIME NULL,
    [Sett_Type] VARCHAR(2) NOT NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Import_Trade] INT NULL,
    [Billing] INT NULL,
    [VBB] INT NULL,
    [STT] INT NULL,
    [Valan] INT NULL,
    [Contract] INT NULL,
    [Posting] INT NULL,
    [Open_Close] INT NULL,
    [ProcessDate] DATETIME NULL,
    [ProcessBy] VARCHAR(20) NULL,
    [LastUpdateDate] DATETIME NULL,
    [LastUpdateBy] VARCHAR(20) NULL,
    [MachineIP] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.V2_Business_Process_bkp_12092023
-- --------------------------------------------------
CREATE TABLE [dbo].[V2_Business_Process_bkp_12092023]
(
    [Business_Date] SMALLDATETIME NULL,
    [Sett_Type] VARCHAR(2) NOT NULL,
    [Sett_No] VARCHAR(7) NOT NULL,
    [Import_Trade] INT NULL,
    [Billing] INT NULL,
    [VBB] INT NULL,
    [STT] INT NULL,
    [Valan] INT NULL,
    [Contract] INT NULL,
    [Posting] INT NULL,
    [Open_Close] INT NULL,
    [ProcessDate] DATETIME NULL,
    [ProcessBy] VARCHAR(20) NULL,
    [LastUpdateDate] DATETIME NULL,
    [LastUpdateBy] VARCHAR(20) NULL,
    [MachineIP] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.V2_Contract_Digital_DATA_BKP_20221206
-- --------------------------------------------------
CREATE TABLE [dbo].[V2_Contract_Digital_DATA_BKP_20221206]
(
    [C_SR_NO] NUMERIC(10, 0) IDENTITY(1,1) NOT NULL,
    [C_TEXT] VARCHAR(2000) NULL,
    [C_Type] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.V2_Process_Status_Log_bkp26122023
-- --------------------------------------------------
CREATE TABLE [dbo].[V2_Process_Status_Log_bkp26122023]
(
    [SNO] NUMERIC(10, 0) IDENTITY(1,1) NOT NULL,
    [Exchange] VARCHAR(3) NULL,
    [Segment] VARCHAR(20) NULL,
    [BusinessDate] SMALLDATETIME NULL,
    [Sett_No] VARCHAR(7) NULL,
    [Sett_Type] VARCHAR(2) NULL,
    [ProcessName] VARCHAR(50) NULL,
    [FileName] VARCHAR(255) NULL,
    [Start_End_Flag] INT NULL,
    [ProcessDate] DATETIME NULL,
    [ProcessBy] VARCHAR(64) NULL,
    [MachineIP] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VIRTUAL_MIS_LEDGER_LOG
-- --------------------------------------------------
CREATE TABLE [dbo].[VIRTUAL_MIS_LEDGER_LOG]
(
    [FILE_DATA] VARCHAR(MAX) NULL,
    [SRNO] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VIRTUAL_MIS_LEDGER_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[VIRTUAL_MIS_LEDGER_temp]
(
    [Business_Date] VARCHAR(100) NULL,
    [VA_Number] VARCHAR(100) NULL,
    [Channel] VARCHAR(100) NULL,
    [Transaction_Amount] VARCHAR(100) NULL,
    [Transaction_Details1] VARCHAR(100) NULL,
    [Transaction_Details2] VARCHAR(100) NULL,
    [Transaction_Details3] VARCHAR(100) NULL,
    [Transaction_Details4] VARCHAR(100) NULL,
    [Transaction_Details5] VARCHAR(100) NULL,
    [Transaction_Details6] VARCHAR(100) NULL,
    [Transaction_Details7] VARCHAR(100) NULL,
    [Transaction_Details8] VARCHAR(100) NULL,
    [Transaction_Details9] VARCHAR(100) NULL,
    [Transaction_Details10] VARCHAR(100) NULL,
    [Transaction_Details11] VARCHAR(100) NULL,
    [Transaction_Details12] VARCHAR(100) NULL,
    [Transaction_Details13] VARCHAR(100) NULL,
    [Transaction_Details14] VARCHAR(100) NULL,
    [Transaction_Details15] VARCHAR(100) NULL,
    [Transaction_Details16] VARCHAR(100) NULL,
    [Transaction_Details17] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.WEEKLY_CASH_BALANCES_SETTING_BKUP_05JUL2023
-- --------------------------------------------------
CREATE TABLE [dbo].[WEEKLY_CASH_BALANCES_SETTING_BKUP_05JUL2023]
(
    [MFSS_FLAG] BIT NULL,
    [MARGIN_FLAG] BIT NULL,
    [PARENT_FLAG] BIT NULL,
    [FILEPATH] VARCHAR(100) NULL,
    [CLIENT_BANK_ACC] VARCHAR(18) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.WRGCRDR_28012011
-- --------------------------------------------------
CREATE TABLE [dbo].[WRGCRDR_28012011]
(
    [VNO] VARCHAR(12) NOT NULL,
    [VTYP] SMALLINT NOT NULL,
    [BOOKTYPE] VARCHAR(3) NOT NULL,
    [LED] MONEY NULL,
    [LED2] MONEY NULL
);

GO

-- --------------------------------------------------
-- VIEW dbo.VW_LEDGER_BILL
-- --------------------------------------------------

CREATE VIEW VW_LEDGER_BILL  
  
AS  
  
SELECT CONVERT(DATE,GETDATE()-3) AS 'BILL_DATE' ,CLTCODE,EXCHANGE, AMT= SUM(CASE WHEN DRCR ='D' THEN VAMT ELSE VAMT*-1 END)  
FROM ACCOUNT.DBO.LEDGER_ALL WHERE VDT =CONVERT(DATE,GETDATE()-3) AND VTYP='15'  
GROUP BY CLTCODE,EXCHANGE

GO


-- DDL Export
-- Server: 10.253.33.233
-- Database: INHOUSE
-- Exported: 2026-02-05T12:29:37.909472

USE INHOUSE;
GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_diagramobjects
-- --------------------------------------------------

	CREATE FUNCTION dbo.fn_diagramobjects() 
	RETURNS int
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		declare @id_upgraddiagrams		int
		declare @id_sysdiagrams			int
		declare @id_helpdiagrams		int
		declare @id_helpdiagramdefinition	int
		declare @id_creatediagram	int
		declare @id_renamediagram	int
		declare @id_alterdiagram 	int 
		declare @id_dropdiagram		int
		declare @InstalledObjects	int

		select @InstalledObjects = 0

		select 	@id_upgraddiagrams = object_id(N'dbo.sp_upgraddiagrams'),
			@id_sysdiagrams = object_id(N'dbo.sysdiagrams'),
			@id_helpdiagrams = object_id(N'dbo.sp_helpdiagrams'),
			@id_helpdiagramdefinition = object_id(N'dbo.sp_helpdiagramdefinition'),
			@id_creatediagram = object_id(N'dbo.sp_creatediagram'),
			@id_renamediagram = object_id(N'dbo.sp_renamediagram'),
			@id_alterdiagram = object_id(N'dbo.sp_alterdiagram'), 
			@id_dropdiagram = object_id(N'dbo.sp_dropdiagram')

		if @id_upgraddiagrams is not null
			select @InstalledObjects = @InstalledObjects + 1
		if @id_sysdiagrams is not null
			select @InstalledObjects = @InstalledObjects + 2
		if @id_helpdiagrams is not null
			select @InstalledObjects = @InstalledObjects + 4
		if @id_helpdiagramdefinition is not null
			select @InstalledObjects = @InstalledObjects + 8
		if @id_creatediagram is not null
			select @InstalledObjects = @InstalledObjects + 16
		if @id_renamediagram is not null
			select @InstalledObjects = @InstalledObjects + 32
		if @id_alterdiagram  is not null
			select @InstalledObjects = @InstalledObjects + 64
		if @id_dropdiagram is not null
			select @InstalledObjects = @InstalledObjects + 128
		
		return @InstalledObjects 
	END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_state_countary_value
-- --------------------------------------------------
CREATE FUNCTION [dbo].[fn_state_countary_value] 
(
	@value varchar(100),
	@option varchar(10)
)
RETURNS varchar(3)
AS
BEGIN
	declare @result as varchar(3)

	if(@option='STATE')
	begin
	set @result=case 
		when @value='Andaman and Nicobar' then '1'
		when @value='Andhra Pradesh' then '2'
		when @value='Arunachal Pradesh' then '3' 
		when @value='Assam' then '4'
		when @value='Bihar' then '5'
		when @value='Chandigarh' then '6'
		when @value='Dadra and Nagar Haveli' then '7'
		when @value='Daman and Diu' then '8'
		when @value='Delhi' then '9'
		when @value='Goa' then '10'
		when @value='Gujarat' then '11'
		when @value='Haryana' then '12'
		when @value='Himachal Pradesh' or @value='HimachalPradesh' then '13'
		when @value='Jammu and Kashmir' then '14'
		when @value='Karnataka' then '15'
		when @value='Kerala' then '16'
		when @value='Lakhswadeep' then '17'
		when @value='Madhya Pradesh' then '18'
		when @value='Maharashtra' then '19'
		when @value='Manipur' then '20'
		when @value='Meghalaya' then '21'
		when @value='Mizoram' then '22'
		when @value='Nagaland' then '23'
		when @value='Orissa' then '24'
		when @value='Pondicherry' then '25'
		when @value='Punjab' then '26'
		when @value='Rajasthan' then '27'
		when @value='Sikkim' then '28'
		when @value='TamilNadu' then '29'
		when @value='Tripura' then '30'
		when @value='Uttar Pradesh' then '31'
		when @value='West Bengal' then '32'
		when @value='Chhattisgarh' then '33'
		when @value='Uttaranchal' or @value='Uttarakhand' then '34'
		when @value='Jharkhand' then '35'
		when @value='Union Territory' then '36'
		when @value='Telangana' then '37'
		when @value='APO' then '98'
		else '99' end
	end

	if(@option='NATION')
	begin
	set @result=case 
		 when @value ='AFGHANISTAN' then 	1
		 when @value ='ALBENIA' then	2
		 when @value ='ALGERIA' then	3
		 when @value ='ANGOLA' then 4
		 when @value ='ARGENTINA' then	5
		 when @value ='ARMENIA' then	6
		 when @value ='ARUBA' then	7
		 when @value ='AUSTRALIA' then	8
		 when @value ='AUSTRIA' then	9
		 when @value ='AZARBAIJAN' then	10
		 when @value ='BAHAMAS' then	11
		 when @value ='BAHRAIN' then	12
		 when @value ='BANGLADESH' then	13
		 when @value ='BARBADOS' then	14
		 when @value ='BELARUS' then	15
		 when @value ='BELGIUM' then	16
		 when @value ='BELIZE' then	17
		 when @value ='BENIN' then	18
		 when @value ='BERMUDA' then	19
		 when @value ='BHUTAN' then	20
		 when @value ='BOLIVIAN' then	21
		 when @value ='BOSNIA-HERZEGOVINA' then	22
		 when @value ='BOTSWANA' then	23
		 when @value ='BRAZIL' then	24
		 when @value ='BRUNEI' then 25
		 when @value ='BULGARIA' then	26
		 when @value ='BURKINA FASO' then	27
		 when @value ='BURUNDI' then	28
		 when @value ='CAMEROON REPUBLIC' then	29
		 when @value ='CANADA' then	30
		 when @value ='CAPE VERDE' then	31
		 when @value ='CAYMAN ISLANDS' then	32
		 when @value ='CENTRAL AFRICAN REPUBLIC' then	33
		 when @value ='CHAD' then 34
		 when @value ='CHILE' then	35
		 when @value ='CHINA' then	36
		 when @value ='COLOMBIA' then	37
		 when @value ='COMBODIA' then	38
		 when @value ='COMOROS' then	39
		 when @value ='CONGO' then	40
		 when @value ='COOK ISLANDS' then	41
		 when @value ='COSTA RICA' then	42
		 when @value ='COTE D IVOIRE' then	43
		 when @value ='CROATIA' then	44
		 when @value ='CUBA' then	45
		 when @value ='CYPRUS' then	46
		 when @value ='CZECH REPUBLIC' then	47
		 when @value ='DENMARK' then	48
		 when @value ='DJIBOUTI' then	49
		 when @value ='DOMINICA' then	50
		 when @value ='DOMINICAN REPUBLIC' then	51
		 when @value ='EAST TIMOR' then	52
		 when @value ='ECUADOR' then	53
		 when @value ='EGYPT' then	54
		 when @value ='EL SALVADOR' then	55
		 when @value ='EQUATORIAL GUINEA' then	56
		 when @value ='ESTONIA' then	57
		 when @value ='ETHIOPIA' then	58
		 when @value ='FALKLAND ISLANDS' then	59
		 when @value ='FIJI' then	60
		 when @value ='FINLAND' then	61
		 when @value ='FRANCE' then	62
		 when @value ='FRENCH GUIANA' then	63
		 when @value ='FRENCH POLYNESIA' then	64
		 when @value ='GABON' then	65
		 when @value ='GAMBIA' then	66
		 when @value ='GEORGIA' then	67
		 when @value ='GERMANY' then	68
		 when @value ='GHANA' then	69
		 when @value ='GIBRALTOR' then	70
		 when @value ='GREECE' then 71
		 when @value ='GREENLAND' then	72
		 when @value ='GRENADA' then	73
		 when @value ='GUADELOUPE' then	74
		 when @value ='GUAM' then	75
		 when @value ='GUATEMALA' then	76
		 when @value ='GUERNSEY' then	77
		 when @value ='GUINEA' then	78
		 when @value ='GUINEA-BISSAU' then	79
		 when @value ='GUYANA' then	80
		 when @value ='HAITI' then	81
		 when @value ='HONDURAS' then	82
		 when @value ='HONGKONG' then	83
		 when @value ='ICELAND' then	84
		 when @value ='INDIA' then	85
		 when @value ='INDONESIA' then	86
		 when @value ='IRAN' then	87
		 when @value ='IRAQ' then	88
		 when @value ='IRELAND' then	89
		 when @value ='ISRAEL' then	90
		 when @value ='ITALY' then	91
		 when @value ='JAMAICA' then	92
		 when @value ='JAPAN' then	93
		 when @value ='JORDAN' then 94
		 when @value ='KAZAKSTAN' then	95
		 when @value ='KENYA' then	96
		 when @value ='KUWAIT' then	97
		 when @value ='KYRGYZSTAN' then	98
		 when @value ='LAOS' then	99
		 when @value ='LATVIA' then	100
		 when @value ='LEBANON' then	101
		 when @value ='LESOTHO' then	102
		 when @value ='LIBERIA' then	103
		 when @value ='LIBYA' then	104
		 when @value ='LITHUANIA' then	105
		 when @value ='LUXEMBOURG' then	106
		 when @value ='MACAU' then	107
		 when @value ='MACEDONIA' then	108
		 when @value ='MADAGASCAR' then	109
		 when @value ='MALAWI' then	110
		 when @value ='MALAYSIA' then	111
		 when @value ='MALDIVES' then	112
		 when @value ='MALI' then	113
		 when @value ='MALTA' then	114
		 when @value ='MAURITANIA' then	115
		 when @value ='MAURITIUS' then	116
		 when @value ='MEXICO' then	117
		 when @value ='MOLDOVA' then	118
		 when @value ='MONETARY AUTHORITIES' then 119
		 when @value ='MONGOLIA' then	120
		 when @value ='MONTSERRAT' then	121
		 when @value ='MOROCCA' then	122
		 when @value ='MOZAMBIQUE' then	123
		 when @value ='MYANMAR' then	124
		 when @value ='NAMIBIA' then	125
		 when @value ='NEPAL' then	126
		 when @value ='NETHERLANDS' then	127
		 when @value ='NETHERLANDS ANTILLES' then	128
		 when @value ='NEW CALEDONIA' then	129
		 when @value ='NEW ZEALAND' then	130
		 when @value ='NICARAGUA' then	131
		 when @value ='NIGER' then	132
		 when @value ='NIGERIA' then	133
		 when @value ='NO SPECIFIC COUNTRY' then	134
		 when @value ='NORTH KOREA' then	135
		 when @value ='NORWAY' then	136
		 when @value ='OMAN' then	137
		 when @value ='PAKISTAN' then	138
		 when @value ='PANAMA' then	139
		 when @value ='PAPUA NEW GUINEA' then	140
		 when @value ='PARAGUAY' then	141
		 when @value ='PERU' then	142
		 when @value ='PHILIPPINES' then	143
		 when @value ='POLAND' then	144
		 when @value ='PORTUGAL' then	145
		 when @value ='QATAR' then	146
		 when @value ='ROMANIA' then	147
		 when @value ='RUSSIA' then	148
		 when @value ='RWANDA' then	149
		 when @value ='SAN TOME AND PRINCIPE' then	150
		 when @value ='SAUDI ARABIA' then	151
		 when @value ='SENEGAL' then	152
		 when @value ='SEYCHELLES' then	153
		 when @value ='SINGAPORE' then	154
		 when @value ='SLOVAKIA' then	155
		 when @value ='SLOVENIA' then	156
		 when @value ='SOLOMON ISLANDS' then	157
		 when @value ='SOMALIA' then	158
		 when @value ='SOUTH AFRICA' then	159
		 when @value ='SOUTH KOREA' then	160
		 when @value ='SPAIN' then	161
		 when @value ='SRI LANKA' then	162
		 when @value ='ST. HELENA' then	163
		 when @value ='ST. KITTS AND NEVIS' then	164
		 when @value ='ST. VINCENT AND GRENADINES' then	165
		 when @value ='ST.LUCIA' then	166
		 when @value ='SUDAN' then	167
		 when @value ='SURINAME' then	168
		 when @value ='SWAZILAND' then	169
		 when @value ='SWEDEN' then	170
		 when @value ='SWITZERLAND' then	171
		 when @value ='SYRIA' then	172
		 when @value ='TAIWAN' then	173
		 when @value ='AJIKISTHAN' then	174
		 when @value ='TANZANIA' then	175
		 when @value ='THAILAND' then	176
		 when @value ='TOGO REPUBLIC' then	177
		 when @value ='TOKYO' then	178
		 when @value ='TONGA' then	179
		 when @value ='TRINIDAD AND TOBAGO' then	180
		 when @value ='TUNISIA' then	181
		 when @value ='TURKEY' then	182
		 when @value ='TURKMENISTAN' then	183
		 when @value ='U A E' then	184
		 when @value ='UGANDA' then	185
		 when @value ='UNITED ARAB EMIRATES' then	186
		 when @value ='UNITED KINGDOM' then	187
		 when @value ='URUGUAY' then	188
		 when @value ='USA' then	189
		 when @value ='VANUATU' then	190
		 when @value ='VENEZUELA' then	191
		 when @value ='VIETNAM' then	192
		 when @value ='WEST AFRICA' then	193
		 when @value ='WESTERN SAMOA' then 194
		 when @value ='YEMEN' then	195
		 when @value ='YUGOSLAVIAN' then	196
		 when @value ='ZAIRE' then	197
		 when @value ='ZAMBIA' then	198
		 when @value ='ZIMBABWE' then	199
		 when @value ='ALAND ISLANDS' then	200
		 when @value ='AMERICAN SAMOA' then	201
		 when @value ='ANDORRA' then	202
		 when @value ='ANGUILLA' then	203
		 when @value ='ANTARCTICA' then	204
		 when @value ='ANTIGUA AND BARBUDA' then	205
		 when @value ='BOUVET ISLAND' then	206
		 when @value ='BRITISH INDIAN OCEAN TERRITORY' then	207
		 when @value ='CAMBODIA' then	208
		 when @value ='CHRISTMAS ISLAND' then	209
		 when @value ='COCOS (KEELING) ISLANDS' then	210
		 when @value ='CONGO, THE DEMOCRATIC REPUBLIC OF THE' then	211
		 when @value ='ERITREA' then	212
		 when @value ='FAROE ISLANDS' then	213
		 when @value ='FRENCH SOUTHERN TERRITORIES' then	214
		 when @value ='HEARD ISLAND AND MCDONALD ISLANDS' then	215
		 when @value ='HOLY SEE (VATICAN CITY STATE)' then	216
		 when @value ='HUNGARY' then	217
		 when @value ='ISLE OF MAN' then	218
		 when @value ='JERSEY' then	219
		 when @value ='KIRIBATI' then	220
		 when @value ='KOREA, DEMOCRATIC PEOPLES REPUBLIC OF' then	221 
		 when @value ='KOREA REPUBLIC OF' then	222
		 when @value ='LIECHTENSTEIN' then 223
		 when @value ='MARSHALL ISLANDS' then	224
		 when @value ='MARTINIQUE' then	225
		 when @value ='MAYOTTE' then	226
		 when @value ='MICRONESIA, FEDERATED STATES OF' then	227
		 when @value ='MONACO' then	228
		 when @value ='NAURU' then	229
		 when @value ='NIUE' then	230
		 when @value ='NORFOLK ISLAND' then	231
		 when @value ='NORTHERN MARIANA ISLANDS' then	232
		 when @value ='PALAU' then	233
		 when @value ='PALESTINIAN TERRITORY, OCCUPIED' then	234
		 when @value ='PITCAIRN' then	235
		 when @value ='PUERTO RICO' then	236
		 when @value ='REUNION' then	237
		 when @value ='SAINT KITTS AND NEVIS' then	238
		 when @value ='SAINT LUCIA' then	239
		 when @value ='SAINT PIERRE AND MIQUELON' then	240
		 when @value ='SAINT VINCENT AND THE GRENADINES' then	241
		 when @value ='SAMOA' then	242
		 when @value ='SAN MARINO' then	243
		 when @value ='SAO TOME AND PRINCIPE' then	244
		 when @value ='SERBIA AND MONTENEGRO' then	245
		 when @value ='SIERRA LEONE' then	246
		 when @value ='SVALBARD AND JAN MAYEN' then	247
		 when @value ='TIMOR-LESTE' then	248
		 when @value ='TOKELAU' then	249
		 when @value ='TURKS AND CAICOS ISLANDS' then	250
		 when @value ='TUVALU' then	251
		 when @value ='UKRAINE' then	252
		 when @value ='UNITED STATES MINOR OUTLYING ISLANDS' then	253
		 when @value ='UZBEKISTAN' then	254
		 when @value ='VIRGIN ISLANDS, BRITISH' then	255
		 when @value ='VIRGIN ISLANDS, U.S.' then 256
		 when @value ='WALLIS AND FUTUNA' then	257
		 when @value ='WESTERN SAHARA' then	258 
		 else '' end
	end
	
	RETURN @result

END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_validate_pan
-- --------------------------------------------------
create function
	[dbo].[fn_validate_pan] ( @pan varchar(10), @value_to_return_if_pan_invalid varchar(20) ) returns varchar(20)
as

/*
	select a = dbo.fn_validate_pan ('xxxx9999x', 'invalid')
	select a = dbo.fn_validate_pan ('xxxx99999', 'invalid')
*/

begin

	declare
		@retval varchar(20)

	set @retval = 
		case
			when
				len(ltrim(rtrim(isnull(@pan, '')))) = 0
			then
				'PAN_EXEMPT'
			when 
				not (
					isnumeric(left(	ltrim(rtrim(isnull(@pan, ''))), 5)) = 0 and 
					isnumeric(substring(	ltrim(rtrim(isnull(@pan, ''))), 6, 4)) = 1 and
					isnumeric(right(ltrim(rtrim(isnull(@pan, ''))), 1)) = 0 and
					len(ltrim(rtrim(isnull(@pan, '')))) = 10
				)
			then
				@value_to_return_if_pan_invalid
			else
				ltrim(rtrim(isnull(@pan, @value_to_return_if_pan_invalid)))
			end

	return(@retval)

end

GO

-- --------------------------------------------------
-- FUNCTION dbo.strip_non_alpha
-- --------------------------------------------------

create

	function [dbo].[strip_non_alpha] (@strInput varchar(8000)) returns varchar(8000)

as

begin
	declare 
		@strRetVal varchar(8000),
		@chrCurrChar char(1),
		@intCounter int,
		@intInputLen int

		set @intInputLen = len(isnull(@strInput, ''))
		set @intCounter = 0

	set @strRetVal = ''

	while (@intCounter <= @intInputLen) begin
		set @intCounter = @intCounter + 1
		set @chrCurrChar = substring(@strInput, @intCounter, 1)

		set @strRetVal = @strRetVal + 
			case 
				when (ascii(@chrCurrChar) between 65 and 90) then @chrCurrChar
				when (ascii(@chrCurrChar) between 97 and 122) then @chrCurrChar
				when (ascii(@chrCurrChar) = 255) then @chrCurrChar
				when (ascii(@chrCurrChar) = 32) then @chrCurrChar
				else ''
			end
	end

	return @strRetVal

end

GO

-- --------------------------------------------------
-- FUNCTION dbo.strip_non_alpha_without_space
-- --------------------------------------------------

create

	function [dbo].[strip_non_alpha_without_space] (@strInput varchar(8000)) returns varchar(8000)

as

begin
	declare 
		@strRetVal varchar(8000),
		@chrCurrChar char(1),
		@intCounter int,
		@intInputLen int

		set @intInputLen = len(ltrim(rtrim(isnull(@strInput, ''))))
		set @intCounter = 0

	set @strRetVal = ''

	while (@intCounter <= @intInputLen) begin
		set @intCounter = @intCounter + 1
		set @chrCurrChar = substring(@strInput, @intCounter, 1)

		set @strRetVal = @strRetVal + 
			case 
				when (ascii(@chrCurrChar) between 65 and 90) then @chrCurrChar
				when (ascii(@chrCurrChar) between 97 and 122) then @chrCurrChar
				when (ascii(@chrCurrChar) = 255) then @chrCurrChar
				when (ascii(@chrCurrChar) = 32) then @chrCurrChar
				else ''
			end
	end

	return @strRetVal

end

GO

-- --------------------------------------------------
-- FUNCTION dbo.strip_non_digit
-- --------------------------------------------------

create

	function [dbo].[strip_non_digit] (@Input varchar(20)) returns varchar(20)

as

begin
	declare 
		@RetVal varchar(20),
		@chrCurrChar char(1),
		@intCounter int,
		@intInputLen int

		set @intInputLen = len(isnull(@Input, ''))
		set @intCounter = 0

	set @RetVal = ''

	while (@intCounter <= @intInputLen) begin
		set @intCounter = @intCounter + 1
		set @chrCurrChar = substring(@Input, @intCounter, 1)

		set @RetVal = @RetVal + 
			case 
				when (ascii(@chrCurrChar) between 48 and 57) then @chrCurrChar
				else ''
			end
	end

	return @RetVal

end

GO

-- --------------------------------------------------
-- INDEX dbo._temp_mcx_client_data_new_temp1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ClusteredIndex-20130301-233826] ON [dbo].[_temp_mcx_client_data_new_temp1] ([SrNo])

GO

-- --------------------------------------------------
-- INDEX dbo.inhousepobank
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ClusteredIndex-20130301-234811] ON [dbo].[inhousepobank] ([BankId])

GO

-- --------------------------------------------------
-- INDEX dbo.mcx_01_03_2013_02_vol1
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NonClusteredIndex-20130301-225035] ON [dbo].[mcx_01_03_2013_02_vol1] ([party_code], [lasttradedate])

GO

-- --------------------------------------------------
-- INDEX dbo.sysdiagrams
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UK_principal_name] ON [dbo].[sysdiagrams] ([principal_id], [name])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.sysdiagrams
-- --------------------------------------------------
ALTER TABLE [dbo].[sysdiagrams] ADD CONSTRAINT [PK__sysdiagr__C2B05B61245D67DE] PRIMARY KEY ([diagram_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.sysdiagrams
-- --------------------------------------------------
ALTER TABLE [dbo].[sysdiagrams] ADD CONSTRAINT [UK_principal_name] UNIQUE ([principal_id], [name])

GO

-- --------------------------------------------------
-- PROCEDURE dbo.angel_Client_Payment_reco_CommCurr
-- --------------------------------------------------
CREATE proc angel_Client_Payment_reco_CommCurr     
as      
    
/*
truncate table Client_Payment_reco_CommCurr    
    
insert into Client_Payment_reco_CommCurr    

select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(ddno,'') ddno, isnull(cltcode ,'') cltcode ,                     
isnull( acname ,'') acname, l.drcr, Dramt=(case when upper(l.drcr) = 'D' then vamt  else 0 end ),                    
Cramt= (case when upper(l.drcr) = 'C' then vamt else 0 end ),                     
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                  
--into #recodet      
From accountmcdxcds.dbo.ledger l  (nolock)  left outer join accountmcdxcds.dbo.LEDGER1 L1  (nolock) on l.vtyp = l1.vtyp and l.booktype = l1.booktype and l.vno = l1.vno and l.lno = l1.lno   where          
cltcode >='A0001' and cltcode <='ZZZZZ' and l.drcr='D'       
--and vdt <=@tdate-@daysbefore       
and clear_mode not in ( 'R', 'C') and l.vtyp  in (3)                    
and reldt ='1900-01-01 00:00:00.000'       
and vdt < getdate()
*/



select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(ddno,'') ddno, isnull(cltcode ,'') cltcode ,                     
isnull( acname ,'') acname, l.drcr, Dramt=(case when upper(l.drcr) = 'D' then vamt  else 0 end ),                    
Cramt= (case when upper(l.drcr) = 'C' then vamt else 0 end ),                     
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()
into #t 
From accountmcdxcds.dbo.ledger l  (nolock)  left outer join accountmcdxcds.dbo.LEDGER1 L1  (nolock) on l.vtyp = l1.vtyp and l.booktype = l1.booktype and l.vno = l1.vno and l.lno = l1.lno   where          
cltcode >='A0001' and cltcode <='ZZZZZ' and l.drcr='D'       
--and vdt <=@tdate-@daysbefore       
and clear_mode not in ( 'R', 'C') and l.vtyp  in (3)                    
and reldt ='1900-01-01 00:00:00.000'       
and vdt < getdate()


truncate table Client_Payment_reco_CommCurr    

insert into Client_Payment_reco_CommCurr     

Select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(l.ddno,'') as ddno, 
isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt,                    
Cramt,                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
from #t L, 
accountmcdxcds.dbo.LEDGER1 L1 (nolock)
where l.vno = l1.vno and l.ddno = l1.ddno and l1.vtyp <> 16

GO

-- --------------------------------------------------
-- PROCEDURE dbo.angel_Client_Payment_reco_mcx
-- --------------------------------------------------
CREATE proc angel_Client_Payment_reco_mcx         
as     
    
    

/*
Select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(ddno,'') ddno, isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt=(case when upper(l.drcr) = 'D' then vamt  else 0 end ),                    
Cramt= (case when upper(l.drcr) = 'C' then vamt else 0 end ),                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
--into #recodet  
into #t                  
From accountmcdx.dbo.ledger l  (nolock)  left outer join accountmcdx.dbo.LEDGER1 L1  (nolock) on l.vtyp = l1.vtyp and l.booktype = l1.booktype and l.vno = l1.vno and l.lno = l1.lno   where            
cltcode >='A0001' and cltcode <='ZZZZZ' and l.drcr='D'         
--and vdt <=@tdate-@daysbefore         
and clear_mode not in ( 'R', 'C') and l.vtyp  in (3)                      
and reldt ='1900-01-01 00:00:00.000'         
and vdt < getdate()
*/

Select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(ddno,'') ddno, isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt=(case when upper(l.drcr) = 'D' then vamt  else 0 end ),                    
Cramt= (case when upper(l.drcr) = 'C' then vamt else 0 end ),                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
--into #recodet  
into #t 
From accountmcdx.dbo.ledger l  (nolock)  left outer join accountmcdx.dbo.LEDGER1 L1  (nolock) 
on l.vtyp = l1.vtyp and l.booktype = l1.booktype and l.vno = l1.vno and l.lno = l1.lno   
where            
cltcode >='A0001' and cltcode <='ZZZZZ' and l.drcr='D'         
--and vdt <=@tdate-@daysbefore         
and clear_mode not in ( 'R', 'C') and l.vtyp  in (3)                      
and reldt ='1900-01-01 00:00:00.000'         
and vdt < getdate()


truncate table Client_Payment_reco_MCX    

insert into Client_Payment_reco_MCX     

Select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(l.ddno,'') as ddno, 
isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt,                    
Cramt,                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
from #t L, 
accountmcdx.dbo.ledger1 L1
where l.vno = l1.vno and l.ddno = l1.ddno and l1.vtyp <> 16

GO

-- --------------------------------------------------
-- PROCEDURE dbo.angel_Client_Payment_reco_ncdx
-- --------------------------------------------------
CREATE proc angel_Client_Payment_reco_ncdx      
as        
/*
truncate table Client_Payment_reco_NCDX    
    
insert into Client_Payment_reco_NCDX
    
select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(ddno,'') ddno, isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt=(case when upper(l.drcr) = 'D' then vamt  else 0 end ),                      
Cramt= (case when upper(l.drcr) = 'C' then vamt else 0 end ),                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
--into #recodet                    
From accountncdx.dbo.ledger l  (nolock)  left outer join accountncdx.dbo.LEDGER1 L1  (nolock) on l.vtyp = l1.vtyp and l.booktype = l1.booktype and l.vno = l1.vno and l.lno = l1.lno   where            
cltcode >='A0001' and cltcode <='ZZZZZ' and l.drcr='D'         
--and vdt <=@tdate-@daysbefore         
and clear_mode not in ( 'R', 'C') and l.vtyp  in (3)                      
and reldt ='1900-01-01 00:00:00.000'         
and vdt < getdate()
*/


select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(ddno,'') ddno, isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt=(case when upper(l.drcr) = 'D' then vamt  else 0 end ),                      
Cramt= (case when upper(l.drcr) = 'C' then vamt else 0 end ),                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
into #t              
From accountncdx.dbo.ledger l  (nolock)  left outer join accountncdx.dbo.LEDGER1 L1  (nolock) on l.vtyp = l1.vtyp and l.booktype = l1.booktype and l.vno = l1.vno and l.lno = l1.lno   where            
cltcode >='A0001' and cltcode <='ZZZZZ' and l.drcr='D'         
--and vdt <=@tdate-@daysbefore         
and clear_mode not in ( 'R', 'C') and l.vtyp  in (3)                      
and reldt ='1900-01-01 00:00:00.000'         
and vdt < getdate()


truncate table Client_Payment_reco_NCDX    

insert into Client_Payment_reco_NCDX     

Select l.vtyp, l.booktype, l.vno, vdt, tdate=convert(varchar,l.vdt,103), isnull(l.ddno,'') as ddno, 
isnull(cltcode ,'') cltcode ,                       
isnull( acname ,'') acname, l.drcr, Dramt,                    
Cramt,                       
treldt=isnull(convert(varchar, reldt , 103),''), l1.refno,last_Date=getdate()                    
from #t L, 
accountncdx.dbo.LEDGER1 L1
where l.vno = l1.vno and l.ddno = l1.ddno and l1.vtyp <> 16

GO

-- --------------------------------------------------
-- PROCEDURE dbo.angel_getledger_cost1_ABLBSEFO
-- --------------------------------------------------
CREATE procedure angel_getledger_cost1_ABLBSEFO(  
@cltcode as varchar(25),  
@fdate as varchar(11),  
@tdate as varchar(11),  
@segment as varchar(11)  
)            
as            
            
set transaction isolation level read uncommitted            
            
set nocount on            
            
          
--Exec angel_getledger_cost1 'A108','Apr 01 2004','Jan 05 2006'            
/*declare @cltcode as varchar(11),@fdate as varchar(11),@tdate as varchar(11)            
set @cltcode='300001'            
set @fdate='Apr 01 2008'            
set @tdate='feb 28 2009'            
 */           
            
select a.*,camt=isnull(b.camt,0),costname=isnull(b.costname,' - ')            
into #abl_cost            
from             
(select * from ledger (nolock) where cltcode=@cltcode and vdt>=@fdate+' 00:00:00' and vdt <=@tdate+' 23:59:59'            
) a left outer join            
(select l2.camt,l2.cltcode,l2.vno,l2.vtype,l2.lno,costname=isnull(costname,'')             
from ledger2 l2             
left outer join costmast cm             
on l2.costcode=cm.costcode) b             
on a.vno=b.vno and a.lno=b.lno and a.vtyp=b.vtype and a.cltcode=b.cltcode            
            
            
select n.vdt,vtyp=isnull(v.ShortDesc,''),n.vno,n.narration as [narration],             
Debit=(case when drcr = 'D' then n.vamt else 0 end),Credit=(case when drcr = 'C' then n.vamt else 0 end),             
balamt=convert(money,0.00),n.camt as [CostAmt],n.CostName,Segment=@segment,n.acname,@cltcode as accountcode,n.lno as [LineNo] from #abl_cost n left outer join             
vmast v on vtyp=vtype            
order by n.vno,n.lno            
    
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.angel_getledger_cost1_MCD
-- --------------------------------------------------

--MCD
--Database:Accountmcdxcds
--Server:Angelfo ANGELCOMMODITY
--Link:Ledger cost-center

CREATE procedure [dbo].[angel_getledger_cost1_MCD](@cltcode as varchar(25),@fdate as varchar(11),@tdate as varchar(11),@segment as varchar(11))        
as        
        
set transaction isolation level read uncommitted        
        
set nocount on        
        
/*        
Exec angel_getledger_cost1 'A108','Apr 01 2004','Jan 05 2006'        
declare @cltcode as varchar(11),@fdate as varchar(11),@tdate as varchar(11),@segment as varchar(11)        
set @cltcode='HN75'        
set @fdate='Apr 01 2010'        
set @tdate='Dec 05 2010'        
set @segment ='MCD'        
        */
select a.*,camt=isnull(b.camt,0),costname=isnull(b.costname,' - ')        
into #abl_cost        
from         
(select * from Accountmcdxcds.dbo.ledger where cltcode=@cltcode and vdt>=@fdate+' 00:00:00' and vdt <=@tdate+' 23:59:59'        
) a left outer join        
(select l2.camt,l2.cltcode,l2.vno,l2.vtype,l2.lno,costname=isnull(costname,'')         
from Accountmcdxcds.dbo.ledger2 l2         
left outer join Accountmcdxcds.dbo.costmast cm         
on l2.costcode=cm.costcode) b         
on a.vno=b.vno and a.lno=b.lno and a.vtyp=b.vtype and a.cltcode=b.cltcode        
        
        
select n.vdt,vtyp=isnull(v.ShortDesc,''),n.vno,n.narration as [narr],         
Debit=(case when drcr = 'D' then n.vamt else 0 end),Credit=(case when drcr = 'C' then n.vamt else 0 end),         
balamt=convert(money,0.00),n.camt,n.costname,Segment=@segment,n.acname,@cltcode as accountcode,n.lno as [LineNo] 
from #abl_cost n left outer join         
Accountmcdxcds.dbo.vmast v on vtyp=vtype        
order by n.vno,n.lno        
        
        
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.angel_getledger_cost2_MCD
-- --------------------------------------------------
-- Segment:MCD 
-- Link:Ledger cost-Alt
--Database: AccountMCDXCDS
--Server:196.1.115.204

CREATE procedure angel_getledger_cost2_MCD(@cltcode as varchar(25),@fdate as varchar(11),@tdate as varchar(11))    
as  
set transaction isolation level read uncommitted    
set nocount on    

/*  
declare @cltcode as varchar(11),@fdate as varchar(11),@tdate as varchar(11)    
set @cltcode='K18997'    
set @fdate='Apr 01 2010'    
set @tdate='jan 21 2011'    
*/
  
set transaction isolation level read uncommitted    
select a.*,camt=isnull(b.camt,0),costname=isnull(b.costname,' - ')    
into #abl_cost_a    
from     
(select * from Accountmcdxcds.dbo.ledger where cltcode=@cltcode and vdt>=@fdate+' 00:00:00' and vdt <=@tdate+' 23:59:59'    
) a left outer join    
(select camt=(case when drcr='D' then l2.camt else -l2.camt end),l2.cltcode,l2.vno,l2.vtype,l2.lno,costname=isnull(costname,'')     
from Accountmcdxcds.dbo.ledger2 l2 (nolock)    
left outer join Accountmcdxcds.dbo.costmast cm (nolock)    
on l2.costcode=cm.costcode) b     
on a.vno=b.vno and a.lno=b.lno and a.vtyp=b.vtype and a.cltcode=b.cltcode    
  
set transaction isolation level read uncommitted  
select cltcode,vno,vtyp,vamt=(case when drcr='D' then vamt else -vamt end),acname  
into #file1  
from Accountmcdxcds.dbo.ledger (nolock)  
where vdt>=@fdate+' 00:00:00' and vdt <=@tdate+' 23:59:59'    
and (cltcode like '28%' or cltcode like '21%' or cltcode like '27%')   
and vno in (select vno from #abl_cost_a) and vtyp<>18  
  
set transaction isolation level read uncommitted  
select a.*,alt_cltcode=isnull(b.cltcode,''),alt_acname=isnull(b.acname,''),alt_vamt=isnull(b.vamt,0)  
into #abl_cost  
from #abl_cost_a a left outer join #file1 b on a.vno=b.vno and a.vtyp=b.vtyp   
  
set transaction isolation level read uncommitted   
select n.vdt,vtyp=isnull(v.ShortDesc,''),n.vno,n.narration as [narr],     
Debit=(case when drcr = 'D' then n.vamt else 0 end),Credit=abs(case when drcr = 'C' then -n.vamt else 0 end),     
balamt=convert(money,0.00),n.camt,n.costname,n.lno,alt_cltcode,alt_acname,alt_vamt  
from #abl_cost n left outer join     
Accountmcdxcds.dbo.vmast v (nolock) on vtyp=vtype    
order by n.vno,n.lno    
    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Angel_updateBlankPswd_mcdxcds
-- --------------------------------------------------
create procedure Angel_updateBlankPswd_mcdxcds
as  
  
update mcdxcds.dbo.tblPradnyausers   
set fldpassword=b.encruppswd from   
(select distinct * from intranet.ctcl.dbo.blank_pswd_2007) b   
where mcdxcds.dbo.tblPradnyausers.fldstname=b.party_code  
  
update mcdxcds.dbo.tblUserControlMaster set FLDFIRSTLOGIN='Y',fldstatus=0,fldattemptcnt=0    
where FLDUSERID in  
(  
Select FLDAUTO from mcdxcds.dbo.tblPradnyausers where fldstname  
in  
(select distinct party_code from intranet.ctcl.dbo.blank_pswd_2007)   
)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.FindslowDiskIoFiles
-- --------------------------------------------------
Create Procedure FindslowDiskIoFiles 
As
Insert into SlowDiskIoFiles 
SELECT DB_NAME(fs.database_id) AS [Database Name], mf.physical_name, io_stall_read_ms, num_of_reads,
CAST(io_stall_read_ms/(1.0 + num_of_reads) AS NUMERIC(10,1)) AS [avg_read_stall_ms],io_stall_write_ms, 
num_of_writes,CAST(io_stall_write_ms/(1.0+num_of_writes) AS NUMERIC(10,1)) AS [avg_write_stall_ms],
io_stall_read_ms + io_stall_write_ms AS [io_stalls], num_of_reads + num_of_writes AS [total_io],
CAST((io_stall_read_ms + io_stall_write_ms)/(1.0 + num_of_reads + num_of_writes) AS NUMERIC(10,1)) 
AS [avg_io_stall_ms],RecordDate = GETDATE()
FROM sys.dm_io_virtual_file_stats(null,null) AS fs
INNER JOIN sys.master_files AS mf
ON fs.database_id = mf.database_id
AND fs.[file_id] = mf.[file_id]
--ORDER BY avg_io_stall_ms DESC OPTION (RECOMPILE);

GO

-- --------------------------------------------------
-- PROCEDURE dbo.LogIops204Insert
-- --------------------------------------------------
Create Procedure LogIops204Insert
As
insert into LogIops204
select db_name(mf.database_id) as database_name, mf.physical_name, 
left(mf.physical_name, 1) as drive_letter, 
vfs.num_of_writes, vfs.num_of_bytes_written, vfs.io_stall_write_ms, 
mf.type_desc, vfs.num_of_reads, vfs.num_of_bytes_read, vfs.io_stall_read_ms,
vfs.io_stall, vfs.size_on_disk_bytes,Recordtime = Getdate()
from sys.master_files mf
join sys.dm_io_virtual_file_stats(NULL, NULL) vfs
on mf.database_id=vfs.database_id and mf.file_id=vfs.file_id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_rpt_ucc_nse_slb_client_data_check
-- --------------------------------------------------


create proc

	[dbo].[mimansa_usp_rpt_ucc_nse_slb_client_data_check]

as

	declare @strPAN_Invalid_Reasons varchar(2000)

	select distinct
		client_code = ltrim(rtrim(client_code)),
		client_name = ltrim(rtrim(client_name)),
		pan = ltrim(rtrim(pan)),
		pan,
		pan_err = 
			case 
				when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'
				then 'NO PAN'
				when len(ltrim(rtrim(isnull(pan, '')))) = 0
				then 'NO PAN'
				when not (
					isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and
					isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and
					isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and
					len(ltrim(rtrim(isnull(pan, '')))) = 10
				)
				then 'INVALID PAN'
			end,

		pan_length = len(ltrim(rtrim(isnull(pan, '')))),
		telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),
		client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))

	from
		--mimansa_angel_ucc_nse_fo_client_data with(nolock)
		mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
		

	where
		ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'

	order by
		pan_err, 
		client_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_mcx_update_latest_file_number
-- --------------------------------------------------

CREATE proc
	[dbo].[mimansa_usp_ucc_mcx_update_latest_file_number] (
		@file_date varchar(15)
	)
as

--exec mimansa_usp_ucc_mcx_update_latest_file_number @file_date = 'Apr  3 2013'

set nocount on
select @file_date


update
	mimansa_tbl_ucc_mcx_file_count with (tablockx)
set
	file_number = (select file_number = max(file_number) + 1 from mimansa_tbl_ucc_mcx_file_count where time_stamp >= @file_date + ' 00:00' and time_stamp <= @file_date + ' 23:59')
where
	time_stamp >= @file_date + ' 00:00' and time_stamp <= @file_date + ' 23:59'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_clear_data
-- --------------------------------------------------
create proc

	[dbo].[mimansa_usp_ucc_nse_slb_clear_data]

as
begin

	truncate table mimansa_angel_tbl_ucc_nse_slb_trade


	truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes
	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_fetch_new_changes
-- --------------------------------------------------


CREATE proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_fetch_new_changes]
as

set nocount on

delete
	mimansa_angel_ucc_nse_slb_client_data_new_changes
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp 
where
	ltrim(rtrim(replace(isnull(mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10

select distinct
		Segment, 
		Client_Code=ltrim(RTRIM(Client_Code)), 
		Client_Name ,
		Category ,
		PAN ,
		Gender, 
		Fathers_Husbands_GuardiansName ,
		Maritalstatus ,
		Nationality ,
		Nationality_Other, 
		ClientEmailId ,
		CorrespondenceClientAddressline1 ,
		CorrespondenceClientAddressline2 ,
		CorrespondenceClientAddressline3 ,
		CorrespondenceClientAddress_City ,
		CorrespondenceClientAddress_State ,
		CorrespondenceClientAddress_State_Others, 
		CorrespondenceClientAddress_Country ,
		CorrespondenceClientAddress_Pincode ,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,
		PermanentClientAddressline1 ,
		PermanentClientAddressline2 ,
		PermanentClientAddressline3 ,
		PermanentClientAddress_City ,
		PermanentClientAddress_State ,
		PermanentClientAddress_StateOthers  ,
		PermanentClientAddress_Country ,
		PermanentClientAddress_Pincode ,
		ISDcode_Residence ,
		STDcode_Residence ,
		TelephoneNumber_Residence ,
		Mobilenumber ,
		ISDcode_Office, 
		STDcode_Office ,
		TelephoneNumber_Office ,
		DateofBirth_Incorporation ,
		UIDNUMBER ,
		BankName1 ,
		BankBranchAddress1 ,
		BankAccountNo1 ,
		BankAccountType1 ,
		BankName2 ,
		BankBranchAddress2 ,
		BankAccountNo2 ,
		BankAccountType2 ,
		BankName3 ,
		BankBranchAddress3 ,
		BankAccountNo3 ,
		BankAccountType3, 
		DepositoryName1 ,
		DepositoryID1 ,
		BeneficialOwnerAccountNo1 ,
		DepositoryName2 ,
		DepositoryID2 ,
		BeneficialOwnerAccountNo2 ,
		DepositoryName3 ,
		DepositoryID3 ,
		BeneficialOwnerAccountNo3 ,
		CorporateIdentitynumber_CIN, 
		GrossAnnualIncomeRange ,
		GrossAnnualIncomeasonDate, 
		NetWorth_InRs ,
		NetWorthasonDate, 
		PoliticallyExposedPerson_PEP ,
		PlaceofIncorporation ,
		Occupation ,
		OccupationDetails_Forothers ,
		Dateofcommencementofbusiness ,
		CustodialParticipantCodeoftheclient ,
		RegistrationNoofClient ,
		RegisteringAuthority ,
		PlaceofRegistration ,
		DateofRegistration ,
		InpersonVerification, 
		ClientAgreementDate ,
		UniqueClientCodeallottedbyNSCCL_BSE ,
		UpdationFlag_for_SMS_and_Email_facility ,
		Relationship ,
		TypeofFacility_for_SMS_and_Email_facility ,
		ProofType ,
		ProofNumber ,
		IssuePlaceofProof ,
		IssueDateofProof ,
		ClientStatus ,
		Remarks ,
		ClientType_Corporate, 
		NameofcontactPerson_1 ,
		DesignationofContactPerson_1 ,
		PANofcontactPerson_1 ,
		AddressofcontactPerson_1 ,
		ContactdetailsofcontactPerson_1 ,
		DINofcontactPerson_1 ,
		UIDofcontactPerson_1 ,
		EmailIdofcontactPerson_1 ,
		NameofcontactPerson_2  ,
		DesignationofcontactPerson_2 ,
		PANofcontactPerson_2 ,
		AddressofcontactPerson_2 ,
		ContactdetailsofcontactPerson_2, 
		DINofcontactPerson_2 ,
		UIDofcontactPerson_2 ,
		EmailIdofcontactPerson_2 ,
		NameofcontactPerson_3 ,
		DesignationofcontactPerson_3, 
		PANofcontactPerson_3 ,
		AddressofcontactPerson_3 ,
		ContactdetailsofcontactPerson_3, 
		DINofcontactPerson_3 ,
		UIDofcontactPerson_3 ,
		EmailIdofcontactPerson_3 ,
		NameofcontactPerson_4 ,
		DesignationofcontactPerson_4, 
		PANofcontactPerson_4 ,
		AddressofcontactPerson_4 ,
		ContactdetailsofcontactPerson_4 ,
		DINofcontactPerson_4 ,
		UIDofcontactPerson_4 ,
		EmailIdofcontactPerson_4 ,
		NameofcontactPerson_5 ,
		DesignationofcontactPerson_5 ,
		PANofcontactPerson_5 ,
		AddressofcontactPerson_5 ,
		ContactdetailsofcontactPerson_5, 
		DINofcontactPerson_5 ,
		UIDofcontactPerson_5 ,
		EmailIdofcontactPerson_5 ,
		NameofcontactPerson_6 ,
		DesignationofcontactPerson_6, 
		PANofcontactPerson_6 ,
		AddressofcontactPerson_6 ,
		ContactdetailsofcontactPerson_6, 
		DINofcontactPerson_6 ,
		UIDofcontactPerson_6 ,
		EmailIdofcontactPerson_6 ,
		NameofcontactPerson_7 ,
		DesignationofcontactPerson_7, 
		PANofcontactPerson_7 ,
		AddressofcontactPerson_7 ,
		ContactdetailsofcontactPerson_7, 
		DINofcontactPerson_7 ,
		UIDofcontactPerson_7 ,
		EmailIdofcontactPerson_7 ,
		NameofcontactPerson_8 ,
		DesignationofcontactPerson_8 ,
		PANofcontactPerson_8 ,
		AddressofcontactPerson_8 ,
		ContactdetailsofcontactPerson_8 ,
		DINofcontactPerson_8 ,
		UIDofcontactPerson_8 ,
		EmailIdofcontactPerson_8 ,
		NameofcontactPerson_9 ,
		DesignationofcontactPerson_9, 
		PANofcontactPerson_9 ,
		AddressofcontactPerson_9 ,
		ContactdetailsofcontactPerson_9, 
		DINofcontactPerson_9 ,
		UIDofcontactPerson_9 ,
		EmailIdofcontactPerson_9 ,
		NameofcontactPerson_10 ,
		DesignationofcontactPerson_10, 
		PANofcontactPerson_10 ,
		AddressofcontactPerson_10 ,
		ContactdetailsofcontactPerson_10, 
		DINofcontactPerson_10 ,
		UIDofcontactPerson_10 ,
		EmailIdofcontactPerson_10 ,
		NameofcontactPerson_11 ,
		DesignationofcontactPerson_11, 
		PANofcontactPerson_11 ,
		AddressofcontactPerson_11 ,
		ContactdetailsofcontactPerson_11, 
		DINofcontactPerson_11 ,
		UIDofcontactPerson_11 ,
		EmailIdofcontactPerson_11 ,
		NameofcontactPerson_12 ,
		DesignationofcontactPerson_12, 
		PANofcontactPerson_12 ,
		AddressofcontactPerson_12 ,
		ContactdetailsofcontactPerson_12, 
		DINofcontactPerson_12 ,
		UIDofcontactPerson_12 ,
		EmailIdofcontactPerson_12 ,
		NameofcontactPerson_13 ,
		DesignationofcontactPerson_13 ,
		PANofcontactPerson_13 ,
		AddressofcontactPerson_13 ,
		ContactdetailsofcontactPerson_13 ,
		DINofcontactPerson_13 ,
		UIDofcontactPerson_13 ,
		EmailIdofcontactPerson_13 ,
		NameofcontactPerson_14 ,
		DesignationofcontactPerson_14 ,
		PANofcontactPerson_14 ,
		AddressofcontactPerson_14 ,
		ContactdetailsofcontactPerson_14 ,
		DINofcontactPerson_14 ,
		UIDofcontactPerson_14 ,
		EmailIdofcontactPerson_14 ,
		NameofcontactPerson_15 ,
		DesignationofcontactPerson_15 ,
		PANofcontactPerson_15 ,
		AddressofcontactPerson_15 ,
		ContactdetailsofcontactPerson_15, 
		DINofcontactPerson_15 ,
		UIDofcontactPerson_15 ,
		EmailIdofcontactPerson_15 ,
		NameofcontactPerson_16 ,
		DesignationofcontactPerson_16, 
		PANofcontactPerson_16 ,
		AddressofcontactPerson_16 ,
		ContactdetailsofcontactPerson_16, 
		DINofcontactPerson_16 ,
		UIDofcontactPerson_16 ,
		EmailIdofcontactPerson_16 ,
		NameofcontactPerson_17 ,
		DesignationofcontactPerson_17, 
		PANofcontactPerson_17 ,
		AddressofcontactPerson_17 ,
		ContactdetailsofcontactPerson_17, 
		DINofcontactPerson_17 ,
		UIDofcontactPerson_17 ,
		EmailIdofcontactPerson_17 ,
		NameofcontactPerson_18 ,
		DesignationofcontactPerson_18, 
		PANofcontactPerson_18 ,
		AddressofcontactPerson_18 ,
		ContactdetailsofcontactPerson_18, 
		DINofcontactPerson_18 ,
		UIDofcontactPerson_18 ,
		EmailIdofcontactPerson_18 ,
		NameofcontactPerson_19 ,
		DesignationofcontactPerson_19, 
		PANofcontactPerson_19 ,
		AddressofcontactPerson_19 ,
		ContactdetailsofcontactPerson_19, 
		DINofcontactPerson_19 ,
		UIDofcontactPerson_19 ,
		EmailIdofcontactPerson_19 ,
		NameofcontactPerson_20 ,
		DesignationofcontactPerson_20, 
		PANofcontactPerson_20 ,
		AddressofcontactPerson_20 ,
		ContactdetailsofcontactPerson_20, 
		DINofcontactPerson_20 ,
		UIDofcontactPerson_20 ,
		EmailIdofcontactPerson_20 ,
		Flag='E'
from
	mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
 
where
	len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes
-- --------------------------------------------------
CREATE proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes]

as

	set nocount on

	/*******************FETCH DATA**************************/

	truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes

	set implicit_transactions off
	set transaction isolation level read uncommitted

	--insert into 
	--	angel_ucc_nse_fo_client1
	select
		party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=cast('' as varchar(255)),
		P_address2=cast('' as varchar(255)),
		P_address3=cast('' as varchar(255)),
		P_City=cast('' as varchar(50)),
		P_State=cast('' as varchar(100)),
		P_State_For_Other=cast('' as varchar(100)),
		P_nation=cast('' as varchar(100)),
		P_zip=cast('' as varchar(10)),
		P_Len=cast('' as varchar(1)),	
		Gender=cast('' as varchar(1)),
		STDcode_Residence1=cast('' as varchar(10)),
		STDcode_Residence2=cast('' as varchar(10)),
		STDcode_Office1=cast('' as varchar(10)),
		STDcode_Office2=cast('' as varchar(10))
	into 
		#temp_client1	
	from 
		NSESLBS.dbo.client1 c1 with(nolock),
		NSESLBS.dbo.client2 c2 with(nolock),
		mimansa_angel_tbl_ucc_nse_SLB_trade t with (nolock)
	where 
		c1.cl_code = c2.cl_code and 
		c2.party_code = t.party_code 

	update #temp_client1 set 
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,'')
	from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)
	where t1.Cl_Code=c1.cl_code

	update 
		#temp_Client1 
	set 
	L_State= dbo.fn_state_countary_value(l_state,'STATE'),
	P_State=dbo.fn_state_countary_value(P_state,'STATE'),
	L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),
	P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),
	cl_status=case
				/*INDIVIDUAL/PROPRIETORSHIP FIRMS*/
				when cl_status = 'IND' then '1'		/*INDIVIDUAL*/

				/*PARTNERSHIP FIRM*/
				when cl_status = 'PF' or cl_status='LLP' then '2'		/*PARTNERSHIP FIRMS*/

				/*HUF*/
				when cl_status = 'HUF' then '3'		/*HINDU UNDIVIDED FAMILY*/

				/*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/
				when cl_status = 'PPB' then '4'		/*PUB. PVT COMP/BODIES CORP*/
				when cl_status = 'BCP' then '4'		/*BODY CORPORATE*/

				/*TRUST / SOCIETY*/
				when cl_status = 'TS' then '5'		/*TRUST / SOCIETY*/

				/*MUTUAL FUND*/
				when cl_status = 'MF' then '6'		/*MUTUAL FUNDS*/
				when cl_status = 'MFF' then '6'		/*MUTUAL FUND (MF)*/

				/*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/
				when cl_status = 'IFI' then '7'		/*INDIAN FINANCIAL INSTI*/
				when cl_status = 'DFI' then '7'		/*DOMESTIC FIN. INST.*/

				/*BANK*/
				when cl_status = 'BA' then ' 8'		/*BANKS*/
				when cl_status = 'BNK' then '8'		/*BANK*/

				/*INSURANCE*/
				when cl_status = 'IC' then ' 9'		/*INSURANCE COMPANIES*/

				/*STATUTORY BODIES*/
				when cl_status = 'SB' then ' 10'		/*STATUTORY BODIES*/

				/*NRI*/
				when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'		/*NON RESIDENT INDIAN*/

				/*FII*/
				when cl_status = 'FII' then '12'		/*FOREIGN INSTIT INVESTORS*/

				/*OCB*/
				when cl_status = 'OCB' then '13'		/*OVERSEAS CORPORATE BODIES*/

				/*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/
				when cl_status = 'DFN' then '14'		/*DIRECT FOREIGN INVESTMENTS*/

				when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/
				
				/*FVC*/
				when cl_status = 'FVC' then '20'		/*FOREIGN VENTURE CAPITAL FUNDS*/
			else
				'1'		/*INDIVIDUAL*/
			end

	
	select 
		Cl_Code, Party_code=c2.Party_code
	into #temp_client2	
	from 
		NSESLBS.dbo.client2 c2 with(nolock),
		mimansa_angel_tbl_ucc_nse_SLB_trade t with (nolock)
	where 
		c2.party_code = t.party_code
	
	select 
		party_code = ltrim(rtrim(t.party_code)),
		--c5.*
		cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),
		--BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),
		--ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */
		ActiveFrom=c5.ActiveFrom,
		InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),
		GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))
	into #temp_Client5	
	from 
		NSESLBS.dbo.client5 c5 with(nolock),
		#temp_Client2 t with (nolock)
	where 
		c5.cl_code = t.cl_code

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		mimansa_angel_tbl_ucc_nse_slb_trade t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.pobank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		mimansa_angel_tbl_ucc_nse_slb_trade t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.bank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('CDSL', 'NSDL') and
		isnull(c4.defdp, '') = '1'

	--insert into
	--	angel_ucc_nse_fo_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank	
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))


	/*******************END - FETCH DATA**************************/

	insert into
		mimansa_angel_ucc_nse_slb_client_data_new_changes
		(
			Segment	,
			Client_Code	,
			Client_Name	,
			Category	,
			PAN	,
			Gender	,
			Fathers_Husbands_GuardiansName	,
			Maritalstatus	,
			Nationality	,
			Nationality_Other	,
			ClientEmailId	,
			CorrespondenceClientAddressline1	,
			CorrespondenceClientAddressline2	,
			CorrespondenceClientAddressline3	,
			CorrespondenceClientAddress_City	,
			CorrespondenceClientAddress_State	,
			CorrespondenceClientAddress_State_Others	,
			CorrespondenceClientAddress_Country	,
			CorrespondenceClientAddress_Pincode	,
			FlagIndicatingifCorrespondenceAddressissameasPermanentAddress	,
			PermanentClientAddressline1	,
			PermanentClientAddressline2	,
			PermanentClientAddressline3	,
			PermanentClientAddress_City	,
			PermanentClientAddress_State	,
			PermanentClientAddress_StateOthers	,
			PermanentClientAddress_Country	,
			PermanentClientAddress_Pincode	,
			ISDcode_Residence	,
			STDcode_Residence	,
			TelephoneNumber_Residence	,
			Mobilenumber	,
			ISDcode_Office	,
			STDcode_Office	,
			TelephoneNumber_Office	,
			DateofBirth_Incorporation	,
			UIDNUMBER	,
			BankName1	,
			BankBranchAddress1	,
			BankAccountNo1	,
			BankAccountType1	,
			BankName2	,
			BankBranchAddress2	,
			BankAccountNo2	,
			BankAccountType2	,
			BankName3	,
			BankBranchAddress3	,
			BankAccountNo3	,
			BankAccountType3	,
			DepositoryName1	,
			DepositoryID1	,
			BeneficialOwnerAccountNo1	,
			DepositoryName2	,
			DepositoryID2	,
			BeneficialOwnerAccountNo2	,
			DepositoryName3	,
			DepositoryID3	,
			BeneficialOwnerAccountNo3	,
			CorporateIdentitynumber_CIN	,
			GrossAnnualIncomeRange	,
			GrossAnnualIncomeasonDate	,
			NetWorth_InRs	,
			NetWorthasonDate	,
			PoliticallyExposedPerson_PEP	,
			PlaceofIncorporation	,
			Occupation	,
			OccupationDetails_Forothers	,
			Dateofcommencementofbusiness	,
			CustodialParticipantCodeoftheclient	,
			RegistrationNoofClient	,
			RegisteringAuthority	,
			PlaceofRegistration	,
			DateofRegistration	,
			InpersonVerification	,
			ClientAgreementDate	,
			UniqueClientCodeallottedbyNSCCL_BSE	,
			UpdationFlag_for_SMS_and_Email_facility	,
			Relationship	,
			TypeofFacility_for_SMS_and_Email_facility	,
			ProofType	,
			ProofNumber	,
			IssuePlaceofProof	,
			IssueDateofProof	,
			ClientStatus	,
			Remarks	,
			ClientType_Corporate	,
			NameofcontactPerson_1	,
			DesignationofContactPerson_1	,
			PANofcontactPerson_1	,
			AddressofcontactPerson_1	,
			ContactdetailsofcontactPerson_1	,
			DINofcontactPerson_1	,
			UIDofcontactPerson_1	,
			EmailIdofcontactPerson_1	,
			NameofcontactPerson_2	,
			DesignationofcontactPerson_2	,
			PANofcontactPerson_2	,
			AddressofcontactPerson_2	,
			ContactdetailsofcontactPerson_2	,
			DINofcontactPerson_2	,
			UIDofcontactPerson_2	,
			EmailIdofcontactPerson_2	,
			NameofcontactPerson_3	,
			DesignationofcontactPerson_3	,
			PANofcontactPerson_3	,
			AddressofcontactPerson_3	,
			ContactdetailsofcontactPerson_3	,
			DINofcontactPerson_3	,
			UIDofcontactPerson_3	,
			EmailIdofcontactPerson_3	,
			NameofcontactPerson_4	,
			DesignationofcontactPerson_4	,
			PANofcontactPerson_4	,
			AddressofcontactPerson_4	,
			ContactdetailsofcontactPerson_4	,
			DINofcontactPerson_4	,
			UIDofcontactPerson_4	,
			EmailIdofcontactPerson_4	,
			NameofcontactPerson_5	,
			DesignationofcontactPerson_5	,
			PANofcontactPerson_5	,
			AddressofcontactPerson_5	,
			ContactdetailsofcontactPerson_5	,
			DINofcontactPerson_5	,
			UIDofcontactPerson_5	,
			EmailIdofcontactPerson_5	,
			NameofcontactPerson_6	,
			DesignationofcontactPerson_6	,
			PANofcontactPerson_6	,
			AddressofcontactPerson_6	,
			ContactdetailsofcontactPerson_6	,
			DINofcontactPerson_6	,
			UIDofcontactPerson_6	,
			EmailIdofcontactPerson_6	,
			NameofcontactPerson_7	,
			DesignationofcontactPerson_7	,
			PANofcontactPerson_7	,
			AddressofcontactPerson_7	,
			ContactdetailsofcontactPerson_7	,
			DINofcontactPerson_7	,
			UIDofcontactPerson_7	,
			EmailIdofcontactPerson_7	,
			NameofcontactPerson_8	,
			DesignationofcontactPerson_8	,
			PANofcontactPerson_8	,
			AddressofcontactPerson_8	,
			ContactdetailsofcontactPerson_8	,
			DINofcontactPerson_8	,
			UIDofcontactPerson_8	,
			EmailIdofcontactPerson_8	,
			NameofcontactPerson_9	,
			DesignationofcontactPerson_9	,
			PANofcontactPerson_9	,
			AddressofcontactPerson_9	,
			ContactdetailsofcontactPerson_9	,
			DINofcontactPerson_9	,
			UIDofcontactPerson_9	,
			EmailIdofcontactPerson_9	,
			NameofcontactPerson_10	,
			DesignationofcontactPerson_10	,
			PANofcontactPerson_10	,
			AddressofcontactPerson_10	,
			ContactdetailsofcontactPerson_10	,
			DINofcontactPerson_10	,
			UIDofcontactPerson_10	,
			EmailIdofcontactPerson_10	,
			NameofcontactPerson_11	,
			DesignationofcontactPerson_11	,
			PANofcontactPerson_11	,
			AddressofcontactPerson_11	,
			ContactdetailsofcontactPerson_11	,
			DINofcontactPerson_11	,
			UIDofcontactPerson_11	,
			EmailIdofcontactPerson_11	,
			NameofcontactPerson_12	,
			DesignationofcontactPerson_12	,
			PANofcontactPerson_12	,
			AddressofcontactPerson_12	,
			ContactdetailsofcontactPerson_12	,
			DINofcontactPerson_12	,
			UIDofcontactPerson_12	,
			EmailIdofcontactPerson_12	,
			NameofcontactPerson_13	,
			DesignationofcontactPerson_13	,
			PANofcontactPerson_13	,
			AddressofcontactPerson_13	,
			ContactdetailsofcontactPerson_13	,
			DINofcontactPerson_13	,
			UIDofcontactPerson_13	,
			EmailIdofcontactPerson_13	,
			NameofcontactPerson_14	,
			DesignationofcontactPerson_14	,
			PANofcontactPerson_14	,
			AddressofcontactPerson_14	,
			ContactdetailsofcontactPerson_14	,
			DINofcontactPerson_14	,
			UIDofcontactPerson_14	,
			EmailIdofcontactPerson_14	,
			NameofcontactPerson_15	,
			DesignationofcontactPerson_15	,
			PANofcontactPerson_15	,
			AddressofcontactPerson_15	,
			ContactdetailsofcontactPerson_15	,
			DINofcontactPerson_15	,
			UIDofcontactPerson_15	,
			EmailIdofcontactPerson_15	,
			NameofcontactPerson_16	,
			DesignationofcontactPerson_16	,
			PANofcontactPerson_16	,
			AddressofcontactPerson_16	,
			ContactdetailsofcontactPerson_16	,
			DINofcontactPerson_16	,
			UIDofcontactPerson_16	,
			EmailIdofcontactPerson_16	,
			NameofcontactPerson_17	,
			DesignationofcontactPerson_17	,
			PANofcontactPerson_17	,
			AddressofcontactPerson_17	,
			ContactdetailsofcontactPerson_17	,
			DINofcontactPerson_17	,
			UIDofcontactPerson_17	,
			EmailIdofcontactPerson_17	,
			NameofcontactPerson_18	,
			DesignationofcontactPerson_18	,
			PANofcontactPerson_18	,
			AddressofcontactPerson_18	,
			ContactdetailsofcontactPerson_18	,
			DINofcontactPerson_18	,
			UIDofcontactPerson_18	,
			EmailIdofcontactPerson_18	,
			NameofcontactPerson_19	,
			DesignationofcontactPerson_19	,
			PANofcontactPerson_19	,
			AddressofcontactPerson_19	,
			ContactdetailsofcontactPerson_19	,
			DINofcontactPerson_19	,
			UIDofcontactPerson_19	,
			EmailIdofcontactPerson_19	,
			NameofcontactPerson_20	,
			DesignationofcontactPerson_20	,
			PANofcontactPerson_20	,
			AddressofcontactPerson_20	,
			ContactdetailsofcontactPerson_20	,
			DINofcontactPerson_20	,
			UIDofcontactPerson_20	,
			EmailIdofcontactPerson_20	,
			Flag	
			)
	select
		segment = 'S',
		client_code = c2.party_code,
		client_name = left(c1_b.long_name, 150),
		category =cl_status,
		pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),
		Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */
		Fathers_Husbands_GuardiansName ='',
		Maritalstatus='',
		Nationality ='',
		Nationality_Other='', 
		ClientEmailId = left(email, 60),
		CorrespondenceClientAddressline1 = left(
			case
				when len(c1_b.l_address1) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address1, '')))
				end
			+
			case
				when len(c1_b.l_address2) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address2, '')))
				end
			+
			case
				when len(c1_b.l_address3) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address3, '')))
				end, 255
			),

		CorrespondenceClientAddressline2 = '',
		CorrespondenceClientAddressline3 = '',
		CorrespondenceClientAddress_City = left(c1_b.l_city, 50),
		CorrespondenceClientAddress_State = c1_b.l_state,
		CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,
		CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),
		CorrespondenceClientAddress_Pincode = 
		case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
		else
			c1_b.l_zip
		end		,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,	
		/*Modify on 30 Apr 2014*/
		PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end, 
		PermanentClientAddressline2 ='',
		PermanentClientAddressline3 ='',			
		/*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
		PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
		PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/
		PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,
		PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
		PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,
		PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
		PermanentClientAddress_Pincode =
		case when c1_b.P_Len='N' then 
			case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
			else
				c1_b.l_zip
			end
		else ''				 
		end,
		ISDcode_Residence ='',
		STDcode_Residence =case 
							when len(STDcode_Residence1)>0 then STDcode_Residence1
							when len(STDcode_Residence2)>0 then STDcode_Residence2
						   else '' end,	
		TelephoneNumber_Residence = 
			left(	case 
						when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')
						when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')
					else 
						'' 
					end
				, 60
				),
		Mobilenumber =left(c1_b.mobile_pager, 10),
		ISDcode_Office ='',
		STDcode_Office =case 
							when len(STDcode_Office1)>0 then STDcode_Office1
							when len(STDcode_Office2)>0 then STDcode_Office2
						   else '' end,
		TelephoneNumber_Office=
			left(	case 
						when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')
						when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')
					else 
						'' 
					end
				, 60
				),
		DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,
		UIDNUMBER='',

	
		BankName1 =bank_name,
		BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end , 
		BankAccountNo1 =bank_account_no,
		BankAccountType1 =case 
							when bank_account_type = 'SAVING' then '10'
							when bank_account_type = 'CURRENT' then '11'
							when bank_account_type = 'OTHER' then '99' 
						  else ''
							end ,
		BankName2 ='',
		BankBranchAddress2 ='',
		BankAccountNo2 ='',
		BankAccountType2 ='',
		BankName3 ='',
		BankBranchAddress3 ='',
		BankAccountNo3 ='',
		BankAccountType3 ='',
		
		DepositoryName1 =dp_name,
		DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,
		BeneficialOwnerAccountNo1 =demat_id_of_client,
		
		DepositoryName2 ='',
		DepositoryID2 ='',
		BeneficialOwnerAccountNo2 ='',
		DepositoryName3 ='',
		DepositoryID3 ='',
		BeneficialOwnerAccountNo3 ='',
		CorporateIdentitynumber_CIN='',
		GrossAnnualIncomeRange ='',
		GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,
		NetWorth_InRs ='',
		NetWorthasonDate ='',
		PoliticallyExposedPerson_PEP='0', 
		PlaceofIncorporation ='',
		Occupation ='',
		OccupationDetails_Forothers='', 
		Dateofcommencementofbusiness ='',
		CustodialParticipantCodeoftheclient ='',
		RegistrationNoofClient ='',
		RegisteringAuthority ='',
		PlaceofRegistration ='',
		DateofRegistration ='',
		InpersonVerification ='Y',
		ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),
							/*Change on 26 Apr 2014: Changes for NSE SLB */
		UniqueClientCodeallottedbyNSCCL_BSE ='',
		UpdationFlag_for_SMS_and_Email_facility='', 
		Relationship ='',
		TypeofFacility_for_SMS_and_Email_facility ='',
		ProofType ='',
		ProofNumber ='',
		IssuePlaceofProof='', 
		IssueDateofProof ='',
		ClientStatus ='A',
		Remarks ='',
		ClientType_Corporate='', 
		NameofcontactPerson_1 ='',
		DesignationofContactPerson_1 ='',
		PANofcontactPerson_1 ='',
		AddressofcontactPerson_1 ='',
		ContactdetailsofcontactPerson_1 ='',
		DINofcontactPerson_1 ='',
		UIDofcontactPerson_1 ='',
		EmailIdofcontactPerson_1 ='',
		NameofcontactPerson_2  ='',
		DesignationofcontactPerson_2 ='',
		PANofcontactPerson_2 ='',
		AddressofcontactPerson_2 ='',
		ContactdetailsofcontactPerson_2='', 
		DINofcontactPerson_2 ='',
		UIDofcontactPerson_2 ='',
		EmailIdofcontactPerson_2 ='',
		NameofcontactPerson_3 ='',
		DesignationofcontactPerson_3='', 
		PANofcontactPerson_3 ='',
		AddressofcontactPerson_3 ='',
		ContactdetailsofcontactPerson_3='', 
		DINofcontactPerson_3 ='',
		UIDofcontactPerson_3 ='',
		EmailIdofcontactPerson_3 ='',
		NameofcontactPerson_4 ='',
		DesignationofcontactPerson_4='', 
		PANofcontactPerson_4 ='',
		AddressofcontactPerson_4 ='',
		ContactdetailsofcontactPerson_4 ='',
		DINofcontactPerson_4 ='',
		UIDofcontactPerson_4 ='',
		EmailIdofcontactPerson_4 ='',
		NameofcontactPerson_5 ='',
		DesignationofcontactPerson_5 ='',
		PANofcontactPerson_5 ='',
		AddressofcontactPerson_5 ='',
		ContactdetailsofcontactPerson_5='', 
		DINofcontactPerson_5 ='',
		UIDofcontactPerson_5 ='',
		EmailIdofcontactPerson_5 ='',
		NameofcontactPerson_6 ='',
		DesignationofcontactPerson_6='', 
		PANofcontactPerson_6 ='',
		AddressofcontactPerson_6 ='',
		ContactdetailsofcontactPerson_6='', 
		DINofcontactPerson_6 ='',
		UIDofcontactPerson_6 ='',
		EmailIdofcontactPerson_6 ='',
		NameofcontactPerson_7 ='',
		DesignationofcontactPerson_7='', 
		PANofcontactPerson_7 ='',
		AddressofcontactPerson_7 ='',
		ContactdetailsofcontactPerson_7='', 
		DINofcontactPerson_7 ='',
		UIDofcontactPerson_7 ='',
		EmailIdofcontactPerson_7 ='',
		NameofcontactPerson_8 ='',
		DesignationofcontactPerson_8 ='',
		PANofcontactPerson_8 ='',
		AddressofcontactPerson_8 ='',
		ContactdetailsofcontactPerson_8 ='',
		DINofcontactPerson_8 ='',
		UIDofcontactPerson_8 ='',
		EmailIdofcontactPerson_8 ='',
		NameofcontactPerson_9 ='',
		DesignationofcontactPerson_9='', 
		PANofcontactPerson_9 ='',
		AddressofcontactPerson_9 ='',
		ContactdetailsofcontactPerson_9='', 
		DINofcontactPerson_9 ='',
		UIDofcontactPerson_9 ='',
		EmailIdofcontactPerson_9 ='',
		NameofcontactPerson_10 ='',
		DesignationofcontactPerson_10='', 
		PANofcontactPerson_10 ='',
		AddressofcontactPerson_10 ='',
		ContactdetailsofcontactPerson_10='', 
		DINofcontactPerson_10 ='',
		UIDofcontactPerson_10 ='',
		EmailIdofcontactPerson_10 ='',
		NameofcontactPerson_11 ='',
		DesignationofcontactPerson_11='', 
		PANofcontactPerson_11 ='',
		AddressofcontactPerson_11 ='',
		ContactdetailsofcontactPerson_11='', 
		DINofcontactPerson_11 ='',
		UIDofcontactPerson_11 ='',
		EmailIdofcontactPerson_11 ='',
		NameofcontactPerson_12 ='',
		DesignationofcontactPerson_12='', 
		PANofcontactPerson_12 ='',
		AddressofcontactPerson_12 ='',
		ContactdetailsofcontactPerson_12='', 
		DINofcontactPerson_12 ='',
		UIDofcontactPerson_12 ='',
		EmailIdofcontactPerson_12 ='',
		NameofcontactPerson_13 ='',
		DesignationofcontactPerson_13 ='',
		PANofcontactPerson_13 ='',
		AddressofcontactPerson_13 ='',
		ContactdetailsofcontactPerson_13 ='',
		DINofcontactPerson_13 ='',
		UIDofcontactPerson_13 ='',
		EmailIdofcontactPerson_13 ='',
		NameofcontactPerson_14 ='',
		DesignationofcontactPerson_14 ='',
		PANofcontactPerson_14 ='',
		AddressofcontactPerson_14 ='',
		ContactdetailsofcontactPerson_14 ='',
		DINofcontactPerson_14 ='',
		UIDofcontactPerson_14 ='',
		EmailIdofcontactPerson_14 ='',
		NameofcontactPerson_15 ='',
		DesignationofcontactPerson_15 ='',
		PANofcontactPerson_15 ='',
		AddressofcontactPerson_15 ='',
		ContactdetailsofcontactPerson_15='', 
		DINofcontactPerson_15 ='',
		UIDofcontactPerson_15 ='',
		EmailIdofcontactPerson_15 ='',
		NameofcontactPerson_16 ='',
		DesignationofcontactPerson_16='', 
		PANofcontactPerson_16 ='',
		AddressofcontactPerson_16 ='',
		ContactdetailsofcontactPerson_16='', 
		DINofcontactPerson_16 ='',
		UIDofcontactPerson_16 ='',
		EmailIdofcontactPerson_16 ='',
		NameofcontactPerson_17 ='',
		DesignationofcontactPerson_17='', 
		PANofcontactPerson_17 ='',
		AddressofcontactPerson_17 ='',
		ContactdetailsofcontactPerson_17='', 
		DINofcontactPerson_17 ='',
		UIDofcontactPerson_17 ='',
		EmailIdofcontactPerson_17 ='',
		NameofcontactPerson_18 ='',
		DesignationofcontactPerson_18='', 
		PANofcontactPerson_18 ='',
		AddressofcontactPerson_18 ='',
		ContactdetailsofcontactPerson_18='', 
		DINofcontactPerson_18 ='',
		UIDofcontactPerson_18 ='',
		EmailIdofcontactPerson_18 ='',
		NameofcontactPerson_19 ='',
		DesignationofcontactPerson_19='', 
		PANofcontactPerson_19 ='',
		AddressofcontactPerson_19 ='',
		ContactdetailsofcontactPerson_19='', 
		DINofcontactPerson_19 ='',
		UIDofcontactPerson_19 ='',
		EmailIdofcontactPerson_19 ='',
		NameofcontactPerson_20 ='',
		DesignationofcontactPerson_20='', 
		PANofcontactPerson_20 ='',
		AddressofcontactPerson_20 ='',
		ContactdetailsofcontactPerson_20='', 
		DINofcontactPerson_20 ='',
		UIDofcontactPerson_20 ='',
		EmailIdofcontactPerson_20 ='',
		Flag='E'
	from
		(
			select
				c1.*,
				b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_Client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
		#temp_Client2 c2 with (nolock),
		#temp_Client5 c5 with (nolock)

	where
		ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and
		ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and
		ltrim(rtrim(left(c2.party_code,2))) <> '98'
		

	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),
	    RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''),
	    --MASTERPAN=ISNULL(c1.MASTERPAN,''),
	    TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),
		--Gender=isnull(c1.Gender,''),
		Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=
					case when mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		GrossAnnualIncomeRange=case 
					when c1.Gross_Income ='01' then '1'
					when c1.Gross_Income ='02' then '2'
					when c1.Gross_Income ='03' then '3'
					when c1.Gross_Income ='04' then '4'
					when c1.Gross_Income ='05' then '5'
					when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/
					when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/
					else '' end, 
		NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''
						else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,
		PoliticallyExposedPerson_PEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end,
		OccupationDetails_Forothers=isnull(Occupation_Other,''),
		UIDNUMBER=isnull(c1.AADHAR_UID,'')
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0			
	
	update 
		mimansa_angel_ucc_nse_slb_client_data_new_changes 
	set 
		GrossAnnualIncomeasonDate='',
		NetWorth_InRs='',
		NetWorthasonDate=''
	where len(GrossAnnualIncomeRange)=0 

	
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),
		ClientType_Corporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4	

	/****ADDRESS 1****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_1=c1.contact_name,
	DesignationofContactPerson_1=c1.designation,
	PANofcontactPerson_1=c1.PanNo,
	AddressofcontactPerson_1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_1=c1.DIN,
	UIDofcontactPerson_1=c1.UID,
	EmailIdofcontactPerson_1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='1'

	/****ADDRESS 2****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_2=c1.contact_name,
	DesignationofContactPerson_2=c1.designation,
	PANofcontactPerson_2=c1.PanNo,
	AddressofcontactPerson_2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_2=c1.DIN,
	UIDofcontactPerson_2=c1.UID,
	EmailIdofcontactPerson_2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='2'

	/****ADDRESS 3****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_3=c1.contact_name,
	DesignationofContactPerson_3=c1.designation,
	PANofcontactPerson_3=c1.PanNo,
	AddressofcontactPerson_3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_3=c1.DIN,
	UIDofcontactPerson_3=c1.UID,
	EmailIdofcontactPerson_3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='3'

	/****ADDRESS 4****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_4=c1.contact_name,
	DesignationofContactPerson_4=c1.designation,
	PANofcontactPerson_4=c1.PanNo,
	AddressofcontactPerson_4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_4=c1.DIN,
	UIDofcontactPerson_4=c1.UID,
	EmailIdofcontactPerson_4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='4'

	/****ADDRESS 5****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_5=c1.contact_name,
	DesignationofContactPerson_5=c1.designation,
	PANofcontactPerson_5=c1.PanNo,
	AddressofcontactPerson_5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_5=c1.DIN,
	UIDofcontactPerson_5=c1.UID,
	EmailIdofcontactPerson_5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='5'

	/****ADDRESS 6****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_6=c1.contact_name,
	DesignationofContactPerson_6=c1.designation,
	PANofcontactPerson_6=c1.PanNo,
	AddressofcontactPerson_6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_6=c1.DIN,
	UIDofcontactPerson_6=c1.UID,
	EmailIdofcontactPerson_6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='6'

	/****ADDRESS 7****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_7=c1.contact_name,
	DesignationofContactPerson_7=c1.designation,
	PANofcontactPerson_7=c1.PanNo,
	AddressofcontactPerson_7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_7=c1.DIN,
	UIDofcontactPerson_7=c1.UID,
	EmailIdofcontactPerson_7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='7'

	/****ADDRESS 8****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_8=c1.contact_name,
	DesignationofContactPerson_8=c1.designation,
	PANofcontactPerson_8=c1.PanNo,
	AddressofcontactPerson_8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_8=c1.DIN,
	UIDofcontactPerson_8=c1.UID,
	EmailIdofcontactPerson_8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='8'

	/****ADDRESS 9****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_9=c1.contact_name,
	DesignationofContactPerson_9=c1.designation,
	PANofcontactPerson_9=c1.PanNo,
	AddressofcontactPerson_9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_9=c1.DIN,
	UIDofcontactPerson_9=c1.UID,
	EmailIdofcontactPerson_9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='9'

	/****ADDRESS 10****/
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_10=c1.contact_name,
	DesignationofContactPerson_10=c1.designation,
	PANofcontactPerson_10=c1.PanNo,
	AddressofcontactPerson_10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_10=c1.DIN,
	UIDofcontactPerson_10=c1.UID,
	EmailIdofcontactPerson_10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='10'

	set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_Bak13Mar2014
-- --------------------------------------------------
create proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_Bak13Mar2014]

as

	set nocount on

	/*******************FETCH DATA**************************/

	truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes

	set implicit_transactions off
	set transaction isolation level read uncommitted

	--insert into 
	--	angel_ucc_nse_fo_client1
	select
		party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=cast('' as varchar(255)),
		P_address2=cast('' as varchar(255)),
		P_address3=cast('' as varchar(255)),
		P_City=cast('' as varchar(50)),
		P_State=cast('' as varchar(100)),
		P_State_For_Other=cast('' as varchar(100)),
		P_nation=cast('' as varchar(100)),
		P_zip=cast('' as varchar(10)),
		P_Len=cast('' as varchar(1)),	
		Gender=cast('' as varchar(1)),
		STDcode_Residence1=cast('' as varchar(10)),
		STDcode_Residence2=cast('' as varchar(10)),
		STDcode_Office1=cast('' as varchar(10)),
		STDcode_Office2=cast('' as varchar(10))
	into 
		#temp_client1	
	from 
		NSESLBS.dbo.client1 c1 with(nolock),
		NSESLBS.dbo.client2 c2 with(nolock),
		mimansa_angel_tbl_ucc_nse_SLB_trade t with (nolock)
	where 
		c1.cl_code = c2.cl_code and 
		c2.party_code = t.party_code 

	update #temp_client1 set 
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,'')
	from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)
	where t1.Cl_Code=c1.cl_code

	update 
		#temp_Client1 
	set 
	L_State= dbo.fn_state_countary_value(l_state,'STATE'),
	P_State=dbo.fn_state_countary_value(P_state,'STATE'),
	L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),
	P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),
	cl_status=case
				/*INDIVIDUAL/PROPRIETORSHIP FIRMS*/
				when cl_status = 'IND' then '1'		/*INDIVIDUAL*/

				/*PARTNERSHIP FIRM*/
				when cl_status = 'PF' or cl_status='LLP' then '2'		/*PARTNERSHIP FIRMS*/

				/*HUF*/
				when cl_status = 'HUF' then '3'		/*HINDU UNDIVIDED FAMILY*/

				/*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/
				when cl_status = 'PPB' then '4'		/*PUB. PVT COMP/BODIES CORP*/
				when cl_status = 'BCP' then '4'		/*BODY CORPORATE*/

				/*TRUST / SOCIETY*/
				when cl_status = 'TS' then '5'		/*TRUST / SOCIETY*/

				/*MUTUAL FUND*/
				when cl_status = 'MF' then '6'		/*MUTUAL FUNDS*/
				when cl_status = 'MFF' then '6'		/*MUTUAL FUND (MF)*/

				/*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/
				when cl_status = 'IFI' then '7'		/*INDIAN FINANCIAL INSTI*/
				when cl_status = 'DFI' then '7'		/*DOMESTIC FIN. INST.*/

				/*BANK*/
				when cl_status = 'BA' then ' 8'		/*BANKS*/
				when cl_status = 'BNK' then '8'		/*BANK*/

				/*INSURANCE*/
				when cl_status = 'IC' then ' 9'		/*INSURANCE COMPANIES*/

				/*STATUTORY BODIES*/
				when cl_status = 'SB' then ' 10'		/*STATUTORY BODIES*/

				/*NRI*/
				when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'		/*NON RESIDENT INDIAN*/

				/*FII*/
				when cl_status = 'FII' then '12'		/*FOREIGN INSTIT INVESTORS*/

				/*OCB*/
				when cl_status = 'OCB' then '13'		/*OVERSEAS CORPORATE BODIES*/

				/*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/
				when cl_status = 'DFN' then '14'		/*DIRECT FOREIGN INVESTMENTS*/

				when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/
				
				/*FVC*/
				when cl_status = 'FVC' then '20'		/*FOREIGN VENTURE CAPITAL FUNDS*/
			else
				'1'		/*INDIVIDUAL*/
			end

	
	select 
		Cl_Code, Party_code=c2.Party_code
	into #temp_client2	
	from 
		NSESLBS.dbo.client2 c2 with(nolock),
		mimansa_angel_tbl_ucc_nse_SLB_trade t with (nolock)
	where 
		c2.party_code = t.party_code
	
	select 
		party_code = ltrim(rtrim(t.party_code)),
		--c5.*
		cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),
		--BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),
		ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))),InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),
		GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))
	into #temp_Client5	
	from 
		NSESLBS.dbo.client5 c5 with(nolock),
		#temp_Client2 t with (nolock)
	where 
		c5.cl_code = t.cl_code

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		mimansa_angel_tbl_ucc_nse_slb_trade t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.pobank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		mimansa_angel_tbl_ucc_nse_slb_trade t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.bank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('CDSL', 'NSDL') and
		isnull(c4.defdp, '') = '1'

	--insert into
	--	angel_ucc_nse_fo_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank	
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))


	/*******************END - FETCH DATA**************************/

	insert into
		mimansa_angel_ucc_nse_slb_client_data_new_changes
		(
			Segment	,
			Client_Code	,
			Client_Name	,
			Category	,
			PAN	,
			Gender	,
			Fathers_Husbands_GuardiansName	,
			Maritalstatus	,
			Nationality	,
			Nationality_Other	,
			ClientEmailId	,
			CorrespondenceClientAddressline1	,
			CorrespondenceClientAddressline2	,
			CorrespondenceClientAddressline3	,
			CorrespondenceClientAddress_City	,
			CorrespondenceClientAddress_State	,
			CorrespondenceClientAddress_State_Others	,
			CorrespondenceClientAddress_Country	,
			CorrespondenceClientAddress_Pincode	,
			FlagIndicatingifCorrespondenceAddressissameasPermanentAddress	,
			PermanentClientAddressline1	,
			PermanentClientAddressline2	,
			PermanentClientAddressline3	,
			PermanentClientAddress_City	,
			PermanentClientAddress_State	,
			PermanentClientAddress_StateOthers	,
			PermanentClientAddress_Country	,
			PermanentClientAddress_Pincode	,
			ISDcode_Residence	,
			STDcode_Residence	,
			TelephoneNumber_Residence	,
			Mobilenumber	,
			ISDcode_Office	,
			STDcode_Office	,
			TelephoneNumber_Office	,
			DateofBirth_Incorporation	,
			UIDNUMBER	,
			BankName1	,
			BankBranchAddress1	,
			BankAccountNo1	,
			BankAccountType1	,
			BankName2	,
			BankBranchAddress2	,
			BankAccountNo2	,
			BankAccountType2	,
			BankName3	,
			BankBranchAddress3	,
			BankAccountNo3	,
			BankAccountType3	,
			DepositoryName1	,
			DepositoryID1	,
			BeneficialOwnerAccountNo1	,
			DepositoryName2	,
			DepositoryID2	,
			BeneficialOwnerAccountNo2	,
			DepositoryName3	,
			DepositoryID3	,
			BeneficialOwnerAccountNo3	,
			CorporateIdentitynumber_CIN	,
			GrossAnnualIncomeRange	,
			GrossAnnualIncomeasonDate	,
			NetWorth_InRs	,
			NetWorthasonDate	,
			PoliticallyExposedPerson_PEP	,
			PlaceofIncorporation	,
			Occupation	,
			OccupationDetails_Forothers	,
			Dateofcommencementofbusiness	,
			CustodialParticipantCodeoftheclient	,
			RegistrationNoofClient	,
			RegisteringAuthority	,
			PlaceofRegistration	,
			DateofRegistration	,
			InpersonVerification	,
			ClientAgreementDate	,
			UniqueClientCodeallottedbyNSCCL_BSE	,
			UpdationFlag_for_SMS_and_Email_facility	,
			Relationship	,
			TypeofFacility_for_SMS_and_Email_facility	,
			ProofType	,
			ProofNumber	,
			IssuePlaceofProof	,
			IssueDateofProof	,
			ClientStatus	,
			Remarks	,
			ClientType_Corporate	,
			NameofcontactPerson_1	,
			DesignationofContactPerson_1	,
			PANofcontactPerson_1	,
			AddressofcontactPerson_1	,
			ContactdetailsofcontactPerson_1	,
			DINofcontactPerson_1	,
			UIDofcontactPerson_1	,
			EmailIdofcontactPerson_1	,
			NameofcontactPerson_2	,
			DesignationofcontactPerson_2	,
			PANofcontactPerson_2	,
			AddressofcontactPerson_2	,
			ContactdetailsofcontactPerson_2	,
			DINofcontactPerson_2	,
			UIDofcontactPerson_2	,
			EmailIdofcontactPerson_2	,
			NameofcontactPerson_3	,
			DesignationofcontactPerson_3	,
			PANofcontactPerson_3	,
			AddressofcontactPerson_3	,
			ContactdetailsofcontactPerson_3	,
			DINofcontactPerson_3	,
			UIDofcontactPerson_3	,
			EmailIdofcontactPerson_3	,
			NameofcontactPerson_4	,
			DesignationofcontactPerson_4	,
			PANofcontactPerson_4	,
			AddressofcontactPerson_4	,
			ContactdetailsofcontactPerson_4	,
			DINofcontactPerson_4	,
			UIDofcontactPerson_4	,
			EmailIdofcontactPerson_4	,
			NameofcontactPerson_5	,
			DesignationofcontactPerson_5	,
			PANofcontactPerson_5	,
			AddressofcontactPerson_5	,
			ContactdetailsofcontactPerson_5	,
			DINofcontactPerson_5	,
			UIDofcontactPerson_5	,
			EmailIdofcontactPerson_5	,
			NameofcontactPerson_6	,
			DesignationofcontactPerson_6	,
			PANofcontactPerson_6	,
			AddressofcontactPerson_6	,
			ContactdetailsofcontactPerson_6	,
			DINofcontactPerson_6	,
			UIDofcontactPerson_6	,
			EmailIdofcontactPerson_6	,
			NameofcontactPerson_7	,
			DesignationofcontactPerson_7	,
			PANofcontactPerson_7	,
			AddressofcontactPerson_7	,
			ContactdetailsofcontactPerson_7	,
			DINofcontactPerson_7	,
			UIDofcontactPerson_7	,
			EmailIdofcontactPerson_7	,
			NameofcontactPerson_8	,
			DesignationofcontactPerson_8	,
			PANofcontactPerson_8	,
			AddressofcontactPerson_8	,
			ContactdetailsofcontactPerson_8	,
			DINofcontactPerson_8	,
			UIDofcontactPerson_8	,
			EmailIdofcontactPerson_8	,
			NameofcontactPerson_9	,
			DesignationofcontactPerson_9	,
			PANofcontactPerson_9	,
			AddressofcontactPerson_9	,
			ContactdetailsofcontactPerson_9	,
			DINofcontactPerson_9	,
			UIDofcontactPerson_9	,
			EmailIdofcontactPerson_9	,
			NameofcontactPerson_10	,
			DesignationofcontactPerson_10	,
			PANofcontactPerson_10	,
			AddressofcontactPerson_10	,
			ContactdetailsofcontactPerson_10	,
			DINofcontactPerson_10	,
			UIDofcontactPerson_10	,
			EmailIdofcontactPerson_10	,
			NameofcontactPerson_11	,
			DesignationofcontactPerson_11	,
			PANofcontactPerson_11	,
			AddressofcontactPerson_11	,
			ContactdetailsofcontactPerson_11	,
			DINofcontactPerson_11	,
			UIDofcontactPerson_11	,
			EmailIdofcontactPerson_11	,
			NameofcontactPerson_12	,
			DesignationofcontactPerson_12	,
			PANofcontactPerson_12	,
			AddressofcontactPerson_12	,
			ContactdetailsofcontactPerson_12	,
			DINofcontactPerson_12	,
			UIDofcontactPerson_12	,
			EmailIdofcontactPerson_12	,
			NameofcontactPerson_13	,
			DesignationofcontactPerson_13	,
			PANofcontactPerson_13	,
			AddressofcontactPerson_13	,
			ContactdetailsofcontactPerson_13	,
			DINofcontactPerson_13	,
			UIDofcontactPerson_13	,
			EmailIdofcontactPerson_13	,
			NameofcontactPerson_14	,
			DesignationofcontactPerson_14	,
			PANofcontactPerson_14	,
			AddressofcontactPerson_14	,
			ContactdetailsofcontactPerson_14	,
			DINofcontactPerson_14	,
			UIDofcontactPerson_14	,
			EmailIdofcontactPerson_14	,
			NameofcontactPerson_15	,
			DesignationofcontactPerson_15	,
			PANofcontactPerson_15	,
			AddressofcontactPerson_15	,
			ContactdetailsofcontactPerson_15	,
			DINofcontactPerson_15	,
			UIDofcontactPerson_15	,
			EmailIdofcontactPerson_15	,
			NameofcontactPerson_16	,
			DesignationofcontactPerson_16	,
			PANofcontactPerson_16	,
			AddressofcontactPerson_16	,
			ContactdetailsofcontactPerson_16	,
			DINofcontactPerson_16	,
			UIDofcontactPerson_16	,
			EmailIdofcontactPerson_16	,
			NameofcontactPerson_17	,
			DesignationofcontactPerson_17	,
			PANofcontactPerson_17	,
			AddressofcontactPerson_17	,
			ContactdetailsofcontactPerson_17	,
			DINofcontactPerson_17	,
			UIDofcontactPerson_17	,
			EmailIdofcontactPerson_17	,
			NameofcontactPerson_18	,
			DesignationofcontactPerson_18	,
			PANofcontactPerson_18	,
			AddressofcontactPerson_18	,
			ContactdetailsofcontactPerson_18	,
			DINofcontactPerson_18	,
			UIDofcontactPerson_18	,
			EmailIdofcontactPerson_18	,
			NameofcontactPerson_19	,
			DesignationofcontactPerson_19	,
			PANofcontactPerson_19	,
			AddressofcontactPerson_19	,
			ContactdetailsofcontactPerson_19	,
			DINofcontactPerson_19	,
			UIDofcontactPerson_19	,
			EmailIdofcontactPerson_19	,
			NameofcontactPerson_20	,
			DesignationofcontactPerson_20	,
			PANofcontactPerson_20	,
			AddressofcontactPerson_20	,
			ContactdetailsofcontactPerson_20	,
			DINofcontactPerson_20	,
			UIDofcontactPerson_20	,
			EmailIdofcontactPerson_20	,
			Flag	
			)
	select
		segment = 'S',
		client_code = c2.party_code,
		client_name = left(c1_b.long_name, 150),
		category =cl_status,
		pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),
		Gender=c1_b.Gender,
		Fathers_Husbands_GuardiansName ='',
		Maritalstatus='',
		Nationality ='',
		Nationality_Other='', 
		ClientEmailId = left(email, 60),
		CorrespondenceClientAddressline1 = left(
			case
				when len(c1_b.l_address1) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address1, '')))
				end
			+
			case
				when len(c1_b.l_address2) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address2, '')))
				end
			+
			case
				when len(c1_b.l_address3) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address3, '')))
				end, 255
			),

		CorrespondenceClientAddressline2 = '',
		CorrespondenceClientAddressline3 = '',
		CorrespondenceClientAddress_City = left(c1_b.l_city, 50),
		CorrespondenceClientAddress_State = c1_b.l_state,
		CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,
		CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),
		CorrespondenceClientAddress_Pincode = 
		case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
		else
			c1_b.l_zip
		end		,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,	
		PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
		PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
		PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
		PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,
		PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
		PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,
		PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
		PermanentClientAddress_Pincode =
		case when c1_b.P_Len='N' then 
			case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
			else
				c1_b.l_zip
			end
		else ''				 
		end,
		ISDcode_Residence ='',
		STDcode_Residence =case 
							when len(STDcode_Residence1)>0 then STDcode_Residence1
							when len(STDcode_Residence2)>0 then STDcode_Residence2
						   else '' end,	
		TelephoneNumber_Residence = 
			left(	case 
						when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')
						when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')
					else 
						'' 
					end
				, 60
				),
		Mobilenumber =left(c1_b.mobile_pager, 10),
		ISDcode_Office ='',
		STDcode_Office =case 
							when len(STDcode_Office1)>0 then STDcode_Office1
							when len(STDcode_Office2)>0 then STDcode_Office2
						   else '' end,
		TelephoneNumber_Office=
			left(	case 
						when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')
						when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')
					else 
						'' 
					end
				, 60
				),
		DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,
		UIDNUMBER='',

	
		BankName1 =bank_name,
		BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end , 
		BankAccountNo1 =bank_account_no,
		BankAccountType1 =case 
							when bank_account_type = 'SAVING' then '10'
							when bank_account_type = 'CURRENT' then '11'
							when bank_account_type = 'OTHER' then '99' 
						  else ''
							end ,
		BankName2 ='',
		BankBranchAddress2 ='',
		BankAccountNo2 ='',
		BankAccountType2 ='',
		BankName3 ='',
		BankBranchAddress3 ='',
		BankAccountNo3 ='',
		BankAccountType3 ='',
		
		DepositoryName1 =dp_name,
		DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,
		BeneficialOwnerAccountNo1 =demat_id_of_client,
		
		DepositoryName2 ='',
		DepositoryID2 ='',
		BeneficialOwnerAccountNo2 ='',
		DepositoryName3 ='',
		DepositoryID3 ='',
		BeneficialOwnerAccountNo3 ='',
		CorporateIdentitynumber_CIN='',
		GrossAnnualIncomeRange ='',
		GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,
		NetWorth_InRs ='',
		NetWorthasonDate ='',
		PoliticallyExposedPerson_PEP='0', 
		PlaceofIncorporation ='',
		Occupation ='',
		OccupationDetails_Forothers='', 
		Dateofcommencementofbusiness ='',
		CustodialParticipantCodeoftheclient ='',
		RegistrationNoofClient ='',
		RegisteringAuthority ='',
		PlaceofRegistration ='',
		DateofRegistration ='',
		InpersonVerification ='Y',
		ClientAgreementDate ='',
		UniqueClientCodeallottedbyNSCCL_BSE ='',
		UpdationFlag_for_SMS_and_Email_facility='', 
		Relationship ='',
		TypeofFacility_for_SMS_and_Email_facility ='',
		ProofType ='',
		ProofNumber ='',
		IssuePlaceofProof='', 
		IssueDateofProof ='',
		ClientStatus ='A',
		Remarks ='',
		ClientType_Corporate='', 
		NameofcontactPerson_1 ='',
		DesignationofContactPerson_1 ='',
		PANofcontactPerson_1 ='',
		AddressofcontactPerson_1 ='',
		ContactdetailsofcontactPerson_1 ='',
		DINofcontactPerson_1 ='',
		UIDofcontactPerson_1 ='',
		EmailIdofcontactPerson_1 ='',
		NameofcontactPerson_2  ='',
		DesignationofcontactPerson_2 ='',
		PANofcontactPerson_2 ='',
		AddressofcontactPerson_2 ='',
		ContactdetailsofcontactPerson_2='', 
		DINofcontactPerson_2 ='',
		UIDofcontactPerson_2 ='',
		EmailIdofcontactPerson_2 ='',
		NameofcontactPerson_3 ='',
		DesignationofcontactPerson_3='', 
		PANofcontactPerson_3 ='',
		AddressofcontactPerson_3 ='',
		ContactdetailsofcontactPerson_3='', 
		DINofcontactPerson_3 ='',
		UIDofcontactPerson_3 ='',
		EmailIdofcontactPerson_3 ='',
		NameofcontactPerson_4 ='',
		DesignationofcontactPerson_4='', 
		PANofcontactPerson_4 ='',
		AddressofcontactPerson_4 ='',
		ContactdetailsofcontactPerson_4 ='',
		DINofcontactPerson_4 ='',
		UIDofcontactPerson_4 ='',
		EmailIdofcontactPerson_4 ='',
		NameofcontactPerson_5 ='',
		DesignationofcontactPerson_5 ='',
		PANofcontactPerson_5 ='',
		AddressofcontactPerson_5 ='',
		ContactdetailsofcontactPerson_5='', 
		DINofcontactPerson_5 ='',
		UIDofcontactPerson_5 ='',
		EmailIdofcontactPerson_5 ='',
		NameofcontactPerson_6 ='',
		DesignationofcontactPerson_6='', 
		PANofcontactPerson_6 ='',
		AddressofcontactPerson_6 ='',
		ContactdetailsofcontactPerson_6='', 
		DINofcontactPerson_6 ='',
		UIDofcontactPerson_6 ='',
		EmailIdofcontactPerson_6 ='',
		NameofcontactPerson_7 ='',
		DesignationofcontactPerson_7='', 
		PANofcontactPerson_7 ='',
		AddressofcontactPerson_7 ='',
		ContactdetailsofcontactPerson_7='', 
		DINofcontactPerson_7 ='',
		UIDofcontactPerson_7 ='',
		EmailIdofcontactPerson_7 ='',
		NameofcontactPerson_8 ='',
		DesignationofcontactPerson_8 ='',
		PANofcontactPerson_8 ='',
		AddressofcontactPerson_8 ='',
		ContactdetailsofcontactPerson_8 ='',
		DINofcontactPerson_8 ='',
		UIDofcontactPerson_8 ='',
		EmailIdofcontactPerson_8 ='',
		NameofcontactPerson_9 ='',
		DesignationofcontactPerson_9='', 
		PANofcontactPerson_9 ='',
		AddressofcontactPerson_9 ='',
		ContactdetailsofcontactPerson_9='', 
		DINofcontactPerson_9 ='',
		UIDofcontactPerson_9 ='',
		EmailIdofcontactPerson_9 ='',
		NameofcontactPerson_10 ='',
		DesignationofcontactPerson_10='', 
		PANofcontactPerson_10 ='',
		AddressofcontactPerson_10 ='',
		ContactdetailsofcontactPerson_10='', 
		DINofcontactPerson_10 ='',
		UIDofcontactPerson_10 ='',
		EmailIdofcontactPerson_10 ='',
		NameofcontactPerson_11 ='',
		DesignationofcontactPerson_11='', 
		PANofcontactPerson_11 ='',
		AddressofcontactPerson_11 ='',
		ContactdetailsofcontactPerson_11='', 
		DINofcontactPerson_11 ='',
		UIDofcontactPerson_11 ='',
		EmailIdofcontactPerson_11 ='',
		NameofcontactPerson_12 ='',
		DesignationofcontactPerson_12='', 
		PANofcontactPerson_12 ='',
		AddressofcontactPerson_12 ='',
		ContactdetailsofcontactPerson_12='', 
		DINofcontactPerson_12 ='',
		UIDofcontactPerson_12 ='',
		EmailIdofcontactPerson_12 ='',
		NameofcontactPerson_13 ='',
		DesignationofcontactPerson_13 ='',
		PANofcontactPerson_13 ='',
		AddressofcontactPerson_13 ='',
		ContactdetailsofcontactPerson_13 ='',
		DINofcontactPerson_13 ='',
		UIDofcontactPerson_13 ='',
		EmailIdofcontactPerson_13 ='',
		NameofcontactPerson_14 ='',
		DesignationofcontactPerson_14 ='',
		PANofcontactPerson_14 ='',
		AddressofcontactPerson_14 ='',
		ContactdetailsofcontactPerson_14 ='',
		DINofcontactPerson_14 ='',
		UIDofcontactPerson_14 ='',
		EmailIdofcontactPerson_14 ='',
		NameofcontactPerson_15 ='',
		DesignationofcontactPerson_15 ='',
		PANofcontactPerson_15 ='',
		AddressofcontactPerson_15 ='',
		ContactdetailsofcontactPerson_15='', 
		DINofcontactPerson_15 ='',
		UIDofcontactPerson_15 ='',
		EmailIdofcontactPerson_15 ='',
		NameofcontactPerson_16 ='',
		DesignationofcontactPerson_16='', 
		PANofcontactPerson_16 ='',
		AddressofcontactPerson_16 ='',
		ContactdetailsofcontactPerson_16='', 
		DINofcontactPerson_16 ='',
		UIDofcontactPerson_16 ='',
		EmailIdofcontactPerson_16 ='',
		NameofcontactPerson_17 ='',
		DesignationofcontactPerson_17='', 
		PANofcontactPerson_17 ='',
		AddressofcontactPerson_17 ='',
		ContactdetailsofcontactPerson_17='', 
		DINofcontactPerson_17 ='',
		UIDofcontactPerson_17 ='',
		EmailIdofcontactPerson_17 ='',
		NameofcontactPerson_18 ='',
		DesignationofcontactPerson_18='', 
		PANofcontactPerson_18 ='',
		AddressofcontactPerson_18 ='',
		ContactdetailsofcontactPerson_18='', 
		DINofcontactPerson_18 ='',
		UIDofcontactPerson_18 ='',
		EmailIdofcontactPerson_18 ='',
		NameofcontactPerson_19 ='',
		DesignationofcontactPerson_19='', 
		PANofcontactPerson_19 ='',
		AddressofcontactPerson_19 ='',
		ContactdetailsofcontactPerson_19='', 
		DINofcontactPerson_19 ='',
		UIDofcontactPerson_19 ='',
		EmailIdofcontactPerson_19 ='',
		NameofcontactPerson_20 ='',
		DesignationofcontactPerson_20='', 
		PANofcontactPerson_20 ='',
		AddressofcontactPerson_20 ='',
		ContactdetailsofcontactPerson_20='', 
		DINofcontactPerson_20 ='',
		UIDofcontactPerson_20 ='',
		EmailIdofcontactPerson_20 ='',
		Flag='E'
	from
		(
			select
				c1.*,
				b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_Client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
		#temp_Client2 c2 with (nolock),
		#temp_Client5 c5 with (nolock)

	where
		ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and
		ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and
		ltrim(rtrim(left(c2.party_code,2))) <> '98'
		

	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),
	    RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''),
	    --MASTERPAN=ISNULL(c1.MASTERPAN,''),
	    TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),
		--Gender=isnull(c1.Gender,''),
		Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=
					case when mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		GrossAnnualIncomeRange=case 
					when c1.Gross_Income ='01' then '1'
					when c1.Gross_Income ='02' then '2'
					when c1.Gross_Income ='03' then '3'
					when c1.Gross_Income ='04' then '4'
					when c1.Gross_Income ='05' then '5'
					when c1.Gross_Income ='06' then '6'
					when c1.Gross_Income ='07' then '7'
					else '' end, 
		NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''
						else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,
		PoliticallyExposedPerson_PEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end,
		OccupationDetails_Forothers=isnull(Occupation_Other,''),
		UIDNUMBER=isnull(c1.AADHAR_UID,'')
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0			
	
	update 
		mimansa_angel_ucc_nse_slb_client_data_new_changes 
	set 
		GrossAnnualIncomeasonDate='',
		NetWorth_InRs='',
		NetWorthasonDate=''
	where len(GrossAnnualIncomeRange)=0 

	
	update
		mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,'')
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4	

	set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN
-- --------------------------------------------------
-- [mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015] 'Feb 10 2015','Feb 10 2015','',''  
CREATE proc  [dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN]  
 (  
 @from_date varchar(20),  
 @to_date varchar(20),  
 @ClientCode varchar(20),  
 --@selected_clients_only char(1),  
 @processid varchar(50)  
 )  
as  
--mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015 'Feb 10 2014','Feb 10 2014','',''  
 /*Parameter Vertualization*/  
 Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,  
   @@FromClientCode varchar(20),@@ToClientCode varchar(20)  
  
/*Initialized Parameters*/  
 if isnull(@from_date,'')='' or isnull(@to_date,'')=''  
 begin  
  set @@FromDate='Jan  1 1900'  
  set @@ToDate='Dec 31 2078'  
 end  
 else  
 begin  
  set @@FromDate=@from_date  
  set @@ToDate=@to_date+' 23:59'  
 end  
  
 if isnull(@ClientCode,'')=''  
 begin  
  set @@FromClientCode='A'  
  set @@ToClientCode='ZZZZZZZZZZ'  
 end  
 else  
 begin  
  set @@FromClientCode=@ClientCode  
  set @@ToClientCode=@ClientCode  
 end  
  
 set @@getdate=left(getdate(),11)+' 23:59'  
  
 --declare @totalrecord as numeric  
  
select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0  
  
if isnull(@processid,'')=''  
begin  
 print 'DATARANGE'  
  insert into #codes_to_process  
  select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))  
  from NSESLBS.dbo.client5 c5 with(nolock)  
  where cl_code>=@@FromClientCode  
    and cl_code<=@@ToClientCode   
    and c5.inactivefrom >@@getdate   
    and activefrom >= @@FromDate  
    and activefrom <= @@ToDate  
  --select @totalrecord = count(*) from #codes_to_process  
  
end  
else  
begin  
 print 'SELECTED'  
  insert into #codes_to_process  
  select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))  
  from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)  
  where c5.cl_code=A.party_code  
    and c5.cl_code>=@@FromClientCode  
    and c5.cl_code<=@@ToClientCode  
    and A.processid=@processid   
  
  --select @totalrecord = count(*) from #codes_to_process  
  
  /*Delete selected clients*/   
  delete from tblUCCClientCode where processid=@processid   
end  
  
 /*******************FETCH DATA**************************/  
  
 --truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes  
   
  
CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(  
 [Segment] [varchar](1) NULL,  
 [Client_Code] [varchar](10) NULL,  
 [Client_Name] [varchar](150) NULL,  
 [Category] [varchar](10) NULL,  
 [PAN] [varchar](10) NULL,  
 [Gender] [varchar](2) NULL,  
 [Fathers_Husbands_GuardiansName] [varchar](150) NULL,  
 [Maritalstatus] [varchar](2) NULL,  
 [Nationality] [varchar](2) NULL,  
 [Nationality_Other] [varchar](50) NULL,  
 [ClientEmailId] [varchar](60) NULL,  
 [CorrespondenceClientAddressline1] [varchar](255) NULL,  
 [CorrespondenceClientAddressline2] [varchar](255) NULL,  
 [CorrespondenceClientAddressline3] [varchar](255) NULL,  
 [CorrespondenceClientAddress_City] [varchar](50) NULL,  
 [CorrespondenceClientAddress_State] [varchar](2) NULL,  
 [CorrespondenceClientAddress_State_Others] [varchar](75) NULL,  
 [CorrespondenceClientAddress_Country] [varchar](3) NULL,  
 [CorrespondenceClientAddress_Pincode] [varchar](10) NULL,  
 [FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,  
 [PermanentClientAddressline1] [varchar](255) NULL,  
 [PermanentClientAddressline2] [varchar](255) NULL,  
 [PermanentClientAddressline3] [varchar](255) NULL,  
 [PermanentClientAddress_City] [varchar](50) NULL,  
 [PermanentClientAddress_State] [varchar](2) NULL,  
 [PermanentClientAddress_StateOthers] [varchar](75) NULL,  
 [PermanentClientAddress_Country] [varchar](2) NULL,  
 [PermanentClientAddress_Pincode] [varchar](10) NULL,  
 [ISDcode_Residence] [varchar](10) NULL,  
 [STDcode_Residence] [varchar](10) NULL,  
 [TelephoneNumber_Residence] [varchar](60) NULL,  
 [Mobilenumber] [varchar](20) NULL,  
 [ISDcode_Office] [varchar](10) NULL,  
 [STDcode_Office] [varchar](10) NULL,   [TelephoneNumber_Office] [varchar](60) NULL,  
 [DateofBirth_Incorporation] [varchar](60) NULL,  
 [UIDNUMBER] [varchar](12) NULL,  
 [BankName1] [varchar](60) NULL,  
 [BankBranchAddress1] [varchar](255) NULL,  
 [BankAccountNo1] [varchar](25) NULL,  
 [BankAccountType1] [varchar](2) NULL,  
 [BankName2] [varchar](60) NULL,  
 [BankBranchAddress2] [varchar](255) NULL,  
 [BankAccountNo2] [varchar](25) NULL,  
 [BankAccountType2] [varchar](2) NULL,  
 [BankName3] [varchar](60) NULL,  
 [BankBranchAddress3] [varchar](255) NULL,  
 [BankAccountNo3] [varchar](25) NULL,  
 [BankAccountType3] [varchar](2) NULL,  
 [DepositoryName1] [varchar](4) NULL,  
 [DepositoryID1] [varchar](8) NULL,  
 [BeneficialOwnerAccountNo1] [varchar](16) NULL,  
 [DepositoryName2] [varchar](4) NULL,  
 [DepositoryID2] [varchar](8) NULL,  
 [BeneficialOwnerAccountNo2] [varchar](16) NULL,  
 [DepositoryName3] [varchar](4) NULL,  
 [DepositoryID3] [varchar](8) NULL,  
 [BeneficialOwnerAccountNo3] [varchar](16) NULL,  
 [CorporateIdentitynumber_CIN] [varchar](21) NULL,  
 [GrossAnnualIncomeRange] [varchar](40) NULL,  
 [GrossAnnualIncomeasonDate] [varchar](40) NULL,  
 [NetWorth_InRs] [varchar](40) NULL,  
 [NetWorthasonDate] [varchar](40) NULL,  
 [PoliticallyExposedPerson_PEP] [varchar](2) NULL,  
 [PlaceofIncorporation] [varchar](75) NULL,  
 [Occupation] [varchar](2) NULL,  
 [OccupationDetails_Forothers] [varchar](75) NULL,  
 [Dateofcommencementofbusiness] [varchar](40) NULL,  
 [CustodialParticipantCodeoftheclient] [varchar](15) NULL,  
 [RegistrationNoofClient] [varchar](25) NULL,  
 [RegisteringAuthority] [varchar](60) NULL,  
 [PlaceofRegistration] [varchar](25) NULL,  
 [DateofRegistration] [varchar](40) NULL,  
 [InpersonVerification] [varchar](1) NULL,  
 [ClientAgreementDate] [varchar](40) NULL,  
 [UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,  
 [UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,  
 [Relationship] [varchar](1) NULL,  
 [TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,  
 [ProofType] [varchar](1) NULL,  
 [ProofNumber] [varchar](25) NULL,  
 [IssuePlaceofProof] [varchar](100) NULL,  
 [IssueDateofProof] [varchar](40) NULL,  
 [ClientStatus] [varchar](1) NULL,  
 [Remarks] [varchar](200) NULL,  
 [ClientType_Corporate] [varchar](200) NULL,  
 [NameofcontactPerson_1] [varchar](200) NULL,  
 [DesignationofContactPerson_1] [varchar](200) NULL,  
 [PANofcontactPerson_1] [varchar](200) NULL,  
 [AddressofcontactPerson_1] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_1] [varchar](200) NULL,  
 [DINofcontactPerson_1] [varchar](200) NULL,  
 [UIDofcontactPerson_1] [varchar](200) NULL,  
 [EmailIdofcontactPerson_1] [varchar](200) NULL,  
 [NameofcontactPerson_2] [varchar](200) NULL,  
 [DesignationofcontactPerson_2] [varchar](200) NULL,  
 [PANofcontactPerson_2] [varchar](200) NULL,  
 [AddressofcontactPerson_2] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_2] [varchar](200) NULL,  
 [DINofcontactPerson_2] [varchar](200) NULL,  
 [UIDofcontactPerson_2] [varchar](200) NULL,  
 [EmailIdofcontactPerson_2] [varchar](200) NULL,  
 [NameofcontactPerson_3] [varchar](200) NULL,  
 [DesignationofcontactPerson_3] [varchar](200) NULL,  
 [PANofcontactPerson_3] [varchar](200) NULL,  
 [AddressofcontactPerson_3] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_3] [varchar](200) NULL,  
 [DINofcontactPerson_3] [varchar](200) NULL,  
 [UIDofcontactPerson_3] [varchar](200) NULL,  
 [EmailIdofcontactPerson_3] [varchar](200) NULL,  
 [NameofcontactPerson_4] [varchar](200) NULL,  
 [DesignationofcontactPerson_4] [varchar](200) NULL,  
 [PANofcontactPerson_4] [varchar](200) NULL,  
 [AddressofcontactPerson_4] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_4] [varchar](200) NULL,  
 [DINofcontactPerson_4] [varchar](200) NULL,  
 [UIDofcontactPerson_4] [varchar](200) NULL,  
 [EmailIdofcontactPerson_4] [varchar](200) NULL,  
 [NameofcontactPerson_5] [varchar](200) NULL,  
 [DesignationofcontactPerson_5] [varchar](200) NULL,  
 [PANofcontactPerson_5] [varchar](200) NULL,  
 [AddressofcontactPerson_5] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_5] [varchar](200) NULL,  
 [DINofcontactPerson_5] [varchar](200) NULL,  
 [UIDofcontactPerson_5] [varchar](200) NULL,  
 [EmailIdofcontactPerson_5] [varchar](200) NULL,  
 [NameofcontactPerson_6] [varchar](200) NULL,  
 [DesignationofcontactPerson_6] [varchar](200) NULL,  
 [PANofcontactPerson_6] [varchar](200) NULL,  
 [AddressofcontactPerson_6] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_6] [varchar](200) NULL,  
 [DINofcontactPerson_6] [varchar](200) NULL,  
 [UIDofcontactPerson_6] [varchar](200) NULL,  
 [EmailIdofcontactPerson_6] [varchar](200) NULL,  
 [NameofcontactPerson_7] [varchar](200) NULL,  
 [DesignationofcontactPerson_7] [varchar](200) NULL,  
 [PANofcontactPerson_7] [varchar](200) NULL,  
 [AddressofcontactPerson_7] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_7] [varchar](200) NULL,  
 [DINofcontactPerson_7] [varchar](200) NULL,  
 [UIDofcontactPerson_7] [varchar](200) NULL,  
 [EmailIdofcontactPerson_7] [varchar](200) NULL,  
 [NameofcontactPerson_8] [varchar](200) NULL,  
 [DesignationofcontactPerson_8] [varchar](200) NULL,  
 [PANofcontactPerson_8] [varchar](200) NULL,  
 [AddressofcontactPerson_8] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_8] [varchar](200) NULL,  
 [DINofcontactPerson_8] [varchar](200) NULL,  
 [UIDofcontactPerson_8] [varchar](200) NULL,  
 [EmailIdofcontactPerson_8] [varchar](200) NULL,  
 [NameofcontactPerson_9] [varchar](200) NULL,  
 [DesignationofcontactPerson_9] [varchar](200) NULL,  
 [PANofcontactPerson_9] [varchar](200) NULL,  
 [AddressofcontactPerson_9] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_9] [varchar](200) NULL,  
 [DINofcontactPerson_9] [varchar](200) NULL,  
 [UIDofcontactPerson_9] [varchar](200) NULL,  
 [EmailIdofcontactPerson_9] [varchar](200) NULL,  
 [NameofcontactPerson_10] [varchar](200) NULL,  
 [DesignationofcontactPerson_10] [varchar](200) NULL,  
 [PANofcontactPerson_10] [varchar](200) NULL,  
 [AddressofcontactPerson_10] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_10] [varchar](200) NULL,  
 [DINofcontactPerson_10] [varchar](200) NULL,  
 [UIDofcontactPerson_10] [varchar](200) NULL,  
 [EmailIdofcontactPerson_10] [varchar](200) NULL,  
 [NameofcontactPerson_11] [varchar](200) NULL,  
 [DesignationofcontactPerson_11] [varchar](200) NULL,  
 [PANofcontactPerson_11] [varchar](200) NULL,  
 [AddressofcontactPerson_11] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_11] [varchar](200) NULL,  
 [DINofcontactPerson_11] [varchar](200) NULL,  
 [UIDofcontactPerson_11] [varchar](200) NULL,  
 [EmailIdofcontactPerson_11] [varchar](200) NULL,  
 [NameofcontactPerson_12] [varchar](200) NULL,  
 [DesignationofcontactPerson_12] [varchar](200) NULL,  
 [PANofcontactPerson_12] [varchar](200) NULL,  
 [AddressofcontactPerson_12] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_12] [varchar](200) NULL,  
 [DINofcontactPerson_12] [varchar](200) NULL,  
 [UIDofcontactPerson_12] [varchar](200) NULL,  
 [EmailIdofcontactPerson_12] [varchar](200) NULL,  
 [NameofcontactPerson_13] [varchar](200) NULL,  
 [DesignationofcontactPerson_13] [varchar](200) NULL,  
 [PANofcontactPerson_13] [varchar](200) NULL,  
 [AddressofcontactPerson_13] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_13] [varchar](200) NULL,  
 [DINofcontactPerson_13] [varchar](200) NULL,  
 [UIDofcontactPerson_13] [varchar](200) NULL,  
 [EmailIdofcontactPerson_13] [varchar](200) NULL,  
 [NameofcontactPerson_14] [varchar](200) NULL,  
 [DesignationofcontactPerson_14] [varchar](200) NULL,  
 [PANofcontactPerson_14] [varchar](200) NULL,  
 [AddressofcontactPerson_14] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_14] [varchar](200) NULL,  
 [DINofcontactPerson_14] [varchar](200) NULL,  
 [UIDofcontactPerson_14] [varchar](200) NULL,  
 [EmailIdofcontactPerson_14] [varchar](200) NULL,  
 [NameofcontactPerson_15] [varchar](200) NULL,  
 [DesignationofcontactPerson_15] [varchar](200) NULL,  
 [PANofcontactPerson_15] [varchar](200) NULL,  
 [AddressofcontactPerson_15] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_15] [varchar](200) NULL,  
 [DINofcontactPerson_15] [varchar](200) NULL,  
 [UIDofcontactPerson_15] [varchar](200) NULL,  
 [EmailIdofcontactPerson_15] [varchar](200) NULL,  
 [NameofcontactPerson_16] [varchar](200) NULL,  
 [DesignationofcontactPerson_16] [varchar](200) NULL,  
 [PANofcontactPerson_16] [varchar](200) NULL,  
 [AddressofcontactPerson_16] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_16] [varchar](200) NULL,  
 [DINofcontactPerson_16] [varchar](200) NULL,  
 [UIDofcontactPerson_16] [varchar](200) NULL,  
 [EmailIdofcontactPerson_16] [varchar](200) NULL,  
 [NameofcontactPerson_17] [varchar](200) NULL,  
 [DesignationofcontactPerson_17] [varchar](200) NULL,  
 [PANofcontactPerson_17] [varchar](200) NULL,  
 [AddressofcontactPerson_17] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_17] [varchar](200) NULL,  
 [DINofcontactPerson_17] [varchar](200) NULL,  
 [UIDofcontactPerson_17] [varchar](200) NULL,  
 [EmailIdofcontactPerson_17] [varchar](200) NULL,  
 [NameofcontactPerson_18] [varchar](200) NULL,  
 [DesignationofcontactPerson_18] [varchar](200) NULL,  
 [PANofcontactPerson_18] [varchar](200) NULL,  
 [AddressofcontactPerson_18] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_18] [varchar](200) NULL,  
 [DINofcontactPerson_18] [varchar](200) NULL,  
 [UIDofcontactPerson_18] [varchar](200) NULL,  
 [EmailIdofcontactPerson_18] [varchar](200) NULL,  
 [NameofcontactPerson_19] [varchar](200) NULL,  
 [DesignationofcontactPerson_19] [varchar](200) NULL,  
 [PANofcontactPerson_19] [varchar](200) NULL,  
 [AddressofcontactPerson_19] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_19] [varchar](200) NULL,  
 [DINofcontactPerson_19] [varchar](200) NULL,  
 [UIDofcontactPerson_19] [varchar](200) NULL,  
 [EmailIdofcontactPerson_19] [varchar](200) NULL,  
 [NameofcontactPerson_20] [varchar](200) NULL,  
 [DesignationofcontactPerson_20] [varchar](200) NULL,  
 [PANofcontactPerson_20] [varchar](200) NULL,  
 [AddressofcontactPerson_20] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_20] [varchar](200) NULL,  
 [DINofcontactPerson_20] [varchar](200) NULL,  
 [UIDofcontactPerson_20] [varchar](200) NULL,  
 [EmailIdofcontactPerson_20] [varchar](200) NULL,  
 [POAforFunds] [varchar](1) NULL,  
 [POAforSecurities] [varchar](1) NULL,  
 [Flag] [varchar](1) NULL  
)  
   
 --insert into   
 -- angel_ucc_nse_fo_client1  
 select  
  --party_code=ltrim(rtrim(c2.party_code)), --Commented by Arjun Singh on Dec 14 2018 on Mail of KYC/UCC Team  
  party_code=ltrim(rtrim(upper(c2.party_code))), -- Change to upper by Arjun Singh on Dec 14 2018 on Mail of KYC/UCC Team  
  Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),  
  Short_Name=ltrim(rtrim(isnull(Short_Name,''))),  
  Long_Name=ltrim(rtrim(isnull(Long_Name,''))),  
  L_Address1=ltrim(rtrim(isnull(L_Address1,''))),  
  L_Address2=ltrim(rtrim(isnull(L_Address2,''))),  
  L_Address3=ltrim(rtrim(isnull(L_Address3,''))),  
  L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),  
  L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),  
  L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),  
  L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),  
  L_Zip=ltrim(rtrim(isnull(L_Zip,''))),  
  --Fax=ltrim(rtrim(isnull(Fax,''))),  
  Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),  
  Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),  
  Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),  
  Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),  
  Email=ltrim(rtrim(isnull(Email,''))),  
  --Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),  
  --Credit_Limit=ltrim(rtrim(Credit_Limit)),  
  Cl_type=ltrim(rtrim(isnull(Cl_type,''))),  
  Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),  
  --Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),  
  --Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),  
  --Family=ltrim(rtrim(isnull(Family,''))),  
  --Penalty=ltrim(rtrim(Penalty)),  
  --Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),  
  --Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),  
  --PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),  
  Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),  
  pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),  
  --trader=ltrim(rtrim(isnull(trader,''))),  
  --Ward_No=ltrim(rtrim(isnull(Ward_No,''))),  
  --Region=ltrim(rtrim(isnull(Region,''))),  
  --Area=ltrim(rtrim(isnull(Area,''))),  
  --Clrating=ltrim(rtrim(isnull(Clrating,'')))  
  P_address1=cast('' as varchar(255)),  
  P_address2=cast('' as varchar(255)),  
  P_address3=cast('' as varchar(255)),  
  P_City=cast('' as varchar(50)),  
  P_State=cast('' as varchar(100)),  
  P_State_For_Other=cast('' as varchar(100)),  
  P_nation=cast('' as varchar(100)),  
  P_zip=cast('' as varchar(10)),  
  P_Len=cast('' as varchar(1)),   
  Gender=cast('' as varchar(1)),  
  STDcode_Residence1=cast('' as varchar(10)),  
  STDcode_Residence2=cast('' as varchar(10)),  
  STDcode_Office1=cast('' as varchar(10)),  
  STDcode_Office2=cast('' as varchar(10))  
 into   
  #temp_client1   
 from   
  NSESLBS.dbo.client1 c1 with(nolock),  
  NSESLBS.dbo.client2 c2 with(nolock),  
  #codes_to_process t with (nolock)  
 where   
  c1.cl_code = c2.cl_code and   
  c2.party_code = t.party_code   
  
 UPDATE #temp_Client1  
    SET Long_Name = '';  
  
 update #temp_client1 set   
  Long_Name=ltrim(rtrim(upper(c1.addemailid))), -- Added PAN Name by Arjun Singh on Dec 14 2018 on Mail of KYC/UCC Team  
  P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),  
  P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),  
  P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),  
  P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),  
  P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),  
  P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),  
  P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),  
  P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),  
  P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and   
      len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0  
    then 'N' else 'Y' end ,  
  Gender=ltrim(rtrim(isnull(c1.sex,''))),  
  STDcode_Residence1=isnull(Res_phone1_std,''),  
  STDcode_Residence2=isnull(Res_phone1_std,''),  
  STDcode_Office1=isnull(Off_phone1_std,''),  
  STDcode_Office2=isnull(off_phone2_std,'')  
 from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)  
 where t1.Cl_Code=c1.cl_code  
  
 update   
  #temp_Client1   
 set   
 L_State= dbo.fn_state_countary_value(l_state,'STATE'),  
 P_State=dbo.fn_state_countary_value(P_state,'STATE'),  
 L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),  
 P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),  
 cl_status=case  
    /*INDIVIDUAL/PROPRIETORSHIP FIRMS*/  
    when cl_status = 'IND' then '1'  /*INDIVIDUAL*/  
  
    /*PARTNERSHIP FIRM*/  
    when cl_status = 'PF' or cl_status='LLP' then '2'  /*PARTNERSHIP FIRMS*/  
  
    /*HUF*/  
    when cl_status = 'HUF' then '3'  /*HINDU UNDIVIDED FAMILY*/  
  
    /*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/  
    when cl_status = 'PPB' then '4'  /*PUB. PVT COMP/BODIES CORP*/  
    when cl_status = 'BCP' then '4'  /*BODY CORPORATE*/  
  
    /*TRUST / SOCIETY*/  
    when cl_status = 'TS' then '5'  /*TRUST / SOCIETY*/  
  
    /*MUTUAL FUND*/  
    when cl_status = 'MF' then '6'  /*MUTUAL FUNDS*/  
    when cl_status = 'MFF' then '6'  /*MUTUAL FUND (MF)*/  
  
    /*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/  
    when cl_status = 'IFI' then '7'  /*INDIAN FINANCIAL INSTI*/  
    when cl_status = 'DFI' then '7'  /*DOMESTIC FIN. INST.*/  
  
    /*BANK*/  
    when cl_status = 'BA' then ' 8'  /*BANKS*/  
    when cl_status = 'BNK' then '8'  /*BANK*/  
  
    /*INSURANCE*/  
    when cl_status = 'IC' then ' 9'  /*INSURANCE COMPANIES*/  
  
    /*STATUTORY BODIES*/  
    when cl_status = 'SB' then ' 10'  /*STATUTORY BODIES*/  
  
    /*NRI*/  
    when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'  /*NON RESIDENT INDIAN*/  
  
    /*FII*/  
    when cl_status = 'FII' then '12'  /*FOREIGN INSTIT INVESTORS*/  
  
    /*OCB*/  
    when cl_status = 'OCB' then '13'  /*OVERSEAS CORPORATE BODIES*/  
  
    /*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/  
    when cl_status = 'DFN' then '14'  /*DIRECT FOREIGN INVESTMENTS*/  
  
    when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/  
      
    /*FVC*/  
    when cl_status = 'FVC' then '20'  /*FOREIGN VENTURE CAPITAL FUNDS*/  
   else  
    '1'  /*INDIVIDUAL*/  
   end  
  
   
 select   
  Cl_Code, Party_code=c2.Party_code  
 into #temp_client2   
 from   
  NSESLBS.dbo.client2 c2 with(nolock),  
  #codes_to_process t with (nolock)  
 where   
  c2.party_code = t.party_code  
   
 select   
  party_code = ltrim(rtrim(t.party_code)),  
  --c5.*  
  cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),  
  --BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),  
  BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),  
  --ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */  
  ActiveFrom=c5.ActiveFrom,  
  InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),  
  GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))  
 into #temp_Client5   
 from   
  NSESLBS.dbo.client5 c5 with(nolock),  
  #temp_Client2 t with (nolock)  
 where   
  c5.cl_code = t.cl_code  
  
 select distinct  
  party_code = ltrim(rtrim(c4.party_code)),  
  bank_id = ltrim(rtrim(c4.bankid)),  
  bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),  
  bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1)
 + ltrim(rtrim(isnull(b.nation, ''))),  
  account_type = ltrim(rtrim(c4.depository)),  
  account_no = ltrim(rtrim(c4.cltdpid))  
 into  
  #pobank  
 from  
  #codes_to_process t with (nolock),  
  NSESLBS.dbo.client4 c4 with(nolock),  
  NSESLBS.dbo.pobank b with(nolock)  
 where  
  t.party_code = c4.party_code and  
  c4.bankid = b.bankid and  
  isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')  
  
 select distinct  
  party_code = ltrim(rtrim(c4.party_code)),  
  bank_id = ltrim(rtrim(c4.bankid)),  
  bank_name = ltrim(rtrim(isnull(b.bankname, ''))),  
  bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),  
  account_type = ltrim(rtrim(c4.depository)),  
  account_no = ltrim(rtrim(c4.cltdpid))  
 into  
  #bank  
 from  
  #codes_to_process t with (nolock),  
  NSESLBS.dbo.client4 c4 with(nolock),  
  NSESLBS.dbo.bank b with(nolock)  
 where  
  t.party_code = c4.party_code and  
  c4.bankid = b.bankid and  
  isnull(c4.depository, '') in ('CDSL', 'NSDL') and  
  isnull(c4.defdp, '') = '1'  
  
 --insert into  
 -- angel_ucc_nse_fo_client_bank  
 select distinct  
  party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),  
  bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),  
  bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),  
  bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),  
  bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),  
  
  dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),  
  dp_name = ltrim(rtrim(isnull(b.account_type, ''))),  
  depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),  
  demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))  
 into #temp_client_bank   
 from  
  #pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))  
 order by  
  ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))  
  
  
 /*******************END - FETCH DATA**************************/  
  
 insert into  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
  (  
   Segment ,  
   Client_Code ,  
   Client_Name ,  
   Category ,  
   PAN ,  
   Gender ,  
   Fathers_Husbands_GuardiansName ,  
   Maritalstatus ,  
   Nationality ,  
   Nationality_Other ,  
   ClientEmailId ,  
   CorrespondenceClientAddressline1 ,  
   CorrespondenceClientAddressline2 ,  
   CorrespondenceClientAddressline3 ,  
   CorrespondenceClientAddress_City ,  
   CorrespondenceClientAddress_State ,  
   CorrespondenceClientAddress_State_Others ,  
   CorrespondenceClientAddress_Country ,  
   CorrespondenceClientAddress_Pincode ,  
   FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,  
   PermanentClientAddressline1 ,  
   PermanentClientAddressline2 ,  
   PermanentClientAddressline3 ,  
   PermanentClientAddress_City ,  
   PermanentClientAddress_State ,  
   PermanentClientAddress_StateOthers ,  
   PermanentClientAddress_Country ,  
   PermanentClientAddress_Pincode ,  
   ISDcode_Residence ,  
   STDcode_Residence ,  
   TelephoneNumber_Residence ,  
   Mobilenumber ,  
   ISDcode_Office ,  
   STDcode_Office ,  
   TelephoneNumber_Office ,  
   DateofBirth_Incorporation ,  
   UIDNUMBER ,  
   BankName1 ,  
   BankBranchAddress1 ,  
   BankAccountNo1 ,  
   BankAccountType1 ,  
   BankName2 ,  
   BankBranchAddress2 ,  
   BankAccountNo2 ,  
   BankAccountType2 ,  
   BankName3 ,  
   BankBranchAddress3 ,  
   BankAccountNo3 ,  
   BankAccountType3 ,  
   DepositoryName1 ,  
   DepositoryID1 ,  
   BeneficialOwnerAccountNo1 ,  
   DepositoryName2 ,  
   DepositoryID2 ,  
   BeneficialOwnerAccountNo2 ,  
   DepositoryName3 ,  
   DepositoryID3 ,  
   BeneficialOwnerAccountNo3 ,  
   CorporateIdentitynumber_CIN ,  
   GrossAnnualIncomeRange ,  
   GrossAnnualIncomeasonDate ,  
   NetWorth_InRs ,  
   NetWorthasonDate ,  
   PoliticallyExposedPerson_PEP ,  
   PlaceofIncorporation ,  
   Occupation ,  
   OccupationDetails_Forothers ,  
   Dateofcommencementofbusiness ,  
   CustodialParticipantCodeoftheclient ,  
   RegistrationNoofClient ,  
   RegisteringAuthority ,  
   PlaceofRegistration ,  
   DateofRegistration ,  
   InpersonVerification ,  
   ClientAgreementDate ,  
   UniqueClientCodeallottedbyNSCCL_BSE ,  
   UpdationFlag_for_SMS_and_Email_facility ,  
   Relationship ,  
   TypeofFacility_for_SMS_and_Email_facility ,  
   ProofType ,  
   ProofNumber ,  
   IssuePlaceofProof ,  
   IssueDateofProof ,  
   ClientStatus ,  
   Remarks ,  
   ClientType_Corporate ,  
   NameofcontactPerson_1 ,  
   DesignationofContactPerson_1 ,  
   PANofcontactPerson_1 ,  
   AddressofcontactPerson_1 ,  
   ContactdetailsofcontactPerson_1 ,  
   DINofcontactPerson_1 ,  
   UIDofcontactPerson_1 ,  
   EmailIdofcontactPerson_1 ,  
   NameofcontactPerson_2 ,  
   DesignationofcontactPerson_2 ,  
   PANofcontactPerson_2 ,  
   AddressofcontactPerson_2 ,  
   ContactdetailsofcontactPerson_2 ,  
   DINofcontactPerson_2 ,  
   UIDofcontactPerson_2 ,  
   EmailIdofcontactPerson_2 ,  
   NameofcontactPerson_3 ,  
   DesignationofcontactPerson_3 ,  
   PANofcontactPerson_3 ,  
   AddressofcontactPerson_3 ,  
   ContactdetailsofcontactPerson_3 ,  
   DINofcontactPerson_3 ,  
   UIDofcontactPerson_3 ,  
   EmailIdofcontactPerson_3 ,  
   NameofcontactPerson_4 ,  
   DesignationofcontactPerson_4 ,  
   PANofcontactPerson_4 ,  
   AddressofcontactPerson_4 ,  
   ContactdetailsofcontactPerson_4 ,  
   DINofcontactPerson_4 ,  
   UIDofcontactPerson_4 ,  
   EmailIdofcontactPerson_4 ,  
   NameofcontactPerson_5 ,  
   DesignationofcontactPerson_5 ,  
   PANofcontactPerson_5 ,  
   AddressofcontactPerson_5 ,  
   ContactdetailsofcontactPerson_5 ,  
   DINofcontactPerson_5 ,  
   UIDofcontactPerson_5 ,  
   EmailIdofcontactPerson_5 ,  
   NameofcontactPerson_6 ,  
   DesignationofcontactPerson_6 ,  
   PANofcontactPerson_6 ,  
   AddressofcontactPerson_6 ,  
   ContactdetailsofcontactPerson_6 ,  
   DINofcontactPerson_6 ,  
   UIDofcontactPerson_6 ,  
   EmailIdofcontactPerson_6 ,  
   NameofcontactPerson_7 ,  
   DesignationofcontactPerson_7 ,  
   PANofcontactPerson_7 ,  
   AddressofcontactPerson_7 ,  
   ContactdetailsofcontactPerson_7 ,  
   DINofcontactPerson_7 ,  
   UIDofcontactPerson_7 ,  
   EmailIdofcontactPerson_7 ,  
   NameofcontactPerson_8 ,  
   DesignationofcontactPerson_8 ,  
   PANofcontactPerson_8 ,  
   AddressofcontactPerson_8 ,  
   ContactdetailsofcontactPerson_8 ,  
   DINofcontactPerson_8 ,  
   UIDofcontactPerson_8 ,  
   EmailIdofcontactPerson_8 ,  
   NameofcontactPerson_9 ,  
   DesignationofcontactPerson_9 ,  
   PANofcontactPerson_9 ,  
   AddressofcontactPerson_9 ,  
   ContactdetailsofcontactPerson_9 ,  
   DINofcontactPerson_9 ,  
   UIDofcontactPerson_9 ,  
   EmailIdofcontactPerson_9 ,  
   NameofcontactPerson_10 ,  
   DesignationofcontactPerson_10 ,  
   PANofcontactPerson_10 ,  
   AddressofcontactPerson_10 ,  
   ContactdetailsofcontactPerson_10 ,  
   DINofcontactPerson_10 ,  
   UIDofcontactPerson_10 ,  
   EmailIdofcontactPerson_10 ,  
   NameofcontactPerson_11 ,  
   DesignationofcontactPerson_11 ,  
   PANofcontactPerson_11 ,  
   AddressofcontactPerson_11 ,  
   ContactdetailsofcontactPerson_11 ,  
   DINofcontactPerson_11 ,  
   UIDofcontactPerson_11 ,  
   EmailIdofcontactPerson_11 ,  
   NameofcontactPerson_12 ,  
   DesignationofcontactPerson_12 ,  
   PANofcontactPerson_12 ,  
   AddressofcontactPerson_12 ,  
   ContactdetailsofcontactPerson_12 ,  
   DINofcontactPerson_12 ,  
   UIDofcontactPerson_12 ,  
   EmailIdofcontactPerson_12 ,  
   NameofcontactPerson_13 ,  
   DesignationofcontactPerson_13 ,  
   PANofcontactPerson_13 ,  
   AddressofcontactPerson_13 ,  
   ContactdetailsofcontactPerson_13 ,  
   DINofcontactPerson_13 ,  
   UIDofcontactPerson_13 ,  
   EmailIdofcontactPerson_13 ,  
   NameofcontactPerson_14 ,  
   DesignationofcontactPerson_14 ,  
   PANofcontactPerson_14 ,  
   AddressofcontactPerson_14 ,  
   ContactdetailsofcontactPerson_14 ,  
   DINofcontactPerson_14 ,  
   UIDofcontactPerson_14 ,  
   EmailIdofcontactPerson_14 ,  
   NameofcontactPerson_15 ,  
   DesignationofcontactPerson_15 ,  
   PANofcontactPerson_15 ,  
   AddressofcontactPerson_15 ,  
   ContactdetailsofcontactPerson_15 ,  
   DINofcontactPerson_15 ,  
   UIDofcontactPerson_15 ,  
   EmailIdofcontactPerson_15 ,  
   NameofcontactPerson_16 ,  
   DesignationofcontactPerson_16 ,  
   PANofcontactPerson_16 ,  
   AddressofcontactPerson_16 ,  
   ContactdetailsofcontactPerson_16 ,  
   DINofcontactPerson_16 ,  
   UIDofcontactPerson_16 ,  
   EmailIdofcontactPerson_16 ,  
   NameofcontactPerson_17 ,  
   DesignationofcontactPerson_17 ,  
   PANofcontactPerson_17 ,  
   AddressofcontactPerson_17 ,  
   ContactdetailsofcontactPerson_17 ,  
   DINofcontactPerson_17 ,  
   UIDofcontactPerson_17 ,  
   EmailIdofcontactPerson_17 ,  
   NameofcontactPerson_18 ,  
   DesignationofcontactPerson_18 ,  
   PANofcontactPerson_18 ,  
   AddressofcontactPerson_18 ,  
   ContactdetailsofcontactPerson_18 ,  
   DINofcontactPerson_18 ,  
   UIDofcontactPerson_18 ,  
   EmailIdofcontactPerson_18 ,  
   NameofcontactPerson_19 ,  
   DesignationofcontactPerson_19 ,  
   PANofcontactPerson_19 ,  
   AddressofcontactPerson_19 ,  
   ContactdetailsofcontactPerson_19 ,  
   DINofcontactPerson_19 ,  
   UIDofcontactPerson_19 ,  
   EmailIdofcontactPerson_19 ,  
   NameofcontactPerson_20 ,  
   DesignationofcontactPerson_20 ,  
   PANofcontactPerson_20 ,  
   AddressofcontactPerson_20 ,  
   ContactdetailsofcontactPerson_20 ,  
   DINofcontactPerson_20 ,  
   UIDofcontactPerson_20 ,  
   EmailIdofcontactPerson_20 ,  
   POAforFunds ,  
         POAforSecurities,   
   Flag   
   )  
 select  
  segment = 'S',  
  client_code = c2.party_code,  
  client_name = left(c1_b.long_name, 150),  
  category =cl_status,  
  pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),  
  Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */  
  Fathers_Husbands_GuardiansName ='',  
  Maritalstatus='',  
  Nationality ='',  
  Nationality_Other='',   
  ClientEmailId = left(email, 60),  
  CorrespondenceClientAddressline1 = left(  
   case  
    when len(c1_b.l_address1) = 0  
    then ''  
    else ltrim(rtrim(isnull(c1_b.l_address1, '')))  
    end  
   +  
   case  
    when len(c1_b.l_address2) = 0  
    then ''  
    else ltrim(rtrim(isnull(c1_b.l_address2, '')))  
    end  
   +  
   case  
    when len(c1_b.l_address3) = 0  
    then ''  
    else ltrim(rtrim(isnull(c1_b.l_address3, '')))  
    end, 255  
   ),  
  
  CorrespondenceClientAddressline2 = '',  
  CorrespondenceClientAddressline3 = '',  
  CorrespondenceClientAddress_City = left(c1_b.l_city, 50),  
  CorrespondenceClientAddress_State = c1_b.l_state,  
  CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,  
  CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),  
  CorrespondenceClientAddress_Pincode =   
  case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then  
    case  
     when len(c1_b.l_zip) <> 6 then ''  
     when len(c1_b.l_zip) = 0 then ''  
     else c1_b.l_zip  
    end  
  else  
   c1_b.l_zip  
  end  ,  
  FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,   
  /*Modify on 30 Apr 2014*/  
  PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end,   
  PermanentClientAddressline2 ='',  
  PermanentClientAddressline3 ='',     
  /*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,  
  PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,  
  PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/  
  PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,  
  PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,  
  PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,  
  PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,  
  PermanentClientAddress_Pincode =  
  case when c1_b.P_Len='N' then   
   case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then  
    case  
     when len(c1_b.l_zip) <> 6 then ''  
     when len(c1_b.l_zip) = 0 then ''  
     else c1_b.l_zip  
    end  
   else  
    c1_b.l_zip  
   end  
  else ''       
  end,  
  ISDcode_Residence ='',  
  STDcode_Residence =case   
       when len(STDcode_Residence1)>0 then STDcode_Residence1  
       when len(STDcode_Residence2)>0 then STDcode_Residence2  
         else '' end,   
  TelephoneNumber_Residence =   
   left( case   
      when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')  
      when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')  
     else   
      ''   
     end  
    , 60  
    ),  
  Mobilenumber =left(c1_b.mobile_pager, 10),  
  ISDcode_Office ='',  
  STDcode_Office =case   
       when len(STDcode_Office1)>0 then STDcode_Office1  
       when len(STDcode_Office2)>0 then STDcode_Office2  
         else '' end,  
  TelephoneNumber_Office=  
   left( case   
      when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')  
      when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')  
     else   
      ''   
     end  
    , 60  
    ),  
  DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,  
  UIDNUMBER='',  
  
   
  BankName1 =bank_name,  
  BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end ,   
  BankAccountNo1 =bank_account_no,  
  BankAccountType1 =case   
       when bank_account_type = 'SAVING' then '10'  
       when bank_account_type = 'CURRENT' then '11'  
       when bank_account_type = 'OTHER' then '99'   
        else ''  
       end ,  
  BankName2 ='',  
  BankBranchAddress2 ='',  
  BankAccountNo2 ='',  
  BankAccountType2 ='',  
  BankName3 ='',  
  BankBranchAddress3 ='',  
  BankAccountNo3 ='',  
  BankAccountType3 ='',  
    
  DepositoryName1 =dp_name,  
  DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,  
  BeneficialOwnerAccountNo1 =demat_id_of_client,  
    
  DepositoryName2 ='',  
  DepositoryID2 ='',  
  BeneficialOwnerAccountNo2 ='',  
  DepositoryName3 ='',  
  DepositoryID3 ='',  
  BeneficialOwnerAccountNo3 ='',  
  CorporateIdentitynumber_CIN='',  
  GrossAnnualIncomeRange ='',  
  GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,  
  NetWorth_InRs ='',  
  NetWorthasonDate ='',  
  PoliticallyExposedPerson_PEP='0',   
  PlaceofIncorporation ='',  
  Occupation ='',  
  OccupationDetails_Forothers='',   
  Dateofcommencementofbusiness ='',  
  CustodialParticipantCodeoftheclient ='',  
  RegistrationNoofClient ='',  
  RegisteringAuthority ='',  
  PlaceofRegistration ='',  
  DateofRegistration ='',  
  InpersonVerification ='Y',  
  ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),  
       /*Change on 26 Apr 2014: Changes for NSE SLB */  
  UniqueClientCodeallottedbyNSCCL_BSE ='',  
  UpdationFlag_for_SMS_and_Email_facility='',   
  Relationship ='',  
  TypeofFacility_for_SMS_and_Email_facility ='',  
  ProofType ='',  
  ProofNumber ='',  
  IssuePlaceofProof='',   
  IssueDateofProof ='',  
  ClientStatus ='A',  
  Remarks ='',  
  ClientType_Corporate='',   
  NameofcontactPerson_1 ='',  
  DesignationofContactPerson_1 ='',  
  PANofcontactPerson_1 ='',  
  AddressofcontactPerson_1 ='',  
  ContactdetailsofcontactPerson_1 ='',  
  DINofcontactPerson_1 ='',  
  UIDofcontactPerson_1 ='',  
  EmailIdofcontactPerson_1 ='',  
  NameofcontactPerson_2  ='',  
  DesignationofcontactPerson_2 ='',  
  PANofcontactPerson_2 ='',  
  AddressofcontactPerson_2 ='',  
  ContactdetailsofcontactPerson_2='',   
  DINofcontactPerson_2 ='',  
  UIDofcontactPerson_2 ='',  
  EmailIdofcontactPerson_2 ='',  
  NameofcontactPerson_3 ='',  
  DesignationofcontactPerson_3='',   
  PANofcontactPerson_3 ='',  
  AddressofcontactPerson_3 ='',  
  ContactdetailsofcontactPerson_3='',   
  DINofcontactPerson_3 ='',  
  UIDofcontactPerson_3 ='',  
  EmailIdofcontactPerson_3 ='',  
  NameofcontactPerson_4 ='',  
  DesignationofcontactPerson_4='',   
  PANofcontactPerson_4 ='',  
  AddressofcontactPerson_4 ='',  
  ContactdetailsofcontactPerson_4 ='',  
  DINofcontactPerson_4 ='',  
  UIDofcontactPerson_4 ='',  
  EmailIdofcontactPerson_4 ='',  
  NameofcontactPerson_5 ='',  
  DesignationofcontactPerson_5 ='',  
  PANofcontactPerson_5 ='',  
  AddressofcontactPerson_5 ='',  
  ContactdetailsofcontactPerson_5='',   
  DINofcontactPerson_5 ='',  
  UIDofcontactPerson_5 ='',  
  EmailIdofcontactPerson_5 ='',  
  NameofcontactPerson_6 ='',  
  DesignationofcontactPerson_6='',   
  PANofcontactPerson_6 ='',  
  AddressofcontactPerson_6 ='',  
  ContactdetailsofcontactPerson_6='',   
  DINofcontactPerson_6 ='',  
  UIDofcontactPerson_6 ='',  
  EmailIdofcontactPerson_6 ='',  
  NameofcontactPerson_7 ='',  
  DesignationofcontactPerson_7='',   
  PANofcontactPerson_7 ='',  
  AddressofcontactPerson_7 ='',  
  ContactdetailsofcontactPerson_7='',   
  DINofcontactPerson_7 ='',  
  UIDofcontactPerson_7 ='',  
  EmailIdofcontactPerson_7 ='',  
  NameofcontactPerson_8 ='',  
  DesignationofcontactPerson_8 ='',  
  PANofcontactPerson_8 ='',  
  AddressofcontactPerson_8 ='',  
  ContactdetailsofcontactPerson_8 ='',  
  DINofcontactPerson_8 ='',  
  UIDofcontactPerson_8 ='',  
  EmailIdofcontactPerson_8 ='',  
  NameofcontactPerson_9 ='',  
  DesignationofcontactPerson_9='',   
  PANofcontactPerson_9 ='',  
  AddressofcontactPerson_9 ='',  
  ContactdetailsofcontactPerson_9='',   
  DINofcontactPerson_9 ='',  
  UIDofcontactPerson_9 ='',  
  EmailIdofcontactPerson_9 ='',  
  NameofcontactPerson_10 ='',  
  DesignationofcontactPerson_10='',   
  PANofcontactPerson_10 ='',  
  AddressofcontactPerson_10 ='',  
  ContactdetailsofcontactPerson_10='',   
  DINofcontactPerson_10 ='',  
  UIDofcontactPerson_10 ='',  
  EmailIdofcontactPerson_10 ='',  
  NameofcontactPerson_11 ='',  
  DesignationofcontactPerson_11='',   
  PANofcontactPerson_11 ='',  
  AddressofcontactPerson_11 ='',  
  ContactdetailsofcontactPerson_11='',   
  DINofcontactPerson_11 ='',  
  UIDofcontactPerson_11 ='',  
  EmailIdofcontactPerson_11 ='',  
  NameofcontactPerson_12 ='',  
  DesignationofcontactPerson_12='',   
  PANofcontactPerson_12 ='',  
  AddressofcontactPerson_12 ='',  
  ContactdetailsofcontactPerson_12='',   
  DINofcontactPerson_12 ='',  
  UIDofcontactPerson_12 ='',  
  EmailIdofcontactPerson_12 ='',  
  NameofcontactPerson_13 ='',  
  DesignationofcontactPerson_13 ='',  
  PANofcontactPerson_13 ='',  
  AddressofcontactPerson_13 ='',  
  ContactdetailsofcontactPerson_13 ='',  
  DINofcontactPerson_13 ='',  
  UIDofcontactPerson_13 ='',  
  EmailIdofcontactPerson_13 ='',  
  NameofcontactPerson_14 ='',  
  DesignationofcontactPerson_14 ='',  
  PANofcontactPerson_14 ='',  
  AddressofcontactPerson_14 ='',  
  ContactdetailsofcontactPerson_14 ='',  
  DINofcontactPerson_14 ='',  
  UIDofcontactPerson_14 ='',  
  EmailIdofcontactPerson_14 ='',  
  NameofcontactPerson_15 ='',  
  DesignationofcontactPerson_15 ='',  
  PANofcontactPerson_15 ='',  
  AddressofcontactPerson_15 ='',  
  ContactdetailsofcontactPerson_15='',   
  DINofcontactPerson_15 ='',  
  UIDofcontactPerson_15 ='',  
  EmailIdofcontactPerson_15 ='',  
  NameofcontactPerson_16 ='',  
  DesignationofcontactPerson_16='',   
  PANofcontactPerson_16 ='',  
  AddressofcontactPerson_16 ='',  
  ContactdetailsofcontactPerson_16='',   
  DINofcontactPerson_16 ='',  
  UIDofcontactPerson_16 ='',  
  EmailIdofcontactPerson_16 ='',  
  NameofcontactPerson_17 ='',  
  DesignationofcontactPerson_17='',   
  PANofcontactPerson_17 ='',  
  AddressofcontactPerson_17 ='',  
  ContactdetailsofcontactPerson_17='',   
  DINofcontactPerson_17 ='',  
  UIDofcontactPerson_17 ='',  
  EmailIdofcontactPerson_17 ='',  
  NameofcontactPerson_18 ='',  
  DesignationofcontactPerson_18='',   
  PANofcontactPerson_18 ='',  
  AddressofcontactPerson_18 ='',  
  ContactdetailsofcontactPerson_18='',   
  DINofcontactPerson_18 ='',  
  UIDofcontactPerson_18 ='',  
  EmailIdofcontactPerson_18 ='',  
  NameofcontactPerson_19 ='',  
  DesignationofcontactPerson_19='',   
  PANofcontactPerson_19 ='',  
  AddressofcontactPerson_19 ='',  
  ContactdetailsofcontactPerson_19='',   
  DINofcontactPerson_19 ='',  
  UIDofcontactPerson_19 ='',  
  EmailIdofcontactPerson_19 ='',  
  NameofcontactPerson_20 ='',  
  DesignationofcontactPerson_20='',   
  PANofcontactPerson_20 ='',  
  AddressofcontactPerson_20 ='',  
  ContactdetailsofcontactPerson_20='',   
  DINofcontactPerson_20 ='',  
  UIDofcontactPerson_20 ='',  
  EmailIdofcontactPerson_20 ='',  
  POAforFunds ='N',  
     POAforSecurities='N',   
  Flag='E'  
 from  
  (  
   select  
    c1.*,  
    b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client  
   from  
    #temp_Client1 c1 with (nolock)  
     left outer join  
    #temp_client_bank b with (nolock)  
     on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))  
  ) c1_b,  
  #temp_Client2 c2 with (nolock),  
  #temp_Client5 c5 with (nolock)  
  
 where  
  ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and  
  ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and  
  ltrim(rtrim(left(c2.party_code,2))) <> '98'  
    
  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
  UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),  
     --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/  
     --MASTERPAN=ISNULL(c1.MASTERPAN,''),  
     TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),  
  --Gender=isnull(c1.Gender,''),  
  Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),  
  Maritalstatus=  
   case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  
     case   
      when isnull(c1.MARITALSTATUS,'')='01' then 'S'   
      when isnull(c1.MARITALSTATUS,'')='02' then 'M'  
      else 'S'   
     end  
   else  
    ''  
   end   ,  
  Nationality=  
     case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end,   
  NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,  
  GrossAnnualIncomeRange=case   
     when c1.Gross_Income ='01' then '1'  
     when c1.Gross_Income ='02' then '2'  
     when c1.Gross_Income ='03' then '3'  
     when c1.Gross_Income ='04' then '4'  
     when c1.Gross_Income ='05' then '5'  
     when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/  
     when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/  
     else '' end,   
  NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),  
  NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''  
      else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,  
  PoliticallyExposedPerson_PEP=case   
    when c1.PEP='01' or c1.pep ='PEP' then '01'   
    when c1.PEP='02' or c1.pep ='RPEP' then '02'  
    else '0' end,  
  Occupation=case   
    when c1.Occupation='01' then '01'  
    when c1.Occupation='02' then '02'  
    when c1.Occupation='03' then '04'  
    when c1.Occupation='04' then '05'  
    when c1.Occupation='05' then '06'  
    when c1.Occupation='06' then '07'  
    when c1.Occupation='07' then '08'  
    when c1.Occupation='08' then '09'  
    when c1.Occupation='10' then '03'  
    else '99' end,  
  OccupationDetails_Forothers=isnull(Occupation_Other,''),  
  --UIDNUMBER=isnull(c1.AADHAR_UID,'')  
  UIDNUMBER=replace(isnull(rtrim(ltrim(c1.AADHAR_UID)),''),' ','')  
 from  
  anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)  
 where  
  client_code = party_code  
  and len(isnull(client_code, '')) > 0  
  and len(isnull(party_code, '')) > 0     
   
 update   
  #mimansa_angel_ucc_nse_slb_client_data_new_changes   
 set   
  GrossAnnualIncomeasonDate='',  
  NetWorth_InRs='',  
  NetWorthasonDate=''  
 where len(GrossAnnualIncomeRange)=0   
  
   
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),  
  ClientType_Corporate='Y'  
 from  
  anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)  
 where  
  client_code = party_code  
  and len(isnull(client_code, '')) > 0  
  and len(isnull(party_code, '')) > 0   
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4   
  
 /****ADDRESS 1****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_1=c1.contact_name,  
 DesignationofContactPerson_1=c1.designation,  
 PANofcontactPerson_1=c1.PanNo,  
 AddressofcontactPerson_1=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_1=c1.DIN,  
 UIDofcontactPerson_1=c1.UID,  
 EmailIdofcontactPerson_1=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='1'  
  
 /****ADDRESS 2****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_2=c1.contact_name,  
 DesignationofContactPerson_2=c1.designation,  
 PANofcontactPerson_2=c1.PanNo,  
 AddressofcontactPerson_2=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_2=c1.DIN,  
 UIDofcontactPerson_2=c1.UID,  
 EmailIdofcontactPerson_2=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='2'  
  
 /****ADDRESS 3****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_3=c1.contact_name,  
 DesignationofContactPerson_3=c1.designation,  
 PANofcontactPerson_3=c1.PanNo,  
 AddressofcontactPerson_3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_3=c1.DIN,  
 UIDofcontactPerson_3=c1.UID,  
 EmailIdofcontactPerson_3=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='3'  
  
 /****ADDRESS 4****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_4=c1.contact_name,  
 DesignationofContactPerson_4=c1.designation,  
 PANofcontactPerson_4=c1.PanNo,  
 AddressofcontactPerson_4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_4=c1.DIN,  
 UIDofcontactPerson_4=c1.UID,  
 EmailIdofcontactPerson_4=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='4'  
  
 /****ADDRESS 5****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_5=c1.contact_name,  
 DesignationofContactPerson_5=c1.designation,  
 PANofcontactPerson_5=c1.PanNo,  
 AddressofcontactPerson_5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_5=c1.DIN,  
 UIDofcontactPerson_5=c1.UID,  
 EmailIdofcontactPerson_5=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='5'  
  
 /****ADDRESS 6****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_6=c1.contact_name,  
 DesignationofContactPerson_6=c1.designation,  
 PANofcontactPerson_6=c1.PanNo,  
 AddressofcontactPerson_6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_6=c1.DIN,  
 UIDofcontactPerson_6=c1.UID,  
 EmailIdofcontactPerson_6=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='6'  
  
 /****ADDRESS 7****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_7=c1.contact_name,  
 DesignationofContactPerson_7=c1.designation,  
 PANofcontactPerson_7=c1.PanNo,  
 AddressofcontactPerson_7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_7=c1.DIN,  
 UIDofcontactPerson_7=c1.UID,  
 EmailIdofcontactPerson_7=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='7'  
  
 /****ADDRESS 8****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_8=c1.contact_name,  
 DesignationofContactPerson_8=c1.designation,  
 PANofcontactPerson_8=c1.PanNo,  
 AddressofcontactPerson_8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_8=c1.DIN,  
 UIDofcontactPerson_8=c1.UID,  
 EmailIdofcontactPerson_8=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='8'  
  
 /****ADDRESS 9****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_9=c1.contact_name,  
 DesignationofContactPerson_9=c1.designation,  
 PANofcontactPerson_9=c1.PanNo,  
 AddressofcontactPerson_9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_9=c1.DIN,  
 UIDofcontactPerson_9=c1.UID,  
 EmailIdofcontactPerson_9=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='9'  
  
 /****ADDRESS 10****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_10=c1.contact_name,  
 DesignationofContactPerson_10=c1.designation,  
 PANofcontactPerson_10=c1.PanNo,  
 AddressofcontactPerson_10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_10=c1.DIN,  
 UIDofcontactPerson_10=c1.UID,  
 EmailIdofcontactPerson_10=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='10'  
  
  
  
  /*Update POA*/  
  --Update   
  --    #mimansa_angel_ucc_nse_slb_client_data_new_changes  
  --  set       
  --     POAforSecurities=  
  --  case   
  --  when ltrim(rtrim(Def))=1 then 'Y'    
  --  when ltrim(rtrim(Def))=0 then 'N'       
  --  else  ''   
  -- end  
  --  from  
  --   anand1.msajag.dbo.Multicltid m with(nolock)  
  --     where  
  --Client_Code = m.Party_code  
  
   
 /*INVALID PAN*/  
  
   
  
 select distinct  
  client_code = ltrim(rtrim(client_code)),  
  client_name = ltrim(rtrim(client_name)),  
  pan = ltrim(rtrim(pan))  
  --pan,  
  --pan_err =   
  -- case   
  --  when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'  
  --  then 'NO PAN'  
  --  when len(ltrim(rtrim(isnull(pan, '')))) = 0  
  --  then 'NO PAN'  
  --  when not (  
  --   isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and  
  --   isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and  
  --   isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and  
  --   len(ltrim(rtrim(isnull(pan, '')))) = 10  
  --  )  
  --  then 'INVALID PAN'  
  -- end,  
  
  --pan_length = len(ltrim(rtrim(isnull(pan, '')))),  
  --telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),  
  --client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))  
into #invalidpan  
 from  
  --mimansa_angel_ucc_nse_fo_client_data with(nolock)  
  mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)  
 where  
  ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'  
  
   
  
   
delete  
 #mimansa_angel_ucc_nse_slb_client_data_new_changes  
from  
 --[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)  
 intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp   
where  
 ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))  
 and len(bp.panno)=10  
  
/***************FINAL DISPLAY*******************/  
select distinct  
  Segment,   
  Client_Code=ltrim(RTRIM(Client_Code)),   
  Client_Name ,  
  Category ,  
  PAN ,  
  Gender,   
  Fathers_Husbands_GuardiansName ,  
  Maritalstatus ,  
  Nationality ,  
  Nationality_Other,   
  ClientEmailId ,  
  CorrespondenceClientAddressline1 ,  
  CorrespondenceClientAddressline2 ,  
  CorrespondenceClientAddressline3 ,  
  CorrespondenceClientAddress_City ,  
  CorrespondenceClientAddress_State ,  
  CorrespondenceClientAddress_State_Others,   
  CorrespondenceClientAddress_Country ,  
  CorrespondenceClientAddress_Pincode ,  
  FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,  
  PermanentClientAddressline1 ,  
  PermanentClientAddressline2 ,  
  PermanentClientAddressline3 ,  
  PermanentClientAddress_City ,  
  PermanentClientAddress_State ,  
  PermanentClientAddress_StateOthers  ,  
  PermanentClientAddress_Country ,  
  PermanentClientAddress_Pincode ,  
  ISDcode_Residence ,  
  STDcode_Residence ,  
  TelephoneNumber_Residence ,  
  Mobilenumber ,  
  ISDcode_Office,   
  STDcode_Office ,  
  TelephoneNumber_Office ,  
  DateofBirth_Incorporation ,  
  UIDNUMBER ,  
  BankName1 ,  
  BankBranchAddress1 ,  
  BankAccountNo1 ,  
  BankAccountType1 ,  
  BankName2 ,  
  BankBranchAddress2 ,  
  BankAccountNo2 ,  
  BankAccountType2 ,  
  BankName3 ,  
  BankBranchAddress3 ,  
  BankAccountNo3 ,  
  BankAccountType3,   
  DepositoryName1 ,  
  DepositoryID1 ,  
  BeneficialOwnerAccountNo1 ,  
  DepositoryName2 ,  
  DepositoryID2 ,  
  BeneficialOwnerAccountNo2 ,  
  DepositoryName3 ,  
  DepositoryID3 ,  
  BeneficialOwnerAccountNo3 ,  
  CorporateIdentitynumber_CIN,   
  GrossAnnualIncomeRange ,  
  GrossAnnualIncomeasonDate,   
  NetWorth_InRs ,  
  NetWorthasonDate,   
  PoliticallyExposedPerson_PEP ,  
  PlaceofIncorporation ,  
  Occupation ,  
  OccupationDetails_Forothers ,  
  Dateofcommencementofbusiness ,  
  CustodialParticipantCodeoftheclient ,  
  RegistrationNoofClient ,  
  RegisteringAuthority ,  
  PlaceofRegistration ,  
  DateofRegistration ,  
  InpersonVerification,   
  ClientAgreementDate ,  
  UniqueClientCodeallottedbyNSCCL_BSE ,  
  UpdationFlag_for_SMS_and_Email_facility ,  
  Relationship ,  
  TypeofFacility_for_SMS_and_Email_facility ,  
  ProofType ,  
  ProofNumber ,  
  IssuePlaceofProof ,  
  IssueDateofProof ,  
  ClientStatus ,  
  Remarks ,  
  ClientType_Corporate,   
  NameofcontactPerson_1 ,  
  DesignationofContactPerson_1 ,  
  PANofcontactPerson_1 ,  
  AddressofcontactPerson_1 ,  
  ContactdetailsofcontactPerson_1 ,  
  DINofcontactPerson_1 ,  
  UIDofcontactPerson_1 ,  
  EmailIdofcontactPerson_1 ,  
  NameofcontactPerson_2  ,  
  DesignationofcontactPerson_2 ,  
  PANofcontactPerson_2 ,  
  AddressofcontactPerson_2 ,  
  ContactdetailsofcontactPerson_2,   
  DINofcontactPerson_2 ,  
  UIDofcontactPerson_2 ,  
  EmailIdofcontactPerson_2 ,  
  NameofcontactPerson_3 ,  
  DesignationofcontactPerson_3,   
  PANofcontactPerson_3 ,  
  AddressofcontactPerson_3 ,  
  ContactdetailsofcontactPerson_3,   
  DINofcontactPerson_3 ,  
  UIDofcontactPerson_3 ,  
  EmailIdofcontactPerson_3 ,  
  NameofcontactPerson_4 ,  
  DesignationofcontactPerson_4,   
  PANofcontactPerson_4 ,  
  AddressofcontactPerson_4 ,  
  ContactdetailsofcontactPerson_4 ,  
  DINofcontactPerson_4 ,  
  UIDofcontactPerson_4 ,  
  EmailIdofcontactPerson_4 ,  
  NameofcontactPerson_5 ,  
  DesignationofcontactPerson_5 ,  
  PANofcontactPerson_5 ,  
  AddressofcontactPerson_5 ,  
  ContactdetailsofcontactPerson_5,   
  DINofcontactPerson_5 ,  
  UIDofcontactPerson_5 ,  
  EmailIdofcontactPerson_5 ,  
  NameofcontactPerson_6 ,  
  DesignationofcontactPerson_6,   
  PANofcontactPerson_6 ,  
  AddressofcontactPerson_6 ,  
  ContactdetailsofcontactPerson_6,   
  DINofcontactPerson_6 ,  
  UIDofcontactPerson_6 ,  
  EmailIdofcontactPerson_6 ,  
  NameofcontactPerson_7 ,  
  DesignationofcontactPerson_7,   
  PANofcontactPerson_7 ,  
  AddressofcontactPerson_7 ,  
  ContactdetailsofcontactPerson_7,   
  DINofcontactPerson_7 ,  
  UIDofcontactPerson_7 ,  
  EmailIdofcontactPerson_7 ,  
  NameofcontactPerson_8 ,  
  DesignationofcontactPerson_8 ,  
  PANofcontactPerson_8 ,  
  AddressofcontactPerson_8 ,  
  ContactdetailsofcontactPerson_8 ,  
  DINofcontactPerson_8 ,  
  UIDofcontactPerson_8 ,  
  EmailIdofcontactPerson_8 ,  
  NameofcontactPerson_9 ,  
  DesignationofcontactPerson_9,   
  PANofcontactPerson_9 ,  
  AddressofcontactPerson_9 ,  
  ContactdetailsofcontactPerson_9,   
  DINofcontactPerson_9 ,  
  UIDofcontactPerson_9 ,  
  EmailIdofcontactPerson_9 ,  
  NameofcontactPerson_10 ,  
  DesignationofcontactPerson_10,   
  PANofcontactPerson_10 ,  
  AddressofcontactPerson_10 ,  
  ContactdetailsofcontactPerson_10,   
  DINofcontactPerson_10 ,  
  UIDofcontactPerson_10 ,  
  EmailIdofcontactPerson_10 ,  
  NameofcontactPerson_11 ,  
  DesignationofcontactPerson_11,   
  PANofcontactPerson_11 ,  
  AddressofcontactPerson_11 ,  
  ContactdetailsofcontactPerson_11,   
  DINofcontactPerson_11 ,  
  UIDofcontactPerson_11 ,  
  EmailIdofcontactPerson_11 ,  
  NameofcontactPerson_12 ,  
  DesignationofcontactPerson_12,   
  PANofcontactPerson_12 ,  
  AddressofcontactPerson_12 ,  
  ContactdetailsofcontactPerson_12,   
  DINofcontactPerson_12 ,  
  UIDofcontactPerson_12 ,  
  EmailIdofcontactPerson_12 ,  
  NameofcontactPerson_13 ,  
  DesignationofcontactPerson_13 ,  
  PANofcontactPerson_13 ,  
  AddressofcontactPerson_13 ,  
  ContactdetailsofcontactPerson_13 ,  
  DINofcontactPerson_13 ,  
  UIDofcontactPerson_13 ,  
  EmailIdofcontactPerson_13 ,  
  NameofcontactPerson_14 ,  
  DesignationofcontactPerson_14 ,  
  PANofcontactPerson_14 ,  
  AddressofcontactPerson_14 ,  
  ContactdetailsofcontactPerson_14 ,  
  DINofcontactPerson_14 ,  
  UIDofcontactPerson_14 ,  
  EmailIdofcontactPerson_14 ,  
  NameofcontactPerson_15 ,  
  DesignationofcontactPerson_15 ,  
  PANofcontactPerson_15 ,  
  AddressofcontactPerson_15 ,  
  ContactdetailsofcontactPerson_15,   
  DINofcontactPerson_15 ,  
  UIDofcontactPerson_15 ,  
  EmailIdofcontactPerson_15 ,  
  NameofcontactPerson_16 ,  
  DesignationofcontactPerson_16,   
  PANofcontactPerson_16 ,  
  AddressofcontactPerson_16 ,  
  ContactdetailsofcontactPerson_16,   
  DINofcontactPerson_16 ,  
  UIDofcontactPerson_16 ,  
  EmailIdofcontactPerson_16 ,  
  NameofcontactPerson_17 ,  
  DesignationofcontactPerson_17,   
  PANofcontactPerson_17 ,  
  AddressofcontactPerson_17 ,  
  ContactdetailsofcontactPerson_17,   
  DINofcontactPerson_17 ,  
  UIDofcontactPerson_17 ,  
  EmailIdofcontactPerson_17 ,  
  NameofcontactPerson_18 ,  
  DesignationofcontactPerson_18,   
  PANofcontactPerson_18 ,  
  AddressofcontactPerson_18 ,  
  ContactdetailsofcontactPerson_18,   
  DINofcontactPerson_18 ,  
  UIDofcontactPerson_18 ,  
  EmailIdofcontactPerson_18 ,  
  NameofcontactPerson_19 ,  
  DesignationofcontactPerson_19,   
  PANofcontactPerson_19 ,  
  AddressofcontactPerson_19 ,  
  ContactdetailsofcontactPerson_19,   
  DINofcontactPerson_19 ,  
  UIDofcontactPerson_19 ,  
  EmailIdofcontactPerson_19 ,  
  NameofcontactPerson_20 ,  
  DesignationofcontactPerson_20,   
  PANofcontactPerson_20 ,  
  AddressofcontactPerson_20 ,  
  ContactdetailsofcontactPerson_20,   
  DINofcontactPerson_20 ,  
  UIDofcontactPerson_20 ,  
  EmailIdofcontactPerson_20 ,  
  POAforFunds ='N',  
     POAforSecurities='N',   
  Flag='E'  
from  
 #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)  
   
where  
 len(ltrim(rtrim(isnull(pan, '')))) > 0 and  
 isnull(pan, '' ) <> 'NA'  
  
  
  
  
  
 /*****ROW COUNT****/  
declare @totalrecord numeric  
  
select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)   
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and  
 isnull(pan, '' ) <> 'NA'  
  
/*Insert Log*/  
if exists(select * from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))  
begin  
 if(@totalrecord>0)  
 begin  
  update [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count   
  set file_number=file_number+1  
  where time_stamp>=cast(left(getdate(),11) as datetime)  
 end  
end  
else  
begin  
 if(@totalrecord>0)  
 begin  
  insert into [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)  
  select 1,getdate()  
 end  
end  
   
/*Display File Name and First Row  
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)  
    Ex- uci_20140225.t04  
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count   
    Ex- 10|M|12798|27022014|04|220  
*/  
  
select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')  
    +'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),       
    FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'  
    +(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'  
    +cast(@totalrecord  as varchar)   
from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)  
  
  
/*DISPLAY INVALID PAN*/  
select Client_Code,Client_Name,PAN  
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_Backup(19March2015)
-- --------------------------------------------------
-- [mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015] 'Feb 10 2015','Feb 10 2015','',''
Create proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_Backup(19March2015)]
	(
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
	)
as
--mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015 'Feb 10 2014','Feb 10 2014','',''
	/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate
		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

	/*******************FETCH DATA**************************/

	--truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes
	

CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(
	[Segment] [varchar](1) NULL,
	[Client_Code] [varchar](10) NULL,
	[Client_Name] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[Fathers_Husbands_GuardiansName] [varchar](150) NULL,
	[Maritalstatus] [varchar](2) NULL,
	[Nationality] [varchar](2) NULL,
	[Nationality_Other] [varchar](50) NULL,
	[ClientEmailId] [varchar](60) NULL,
	[CorrespondenceClientAddressline1] [varchar](255) NULL,
	[CorrespondenceClientAddressline2] [varchar](255) NULL,
	[CorrespondenceClientAddressline3] [varchar](255) NULL,
	[CorrespondenceClientAddress_City] [varchar](50) NULL,
	[CorrespondenceClientAddress_State] [varchar](2) NULL,
	[CorrespondenceClientAddress_State_Others] [varchar](75) NULL,
	[CorrespondenceClientAddress_Country] [varchar](3) NULL,
	[CorrespondenceClientAddress_Pincode] [varchar](10) NULL,
	[FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,
	[PermanentClientAddressline1] [varchar](255) NULL,
	[PermanentClientAddressline2] [varchar](255) NULL,
	[PermanentClientAddressline3] [varchar](255) NULL,
	[PermanentClientAddress_City] [varchar](50) NULL,
	[PermanentClientAddress_State] [varchar](2) NULL,
	[PermanentClientAddress_StateOthers] [varchar](75) NULL,
	[PermanentClientAddress_Country] [varchar](2) NULL,
	[PermanentClientAddress_Pincode] [varchar](10) NULL,
	[ISDcode_Residence] [varchar](10) NULL,
	[STDcode_Residence] [varchar](10) NULL,
	[TelephoneNumber_Residence] [varchar](60) NULL,
	[Mobilenumber] [varchar](20) NULL,
	[ISDcode_Office] [varchar](10) NULL,
	[STDcode_Office] [varchar](10) NULL,
	[TelephoneNumber_Office] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](60) NULL,
	[UIDNUMBER] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNo1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNo2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNo3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](4) NULL,
	[DepositoryID1] [varchar](8) NULL,
	[BeneficialOwnerAccountNo1] [varchar](16) NULL,
	[DepositoryName2] [varchar](4) NULL,
	[DepositoryID2] [varchar](8) NULL,
	[BeneficialOwnerAccountNo2] [varchar](16) NULL,
	[DepositoryName3] [varchar](4) NULL,
	[DepositoryID3] [varchar](8) NULL,
	[BeneficialOwnerAccountNo3] [varchar](16) NULL,
	[CorporateIdentitynumber_CIN] [varchar](21) NULL,
	[GrossAnnualIncomeRange] [varchar](40) NULL,
	[GrossAnnualIncomeasonDate] [varchar](40) NULL,
	[NetWorth_InRs] [varchar](40) NULL,
	[NetWorthasonDate] [varchar](40) NULL,
	[PoliticallyExposedPerson_PEP] [varchar](2) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetails_Forothers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](40) NULL,
	[CustodialParticipantCodeoftheclient] [varchar](15) NULL,
	[RegistrationNoofClient] [varchar](25) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](40) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](40) NULL,
	[UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,
	[UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,
	[Relationship] [varchar](1) NULL,
	[TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,
	[ProofType] [varchar](1) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](40) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientType_Corporate] [varchar](200) NULL,
	[NameofcontactPerson_1] [varchar](200) NULL,
	[DesignationofContactPerson_1] [varchar](200) NULL,
	[PANofcontactPerson_1] [varchar](200) NULL,
	[AddressofcontactPerson_1] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_1] [varchar](200) NULL,
	[DINofcontactPerson_1] [varchar](200) NULL,
	[UIDofcontactPerson_1] [varchar](200) NULL,
	[EmailIdofcontactPerson_1] [varchar](200) NULL,
	[NameofcontactPerson_2] [varchar](200) NULL,
	[DesignationofcontactPerson_2] [varchar](200) NULL,
	[PANofcontactPerson_2] [varchar](200) NULL,
	[AddressofcontactPerson_2] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_2] [varchar](200) NULL,
	[DINofcontactPerson_2] [varchar](200) NULL,
	[UIDofcontactPerson_2] [varchar](200) NULL,
	[EmailIdofcontactPerson_2] [varchar](200) NULL,
	[NameofcontactPerson_3] [varchar](200) NULL,
	[DesignationofcontactPerson_3] [varchar](200) NULL,
	[PANofcontactPerson_3] [varchar](200) NULL,
	[AddressofcontactPerson_3] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_3] [varchar](200) NULL,
	[DINofcontactPerson_3] [varchar](200) NULL,
	[UIDofcontactPerson_3] [varchar](200) NULL,
	[EmailIdofcontactPerson_3] [varchar](200) NULL,
	[NameofcontactPerson_4] [varchar](200) NULL,
	[DesignationofcontactPerson_4] [varchar](200) NULL,
	[PANofcontactPerson_4] [varchar](200) NULL,
	[AddressofcontactPerson_4] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_4] [varchar](200) NULL,
	[DINofcontactPerson_4] [varchar](200) NULL,
	[UIDofcontactPerson_4] [varchar](200) NULL,
	[EmailIdofcontactPerson_4] [varchar](200) NULL,
	[NameofcontactPerson_5] [varchar](200) NULL,
	[DesignationofcontactPerson_5] [varchar](200) NULL,
	[PANofcontactPerson_5] [varchar](200) NULL,
	[AddressofcontactPerson_5] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_5] [varchar](200) NULL,
	[DINofcontactPerson_5] [varchar](200) NULL,
	[UIDofcontactPerson_5] [varchar](200) NULL,
	[EmailIdofcontactPerson_5] [varchar](200) NULL,
	[NameofcontactPerson_6] [varchar](200) NULL,
	[DesignationofcontactPerson_6] [varchar](200) NULL,
	[PANofcontactPerson_6] [varchar](200) NULL,
	[AddressofcontactPerson_6] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_6] [varchar](200) NULL,
	[DINofcontactPerson_6] [varchar](200) NULL,
	[UIDofcontactPerson_6] [varchar](200) NULL,
	[EmailIdofcontactPerson_6] [varchar](200) NULL,
	[NameofcontactPerson_7] [varchar](200) NULL,
	[DesignationofcontactPerson_7] [varchar](200) NULL,
	[PANofcontactPerson_7] [varchar](200) NULL,
	[AddressofcontactPerson_7] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_7] [varchar](200) NULL,
	[DINofcontactPerson_7] [varchar](200) NULL,
	[UIDofcontactPerson_7] [varchar](200) NULL,
	[EmailIdofcontactPerson_7] [varchar](200) NULL,
	[NameofcontactPerson_8] [varchar](200) NULL,
	[DesignationofcontactPerson_8] [varchar](200) NULL,
	[PANofcontactPerson_8] [varchar](200) NULL,
	[AddressofcontactPerson_8] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_8] [varchar](200) NULL,
	[DINofcontactPerson_8] [varchar](200) NULL,
	[UIDofcontactPerson_8] [varchar](200) NULL,
	[EmailIdofcontactPerson_8] [varchar](200) NULL,
	[NameofcontactPerson_9] [varchar](200) NULL,
	[DesignationofcontactPerson_9] [varchar](200) NULL,
	[PANofcontactPerson_9] [varchar](200) NULL,
	[AddressofcontactPerson_9] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_9] [varchar](200) NULL,
	[DINofcontactPerson_9] [varchar](200) NULL,
	[UIDofcontactPerson_9] [varchar](200) NULL,
	[EmailIdofcontactPerson_9] [varchar](200) NULL,
	[NameofcontactPerson_10] [varchar](200) NULL,
	[DesignationofcontactPerson_10] [varchar](200) NULL,
	[PANofcontactPerson_10] [varchar](200) NULL,
	[AddressofcontactPerson_10] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_10] [varchar](200) NULL,
	[DINofcontactPerson_10] [varchar](200) NULL,
	[UIDofcontactPerson_10] [varchar](200) NULL,
	[EmailIdofcontactPerson_10] [varchar](200) NULL,
	[NameofcontactPerson_11] [varchar](200) NULL,
	[DesignationofcontactPerson_11] [varchar](200) NULL,
	[PANofcontactPerson_11] [varchar](200) NULL,
	[AddressofcontactPerson_11] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_11] [varchar](200) NULL,
	[DINofcontactPerson_11] [varchar](200) NULL,
	[UIDofcontactPerson_11] [varchar](200) NULL,
	[EmailIdofcontactPerson_11] [varchar](200) NULL,
	[NameofcontactPerson_12] [varchar](200) NULL,
	[DesignationofcontactPerson_12] [varchar](200) NULL,
	[PANofcontactPerson_12] [varchar](200) NULL,
	[AddressofcontactPerson_12] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_12] [varchar](200) NULL,
	[DINofcontactPerson_12] [varchar](200) NULL,
	[UIDofcontactPerson_12] [varchar](200) NULL,
	[EmailIdofcontactPerson_12] [varchar](200) NULL,
	[NameofcontactPerson_13] [varchar](200) NULL,
	[DesignationofcontactPerson_13] [varchar](200) NULL,
	[PANofcontactPerson_13] [varchar](200) NULL,
	[AddressofcontactPerson_13] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_13] [varchar](200) NULL,
	[DINofcontactPerson_13] [varchar](200) NULL,
	[UIDofcontactPerson_13] [varchar](200) NULL,
	[EmailIdofcontactPerson_13] [varchar](200) NULL,
	[NameofcontactPerson_14] [varchar](200) NULL,
	[DesignationofcontactPerson_14] [varchar](200) NULL,
	[PANofcontactPerson_14] [varchar](200) NULL,
	[AddressofcontactPerson_14] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_14] [varchar](200) NULL,
	[DINofcontactPerson_14] [varchar](200) NULL,
	[UIDofcontactPerson_14] [varchar](200) NULL,
	[EmailIdofcontactPerson_14] [varchar](200) NULL,
	[NameofcontactPerson_15] [varchar](200) NULL,
	[DesignationofcontactPerson_15] [varchar](200) NULL,
	[PANofcontactPerson_15] [varchar](200) NULL,
	[AddressofcontactPerson_15] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_15] [varchar](200) NULL,
	[DINofcontactPerson_15] [varchar](200) NULL,
	[UIDofcontactPerson_15] [varchar](200) NULL,
	[EmailIdofcontactPerson_15] [varchar](200) NULL,
	[NameofcontactPerson_16] [varchar](200) NULL,
	[DesignationofcontactPerson_16] [varchar](200) NULL,
	[PANofcontactPerson_16] [varchar](200) NULL,
	[AddressofcontactPerson_16] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_16] [varchar](200) NULL,
	[DINofcontactPerson_16] [varchar](200) NULL,
	[UIDofcontactPerson_16] [varchar](200) NULL,
	[EmailIdofcontactPerson_16] [varchar](200) NULL,
	[NameofcontactPerson_17] [varchar](200) NULL,
	[DesignationofcontactPerson_17] [varchar](200) NULL,
	[PANofcontactPerson_17] [varchar](200) NULL,
	[AddressofcontactPerson_17] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_17] [varchar](200) NULL,
	[DINofcontactPerson_17] [varchar](200) NULL,
	[UIDofcontactPerson_17] [varchar](200) NULL,
	[EmailIdofcontactPerson_17] [varchar](200) NULL,
	[NameofcontactPerson_18] [varchar](200) NULL,
	[DesignationofcontactPerson_18] [varchar](200) NULL,
	[PANofcontactPerson_18] [varchar](200) NULL,
	[AddressofcontactPerson_18] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_18] [varchar](200) NULL,
	[DINofcontactPerson_18] [varchar](200) NULL,
	[UIDofcontactPerson_18] [varchar](200) NULL,
	[EmailIdofcontactPerson_18] [varchar](200) NULL,
	[NameofcontactPerson_19] [varchar](200) NULL,
	[DesignationofcontactPerson_19] [varchar](200) NULL,
	[PANofcontactPerson_19] [varchar](200) NULL,
	[AddressofcontactPerson_19] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_19] [varchar](200) NULL,
	[DINofcontactPerson_19] [varchar](200) NULL,
	[UIDofcontactPerson_19] [varchar](200) NULL,
	[EmailIdofcontactPerson_19] [varchar](200) NULL,
	[NameofcontactPerson_20] [varchar](200) NULL,
	[DesignationofcontactPerson_20] [varchar](200) NULL,
	[PANofcontactPerson_20] [varchar](200) NULL,
	[AddressofcontactPerson_20] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_20] [varchar](200) NULL,
	[DINofcontactPerson_20] [varchar](200) NULL,
	[UIDofcontactPerson_20] [varchar](200) NULL,
	[EmailIdofcontactPerson_20] [varchar](200) NULL,
	[POAforFunds] [varchar](1) NULL,
	[POAforSecurities] [varchar](1) NULL,
	[Flag] [varchar](1) NULL
)
	
	--insert into 
	--	angel_ucc_nse_fo_client1
	select
		party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=cast('' as varchar(255)),
		P_address2=cast('' as varchar(255)),
		P_address3=cast('' as varchar(255)),
		P_City=cast('' as varchar(50)),
		P_State=cast('' as varchar(100)),
		P_State_For_Other=cast('' as varchar(100)),
		P_nation=cast('' as varchar(100)),
		P_zip=cast('' as varchar(10)),
		P_Len=cast('' as varchar(1)),	
		Gender=cast('' as varchar(1)),
		STDcode_Residence1=cast('' as varchar(10)),
		STDcode_Residence2=cast('' as varchar(10)),
		STDcode_Office1=cast('' as varchar(10)),
		STDcode_Office2=cast('' as varchar(10))
	into 
		#temp_client1	
	from 
		NSESLBS.dbo.client1 c1 with(nolock),
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c1.cl_code = c2.cl_code and 
		c2.party_code = t.party_code 

	update #temp_client1 set 
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,'')
	from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)
	where t1.Cl_Code=c1.cl_code

	update 
		#temp_Client1 
	set 
	L_State= dbo.fn_state_countary_value(l_state,'STATE'),
	P_State=dbo.fn_state_countary_value(P_state,'STATE'),
	L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),
	P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),
	cl_status=case
				/*INDIVIDUAL/PROPRIETORSHIP FIRMS*/
				when cl_status = 'IND' then '1'		/*INDIVIDUAL*/

				/*PARTNERSHIP FIRM*/
				when cl_status = 'PF' or cl_status='LLP' then '2'		/*PARTNERSHIP FIRMS*/

				/*HUF*/
				when cl_status = 'HUF' then '3'		/*HINDU UNDIVIDED FAMILY*/

				/*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/
				when cl_status = 'PPB' then '4'		/*PUB. PVT COMP/BODIES CORP*/
				when cl_status = 'BCP' then '4'		/*BODY CORPORATE*/

				/*TRUST / SOCIETY*/
				when cl_status = 'TS' then '5'		/*TRUST / SOCIETY*/

				/*MUTUAL FUND*/
				when cl_status = 'MF' then '6'		/*MUTUAL FUNDS*/
				when cl_status = 'MFF' then '6'		/*MUTUAL FUND (MF)*/

				/*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/
				when cl_status = 'IFI' then '7'		/*INDIAN FINANCIAL INSTI*/
				when cl_status = 'DFI' then '7'		/*DOMESTIC FIN. INST.*/

				/*BANK*/
				when cl_status = 'BA' then ' 8'		/*BANKS*/
				when cl_status = 'BNK' then '8'		/*BANK*/

				/*INSURANCE*/
				when cl_status = 'IC' then ' 9'		/*INSURANCE COMPANIES*/

				/*STATUTORY BODIES*/
				when cl_status = 'SB' then ' 10'		/*STATUTORY BODIES*/

				/*NRI*/
				when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'		/*NON RESIDENT INDIAN*/

				/*FII*/
				when cl_status = 'FII' then '12'		/*FOREIGN INSTIT INVESTORS*/

				/*OCB*/
				when cl_status = 'OCB' then '13'		/*OVERSEAS CORPORATE BODIES*/

				/*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/
				when cl_status = 'DFN' then '14'		/*DIRECT FOREIGN INVESTMENTS*/

				when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/
				
				/*FVC*/
				when cl_status = 'FVC' then '20'		/*FOREIGN VENTURE CAPITAL FUNDS*/
			else
				'1'		/*INDIVIDUAL*/
			end

	
	select 
		Cl_Code, Party_code=c2.Party_code
	into #temp_client2	
	from 
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c2.party_code = t.party_code
	
	select 
		party_code = ltrim(rtrim(t.party_code)),
		--c5.*
		cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),
		--BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),
		--ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */
		ActiveFrom=c5.ActiveFrom,
		InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),
		GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))
	into #temp_Client5	
	from 
		NSESLBS.dbo.client5 c5 with(nolock),
		#temp_Client2 t with (nolock)
	where 
		c5.cl_code = t.cl_code

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.pobank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.bank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('CDSL', 'NSDL') and
		isnull(c4.defdp, '') = '1'

	--insert into
	--	angel_ucc_nse_fo_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank	
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))


	/*******************END - FETCH DATA**************************/

	insert into
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
		(
			Segment	,
			Client_Code	,
			Client_Name	,
			Category	,
			PAN	,
			Gender	,
			Fathers_Husbands_GuardiansName	,
			Maritalstatus	,
			Nationality	,
			Nationality_Other	,
			ClientEmailId	,
			CorrespondenceClientAddressline1	,
			CorrespondenceClientAddressline2	,
			CorrespondenceClientAddressline3	,
			CorrespondenceClientAddress_City	,
			CorrespondenceClientAddress_State	,
			CorrespondenceClientAddress_State_Others	,
			CorrespondenceClientAddress_Country	,
			CorrespondenceClientAddress_Pincode	,
			FlagIndicatingifCorrespondenceAddressissameasPermanentAddress	,
			PermanentClientAddressline1	,
			PermanentClientAddressline2	,
			PermanentClientAddressline3	,
			PermanentClientAddress_City	,
			PermanentClientAddress_State	,
			PermanentClientAddress_StateOthers	,
			PermanentClientAddress_Country	,
			PermanentClientAddress_Pincode	,
			ISDcode_Residence	,
			STDcode_Residence	,
			TelephoneNumber_Residence	,
			Mobilenumber	,
			ISDcode_Office	,
			STDcode_Office	,
			TelephoneNumber_Office	,
			DateofBirth_Incorporation	,
			UIDNUMBER	,
			BankName1	,
			BankBranchAddress1	,
			BankAccountNo1	,
			BankAccountType1	,
			BankName2	,
			BankBranchAddress2	,
			BankAccountNo2	,
			BankAccountType2	,
			BankName3	,
			BankBranchAddress3	,
			BankAccountNo3	,
			BankAccountType3	,
			DepositoryName1	,
			DepositoryID1	,
			BeneficialOwnerAccountNo1	,
			DepositoryName2	,
			DepositoryID2	,
			BeneficialOwnerAccountNo2	,
			DepositoryName3	,
			DepositoryID3	,
			BeneficialOwnerAccountNo3	,
			CorporateIdentitynumber_CIN	,
			GrossAnnualIncomeRange	,
			GrossAnnualIncomeasonDate	,
			NetWorth_InRs	,
			NetWorthasonDate	,
			PoliticallyExposedPerson_PEP	,
			PlaceofIncorporation	,
			Occupation	,
			OccupationDetails_Forothers	,
			Dateofcommencementofbusiness	,
			CustodialParticipantCodeoftheclient	,
			RegistrationNoofClient	,
			RegisteringAuthority	,
			PlaceofRegistration	,
			DateofRegistration	,
			InpersonVerification	,
			ClientAgreementDate	,
			UniqueClientCodeallottedbyNSCCL_BSE	,
			UpdationFlag_for_SMS_and_Email_facility	,
			Relationship	,
			TypeofFacility_for_SMS_and_Email_facility	,
			ProofType	,
			ProofNumber	,
			IssuePlaceofProof	,
			IssueDateofProof	,
			ClientStatus	,
			Remarks	,
			ClientType_Corporate	,
			NameofcontactPerson_1	,
			DesignationofContactPerson_1	,
			PANofcontactPerson_1	,
			AddressofcontactPerson_1	,
			ContactdetailsofcontactPerson_1	,
			DINofcontactPerson_1	,
			UIDofcontactPerson_1	,
			EmailIdofcontactPerson_1	,
			NameofcontactPerson_2	,
			DesignationofcontactPerson_2	,
			PANofcontactPerson_2	,
			AddressofcontactPerson_2	,
			ContactdetailsofcontactPerson_2	,
			DINofcontactPerson_2	,
			UIDofcontactPerson_2	,
			EmailIdofcontactPerson_2	,
			NameofcontactPerson_3	,
			DesignationofcontactPerson_3	,
			PANofcontactPerson_3	,
			AddressofcontactPerson_3	,
			ContactdetailsofcontactPerson_3	,
			DINofcontactPerson_3	,
			UIDofcontactPerson_3	,
			EmailIdofcontactPerson_3	,
			NameofcontactPerson_4	,
			DesignationofcontactPerson_4	,
			PANofcontactPerson_4	,
			AddressofcontactPerson_4	,
			ContactdetailsofcontactPerson_4	,
			DINofcontactPerson_4	,
			UIDofcontactPerson_4	,
			EmailIdofcontactPerson_4	,
			NameofcontactPerson_5	,
			DesignationofcontactPerson_5	,
			PANofcontactPerson_5	,
			AddressofcontactPerson_5	,
			ContactdetailsofcontactPerson_5	,
			DINofcontactPerson_5	,
			UIDofcontactPerson_5	,
			EmailIdofcontactPerson_5	,
			NameofcontactPerson_6	,
			DesignationofcontactPerson_6	,
			PANofcontactPerson_6	,
			AddressofcontactPerson_6	,
			ContactdetailsofcontactPerson_6	,
			DINofcontactPerson_6	,
			UIDofcontactPerson_6	,
			EmailIdofcontactPerson_6	,
			NameofcontactPerson_7	,
			DesignationofcontactPerson_7	,
			PANofcontactPerson_7	,
			AddressofcontactPerson_7	,
			ContactdetailsofcontactPerson_7	,
			DINofcontactPerson_7	,
			UIDofcontactPerson_7	,
			EmailIdofcontactPerson_7	,
			NameofcontactPerson_8	,
			DesignationofcontactPerson_8	,
			PANofcontactPerson_8	,
			AddressofcontactPerson_8	,
			ContactdetailsofcontactPerson_8	,
			DINofcontactPerson_8	,
			UIDofcontactPerson_8	,
			EmailIdofcontactPerson_8	,
			NameofcontactPerson_9	,
			DesignationofcontactPerson_9	,
			PANofcontactPerson_9	,
			AddressofcontactPerson_9	,
			ContactdetailsofcontactPerson_9	,
			DINofcontactPerson_9	,
			UIDofcontactPerson_9	,
			EmailIdofcontactPerson_9	,
			NameofcontactPerson_10	,
			DesignationofcontactPerson_10	,
			PANofcontactPerson_10	,
			AddressofcontactPerson_10	,
			ContactdetailsofcontactPerson_10	,
			DINofcontactPerson_10	,
			UIDofcontactPerson_10	,
			EmailIdofcontactPerson_10	,
			NameofcontactPerson_11	,
			DesignationofcontactPerson_11	,
			PANofcontactPerson_11	,
			AddressofcontactPerson_11	,
			ContactdetailsofcontactPerson_11	,
			DINofcontactPerson_11	,
			UIDofcontactPerson_11	,
			EmailIdofcontactPerson_11	,
			NameofcontactPerson_12	,
			DesignationofcontactPerson_12	,
			PANofcontactPerson_12	,
			AddressofcontactPerson_12	,
			ContactdetailsofcontactPerson_12	,
			DINofcontactPerson_12	,
			UIDofcontactPerson_12	,
			EmailIdofcontactPerson_12	,
			NameofcontactPerson_13	,
			DesignationofcontactPerson_13	,
			PANofcontactPerson_13	,
			AddressofcontactPerson_13	,
			ContactdetailsofcontactPerson_13	,
			DINofcontactPerson_13	,
			UIDofcontactPerson_13	,
			EmailIdofcontactPerson_13	,
			NameofcontactPerson_14	,
			DesignationofcontactPerson_14	,
			PANofcontactPerson_14	,
			AddressofcontactPerson_14	,
			ContactdetailsofcontactPerson_14	,
			DINofcontactPerson_14	,
			UIDofcontactPerson_14	,
			EmailIdofcontactPerson_14	,
			NameofcontactPerson_15	,
			DesignationofcontactPerson_15	,
			PANofcontactPerson_15	,
			AddressofcontactPerson_15	,
			ContactdetailsofcontactPerson_15	,
			DINofcontactPerson_15	,
			UIDofcontactPerson_15	,
			EmailIdofcontactPerson_15	,
			NameofcontactPerson_16	,
			DesignationofcontactPerson_16	,
			PANofcontactPerson_16	,
			AddressofcontactPerson_16	,
			ContactdetailsofcontactPerson_16	,
			DINofcontactPerson_16	,
			UIDofcontactPerson_16	,
			EmailIdofcontactPerson_16	,
			NameofcontactPerson_17	,
			DesignationofcontactPerson_17	,
			PANofcontactPerson_17	,
			AddressofcontactPerson_17	,
			ContactdetailsofcontactPerson_17	,
			DINofcontactPerson_17	,
			UIDofcontactPerson_17	,
			EmailIdofcontactPerson_17	,
			NameofcontactPerson_18	,
			DesignationofcontactPerson_18	,
			PANofcontactPerson_18	,
			AddressofcontactPerson_18	,
			ContactdetailsofcontactPerson_18	,
			DINofcontactPerson_18	,
			UIDofcontactPerson_18	,
			EmailIdofcontactPerson_18	,
			NameofcontactPerson_19	,
			DesignationofcontactPerson_19	,
			PANofcontactPerson_19	,
			AddressofcontactPerson_19	,
			ContactdetailsofcontactPerson_19	,
			DINofcontactPerson_19	,
			UIDofcontactPerson_19	,
			EmailIdofcontactPerson_19	,
			NameofcontactPerson_20	,
			DesignationofcontactPerson_20	,
			PANofcontactPerson_20	,
			AddressofcontactPerson_20	,
			ContactdetailsofcontactPerson_20	,
			DINofcontactPerson_20	,
			UIDofcontactPerson_20	,
			EmailIdofcontactPerson_20	,
			POAforFunds ,
	        POAforSecurities, 
			Flag	
			)
	select
		segment = 'S',
		client_code = c2.party_code,
		client_name = left(c1_b.long_name, 150),
		category =cl_status,
		pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),
		Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */
		Fathers_Husbands_GuardiansName ='',
		Maritalstatus='',
		Nationality ='',
		Nationality_Other='', 
		ClientEmailId = left(email, 60),
		CorrespondenceClientAddressline1 = left(
			case
				when len(c1_b.l_address1) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address1, '')))
				end
			+
			case
				when len(c1_b.l_address2) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address2, '')))
				end
			+
			case
				when len(c1_b.l_address3) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address3, '')))
				end, 255
			),

		CorrespondenceClientAddressline2 = '',
		CorrespondenceClientAddressline3 = '',
		CorrespondenceClientAddress_City = left(c1_b.l_city, 50),
		CorrespondenceClientAddress_State = c1_b.l_state,
		CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,
		CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),
		CorrespondenceClientAddress_Pincode = 
		case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
		else
			c1_b.l_zip
		end		,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,	
		/*Modify on 30 Apr 2014*/
		PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end, 
		PermanentClientAddressline2 ='',
		PermanentClientAddressline3 ='',			
		/*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
		PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
		PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/
		PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,
		PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
		PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,
		PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
		PermanentClientAddress_Pincode =
		case when c1_b.P_Len='N' then 
			case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
			else
				c1_b.l_zip
			end
		else ''				 
		end,
		ISDcode_Residence ='',
		STDcode_Residence =case 
							when len(STDcode_Residence1)>0 then STDcode_Residence1
							when len(STDcode_Residence2)>0 then STDcode_Residence2
						   else '' end,	
		TelephoneNumber_Residence = 
			left(	case 
						when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')
						when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')
					else 
						'' 
					end
				, 60
				),
		Mobilenumber =left(c1_b.mobile_pager, 10),
		ISDcode_Office ='',
		STDcode_Office =case 
							when len(STDcode_Office1)>0 then STDcode_Office1
							when len(STDcode_Office2)>0 then STDcode_Office2
						   else '' end,
		TelephoneNumber_Office=
			left(	case 
						when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')
						when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')
					else 
						'' 
					end
				, 60
				),
		DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,
		UIDNUMBER='',

	
		BankName1 =bank_name,
		BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end , 
		BankAccountNo1 =bank_account_no,
		BankAccountType1 =case 
							when bank_account_type = 'SAVING' then '10'
							when bank_account_type = 'CURRENT' then '11'
							when bank_account_type = 'OTHER' then '99' 
						  else ''
							end ,
		BankName2 ='',
		BankBranchAddress2 ='',
		BankAccountNo2 ='',
		BankAccountType2 ='',
		BankName3 ='',
		BankBranchAddress3 ='',
		BankAccountNo3 ='',
		BankAccountType3 ='',
		
		DepositoryName1 =dp_name,
		DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,
		BeneficialOwnerAccountNo1 =demat_id_of_client,
		
		DepositoryName2 ='',
		DepositoryID2 ='',
		BeneficialOwnerAccountNo2 ='',
		DepositoryName3 ='',
		DepositoryID3 ='',
		BeneficialOwnerAccountNo3 ='',
		CorporateIdentitynumber_CIN='',
		GrossAnnualIncomeRange ='',
		GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,
		NetWorth_InRs ='',
		NetWorthasonDate ='',
		PoliticallyExposedPerson_PEP='0', 
		PlaceofIncorporation ='',
		Occupation ='',
		OccupationDetails_Forothers='', 
		Dateofcommencementofbusiness ='',
		CustodialParticipantCodeoftheclient ='',
		RegistrationNoofClient ='',
		RegisteringAuthority ='',
		PlaceofRegistration ='',
		DateofRegistration ='',
		InpersonVerification ='Y',
		ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),
							/*Change on 26 Apr 2014: Changes for NSE SLB */
		UniqueClientCodeallottedbyNSCCL_BSE ='',
		UpdationFlag_for_SMS_and_Email_facility='', 
		Relationship ='',
		TypeofFacility_for_SMS_and_Email_facility ='',
		ProofType ='',
		ProofNumber ='',
		IssuePlaceofProof='', 
		IssueDateofProof ='',
		ClientStatus ='A',
		Remarks ='',
		ClientType_Corporate='', 
		NameofcontactPerson_1 ='',
		DesignationofContactPerson_1 ='',
		PANofcontactPerson_1 ='',
		AddressofcontactPerson_1 ='',
		ContactdetailsofcontactPerson_1 ='',
		DINofcontactPerson_1 ='',
		UIDofcontactPerson_1 ='',
		EmailIdofcontactPerson_1 ='',
		NameofcontactPerson_2  ='',
		DesignationofcontactPerson_2 ='',
		PANofcontactPerson_2 ='',
		AddressofcontactPerson_2 ='',
		ContactdetailsofcontactPerson_2='', 
		DINofcontactPerson_2 ='',
		UIDofcontactPerson_2 ='',
		EmailIdofcontactPerson_2 ='',
		NameofcontactPerson_3 ='',
		DesignationofcontactPerson_3='', 
		PANofcontactPerson_3 ='',
		AddressofcontactPerson_3 ='',
		ContactdetailsofcontactPerson_3='', 
		DINofcontactPerson_3 ='',
		UIDofcontactPerson_3 ='',
		EmailIdofcontactPerson_3 ='',
		NameofcontactPerson_4 ='',
		DesignationofcontactPerson_4='', 
		PANofcontactPerson_4 ='',
		AddressofcontactPerson_4 ='',
		ContactdetailsofcontactPerson_4 ='',
		DINofcontactPerson_4 ='',
		UIDofcontactPerson_4 ='',
		EmailIdofcontactPerson_4 ='',
		NameofcontactPerson_5 ='',
		DesignationofcontactPerson_5 ='',
		PANofcontactPerson_5 ='',
		AddressofcontactPerson_5 ='',
		ContactdetailsofcontactPerson_5='', 
		DINofcontactPerson_5 ='',
		UIDofcontactPerson_5 ='',
		EmailIdofcontactPerson_5 ='',
		NameofcontactPerson_6 ='',
		DesignationofcontactPerson_6='', 
		PANofcontactPerson_6 ='',
		AddressofcontactPerson_6 ='',
		ContactdetailsofcontactPerson_6='', 
		DINofcontactPerson_6 ='',
		UIDofcontactPerson_6 ='',
		EmailIdofcontactPerson_6 ='',
		NameofcontactPerson_7 ='',
		DesignationofcontactPerson_7='', 
		PANofcontactPerson_7 ='',
		AddressofcontactPerson_7 ='',
		ContactdetailsofcontactPerson_7='', 
		DINofcontactPerson_7 ='',
		UIDofcontactPerson_7 ='',
		EmailIdofcontactPerson_7 ='',
		NameofcontactPerson_8 ='',
		DesignationofcontactPerson_8 ='',
		PANofcontactPerson_8 ='',
		AddressofcontactPerson_8 ='',
		ContactdetailsofcontactPerson_8 ='',
		DINofcontactPerson_8 ='',
		UIDofcontactPerson_8 ='',
		EmailIdofcontactPerson_8 ='',
		NameofcontactPerson_9 ='',
		DesignationofcontactPerson_9='', 
		PANofcontactPerson_9 ='',
		AddressofcontactPerson_9 ='',
		ContactdetailsofcontactPerson_9='', 
		DINofcontactPerson_9 ='',
		UIDofcontactPerson_9 ='',
		EmailIdofcontactPerson_9 ='',
		NameofcontactPerson_10 ='',
		DesignationofcontactPerson_10='', 
		PANofcontactPerson_10 ='',
		AddressofcontactPerson_10 ='',
		ContactdetailsofcontactPerson_10='', 
		DINofcontactPerson_10 ='',
		UIDofcontactPerson_10 ='',
		EmailIdofcontactPerson_10 ='',
		NameofcontactPerson_11 ='',
		DesignationofcontactPerson_11='', 
		PANofcontactPerson_11 ='',
		AddressofcontactPerson_11 ='',
		ContactdetailsofcontactPerson_11='', 
		DINofcontactPerson_11 ='',
		UIDofcontactPerson_11 ='',
		EmailIdofcontactPerson_11 ='',
		NameofcontactPerson_12 ='',
		DesignationofcontactPerson_12='', 
		PANofcontactPerson_12 ='',
		AddressofcontactPerson_12 ='',
		ContactdetailsofcontactPerson_12='', 
		DINofcontactPerson_12 ='',
		UIDofcontactPerson_12 ='',
		EmailIdofcontactPerson_12 ='',
		NameofcontactPerson_13 ='',
		DesignationofcontactPerson_13 ='',
		PANofcontactPerson_13 ='',
		AddressofcontactPerson_13 ='',
		ContactdetailsofcontactPerson_13 ='',
		DINofcontactPerson_13 ='',
		UIDofcontactPerson_13 ='',
		EmailIdofcontactPerson_13 ='',
		NameofcontactPerson_14 ='',
		DesignationofcontactPerson_14 ='',
		PANofcontactPerson_14 ='',
		AddressofcontactPerson_14 ='',
		ContactdetailsofcontactPerson_14 ='',
		DINofcontactPerson_14 ='',
		UIDofcontactPerson_14 ='',
		EmailIdofcontactPerson_14 ='',
		NameofcontactPerson_15 ='',
		DesignationofcontactPerson_15 ='',
		PANofcontactPerson_15 ='',
		AddressofcontactPerson_15 ='',
		ContactdetailsofcontactPerson_15='', 
		DINofcontactPerson_15 ='',
		UIDofcontactPerson_15 ='',
		EmailIdofcontactPerson_15 ='',
		NameofcontactPerson_16 ='',
		DesignationofcontactPerson_16='', 
		PANofcontactPerson_16 ='',
		AddressofcontactPerson_16 ='',
		ContactdetailsofcontactPerson_16='', 
		DINofcontactPerson_16 ='',
		UIDofcontactPerson_16 ='',
		EmailIdofcontactPerson_16 ='',
		NameofcontactPerson_17 ='',
		DesignationofcontactPerson_17='', 
		PANofcontactPerson_17 ='',
		AddressofcontactPerson_17 ='',
		ContactdetailsofcontactPerson_17='', 
		DINofcontactPerson_17 ='',
		UIDofcontactPerson_17 ='',
		EmailIdofcontactPerson_17 ='',
		NameofcontactPerson_18 ='',
		DesignationofcontactPerson_18='', 
		PANofcontactPerson_18 ='',
		AddressofcontactPerson_18 ='',
		ContactdetailsofcontactPerson_18='', 
		DINofcontactPerson_18 ='',
		UIDofcontactPerson_18 ='',
		EmailIdofcontactPerson_18 ='',
		NameofcontactPerson_19 ='',
		DesignationofcontactPerson_19='', 
		PANofcontactPerson_19 ='',
		AddressofcontactPerson_19 ='',
		ContactdetailsofcontactPerson_19='', 
		DINofcontactPerson_19 ='',
		UIDofcontactPerson_19 ='',
		EmailIdofcontactPerson_19 ='',
		NameofcontactPerson_20 ='',
		DesignationofcontactPerson_20='', 
		PANofcontactPerson_20 ='',
		AddressofcontactPerson_20 ='',
		ContactdetailsofcontactPerson_20='', 
		DINofcontactPerson_20 ='',
		UIDofcontactPerson_20 ='',
		EmailIdofcontactPerson_20 ='',
		POAforFunds ='N',
	    POAforSecurities='N', 
		Flag='E'
	from
		(
			select
				c1.*,
				b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_Client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
		#temp_Client2 c2 with (nolock),
		#temp_Client5 c5 with (nolock)

	where
		ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and
		ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and
		ltrim(rtrim(left(c2.party_code,2))) <> '98'
		

	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),
	    --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/
	    --MASTERPAN=ISNULL(c1.MASTERPAN,''),
	    TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),
		--Gender=isnull(c1.Gender,''),
		Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=
					case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		GrossAnnualIncomeRange=case 
					when c1.Gross_Income ='01' then '1'
					when c1.Gross_Income ='02' then '2'
					when c1.Gross_Income ='03' then '3'
					when c1.Gross_Income ='04' then '4'
					when c1.Gross_Income ='05' then '5'
					when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/
					when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/
					else '' end, 
		NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''
						else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,
		PoliticallyExposedPerson_PEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end,
		OccupationDetails_Forothers=isnull(Occupation_Other,''),
		UIDNUMBER=isnull(c1.AADHAR_UID,'')
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0			
	
	update 
		#mimansa_angel_ucc_nse_slb_client_data_new_changes 
	set 
		GrossAnnualIncomeasonDate='',
		NetWorth_InRs='',
		NetWorthasonDate=''
	where len(GrossAnnualIncomeRange)=0 

	
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		#mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),
		ClientType_Corporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4	

	/****ADDRESS 1****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_1=c1.contact_name,
	DesignationofContactPerson_1=c1.designation,
	PANofcontactPerson_1=c1.PanNo,
	AddressofcontactPerson_1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_1=c1.DIN,
	UIDofcontactPerson_1=c1.UID,
	EmailIdofcontactPerson_1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='1'

	/****ADDRESS 2****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_2=c1.contact_name,
	DesignationofContactPerson_2=c1.designation,
	PANofcontactPerson_2=c1.PanNo,
	AddressofcontactPerson_2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_2=c1.DIN,
	UIDofcontactPerson_2=c1.UID,
	EmailIdofcontactPerson_2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='2'

	/****ADDRESS 3****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_3=c1.contact_name,
	DesignationofContactPerson_3=c1.designation,
	PANofcontactPerson_3=c1.PanNo,
	AddressofcontactPerson_3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_3=c1.DIN,
	UIDofcontactPerson_3=c1.UID,
	EmailIdofcontactPerson_3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='3'

	/****ADDRESS 4****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_4=c1.contact_name,
	DesignationofContactPerson_4=c1.designation,
	PANofcontactPerson_4=c1.PanNo,
	AddressofcontactPerson_4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_4=c1.DIN,
	UIDofcontactPerson_4=c1.UID,
	EmailIdofcontactPerson_4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_5=c1.contact_name,
	DesignationofContactPerson_5=c1.designation,
	PANofcontactPerson_5=c1.PanNo,
	AddressofcontactPerson_5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_5=c1.DIN,
	UIDofcontactPerson_5=c1.UID,
	EmailIdofcontactPerson_5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_6=c1.contact_name,
	DesignationofContactPerson_6=c1.designation,
	PANofcontactPerson_6=c1.PanNo,
	AddressofcontactPerson_6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_6=c1.DIN,
	UIDofcontactPerson_6=c1.UID,
	EmailIdofcontactPerson_6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_7=c1.contact_name,
	DesignationofContactPerson_7=c1.designation,
	PANofcontactPerson_7=c1.PanNo,
	AddressofcontactPerson_7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_7=c1.DIN,
	UIDofcontactPerson_7=c1.UID,
	EmailIdofcontactPerson_7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_8=c1.contact_name,
	DesignationofContactPerson_8=c1.designation,
	PANofcontactPerson_8=c1.PanNo,
	AddressofcontactPerson_8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_8=c1.DIN,
	UIDofcontactPerson_8=c1.UID,
	EmailIdofcontactPerson_8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_9=c1.contact_name,
	DesignationofContactPerson_9=c1.designation,
	PANofcontactPerson_9=c1.PanNo,
	AddressofcontactPerson_9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_9=c1.DIN,
	UIDofcontactPerson_9=c1.UID,
	EmailIdofcontactPerson_9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_10=c1.contact_name,
	DesignationofContactPerson_10=c1.designation,
	PANofcontactPerson_10=c1.PanNo,
	AddressofcontactPerson_10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_10=c1.DIN,
	UIDofcontactPerson_10=c1.UID,
	EmailIdofcontactPerson_10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='10'



		/*Update POA*/
		--Update 
		--    #mimansa_angel_ucc_nse_slb_client_data_new_changes
		--  set 		  
	 --     POAforSecurities=
		--  case 
		--		when ltrim(rtrim(Def))=1 then 'Y'  
		--		when ltrim(rtrim(Def))=0 then 'N' 				
		--		else  '' 
		--	end
		--  from
		--   anand1.msajag.dbo.Multicltid m with(nolock)
	 --     where
		--Client_Code = m.Party_code

	
	/*INVALID PAN*/

	

	select distinct
		client_code = ltrim(rtrim(client_code)),
		client_name = ltrim(rtrim(client_name)),
		pan = ltrim(rtrim(pan))
		--pan,
		--pan_err = 
		--	case 
		--		when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'
		--		then 'NO PAN'
		--		when len(ltrim(rtrim(isnull(pan, '')))) = 0
		--		then 'NO PAN'
		--		when not (
		--			isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and
		--			isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and
		--			isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and
		--			len(ltrim(rtrim(isnull(pan, '')))) = 10
		--		)
		--		then 'INVALID PAN'
		--	end,

		--pan_length = len(ltrim(rtrim(isnull(pan, '')))),
		--telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),
		--client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))
into #invalidpan
	from
		--mimansa_angel_ucc_nse_fo_client_data with(nolock)
		mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
	where
		ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'

	

	
delete
	#mimansa_angel_ucc_nse_slb_client_data_new_changes
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp 
where
	ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10

/***************FINAL DISPLAY*******************/
select distinct
		Segment, 
		Client_Code=ltrim(RTRIM(Client_Code)), 
		Client_Name ,
		Category ,
		PAN ,
		Gender, 
		Fathers_Husbands_GuardiansName ,
		Maritalstatus ,
		Nationality ,
		Nationality_Other, 
		ClientEmailId ,
		CorrespondenceClientAddressline1 ,
		CorrespondenceClientAddressline2 ,
		CorrespondenceClientAddressline3 ,
		CorrespondenceClientAddress_City ,
		CorrespondenceClientAddress_State ,
		CorrespondenceClientAddress_State_Others, 
		CorrespondenceClientAddress_Country ,
		CorrespondenceClientAddress_Pincode ,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,
		PermanentClientAddressline1 ,
		PermanentClientAddressline2 ,
		PermanentClientAddressline3 ,
		PermanentClientAddress_City ,
		PermanentClientAddress_State ,
		PermanentClientAddress_StateOthers  ,
		PermanentClientAddress_Country ,
		PermanentClientAddress_Pincode ,
		ISDcode_Residence ,
		STDcode_Residence ,
		TelephoneNumber_Residence ,
		Mobilenumber ,
		ISDcode_Office, 
		STDcode_Office ,
		TelephoneNumber_Office ,
		DateofBirth_Incorporation ,
		UIDNUMBER ,
		BankName1 ,
		BankBranchAddress1 ,
		BankAccountNo1 ,
		BankAccountType1 ,
		BankName2 ,
		BankBranchAddress2 ,
		BankAccountNo2 ,
		BankAccountType2 ,
		BankName3 ,
		BankBranchAddress3 ,
		BankAccountNo3 ,
		BankAccountType3, 
		DepositoryName1 ,
		DepositoryID1 ,
		BeneficialOwnerAccountNo1 ,
		DepositoryName2 ,
		DepositoryID2 ,
		BeneficialOwnerAccountNo2 ,
		DepositoryName3 ,
		DepositoryID3 ,
		BeneficialOwnerAccountNo3 ,
		CorporateIdentitynumber_CIN, 
		GrossAnnualIncomeRange ,
		GrossAnnualIncomeasonDate, 
		NetWorth_InRs ,
		NetWorthasonDate, 
		PoliticallyExposedPerson_PEP ,
		PlaceofIncorporation ,
		Occupation ,
		OccupationDetails_Forothers ,
		Dateofcommencementofbusiness ,
		CustodialParticipantCodeoftheclient ,
		RegistrationNoofClient ,
		RegisteringAuthority ,
		PlaceofRegistration ,
		DateofRegistration ,
		InpersonVerification, 
		ClientAgreementDate ,
		UniqueClientCodeallottedbyNSCCL_BSE ,
		UpdationFlag_for_SMS_and_Email_facility ,
		Relationship ,
		TypeofFacility_for_SMS_and_Email_facility ,
		ProofType ,
		ProofNumber ,
		IssuePlaceofProof ,
		IssueDateofProof ,
		ClientStatus ,
		Remarks ,
		ClientType_Corporate, 
		NameofcontactPerson_1 ,
		DesignationofContactPerson_1 ,
		PANofcontactPerson_1 ,
		AddressofcontactPerson_1 ,
		ContactdetailsofcontactPerson_1 ,
		DINofcontactPerson_1 ,
		UIDofcontactPerson_1 ,
		EmailIdofcontactPerson_1 ,
		NameofcontactPerson_2  ,
		DesignationofcontactPerson_2 ,
		PANofcontactPerson_2 ,
		AddressofcontactPerson_2 ,
		ContactdetailsofcontactPerson_2, 
		DINofcontactPerson_2 ,
		UIDofcontactPerson_2 ,
		EmailIdofcontactPerson_2 ,
		NameofcontactPerson_3 ,
		DesignationofcontactPerson_3, 
		PANofcontactPerson_3 ,
		AddressofcontactPerson_3 ,
		ContactdetailsofcontactPerson_3, 
		DINofcontactPerson_3 ,
		UIDofcontactPerson_3 ,
		EmailIdofcontactPerson_3 ,
		NameofcontactPerson_4 ,
		DesignationofcontactPerson_4, 
		PANofcontactPerson_4 ,
		AddressofcontactPerson_4 ,
		ContactdetailsofcontactPerson_4 ,
		DINofcontactPerson_4 ,
		UIDofcontactPerson_4 ,
		EmailIdofcontactPerson_4 ,
		NameofcontactPerson_5 ,
		DesignationofcontactPerson_5 ,
		PANofcontactPerson_5 ,
		AddressofcontactPerson_5 ,
		ContactdetailsofcontactPerson_5, 
		DINofcontactPerson_5 ,
		UIDofcontactPerson_5 ,
		EmailIdofcontactPerson_5 ,
		NameofcontactPerson_6 ,
		DesignationofcontactPerson_6, 
		PANofcontactPerson_6 ,
		AddressofcontactPerson_6 ,
		ContactdetailsofcontactPerson_6, 
		DINofcontactPerson_6 ,
		UIDofcontactPerson_6 ,
		EmailIdofcontactPerson_6 ,
		NameofcontactPerson_7 ,
		DesignationofcontactPerson_7, 
		PANofcontactPerson_7 ,
		AddressofcontactPerson_7 ,
		ContactdetailsofcontactPerson_7, 
		DINofcontactPerson_7 ,
		UIDofcontactPerson_7 ,
		EmailIdofcontactPerson_7 ,
		NameofcontactPerson_8 ,
		DesignationofcontactPerson_8 ,
		PANofcontactPerson_8 ,
		AddressofcontactPerson_8 ,
		ContactdetailsofcontactPerson_8 ,
		DINofcontactPerson_8 ,
		UIDofcontactPerson_8 ,
		EmailIdofcontactPerson_8 ,
		NameofcontactPerson_9 ,
		DesignationofcontactPerson_9, 
		PANofcontactPerson_9 ,
		AddressofcontactPerson_9 ,
		ContactdetailsofcontactPerson_9, 
		DINofcontactPerson_9 ,
		UIDofcontactPerson_9 ,
		EmailIdofcontactPerson_9 ,
		NameofcontactPerson_10 ,
		DesignationofcontactPerson_10, 
		PANofcontactPerson_10 ,
		AddressofcontactPerson_10 ,
		ContactdetailsofcontactPerson_10, 
		DINofcontactPerson_10 ,
		UIDofcontactPerson_10 ,
		EmailIdofcontactPerson_10 ,
		NameofcontactPerson_11 ,
		DesignationofcontactPerson_11, 
		PANofcontactPerson_11 ,
		AddressofcontactPerson_11 ,
		ContactdetailsofcontactPerson_11, 
		DINofcontactPerson_11 ,
		UIDofcontactPerson_11 ,
		EmailIdofcontactPerson_11 ,
		NameofcontactPerson_12 ,
		DesignationofcontactPerson_12, 
		PANofcontactPerson_12 ,
		AddressofcontactPerson_12 ,
		ContactdetailsofcontactPerson_12, 
		DINofcontactPerson_12 ,
		UIDofcontactPerson_12 ,
		EmailIdofcontactPerson_12 ,
		NameofcontactPerson_13 ,
		DesignationofcontactPerson_13 ,
		PANofcontactPerson_13 ,
		AddressofcontactPerson_13 ,
		ContactdetailsofcontactPerson_13 ,
		DINofcontactPerson_13 ,
		UIDofcontactPerson_13 ,
		EmailIdofcontactPerson_13 ,
		NameofcontactPerson_14 ,
		DesignationofcontactPerson_14 ,
		PANofcontactPerson_14 ,
		AddressofcontactPerson_14 ,
		ContactdetailsofcontactPerson_14 ,
		DINofcontactPerson_14 ,
		UIDofcontactPerson_14 ,
		EmailIdofcontactPerson_14 ,
		NameofcontactPerson_15 ,
		DesignationofcontactPerson_15 ,
		PANofcontactPerson_15 ,
		AddressofcontactPerson_15 ,
		ContactdetailsofcontactPerson_15, 
		DINofcontactPerson_15 ,
		UIDofcontactPerson_15 ,
		EmailIdofcontactPerson_15 ,
		NameofcontactPerson_16 ,
		DesignationofcontactPerson_16, 
		PANofcontactPerson_16 ,
		AddressofcontactPerson_16 ,
		ContactdetailsofcontactPerson_16, 
		DINofcontactPerson_16 ,
		UIDofcontactPerson_16 ,
		EmailIdofcontactPerson_16 ,
		NameofcontactPerson_17 ,
		DesignationofcontactPerson_17, 
		PANofcontactPerson_17 ,
		AddressofcontactPerson_17 ,
		ContactdetailsofcontactPerson_17, 
		DINofcontactPerson_17 ,
		UIDofcontactPerson_17 ,
		EmailIdofcontactPerson_17 ,
		NameofcontactPerson_18 ,
		DesignationofcontactPerson_18, 
		PANofcontactPerson_18 ,
		AddressofcontactPerson_18 ,
		ContactdetailsofcontactPerson_18, 
		DINofcontactPerson_18 ,
		UIDofcontactPerson_18 ,
		EmailIdofcontactPerson_18 ,
		NameofcontactPerson_19 ,
		DesignationofcontactPerson_19, 
		PANofcontactPerson_19 ,
		AddressofcontactPerson_19 ,
		ContactdetailsofcontactPerson_19, 
		DINofcontactPerson_19 ,
		UIDofcontactPerson_19 ,
		EmailIdofcontactPerson_19 ,
		NameofcontactPerson_20 ,
		DesignationofcontactPerson_20, 
		PANofcontactPerson_20 ,
		AddressofcontactPerson_20 ,
		ContactdetailsofcontactPerson_20, 
		DINofcontactPerson_20 ,
		UIDofcontactPerson_20 ,
		EmailIdofcontactPerson_20 ,
		POAforFunds ='N',
	    POAforSecurities='N', 
		Flag='E'
from
	#mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
 
where
	len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'





	/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)	
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'

/*Insert Log*/
if exists(select * from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))
begin
	if(@totalrecord>0)
	begin
		update [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count 
		set file_number=file_number+1
		where time_stamp>=cast(left(getdate(),11) as datetime)
	end
end
else
begin
	if(@totalrecord>0)
	begin
		insert into [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)
		select 1,getdate()
	end
end
	
/*Display File Name and First Row
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)
				Ex- uci_20140225.t04
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count 
				Ex- 10|M|12798|27022014|04|220
*/

select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')
				+'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),					
	   FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'
				+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'
				+cast(@totalrecord  as varchar) 
from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)


/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_Backup(29May2015)
-- --------------------------------------------------
-- [mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015] 'Feb 10 2015','Feb 10 2015','',''
Create proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_Backup(29May2015)]
	(
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
	)
as
--mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015 'Feb 10 2014','Feb 10 2014','',''
	/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate
		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

	/*******************FETCH DATA**************************/

	--truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes
	

CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(
	[Segment] [varchar](1) NULL,
	[Client_Code] [varchar](10) NULL,
	[Client_Name] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[Fathers_Husbands_GuardiansName] [varchar](150) NULL,
	[Maritalstatus] [varchar](2) NULL,
	[Nationality] [varchar](2) NULL,
	[Nationality_Other] [varchar](50) NULL,
	[ClientEmailId] [varchar](60) NULL,
	[CorrespondenceClientAddressline1] [varchar](255) NULL,
	[CorrespondenceClientAddressline2] [varchar](255) NULL,
	[CorrespondenceClientAddressline3] [varchar](255) NULL,
	[CorrespondenceClientAddress_City] [varchar](50) NULL,
	[CorrespondenceClientAddress_State] [varchar](2) NULL,
	[CorrespondenceClientAddress_State_Others] [varchar](75) NULL,
	[CorrespondenceClientAddress_Country] [varchar](3) NULL,
	[CorrespondenceClientAddress_Pincode] [varchar](10) NULL,
	[FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,
	[PermanentClientAddressline1] [varchar](255) NULL,
	[PermanentClientAddressline2] [varchar](255) NULL,
	[PermanentClientAddressline3] [varchar](255) NULL,
	[PermanentClientAddress_City] [varchar](50) NULL,
	[PermanentClientAddress_State] [varchar](2) NULL,
	[PermanentClientAddress_StateOthers] [varchar](75) NULL,
	[PermanentClientAddress_Country] [varchar](2) NULL,
	[PermanentClientAddress_Pincode] [varchar](10) NULL,
	[ISDcode_Residence] [varchar](10) NULL,
	[STDcode_Residence] [varchar](10) NULL,
	[TelephoneNumber_Residence] [varchar](60) NULL,
	[Mobilenumber] [varchar](20) NULL,
	[ISDcode_Office] [varchar](10) NULL,
	[STDcode_Office] [varchar](10) NULL,
	[TelephoneNumber_Office] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](60) NULL,
	[UIDNUMBER] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNo1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNo2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNo3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](4) NULL,
	[DepositoryID1] [varchar](8) NULL,
	[BeneficialOwnerAccountNo1] [varchar](16) NULL,
	[DepositoryName2] [varchar](4) NULL,
	[DepositoryID2] [varchar](8) NULL,
	[BeneficialOwnerAccountNo2] [varchar](16) NULL,
	[DepositoryName3] [varchar](4) NULL,
	[DepositoryID3] [varchar](8) NULL,
	[BeneficialOwnerAccountNo3] [varchar](16) NULL,
	[CorporateIdentitynumber_CIN] [varchar](21) NULL,
	[GrossAnnualIncomeRange] [varchar](40) NULL,
	[GrossAnnualIncomeasonDate] [varchar](40) NULL,
	[NetWorth_InRs] [varchar](40) NULL,
	[NetWorthasonDate] [varchar](40) NULL,
	[PoliticallyExposedPerson_PEP] [varchar](2) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetails_Forothers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](40) NULL,
	[CustodialParticipantCodeoftheclient] [varchar](15) NULL,
	[RegistrationNoofClient] [varchar](25) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](40) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](40) NULL,
	[UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,
	[UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,
	[Relationship] [varchar](1) NULL,
	[TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,
	[ProofType] [varchar](1) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](40) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientType_Corporate] [varchar](200) NULL,
	[NameofcontactPerson_1] [varchar](200) NULL,
	[DesignationofContactPerson_1] [varchar](200) NULL,
	[PANofcontactPerson_1] [varchar](200) NULL,
	[AddressofcontactPerson_1] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_1] [varchar](200) NULL,
	[DINofcontactPerson_1] [varchar](200) NULL,
	[UIDofcontactPerson_1] [varchar](200) NULL,
	[EmailIdofcontactPerson_1] [varchar](200) NULL,
	[NameofcontactPerson_2] [varchar](200) NULL,
	[DesignationofcontactPerson_2] [varchar](200) NULL,
	[PANofcontactPerson_2] [varchar](200) NULL,
	[AddressofcontactPerson_2] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_2] [varchar](200) NULL,
	[DINofcontactPerson_2] [varchar](200) NULL,
	[UIDofcontactPerson_2] [varchar](200) NULL,
	[EmailIdofcontactPerson_2] [varchar](200) NULL,
	[NameofcontactPerson_3] [varchar](200) NULL,
	[DesignationofcontactPerson_3] [varchar](200) NULL,
	[PANofcontactPerson_3] [varchar](200) NULL,
	[AddressofcontactPerson_3] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_3] [varchar](200) NULL,
	[DINofcontactPerson_3] [varchar](200) NULL,
	[UIDofcontactPerson_3] [varchar](200) NULL,
	[EmailIdofcontactPerson_3] [varchar](200) NULL,
	[NameofcontactPerson_4] [varchar](200) NULL,
	[DesignationofcontactPerson_4] [varchar](200) NULL,
	[PANofcontactPerson_4] [varchar](200) NULL,
	[AddressofcontactPerson_4] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_4] [varchar](200) NULL,
	[DINofcontactPerson_4] [varchar](200) NULL,
	[UIDofcontactPerson_4] [varchar](200) NULL,
	[EmailIdofcontactPerson_4] [varchar](200) NULL,
	[NameofcontactPerson_5] [varchar](200) NULL,
	[DesignationofcontactPerson_5] [varchar](200) NULL,
	[PANofcontactPerson_5] [varchar](200) NULL,
	[AddressofcontactPerson_5] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_5] [varchar](200) NULL,
	[DINofcontactPerson_5] [varchar](200) NULL,
	[UIDofcontactPerson_5] [varchar](200) NULL,
	[EmailIdofcontactPerson_5] [varchar](200) NULL,
	[NameofcontactPerson_6] [varchar](200) NULL,
	[DesignationofcontactPerson_6] [varchar](200) NULL,
	[PANofcontactPerson_6] [varchar](200) NULL,
	[AddressofcontactPerson_6] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_6] [varchar](200) NULL,
	[DINofcontactPerson_6] [varchar](200) NULL,
	[UIDofcontactPerson_6] [varchar](200) NULL,
	[EmailIdofcontactPerson_6] [varchar](200) NULL,
	[NameofcontactPerson_7] [varchar](200) NULL,
	[DesignationofcontactPerson_7] [varchar](200) NULL,
	[PANofcontactPerson_7] [varchar](200) NULL,
	[AddressofcontactPerson_7] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_7] [varchar](200) NULL,
	[DINofcontactPerson_7] [varchar](200) NULL,
	[UIDofcontactPerson_7] [varchar](200) NULL,
	[EmailIdofcontactPerson_7] [varchar](200) NULL,
	[NameofcontactPerson_8] [varchar](200) NULL,
	[DesignationofcontactPerson_8] [varchar](200) NULL,
	[PANofcontactPerson_8] [varchar](200) NULL,
	[AddressofcontactPerson_8] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_8] [varchar](200) NULL,
	[DINofcontactPerson_8] [varchar](200) NULL,
	[UIDofcontactPerson_8] [varchar](200) NULL,
	[EmailIdofcontactPerson_8] [varchar](200) NULL,
	[NameofcontactPerson_9] [varchar](200) NULL,
	[DesignationofcontactPerson_9] [varchar](200) NULL,
	[PANofcontactPerson_9] [varchar](200) NULL,
	[AddressofcontactPerson_9] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_9] [varchar](200) NULL,
	[DINofcontactPerson_9] [varchar](200) NULL,
	[UIDofcontactPerson_9] [varchar](200) NULL,
	[EmailIdofcontactPerson_9] [varchar](200) NULL,
	[NameofcontactPerson_10] [varchar](200) NULL,
	[DesignationofcontactPerson_10] [varchar](200) NULL,
	[PANofcontactPerson_10] [varchar](200) NULL,
	[AddressofcontactPerson_10] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_10] [varchar](200) NULL,
	[DINofcontactPerson_10] [varchar](200) NULL,
	[UIDofcontactPerson_10] [varchar](200) NULL,
	[EmailIdofcontactPerson_10] [varchar](200) NULL,
	[NameofcontactPerson_11] [varchar](200) NULL,
	[DesignationofcontactPerson_11] [varchar](200) NULL,
	[PANofcontactPerson_11] [varchar](200) NULL,
	[AddressofcontactPerson_11] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_11] [varchar](200) NULL,
	[DINofcontactPerson_11] [varchar](200) NULL,
	[UIDofcontactPerson_11] [varchar](200) NULL,
	[EmailIdofcontactPerson_11] [varchar](200) NULL,
	[NameofcontactPerson_12] [varchar](200) NULL,
	[DesignationofcontactPerson_12] [varchar](200) NULL,
	[PANofcontactPerson_12] [varchar](200) NULL,
	[AddressofcontactPerson_12] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_12] [varchar](200) NULL,
	[DINofcontactPerson_12] [varchar](200) NULL,
	[UIDofcontactPerson_12] [varchar](200) NULL,
	[EmailIdofcontactPerson_12] [varchar](200) NULL,
	[NameofcontactPerson_13] [varchar](200) NULL,
	[DesignationofcontactPerson_13] [varchar](200) NULL,
	[PANofcontactPerson_13] [varchar](200) NULL,
	[AddressofcontactPerson_13] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_13] [varchar](200) NULL,
	[DINofcontactPerson_13] [varchar](200) NULL,
	[UIDofcontactPerson_13] [varchar](200) NULL,
	[EmailIdofcontactPerson_13] [varchar](200) NULL,
	[NameofcontactPerson_14] [varchar](200) NULL,
	[DesignationofcontactPerson_14] [varchar](200) NULL,
	[PANofcontactPerson_14] [varchar](200) NULL,
	[AddressofcontactPerson_14] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_14] [varchar](200) NULL,
	[DINofcontactPerson_14] [varchar](200) NULL,
	[UIDofcontactPerson_14] [varchar](200) NULL,
	[EmailIdofcontactPerson_14] [varchar](200) NULL,
	[NameofcontactPerson_15] [varchar](200) NULL,
	[DesignationofcontactPerson_15] [varchar](200) NULL,
	[PANofcontactPerson_15] [varchar](200) NULL,
	[AddressofcontactPerson_15] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_15] [varchar](200) NULL,
	[DINofcontactPerson_15] [varchar](200) NULL,
	[UIDofcontactPerson_15] [varchar](200) NULL,
	[EmailIdofcontactPerson_15] [varchar](200) NULL,
	[NameofcontactPerson_16] [varchar](200) NULL,
	[DesignationofcontactPerson_16] [varchar](200) NULL,
	[PANofcontactPerson_16] [varchar](200) NULL,
	[AddressofcontactPerson_16] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_16] [varchar](200) NULL,
	[DINofcontactPerson_16] [varchar](200) NULL,
	[UIDofcontactPerson_16] [varchar](200) NULL,
	[EmailIdofcontactPerson_16] [varchar](200) NULL,
	[NameofcontactPerson_17] [varchar](200) NULL,
	[DesignationofcontactPerson_17] [varchar](200) NULL,
	[PANofcontactPerson_17] [varchar](200) NULL,
	[AddressofcontactPerson_17] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_17] [varchar](200) NULL,
	[DINofcontactPerson_17] [varchar](200) NULL,
	[UIDofcontactPerson_17] [varchar](200) NULL,
	[EmailIdofcontactPerson_17] [varchar](200) NULL,
	[NameofcontactPerson_18] [varchar](200) NULL,
	[DesignationofcontactPerson_18] [varchar](200) NULL,
	[PANofcontactPerson_18] [varchar](200) NULL,
	[AddressofcontactPerson_18] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_18] [varchar](200) NULL,
	[DINofcontactPerson_18] [varchar](200) NULL,
	[UIDofcontactPerson_18] [varchar](200) NULL,
	[EmailIdofcontactPerson_18] [varchar](200) NULL,
	[NameofcontactPerson_19] [varchar](200) NULL,
	[DesignationofcontactPerson_19] [varchar](200) NULL,
	[PANofcontactPerson_19] [varchar](200) NULL,
	[AddressofcontactPerson_19] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_19] [varchar](200) NULL,
	[DINofcontactPerson_19] [varchar](200) NULL,
	[UIDofcontactPerson_19] [varchar](200) NULL,
	[EmailIdofcontactPerson_19] [varchar](200) NULL,
	[NameofcontactPerson_20] [varchar](200) NULL,
	[DesignationofcontactPerson_20] [varchar](200) NULL,
	[PANofcontactPerson_20] [varchar](200) NULL,
	[AddressofcontactPerson_20] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_20] [varchar](200) NULL,
	[DINofcontactPerson_20] [varchar](200) NULL,
	[UIDofcontactPerson_20] [varchar](200) NULL,
	[EmailIdofcontactPerson_20] [varchar](200) NULL,
	[POAforFunds] [varchar](1) NULL,
	[POAforSecurities] [varchar](1) NULL,
	[Flag] [varchar](1) NULL
)
	
	--insert into 
	--	angel_ucc_nse_fo_client1
	select
		party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=cast('' as varchar(255)),
		P_address2=cast('' as varchar(255)),
		P_address3=cast('' as varchar(255)),
		P_City=cast('' as varchar(50)),
		P_State=cast('' as varchar(100)),
		P_State_For_Other=cast('' as varchar(100)),
		P_nation=cast('' as varchar(100)),
		P_zip=cast('' as varchar(10)),
		P_Len=cast('' as varchar(1)),	
		Gender=cast('' as varchar(1)),
		STDcode_Residence1=cast('' as varchar(10)),
		STDcode_Residence2=cast('' as varchar(10)),
		STDcode_Office1=cast('' as varchar(10)),
		STDcode_Office2=cast('' as varchar(10))
	into 
		#temp_client1	
	from 
		NSESLBS.dbo.client1 c1 with(nolock),
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c1.cl_code = c2.cl_code and 
		c2.party_code = t.party_code 

	update #temp_client1 set 
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,'')
	from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)
	where t1.Cl_Code=c1.cl_code

	update 
		#temp_Client1 
	set 
	L_State= dbo.fn_state_countary_value(l_state,'STATE'),
	P_State=dbo.fn_state_countary_value(P_state,'STATE'),
	L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),
	P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),
	cl_status=case
				/*INDIVIDUAL/PROPRIETORSHIP FIRMS*/
				when cl_status = 'IND' then '1'		/*INDIVIDUAL*/

				/*PARTNERSHIP FIRM*/
				when cl_status = 'PF' or cl_status='LLP' then '2'		/*PARTNERSHIP FIRMS*/

				/*HUF*/
				when cl_status = 'HUF' then '3'		/*HINDU UNDIVIDED FAMILY*/

				/*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/
				when cl_status = 'PPB' then '4'		/*PUB. PVT COMP/BODIES CORP*/
				when cl_status = 'BCP' then '4'		/*BODY CORPORATE*/

				/*TRUST / SOCIETY*/
				when cl_status = 'TS' then '5'		/*TRUST / SOCIETY*/

				/*MUTUAL FUND*/
				when cl_status = 'MF' then '6'		/*MUTUAL FUNDS*/
				when cl_status = 'MFF' then '6'		/*MUTUAL FUND (MF)*/

				/*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/
				when cl_status = 'IFI' then '7'		/*INDIAN FINANCIAL INSTI*/
				when cl_status = 'DFI' then '7'		/*DOMESTIC FIN. INST.*/

				/*BANK*/
				when cl_status = 'BA' then ' 8'		/*BANKS*/
				when cl_status = 'BNK' then '8'		/*BANK*/

				/*INSURANCE*/
				when cl_status = 'IC' then ' 9'		/*INSURANCE COMPANIES*/

				/*STATUTORY BODIES*/
				when cl_status = 'SB' then ' 10'		/*STATUTORY BODIES*/

				/*NRI*/
				when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'		/*NON RESIDENT INDIAN*/

				/*FII*/
				when cl_status = 'FII' then '12'		/*FOREIGN INSTIT INVESTORS*/

				/*OCB*/
				when cl_status = 'OCB' then '13'		/*OVERSEAS CORPORATE BODIES*/

				/*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/
				when cl_status = 'DFN' then '14'		/*DIRECT FOREIGN INVESTMENTS*/

				when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/
				
				/*FVC*/
				when cl_status = 'FVC' then '20'		/*FOREIGN VENTURE CAPITAL FUNDS*/
			else
				'1'		/*INDIVIDUAL*/
			end

	
	select 
		Cl_Code, Party_code=c2.Party_code
	into #temp_client2	
	from 
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c2.party_code = t.party_code
	
	select 
		party_code = ltrim(rtrim(t.party_code)),
		--c5.*
		cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),
		--BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),
		--ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */
		ActiveFrom=c5.ActiveFrom,
		InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),
		GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))
	into #temp_Client5	
	from 
		NSESLBS.dbo.client5 c5 with(nolock),
		#temp_Client2 t with (nolock)
	where 
		c5.cl_code = t.cl_code

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.pobank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.bank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('CDSL', 'NSDL') and
		isnull(c4.defdp, '') = '1'

	--insert into
	--	angel_ucc_nse_fo_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank	
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))


	/*******************END - FETCH DATA**************************/

	insert into
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
		(
			Segment	,
			Client_Code	,
			Client_Name	,
			Category	,
			PAN	,
			Gender	,
			Fathers_Husbands_GuardiansName	,
			Maritalstatus	,
			Nationality	,
			Nationality_Other	,
			ClientEmailId	,
			CorrespondenceClientAddressline1	,
			CorrespondenceClientAddressline2	,
			CorrespondenceClientAddressline3	,
			CorrespondenceClientAddress_City	,
			CorrespondenceClientAddress_State	,
			CorrespondenceClientAddress_State_Others	,
			CorrespondenceClientAddress_Country	,
			CorrespondenceClientAddress_Pincode	,
			FlagIndicatingifCorrespondenceAddressissameasPermanentAddress	,
			PermanentClientAddressline1	,
			PermanentClientAddressline2	,
			PermanentClientAddressline3	,
			PermanentClientAddress_City	,
			PermanentClientAddress_State	,
			PermanentClientAddress_StateOthers	,
			PermanentClientAddress_Country	,
			PermanentClientAddress_Pincode	,
			ISDcode_Residence	,
			STDcode_Residence	,
			TelephoneNumber_Residence	,
			Mobilenumber	,
			ISDcode_Office	,
			STDcode_Office	,
			TelephoneNumber_Office	,
			DateofBirth_Incorporation	,
			UIDNUMBER	,
			BankName1	,
			BankBranchAddress1	,
			BankAccountNo1	,
			BankAccountType1	,
			BankName2	,
			BankBranchAddress2	,
			BankAccountNo2	,
			BankAccountType2	,
			BankName3	,
			BankBranchAddress3	,
			BankAccountNo3	,
			BankAccountType3	,
			DepositoryName1	,
			DepositoryID1	,
			BeneficialOwnerAccountNo1	,
			DepositoryName2	,
			DepositoryID2	,
			BeneficialOwnerAccountNo2	,
			DepositoryName3	,
			DepositoryID3	,
			BeneficialOwnerAccountNo3	,
			CorporateIdentitynumber_CIN	,
			GrossAnnualIncomeRange	,
			GrossAnnualIncomeasonDate	,
			NetWorth_InRs	,
			NetWorthasonDate	,
			PoliticallyExposedPerson_PEP	,
			PlaceofIncorporation	,
			Occupation	,
			OccupationDetails_Forothers	,
			Dateofcommencementofbusiness	,
			CustodialParticipantCodeoftheclient	,
			RegistrationNoofClient	,
			RegisteringAuthority	,
			PlaceofRegistration	,
			DateofRegistration	,
			InpersonVerification	,
			ClientAgreementDate	,
			UniqueClientCodeallottedbyNSCCL_BSE	,
			UpdationFlag_for_SMS_and_Email_facility	,
			Relationship	,
			TypeofFacility_for_SMS_and_Email_facility	,
			ProofType	,
			ProofNumber	,
			IssuePlaceofProof	,
			IssueDateofProof	,
			ClientStatus	,
			Remarks	,
			ClientType_Corporate	,
			NameofcontactPerson_1	,
			DesignationofContactPerson_1	,
			PANofcontactPerson_1	,
			AddressofcontactPerson_1	,
			ContactdetailsofcontactPerson_1	,
			DINofcontactPerson_1	,
			UIDofcontactPerson_1	,
			EmailIdofcontactPerson_1	,
			NameofcontactPerson_2	,
			DesignationofcontactPerson_2	,
			PANofcontactPerson_2	,
			AddressofcontactPerson_2	,
			ContactdetailsofcontactPerson_2	,
			DINofcontactPerson_2	,
			UIDofcontactPerson_2	,
			EmailIdofcontactPerson_2	,
			NameofcontactPerson_3	,
			DesignationofcontactPerson_3	,
			PANofcontactPerson_3	,
			AddressofcontactPerson_3	,
			ContactdetailsofcontactPerson_3	,
			DINofcontactPerson_3	,
			UIDofcontactPerson_3	,
			EmailIdofcontactPerson_3	,
			NameofcontactPerson_4	,
			DesignationofcontactPerson_4	,
			PANofcontactPerson_4	,
			AddressofcontactPerson_4	,
			ContactdetailsofcontactPerson_4	,
			DINofcontactPerson_4	,
			UIDofcontactPerson_4	,
			EmailIdofcontactPerson_4	,
			NameofcontactPerson_5	,
			DesignationofcontactPerson_5	,
			PANofcontactPerson_5	,
			AddressofcontactPerson_5	,
			ContactdetailsofcontactPerson_5	,
			DINofcontactPerson_5	,
			UIDofcontactPerson_5	,
			EmailIdofcontactPerson_5	,
			NameofcontactPerson_6	,
			DesignationofcontactPerson_6	,
			PANofcontactPerson_6	,
			AddressofcontactPerson_6	,
			ContactdetailsofcontactPerson_6	,
			DINofcontactPerson_6	,
			UIDofcontactPerson_6	,
			EmailIdofcontactPerson_6	,
			NameofcontactPerson_7	,
			DesignationofcontactPerson_7	,
			PANofcontactPerson_7	,
			AddressofcontactPerson_7	,
			ContactdetailsofcontactPerson_7	,
			DINofcontactPerson_7	,
			UIDofcontactPerson_7	,
			EmailIdofcontactPerson_7	,
			NameofcontactPerson_8	,
			DesignationofcontactPerson_8	,
			PANofcontactPerson_8	,
			AddressofcontactPerson_8	,
			ContactdetailsofcontactPerson_8	,
			DINofcontactPerson_8	,
			UIDofcontactPerson_8	,
			EmailIdofcontactPerson_8	,
			NameofcontactPerson_9	,
			DesignationofcontactPerson_9	,
			PANofcontactPerson_9	,
			AddressofcontactPerson_9	,
			ContactdetailsofcontactPerson_9	,
			DINofcontactPerson_9	,
			UIDofcontactPerson_9	,
			EmailIdofcontactPerson_9	,
			NameofcontactPerson_10	,
			DesignationofcontactPerson_10	,
			PANofcontactPerson_10	,
			AddressofcontactPerson_10	,
			ContactdetailsofcontactPerson_10	,
			DINofcontactPerson_10	,
			UIDofcontactPerson_10	,
			EmailIdofcontactPerson_10	,
			NameofcontactPerson_11	,
			DesignationofcontactPerson_11	,
			PANofcontactPerson_11	,
			AddressofcontactPerson_11	,
			ContactdetailsofcontactPerson_11	,
			DINofcontactPerson_11	,
			UIDofcontactPerson_11	,
			EmailIdofcontactPerson_11	,
			NameofcontactPerson_12	,
			DesignationofcontactPerson_12	,
			PANofcontactPerson_12	,
			AddressofcontactPerson_12	,
			ContactdetailsofcontactPerson_12	,
			DINofcontactPerson_12	,
			UIDofcontactPerson_12	,
			EmailIdofcontactPerson_12	,
			NameofcontactPerson_13	,
			DesignationofcontactPerson_13	,
			PANofcontactPerson_13	,
			AddressofcontactPerson_13	,
			ContactdetailsofcontactPerson_13	,
			DINofcontactPerson_13	,
			UIDofcontactPerson_13	,
			EmailIdofcontactPerson_13	,
			NameofcontactPerson_14	,
			DesignationofcontactPerson_14	,
			PANofcontactPerson_14	,
			AddressofcontactPerson_14	,
			ContactdetailsofcontactPerson_14	,
			DINofcontactPerson_14	,
			UIDofcontactPerson_14	,
			EmailIdofcontactPerson_14	,
			NameofcontactPerson_15	,
			DesignationofcontactPerson_15	,
			PANofcontactPerson_15	,
			AddressofcontactPerson_15	,
			ContactdetailsofcontactPerson_15	,
			DINofcontactPerson_15	,
			UIDofcontactPerson_15	,
			EmailIdofcontactPerson_15	,
			NameofcontactPerson_16	,
			DesignationofcontactPerson_16	,
			PANofcontactPerson_16	,
			AddressofcontactPerson_16	,
			ContactdetailsofcontactPerson_16	,
			DINofcontactPerson_16	,
			UIDofcontactPerson_16	,
			EmailIdofcontactPerson_16	,
			NameofcontactPerson_17	,
			DesignationofcontactPerson_17	,
			PANofcontactPerson_17	,
			AddressofcontactPerson_17	,
			ContactdetailsofcontactPerson_17	,
			DINofcontactPerson_17	,
			UIDofcontactPerson_17	,
			EmailIdofcontactPerson_17	,
			NameofcontactPerson_18	,
			DesignationofcontactPerson_18	,
			PANofcontactPerson_18	,
			AddressofcontactPerson_18	,
			ContactdetailsofcontactPerson_18	,
			DINofcontactPerson_18	,
			UIDofcontactPerson_18	,
			EmailIdofcontactPerson_18	,
			NameofcontactPerson_19	,
			DesignationofcontactPerson_19	,
			PANofcontactPerson_19	,
			AddressofcontactPerson_19	,
			ContactdetailsofcontactPerson_19	,
			DINofcontactPerson_19	,
			UIDofcontactPerson_19	,
			EmailIdofcontactPerson_19	,
			NameofcontactPerson_20	,
			DesignationofcontactPerson_20	,
			PANofcontactPerson_20	,
			AddressofcontactPerson_20	,
			ContactdetailsofcontactPerson_20	,
			DINofcontactPerson_20	,
			UIDofcontactPerson_20	,
			EmailIdofcontactPerson_20	,
			POAforFunds ,
	        POAforSecurities, 
			Flag	
			)
	select
		segment = 'S',
		client_code = c2.party_code,
		client_name = left(c1_b.long_name, 150),
		category =cl_status,
		pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),
		Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */
		Fathers_Husbands_GuardiansName ='',
		Maritalstatus='',
		Nationality ='',
		Nationality_Other='', 
		ClientEmailId = left(email, 60),
		CorrespondenceClientAddressline1 = left(
			case
				when len(c1_b.l_address1) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address1, '')))
				end
			+
			case
				when len(c1_b.l_address2) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address2, '')))
				end
			+
			case
				when len(c1_b.l_address3) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address3, '')))
				end, 255
			),

		CorrespondenceClientAddressline2 = '',
		CorrespondenceClientAddressline3 = '',
		CorrespondenceClientAddress_City = left(c1_b.l_city, 50),
		CorrespondenceClientAddress_State = c1_b.l_state,
		CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,
		CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),
		CorrespondenceClientAddress_Pincode = 
		case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
		else
			c1_b.l_zip
		end		,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,	
		/*Modify on 30 Apr 2014*/
		PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end, 
		PermanentClientAddressline2 ='',
		PermanentClientAddressline3 ='',			
		/*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
		PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
		PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/
		PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,
		PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
		PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,
		PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
		PermanentClientAddress_Pincode =
		case when c1_b.P_Len='N' then 
			case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
			else
				c1_b.l_zip
			end
		else ''				 
		end,
		ISDcode_Residence ='',
		STDcode_Residence =case 
							when len(STDcode_Residence1)>0 then STDcode_Residence1
							when len(STDcode_Residence2)>0 then STDcode_Residence2
						   else '' end,	
		TelephoneNumber_Residence = 
			left(	case 
						when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')
						when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')
					else 
						'' 
					end
				, 60
				),
		Mobilenumber =left(c1_b.mobile_pager, 10),
		ISDcode_Office ='',
		STDcode_Office =case 
							when len(STDcode_Office1)>0 then STDcode_Office1
							when len(STDcode_Office2)>0 then STDcode_Office2
						   else '' end,
		TelephoneNumber_Office=
			left(	case 
						when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')
						when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')
					else 
						'' 
					end
				, 60
				),
		DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,
		UIDNUMBER='',

	
		BankName1 =bank_name,
		BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end , 
		BankAccountNo1 =bank_account_no,
		BankAccountType1 =case 
							when bank_account_type = 'SAVING' then '10'
							when bank_account_type = 'CURRENT' then '11'
							when bank_account_type = 'OTHER' then '99' 
						  else ''
							end ,
		BankName2 ='',
		BankBranchAddress2 ='',
		BankAccountNo2 ='',
		BankAccountType2 ='',
		BankName3 ='',
		BankBranchAddress3 ='',
		BankAccountNo3 ='',
		BankAccountType3 ='',
		
		DepositoryName1 =dp_name,
		DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,
		BeneficialOwnerAccountNo1 =demat_id_of_client,
		
		DepositoryName2 ='',
		DepositoryID2 ='',
		BeneficialOwnerAccountNo2 ='',
		DepositoryName3 ='',
		DepositoryID3 ='',
		BeneficialOwnerAccountNo3 ='',
		CorporateIdentitynumber_CIN='',
		GrossAnnualIncomeRange ='',
		GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,
		NetWorth_InRs ='',
		NetWorthasonDate ='',
		PoliticallyExposedPerson_PEP='0', 
		PlaceofIncorporation ='',
		Occupation ='',
		OccupationDetails_Forothers='', 
		Dateofcommencementofbusiness ='',
		CustodialParticipantCodeoftheclient ='',
		RegistrationNoofClient ='',
		RegisteringAuthority ='',
		PlaceofRegistration ='',
		DateofRegistration ='',
		InpersonVerification ='Y',
		ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),
							/*Change on 26 Apr 2014: Changes for NSE SLB */
		UniqueClientCodeallottedbyNSCCL_BSE ='',
		UpdationFlag_for_SMS_and_Email_facility='', 
		Relationship ='',
		TypeofFacility_for_SMS_and_Email_facility ='',
		ProofType ='',
		ProofNumber ='',
		IssuePlaceofProof='', 
		IssueDateofProof ='',
		ClientStatus ='A',
		Remarks ='',
		ClientType_Corporate='', 
		NameofcontactPerson_1 ='',
		DesignationofContactPerson_1 ='',
		PANofcontactPerson_1 ='',
		AddressofcontactPerson_1 ='',
		ContactdetailsofcontactPerson_1 ='',
		DINofcontactPerson_1 ='',
		UIDofcontactPerson_1 ='',
		EmailIdofcontactPerson_1 ='',
		NameofcontactPerson_2  ='',
		DesignationofcontactPerson_2 ='',
		PANofcontactPerson_2 ='',
		AddressofcontactPerson_2 ='',
		ContactdetailsofcontactPerson_2='', 
		DINofcontactPerson_2 ='',
		UIDofcontactPerson_2 ='',
		EmailIdofcontactPerson_2 ='',
		NameofcontactPerson_3 ='',
		DesignationofcontactPerson_3='', 
		PANofcontactPerson_3 ='',
		AddressofcontactPerson_3 ='',
		ContactdetailsofcontactPerson_3='', 
		DINofcontactPerson_3 ='',
		UIDofcontactPerson_3 ='',
		EmailIdofcontactPerson_3 ='',
		NameofcontactPerson_4 ='',
		DesignationofcontactPerson_4='', 
		PANofcontactPerson_4 ='',
		AddressofcontactPerson_4 ='',
		ContactdetailsofcontactPerson_4 ='',
		DINofcontactPerson_4 ='',
		UIDofcontactPerson_4 ='',
		EmailIdofcontactPerson_4 ='',
		NameofcontactPerson_5 ='',
		DesignationofcontactPerson_5 ='',
		PANofcontactPerson_5 ='',
		AddressofcontactPerson_5 ='',
		ContactdetailsofcontactPerson_5='', 
		DINofcontactPerson_5 ='',
		UIDofcontactPerson_5 ='',
		EmailIdofcontactPerson_5 ='',
		NameofcontactPerson_6 ='',
		DesignationofcontactPerson_6='', 
		PANofcontactPerson_6 ='',
		AddressofcontactPerson_6 ='',
		ContactdetailsofcontactPerson_6='', 
		DINofcontactPerson_6 ='',
		UIDofcontactPerson_6 ='',
		EmailIdofcontactPerson_6 ='',
		NameofcontactPerson_7 ='',
		DesignationofcontactPerson_7='', 
		PANofcontactPerson_7 ='',
		AddressofcontactPerson_7 ='',
		ContactdetailsofcontactPerson_7='', 
		DINofcontactPerson_7 ='',
		UIDofcontactPerson_7 ='',
		EmailIdofcontactPerson_7 ='',
		NameofcontactPerson_8 ='',
		DesignationofcontactPerson_8 ='',
		PANofcontactPerson_8 ='',
		AddressofcontactPerson_8 ='',
		ContactdetailsofcontactPerson_8 ='',
		DINofcontactPerson_8 ='',
		UIDofcontactPerson_8 ='',
		EmailIdofcontactPerson_8 ='',
		NameofcontactPerson_9 ='',
		DesignationofcontactPerson_9='', 
		PANofcontactPerson_9 ='',
		AddressofcontactPerson_9 ='',
		ContactdetailsofcontactPerson_9='', 
		DINofcontactPerson_9 ='',
		UIDofcontactPerson_9 ='',
		EmailIdofcontactPerson_9 ='',
		NameofcontactPerson_10 ='',
		DesignationofcontactPerson_10='', 
		PANofcontactPerson_10 ='',
		AddressofcontactPerson_10 ='',
		ContactdetailsofcontactPerson_10='', 
		DINofcontactPerson_10 ='',
		UIDofcontactPerson_10 ='',
		EmailIdofcontactPerson_10 ='',
		NameofcontactPerson_11 ='',
		DesignationofcontactPerson_11='', 
		PANofcontactPerson_11 ='',
		AddressofcontactPerson_11 ='',
		ContactdetailsofcontactPerson_11='', 
		DINofcontactPerson_11 ='',
		UIDofcontactPerson_11 ='',
		EmailIdofcontactPerson_11 ='',
		NameofcontactPerson_12 ='',
		DesignationofcontactPerson_12='', 
		PANofcontactPerson_12 ='',
		AddressofcontactPerson_12 ='',
		ContactdetailsofcontactPerson_12='', 
		DINofcontactPerson_12 ='',
		UIDofcontactPerson_12 ='',
		EmailIdofcontactPerson_12 ='',
		NameofcontactPerson_13 ='',
		DesignationofcontactPerson_13 ='',
		PANofcontactPerson_13 ='',
		AddressofcontactPerson_13 ='',
		ContactdetailsofcontactPerson_13 ='',
		DINofcontactPerson_13 ='',
		UIDofcontactPerson_13 ='',
		EmailIdofcontactPerson_13 ='',
		NameofcontactPerson_14 ='',
		DesignationofcontactPerson_14 ='',
		PANofcontactPerson_14 ='',
		AddressofcontactPerson_14 ='',
		ContactdetailsofcontactPerson_14 ='',
		DINofcontactPerson_14 ='',
		UIDofcontactPerson_14 ='',
		EmailIdofcontactPerson_14 ='',
		NameofcontactPerson_15 ='',
		DesignationofcontactPerson_15 ='',
		PANofcontactPerson_15 ='',
		AddressofcontactPerson_15 ='',
		ContactdetailsofcontactPerson_15='', 
		DINofcontactPerson_15 ='',
		UIDofcontactPerson_15 ='',
		EmailIdofcontactPerson_15 ='',
		NameofcontactPerson_16 ='',
		DesignationofcontactPerson_16='', 
		PANofcontactPerson_16 ='',
		AddressofcontactPerson_16 ='',
		ContactdetailsofcontactPerson_16='', 
		DINofcontactPerson_16 ='',
		UIDofcontactPerson_16 ='',
		EmailIdofcontactPerson_16 ='',
		NameofcontactPerson_17 ='',
		DesignationofcontactPerson_17='', 
		PANofcontactPerson_17 ='',
		AddressofcontactPerson_17 ='',
		ContactdetailsofcontactPerson_17='', 
		DINofcontactPerson_17 ='',
		UIDofcontactPerson_17 ='',
		EmailIdofcontactPerson_17 ='',
		NameofcontactPerson_18 ='',
		DesignationofcontactPerson_18='', 
		PANofcontactPerson_18 ='',
		AddressofcontactPerson_18 ='',
		ContactdetailsofcontactPerson_18='', 
		DINofcontactPerson_18 ='',
		UIDofcontactPerson_18 ='',
		EmailIdofcontactPerson_18 ='',
		NameofcontactPerson_19 ='',
		DesignationofcontactPerson_19='', 
		PANofcontactPerson_19 ='',
		AddressofcontactPerson_19 ='',
		ContactdetailsofcontactPerson_19='', 
		DINofcontactPerson_19 ='',
		UIDofcontactPerson_19 ='',
		EmailIdofcontactPerson_19 ='',
		NameofcontactPerson_20 ='',
		DesignationofcontactPerson_20='', 
		PANofcontactPerson_20 ='',
		AddressofcontactPerson_20 ='',
		ContactdetailsofcontactPerson_20='', 
		DINofcontactPerson_20 ='',
		UIDofcontactPerson_20 ='',
		EmailIdofcontactPerson_20 ='',
		POAforFunds ='N',
	    POAforSecurities='N', 
		Flag='E'
	from
		(
			select
				c1.*,
				b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_Client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
		#temp_Client2 c2 with (nolock),
		#temp_Client5 c5 with (nolock)

	where
		ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and
		ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and
		ltrim(rtrim(left(c2.party_code,2))) <> '98'
		

	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),
	    --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/
	    --MASTERPAN=ISNULL(c1.MASTERPAN,''),
	    TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),
		--Gender=isnull(c1.Gender,''),
		Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=
					case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		GrossAnnualIncomeRange=case 
					when c1.Gross_Income ='01' then '1'
					when c1.Gross_Income ='02' then '2'
					when c1.Gross_Income ='03' then '3'
					when c1.Gross_Income ='04' then '4'
					when c1.Gross_Income ='05' then '5'
					when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/
					when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/
					else '' end, 
		NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''
						else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,
		PoliticallyExposedPerson_PEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end,
		OccupationDetails_Forothers=isnull(Occupation_Other,''),
		UIDNUMBER=isnull(c1.AADHAR_UID,'')
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0			
	
	update 
		#mimansa_angel_ucc_nse_slb_client_data_new_changes 
	set 
		GrossAnnualIncomeasonDate='',
		NetWorth_InRs='',
		NetWorthasonDate=''
	where len(GrossAnnualIncomeRange)=0 

	
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		#mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),
		ClientType_Corporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4	

	/****ADDRESS 1****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_1=c1.contact_name,
	DesignationofContactPerson_1=c1.designation,
	PANofcontactPerson_1=c1.PanNo,
	AddressofcontactPerson_1=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_1=c1.DIN,
	UIDofcontactPerson_1=c1.UID,
	EmailIdofcontactPerson_1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='1'

	/****ADDRESS 2****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_2=c1.contact_name,
	DesignationofContactPerson_2=c1.designation,
	PANofcontactPerson_2=c1.PanNo,
	AddressofcontactPerson_2=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_2=c1.DIN,
	UIDofcontactPerson_2=c1.UID,
	EmailIdofcontactPerson_2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='2'

	/****ADDRESS 3****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_3=c1.contact_name,
	DesignationofContactPerson_3=c1.designation,
	PANofcontactPerson_3=c1.PanNo,
	AddressofcontactPerson_3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_3=c1.DIN,
	UIDofcontactPerson_3=c1.UID,
	EmailIdofcontactPerson_3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='3'

	/****ADDRESS 4****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_4=c1.contact_name,
	DesignationofContactPerson_4=c1.designation,
	PANofcontactPerson_4=c1.PanNo,
	AddressofcontactPerson_4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_4=c1.DIN,
	UIDofcontactPerson_4=c1.UID,
	EmailIdofcontactPerson_4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_5=c1.contact_name,
	DesignationofContactPerson_5=c1.designation,
	PANofcontactPerson_5=c1.PanNo,
	AddressofcontactPerson_5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_5=c1.DIN,
	UIDofcontactPerson_5=c1.UID,
	EmailIdofcontactPerson_5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_6=c1.contact_name,
	DesignationofContactPerson_6=c1.designation,
	PANofcontactPerson_6=c1.PanNo,
	AddressofcontactPerson_6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_6=c1.DIN,
	UIDofcontactPerson_6=c1.UID,
	EmailIdofcontactPerson_6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_7=c1.contact_name,
	DesignationofContactPerson_7=c1.designation,
	PANofcontactPerson_7=c1.PanNo,
	AddressofcontactPerson_7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_7=c1.DIN,
	UIDofcontactPerson_7=c1.UID,
	EmailIdofcontactPerson_7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_8=c1.contact_name,
	DesignationofContactPerson_8=c1.designation,
	PANofcontactPerson_8=c1.PanNo,
	AddressofcontactPerson_8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_8=c1.DIN,
	UIDofcontactPerson_8=c1.UID,
	EmailIdofcontactPerson_8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_9=c1.contact_name,
	DesignationofContactPerson_9=c1.designation,
	PANofcontactPerson_9=c1.PanNo,
	AddressofcontactPerson_9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_9=c1.DIN,
	UIDofcontactPerson_9=c1.UID,
	EmailIdofcontactPerson_9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_10=c1.contact_name,
	DesignationofContactPerson_10=c1.designation,
	PANofcontactPerson_10=c1.PanNo,
	AddressofcontactPerson_10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_10=c1.DIN,
	UIDofcontactPerson_10=c1.UID,
	EmailIdofcontactPerson_10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='10'



		/*Update POA*/
		--Update 
		--    #mimansa_angel_ucc_nse_slb_client_data_new_changes
		--  set 		  
	 --     POAforSecurities=
		--  case 
		--		when ltrim(rtrim(Def))=1 then 'Y'  
		--		when ltrim(rtrim(Def))=0 then 'N' 				
		--		else  '' 
		--	end
		--  from
		--   anand1.msajag.dbo.Multicltid m with(nolock)
	 --     where
		--Client_Code = m.Party_code

	
	/*INVALID PAN*/

	

	select distinct
		client_code = ltrim(rtrim(client_code)),
		client_name = ltrim(rtrim(client_name)),
		pan = ltrim(rtrim(pan))
		--pan,
		--pan_err = 
		--	case 
		--		when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'
		--		then 'NO PAN'
		--		when len(ltrim(rtrim(isnull(pan, '')))) = 0
		--		then 'NO PAN'
		--		when not (
		--			isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and
		--			isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and
		--			isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and
		--			len(ltrim(rtrim(isnull(pan, '')))) = 10
		--		)
		--		then 'INVALID PAN'
		--	end,

		--pan_length = len(ltrim(rtrim(isnull(pan, '')))),
		--telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),
		--client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))
into #invalidpan
	from
		--mimansa_angel_ucc_nse_fo_client_data with(nolock)
		mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
	where
		ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'

	

	
delete
	#mimansa_angel_ucc_nse_slb_client_data_new_changes
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp 
where
	ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10

/***************FINAL DISPLAY*******************/
select distinct
		Segment, 
		Client_Code=ltrim(RTRIM(Client_Code)), 
		Client_Name ,
		Category ,
		PAN ,
		Gender, 
		Fathers_Husbands_GuardiansName ,
		Maritalstatus ,
		Nationality ,
		Nationality_Other, 
		ClientEmailId ,
		CorrespondenceClientAddressline1 ,
		CorrespondenceClientAddressline2 ,
		CorrespondenceClientAddressline3 ,
		CorrespondenceClientAddress_City ,
		CorrespondenceClientAddress_State ,
		CorrespondenceClientAddress_State_Others, 
		CorrespondenceClientAddress_Country ,
		CorrespondenceClientAddress_Pincode ,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,
		PermanentClientAddressline1 ,
		PermanentClientAddressline2 ,
		PermanentClientAddressline3 ,
		PermanentClientAddress_City ,
		PermanentClientAddress_State ,
		PermanentClientAddress_StateOthers  ,
		PermanentClientAddress_Country ,
		PermanentClientAddress_Pincode ,
		ISDcode_Residence ,
		STDcode_Residence ,
		TelephoneNumber_Residence ,
		Mobilenumber ,
		ISDcode_Office, 
		STDcode_Office ,
		TelephoneNumber_Office ,
		DateofBirth_Incorporation ,
		UIDNUMBER ,
		BankName1 ,
		BankBranchAddress1 ,
		BankAccountNo1 ,
		BankAccountType1 ,
		BankName2 ,
		BankBranchAddress2 ,
		BankAccountNo2 ,
		BankAccountType2 ,
		BankName3 ,
		BankBranchAddress3 ,
		BankAccountNo3 ,
		BankAccountType3, 
		DepositoryName1 ,
		DepositoryID1 ,
		BeneficialOwnerAccountNo1 ,
		DepositoryName2 ,
		DepositoryID2 ,
		BeneficialOwnerAccountNo2 ,
		DepositoryName3 ,
		DepositoryID3 ,
		BeneficialOwnerAccountNo3 ,
		CorporateIdentitynumber_CIN, 
		GrossAnnualIncomeRange ,
		GrossAnnualIncomeasonDate, 
		NetWorth_InRs ,
		NetWorthasonDate, 
		PoliticallyExposedPerson_PEP ,
		PlaceofIncorporation ,
		Occupation ,
		OccupationDetails_Forothers ,
		Dateofcommencementofbusiness ,
		CustodialParticipantCodeoftheclient ,
		RegistrationNoofClient ,
		RegisteringAuthority ,
		PlaceofRegistration ,
		DateofRegistration ,
		InpersonVerification, 
		ClientAgreementDate ,
		UniqueClientCodeallottedbyNSCCL_BSE ,
		UpdationFlag_for_SMS_and_Email_facility ,
		Relationship ,
		TypeofFacility_for_SMS_and_Email_facility ,
		ProofType ,
		ProofNumber ,
		IssuePlaceofProof ,
		IssueDateofProof ,
		ClientStatus ,
		Remarks ,
		ClientType_Corporate, 
		NameofcontactPerson_1 ,
		DesignationofContactPerson_1 ,
		PANofcontactPerson_1 ,
		AddressofcontactPerson_1 ,
		ContactdetailsofcontactPerson_1 ,
		DINofcontactPerson_1 ,
		UIDofcontactPerson_1 ,
		EmailIdofcontactPerson_1 ,
		NameofcontactPerson_2  ,
		DesignationofcontactPerson_2 ,
		PANofcontactPerson_2 ,
		AddressofcontactPerson_2 ,
		ContactdetailsofcontactPerson_2, 
		DINofcontactPerson_2 ,
		UIDofcontactPerson_2 ,
		EmailIdofcontactPerson_2 ,
		NameofcontactPerson_3 ,
		DesignationofcontactPerson_3, 
		PANofcontactPerson_3 ,
		AddressofcontactPerson_3 ,
		ContactdetailsofcontactPerson_3, 
		DINofcontactPerson_3 ,
		UIDofcontactPerson_3 ,
		EmailIdofcontactPerson_3 ,
		NameofcontactPerson_4 ,
		DesignationofcontactPerson_4, 
		PANofcontactPerson_4 ,
		AddressofcontactPerson_4 ,
		ContactdetailsofcontactPerson_4 ,
		DINofcontactPerson_4 ,
		UIDofcontactPerson_4 ,
		EmailIdofcontactPerson_4 ,
		NameofcontactPerson_5 ,
		DesignationofcontactPerson_5 ,
		PANofcontactPerson_5 ,
		AddressofcontactPerson_5 ,
		ContactdetailsofcontactPerson_5, 
		DINofcontactPerson_5 ,
		UIDofcontactPerson_5 ,
		EmailIdofcontactPerson_5 ,
		NameofcontactPerson_6 ,
		DesignationofcontactPerson_6, 
		PANofcontactPerson_6 ,
		AddressofcontactPerson_6 ,
		ContactdetailsofcontactPerson_6, 
		DINofcontactPerson_6 ,
		UIDofcontactPerson_6 ,
		EmailIdofcontactPerson_6 ,
		NameofcontactPerson_7 ,
		DesignationofcontactPerson_7, 
		PANofcontactPerson_7 ,
		AddressofcontactPerson_7 ,
		ContactdetailsofcontactPerson_7, 
		DINofcontactPerson_7 ,
		UIDofcontactPerson_7 ,
		EmailIdofcontactPerson_7 ,
		NameofcontactPerson_8 ,
		DesignationofcontactPerson_8 ,
		PANofcontactPerson_8 ,
		AddressofcontactPerson_8 ,
		ContactdetailsofcontactPerson_8 ,
		DINofcontactPerson_8 ,
		UIDofcontactPerson_8 ,
		EmailIdofcontactPerson_8 ,
		NameofcontactPerson_9 ,
		DesignationofcontactPerson_9, 
		PANofcontactPerson_9 ,
		AddressofcontactPerson_9 ,
		ContactdetailsofcontactPerson_9, 
		DINofcontactPerson_9 ,
		UIDofcontactPerson_9 ,
		EmailIdofcontactPerson_9 ,
		NameofcontactPerson_10 ,
		DesignationofcontactPerson_10, 
		PANofcontactPerson_10 ,
		AddressofcontactPerson_10 ,
		ContactdetailsofcontactPerson_10, 
		DINofcontactPerson_10 ,
		UIDofcontactPerson_10 ,
		EmailIdofcontactPerson_10 ,
		NameofcontactPerson_11 ,
		DesignationofcontactPerson_11, 
		PANofcontactPerson_11 ,
		AddressofcontactPerson_11 ,
		ContactdetailsofcontactPerson_11, 
		DINofcontactPerson_11 ,
		UIDofcontactPerson_11 ,
		EmailIdofcontactPerson_11 ,
		NameofcontactPerson_12 ,
		DesignationofcontactPerson_12, 
		PANofcontactPerson_12 ,
		AddressofcontactPerson_12 ,
		ContactdetailsofcontactPerson_12, 
		DINofcontactPerson_12 ,
		UIDofcontactPerson_12 ,
		EmailIdofcontactPerson_12 ,
		NameofcontactPerson_13 ,
		DesignationofcontactPerson_13 ,
		PANofcontactPerson_13 ,
		AddressofcontactPerson_13 ,
		ContactdetailsofcontactPerson_13 ,
		DINofcontactPerson_13 ,
		UIDofcontactPerson_13 ,
		EmailIdofcontactPerson_13 ,
		NameofcontactPerson_14 ,
		DesignationofcontactPerson_14 ,
		PANofcontactPerson_14 ,
		AddressofcontactPerson_14 ,
		ContactdetailsofcontactPerson_14 ,
		DINofcontactPerson_14 ,
		UIDofcontactPerson_14 ,
		EmailIdofcontactPerson_14 ,
		NameofcontactPerson_15 ,
		DesignationofcontactPerson_15 ,
		PANofcontactPerson_15 ,
		AddressofcontactPerson_15 ,
		ContactdetailsofcontactPerson_15, 
		DINofcontactPerson_15 ,
		UIDofcontactPerson_15 ,
		EmailIdofcontactPerson_15 ,
		NameofcontactPerson_16 ,
		DesignationofcontactPerson_16, 
		PANofcontactPerson_16 ,
		AddressofcontactPerson_16 ,
		ContactdetailsofcontactPerson_16, 
		DINofcontactPerson_16 ,
		UIDofcontactPerson_16 ,
		EmailIdofcontactPerson_16 ,
		NameofcontactPerson_17 ,
		DesignationofcontactPerson_17, 
		PANofcontactPerson_17 ,
		AddressofcontactPerson_17 ,
		ContactdetailsofcontactPerson_17, 
		DINofcontactPerson_17 ,
		UIDofcontactPerson_17 ,
		EmailIdofcontactPerson_17 ,
		NameofcontactPerson_18 ,
		DesignationofcontactPerson_18, 
		PANofcontactPerson_18 ,
		AddressofcontactPerson_18 ,
		ContactdetailsofcontactPerson_18, 
		DINofcontactPerson_18 ,
		UIDofcontactPerson_18 ,
		EmailIdofcontactPerson_18 ,
		NameofcontactPerson_19 ,
		DesignationofcontactPerson_19, 
		PANofcontactPerson_19 ,
		AddressofcontactPerson_19 ,
		ContactdetailsofcontactPerson_19, 
		DINofcontactPerson_19 ,
		UIDofcontactPerson_19 ,
		EmailIdofcontactPerson_19 ,
		NameofcontactPerson_20 ,
		DesignationofcontactPerson_20, 
		PANofcontactPerson_20 ,
		AddressofcontactPerson_20 ,
		ContactdetailsofcontactPerson_20, 
		DINofcontactPerson_20 ,
		UIDofcontactPerson_20 ,
		EmailIdofcontactPerson_20 ,
		POAforFunds ='N',
	    POAforSecurities='N', 
		Flag='E'
from
	#mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
 
where
	len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'





	/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)	
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'

/*Insert Log*/
if exists(select * from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))
begin
	if(@totalrecord>0)
	begin
		update [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count 
		set file_number=file_number+1
		where time_stamp>=cast(left(getdate(),11) as datetime)
	end
end
else
begin
	if(@totalrecord>0)
	begin
		insert into [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)
		select 1,getdate()
	end
end
	
/*Display File Name and First Row
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)
				Ex- uci_20140225.t04
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count 
				Ex- 10|M|12798|27022014|04|220
*/

select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')
				+'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),					
	   FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'
				+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'
				+cast(@totalrecord  as varchar) 
from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)


/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_Bak13Feb2015
-- --------------------------------------------------
CREATE proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN]
	(
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
	)
as
--[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN] @from_date='May 13 2014',@to_date='May 13 2014',@ClientCode='',@processid=''
	/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate
		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

	/*******************FETCH DATA**************************/

	--truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes
	

CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(
	[Segment] [varchar](1) NULL,
	[Client_Code] [varchar](10) NULL,
	[Client_Name] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[Fathers_Husbands_GuardiansName] [varchar](150) NULL,
	[Maritalstatus] [varchar](2) NULL,
	[Nationality] [varchar](2) NULL,
	[Nationality_Other] [varchar](50) NULL,
	[ClientEmailId] [varchar](60) NULL,
	[CorrespondenceClientAddressline1] [varchar](255) NULL,
	[CorrespondenceClientAddressline2] [varchar](255) NULL,
	[CorrespondenceClientAddressline3] [varchar](255) NULL,
	[CorrespondenceClientAddress_City] [varchar](50) NULL,
	[CorrespondenceClientAddress_State] [varchar](2) NULL,
	[CorrespondenceClientAddress_State_Others] [varchar](75) NULL,
	[CorrespondenceClientAddress_Country] [varchar](3) NULL,
	[CorrespondenceClientAddress_Pincode] [varchar](10) NULL,
	[FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,
	[PermanentClientAddressline1] [varchar](255) NULL,
	[PermanentClientAddressline2] [varchar](255) NULL,
	[PermanentClientAddressline3] [varchar](255) NULL,
	[PermanentClientAddress_City] [varchar](50) NULL,
	[PermanentClientAddress_State] [varchar](2) NULL,
	[PermanentClientAddress_StateOthers] [varchar](75) NULL,
	[PermanentClientAddress_Country] [varchar](2) NULL,
	[PermanentClientAddress_Pincode] [varchar](10) NULL,
	[ISDcode_Residence] [varchar](10) NULL,
	[STDcode_Residence] [varchar](10) NULL,
	[TelephoneNumber_Residence] [varchar](60) NULL,
	[Mobilenumber] [varchar](20) NULL,
	[ISDcode_Office] [varchar](10) NULL,
	[STDcode_Office] [varchar](10) NULL,
	[TelephoneNumber_Office] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](60) NULL,
	[UIDNUMBER] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNo1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNo2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNo3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](4) NULL,
	[DepositoryID1] [varchar](8) NULL,
	[BeneficialOwnerAccountNo1] [varchar](16) NULL,
	[DepositoryName2] [varchar](4) NULL,
	[DepositoryID2] [varchar](8) NULL,
	[BeneficialOwnerAccountNo2] [varchar](16) NULL,
	[DepositoryName3] [varchar](4) NULL,
	[DepositoryID3] [varchar](8) NULL,
	[BeneficialOwnerAccountNo3] [varchar](16) NULL,
	[CorporateIdentitynumber_CIN] [varchar](21) NULL,
	[GrossAnnualIncomeRange] [varchar](40) NULL,
	[GrossAnnualIncomeasonDate] [varchar](40) NULL,
	[NetWorth_InRs] [varchar](40) NULL,
	[NetWorthasonDate] [varchar](40) NULL,
	[PoliticallyExposedPerson_PEP] [varchar](2) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetails_Forothers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](40) NULL,
	[CustodialParticipantCodeoftheclient] [varchar](15) NULL,
	[RegistrationNoofClient] [varchar](25) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](40) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](40) NULL,
	[UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,
	[UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,
	[Relationship] [varchar](1) NULL,
	[TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,
	[ProofType] [varchar](1) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](40) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientType_Corporate] [varchar](200) NULL,
	[NameofcontactPerson_1] [varchar](200) NULL,
	[DesignationofContactPerson_1] [varchar](200) NULL,
	[PANofcontactPerson_1] [varchar](200) NULL,
	[AddressofcontactPerson_1] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_1] [varchar](200) NULL,
	[DINofcontactPerson_1] [varchar](200) NULL,
	[UIDofcontactPerson_1] [varchar](200) NULL,
	[EmailIdofcontactPerson_1] [varchar](200) NULL,
	[NameofcontactPerson_2] [varchar](200) NULL,
	[DesignationofcontactPerson_2] [varchar](200) NULL,
	[PANofcontactPerson_2] [varchar](200) NULL,
	[AddressofcontactPerson_2] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_2] [varchar](200) NULL,
	[DINofcontactPerson_2] [varchar](200) NULL,
	[UIDofcontactPerson_2] [varchar](200) NULL,
	[EmailIdofcontactPerson_2] [varchar](200) NULL,
	[NameofcontactPerson_3] [varchar](200) NULL,
	[DesignationofcontactPerson_3] [varchar](200) NULL,
	[PANofcontactPerson_3] [varchar](200) NULL,
	[AddressofcontactPerson_3] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_3] [varchar](200) NULL,
	[DINofcontactPerson_3] [varchar](200) NULL,
	[UIDofcontactPerson_3] [varchar](200) NULL,
	[EmailIdofcontactPerson_3] [varchar](200) NULL,
	[NameofcontactPerson_4] [varchar](200) NULL,
	[DesignationofcontactPerson_4] [varchar](200) NULL,
	[PANofcontactPerson_4] [varchar](200) NULL,
	[AddressofcontactPerson_4] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_4] [varchar](200) NULL,
	[DINofcontactPerson_4] [varchar](200) NULL,
	[UIDofcontactPerson_4] [varchar](200) NULL,
	[EmailIdofcontactPerson_4] [varchar](200) NULL,
	[NameofcontactPerson_5] [varchar](200) NULL,
	[DesignationofcontactPerson_5] [varchar](200) NULL,
	[PANofcontactPerson_5] [varchar](200) NULL,
	[AddressofcontactPerson_5] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_5] [varchar](200) NULL,
	[DINofcontactPerson_5] [varchar](200) NULL,
	[UIDofcontactPerson_5] [varchar](200) NULL,
	[EmailIdofcontactPerson_5] [varchar](200) NULL,
	[NameofcontactPerson_6] [varchar](200) NULL,
	[DesignationofcontactPerson_6] [varchar](200) NULL,
	[PANofcontactPerson_6] [varchar](200) NULL,
	[AddressofcontactPerson_6] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_6] [varchar](200) NULL,
	[DINofcontactPerson_6] [varchar](200) NULL,
	[UIDofcontactPerson_6] [varchar](200) NULL,
	[EmailIdofcontactPerson_6] [varchar](200) NULL,
	[NameofcontactPerson_7] [varchar](200) NULL,
	[DesignationofcontactPerson_7] [varchar](200) NULL,
	[PANofcontactPerson_7] [varchar](200) NULL,
	[AddressofcontactPerson_7] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_7] [varchar](200) NULL,
	[DINofcontactPerson_7] [varchar](200) NULL,
	[UIDofcontactPerson_7] [varchar](200) NULL,
	[EmailIdofcontactPerson_7] [varchar](200) NULL,
	[NameofcontactPerson_8] [varchar](200) NULL,
	[DesignationofcontactPerson_8] [varchar](200) NULL,
	[PANofcontactPerson_8] [varchar](200) NULL,
	[AddressofcontactPerson_8] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_8] [varchar](200) NULL,
	[DINofcontactPerson_8] [varchar](200) NULL,
	[UIDofcontactPerson_8] [varchar](200) NULL,
	[EmailIdofcontactPerson_8] [varchar](200) NULL,
	[NameofcontactPerson_9] [varchar](200) NULL,
	[DesignationofcontactPerson_9] [varchar](200) NULL,
	[PANofcontactPerson_9] [varchar](200) NULL,
	[AddressofcontactPerson_9] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_9] [varchar](200) NULL,
	[DINofcontactPerson_9] [varchar](200) NULL,
	[UIDofcontactPerson_9] [varchar](200) NULL,
	[EmailIdofcontactPerson_9] [varchar](200) NULL,
	[NameofcontactPerson_10] [varchar](200) NULL,
	[DesignationofcontactPerson_10] [varchar](200) NULL,
	[PANofcontactPerson_10] [varchar](200) NULL,
	[AddressofcontactPerson_10] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_10] [varchar](200) NULL,
	[DINofcontactPerson_10] [varchar](200) NULL,
	[UIDofcontactPerson_10] [varchar](200) NULL,
	[EmailIdofcontactPerson_10] [varchar](200) NULL,
	[NameofcontactPerson_11] [varchar](200) NULL,
	[DesignationofcontactPerson_11] [varchar](200) NULL,
	[PANofcontactPerson_11] [varchar](200) NULL,
	[AddressofcontactPerson_11] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_11] [varchar](200) NULL,
	[DINofcontactPerson_11] [varchar](200) NULL,
	[UIDofcontactPerson_11] [varchar](200) NULL,
	[EmailIdofcontactPerson_11] [varchar](200) NULL,
	[NameofcontactPerson_12] [varchar](200) NULL,
	[DesignationofcontactPerson_12] [varchar](200) NULL,
	[PANofcontactPerson_12] [varchar](200) NULL,
	[AddressofcontactPerson_12] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_12] [varchar](200) NULL,
	[DINofcontactPerson_12] [varchar](200) NULL,
	[UIDofcontactPerson_12] [varchar](200) NULL,
	[EmailIdofcontactPerson_12] [varchar](200) NULL,
	[NameofcontactPerson_13] [varchar](200) NULL,
	[DesignationofcontactPerson_13] [varchar](200) NULL,
	[PANofcontactPerson_13] [varchar](200) NULL,
	[AddressofcontactPerson_13] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_13] [varchar](200) NULL,
	[DINofcontactPerson_13] [varchar](200) NULL,
	[UIDofcontactPerson_13] [varchar](200) NULL,
	[EmailIdofcontactPerson_13] [varchar](200) NULL,
	[NameofcontactPerson_14] [varchar](200) NULL,
	[DesignationofcontactPerson_14] [varchar](200) NULL,
	[PANofcontactPerson_14] [varchar](200) NULL,
	[AddressofcontactPerson_14] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_14] [varchar](200) NULL,
	[DINofcontactPerson_14] [varchar](200) NULL,
	[UIDofcontactPerson_14] [varchar](200) NULL,
	[EmailIdofcontactPerson_14] [varchar](200) NULL,
	[NameofcontactPerson_15] [varchar](200) NULL,
	[DesignationofcontactPerson_15] [varchar](200) NULL,
	[PANofcontactPerson_15] [varchar](200) NULL,
	[AddressofcontactPerson_15] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_15] [varchar](200) NULL,
	[DINofcontactPerson_15] [varchar](200) NULL,
	[UIDofcontactPerson_15] [varchar](200) NULL,
	[EmailIdofcontactPerson_15] [varchar](200) NULL,
	[NameofcontactPerson_16] [varchar](200) NULL,
	[DesignationofcontactPerson_16] [varchar](200) NULL,
	[PANofcontactPerson_16] [varchar](200) NULL,
	[AddressofcontactPerson_16] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_16] [varchar](200) NULL,
	[DINofcontactPerson_16] [varchar](200) NULL,
	[UIDofcontactPerson_16] [varchar](200) NULL,
	[EmailIdofcontactPerson_16] [varchar](200) NULL,
	[NameofcontactPerson_17] [varchar](200) NULL,
	[DesignationofcontactPerson_17] [varchar](200) NULL,
	[PANofcontactPerson_17] [varchar](200) NULL,
	[AddressofcontactPerson_17] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_17] [varchar](200) NULL,
	[DINofcontactPerson_17] [varchar](200) NULL,
	[UIDofcontactPerson_17] [varchar](200) NULL,
	[EmailIdofcontactPerson_17] [varchar](200) NULL,
	[NameofcontactPerson_18] [varchar](200) NULL,
	[DesignationofcontactPerson_18] [varchar](200) NULL,
	[PANofcontactPerson_18] [varchar](200) NULL,
	[AddressofcontactPerson_18] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_18] [varchar](200) NULL,
	[DINofcontactPerson_18] [varchar](200) NULL,
	[UIDofcontactPerson_18] [varchar](200) NULL,
	[EmailIdofcontactPerson_18] [varchar](200) NULL,
	[NameofcontactPerson_19] [varchar](200) NULL,
	[DesignationofcontactPerson_19] [varchar](200) NULL,
	[PANofcontactPerson_19] [varchar](200) NULL,
	[AddressofcontactPerson_19] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_19] [varchar](200) NULL,
	[DINofcontactPerson_19] [varchar](200) NULL,
	[UIDofcontactPerson_19] [varchar](200) NULL,
	[EmailIdofcontactPerson_19] [varchar](200) NULL,
	[NameofcontactPerson_20] [varchar](200) NULL,
	[DesignationofcontactPerson_20] [varchar](200) NULL,
	[PANofcontactPerson_20] [varchar](200) NULL,
	[AddressofcontactPerson_20] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_20] [varchar](200) NULL,
	[DINofcontactPerson_20] [varchar](200) NULL,
	[UIDofcontactPerson_20] [varchar](200) NULL,
	[EmailIdofcontactPerson_20] [varchar](200) NULL,
	[Flag] [varchar](1) NULL
)
	
	--insert into 
	--	angel_ucc_nse_fo_client1
	select
		party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=cast('' as varchar(255)),
		P_address2=cast('' as varchar(255)),
		P_address3=cast('' as varchar(255)),
		P_City=cast('' as varchar(50)),
		P_State=cast('' as varchar(100)),
		P_State_For_Other=cast('' as varchar(100)),
		P_nation=cast('' as varchar(100)),
		P_zip=cast('' as varchar(10)),
		P_Len=cast('' as varchar(1)),	
		Gender=cast('' as varchar(1)),
		STDcode_Residence1=cast('' as varchar(10)),
		STDcode_Residence2=cast('' as varchar(10)),
		STDcode_Office1=cast('' as varchar(10)),
		STDcode_Office2=cast('' as varchar(10))
	into 
		#temp_client1	
	from 
		NSESLBS.dbo.client1 c1 with(nolock),
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c1.cl_code = c2.cl_code and 
		c2.party_code = t.party_code 

	update #temp_client1 set 
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,'')
	from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)
	where t1.Cl_Code=c1.cl_code

	update 
		#temp_Client1 
	set 
	L_State= dbo.fn_state_countary_value(l_state,'STATE'),
	P_State=dbo.fn_state_countary_value(P_state,'STATE'),
	L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),
	P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),
	cl_status=case
				/*INDIVIDUAL/PROPRIETORSHIP FIRMS*/
				when cl_status = 'IND' then '1'		/*INDIVIDUAL*/

				/*PARTNERSHIP FIRM*/
				when cl_status = 'PF' or cl_status='LLP' then '2'		/*PARTNERSHIP FIRMS*/

				/*HUF*/
				when cl_status = 'HUF' then '3'		/*HINDU UNDIVIDED FAMILY*/

				/*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/
				when cl_status = 'PPB' then '4'		/*PUB. PVT COMP/BODIES CORP*/
				when cl_status = 'BCP' then '4'		/*BODY CORPORATE*/

				/*TRUST / SOCIETY*/
				when cl_status = 'TS' then '5'		/*TRUST / SOCIETY*/

				/*MUTUAL FUND*/
				when cl_status = 'MF' then '6'		/*MUTUAL FUNDS*/
				when cl_status = 'MFF' then '6'		/*MUTUAL FUND (MF)*/

				/*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/
				when cl_status = 'IFI' then '7'		/*INDIAN FINANCIAL INSTI*/
				when cl_status = 'DFI' then '7'		/*DOMESTIC FIN. INST.*/

				/*BANK*/
				when cl_status = 'BA' then ' 8'		/*BANKS*/
				when cl_status = 'BNK' then '8'		/*BANK*/

				/*INSURANCE*/
				when cl_status = 'IC' then ' 9'		/*INSURANCE COMPANIES*/

				/*STATUTORY BODIES*/
				when cl_status = 'SB' then ' 10'		/*STATUTORY BODIES*/

				/*NRI*/
				when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'		/*NON RESIDENT INDIAN*/

				/*FII*/
				when cl_status = 'FII' then '12'		/*FOREIGN INSTIT INVESTORS*/

				/*OCB*/
				when cl_status = 'OCB' then '13'		/*OVERSEAS CORPORATE BODIES*/

				/*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/
				when cl_status = 'DFN' then '14'		/*DIRECT FOREIGN INVESTMENTS*/

				when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/
				
				/*FVC*/
				when cl_status = 'FVC' then '20'		/*FOREIGN VENTURE CAPITAL FUNDS*/
			else
				'1'		/*INDIVIDUAL*/
			end

	
	select 
		Cl_Code, Party_code=c2.Party_code
	into #temp_client2	
	from 
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c2.party_code = t.party_code
	
	select 
		party_code = ltrim(rtrim(t.party_code)),
		--c5.*
		cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),
		--BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),
		--ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */
		ActiveFrom=c5.ActiveFrom,
		InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),
		GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))
	into #temp_Client5	
	from 
		NSESLBS.dbo.client5 c5 with(nolock),
		#temp_Client2 t with (nolock)
	where 
		c5.cl_code = t.cl_code

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.pobank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.bank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('CDSL', 'NSDL') and
		isnull(c4.defdp, '') = '1'

	--insert into
	--	angel_ucc_nse_fo_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank	
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))


	/*******************END - FETCH DATA**************************/

	insert into
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
		(
			Segment	,
			Client_Code	,
			Client_Name	,
			Category	,
			PAN	,
			Gender	,
			Fathers_Husbands_GuardiansName	,
			Maritalstatus	,
			Nationality	,
			Nationality_Other	,
			ClientEmailId	,
			CorrespondenceClientAddressline1	,
			CorrespondenceClientAddressline2	,
			CorrespondenceClientAddressline3	,
			CorrespondenceClientAddress_City	,
			CorrespondenceClientAddress_State	,
			CorrespondenceClientAddress_State_Others	,
			CorrespondenceClientAddress_Country	,
			CorrespondenceClientAddress_Pincode	,
			FlagIndicatingifCorrespondenceAddressissameasPermanentAddress	,
			PermanentClientAddressline1	,
			PermanentClientAddressline2	,
			PermanentClientAddressline3	,
			PermanentClientAddress_City	,
			PermanentClientAddress_State	,
			PermanentClientAddress_StateOthers	,
			PermanentClientAddress_Country	,
			PermanentClientAddress_Pincode	,
			ISDcode_Residence	,
			STDcode_Residence	,
			TelephoneNumber_Residence	,
			Mobilenumber	,
			ISDcode_Office	,
			STDcode_Office	,
			TelephoneNumber_Office	,
			DateofBirth_Incorporation	,
			UIDNUMBER	,
			BankName1	,
			BankBranchAddress1	,
			BankAccountNo1	,
			BankAccountType1	,
			BankName2	,
			BankBranchAddress2	,
			BankAccountNo2	,
			BankAccountType2	,
			BankName3	,
			BankBranchAddress3	,
			BankAccountNo3	,
			BankAccountType3	,
			DepositoryName1	,
			DepositoryID1	,
			BeneficialOwnerAccountNo1	,
			DepositoryName2	,
			DepositoryID2	,
			BeneficialOwnerAccountNo2	,
			DepositoryName3	,
			DepositoryID3	,
			BeneficialOwnerAccountNo3	,
			CorporateIdentitynumber_CIN	,
			GrossAnnualIncomeRange	,
			GrossAnnualIncomeasonDate	,
			NetWorth_InRs	,
			NetWorthasonDate	,
			PoliticallyExposedPerson_PEP	,
			PlaceofIncorporation	,
			Occupation	,
			OccupationDetails_Forothers	,
			Dateofcommencementofbusiness	,
			CustodialParticipantCodeoftheclient	,
			RegistrationNoofClient	,
			RegisteringAuthority	,
			PlaceofRegistration	,
			DateofRegistration	,
			InpersonVerification	,
			ClientAgreementDate	,
			UniqueClientCodeallottedbyNSCCL_BSE	,
			UpdationFlag_for_SMS_and_Email_facility	,
			Relationship	,
			TypeofFacility_for_SMS_and_Email_facility	,
			ProofType	,
			ProofNumber	,
			IssuePlaceofProof	,
			IssueDateofProof	,
			ClientStatus	,
			Remarks	,
			ClientType_Corporate	,
			NameofcontactPerson_1	,
			DesignationofContactPerson_1	,
			PANofcontactPerson_1	,
			AddressofcontactPerson_1	,
			ContactdetailsofcontactPerson_1	,
			DINofcontactPerson_1	,
			UIDofcontactPerson_1	,
			EmailIdofcontactPerson_1	,
			NameofcontactPerson_2	,
			DesignationofcontactPerson_2	,
			PANofcontactPerson_2	,
			AddressofcontactPerson_2	,
			ContactdetailsofcontactPerson_2	,
			DINofcontactPerson_2	,
			UIDofcontactPerson_2	,
			EmailIdofcontactPerson_2	,
			NameofcontactPerson_3	,
			DesignationofcontactPerson_3	,
			PANofcontactPerson_3	,
			AddressofcontactPerson_3	,
			ContactdetailsofcontactPerson_3	,
			DINofcontactPerson_3	,
			UIDofcontactPerson_3	,
			EmailIdofcontactPerson_3	,
			NameofcontactPerson_4	,
			DesignationofcontactPerson_4	,
			PANofcontactPerson_4	,
			AddressofcontactPerson_4	,
			ContactdetailsofcontactPerson_4	,
			DINofcontactPerson_4	,
			UIDofcontactPerson_4	,
			EmailIdofcontactPerson_4	,
			NameofcontactPerson_5	,
			DesignationofcontactPerson_5	,
			PANofcontactPerson_5	,
			AddressofcontactPerson_5	,
			ContactdetailsofcontactPerson_5	,
			DINofcontactPerson_5	,
			UIDofcontactPerson_5	,
			EmailIdofcontactPerson_5	,
			NameofcontactPerson_6	,
			DesignationofcontactPerson_6	,
			PANofcontactPerson_6	,
			AddressofcontactPerson_6	,
			ContactdetailsofcontactPerson_6	,
			DINofcontactPerson_6	,
			UIDofcontactPerson_6	,
			EmailIdofcontactPerson_6	,
			NameofcontactPerson_7	,
			DesignationofcontactPerson_7	,
			PANofcontactPerson_7	,
			AddressofcontactPerson_7	,
			ContactdetailsofcontactPerson_7	,
			DINofcontactPerson_7	,
			UIDofcontactPerson_7	,
			EmailIdofcontactPerson_7	,
			NameofcontactPerson_8	,
			DesignationofcontactPerson_8	,
			PANofcontactPerson_8	,
			AddressofcontactPerson_8	,
			ContactdetailsofcontactPerson_8	,
			DINofcontactPerson_8	,
			UIDofcontactPerson_8	,
			EmailIdofcontactPerson_8	,
			NameofcontactPerson_9	,
			DesignationofcontactPerson_9	,
			PANofcontactPerson_9	,
			AddressofcontactPerson_9	,
			ContactdetailsofcontactPerson_9	,
			DINofcontactPerson_9	,
			UIDofcontactPerson_9	,
			EmailIdofcontactPerson_9	,
			NameofcontactPerson_10	,
			DesignationofcontactPerson_10	,
			PANofcontactPerson_10	,
			AddressofcontactPerson_10	,
			ContactdetailsofcontactPerson_10	,
			DINofcontactPerson_10	,
			UIDofcontactPerson_10	,
			EmailIdofcontactPerson_10	,
			NameofcontactPerson_11	,
			DesignationofcontactPerson_11	,
			PANofcontactPerson_11	,
			AddressofcontactPerson_11	,
			ContactdetailsofcontactPerson_11	,
			DINofcontactPerson_11	,
			UIDofcontactPerson_11	,
			EmailIdofcontactPerson_11	,
			NameofcontactPerson_12	,
			DesignationofcontactPerson_12	,
			PANofcontactPerson_12	,
			AddressofcontactPerson_12	,
			ContactdetailsofcontactPerson_12	,
			DINofcontactPerson_12	,
			UIDofcontactPerson_12	,
			EmailIdofcontactPerson_12	,
			NameofcontactPerson_13	,
			DesignationofcontactPerson_13	,
			PANofcontactPerson_13	,
			AddressofcontactPerson_13	,
			ContactdetailsofcontactPerson_13	,
			DINofcontactPerson_13	,
			UIDofcontactPerson_13	,
			EmailIdofcontactPerson_13	,
			NameofcontactPerson_14	,
			DesignationofcontactPerson_14	,
			PANofcontactPerson_14	,
			AddressofcontactPerson_14	,
			ContactdetailsofcontactPerson_14	,
			DINofcontactPerson_14	,
			UIDofcontactPerson_14	,
			EmailIdofcontactPerson_14	,
			NameofcontactPerson_15	,
			DesignationofcontactPerson_15	,
			PANofcontactPerson_15	,
			AddressofcontactPerson_15	,
			ContactdetailsofcontactPerson_15	,
			DINofcontactPerson_15	,
			UIDofcontactPerson_15	,
			EmailIdofcontactPerson_15	,
			NameofcontactPerson_16	,
			DesignationofcontactPerson_16	,
			PANofcontactPerson_16	,
			AddressofcontactPerson_16	,
			ContactdetailsofcontactPerson_16	,
			DINofcontactPerson_16	,
			UIDofcontactPerson_16	,
			EmailIdofcontactPerson_16	,
			NameofcontactPerson_17	,
			DesignationofcontactPerson_17	,
			PANofcontactPerson_17	,
			AddressofcontactPerson_17	,
			ContactdetailsofcontactPerson_17	,
			DINofcontactPerson_17	,
			UIDofcontactPerson_17	,
			EmailIdofcontactPerson_17	,
			NameofcontactPerson_18	,
			DesignationofcontactPerson_18	,
			PANofcontactPerson_18	,
			AddressofcontactPerson_18	,
			ContactdetailsofcontactPerson_18	,
			DINofcontactPerson_18	,
			UIDofcontactPerson_18	,
			EmailIdofcontactPerson_18	,
			NameofcontactPerson_19	,
			DesignationofcontactPerson_19	,
			PANofcontactPerson_19	,
			AddressofcontactPerson_19	,
			ContactdetailsofcontactPerson_19	,
			DINofcontactPerson_19	,
			UIDofcontactPerson_19	,
			EmailIdofcontactPerson_19	,
			NameofcontactPerson_20	,
			DesignationofcontactPerson_20	,
			PANofcontactPerson_20	,
			AddressofcontactPerson_20	,
			ContactdetailsofcontactPerson_20	,
			DINofcontactPerson_20	,
			UIDofcontactPerson_20	,
			EmailIdofcontactPerson_20	,
			Flag	
			)
	select
		segment = 'S',
		client_code = c2.party_code,
		client_name = left(c1_b.long_name, 150),
		category =cl_status,
		pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),
		Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */
		Fathers_Husbands_GuardiansName ='',
		Maritalstatus='',
		Nationality ='',
		Nationality_Other='', 
		ClientEmailId = left(email, 60),
		CorrespondenceClientAddressline1 = left(
			case
				when len(c1_b.l_address1) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address1, '')))
				end
			+
			case
				when len(c1_b.l_address2) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address2, '')))
				end
			+
			case
				when len(c1_b.l_address3) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address3, '')))
				end, 255
			),

		CorrespondenceClientAddressline2 = '',
		CorrespondenceClientAddressline3 = '',
		CorrespondenceClientAddress_City = left(c1_b.l_city, 50),
		CorrespondenceClientAddress_State = c1_b.l_state,
		CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,
		CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),
		CorrespondenceClientAddress_Pincode = 
		case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
		else
			c1_b.l_zip
		end		,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,	
		/*Modify on 30 Apr 2014*/
		PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end, 
		PermanentClientAddressline2 ='',
		PermanentClientAddressline3 ='',			
		/*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
		PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
		PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/
		PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,
		PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
		PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,
		PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
		PermanentClientAddress_Pincode =
		case when c1_b.P_Len='N' then 
			case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
			else
				c1_b.l_zip
			end
		else ''				 
		end,
		ISDcode_Residence ='',
		STDcode_Residence =case 
							when len(STDcode_Residence1)>0 then STDcode_Residence1
							when len(STDcode_Residence2)>0 then STDcode_Residence2
						   else '' end,	
		TelephoneNumber_Residence = 
			left(	case 
						when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')
						when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')
					else 
						'' 
					end
				, 60
				),
		Mobilenumber =left(c1_b.mobile_pager, 10),
		ISDcode_Office ='',
		STDcode_Office =case 
							when len(STDcode_Office1)>0 then STDcode_Office1
							when len(STDcode_Office2)>0 then STDcode_Office2
						   else '' end,
		TelephoneNumber_Office=
			left(	case 
						when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')
						when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')
					else 
						'' 
					end
				, 60
				),
		DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,
		UIDNUMBER='',

	
		BankName1 =bank_name,
		BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end , 
		BankAccountNo1 =bank_account_no,
		BankAccountType1 =case 
							when bank_account_type = 'SAVING' then '10'
							when bank_account_type = 'CURRENT' then '11'
							when bank_account_type = 'OTHER' then '99' 
						  else ''
							end ,
		BankName2 ='',
		BankBranchAddress2 ='',
		BankAccountNo2 ='',
		BankAccountType2 ='',
		BankName3 ='',
		BankBranchAddress3 ='',
		BankAccountNo3 ='',
		BankAccountType3 ='',
		
		DepositoryName1 =dp_name,
		DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,
		BeneficialOwnerAccountNo1 =demat_id_of_client,
		
		DepositoryName2 ='',
		DepositoryID2 ='',
		BeneficialOwnerAccountNo2 ='',
		DepositoryName3 ='',
		DepositoryID3 ='',
		BeneficialOwnerAccountNo3 ='',
		CorporateIdentitynumber_CIN='',
		GrossAnnualIncomeRange ='',
		GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,
		NetWorth_InRs ='',
		NetWorthasonDate ='',
		PoliticallyExposedPerson_PEP='0', 
		PlaceofIncorporation ='',
		Occupation ='',
		OccupationDetails_Forothers='', 
		Dateofcommencementofbusiness ='',
		CustodialParticipantCodeoftheclient ='',
		RegistrationNoofClient ='',
		RegisteringAuthority ='',
		PlaceofRegistration ='',
		DateofRegistration ='',
		InpersonVerification ='Y',
		ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),
							/*Change on 26 Apr 2014: Changes for NSE SLB */
		UniqueClientCodeallottedbyNSCCL_BSE ='',
		UpdationFlag_for_SMS_and_Email_facility='', 
		Relationship ='',
		TypeofFacility_for_SMS_and_Email_facility ='',
		ProofType ='',
		ProofNumber ='',
		IssuePlaceofProof='', 
		IssueDateofProof ='',
		ClientStatus ='A',
		Remarks ='',
		ClientType_Corporate='', 
		NameofcontactPerson_1 ='',
		DesignationofContactPerson_1 ='',
		PANofcontactPerson_1 ='',
		AddressofcontactPerson_1 ='',
		ContactdetailsofcontactPerson_1 ='',
		DINofcontactPerson_1 ='',
		UIDofcontactPerson_1 ='',
		EmailIdofcontactPerson_1 ='',
		NameofcontactPerson_2  ='',
		DesignationofcontactPerson_2 ='',
		PANofcontactPerson_2 ='',
		AddressofcontactPerson_2 ='',
		ContactdetailsofcontactPerson_2='', 
		DINofcontactPerson_2 ='',
		UIDofcontactPerson_2 ='',
		EmailIdofcontactPerson_2 ='',
		NameofcontactPerson_3 ='',
		DesignationofcontactPerson_3='', 
		PANofcontactPerson_3 ='',
		AddressofcontactPerson_3 ='',
		ContactdetailsofcontactPerson_3='', 
		DINofcontactPerson_3 ='',
		UIDofcontactPerson_3 ='',
		EmailIdofcontactPerson_3 ='',
		NameofcontactPerson_4 ='',
		DesignationofcontactPerson_4='', 
		PANofcontactPerson_4 ='',
		AddressofcontactPerson_4 ='',
		ContactdetailsofcontactPerson_4 ='',
		DINofcontactPerson_4 ='',
		UIDofcontactPerson_4 ='',
		EmailIdofcontactPerson_4 ='',
		NameofcontactPerson_5 ='',
		DesignationofcontactPerson_5 ='',
		PANofcontactPerson_5 ='',
		AddressofcontactPerson_5 ='',
		ContactdetailsofcontactPerson_5='', 
		DINofcontactPerson_5 ='',
		UIDofcontactPerson_5 ='',
		EmailIdofcontactPerson_5 ='',
		NameofcontactPerson_6 ='',
		DesignationofcontactPerson_6='', 
		PANofcontactPerson_6 ='',
		AddressofcontactPerson_6 ='',
		ContactdetailsofcontactPerson_6='', 
		DINofcontactPerson_6 ='',
		UIDofcontactPerson_6 ='',
		EmailIdofcontactPerson_6 ='',
		NameofcontactPerson_7 ='',
		DesignationofcontactPerson_7='', 
		PANofcontactPerson_7 ='',
		AddressofcontactPerson_7 ='',
		ContactdetailsofcontactPerson_7='', 
		DINofcontactPerson_7 ='',
		UIDofcontactPerson_7 ='',
		EmailIdofcontactPerson_7 ='',
		NameofcontactPerson_8 ='',
		DesignationofcontactPerson_8 ='',
		PANofcontactPerson_8 ='',
		AddressofcontactPerson_8 ='',
		ContactdetailsofcontactPerson_8 ='',
		DINofcontactPerson_8 ='',
		UIDofcontactPerson_8 ='',
		EmailIdofcontactPerson_8 ='',
		NameofcontactPerson_9 ='',
		DesignationofcontactPerson_9='', 
		PANofcontactPerson_9 ='',
		AddressofcontactPerson_9 ='',
		ContactdetailsofcontactPerson_9='', 
		DINofcontactPerson_9 ='',
		UIDofcontactPerson_9 ='',
		EmailIdofcontactPerson_9 ='',
		NameofcontactPerson_10 ='',
		DesignationofcontactPerson_10='', 
		PANofcontactPerson_10 ='',
		AddressofcontactPerson_10 ='',
		ContactdetailsofcontactPerson_10='', 
		DINofcontactPerson_10 ='',
		UIDofcontactPerson_10 ='',
		EmailIdofcontactPerson_10 ='',
		NameofcontactPerson_11 ='',
		DesignationofcontactPerson_11='', 
		PANofcontactPerson_11 ='',
		AddressofcontactPerson_11 ='',
		ContactdetailsofcontactPerson_11='', 
		DINofcontactPerson_11 ='',
		UIDofcontactPerson_11 ='',
		EmailIdofcontactPerson_11 ='',
		NameofcontactPerson_12 ='',
		DesignationofcontactPerson_12='', 
		PANofcontactPerson_12 ='',
		AddressofcontactPerson_12 ='',
		ContactdetailsofcontactPerson_12='', 
		DINofcontactPerson_12 ='',
		UIDofcontactPerson_12 ='',
		EmailIdofcontactPerson_12 ='',
		NameofcontactPerson_13 ='',
		DesignationofcontactPerson_13 ='',
		PANofcontactPerson_13 ='',
		AddressofcontactPerson_13 ='',
		ContactdetailsofcontactPerson_13 ='',
		DINofcontactPerson_13 ='',
		UIDofcontactPerson_13 ='',
		EmailIdofcontactPerson_13 ='',
		NameofcontactPerson_14 ='',
		DesignationofcontactPerson_14 ='',
		PANofcontactPerson_14 ='',
		AddressofcontactPerson_14 ='',
		ContactdetailsofcontactPerson_14 ='',
		DINofcontactPerson_14 ='',
		UIDofcontactPerson_14 ='',
		EmailIdofcontactPerson_14 ='',
		NameofcontactPerson_15 ='',
		DesignationofcontactPerson_15 ='',
		PANofcontactPerson_15 ='',
		AddressofcontactPerson_15 ='',
		ContactdetailsofcontactPerson_15='', 
		DINofcontactPerson_15 ='',
		UIDofcontactPerson_15 ='',
		EmailIdofcontactPerson_15 ='',
		NameofcontactPerson_16 ='',
		DesignationofcontactPerson_16='', 
		PANofcontactPerson_16 ='',
		AddressofcontactPerson_16 ='',
		ContactdetailsofcontactPerson_16='', 
		DINofcontactPerson_16 ='',
		UIDofcontactPerson_16 ='',
		EmailIdofcontactPerson_16 ='',
		NameofcontactPerson_17 ='',
		DesignationofcontactPerson_17='', 
		PANofcontactPerson_17 ='',
		AddressofcontactPerson_17 ='',
		ContactdetailsofcontactPerson_17='', 
		DINofcontactPerson_17 ='',
		UIDofcontactPerson_17 ='',
		EmailIdofcontactPerson_17 ='',
		NameofcontactPerson_18 ='',
		DesignationofcontactPerson_18='', 
		PANofcontactPerson_18 ='',
		AddressofcontactPerson_18 ='',
		ContactdetailsofcontactPerson_18='', 
		DINofcontactPerson_18 ='',
		UIDofcontactPerson_18 ='',
		EmailIdofcontactPerson_18 ='',
		NameofcontactPerson_19 ='',
		DesignationofcontactPerson_19='', 
		PANofcontactPerson_19 ='',
		AddressofcontactPerson_19 ='',
		ContactdetailsofcontactPerson_19='', 
		DINofcontactPerson_19 ='',
		UIDofcontactPerson_19 ='',
		EmailIdofcontactPerson_19 ='',
		NameofcontactPerson_20 ='',
		DesignationofcontactPerson_20='', 
		PANofcontactPerson_20 ='',
		AddressofcontactPerson_20 ='',
		ContactdetailsofcontactPerson_20='', 
		DINofcontactPerson_20 ='',
		UIDofcontactPerson_20 ='',
		EmailIdofcontactPerson_20 ='',
		Flag='E'
	from
		(
			select
				c1.*,
				b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_Client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
		#temp_Client2 c2 with (nolock),
		#temp_Client5 c5 with (nolock)

	where
		ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and
		ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and
		ltrim(rtrim(left(c2.party_code,2))) <> '98'
		

	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),
	    --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/
	    --MASTERPAN=ISNULL(c1.MASTERPAN,''),
	    TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),
		--Gender=isnull(c1.Gender,''),
		Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=
					case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		GrossAnnualIncomeRange=case 
					when c1.Gross_Income ='01' then '1'
					when c1.Gross_Income ='02' then '2'
					when c1.Gross_Income ='03' then '3'
					when c1.Gross_Income ='04' then '4'
					when c1.Gross_Income ='05' then '5'
					when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/
					when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/
					else '' end, 
		NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''
						else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,
		PoliticallyExposedPerson_PEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end,
		OccupationDetails_Forothers=isnull(Occupation_Other,''),
		UIDNUMBER=isnull(c1.AADHAR_UID,'')
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0			
	
	update 
		#mimansa_angel_ucc_nse_slb_client_data_new_changes 
	set 
		GrossAnnualIncomeasonDate='',
		NetWorth_InRs='',
		NetWorthasonDate=''
	where len(GrossAnnualIncomeRange)=0 

	
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		#mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),
		ClientType_Corporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4	

	/****ADDRESS 1****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_1=c1.contact_name,
	DesignationofContactPerson_1=c1.designation,
	PANofcontactPerson_1=c1.PanNo,
	AddressofcontactPerson_1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_1=c1.DIN,
	UIDofcontactPerson_1=c1.UID,
	EmailIdofcontactPerson_1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='1'

	/****ADDRESS 2****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_2=c1.contact_name,
	DesignationofContactPerson_2=c1.designation,
	PANofcontactPerson_2=c1.PanNo,
	AddressofcontactPerson_2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_2=c1.DIN,
	UIDofcontactPerson_2=c1.UID,
	EmailIdofcontactPerson_2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='2'

	/****ADDRESS 3****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_3=c1.contact_name,
	DesignationofContactPerson_3=c1.designation,
	PANofcontactPerson_3=c1.PanNo,
	AddressofcontactPerson_3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_3=c1.DIN,
	UIDofcontactPerson_3=c1.UID,
	EmailIdofcontactPerson_3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='3'

	/****ADDRESS 4****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_4=c1.contact_name,
	DesignationofContactPerson_4=c1.designation,
	PANofcontactPerson_4=c1.PanNo,
	AddressofcontactPerson_4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_4=c1.DIN,
	UIDofcontactPerson_4=c1.UID,
	EmailIdofcontactPerson_4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_5=c1.contact_name,
	DesignationofContactPerson_5=c1.designation,
	PANofcontactPerson_5=c1.PanNo,
	AddressofcontactPerson_5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_5=c1.DIN,
	UIDofcontactPerson_5=c1.UID,
	EmailIdofcontactPerson_5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_6=c1.contact_name,
	DesignationofContactPerson_6=c1.designation,
	PANofcontactPerson_6=c1.PanNo,
	AddressofcontactPerson_6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_6=c1.DIN,
	UIDofcontactPerson_6=c1.UID,
	EmailIdofcontactPerson_6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_7=c1.contact_name,
	DesignationofContactPerson_7=c1.designation,
	PANofcontactPerson_7=c1.PanNo,
	AddressofcontactPerson_7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_7=c1.DIN,
	UIDofcontactPerson_7=c1.UID,
	EmailIdofcontactPerson_7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_8=c1.contact_name,
	DesignationofContactPerson_8=c1.designation,
	PANofcontactPerson_8=c1.PanNo,
	AddressofcontactPerson_8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_8=c1.DIN,
	UIDofcontactPerson_8=c1.UID,
	EmailIdofcontactPerson_8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_9=c1.contact_name,
	DesignationofContactPerson_9=c1.designation,
	PANofcontactPerson_9=c1.PanNo,
	AddressofcontactPerson_9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_9=c1.DIN,
	UIDofcontactPerson_9=c1.UID,
	EmailIdofcontactPerson_9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_10=c1.contact_name,
	DesignationofContactPerson_10=c1.designation,
	PANofcontactPerson_10=c1.PanNo,
	AddressofcontactPerson_10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_10=c1.DIN,
	UIDofcontactPerson_10=c1.UID,
	EmailIdofcontactPerson_10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='10'

	
	/*INVALID PAN*/

	

	select distinct
		client_code = ltrim(rtrim(client_code)),
		client_name = ltrim(rtrim(client_name)),
		pan = ltrim(rtrim(pan))
		--pan,
		--pan_err = 
		--	case 
		--		when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'
		--		then 'NO PAN'
		--		when len(ltrim(rtrim(isnull(pan, '')))) = 0
		--		then 'NO PAN'
		--		when not (
		--			isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and
		--			isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and
		--			isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and
		--			len(ltrim(rtrim(isnull(pan, '')))) = 10
		--		)
		--		then 'INVALID PAN'
		--	end,

		--pan_length = len(ltrim(rtrim(isnull(pan, '')))),
		--telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),
		--client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))
into #invalidpan
	from
		--mimansa_angel_ucc_nse_fo_client_data with(nolock)
		mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
	where
		ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'

	

	
delete
	#mimansa_angel_ucc_nse_slb_client_data_new_changes
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp 
where
	ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10

/***************FINAL DISPLAY*******************/
select distinct
		Segment, 
		Client_Code=ltrim(RTRIM(Client_Code)), 
		Client_Name ,
		Category ,
		PAN ,
		Gender, 
		Fathers_Husbands_GuardiansName ,
		Maritalstatus ,
		Nationality ,
		Nationality_Other, 
		ClientEmailId ,
		CorrespondenceClientAddressline1 ,
		CorrespondenceClientAddressline2 ,
		CorrespondenceClientAddressline3 ,
		CorrespondenceClientAddress_City ,
		CorrespondenceClientAddress_State ,
		CorrespondenceClientAddress_State_Others, 
		CorrespondenceClientAddress_Country ,
		CorrespondenceClientAddress_Pincode ,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,
		PermanentClientAddressline1 ,
		PermanentClientAddressline2 ,
		PermanentClientAddressline3 ,
		PermanentClientAddress_City ,
		PermanentClientAddress_State ,
		PermanentClientAddress_StateOthers  ,
		PermanentClientAddress_Country ,
		PermanentClientAddress_Pincode ,
		ISDcode_Residence ,
		STDcode_Residence ,
		TelephoneNumber_Residence ,
		Mobilenumber ,
		ISDcode_Office, 
		STDcode_Office ,
		TelephoneNumber_Office ,
		DateofBirth_Incorporation ,
		UIDNUMBER ,
		BankName1 ,
		BankBranchAddress1 ,
		BankAccountNo1 ,
		BankAccountType1 ,
		BankName2 ,
		BankBranchAddress2 ,
		BankAccountNo2 ,
		BankAccountType2 ,
		BankName3 ,
		BankBranchAddress3 ,
		BankAccountNo3 ,
		BankAccountType3, 
		DepositoryName1 ,
		DepositoryID1 ,
		BeneficialOwnerAccountNo1 ,
		DepositoryName2 ,
		DepositoryID2 ,
		BeneficialOwnerAccountNo2 ,
		DepositoryName3 ,
		DepositoryID3 ,
		BeneficialOwnerAccountNo3 ,
		CorporateIdentitynumber_CIN, 
		GrossAnnualIncomeRange ,
		GrossAnnualIncomeasonDate, 
		NetWorth_InRs ,
		NetWorthasonDate, 
		PoliticallyExposedPerson_PEP ,
		PlaceofIncorporation ,
		Occupation ,
		OccupationDetails_Forothers ,
		Dateofcommencementofbusiness ,
		CustodialParticipantCodeoftheclient ,
		RegistrationNoofClient ,
		RegisteringAuthority ,
		PlaceofRegistration ,
		DateofRegistration ,
		InpersonVerification, 
		ClientAgreementDate ,
		UniqueClientCodeallottedbyNSCCL_BSE ,
		UpdationFlag_for_SMS_and_Email_facility ,
		Relationship ,
		TypeofFacility_for_SMS_and_Email_facility ,
		ProofType ,
		ProofNumber ,
		IssuePlaceofProof ,
		IssueDateofProof ,
		ClientStatus ,
		Remarks ,
		ClientType_Corporate, 
		NameofcontactPerson_1 ,
		DesignationofContactPerson_1 ,
		PANofcontactPerson_1 ,
		AddressofcontactPerson_1 ,
		ContactdetailsofcontactPerson_1 ,
		DINofcontactPerson_1 ,
		UIDofcontactPerson_1 ,
		EmailIdofcontactPerson_1 ,
		NameofcontactPerson_2  ,
		DesignationofcontactPerson_2 ,
		PANofcontactPerson_2 ,
		AddressofcontactPerson_2 ,
		ContactdetailsofcontactPerson_2, 
		DINofcontactPerson_2 ,
		UIDofcontactPerson_2 ,
		EmailIdofcontactPerson_2 ,
		NameofcontactPerson_3 ,
		DesignationofcontactPerson_3, 
		PANofcontactPerson_3 ,
		AddressofcontactPerson_3 ,
		ContactdetailsofcontactPerson_3, 
		DINofcontactPerson_3 ,
		UIDofcontactPerson_3 ,
		EmailIdofcontactPerson_3 ,
		NameofcontactPerson_4 ,
		DesignationofcontactPerson_4, 
		PANofcontactPerson_4 ,
		AddressofcontactPerson_4 ,
		ContactdetailsofcontactPerson_4 ,
		DINofcontactPerson_4 ,
		UIDofcontactPerson_4 ,
		EmailIdofcontactPerson_4 ,
		NameofcontactPerson_5 ,
		DesignationofcontactPerson_5 ,
		PANofcontactPerson_5 ,
		AddressofcontactPerson_5 ,
		ContactdetailsofcontactPerson_5, 
		DINofcontactPerson_5 ,
		UIDofcontactPerson_5 ,
		EmailIdofcontactPerson_5 ,
		NameofcontactPerson_6 ,
		DesignationofcontactPerson_6, 
		PANofcontactPerson_6 ,
		AddressofcontactPerson_6 ,
		ContactdetailsofcontactPerson_6, 
		DINofcontactPerson_6 ,
		UIDofcontactPerson_6 ,
		EmailIdofcontactPerson_6 ,
		NameofcontactPerson_7 ,
		DesignationofcontactPerson_7, 
		PANofcontactPerson_7 ,
		AddressofcontactPerson_7 ,
		ContactdetailsofcontactPerson_7, 
		DINofcontactPerson_7 ,
		UIDofcontactPerson_7 ,
		EmailIdofcontactPerson_7 ,
		NameofcontactPerson_8 ,
		DesignationofcontactPerson_8 ,
		PANofcontactPerson_8 ,
		AddressofcontactPerson_8 ,
		ContactdetailsofcontactPerson_8 ,
		DINofcontactPerson_8 ,
		UIDofcontactPerson_8 ,
		EmailIdofcontactPerson_8 ,
		NameofcontactPerson_9 ,
		DesignationofcontactPerson_9, 
		PANofcontactPerson_9 ,
		AddressofcontactPerson_9 ,
		ContactdetailsofcontactPerson_9, 
		DINofcontactPerson_9 ,
		UIDofcontactPerson_9 ,
		EmailIdofcontactPerson_9 ,
		NameofcontactPerson_10 ,
		DesignationofcontactPerson_10, 
		PANofcontactPerson_10 ,
		AddressofcontactPerson_10 ,
		ContactdetailsofcontactPerson_10, 
		DINofcontactPerson_10 ,
		UIDofcontactPerson_10 ,
		EmailIdofcontactPerson_10 ,
		NameofcontactPerson_11 ,
		DesignationofcontactPerson_11, 
		PANofcontactPerson_11 ,
		AddressofcontactPerson_11 ,
		ContactdetailsofcontactPerson_11, 
		DINofcontactPerson_11 ,
		UIDofcontactPerson_11 ,
		EmailIdofcontactPerson_11 ,
		NameofcontactPerson_12 ,
		DesignationofcontactPerson_12, 
		PANofcontactPerson_12 ,
		AddressofcontactPerson_12 ,
		ContactdetailsofcontactPerson_12, 
		DINofcontactPerson_12 ,
		UIDofcontactPerson_12 ,
		EmailIdofcontactPerson_12 ,
		NameofcontactPerson_13 ,
		DesignationofcontactPerson_13 ,
		PANofcontactPerson_13 ,
		AddressofcontactPerson_13 ,
		ContactdetailsofcontactPerson_13 ,
		DINofcontactPerson_13 ,
		UIDofcontactPerson_13 ,
		EmailIdofcontactPerson_13 ,
		NameofcontactPerson_14 ,
		DesignationofcontactPerson_14 ,
		PANofcontactPerson_14 ,
		AddressofcontactPerson_14 ,
		ContactdetailsofcontactPerson_14 ,
		DINofcontactPerson_14 ,
		UIDofcontactPerson_14 ,
		EmailIdofcontactPerson_14 ,
		NameofcontactPerson_15 ,
		DesignationofcontactPerson_15 ,
		PANofcontactPerson_15 ,
		AddressofcontactPerson_15 ,
		ContactdetailsofcontactPerson_15, 
		DINofcontactPerson_15 ,
		UIDofcontactPerson_15 ,
		EmailIdofcontactPerson_15 ,
		NameofcontactPerson_16 ,
		DesignationofcontactPerson_16, 
		PANofcontactPerson_16 ,
		AddressofcontactPerson_16 ,
		ContactdetailsofcontactPerson_16, 
		DINofcontactPerson_16 ,
		UIDofcontactPerson_16 ,
		EmailIdofcontactPerson_16 ,
		NameofcontactPerson_17 ,
		DesignationofcontactPerson_17, 
		PANofcontactPerson_17 ,
		AddressofcontactPerson_17 ,
		ContactdetailsofcontactPerson_17, 
		DINofcontactPerson_17 ,
		UIDofcontactPerson_17 ,
		EmailIdofcontactPerson_17 ,
		NameofcontactPerson_18 ,
		DesignationofcontactPerson_18, 
		PANofcontactPerson_18 ,
		AddressofcontactPerson_18 ,
		ContactdetailsofcontactPerson_18, 
		DINofcontactPerson_18 ,
		UIDofcontactPerson_18 ,
		EmailIdofcontactPerson_18 ,
		NameofcontactPerson_19 ,
		DesignationofcontactPerson_19, 
		PANofcontactPerson_19 ,
		AddressofcontactPerson_19 ,
		ContactdetailsofcontactPerson_19, 
		DINofcontactPerson_19 ,
		UIDofcontactPerson_19 ,
		EmailIdofcontactPerson_19 ,
		NameofcontactPerson_20 ,
		DesignationofcontactPerson_20, 
		PANofcontactPerson_20 ,
		AddressofcontactPerson_20 ,
		ContactdetailsofcontactPerson_20, 
		DINofcontactPerson_20 ,
		UIDofcontactPerson_20 ,
		EmailIdofcontactPerson_20 ,
		Flag='E'
from
	#mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
 
where
	len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'





	/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)	
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'

/*Insert Log*/
if exists(select * from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))
begin
	if(@totalrecord>0)
	begin
		update [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count 
		set file_number=file_number+1
		where time_stamp>=cast(left(getdate(),11) as datetime)
	end
end
else
begin
	if(@totalrecord>0)
	begin
		insert into [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)
		select 1,getdate()
	end
end
	
/*Display File Name and First Row
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)
				Ex- uci_20140225.t04
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count 
				Ex- 10|M|12798|27022014|04|220
*/

select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')
				+'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),					
	   FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'
				+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'
				+cast(@totalrecord  as varchar) 
from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)


/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_bak15Dec2018
-- --------------------------------------------------
-- [mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015] 'Feb 10 2015','Feb 10 2015','',''
create proc

	[dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_bak15Dec2018]
	(
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
	)
as
--mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015 'Feb 10 2014','Feb 10 2014','',''
	/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate
		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

	/*******************FETCH DATA**************************/

	--truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes
	

CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(
	[Segment] [varchar](1) NULL,
	[Client_Code] [varchar](10) NULL,
	[Client_Name] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[Fathers_Husbands_GuardiansName] [varchar](150) NULL,
	[Maritalstatus] [varchar](2) NULL,
	[Nationality] [varchar](2) NULL,
	[Nationality_Other] [varchar](50) NULL,
	[ClientEmailId] [varchar](60) NULL,
	[CorrespondenceClientAddressline1] [varchar](255) NULL,
	[CorrespondenceClientAddressline2] [varchar](255) NULL,
	[CorrespondenceClientAddressline3] [varchar](255) NULL,
	[CorrespondenceClientAddress_City] [varchar](50) NULL,
	[CorrespondenceClientAddress_State] [varchar](2) NULL,
	[CorrespondenceClientAddress_State_Others] [varchar](75) NULL,
	[CorrespondenceClientAddress_Country] [varchar](3) NULL,
	[CorrespondenceClientAddress_Pincode] [varchar](10) NULL,
	[FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,
	[PermanentClientAddressline1] [varchar](255) NULL,
	[PermanentClientAddressline2] [varchar](255) NULL,
	[PermanentClientAddressline3] [varchar](255) NULL,
	[PermanentClientAddress_City] [varchar](50) NULL,
	[PermanentClientAddress_State] [varchar](2) NULL,
	[PermanentClientAddress_StateOthers] [varchar](75) NULL,
	[PermanentClientAddress_Country] [varchar](2) NULL,
	[PermanentClientAddress_Pincode] [varchar](10) NULL,
	[ISDcode_Residence] [varchar](10) NULL,
	[STDcode_Residence] [varchar](10) NULL,
	[TelephoneNumber_Residence] [varchar](60) NULL,
	[Mobilenumber] [varchar](20) NULL,
	[ISDcode_Office] [varchar](10) NULL,
	[STDcode_Office] [varchar](10) NULL,
	[TelephoneNumber_Office] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](60) NULL,
	[UIDNUMBER] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNo1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNo2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNo3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](4) NULL,
	[DepositoryID1] [varchar](8) NULL,
	[BeneficialOwnerAccountNo1] [varchar](16) NULL,
	[DepositoryName2] [varchar](4) NULL,
	[DepositoryID2] [varchar](8) NULL,
	[BeneficialOwnerAccountNo2] [varchar](16) NULL,
	[DepositoryName3] [varchar](4) NULL,
	[DepositoryID3] [varchar](8) NULL,
	[BeneficialOwnerAccountNo3] [varchar](16) NULL,
	[CorporateIdentitynumber_CIN] [varchar](21) NULL,
	[GrossAnnualIncomeRange] [varchar](40) NULL,
	[GrossAnnualIncomeasonDate] [varchar](40) NULL,
	[NetWorth_InRs] [varchar](40) NULL,
	[NetWorthasonDate] [varchar](40) NULL,
	[PoliticallyExposedPerson_PEP] [varchar](2) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetails_Forothers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](40) NULL,
	[CustodialParticipantCodeoftheclient] [varchar](15) NULL,
	[RegistrationNoofClient] [varchar](25) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](40) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](40) NULL,
	[UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,
	[UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,
	[Relationship] [varchar](1) NULL,
	[TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,
	[ProofType] [varchar](1) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](40) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientType_Corporate] [varchar](200) NULL,
	[NameofcontactPerson_1] [varchar](200) NULL,
	[DesignationofContactPerson_1] [varchar](200) NULL,
	[PANofcontactPerson_1] [varchar](200) NULL,
	[AddressofcontactPerson_1] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_1] [varchar](200) NULL,
	[DINofcontactPerson_1] [varchar](200) NULL,
	[UIDofcontactPerson_1] [varchar](200) NULL,
	[EmailIdofcontactPerson_1] [varchar](200) NULL,
	[NameofcontactPerson_2] [varchar](200) NULL,
	[DesignationofcontactPerson_2] [varchar](200) NULL,
	[PANofcontactPerson_2] [varchar](200) NULL,
	[AddressofcontactPerson_2] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_2] [varchar](200) NULL,
	[DINofcontactPerson_2] [varchar](200) NULL,
	[UIDofcontactPerson_2] [varchar](200) NULL,
	[EmailIdofcontactPerson_2] [varchar](200) NULL,
	[NameofcontactPerson_3] [varchar](200) NULL,
	[DesignationofcontactPerson_3] [varchar](200) NULL,
	[PANofcontactPerson_3] [varchar](200) NULL,
	[AddressofcontactPerson_3] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_3] [varchar](200) NULL,
	[DINofcontactPerson_3] [varchar](200) NULL,
	[UIDofcontactPerson_3] [varchar](200) NULL,
	[EmailIdofcontactPerson_3] [varchar](200) NULL,
	[NameofcontactPerson_4] [varchar](200) NULL,
	[DesignationofcontactPerson_4] [varchar](200) NULL,
	[PANofcontactPerson_4] [varchar](200) NULL,
	[AddressofcontactPerson_4] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_4] [varchar](200) NULL,
	[DINofcontactPerson_4] [varchar](200) NULL,
	[UIDofcontactPerson_4] [varchar](200) NULL,
	[EmailIdofcontactPerson_4] [varchar](200) NULL,
	[NameofcontactPerson_5] [varchar](200) NULL,
	[DesignationofcontactPerson_5] [varchar](200) NULL,
	[PANofcontactPerson_5] [varchar](200) NULL,
	[AddressofcontactPerson_5] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_5] [varchar](200) NULL,
	[DINofcontactPerson_5] [varchar](200) NULL,
	[UIDofcontactPerson_5] [varchar](200) NULL,
	[EmailIdofcontactPerson_5] [varchar](200) NULL,
	[NameofcontactPerson_6] [varchar](200) NULL,
	[DesignationofcontactPerson_6] [varchar](200) NULL,
	[PANofcontactPerson_6] [varchar](200) NULL,
	[AddressofcontactPerson_6] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_6] [varchar](200) NULL,
	[DINofcontactPerson_6] [varchar](200) NULL,
	[UIDofcontactPerson_6] [varchar](200) NULL,
	[EmailIdofcontactPerson_6] [varchar](200) NULL,
	[NameofcontactPerson_7] [varchar](200) NULL,
	[DesignationofcontactPerson_7] [varchar](200) NULL,
	[PANofcontactPerson_7] [varchar](200) NULL,
	[AddressofcontactPerson_7] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_7] [varchar](200) NULL,
	[DINofcontactPerson_7] [varchar](200) NULL,
	[UIDofcontactPerson_7] [varchar](200) NULL,
	[EmailIdofcontactPerson_7] [varchar](200) NULL,
	[NameofcontactPerson_8] [varchar](200) NULL,
	[DesignationofcontactPerson_8] [varchar](200) NULL,
	[PANofcontactPerson_8] [varchar](200) NULL,
	[AddressofcontactPerson_8] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_8] [varchar](200) NULL,
	[DINofcontactPerson_8] [varchar](200) NULL,
	[UIDofcontactPerson_8] [varchar](200) NULL,
	[EmailIdofcontactPerson_8] [varchar](200) NULL,
	[NameofcontactPerson_9] [varchar](200) NULL,
	[DesignationofcontactPerson_9] [varchar](200) NULL,
	[PANofcontactPerson_9] [varchar](200) NULL,
	[AddressofcontactPerson_9] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_9] [varchar](200) NULL,
	[DINofcontactPerson_9] [varchar](200) NULL,
	[UIDofcontactPerson_9] [varchar](200) NULL,
	[EmailIdofcontactPerson_9] [varchar](200) NULL,
	[NameofcontactPerson_10] [varchar](200) NULL,
	[DesignationofcontactPerson_10] [varchar](200) NULL,
	[PANofcontactPerson_10] [varchar](200) NULL,
	[AddressofcontactPerson_10] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_10] [varchar](200) NULL,
	[DINofcontactPerson_10] [varchar](200) NULL,
	[UIDofcontactPerson_10] [varchar](200) NULL,
	[EmailIdofcontactPerson_10] [varchar](200) NULL,
	[NameofcontactPerson_11] [varchar](200) NULL,
	[DesignationofcontactPerson_11] [varchar](200) NULL,
	[PANofcontactPerson_11] [varchar](200) NULL,
	[AddressofcontactPerson_11] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_11] [varchar](200) NULL,
	[DINofcontactPerson_11] [varchar](200) NULL,
	[UIDofcontactPerson_11] [varchar](200) NULL,
	[EmailIdofcontactPerson_11] [varchar](200) NULL,
	[NameofcontactPerson_12] [varchar](200) NULL,
	[DesignationofcontactPerson_12] [varchar](200) NULL,
	[PANofcontactPerson_12] [varchar](200) NULL,
	[AddressofcontactPerson_12] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_12] [varchar](200) NULL,
	[DINofcontactPerson_12] [varchar](200) NULL,
	[UIDofcontactPerson_12] [varchar](200) NULL,
	[EmailIdofcontactPerson_12] [varchar](200) NULL,
	[NameofcontactPerson_13] [varchar](200) NULL,
	[DesignationofcontactPerson_13] [varchar](200) NULL,
	[PANofcontactPerson_13] [varchar](200) NULL,
	[AddressofcontactPerson_13] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_13] [varchar](200) NULL,
	[DINofcontactPerson_13] [varchar](200) NULL,
	[UIDofcontactPerson_13] [varchar](200) NULL,
	[EmailIdofcontactPerson_13] [varchar](200) NULL,
	[NameofcontactPerson_14] [varchar](200) NULL,
	[DesignationofcontactPerson_14] [varchar](200) NULL,
	[PANofcontactPerson_14] [varchar](200) NULL,
	[AddressofcontactPerson_14] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_14] [varchar](200) NULL,
	[DINofcontactPerson_14] [varchar](200) NULL,
	[UIDofcontactPerson_14] [varchar](200) NULL,
	[EmailIdofcontactPerson_14] [varchar](200) NULL,
	[NameofcontactPerson_15] [varchar](200) NULL,
	[DesignationofcontactPerson_15] [varchar](200) NULL,
	[PANofcontactPerson_15] [varchar](200) NULL,
	[AddressofcontactPerson_15] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_15] [varchar](200) NULL,
	[DINofcontactPerson_15] [varchar](200) NULL,
	[UIDofcontactPerson_15] [varchar](200) NULL,
	[EmailIdofcontactPerson_15] [varchar](200) NULL,
	[NameofcontactPerson_16] [varchar](200) NULL,
	[DesignationofcontactPerson_16] [varchar](200) NULL,
	[PANofcontactPerson_16] [varchar](200) NULL,
	[AddressofcontactPerson_16] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_16] [varchar](200) NULL,
	[DINofcontactPerson_16] [varchar](200) NULL,
	[UIDofcontactPerson_16] [varchar](200) NULL,
	[EmailIdofcontactPerson_16] [varchar](200) NULL,
	[NameofcontactPerson_17] [varchar](200) NULL,
	[DesignationofcontactPerson_17] [varchar](200) NULL,
	[PANofcontactPerson_17] [varchar](200) NULL,
	[AddressofcontactPerson_17] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_17] [varchar](200) NULL,
	[DINofcontactPerson_17] [varchar](200) NULL,
	[UIDofcontactPerson_17] [varchar](200) NULL,
	[EmailIdofcontactPerson_17] [varchar](200) NULL,
	[NameofcontactPerson_18] [varchar](200) NULL,
	[DesignationofcontactPerson_18] [varchar](200) NULL,
	[PANofcontactPerson_18] [varchar](200) NULL,
	[AddressofcontactPerson_18] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_18] [varchar](200) NULL,
	[DINofcontactPerson_18] [varchar](200) NULL,
	[UIDofcontactPerson_18] [varchar](200) NULL,
	[EmailIdofcontactPerson_18] [varchar](200) NULL,
	[NameofcontactPerson_19] [varchar](200) NULL,
	[DesignationofcontactPerson_19] [varchar](200) NULL,
	[PANofcontactPerson_19] [varchar](200) NULL,
	[AddressofcontactPerson_19] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_19] [varchar](200) NULL,
	[DINofcontactPerson_19] [varchar](200) NULL,
	[UIDofcontactPerson_19] [varchar](200) NULL,
	[EmailIdofcontactPerson_19] [varchar](200) NULL,
	[NameofcontactPerson_20] [varchar](200) NULL,
	[DesignationofcontactPerson_20] [varchar](200) NULL,
	[PANofcontactPerson_20] [varchar](200) NULL,
	[AddressofcontactPerson_20] [varchar](200) NULL,
	[ContactdetailsofcontactPerson_20] [varchar](200) NULL,
	[DINofcontactPerson_20] [varchar](200) NULL,
	[UIDofcontactPerson_20] [varchar](200) NULL,
	[EmailIdofcontactPerson_20] [varchar](200) NULL,
	[POAforFunds] [varchar](1) NULL,
	[POAforSecurities] [varchar](1) NULL,
	[Flag] [varchar](1) NULL
)
	
	--insert into 
	--	angel_ucc_nse_fo_client1
	select
		party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=cast('' as varchar(255)),
		P_address2=cast('' as varchar(255)),
		P_address3=cast('' as varchar(255)),
		P_City=cast('' as varchar(50)),
		P_State=cast('' as varchar(100)),
		P_State_For_Other=cast('' as varchar(100)),
		P_nation=cast('' as varchar(100)),
		P_zip=cast('' as varchar(10)),
		P_Len=cast('' as varchar(1)),	
		Gender=cast('' as varchar(1)),
		STDcode_Residence1=cast('' as varchar(10)),
		STDcode_Residence2=cast('' as varchar(10)),
		STDcode_Office1=cast('' as varchar(10)),
		STDcode_Office2=cast('' as varchar(10))
	into 
		#temp_client1	
	from 
		NSESLBS.dbo.client1 c1 with(nolock),
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c1.cl_code = c2.cl_code and 
		c2.party_code = t.party_code 

	update #temp_client1 set 
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,'')
	from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)
	where t1.Cl_Code=c1.cl_code

	update 
		#temp_Client1 
	set 
	L_State= dbo.fn_state_countary_value(l_state,'STATE'),
	P_State=dbo.fn_state_countary_value(P_state,'STATE'),
	L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),
	P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),
	cl_status=case
				/*INDIVIDUAL/PROPRIETORSHIP FIRMS*/
				when cl_status = 'IND' then '1'		/*INDIVIDUAL*/

				/*PARTNERSHIP FIRM*/
				when cl_status = 'PF' or cl_status='LLP' then '2'		/*PARTNERSHIP FIRMS*/

				/*HUF*/
				when cl_status = 'HUF' then '3'		/*HINDU UNDIVIDED FAMILY*/

				/*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/
				when cl_status = 'PPB' then '4'		/*PUB. PVT COMP/BODIES CORP*/
				when cl_status = 'BCP' then '4'		/*BODY CORPORATE*/

				/*TRUST / SOCIETY*/
				when cl_status = 'TS' then '5'		/*TRUST / SOCIETY*/

				/*MUTUAL FUND*/
				when cl_status = 'MF' then '6'		/*MUTUAL FUNDS*/
				when cl_status = 'MFF' then '6'		/*MUTUAL FUND (MF)*/

				/*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/
				when cl_status = 'IFI' then '7'		/*INDIAN FINANCIAL INSTI*/
				when cl_status = 'DFI' then '7'		/*DOMESTIC FIN. INST.*/

				/*BANK*/
				when cl_status = 'BA' then ' 8'		/*BANKS*/
				when cl_status = 'BNK' then '8'		/*BANK*/

				/*INSURANCE*/
				when cl_status = 'IC' then ' 9'		/*INSURANCE COMPANIES*/

				/*STATUTORY BODIES*/
				when cl_status = 'SB' then ' 10'		/*STATUTORY BODIES*/

				/*NRI*/
				when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'		/*NON RESIDENT INDIAN*/

				/*FII*/
				when cl_status = 'FII' then '12'		/*FOREIGN INSTIT INVESTORS*/

				/*OCB*/
				when cl_status = 'OCB' then '13'		/*OVERSEAS CORPORATE BODIES*/

				/*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/
				when cl_status = 'DFN' then '14'		/*DIRECT FOREIGN INVESTMENTS*/

				when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/
				
				/*FVC*/
				when cl_status = 'FVC' then '20'		/*FOREIGN VENTURE CAPITAL FUNDS*/
			else
				'1'		/*INDIVIDUAL*/
			end

	
	select 
		Cl_Code, Party_code=c2.Party_code
	into #temp_client2	
	from 
		NSESLBS.dbo.client2 c2 with(nolock),
		#codes_to_process t with (nolock)
	where 
		c2.party_code = t.party_code
	
	select 
		party_code = ltrim(rtrim(t.party_code)),
		--c5.*
		cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),
		--BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),
		--ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */
		ActiveFrom=c5.ActiveFrom,
		InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),
		GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))
	into #temp_Client5	
	from 
		NSESLBS.dbo.client5 c5 with(nolock),
		#temp_Client2 t with (nolock)
	where 
		c5.cl_code = t.cl_code

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.pobank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#codes_to_process t with (nolock),
		NSESLBS.dbo.client4 c4 with(nolock),
		NSESLBS.dbo.bank b with(nolock)
	where
		t.party_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('CDSL', 'NSDL') and
		isnull(c4.defdp, '') = '1'

	--insert into
	--	angel_ucc_nse_fo_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank	
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))


	/*******************END - FETCH DATA**************************/

	insert into
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
		(
			Segment	,
			Client_Code	,
			Client_Name	,
			Category	,
			PAN	,
			Gender	,
			Fathers_Husbands_GuardiansName	,
			Maritalstatus	,
			Nationality	,
			Nationality_Other	,
			ClientEmailId	,
			CorrespondenceClientAddressline1	,
			CorrespondenceClientAddressline2	,
			CorrespondenceClientAddressline3	,
			CorrespondenceClientAddress_City	,
			CorrespondenceClientAddress_State	,
			CorrespondenceClientAddress_State_Others	,
			CorrespondenceClientAddress_Country	,
			CorrespondenceClientAddress_Pincode	,
			FlagIndicatingifCorrespondenceAddressissameasPermanentAddress	,
			PermanentClientAddressline1	,
			PermanentClientAddressline2	,
			PermanentClientAddressline3	,
			PermanentClientAddress_City	,
			PermanentClientAddress_State	,
			PermanentClientAddress_StateOthers	,
			PermanentClientAddress_Country	,
			PermanentClientAddress_Pincode	,
			ISDcode_Residence	,
			STDcode_Residence	,
			TelephoneNumber_Residence	,
			Mobilenumber	,
			ISDcode_Office	,
			STDcode_Office	,
			TelephoneNumber_Office	,
			DateofBirth_Incorporation	,
			UIDNUMBER	,
			BankName1	,
			BankBranchAddress1	,
			BankAccountNo1	,
			BankAccountType1	,
			BankName2	,
			BankBranchAddress2	,
			BankAccountNo2	,
			BankAccountType2	,
			BankName3	,
			BankBranchAddress3	,
			BankAccountNo3	,
			BankAccountType3	,
			DepositoryName1	,
			DepositoryID1	,
			BeneficialOwnerAccountNo1	,
			DepositoryName2	,
			DepositoryID2	,
			BeneficialOwnerAccountNo2	,
			DepositoryName3	,
			DepositoryID3	,
			BeneficialOwnerAccountNo3	,
			CorporateIdentitynumber_CIN	,
			GrossAnnualIncomeRange	,
			GrossAnnualIncomeasonDate	,
			NetWorth_InRs	,
			NetWorthasonDate	,
			PoliticallyExposedPerson_PEP	,
			PlaceofIncorporation	,
			Occupation	,
			OccupationDetails_Forothers	,
			Dateofcommencementofbusiness	,
			CustodialParticipantCodeoftheclient	,
			RegistrationNoofClient	,
			RegisteringAuthority	,
			PlaceofRegistration	,
			DateofRegistration	,
			InpersonVerification	,
			ClientAgreementDate	,
			UniqueClientCodeallottedbyNSCCL_BSE	,
			UpdationFlag_for_SMS_and_Email_facility	,
			Relationship	,
			TypeofFacility_for_SMS_and_Email_facility	,
			ProofType	,
			ProofNumber	,
			IssuePlaceofProof	,
			IssueDateofProof	,
			ClientStatus	,
			Remarks	,
			ClientType_Corporate	,
			NameofcontactPerson_1	,
			DesignationofContactPerson_1	,
			PANofcontactPerson_1	,
			AddressofcontactPerson_1	,
			ContactdetailsofcontactPerson_1	,
			DINofcontactPerson_1	,
			UIDofcontactPerson_1	,
			EmailIdofcontactPerson_1	,
			NameofcontactPerson_2	,
			DesignationofcontactPerson_2	,
			PANofcontactPerson_2	,
			AddressofcontactPerson_2	,
			ContactdetailsofcontactPerson_2	,
			DINofcontactPerson_2	,
			UIDofcontactPerson_2	,
			EmailIdofcontactPerson_2	,
			NameofcontactPerson_3	,
			DesignationofcontactPerson_3	,
			PANofcontactPerson_3	,
			AddressofcontactPerson_3	,
			ContactdetailsofcontactPerson_3	,
			DINofcontactPerson_3	,
			UIDofcontactPerson_3	,
			EmailIdofcontactPerson_3	,
			NameofcontactPerson_4	,
			DesignationofcontactPerson_4	,
			PANofcontactPerson_4	,
			AddressofcontactPerson_4	,
			ContactdetailsofcontactPerson_4	,
			DINofcontactPerson_4	,
			UIDofcontactPerson_4	,
			EmailIdofcontactPerson_4	,
			NameofcontactPerson_5	,
			DesignationofcontactPerson_5	,
			PANofcontactPerson_5	,
			AddressofcontactPerson_5	,
			ContactdetailsofcontactPerson_5	,
			DINofcontactPerson_5	,
			UIDofcontactPerson_5	,
			EmailIdofcontactPerson_5	,
			NameofcontactPerson_6	,
			DesignationofcontactPerson_6	,
			PANofcontactPerson_6	,
			AddressofcontactPerson_6	,
			ContactdetailsofcontactPerson_6	,
			DINofcontactPerson_6	,
			UIDofcontactPerson_6	,
			EmailIdofcontactPerson_6	,
			NameofcontactPerson_7	,
			DesignationofcontactPerson_7	,
			PANofcontactPerson_7	,
			AddressofcontactPerson_7	,
			ContactdetailsofcontactPerson_7	,
			DINofcontactPerson_7	,
			UIDofcontactPerson_7	,
			EmailIdofcontactPerson_7	,
			NameofcontactPerson_8	,
			DesignationofcontactPerson_8	,
			PANofcontactPerson_8	,
			AddressofcontactPerson_8	,
			ContactdetailsofcontactPerson_8	,
			DINofcontactPerson_8	,
			UIDofcontactPerson_8	,
			EmailIdofcontactPerson_8	,
			NameofcontactPerson_9	,
			DesignationofcontactPerson_9	,
			PANofcontactPerson_9	,
			AddressofcontactPerson_9	,
			ContactdetailsofcontactPerson_9	,
			DINofcontactPerson_9	,
			UIDofcontactPerson_9	,
			EmailIdofcontactPerson_9	,
			NameofcontactPerson_10	,
			DesignationofcontactPerson_10	,
			PANofcontactPerson_10	,
			AddressofcontactPerson_10	,
			ContactdetailsofcontactPerson_10	,
			DINofcontactPerson_10	,
			UIDofcontactPerson_10	,
			EmailIdofcontactPerson_10	,
			NameofcontactPerson_11	,
			DesignationofcontactPerson_11	,
			PANofcontactPerson_11	,
			AddressofcontactPerson_11	,
			ContactdetailsofcontactPerson_11	,
			DINofcontactPerson_11	,
			UIDofcontactPerson_11	,
			EmailIdofcontactPerson_11	,
			NameofcontactPerson_12	,
			DesignationofcontactPerson_12	,
			PANofcontactPerson_12	,
			AddressofcontactPerson_12	,
			ContactdetailsofcontactPerson_12	,
			DINofcontactPerson_12	,
			UIDofcontactPerson_12	,
			EmailIdofcontactPerson_12	,
			NameofcontactPerson_13	,
			DesignationofcontactPerson_13	,
			PANofcontactPerson_13	,
			AddressofcontactPerson_13	,
			ContactdetailsofcontactPerson_13	,
			DINofcontactPerson_13	,
			UIDofcontactPerson_13	,
			EmailIdofcontactPerson_13	,
			NameofcontactPerson_14	,
			DesignationofcontactPerson_14	,
			PANofcontactPerson_14	,
			AddressofcontactPerson_14	,
			ContactdetailsofcontactPerson_14	,
			DINofcontactPerson_14	,
			UIDofcontactPerson_14	,
			EmailIdofcontactPerson_14	,
			NameofcontactPerson_15	,
			DesignationofcontactPerson_15	,
			PANofcontactPerson_15	,
			AddressofcontactPerson_15	,
			ContactdetailsofcontactPerson_15	,
			DINofcontactPerson_15	,
			UIDofcontactPerson_15	,
			EmailIdofcontactPerson_15	,
			NameofcontactPerson_16	,
			DesignationofcontactPerson_16	,
			PANofcontactPerson_16	,
			AddressofcontactPerson_16	,
			ContactdetailsofcontactPerson_16	,
			DINofcontactPerson_16	,
			UIDofcontactPerson_16	,
			EmailIdofcontactPerson_16	,
			NameofcontactPerson_17	,
			DesignationofcontactPerson_17	,
			PANofcontactPerson_17	,
			AddressofcontactPerson_17	,
			ContactdetailsofcontactPerson_17	,
			DINofcontactPerson_17	,
			UIDofcontactPerson_17	,
			EmailIdofcontactPerson_17	,
			NameofcontactPerson_18	,
			DesignationofcontactPerson_18	,
			PANofcontactPerson_18	,
			AddressofcontactPerson_18	,
			ContactdetailsofcontactPerson_18	,
			DINofcontactPerson_18	,
			UIDofcontactPerson_18	,
			EmailIdofcontactPerson_18	,
			NameofcontactPerson_19	,
			DesignationofcontactPerson_19	,
			PANofcontactPerson_19	,
			AddressofcontactPerson_19	,
			ContactdetailsofcontactPerson_19	,
			DINofcontactPerson_19	,
			UIDofcontactPerson_19	,
			EmailIdofcontactPerson_19	,
			NameofcontactPerson_20	,
			DesignationofcontactPerson_20	,
			PANofcontactPerson_20	,
			AddressofcontactPerson_20	,
			ContactdetailsofcontactPerson_20	,
			DINofcontactPerson_20	,
			UIDofcontactPerson_20	,
			EmailIdofcontactPerson_20	,
			POAforFunds ,
	        POAforSecurities, 
			Flag	
			)
	select
		segment = 'S',
		client_code = c2.party_code,
		client_name = left(c1_b.long_name, 150),
		category =cl_status,
		pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),
		Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */
		Fathers_Husbands_GuardiansName ='',
		Maritalstatus='',
		Nationality ='',
		Nationality_Other='', 
		ClientEmailId = left(email, 60),
		CorrespondenceClientAddressline1 = left(
			case
				when len(c1_b.l_address1) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address1, '')))
				end
			+
			case
				when len(c1_b.l_address2) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address2, '')))
				end
			+
			case
				when len(c1_b.l_address3) = 0
				then ''
				else ltrim(rtrim(isnull(c1_b.l_address3, '')))
				end, 255
			),

		CorrespondenceClientAddressline2 = '',
		CorrespondenceClientAddressline3 = '',
		CorrespondenceClientAddress_City = left(c1_b.l_city, 50),
		CorrespondenceClientAddress_State = c1_b.l_state,
		CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,
		CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),
		CorrespondenceClientAddress_Pincode = 
		case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
		else
			c1_b.l_zip
		end		,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,	
		/*Modify on 30 Apr 2014*/
		PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end, 
		PermanentClientAddressline2 ='',
		PermanentClientAddressline3 ='',			
		/*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
		PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
		PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/
		PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,
		PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
		PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,
		PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
		PermanentClientAddress_Pincode =
		case when c1_b.P_Len='N' then 
			case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then
				case
					when len(c1_b.l_zip) <> 6 then ''
					when len(c1_b.l_zip) = 0 then ''
					else c1_b.l_zip
				end
			else
				c1_b.l_zip
			end
		else ''				 
		end,
		ISDcode_Residence ='',
		STDcode_Residence =case 
							when len(STDcode_Residence1)>0 then STDcode_Residence1
							when len(STDcode_Residence2)>0 then STDcode_Residence2
						   else '' end,	
		TelephoneNumber_Residence = 
			left(	case 
						when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')
						when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')
					else 
						'' 
					end
				, 60
				),
		Mobilenumber =left(c1_b.mobile_pager, 10),
		ISDcode_Office ='',
		STDcode_Office =case 
							when len(STDcode_Office1)>0 then STDcode_Office1
							when len(STDcode_Office2)>0 then STDcode_Office2
						   else '' end,
		TelephoneNumber_Office=
			left(	case 
						when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')
						when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')
					else 
						'' 
					end
				, 60
				),
		DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,
		UIDNUMBER='',

	
		BankName1 =bank_name,
		BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end , 
		BankAccountNo1 =bank_account_no,
		BankAccountType1 =case 
							when bank_account_type = 'SAVING' then '10'
							when bank_account_type = 'CURRENT' then '11'
							when bank_account_type = 'OTHER' then '99' 
						  else ''
							end ,
		BankName2 ='',
		BankBranchAddress2 ='',
		BankAccountNo2 ='',
		BankAccountType2 ='',
		BankName3 ='',
		BankBranchAddress3 ='',
		BankAccountNo3 ='',
		BankAccountType3 ='',
		
		DepositoryName1 =dp_name,
		DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,
		BeneficialOwnerAccountNo1 =demat_id_of_client,
		
		DepositoryName2 ='',
		DepositoryID2 ='',
		BeneficialOwnerAccountNo2 ='',
		DepositoryName3 ='',
		DepositoryID3 ='',
		BeneficialOwnerAccountNo3 ='',
		CorporateIdentitynumber_CIN='',
		GrossAnnualIncomeRange ='',
		GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,
		NetWorth_InRs ='',
		NetWorthasonDate ='',
		PoliticallyExposedPerson_PEP='0', 
		PlaceofIncorporation ='',
		Occupation ='',
		OccupationDetails_Forothers='', 
		Dateofcommencementofbusiness ='',
		CustodialParticipantCodeoftheclient ='',
		RegistrationNoofClient ='',
		RegisteringAuthority ='',
		PlaceofRegistration ='',
		DateofRegistration ='',
		InpersonVerification ='Y',
		ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),
							/*Change on 26 Apr 2014: Changes for NSE SLB */
		UniqueClientCodeallottedbyNSCCL_BSE ='',
		UpdationFlag_for_SMS_and_Email_facility='', 
		Relationship ='',
		TypeofFacility_for_SMS_and_Email_facility ='',
		ProofType ='',
		ProofNumber ='',
		IssuePlaceofProof='', 
		IssueDateofProof ='',
		ClientStatus ='A',
		Remarks ='',
		ClientType_Corporate='', 
		NameofcontactPerson_1 ='',
		DesignationofContactPerson_1 ='',
		PANofcontactPerson_1 ='',
		AddressofcontactPerson_1 ='',
		ContactdetailsofcontactPerson_1 ='',
		DINofcontactPerson_1 ='',
		UIDofcontactPerson_1 ='',
		EmailIdofcontactPerson_1 ='',
		NameofcontactPerson_2  ='',
		DesignationofcontactPerson_2 ='',
		PANofcontactPerson_2 ='',
		AddressofcontactPerson_2 ='',
		ContactdetailsofcontactPerson_2='', 
		DINofcontactPerson_2 ='',
		UIDofcontactPerson_2 ='',
		EmailIdofcontactPerson_2 ='',
		NameofcontactPerson_3 ='',
		DesignationofcontactPerson_3='', 
		PANofcontactPerson_3 ='',
		AddressofcontactPerson_3 ='',
		ContactdetailsofcontactPerson_3='', 
		DINofcontactPerson_3 ='',
		UIDofcontactPerson_3 ='',
		EmailIdofcontactPerson_3 ='',
		NameofcontactPerson_4 ='',
		DesignationofcontactPerson_4='', 
		PANofcontactPerson_4 ='',
		AddressofcontactPerson_4 ='',
		ContactdetailsofcontactPerson_4 ='',
		DINofcontactPerson_4 ='',
		UIDofcontactPerson_4 ='',
		EmailIdofcontactPerson_4 ='',
		NameofcontactPerson_5 ='',
		DesignationofcontactPerson_5 ='',
		PANofcontactPerson_5 ='',
		AddressofcontactPerson_5 ='',
		ContactdetailsofcontactPerson_5='', 
		DINofcontactPerson_5 ='',
		UIDofcontactPerson_5 ='',
		EmailIdofcontactPerson_5 ='',
		NameofcontactPerson_6 ='',
		DesignationofcontactPerson_6='', 
		PANofcontactPerson_6 ='',
		AddressofcontactPerson_6 ='',
		ContactdetailsofcontactPerson_6='', 
		DINofcontactPerson_6 ='',
		UIDofcontactPerson_6 ='',
		EmailIdofcontactPerson_6 ='',
		NameofcontactPerson_7 ='',
		DesignationofcontactPerson_7='', 
		PANofcontactPerson_7 ='',
		AddressofcontactPerson_7 ='',
		ContactdetailsofcontactPerson_7='', 
		DINofcontactPerson_7 ='',
		UIDofcontactPerson_7 ='',
		EmailIdofcontactPerson_7 ='',
		NameofcontactPerson_8 ='',
		DesignationofcontactPerson_8 ='',
		PANofcontactPerson_8 ='',
		AddressofcontactPerson_8 ='',
		ContactdetailsofcontactPerson_8 ='',
		DINofcontactPerson_8 ='',
		UIDofcontactPerson_8 ='',
		EmailIdofcontactPerson_8 ='',
		NameofcontactPerson_9 ='',
		DesignationofcontactPerson_9='', 
		PANofcontactPerson_9 ='',
		AddressofcontactPerson_9 ='',
		ContactdetailsofcontactPerson_9='', 
		DINofcontactPerson_9 ='',
		UIDofcontactPerson_9 ='',
		EmailIdofcontactPerson_9 ='',
		NameofcontactPerson_10 ='',
		DesignationofcontactPerson_10='', 
		PANofcontactPerson_10 ='',
		AddressofcontactPerson_10 ='',
		ContactdetailsofcontactPerson_10='', 
		DINofcontactPerson_10 ='',
		UIDofcontactPerson_10 ='',
		EmailIdofcontactPerson_10 ='',
		NameofcontactPerson_11 ='',
		DesignationofcontactPerson_11='', 
		PANofcontactPerson_11 ='',
		AddressofcontactPerson_11 ='',
		ContactdetailsofcontactPerson_11='', 
		DINofcontactPerson_11 ='',
		UIDofcontactPerson_11 ='',
		EmailIdofcontactPerson_11 ='',
		NameofcontactPerson_12 ='',
		DesignationofcontactPerson_12='', 
		PANofcontactPerson_12 ='',
		AddressofcontactPerson_12 ='',
		ContactdetailsofcontactPerson_12='', 
		DINofcontactPerson_12 ='',
		UIDofcontactPerson_12 ='',
		EmailIdofcontactPerson_12 ='',
		NameofcontactPerson_13 ='',
		DesignationofcontactPerson_13 ='',
		PANofcontactPerson_13 ='',
		AddressofcontactPerson_13 ='',
		ContactdetailsofcontactPerson_13 ='',
		DINofcontactPerson_13 ='',
		UIDofcontactPerson_13 ='',
		EmailIdofcontactPerson_13 ='',
		NameofcontactPerson_14 ='',
		DesignationofcontactPerson_14 ='',
		PANofcontactPerson_14 ='',
		AddressofcontactPerson_14 ='',
		ContactdetailsofcontactPerson_14 ='',
		DINofcontactPerson_14 ='',
		UIDofcontactPerson_14 ='',
		EmailIdofcontactPerson_14 ='',
		NameofcontactPerson_15 ='',
		DesignationofcontactPerson_15 ='',
		PANofcontactPerson_15 ='',
		AddressofcontactPerson_15 ='',
		ContactdetailsofcontactPerson_15='', 
		DINofcontactPerson_15 ='',
		UIDofcontactPerson_15 ='',
		EmailIdofcontactPerson_15 ='',
		NameofcontactPerson_16 ='',
		DesignationofcontactPerson_16='', 
		PANofcontactPerson_16 ='',
		AddressofcontactPerson_16 ='',
		ContactdetailsofcontactPerson_16='', 
		DINofcontactPerson_16 ='',
		UIDofcontactPerson_16 ='',
		EmailIdofcontactPerson_16 ='',
		NameofcontactPerson_17 ='',
		DesignationofcontactPerson_17='', 
		PANofcontactPerson_17 ='',
		AddressofcontactPerson_17 ='',
		ContactdetailsofcontactPerson_17='', 
		DINofcontactPerson_17 ='',
		UIDofcontactPerson_17 ='',
		EmailIdofcontactPerson_17 ='',
		NameofcontactPerson_18 ='',
		DesignationofcontactPerson_18='', 
		PANofcontactPerson_18 ='',
		AddressofcontactPerson_18 ='',
		ContactdetailsofcontactPerson_18='', 
		DINofcontactPerson_18 ='',
		UIDofcontactPerson_18 ='',
		EmailIdofcontactPerson_18 ='',
		NameofcontactPerson_19 ='',
		DesignationofcontactPerson_19='', 
		PANofcontactPerson_19 ='',
		AddressofcontactPerson_19 ='',
		ContactdetailsofcontactPerson_19='', 
		DINofcontactPerson_19 ='',
		UIDofcontactPerson_19 ='',
		EmailIdofcontactPerson_19 ='',
		NameofcontactPerson_20 ='',
		DesignationofcontactPerson_20='', 
		PANofcontactPerson_20 ='',
		AddressofcontactPerson_20 ='',
		ContactdetailsofcontactPerson_20='', 
		DINofcontactPerson_20 ='',
		UIDofcontactPerson_20 ='',
		EmailIdofcontactPerson_20 ='',
		POAforFunds ='N',
	    POAforSecurities='N', 
		Flag='E'
	from
		(
			select
				c1.*,
				b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_Client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
		#temp_Client2 c2 with (nolock),
		#temp_Client5 c5 with (nolock)

	where
		ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and
		ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and
		ltrim(rtrim(left(c2.party_code,2))) <> '98'
		

	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),
	    --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/
	    --MASTERPAN=ISNULL(c1.MASTERPAN,''),
	    TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),
		--Gender=isnull(c1.Gender,''),
		Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=
					case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		GrossAnnualIncomeRange=case 
					when c1.Gross_Income ='01' then '1'
					when c1.Gross_Income ='02' then '2'
					when c1.Gross_Income ='03' then '3'
					when c1.Gross_Income ='04' then '4'
					when c1.Gross_Income ='05' then '5'
					when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/
					when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/
					else '' end, 
		NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''
						else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,
		PoliticallyExposedPerson_PEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end,
		OccupationDetails_Forothers=isnull(Occupation_Other,''),
		--UIDNUMBER=isnull(c1.AADHAR_UID,'')
		UIDNUMBER=replace(isnull(rtrim(ltrim(c1.AADHAR_UID)),''),' ','')
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0			
	
	update 
		#mimansa_angel_ucc_nse_slb_client_data_new_changes 
	set 
		GrossAnnualIncomeasonDate='',
		NetWorth_InRs='',
		NetWorthasonDate=''
	where len(GrossAnnualIncomeRange)=0 

	
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
		#mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),
		ClientType_Corporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		client_code = party_code
		and len(isnull(client_code, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4	

	/****ADDRESS 1****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_1=c1.contact_name,
	DesignationofContactPerson_1=c1.designation,
	PANofcontactPerson_1=c1.PanNo,
	AddressofcontactPerson_1=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_1=c1.DIN,
	UIDofcontactPerson_1=c1.UID,
	EmailIdofcontactPerson_1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='1'

	/****ADDRESS 2****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_2=c1.contact_name,
	DesignationofContactPerson_2=c1.designation,
	PANofcontactPerson_2=c1.PanNo,
	AddressofcontactPerson_2=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_2=c1.DIN,
	UIDofcontactPerson_2=c1.UID,
	EmailIdofcontactPerson_2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='2'

	/****ADDRESS 3****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_3=c1.contact_name,
	DesignationofContactPerson_3=c1.designation,
	PANofcontactPerson_3=c1.PanNo,
	AddressofcontactPerson_3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_3=c1.DIN,
	UIDofcontactPerson_3=c1.UID,
	EmailIdofcontactPerson_3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='3'

	/****ADDRESS 4****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_4=c1.contact_name,
	DesignationofContactPerson_4=c1.designation,
	PANofcontactPerson_4=c1.PanNo,
	AddressofcontactPerson_4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_4=c1.DIN,
	UIDofcontactPerson_4=c1.UID,
	EmailIdofcontactPerson_4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_5=c1.contact_name,
	DesignationofContactPerson_5=c1.designation,
	PANofcontactPerson_5=c1.PanNo,
	AddressofcontactPerson_5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_5=c1.DIN,
	UIDofcontactPerson_5=c1.UID,
	EmailIdofcontactPerson_5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_6=c1.contact_name,
	DesignationofContactPerson_6=c1.designation,
	PANofcontactPerson_6=c1.PanNo,
	AddressofcontactPerson_6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_6=c1.DIN,
	UIDofcontactPerson_6=c1.UID,
	EmailIdofcontactPerson_6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_7=c1.contact_name,
	DesignationofContactPerson_7=c1.designation,
	PANofcontactPerson_7=c1.PanNo,
	AddressofcontactPerson_7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_7=c1.DIN,
	UIDofcontactPerson_7=c1.UID,
	EmailIdofcontactPerson_7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_8=c1.contact_name,
	DesignationofContactPerson_8=c1.designation,
	PANofcontactPerson_8=c1.PanNo,
	AddressofcontactPerson_8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_8=c1.DIN,
	UIDofcontactPerson_8=c1.UID,
	EmailIdofcontactPerson_8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_9=c1.contact_name,
	DesignationofContactPerson_9=c1.designation,
	PANofcontactPerson_9=c1.PanNo,
	AddressofcontactPerson_9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_9=c1.DIN,
	UIDofcontactPerson_9=c1.UID,
	EmailIdofcontactPerson_9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_angel_ucc_nse_slb_client_data_new_changes
	set
	NameofcontactPerson_10=c1.contact_name,
	DesignationofContactPerson_10=c1.designation,
	PANofcontactPerson_10=c1.PanNo,
	AddressofcontactPerson_10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofcontactPerson_10=c1.DIN,
	UIDofcontactPerson_10=c1.UID,
	EmailIdofcontactPerson_10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		Client_Code = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')
		and line_no='10'



		/*Update POA*/
		--Update 
		--    #mimansa_angel_ucc_nse_slb_client_data_new_changes
		--  set 		  
	 --     POAforSecurities=
		--  case 
		--		when ltrim(rtrim(Def))=1 then 'Y'  
		--		when ltrim(rtrim(Def))=0 then 'N' 				
		--		else  '' 
		--	end
		--  from
		--   anand1.msajag.dbo.Multicltid m with(nolock)
	 --     where
		--Client_Code = m.Party_code

	
	/*INVALID PAN*/

	

	select distinct
		client_code = ltrim(rtrim(client_code)),
		client_name = ltrim(rtrim(client_name)),
		pan = ltrim(rtrim(pan))
		--pan,
		--pan_err = 
		--	case 
		--		when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'
		--		then 'NO PAN'
		--		when len(ltrim(rtrim(isnull(pan, '')))) = 0
		--		then 'NO PAN'
		--		when not (
		--			isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and
		--			isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and
		--			isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and
		--			len(ltrim(rtrim(isnull(pan, '')))) = 10
		--		)
		--		then 'INVALID PAN'
		--	end,

		--pan_length = len(ltrim(rtrim(isnull(pan, '')))),
		--telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),
		--client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))
into #invalidpan
	from
		--mimansa_angel_ucc_nse_fo_client_data with(nolock)
		mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
	where
		ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'

	

	
delete
	#mimansa_angel_ucc_nse_slb_client_data_new_changes
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp 
where
	ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10

/***************FINAL DISPLAY*******************/
select distinct
		Segment, 
		Client_Code=ltrim(RTRIM(Client_Code)), 
		Client_Name ,
		Category ,
		PAN ,
		Gender, 
		Fathers_Husbands_GuardiansName ,
		Maritalstatus ,
		Nationality ,
		Nationality_Other, 
		ClientEmailId ,
		CorrespondenceClientAddressline1 ,
		CorrespondenceClientAddressline2 ,
		CorrespondenceClientAddressline3 ,
		CorrespondenceClientAddress_City ,
		CorrespondenceClientAddress_State ,
		CorrespondenceClientAddress_State_Others, 
		CorrespondenceClientAddress_Country ,
		CorrespondenceClientAddress_Pincode ,
		FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,
		PermanentClientAddressline1 ,
		PermanentClientAddressline2 ,
		PermanentClientAddressline3 ,
		PermanentClientAddress_City ,
		PermanentClientAddress_State ,
		PermanentClientAddress_StateOthers  ,
		PermanentClientAddress_Country ,
		PermanentClientAddress_Pincode ,
		ISDcode_Residence ,
		STDcode_Residence ,
		TelephoneNumber_Residence ,
		Mobilenumber ,
		ISDcode_Office, 
		STDcode_Office ,
		TelephoneNumber_Office ,
		DateofBirth_Incorporation ,
		UIDNUMBER ,
		BankName1 ,
		BankBranchAddress1 ,
		BankAccountNo1 ,
		BankAccountType1 ,
		BankName2 ,
		BankBranchAddress2 ,
		BankAccountNo2 ,
		BankAccountType2 ,
		BankName3 ,
		BankBranchAddress3 ,
		BankAccountNo3 ,
		BankAccountType3, 
		DepositoryName1 ,
		DepositoryID1 ,
		BeneficialOwnerAccountNo1 ,
		DepositoryName2 ,
		DepositoryID2 ,
		BeneficialOwnerAccountNo2 ,
		DepositoryName3 ,
		DepositoryID3 ,
		BeneficialOwnerAccountNo3 ,
		CorporateIdentitynumber_CIN, 
		GrossAnnualIncomeRange ,
		GrossAnnualIncomeasonDate, 
		NetWorth_InRs ,
		NetWorthasonDate, 
		PoliticallyExposedPerson_PEP ,
		PlaceofIncorporation ,
		Occupation ,
		OccupationDetails_Forothers ,
		Dateofcommencementofbusiness ,
		CustodialParticipantCodeoftheclient ,
		RegistrationNoofClient ,
		RegisteringAuthority ,
		PlaceofRegistration ,
		DateofRegistration ,
		InpersonVerification, 
		ClientAgreementDate ,
		UniqueClientCodeallottedbyNSCCL_BSE ,
		UpdationFlag_for_SMS_and_Email_facility ,
		Relationship ,
		TypeofFacility_for_SMS_and_Email_facility ,
		ProofType ,
		ProofNumber ,
		IssuePlaceofProof ,
		IssueDateofProof ,
		ClientStatus ,
		Remarks ,
		ClientType_Corporate, 
		NameofcontactPerson_1 ,
		DesignationofContactPerson_1 ,
		PANofcontactPerson_1 ,
		AddressofcontactPerson_1 ,
		ContactdetailsofcontactPerson_1 ,
		DINofcontactPerson_1 ,
		UIDofcontactPerson_1 ,
		EmailIdofcontactPerson_1 ,
		NameofcontactPerson_2  ,
		DesignationofcontactPerson_2 ,
		PANofcontactPerson_2 ,
		AddressofcontactPerson_2 ,
		ContactdetailsofcontactPerson_2, 
		DINofcontactPerson_2 ,
		UIDofcontactPerson_2 ,
		EmailIdofcontactPerson_2 ,
		NameofcontactPerson_3 ,
		DesignationofcontactPerson_3, 
		PANofcontactPerson_3 ,
		AddressofcontactPerson_3 ,
		ContactdetailsofcontactPerson_3, 
		DINofcontactPerson_3 ,
		UIDofcontactPerson_3 ,
		EmailIdofcontactPerson_3 ,
		NameofcontactPerson_4 ,
		DesignationofcontactPerson_4, 
		PANofcontactPerson_4 ,
		AddressofcontactPerson_4 ,
		ContactdetailsofcontactPerson_4 ,
		DINofcontactPerson_4 ,
		UIDofcontactPerson_4 ,
		EmailIdofcontactPerson_4 ,
		NameofcontactPerson_5 ,
		DesignationofcontactPerson_5 ,
		PANofcontactPerson_5 ,
		AddressofcontactPerson_5 ,
		ContactdetailsofcontactPerson_5, 
		DINofcontactPerson_5 ,
		UIDofcontactPerson_5 ,
		EmailIdofcontactPerson_5 ,
		NameofcontactPerson_6 ,
		DesignationofcontactPerson_6, 
		PANofcontactPerson_6 ,
		AddressofcontactPerson_6 ,
		ContactdetailsofcontactPerson_6, 
		DINofcontactPerson_6 ,
		UIDofcontactPerson_6 ,
		EmailIdofcontactPerson_6 ,
		NameofcontactPerson_7 ,
		DesignationofcontactPerson_7, 
		PANofcontactPerson_7 ,
		AddressofcontactPerson_7 ,
		ContactdetailsofcontactPerson_7, 
		DINofcontactPerson_7 ,
		UIDofcontactPerson_7 ,
		EmailIdofcontactPerson_7 ,
		NameofcontactPerson_8 ,
		DesignationofcontactPerson_8 ,
		PANofcontactPerson_8 ,
		AddressofcontactPerson_8 ,
		ContactdetailsofcontactPerson_8 ,
		DINofcontactPerson_8 ,
		UIDofcontactPerson_8 ,
		EmailIdofcontactPerson_8 ,
		NameofcontactPerson_9 ,
		DesignationofcontactPerson_9, 
		PANofcontactPerson_9 ,
		AddressofcontactPerson_9 ,
		ContactdetailsofcontactPerson_9, 
		DINofcontactPerson_9 ,
		UIDofcontactPerson_9 ,
		EmailIdofcontactPerson_9 ,
		NameofcontactPerson_10 ,
		DesignationofcontactPerson_10, 
		PANofcontactPerson_10 ,
		AddressofcontactPerson_10 ,
		ContactdetailsofcontactPerson_10, 
		DINofcontactPerson_10 ,
		UIDofcontactPerson_10 ,
		EmailIdofcontactPerson_10 ,
		NameofcontactPerson_11 ,
		DesignationofcontactPerson_11, 
		PANofcontactPerson_11 ,
		AddressofcontactPerson_11 ,
		ContactdetailsofcontactPerson_11, 
		DINofcontactPerson_11 ,
		UIDofcontactPerson_11 ,
		EmailIdofcontactPerson_11 ,
		NameofcontactPerson_12 ,
		DesignationofcontactPerson_12, 
		PANofcontactPerson_12 ,
		AddressofcontactPerson_12 ,
		ContactdetailsofcontactPerson_12, 
		DINofcontactPerson_12 ,
		UIDofcontactPerson_12 ,
		EmailIdofcontactPerson_12 ,
		NameofcontactPerson_13 ,
		DesignationofcontactPerson_13 ,
		PANofcontactPerson_13 ,
		AddressofcontactPerson_13 ,
		ContactdetailsofcontactPerson_13 ,
		DINofcontactPerson_13 ,
		UIDofcontactPerson_13 ,
		EmailIdofcontactPerson_13 ,
		NameofcontactPerson_14 ,
		DesignationofcontactPerson_14 ,
		PANofcontactPerson_14 ,
		AddressofcontactPerson_14 ,
		ContactdetailsofcontactPerson_14 ,
		DINofcontactPerson_14 ,
		UIDofcontactPerson_14 ,
		EmailIdofcontactPerson_14 ,
		NameofcontactPerson_15 ,
		DesignationofcontactPerson_15 ,
		PANofcontactPerson_15 ,
		AddressofcontactPerson_15 ,
		ContactdetailsofcontactPerson_15, 
		DINofcontactPerson_15 ,
		UIDofcontactPerson_15 ,
		EmailIdofcontactPerson_15 ,
		NameofcontactPerson_16 ,
		DesignationofcontactPerson_16, 
		PANofcontactPerson_16 ,
		AddressofcontactPerson_16 ,
		ContactdetailsofcontactPerson_16, 
		DINofcontactPerson_16 ,
		UIDofcontactPerson_16 ,
		EmailIdofcontactPerson_16 ,
		NameofcontactPerson_17 ,
		DesignationofcontactPerson_17, 
		PANofcontactPerson_17 ,
		AddressofcontactPerson_17 ,
		ContactdetailsofcontactPerson_17, 
		DINofcontactPerson_17 ,
		UIDofcontactPerson_17 ,
		EmailIdofcontactPerson_17 ,
		NameofcontactPerson_18 ,
		DesignationofcontactPerson_18, 
		PANofcontactPerson_18 ,
		AddressofcontactPerson_18 ,
		ContactdetailsofcontactPerson_18, 
		DINofcontactPerson_18 ,
		UIDofcontactPerson_18 ,
		EmailIdofcontactPerson_18 ,
		NameofcontactPerson_19 ,
		DesignationofcontactPerson_19, 
		PANofcontactPerson_19 ,
		AddressofcontactPerson_19 ,
		ContactdetailsofcontactPerson_19, 
		DINofcontactPerson_19 ,
		UIDofcontactPerson_19 ,
		EmailIdofcontactPerson_19 ,
		NameofcontactPerson_20 ,
		DesignationofcontactPerson_20, 
		PANofcontactPerson_20 ,
		AddressofcontactPerson_20 ,
		ContactdetailsofcontactPerson_20, 
		DINofcontactPerson_20 ,
		UIDofcontactPerson_20 ,
		EmailIdofcontactPerson_20 ,
		POAforFunds ='N',
	    POAforSecurities='N', 
		Flag='E'
from
	#mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)
 
where
	len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'





	/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)	
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and
	isnull(pan, '' ) <> 'NA'

/*Insert Log*/
if exists(select * from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))
begin
	if(@totalrecord>0)
	begin
		update [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count 
		set file_number=file_number+1
		where time_stamp>=cast(left(getdate(),11) as datetime)
	end
end
else
begin
	if(@totalrecord>0)
	begin
		insert into [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)
		select 1,getdate()
	end
end
	
/*Display File Name and First Row
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)
				Ex- uci_20140225.t04
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count 
				Ex- 10|M|12798|27022014|04|220
*/

select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')
				+'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),					
	   FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'
				+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'
				+cast(@totalrecord  as varchar) 
from [196.1.115.200].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)


/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_DateRangeWise
-- --------------------------------------------------
  
-- [mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015] 'Feb 10 2015','Feb 10 2015','',''    
CREATE proc    [dbo].[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_DateRangeWise]    
 (    
 @from_date varchar(20),    
 @to_date varchar(20),    
 @ClientCode varchar(20)    
 --@selected_clients_only char(1),    
     
 )    
as    
--mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_DateRangeWise 'Feb 10 2014','Feb 10 2014','',''    
 /*Parameter Vertualization*/    
 Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,    
   @@FromClientCode varchar(20),@@ToClientCode varchar(20)    
    
/*Initialized Parameters*/    
 if isnull(@from_date,'')='' or isnull(@to_date,'')=''    
 begin    
  set @@FromDate='Jan  1 1900'    
  set @@ToDate='Dec 31 2078'    
 end    
 else    
 begin    
  set @@FromDate=@from_date    
  set @@ToDate=@to_date+' 23:59'    
 end    
    
 if isnull(@ClientCode,'')=''    
 begin    
  set @@FromClientCode='A'    
  set @@ToClientCode='ZZZZZZZZZZ'    
 end    
 else    
 begin    
  set @@FromClientCode=@ClientCode    
  set @@ToClientCode=@ClientCode    
 end    
    
 set @@getdate=left(getdate(),11)+' 23:59'    
    
     create table #TempTable1    
  (Client_Code varchar(20),    
  Client_Name varchar(100),    
  Pan_No varchar(20),    
  Client_Type varchar(100),    
  App_Form_No varchar(20),    
  Com_Form_No varchar(20),    
  Mod_Form_No varchar(20),    
  Bo_Category varchar(20),    
  Bo_ClientType varchar(20),    
  branch varchar(30),    
  subbroker varchar(20),    
  process_status varchar(200),    
  document_Type varchar(20),    
  Initiated_Date varchar(20),    
  Modified_date varchar(20),    
  Ho_Recd_Dt varchar(20),    
  verf_dt varchar(20),    
  Verf_name varchar(30),    
  Aud_Obj_DT varchar(20),    
  Aud_Obj_Name varchar(30),    
  Aud_DT varchar(20),    
  Aud_Name varchar(30),    
  CRN_No varchar(20),    
  Dp_Batch_No varchar(20),    
  Modification_type varchar(100),    
  Request_Type varchar(20),    
  DP_ID varchar(100))    
    
 --declare @totalrecord as numeric    
    insert into #TempTable1    
       exec ABVSCITRUS.CRMDB_A.dbo.pr_clientlisting_mod @@FromDate,@@ToDate,'0',3,'HO','HO'    
    declare @@FromDate1 datetime    
       set @@FromDate1=convert(datetime,@@FromDate)    
    declare @@ToDate1 datetime    
       set @@ToDate1=convert(datetime,@@ToDate)    
       select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0    
    
  insert into #codes_to_process    
  select distinct party_code = ltrim(rtrim(isnull(c5.cl_code, '')))    
  from anand1.msajag.dbo.CLIENT_M_CI c1 with(nolock), NSESLBS.dbo.client5 c5 with(nolock)    
  where c5.cl_code=c1.cl_code    
    and c1.cl_code>=@@FromClientCode    
    and c1.cl_code<=@@ToClientCode    
    and c1.UPDTIME >= @@FromDate    
    and c1.UPDTIME <= @@ToDate     
    and c5.InactiveFrom>@@getdate     
    
  union    
  select distinct cl_code = ltrim(rtrim(isnull(c1.client_code, '')))    
  from #TempTable1 c1  with(nolock),NSESLBS.dbo.client5 c5 with(nolock)    
  where (c1.Modification_type like 'MOBILE%' or c1.Modification_type like 'Email%')     
          and c5.cl_code=c1.client_code    
          and c1.client_code>=@@FromClientCode    
    and c1.client_code<=@@ToClientCode    
    and left(convert(varchar(30), c1.Modified_Date,109),10) >=convert(varchar,@@FromDate1,103)    
    and left(convert(varchar(30), c1.Modified_Date,109),10) <=convert(varchar,@@ToDate1,103)    
    and c5.InactiveFrom>@@getdate    
     
    
CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(    
 [Segment] [varchar](1) NULL,    
 [Client_Code] [varchar](10) NULL,    
 [Client_Name] [varchar](150) NULL,    
 [Category] [varchar](10) NULL,    
 [PAN] [varchar](10) NULL,    
 [Gender] [varchar](2) NULL,    
 [Fathers_Husbands_GuardiansName] [varchar](150) NULL,    
 [Maritalstatus] [varchar](2) NULL,    
 [Nationality] [varchar](2) NULL,    
 [Nationality_Other] [varchar](50) NULL,    
 [ClientEmailId] [varchar](60) NULL,    
 [CorrespondenceClientAddressline1] [varchar](255) NULL,    
 [CorrespondenceClientAddressline2] [varchar](255) NULL,    
 [CorrespondenceClientAddressline3] [varchar](255) NULL,    
 [CorrespondenceClientAddress_City] [varchar](50) NULL,    
 [CorrespondenceClientAddress_State] [varchar](2) NULL,    
 [CorrespondenceClientAddress_State_Others] [varchar](75) NULL,    
 [CorrespondenceClientAddress_Country] [varchar](3) NULL,    
 [CorrespondenceClientAddress_Pincode] [varchar](10) NULL,    
 [FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,    
 [PermanentClientAddressline1] [varchar](255) NULL,    
 [PermanentClientAddressline2] [varchar](255) NULL,    
 [PermanentClientAddressline3] [varchar](255) NULL,    
 [PermanentClientAddress_City] [varchar](50) NULL,    
 [PermanentClientAddress_State] [varchar](2) NULL,    
 [PermanentClientAddress_StateOthers] [varchar](75) NULL,    
 [PermanentClientAddress_Country] [varchar](2) NULL,    
 [PermanentClientAddress_Pincode] [varchar](10) NULL,    
 [ISDcode_Residence] [varchar](10) NULL,    
 [STDcode_Residence] [varchar](10) NULL,    
 [TelephoneNumber_Residence] [varchar](60) NULL,    
 [Mobilenumber] [varchar](20) NULL,    
 [ISDcode_Office] [varchar](10) NULL,    
 [STDcode_Office] [varchar](10) NULL,    
 [TelephoneNumber_Office] [varchar](60) NULL,    
 [DateofBirth_Incorporation] [varchar](60) NULL,    
 [UIDNUMBER] [varchar](12) NULL,    
 [BankName1] [varchar](60) NULL,    
 [BankBranchAddress1] [varchar](255) NULL,    
 [BankAccountNo1] [varchar](25) NULL,    
 [BankAccountType1] [varchar](2) NULL,    
 [BankName2] [varchar](60) NULL,    
 [BankBranchAddress2] [varchar](255) NULL,    
 [BankAccountNo2] [varchar](25) NULL,    
 [BankAccountType2] [varchar](2) NULL,    
 [BankName3] [varchar](60) NULL,    
 [BankBranchAddress3] [varchar](255) NULL,    
 [BankAccountNo3] [varchar](25) NULL,    
 [BankAccountType3] [varchar](2) NULL,    
 [DepositoryName1] [varchar](4) NULL,    
 [DepositoryID1] [varchar](8) NULL,    
 [BeneficialOwnerAccountNo1] [varchar](16) NULL,    
 [DepositoryName2] [varchar](4) NULL,    
 [DepositoryID2] [varchar](8) NULL,    
 [BeneficialOwnerAccountNo2] [varchar](16) NULL,    
 [DepositoryName3] [varchar](4) NULL,    
 [DepositoryID3] [varchar](8) NULL,    
 [BeneficialOwnerAccountNo3] [varchar](16) NULL,    
 [CorporateIdentitynumber_CIN] [varchar](21) NULL,    
 [GrossAnnualIncomeRange] [varchar](40) NULL,    
 [GrossAnnualIncomeasonDate] [varchar](40) NULL,    
 [NetWorth_InRs] [varchar](40) NULL,    
 [NetWorthasonDate] [varchar](40) NULL,    
 [PoliticallyExposedPerson_PEP] [varchar](2) NULL,    
 [PlaceofIncorporation] [varchar](75) NULL,    
 [Occupation] [varchar](2) NULL,    
 [OccupationDetails_Forothers] [varchar](75) NULL,    
 [Dateofcommencementofbusiness] [varchar](40) NULL,    
 [CustodialParticipantCodeoftheclient] [varchar](15) NULL,    
 [RegistrationNoofClient] [varchar](25) NULL,    
 [RegisteringAuthority] [varchar](60) NULL,    
 [PlaceofRegistration] [varchar](25) NULL,    
 [DateofRegistration] [varchar](40) NULL,    
 [InpersonVerification] [varchar](1) NULL,    
 [ClientAgreementDate] [varchar](40) NULL,    
 [UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,    
 [UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,    
 [Relationship] [varchar](1) NULL,    
 [TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,    
 [ProofType] [varchar](1) NULL,    
 [ProofNumber] [varchar](25) NULL,    
 [IssuePlaceofProof] [varchar](100) NULL,    
 [IssueDateofProof] [varchar](40) NULL,    
 [ClientStatus] [varchar](1) NULL,    
 [Remarks] [varchar](200) NULL,    
 [ClientType_Corporate] [varchar](200) NULL,    
 [NameofcontactPerson_1] [varchar](200) NULL,    
 [DesignationofContactPerson_1] [varchar](200) NULL,    
 [PANofcontactPerson_1] [varchar](200) NULL,    
 [AddressofcontactPerson_1] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_1] [varchar](200) NULL,    
 [DINofcontactPerson_1] [varchar](200) NULL,    
 [UIDofcontactPerson_1] [varchar](200) NULL,    
 [EmailIdofcontactPerson_1] [varchar](200) NULL,    
 [NameofcontactPerson_2] [varchar](200) NULL,    
 [DesignationofcontactPerson_2] [varchar](200) NULL,    
 [PANofcontactPerson_2] [varchar](200) NULL,    
 [AddressofcontactPerson_2] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_2] [varchar](200) NULL,    
 [DINofcontactPerson_2] [varchar](200) NULL,    
 [UIDofcontactPerson_2] [varchar](200) NULL,    
 [EmailIdofcontactPerson_2] [varchar](200) NULL,    
 [NameofcontactPerson_3] [varchar](200) NULL,    
 [DesignationofcontactPerson_3] [varchar](200) NULL,    
 [PANofcontactPerson_3] [varchar](200) NULL,    
 [AddressofcontactPerson_3] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_3] [varchar](200) NULL,    
 [DINofcontactPerson_3] [varchar](200) NULL,    
 [UIDofcontactPerson_3] [varchar](200) NULL,    
 [EmailIdofcontactPerson_3] [varchar](200) NULL,    
 [NameofcontactPerson_4] [varchar](200) NULL,    
 [DesignationofcontactPerson_4] [varchar](200) NULL,    
 [PANofcontactPerson_4] [varchar](200) NULL,    
 [AddressofcontactPerson_4] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_4] [varchar](200) NULL,    
 [DINofcontactPerson_4] [varchar](200) NULL,    
 [UIDofcontactPerson_4] [varchar](200) NULL,    
 [EmailIdofcontactPerson_4] [varchar](200) NULL,    
 [NameofcontactPerson_5] [varchar](200) NULL,    
 [DesignationofcontactPerson_5] [varchar](200) NULL,    
 [PANofcontactPerson_5] [varchar](200) NULL,    
 [AddressofcontactPerson_5] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_5] [varchar](200) NULL,    
 [DINofcontactPerson_5] [varchar](200) NULL,    
 [UIDofcontactPerson_5] [varchar](200) NULL,    
 [EmailIdofcontactPerson_5] [varchar](200) NULL,    
 [NameofcontactPerson_6] [varchar](200) NULL,    
 [DesignationofcontactPerson_6] [varchar](200) NULL,    
 [PANofcontactPerson_6] [varchar](200) NULL,    
 [AddressofcontactPerson_6] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_6] [varchar](200) NULL,    
 [DINofcontactPerson_6] [varchar](200) NULL,    
 [UIDofcontactPerson_6] [varchar](200) NULL,    
 [EmailIdofcontactPerson_6] [varchar](200) NULL,    
 [NameofcontactPerson_7] [varchar](200) NULL,    
 [DesignationofcontactPerson_7] [varchar](200) NULL,    
 [PANofcontactPerson_7] [varchar](200) NULL,    
 [AddressofcontactPerson_7] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_7] [varchar](200) NULL,    
 [DINofcontactPerson_7] [varchar](200) NULL,    
 [UIDofcontactPerson_7] [varchar](200) NULL,    
 [EmailIdofcontactPerson_7] [varchar](200) NULL,    
 [NameofcontactPerson_8] [varchar](200) NULL,    
 [DesignationofcontactPerson_8] [varchar](200) NULL,    
 [PANofcontactPerson_8] [varchar](200) NULL,    
 [AddressofcontactPerson_8] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_8] [varchar](200) NULL,    
 [DINofcontactPerson_8] [varchar](200) NULL,    
 [UIDofcontactPerson_8] [varchar](200) NULL,    
 [EmailIdofcontactPerson_8] [varchar](200) NULL,    
 [NameofcontactPerson_9] [varchar](200) NULL,    
 [DesignationofcontactPerson_9] [varchar](200) NULL,    
 [PANofcontactPerson_9] [varchar](200) NULL,    
 [AddressofcontactPerson_9] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_9] [varchar](200) NULL,    
 [DINofcontactPerson_9] [varchar](200) NULL,    
 [UIDofcontactPerson_9] [varchar](200) NULL,    
 [EmailIdofcontactPerson_9] [varchar](200) NULL,    
 [NameofcontactPerson_10] [varchar](200) NULL,    
 [DesignationofcontactPerson_10] [varchar](200) NULL,    
 [PANofcontactPerson_10] [varchar](200) NULL,    
 [AddressofcontactPerson_10] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_10] [varchar](200) NULL,    
 [DINofcontactPerson_10] [varchar](200) NULL,    
 [UIDofcontactPerson_10] [varchar](200) NULL,    
 [EmailIdofcontactPerson_10] [varchar](200) NULL,    
 [NameofcontactPerson_11] [varchar](200) NULL,    
 [DesignationofcontactPerson_11] [varchar](200) NULL,    
 [PANofcontactPerson_11] [varchar](200) NULL,    
 [AddressofcontactPerson_11] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_11] [varchar](200) NULL,    
 [DINofcontactPerson_11] [varchar](200) NULL,    
 [UIDofcontactPerson_11] [varchar](200) NULL,    
 [EmailIdofcontactPerson_11] [varchar](200) NULL,    
 [NameofcontactPerson_12] [varchar](200) NULL,    
 [DesignationofcontactPerson_12] [varchar](200) NULL,    
 [PANofcontactPerson_12] [varchar](200) NULL,    
 [AddressofcontactPerson_12] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_12] [varchar](200) NULL,    
 [DINofcontactPerson_12] [varchar](200) NULL,    
 [UIDofcontactPerson_12] [varchar](200) NULL,    
 [EmailIdofcontactPerson_12] [varchar](200) NULL,    
 [NameofcontactPerson_13] [varchar](200) NULL,    
 [DesignationofcontactPerson_13] [varchar](200) NULL,    
 [PANofcontactPerson_13] [varchar](200) NULL,    
 [AddressofcontactPerson_13] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_13] [varchar](200) NULL,    
 [DINofcontactPerson_13] [varchar](200) NULL,    
 [UIDofcontactPerson_13] [varchar](200) NULL,    
 [EmailIdofcontactPerson_13] [varchar](200) NULL,    
 [NameofcontactPerson_14] [varchar](200) NULL,    
 [DesignationofcontactPerson_14] [varchar](200) NULL,    
 [PANofcontactPerson_14] [varchar](200) NULL,    
 [AddressofcontactPerson_14] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_14] [varchar](200) NULL,    
 [DINofcontactPerson_14] [varchar](200) NULL,    
 [UIDofcontactPerson_14] [varchar](200) NULL,    
 [EmailIdofcontactPerson_14] [varchar](200) NULL,    
 [NameofcontactPerson_15] [varchar](200) NULL,    
 [DesignationofcontactPerson_15] [varchar](200) NULL,    
 [PANofcontactPerson_15] [varchar](200) NULL,    
 [AddressofcontactPerson_15] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_15] [varchar](200) NULL,    
 [DINofcontactPerson_15] [varchar](200) NULL,    
 [UIDofcontactPerson_15] [varchar](200) NULL,    
 [EmailIdofcontactPerson_15] [varchar](200) NULL,    
 [NameofcontactPerson_16] [varchar](200) NULL,    
 [DesignationofcontactPerson_16] [varchar](200) NULL,    
 [PANofcontactPerson_16] [varchar](200) NULL,    
 [AddressofcontactPerson_16] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_16] [varchar](200) NULL,    
 [DINofcontactPerson_16] [varchar](200) NULL,    
 [UIDofcontactPerson_16] [varchar](200) NULL,    
 [EmailIdofcontactPerson_16] [varchar](200) NULL,    
 [NameofcontactPerson_17] [varchar](200) NULL,    
 [DesignationofcontactPerson_17] [varchar](200) NULL,    
 [PANofcontactPerson_17] [varchar](200) NULL,    
 [AddressofcontactPerson_17] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_17] [varchar](200) NULL,    
 [DINofcontactPerson_17] [varchar](200) NULL,    
 [UIDofcontactPerson_17] [varchar](200) NULL,    
 [EmailIdofcontactPerson_17] [varchar](200) NULL,    
 [NameofcontactPerson_18] [varchar](200) NULL,    
 [DesignationofcontactPerson_18] [varchar](200) NULL,    
 [PANofcontactPerson_18] [varchar](200) NULL,    
 [AddressofcontactPerson_18] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_18] [varchar](200) NULL,    
 [DINofcontactPerson_18] [varchar](200) NULL,    
 [UIDofcontactPerson_18] [varchar](200) NULL,    
 [EmailIdofcontactPerson_18] [varchar](200) NULL,    
 [NameofcontactPerson_19] [varchar](200) NULL,    
 [DesignationofcontactPerson_19] [varchar](200) NULL,    
 [PANofcontactPerson_19] [varchar](200) NULL,    
 [AddressofcontactPerson_19] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_19] [varchar](200) NULL,    
 [DINofcontactPerson_19] [varchar](200) NULL,    
 [UIDofcontactPerson_19] [varchar](200) NULL,    
 [EmailIdofcontactPerson_19] [varchar](200) NULL,    
 [NameofcontactPerson_20] [varchar](200) NULL,    
 [DesignationofcontactPerson_20] [varchar](200) NULL,    
 [PANofcontactPerson_20] [varchar](200) NULL,    
 [AddressofcontactPerson_20] [varchar](200) NULL,    
 [ContactdetailsofcontactPerson_20] [varchar](200) NULL,    
 [DINofcontactPerson_20] [varchar](200) NULL,    
 [UIDofcontactPerson_20] [varchar](200) NULL,    
 [EmailIdofcontactPerson_20] [varchar](200) NULL,    
 [POAforFunds] [varchar](1) NULL,    
 [POAforSecurities] [varchar](1) NULL,    
 [Flag] [varchar](1) NULL    
)    
     
 --insert into     
 -- angel_ucc_nse_fo_client1    
 select    
  party_code = ltrim(rtrim(c2.party_code)),    
  --c1.*    
  Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),    
  Short_Name=ltrim(rtrim(isnull(Short_Name,''))),    
  Long_Name=ltrim(rtrim(isnull(Long_Name,''))),    
  L_Address1=ltrim(rtrim(isnull(L_Address1,''))),    
  L_Address2=ltrim(rtrim(isnull(L_Address2,''))),    
  L_Address3=ltrim(rtrim(isnull(L_Address3,''))),    
  L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),    
  L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),    
  L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),    
  L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),    
  L_Zip=ltrim(rtrim(isnull(L_Zip,''))),    
  --Fax=ltrim(rtrim(isnull(Fax,''))),    
  Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),    
  Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),    
  Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),    
  Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),    
  Email=ltrim(rtrim(isnull(Email,''))),    
  --Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),    
  --Credit_Limit=ltrim(rtrim(Credit_Limit)),    
  Cl_type=ltrim(rtrim(isnull(Cl_type,''))),    
  Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),    
  --Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),    
  --Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),    
  --Family=ltrim(rtrim(isnull(Family,''))),    
  --Penalty=ltrim(rtrim(Penalty)),    
  --Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),    
  --Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),    
  --PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),    
  Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),    
  pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),    
  --trader=ltrim(rtrim(isnull(trader,''))),    
  --Ward_No=ltrim(rtrim(isnull(Ward_No,''))),    
  --Region=ltrim(rtrim(isnull(Region,''))),    
  --Area=ltrim(rtrim(isnull(Area,''))),    
  --Clrating=ltrim(rtrim(isnull(Clrating,'')))    
  P_address1=cast('' as varchar(255)),    
  P_address2=cast('' as varchar(255)),    
  P_address3=cast('' as varchar(255)),    
  P_City=cast('' as varchar(50)),    
  P_State=cast('' as varchar(100)),    
  P_State_For_Other=cast('' as varchar(100)),    
  P_nation=cast('' as varchar(100)),    
  P_zip=cast('' as varchar(10)),    
  P_Len=cast('' as varchar(1)),     
  Gender=cast('' as varchar(1)),    
  STDcode_Residence1=cast('' as varchar(10)),    
  STDcode_Residence2=cast('' as varchar(10)),    
  STDcode_Office1=cast('' as varchar(10)),    
  STDcode_Office2=cast('' as varchar(10))    
 into     
  #temp_client1     
 from     
  NSESLBS.dbo.client1 c1 with(nolock),    
  NSESLBS.dbo.client2 c2 with(nolock),    
  #codes_to_process t with (nolock)    
 where     
  c1.cl_code = c2.cl_code and     
  c2.party_code = t.party_code     
    
 update #temp_client1 set     
  P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),    
  P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),    
  P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),    
  P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),    
  P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),    
  P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),    
  P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),    
  P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),    
  P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and     
      len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0    
    then 'N' else 'Y' end ,    
  Gender=ltrim(rtrim(isnull(c1.sex,''))),    
  STDcode_Residence1=isnull(Res_phone1_std,''),    
  STDcode_Residence2=isnull(Res_phone1_std,''),    
  STDcode_Office1=isnull(Off_phone1_std,''),    
  STDcode_Office2=isnull(off_phone2_std,'')    
 from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)    
 where t1.Cl_Code=c1.cl_code    
    
 update     
  #temp_Client1     
 set     
 L_State= dbo.fn_state_countary_value(l_state,'STATE'),    
 P_State=dbo.fn_state_countary_value(P_state,'STATE'),    
 L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),    
 P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),    
 cl_status=case    
    /*INDIVIDUAL/PROPRIETORSHIP FIRMS*/    
    when cl_status = 'IND' then '1'  /*INDIVIDUAL*/    
    
    /*PARTNERSHIP FIRM*/    
    when cl_status = 'PF' or cl_status='LLP' then '2'  /*PARTNERSHIP FIRMS*/    
    
    /*HUF*/    
    when cl_status = 'HUF' then '3'  /*HINDU UNDIVIDED FAMILY*/    
    
    /*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/    
    when cl_status = 'PPB' then '4'  /*PUB. PVT COMP/BODIES CORP*/    
    when cl_status = 'BCP' then '4'  /*BODY CORPORATE*/    
    
    /*TRUST / SOCIETY*/    
    when cl_status = 'TS' then '5'  /*TRUST / SOCIETY*/    
    
    /*MUTUAL FUND*/    
    when cl_status = 'MF' then '6'  /*MUTUAL FUNDS*/    
    when cl_status = 'MFF' then '6'  /*MUTUAL FUND (MF)*/    
    
    /*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/    
    when cl_status = 'IFI' then '7'  /*INDIAN FINANCIAL INSTI*/    
    when cl_status = 'DFI' then '7'  /*DOMESTIC FIN. INST.*/    
    
    /*BANK*/    
    when cl_status = 'BA' then ' 8'  /*BANKS*/    
    when cl_status = 'BNK' then '8'  /*BANK*/    
    
    /*INSURANCE*/    
    when cl_status = 'IC' then ' 9'  /*INSURANCE COMPANIES*/    
    
    /*STATUTORY BODIES*/    
    when cl_status = 'SB' then ' 10'  /*STATUTORY BODIES*/    
    
    /*NRI*/    
    when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'  /*NON RESIDENT INDIAN*/    
    
    /*FII*/    
    when cl_status = 'FII' then '12'  /*FOREIGN INSTIT INVESTORS*/    
    
    /*OCB*/    
    when cl_status = 'OCB' then '13'  /*OVERSEAS CORPORATE BODIES*/    
    
    /*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/    
    when cl_status = 'DFN' then '14'  /*DIRECT FOREIGN INVESTMENTS*/    
    
    when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/    
        
    /*FVC*/    
    when cl_status = 'FVC' then '20'  /*FOREIGN VENTURE CAPITAL FUNDS*/    
   else    
    '1'  /*INDIVIDUAL*/    
   end    
    
     
 select     
  Cl_Code, Party_code=c2.Party_code    
 into #temp_client2     
 from     
  NSESLBS.dbo.client2 c2 with(nolock),    
  #codes_to_process t with (nolock)    
 where     
  c2.party_code = t.party_code    
     
 select     
  party_code = ltrim(rtrim(t.party_code)),    
  --c5.*    
  cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),    
  --BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),    
  BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),    
  --ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */    
  ActiveFrom=c5.ActiveFrom,    
  InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),    
  GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))    
 into #temp_Client5     
 from     
  NSESLBS.dbo.client5 c5 with(nolock),    
  #temp_Client2 t with (nolock)    
 where     
  c5.cl_code = t.cl_code    
    
 select distinct    
  party_code = ltrim(rtrim(c4.party_code)),    
  bank_id = ltrim(rtrim(c4.bankid)),    
  bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),    
  bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1)
  
 + ltrim(rtrim(isnull(b.nation, ''))),    
  account_type = ltrim(rtrim(c4.depository)),    
  account_no = ltrim(rtrim(c4.cltdpid))    
 into    
  #pobank    
 from    
  #codes_to_process t with (nolock),    
  NSESLBS.dbo.client4 c4 with(nolock),    
  NSESLBS.dbo.pobank b with(nolock)    
 where    
  t.party_code = c4.party_code and    
  c4.bankid = b.bankid and    
  isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')    
    
 select distinct    
  party_code = ltrim(rtrim(c4.party_code)),    
  bank_id = ltrim(rtrim(c4.bankid)),    
  bank_name = ltrim(rtrim(isnull(b.bankname, ''))),    
  bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),    
  account_type = ltrim(rtrim(c4.depository)),    
  account_no = ltrim(rtrim(c4.cltdpid))    
 into    
  #bank    
 from    
  #codes_to_process t with (nolock),    
  NSESLBS.dbo.client4 c4 with(nolock),    
  NSESLBS.dbo.bank b with(nolock)    
 where    
  t.party_code = c4.party_code and    
  c4.bankid = b.bankid and    
  isnull(c4.depository, '') in ('CDSL', 'NSDL') and    
  isnull(c4.defdp, '') = '1'    
    
 --insert into    
 -- angel_ucc_nse_fo_client_bank    
 select distinct    
  party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),    
  bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),    
  bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),    
  bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),    
  bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),    
    
  dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),    
  dp_name = ltrim(rtrim(isnull(b.account_type, ''))),    
  depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),    
  demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))    
 into #temp_client_bank     
 from    
  #pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))    
 order by    
  ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))    
    
    
 /*******************END - FETCH DATA**************************/    
    
 insert into    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
  (    
   Segment ,    
   Client_Code ,    
   Client_Name ,    
   Category ,    
   PAN ,    
   Gender ,    
   Fathers_Husbands_GuardiansName ,    
   Maritalstatus ,    
   Nationality ,    
   Nationality_Other ,    
   ClientEmailId ,    
   CorrespondenceClientAddressline1 ,    
   CorrespondenceClientAddressline2 ,    
   CorrespondenceClientAddressline3 ,    
   CorrespondenceClientAddress_City ,    
   CorrespondenceClientAddress_State ,    
   CorrespondenceClientAddress_State_Others ,    
   CorrespondenceClientAddress_Country ,    
   CorrespondenceClientAddress_Pincode ,    
   FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,    
   PermanentClientAddressline1 ,    
   PermanentClientAddressline2 ,    
   PermanentClientAddressline3 ,    
   PermanentClientAddress_City ,    
   PermanentClientAddress_State ,    
   PermanentClientAddress_StateOthers ,    
   PermanentClientAddress_Country ,    
   PermanentClientAddress_Pincode ,    
   ISDcode_Residence ,    
   STDcode_Residence ,    
   TelephoneNumber_Residence ,    
   Mobilenumber ,    
   ISDcode_Office ,    
   STDcode_Office ,    
   TelephoneNumber_Office ,    
   DateofBirth_Incorporation ,    
   UIDNUMBER ,    
   BankName1 ,    
   BankBranchAddress1 ,    
   BankAccountNo1 ,    
   BankAccountType1 ,    
   BankName2 ,    
   BankBranchAddress2 ,    
   BankAccountNo2 ,    
   BankAccountType2 ,    
   BankName3 ,    
   BankBranchAddress3 ,    
   BankAccountNo3 ,    
   BankAccountType3 ,    
   DepositoryName1 ,    
   DepositoryID1 ,    
   BeneficialOwnerAccountNo1 ,    
   DepositoryName2 ,    
   DepositoryID2 ,    
   BeneficialOwnerAccountNo2 ,    
   DepositoryName3 ,    
   DepositoryID3 ,    
   BeneficialOwnerAccountNo3 ,    
   CorporateIdentitynumber_CIN ,    
   GrossAnnualIncomeRange ,    
   GrossAnnualIncomeasonDate ,    
   NetWorth_InRs ,    
   NetWorthasonDate ,    
   PoliticallyExposedPerson_PEP ,    
   PlaceofIncorporation ,    
   Occupation ,    
   OccupationDetails_Forothers ,    
   Dateofcommencementofbusiness ,    
   CustodialParticipantCodeoftheclient ,    
   RegistrationNoofClient ,    
   RegisteringAuthority ,    
   PlaceofRegistration ,    
   DateofRegistration ,    
   InpersonVerification ,    
   ClientAgreementDate ,    
   UniqueClientCodeallottedbyNSCCL_BSE ,    
   UpdationFlag_for_SMS_and_Email_facility ,    
   Relationship ,    
   TypeofFacility_for_SMS_and_Email_facility ,    
   ProofType ,    
   ProofNumber ,    
   IssuePlaceofProof ,    
   IssueDateofProof ,    
   ClientStatus ,    
   Remarks ,    
   ClientType_Corporate ,    
   NameofcontactPerson_1 ,    
   DesignationofContactPerson_1 ,    
   PANofcontactPerson_1 ,    
   AddressofcontactPerson_1 ,    
   ContactdetailsofcontactPerson_1 ,    
   DINofcontactPerson_1 ,    
   UIDofcontactPerson_1 ,    
   EmailIdofcontactPerson_1 ,    
   NameofcontactPerson_2 ,    
   DesignationofcontactPerson_2 ,    
   PANofcontactPerson_2 ,    
   AddressofcontactPerson_2 ,    
   ContactdetailsofcontactPerson_2 ,    
   DINofcontactPerson_2 ,    
   UIDofcontactPerson_2 ,    
   EmailIdofcontactPerson_2 ,    
   NameofcontactPerson_3 ,    
   DesignationofcontactPerson_3 ,    
   PANofcontactPerson_3 ,    
   AddressofcontactPerson_3 ,    
   ContactdetailsofcontactPerson_3 ,    
   DINofcontactPerson_3 ,    
   UIDofcontactPerson_3 ,    
   EmailIdofcontactPerson_3 ,    
   NameofcontactPerson_4 ,    
   DesignationofcontactPerson_4 ,    
   PANofcontactPerson_4 ,    
   AddressofcontactPerson_4 ,     ContactdetailsofcontactPerson_4 ,    
   DINofcontactPerson_4 ,    
   UIDofcontactPerson_4 ,    
   EmailIdofcontactPerson_4 ,    
   NameofcontactPerson_5 ,    
   DesignationofcontactPerson_5 ,    
   PANofcontactPerson_5 ,    
   AddressofcontactPerson_5 ,    
   ContactdetailsofcontactPerson_5 ,    
   DINofcontactPerson_5 ,    
   UIDofcontactPerson_5 ,    
   EmailIdofcontactPerson_5 ,    
   NameofcontactPerson_6 ,    
   DesignationofcontactPerson_6 ,    
   PANofcontactPerson_6 ,    
   AddressofcontactPerson_6 ,    
   ContactdetailsofcontactPerson_6 ,    
   DINofcontactPerson_6 ,    
   UIDofcontactPerson_6 ,    
   EmailIdofcontactPerson_6 ,    
   NameofcontactPerson_7 ,    
   DesignationofcontactPerson_7 ,    
   PANofcontactPerson_7 ,    
   AddressofcontactPerson_7 ,    
   ContactdetailsofcontactPerson_7 ,    
   DINofcontactPerson_7 ,    
   UIDofcontactPerson_7 ,    
   EmailIdofcontactPerson_7 ,    
   NameofcontactPerson_8 ,    
   DesignationofcontactPerson_8 ,    
   PANofcontactPerson_8 ,    
   AddressofcontactPerson_8 ,    
   ContactdetailsofcontactPerson_8 ,    
   DINofcontactPerson_8 ,    
   UIDofcontactPerson_8 ,    
   EmailIdofcontactPerson_8 ,    
   NameofcontactPerson_9 ,    
   DesignationofcontactPerson_9 ,    
   PANofcontactPerson_9 ,    
   AddressofcontactPerson_9 ,    
   ContactdetailsofcontactPerson_9 ,    
   DINofcontactPerson_9 ,    
   UIDofcontactPerson_9 ,    
   EmailIdofcontactPerson_9 ,    
   NameofcontactPerson_10 ,    
   DesignationofcontactPerson_10 ,    
   PANofcontactPerson_10 ,    
   AddressofcontactPerson_10 ,    
   ContactdetailsofcontactPerson_10 ,    
   DINofcontactPerson_10 ,    
   UIDofcontactPerson_10 ,    
   EmailIdofcontactPerson_10 ,    
   NameofcontactPerson_11 ,    
   DesignationofcontactPerson_11 ,    
   PANofcontactPerson_11 ,    
   AddressofcontactPerson_11 ,    
   ContactdetailsofcontactPerson_11 ,    
   DINofcontactPerson_11 ,    
   UIDofcontactPerson_11 ,    
   EmailIdofcontactPerson_11 ,    
   NameofcontactPerson_12 ,    
   DesignationofcontactPerson_12 ,    
   PANofcontactPerson_12 ,    
   AddressofcontactPerson_12 ,    
   ContactdetailsofcontactPerson_12 ,    
   DINofcontactPerson_12 ,    
   UIDofcontactPerson_12 ,    
   EmailIdofcontactPerson_12 ,    
   NameofcontactPerson_13 ,    
   DesignationofcontactPerson_13 ,    
   PANofcontactPerson_13 ,    
   AddressofcontactPerson_13 ,    
   ContactdetailsofcontactPerson_13 ,    
   DINofcontactPerson_13 ,    
   UIDofcontactPerson_13 ,    
   EmailIdofcontactPerson_13 ,    
   NameofcontactPerson_14 ,    
   DesignationofcontactPerson_14 ,    
   PANofcontactPerson_14 ,    
   AddressofcontactPerson_14 ,    
   ContactdetailsofcontactPerson_14 ,    
   DINofcontactPerson_14 ,    
   UIDofcontactPerson_14 ,    
   EmailIdofcontactPerson_14 ,    
   NameofcontactPerson_15 ,    
   DesignationofcontactPerson_15 ,    
   PANofcontactPerson_15 ,    
   AddressofcontactPerson_15 ,    
   ContactdetailsofcontactPerson_15 ,    
   DINofcontactPerson_15 ,    
   UIDofcontactPerson_15 ,    
   EmailIdofcontactPerson_15 ,    
   NameofcontactPerson_16 ,    
   DesignationofcontactPerson_16 ,    
   PANofcontactPerson_16 ,    
   AddressofcontactPerson_16 ,    
   ContactdetailsofcontactPerson_16 ,    
   DINofcontactPerson_16 ,    
   UIDofcontactPerson_16 ,    
   EmailIdofcontactPerson_16 ,    
   NameofcontactPerson_17 ,    
   DesignationofcontactPerson_17 ,    
   PANofcontactPerson_17 ,    
   AddressofcontactPerson_17 ,    
   ContactdetailsofcontactPerson_17 ,    
   DINofcontactPerson_17 ,    
   UIDofcontactPerson_17 ,    
   EmailIdofcontactPerson_17 ,    
   NameofcontactPerson_18 ,    
   DesignationofcontactPerson_18 ,    
   PANofcontactPerson_18 ,    
   AddressofcontactPerson_18 ,    
   ContactdetailsofcontactPerson_18 ,    
   DINofcontactPerson_18 ,    
   UIDofcontactPerson_18 ,    
   EmailIdofcontactPerson_18 ,    
   NameofcontactPerson_19 ,    
   DesignationofcontactPerson_19 ,    
   PANofcontactPerson_19 ,    
   AddressofcontactPerson_19 ,    
   ContactdetailsofcontactPerson_19 ,    
   DINofcontactPerson_19 ,    
   UIDofcontactPerson_19 ,    
   EmailIdofcontactPerson_19 ,    
   NameofcontactPerson_20 ,    
   DesignationofcontactPerson_20 ,    
   PANofcontactPerson_20 ,    
   AddressofcontactPerson_20 ,    
   ContactdetailsofcontactPerson_20 ,    
   DINofcontactPerson_20 ,    
   UIDofcontactPerson_20 ,    
   EmailIdofcontactPerson_20 ,    
   POAforFunds ,    
         POAforSecurities,     
   Flag     
   )    
 select    
  segment = 'S',    
  client_code = c2.party_code,    
  client_name = left(c1_b.long_name, 150),    
  category =cl_status,    
  pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),    
  Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */    
  Fathers_Husbands_GuardiansName ='',    
  Maritalstatus='',    
  Nationality ='',    
  Nationality_Other='',     
  ClientEmailId = left(email, 60),    
  CorrespondenceClientAddressline1 = left(    
   case    
    when len(c1_b.l_address1) = 0    
    then ''    
    else ltrim(rtrim(isnull(c1_b.l_address1, '')))    
    end    
   +    
   case    
    when len(c1_b.l_address2) = 0    
    then ''    
    else ltrim(rtrim(isnull(c1_b.l_address2, '')))    
    end    
   +    
   case    
    when len(c1_b.l_address3) = 0    
    then ''    
    else ltrim(rtrim(isnull(c1_b.l_address3, '')))    
    end, 255    
   ),    
    
  CorrespondenceClientAddressline2 = '',    
  CorrespondenceClientAddressline3 = '',    
  CorrespondenceClientAddress_City = left(c1_b.l_city, 50),    
  CorrespondenceClientAddress_State = c1_b.l_state,    
  CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,    
  CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),    
  CorrespondenceClientAddress_Pincode =     
  case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then    
    case    
     when len(c1_b.l_zip) <> 6 then ''    
     when len(c1_b.l_zip) = 0 then ''    
     else c1_b.l_zip    
    end    
  else    
   c1_b.l_zip    
  end  ,    
  FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,     
  /*Modify on 30 Apr 2014*/    
  PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end,     
  PermanentClientAddressline2 ='',    
  PermanentClientAddressline3 ='',       
  /*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,    
  PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,    
  PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/    
  PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,    
  PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,    
  PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,    
  PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,    
  PermanentClientAddress_Pincode =    
  case when c1_b.P_Len='N' then     
   case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then    
    case    
     when len(c1_b.l_zip) <> 6 then ''    
     when len(c1_b.l_zip) = 0 then ''    
     else c1_b.l_zip    
    end    
   else    
    c1_b.l_zip    
   end    
  else ''         
  end,    
  ISDcode_Residence ='',    
  STDcode_Residence =case     
       when len(STDcode_Residence1)>0 then STDcode_Residence1    
       when len(STDcode_Residence2)>0 then STDcode_Residence2    
         else '' end,     
  TelephoneNumber_Residence =     
   left( case     
      when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')    
      when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')    
     else     
      ''     
     end    
    , 60    
    ),    
  Mobilenumber =left(c1_b.mobile_pager, 10),    
  ISDcode_Office ='',    
  STDcode_Office =case     
       when len(STDcode_Office1)>0 then STDcode_Office1    
       when len(STDcode_Office2)>0 then STDcode_Office2    
         else '' end,    
  TelephoneNumber_Office=    
   left( case     
      when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')    
      when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')    
     else     
      ''     
     end    
    , 60    
    ),    
  DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,    
  UIDNUMBER='',    
    
     
  BankName1 =bank_name,    
  BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end ,     
  BankAccountNo1 =bank_account_no,    
  BankAccountType1 =case     
       when bank_account_type = 'SAVING' then '10'    
       when bank_account_type = 'CURRENT' then '11'    
       when bank_account_type = 'OTHER' then '99'     
        else ''    
       end ,    
  BankName2 ='',    
  BankBranchAddress2 ='',    
  BankAccountNo2 ='',    
  BankAccountType2 ='',    
  BankName3 ='',    
  BankBranchAddress3 ='',    
  BankAccountNo3 ='',    
  BankAccountType3 ='',    
      
  DepositoryName1 =dp_name,    
  DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,    
  BeneficialOwnerAccountNo1 =demat_id_of_client,    
      
  DepositoryName2 ='',    
  DepositoryID2 ='',    
  BeneficialOwnerAccountNo2 ='',    
  DepositoryName3 ='',    
  DepositoryID3 ='',    
  BeneficialOwnerAccountNo3 ='',    
  CorporateIdentitynumber_CIN='',    
  GrossAnnualIncomeRange ='',    
  GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,    
  NetWorth_InRs ='',    
  NetWorthasonDate ='',    
  PoliticallyExposedPerson_PEP='0',     
  PlaceofIncorporation ='',    
  Occupation ='',    
  OccupationDetails_Forothers='',     
  Dateofcommencementofbusiness ='',    
  CustodialParticipantCodeoftheclient ='',    
  RegistrationNoofClient ='',    
  RegisteringAuthority ='',    
  PlaceofRegistration ='',    
  DateofRegistration ='',    
  InpersonVerification ='Y',    
  ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),    
       /*Change on 26 Apr 2014: Changes for NSE SLB */    
  UniqueClientCodeallottedbyNSCCL_BSE ='',    
  UpdationFlag_for_SMS_and_Email_facility='',     
  Relationship ='',    
  TypeofFacility_for_SMS_and_Email_facility ='',    
  ProofType ='',    
  ProofNumber ='',    
  IssuePlaceofProof='',     
  IssueDateofProof ='',    
  ClientStatus ='A',    
  Remarks ='',    
  ClientType_Corporate='',     
  NameofcontactPerson_1 ='',    
  DesignationofContactPerson_1 ='',    
  PANofcontactPerson_1 ='',    
  AddressofcontactPerson_1 ='',    
  ContactdetailsofcontactPerson_1 ='',    
  DINofcontactPerson_1 ='',    
  UIDofcontactPerson_1 ='',    
  EmailIdofcontactPerson_1 ='',    
  NameofcontactPerson_2  ='',    
  DesignationofcontactPerson_2 ='',    
  PANofcontactPerson_2 ='',    
  AddressofcontactPerson_2 ='',    
  ContactdetailsofcontactPerson_2='',     
  DINofcontactPerson_2 ='',    
  UIDofcontactPerson_2 ='',    
  EmailIdofcontactPerson_2 ='',    
  NameofcontactPerson_3 ='',    
  DesignationofcontactPerson_3='',     
  PANofcontactPerson_3 ='',    
  AddressofcontactPerson_3 ='',    
  ContactdetailsofcontactPerson_3='',     
  DINofcontactPerson_3 ='',    
  UIDofcontactPerson_3 ='',    
  EmailIdofcontactPerson_3 ='',    
  NameofcontactPerson_4 ='',    
  DesignationofcontactPerson_4='',     
  PANofcontactPerson_4 ='',    
  AddressofcontactPerson_4 ='',    
  ContactdetailsofcontactPerson_4 ='',    
  DINofcontactPerson_4 ='',    
  UIDofcontactPerson_4 ='',    
  EmailIdofcontactPerson_4 ='',    
  NameofcontactPerson_5 ='',    
  DesignationofcontactPerson_5 ='',    
  PANofcontactPerson_5 ='',    
  AddressofcontactPerson_5 ='',    
  ContactdetailsofcontactPerson_5='',     
  DINofcontactPerson_5 ='',    
  UIDofcontactPerson_5 ='',    
  EmailIdofcontactPerson_5 ='',    
  NameofcontactPerson_6 ='',    
  DesignationofcontactPerson_6='',     
  PANofcontactPerson_6 ='',    
  AddressofcontactPerson_6 ='',    
  ContactdetailsofcontactPerson_6='',     
  DINofcontactPerson_6 ='',    
  UIDofcontactPerson_6 ='',    
  EmailIdofcontactPerson_6 ='',    
  NameofcontactPerson_7 ='',    
  DesignationofcontactPerson_7='',     
  PANofcontactPerson_7 ='',    
  AddressofcontactPerson_7 ='',    
  ContactdetailsofcontactPerson_7='',     
  DINofcontactPerson_7 ='',    
  UIDofcontactPerson_7 ='',    
  EmailIdofcontactPerson_7 ='',    
  NameofcontactPerson_8 ='',    
  DesignationofcontactPerson_8 ='',    
  PANofcontactPerson_8 ='',    
  AddressofcontactPerson_8 ='',    
  ContactdetailsofcontactPerson_8 ='',    
  DINofcontactPerson_8 ='',    
  UIDofcontactPerson_8 ='',    
  EmailIdofcontactPerson_8 ='',    
  NameofcontactPerson_9 ='',    
  DesignationofcontactPerson_9='',     
  PANofcontactPerson_9 ='',    
  AddressofcontactPerson_9 ='',    
  ContactdetailsofcontactPerson_9='',     
  DINofcontactPerson_9 ='',    
  UIDofcontactPerson_9 ='',    
  EmailIdofcontactPerson_9 ='',    
  NameofcontactPerson_10 ='',    
  DesignationofcontactPerson_10='',     
  PANofcontactPerson_10 ='',    
  AddressofcontactPerson_10 ='',    
  ContactdetailsofcontactPerson_10='',     
  DINofcontactPerson_10 ='',    
  UIDofcontactPerson_10 ='',    
  EmailIdofcontactPerson_10 ='',    
  NameofcontactPerson_11 ='',    
  DesignationofcontactPerson_11='',     
  PANofcontactPerson_11 ='',    
  AddressofcontactPerson_11 ='',    
  ContactdetailsofcontactPerson_11='',     
  DINofcontactPerson_11 ='',    
  UIDofcontactPerson_11 ='',    
  EmailIdofcontactPerson_11 ='',    
  NameofcontactPerson_12 ='',    
  DesignationofcontactPerson_12='',     
  PANofcontactPerson_12 ='',    
  AddressofcontactPerson_12 ='',    
  ContactdetailsofcontactPerson_12='',     
  DINofcontactPerson_12 ='',    
  UIDofcontactPerson_12 ='',    
  EmailIdofcontactPerson_12 ='',    
  NameofcontactPerson_13 ='',    
  DesignationofcontactPerson_13 ='',    
  PANofcontactPerson_13 ='',    
  AddressofcontactPerson_13 ='',    
  ContactdetailsofcontactPerson_13 ='',    
  DINofcontactPerson_13 ='',    
  UIDofcontactPerson_13 ='',    
  EmailIdofcontactPerson_13 ='',    
  NameofcontactPerson_14 ='',    
  DesignationofcontactPerson_14 ='',    
  PANofcontactPerson_14 ='',    
  AddressofcontactPerson_14 ='',    
  ContactdetailsofcontactPerson_14 ='',    
  DINofcontactPerson_14 ='',    
  UIDofcontactPerson_14 ='',    
  EmailIdofcontactPerson_14 ='',    
  NameofcontactPerson_15 ='',    
  DesignationofcontactPerson_15 ='',    
  PANofcontactPerson_15 ='',    
  AddressofcontactPerson_15 ='',    
  ContactdetailsofcontactPerson_15='',     
  DINofcontactPerson_15 ='',    
  UIDofcontactPerson_15 ='',    
  EmailIdofcontactPerson_15 ='',    
  NameofcontactPerson_16 ='',    
  DesignationofcontactPerson_16='',     
  PANofcontactPerson_16 ='',    
  AddressofcontactPerson_16 ='',    
  ContactdetailsofcontactPerson_16='',     
  DINofcontactPerson_16 ='',    
  UIDofcontactPerson_16 ='',    
  EmailIdofcontactPerson_16 ='',    
  NameofcontactPerson_17 ='',    
  DesignationofcontactPerson_17='',     
  PANofcontactPerson_17 ='',    
  AddressofcontactPerson_17 ='',    
  ContactdetailsofcontactPerson_17='',     
  DINofcontactPerson_17 ='',    
  UIDofcontactPerson_17 ='',    
  EmailIdofcontactPerson_17 ='',    
  NameofcontactPerson_18 ='',    
  DesignationofcontactPerson_18='',     
  PANofcontactPerson_18 ='',    
  AddressofcontactPerson_18 ='',    
  ContactdetailsofcontactPerson_18='',     
  DINofcontactPerson_18 ='',    
  UIDofcontactPerson_18 ='',    
  EmailIdofcontactPerson_18 ='',    
  NameofcontactPerson_19 ='',    
  DesignationofcontactPerson_19='',     
  PANofcontactPerson_19 ='',    
  AddressofcontactPerson_19 ='',    
  ContactdetailsofcontactPerson_19='',     
  DINofcontactPerson_19 ='',    
  UIDofcontactPerson_19 ='',    
  EmailIdofcontactPerson_19 ='',    
  NameofcontactPerson_20 ='',    
  DesignationofcontactPerson_20='',     
  PANofcontactPerson_20 ='',    
  AddressofcontactPerson_20 ='',    
  ContactdetailsofcontactPerson_20='',     
  DINofcontactPerson_20 ='',    
  UIDofcontactPerson_20 ='',    
  EmailIdofcontactPerson_20 ='',    
  POAforFunds ='N',    
     POAforSecurities='N',     
  Flag='E'    
 from    
  (    
   select    
    c1.*,    
    b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client    
   from    
    #temp_Client1 c1 with (nolock)    
     left outer join    
    #temp_client_bank b with (nolock)    
     on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))    
  ) c1_b,    
  #temp_Client2 c2 with (nolock),    
  #temp_Client5 c5 with (nolock)    
    
 where    
  ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and    
  ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and    
  ltrim(rtrim(left(c2.party_code,2))) <> '98'    
      
    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
  UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),    
     --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/    
     --MASTERPAN=ISNULL(c1.MASTERPAN,''),    
     TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),    
  --Gender=isnull(c1.Gender,''),    
  Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),    
  Maritalstatus=    
   case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then    
     case     
      when isnull(c1.MARITALSTATUS,'')='01' then 'S'     
      when isnull(c1.MARITALSTATUS,'')='02' then 'M'    
      else 'S'     
     end    
   else    
    ''    
   end   ,    
  Nationality=    
     case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end,     
  NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,    
  GrossAnnualIncomeRange=case     
     when c1.Gross_Income ='01' then '1'    
     when c1.Gross_Income ='02' then '2'    
     when c1.Gross_Income ='03' then '3'    
     when c1.Gross_Income ='04' then '4'    
     when c1.Gross_Income ='05' then '5'    
     when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/         when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/    
     else '' end,     
  NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),    
  NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''    
      else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,    
  PoliticallyExposedPerson_PEP=case     
    when c1.PEP='01' or c1.pep ='PEP' then '01'     
    when c1.PEP='02' or c1.pep ='RPEP' then '02'    
    else '0' end,    
  Occupation=case     
    when c1.Occupation='01' then '01'    
    when c1.Occupation='02' then '02'    
    when c1.Occupation='03' then '04'    
    when c1.Occupation='04' then '05'    
    when c1.Occupation='05' then '06'    
    when c1.Occupation='06' then '07'    
    when c1.Occupation='07' then '08'    
    when c1.Occupation='08' then '09'    
    when c1.Occupation='10' then '03'    
    else '99' end,    
  OccupationDetails_Forothers=isnull(Occupation_Other,''),    
  --UIDNUMBER=isnull(c1.AADHAR_UID,'')    
  UIDNUMBER=replace(isnull(rtrim(ltrim(c1.AADHAR_UID)),''),' ','')    
 from    
  anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)    
 where    
  client_code = party_code    
  and len(isnull(client_code, '')) > 0    
  and len(isnull(party_code, '')) > 0       
     
 update     
  #mimansa_angel_ucc_nse_slb_client_data_new_changes     
 set     
  GrossAnnualIncomeasonDate='',    
  NetWorth_InRs='',    
  NetWorthasonDate=''    
 where len(GrossAnnualIncomeRange)=0     
    
     
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),    
  ClientType_Corporate='Y'    
 from    
  anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)    
 where    
  client_code = party_code    
  and len(isnull(client_code, '')) > 0    
  and len(isnull(party_code, '')) > 0     
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4     
    
 /****ADDRESS 1****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_1=c1.contact_name,    
 DesignationofContactPerson_1=c1.designation,    
 PANofcontactPerson_1=c1.PanNo,    
 AddressofcontactPerson_1=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_1=c1.DIN,    
 UIDofcontactPerson_1=c1.UID,    
 EmailIdofcontactPerson_1=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='1'    
    
 /****ADDRESS 2****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_2=c1.contact_name,    
 DesignationofContactPerson_2=c1.designation,    
 PANofcontactPerson_2=c1.PanNo,    
 AddressofcontactPerson_2=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_2=c1.DIN,    
 UIDofcontactPerson_2=c1.UID,    
 EmailIdofcontactPerson_2=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='2'    
    
 /****ADDRESS 3****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_3=c1.contact_name,    
 DesignationofContactPerson_3=c1.designation,    
 PANofcontactPerson_3=c1.PanNo,    
 AddressofcontactPerson_3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_3=c1.DIN,    
 UIDofcontactPerson_3=c1.UID,    
 EmailIdofcontactPerson_3=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='3'    
    
 /****ADDRESS 4****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_4=c1.contact_name,    
 DesignationofContactPerson_4=c1.designation,    
 PANofcontactPerson_4=c1.PanNo,    
 AddressofcontactPerson_4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_4=c1.DIN,    
 UIDofcontactPerson_4=c1.UID,    
 EmailIdofcontactPerson_4=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='4'    
    
 /****ADDRESS 5****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_5=c1.contact_name,    
 DesignationofContactPerson_5=c1.designation,    
 PANofcontactPerson_5=c1.PanNo,    
 AddressofcontactPerson_5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_5=c1.DIN,    
 UIDofcontactPerson_5=c1.UID,    
 EmailIdofcontactPerson_5=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='5'    
    
 /****ADDRESS 6****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_6=c1.contact_name,    
 DesignationofContactPerson_6=c1.designation,    
 PANofcontactPerson_6=c1.PanNo,    
 AddressofcontactPerson_6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_6=c1.DIN,    
 UIDofcontactPerson_6=c1.UID,    
 EmailIdofcontactPerson_6=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='6'    
    
 /****ADDRESS 7****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_7=c1.contact_name,    
 DesignationofContactPerson_7=c1.designation,    
 PANofcontactPerson_7=c1.PanNo,    
 AddressofcontactPerson_7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_7=c1.DIN,    
 UIDofcontactPerson_7=c1.UID,    
 EmailIdofcontactPerson_7=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='7'    
    
 /****ADDRESS 8****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_8=c1.contact_name,    
 DesignationofContactPerson_8=c1.designation,    
 PANofcontactPerson_8=c1.PanNo,    
 AddressofcontactPerson_8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_8=c1.DIN,    
 UIDofcontactPerson_8=c1.UID,    
 EmailIdofcontactPerson_8=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='8'    
    
 /****ADDRESS 9****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_9=c1.contact_name,    
 DesignationofContactPerson_9=c1.designation,    
 PANofcontactPerson_9=c1.PanNo,    
 AddressofcontactPerson_9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_9=c1.DIN,    
 UIDofcontactPerson_9=c1.UID,    
 EmailIdofcontactPerson_9=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='9'    
    
 /****ADDRESS 10****/    
 update    
  #mimansa_angel_ucc_nse_slb_client_data_new_changes    
 set    
 NameofcontactPerson_10=c1.contact_name,    
 DesignationofContactPerson_10=c1.designation,    
 PANofcontactPerson_10=c1.PanNo,    
 AddressofcontactPerson_10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),    
 ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),    
 DINofcontactPerson_10=c1.DIN,    
 UIDofcontactPerson_10=c1.UID,    
 EmailIdofcontactPerson_10=c1.Email      
 from    
  anand1.msajag.dbo.client_contact_details c1 with(nolock)    
 where    
  Client_Code = cl_code    
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')    
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')    
  and line_no='10'    
    
    
    
  /*Update POA*/    
  --Update     
  --    #mimansa_angel_ucc_nse_slb_client_data_new_changes    
  --  set         
  --     POAforSecurities=    
  --  case     
  --  when ltrim(rtrim(Def))=1 then 'Y'      
  --  when ltrim(rtrim(Def))=0 then 'N'         
  --  else  ''     
  -- end    
  --  from    
  --   anand1.msajag.dbo.Multicltid m with(nolock)    
  --     where    
  --Client_Code = m.Party_code    
    
     
 /*INVALID PAN*/    
    
     
    
 select distinct    
  client_code = ltrim(rtrim(client_code)),    
  client_name = ltrim(rtrim(client_name)),    
  pan = ltrim(rtrim(pan))    
  --pan,    
  --pan_err =     
  -- case     
  --  when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'    
  --  then 'NO PAN'    
  --  when len(ltrim(rtrim(isnull(pan, '')))) = 0    
  --  then 'NO PAN'    
  --  when not (    
  --   isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and    
  --   isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and    
  --   isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and    
  --   len(ltrim(rtrim(isnull(pan, '')))) = 10    
  --  )    
  --  then 'INVALID PAN'    
  -- end,    
    
  --pan_length = len(ltrim(rtrim(isnull(pan, '')))),    
  --telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),    
  --client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))    
into #invalidpan    
 from    
  --mimansa_angel_ucc_nse_fo_client_data with(nolock)    
  mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)    
 where    
  ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'    
    
     
    
     
delete    
 #mimansa_angel_ucc_nse_slb_client_data_new_changes    
from    
 --[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)    
 intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp     
where    
 ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))    
 and len(bp.panno)=10    
    
/***************FINAL DISPLAY*******************/    
select distinct    
  Segment,     
  Client_Code=ltrim(RTRIM(Client_Code)),     
  Client_Name ,    
  Category ,    
  PAN ,    
  Gender,     
  Fathers_Husbands_GuardiansName ,    
  Maritalstatus ,    
  Nationality ,    
  Nationality_Other,     
  ClientEmailId ,    
  CorrespondenceClientAddressline1 ,    
  CorrespondenceClientAddressline2 ,    
  CorrespondenceClientAddressline3 ,    
  CorrespondenceClientAddress_City ,    
  CorrespondenceClientAddress_State ,    
  CorrespondenceClientAddress_State_Others,     
  CorrespondenceClientAddress_Country ,    
  CorrespondenceClientAddress_Pincode ,    
  FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,    
  PermanentClientAddressline1 ,    
  PermanentClientAddressline2 ,    
  PermanentClientAddressline3 ,    
  PermanentClientAddress_City ,    
  PermanentClientAddress_State ,    
  PermanentClientAddress_StateOthers  ,    
  PermanentClientAddress_Country ,    
  PermanentClientAddress_Pincode ,    
  ISDcode_Residence ,    
  STDcode_Residence ,    
  TelephoneNumber_Residence ,    
  Mobilenumber ,    
  ISDcode_Office,     
  STDcode_Office ,    
  TelephoneNumber_Office ,    
  DateofBirth_Incorporation ,    
  UIDNUMBER ,    
  BankName1 ,    
  BankBranchAddress1 ,    
  BankAccountNo1 ,    
  BankAccountType1 ,    
  BankName2 ,    
  BankBranchAddress2 ,    
  BankAccountNo2 ,    
  BankAccountType2 ,    
  BankName3 ,    
  BankBranchAddress3 ,    
  BankAccountNo3 ,    
  BankAccountType3,     
  DepositoryName1 ,    
  DepositoryID1 ,    
  BeneficialOwnerAccountNo1 ,    
  DepositoryName2 ,    
  DepositoryID2 ,    
  BeneficialOwnerAccountNo2 ,    
  DepositoryName3 ,    
  DepositoryID3 ,    
  BeneficialOwnerAccountNo3 ,    
  CorporateIdentitynumber_CIN,     
  GrossAnnualIncomeRange ,    
  GrossAnnualIncomeasonDate,     
  NetWorth_InRs ,    
  NetWorthasonDate,     
  PoliticallyExposedPerson_PEP ,    
  PlaceofIncorporation ,    
  Occupation ,    
  OccupationDetails_Forothers ,    
  Dateofcommencementofbusiness ,    
  CustodialParticipantCodeoftheclient ,    
  RegistrationNoofClient ,    
  RegisteringAuthority ,    
  PlaceofRegistration ,    
  DateofRegistration ,    
  InpersonVerification,     
  ClientAgreementDate ,    
  UniqueClientCodeallottedbyNSCCL_BSE ,    
  UpdationFlag_for_SMS_and_Email_facility ,    
  Relationship ,    
  TypeofFacility_for_SMS_and_Email_facility ,    
  ProofType ,    
  ProofNumber ,    
  IssuePlaceofProof ,    
  IssueDateofProof ,    
  ClientStatus ,    
  Remarks ,    
  ClientType_Corporate,     
  NameofcontactPerson_1 ,    
  DesignationofContactPerson_1 ,    
  PANofcontactPerson_1 ,    
  AddressofcontactPerson_1 ,    
  ContactdetailsofcontactPerson_1 ,    
  DINofcontactPerson_1 ,    
  UIDofcontactPerson_1 ,    
  EmailIdofcontactPerson_1 ,    
  NameofcontactPerson_2  ,    
  DesignationofcontactPerson_2 ,    
  PANofcontactPerson_2 ,    
  AddressofcontactPerson_2 ,    
  ContactdetailsofcontactPerson_2,     
  DINofcontactPerson_2 ,    
  UIDofcontactPerson_2 ,    
  EmailIdofcontactPerson_2 ,    
  NameofcontactPerson_3 ,    
  DesignationofcontactPerson_3,     
  PANofcontactPerson_3 ,    
  AddressofcontactPerson_3 ,    
  ContactdetailsofcontactPerson_3,     
  DINofcontactPerson_3 ,    
  UIDofcontactPerson_3 ,    
  EmailIdofcontactPerson_3 ,    
  NameofcontactPerson_4 ,    
  DesignationofcontactPerson_4,     
  PANofcontactPerson_4 ,    
  AddressofcontactPerson_4 ,    
  ContactdetailsofcontactPerson_4 ,    
  DINofcontactPerson_4 ,    
  UIDofcontactPerson_4 ,    
  EmailIdofcontactPerson_4 ,    
  NameofcontactPerson_5 ,    
  DesignationofcontactPerson_5 ,    
  PANofcontactPerson_5 ,    
  AddressofcontactPerson_5 ,    
  ContactdetailsofcontactPerson_5,     
  DINofcontactPerson_5 ,    
  UIDofcontactPerson_5 ,    
  EmailIdofcontactPerson_5 ,    
  NameofcontactPerson_6 ,    
  DesignationofcontactPerson_6,     
  PANofcontactPerson_6 ,    
  AddressofcontactPerson_6 ,    
  ContactdetailsofcontactPerson_6,     
  DINofcontactPerson_6 ,    
  UIDofcontactPerson_6 ,    
  EmailIdofcontactPerson_6 ,    
  NameofcontactPerson_7 ,    
  DesignationofcontactPerson_7,     
  PANofcontactPerson_7 ,    
  AddressofcontactPerson_7 ,    
  ContactdetailsofcontactPerson_7,     
  DINofcontactPerson_7 ,    
  UIDofcontactPerson_7 ,    
  EmailIdofcontactPerson_7 ,    
  NameofcontactPerson_8 ,    
  DesignationofcontactPerson_8 ,    
  PANofcontactPerson_8 ,    
  AddressofcontactPerson_8 ,    
  ContactdetailsofcontactPerson_8 ,    
  DINofcontactPerson_8 ,    
  UIDofcontactPerson_8 ,    
  EmailIdofcontactPerson_8 ,    
  NameofcontactPerson_9 ,    
  DesignationofcontactPerson_9,     
  PANofcontactPerson_9 ,    
  AddressofcontactPerson_9 ,    
  ContactdetailsofcontactPerson_9,     
  DINofcontactPerson_9 ,    
  UIDofcontactPerson_9 ,    
  EmailIdofcontactPerson_9 ,    
  NameofcontactPerson_10 ,    
  DesignationofcontactPerson_10,     
  PANofcontactPerson_10 ,    
  AddressofcontactPerson_10 ,    
  ContactdetailsofcontactPerson_10,     
  DINofcontactPerson_10 ,    
  UIDofcontactPerson_10 ,    
  EmailIdofcontactPerson_10 ,    
  NameofcontactPerson_11 ,    
  DesignationofcontactPerson_11,     
  PANofcontactPerson_11 ,    
  AddressofcontactPerson_11 ,    
  ContactdetailsofcontactPerson_11,     
  DINofcontactPerson_11 ,    
  UIDofcontactPerson_11 ,    
  EmailIdofcontactPerson_11 ,    
  NameofcontactPerson_12 ,    
  DesignationofcontactPerson_12,     
  PANofcontactPerson_12 ,    
  AddressofcontactPerson_12 ,    
  ContactdetailsofcontactPerson_12,     
  DINofcontactPerson_12 ,    
  UIDofcontactPerson_12 ,    
  EmailIdofcontactPerson_12 ,    
  NameofcontactPerson_13 ,    
  DesignationofcontactPerson_13 ,    
  PANofcontactPerson_13 ,    
  AddressofcontactPerson_13 ,    
  ContactdetailsofcontactPerson_13 ,    
  DINofcontactPerson_13 ,    
  UIDofcontactPerson_13 ,    
  EmailIdofcontactPerson_13 ,    
  NameofcontactPerson_14 ,    
  DesignationofcontactPerson_14 ,    
  PANofcontactPerson_14 ,    
  AddressofcontactPerson_14 ,    
  ContactdetailsofcontactPerson_14 ,    
  DINofcontactPerson_14 ,    
  UIDofcontactPerson_14 ,    
  EmailIdofcontactPerson_14 ,    
  NameofcontactPerson_15 ,    
  DesignationofcontactPerson_15 ,    
  PANofcontactPerson_15 ,    
  AddressofcontactPerson_15 ,    
  ContactdetailsofcontactPerson_15,     
  DINofcontactPerson_15 ,    
  UIDofcontactPerson_15 ,    
  EmailIdofcontactPerson_15 ,    
  NameofcontactPerson_16 ,    
  DesignationofcontactPerson_16,     
  PANofcontactPerson_16 ,    
  AddressofcontactPerson_16 ,    
  ContactdetailsofcontactPerson_16,     
  DINofcontactPerson_16 ,    
  UIDofcontactPerson_16 ,    
  EmailIdofcontactPerson_16 ,    
  NameofcontactPerson_17 ,    
  DesignationofcontactPerson_17,     
  PANofcontactPerson_17 ,    
  AddressofcontactPerson_17 ,    
  ContactdetailsofcontactPerson_17,     
  DINofcontactPerson_17 ,    
  UIDofcontactPerson_17 ,    
  EmailIdofcontactPerson_17 ,    
  NameofcontactPerson_18 ,    
  DesignationofcontactPerson_18,     
  PANofcontactPerson_18 ,    
  AddressofcontactPerson_18 ,    
  ContactdetailsofcontactPerson_18,     
  DINofcontactPerson_18 ,    
  UIDofcontactPerson_18 ,    
  EmailIdofcontactPerson_18 ,    
  NameofcontactPerson_19 ,    
  DesignationofcontactPerson_19,     
  PANofcontactPerson_19 ,    
  AddressofcontactPerson_19 ,    
  ContactdetailsofcontactPerson_19,     
  DINofcontactPerson_19 ,    
  UIDofcontactPerson_19 ,    
  EmailIdofcontactPerson_19 ,    
  NameofcontactPerson_20 ,    
  DesignationofcontactPerson_20,     
  PANofcontactPerson_20 ,    
  AddressofcontactPerson_20 ,    
  ContactdetailsofcontactPerson_20,     
  DINofcontactPerson_20 ,    
  UIDofcontactPerson_20 ,    
  EmailIdofcontactPerson_20 ,    
  POAforFunds ='N',    
     POAforSecurities='N',     
  Flag='E'    
from    
 #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)    
     
where    
 len(ltrim(rtrim(isnull(pan, '')))) > 0 and    
 isnull(pan, '' ) <> 'NA'    
    
    
    
    
    
 /*****ROW COUNT****/    
declare @totalrecord numeric    
    
select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)     
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and    
 isnull(pan, '' ) <> 'NA'    
    
/*Insert Log*/    
if exists(select * from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))    
begin    
 if(@totalrecord>0)    
 begin    
  update [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count     
  set file_number=file_number+1    
  where time_stamp>=cast(left(getdate(),11) as datetime)    
 end    
end    
else    
begin    
 if(@totalrecord>0)    
 begin    
  insert into [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)    
  select 1,getdate()    
 end    
end    
     
/*Display File Name and First Row    
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)    
    Ex- uci_20140225.t04    
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count     
    Ex- 10|M|12798|27022014|04|220    
*/    
    
select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')    
    +'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),         
    FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'    
    +(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'    
    +cast(@totalrecord  as varchar)     
from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)    
    
    
/*DISPLAY INVALID PAN*/    
select Client_Code,Client_Name,PAN    
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_Deactive_client_data
-- --------------------------------------------------
  
-- [mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015] 'Feb 10 2015','Feb 10 2015','',''  
CREATE proc  
  
 [dbo].[mimansa_usp_ucc_nse_slb_Deactive_client_data]  
 (  
 @from_date varchar(20),  
 @to_date varchar(20),  
 @ClientCode varchar(20),  
 --@selected_clients_only char(1),  
 @processid varchar(50)  
 )  
as  
--mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN_9Feb2015 'Feb 10 2014','Feb 10 2014','',''  
 /*Parameter Vertualization*/  
 Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,  
   @@FromClientCode varchar(20),@@ToClientCode varchar(20)  
  
/*Initialized Parameters*/  
 if isnull(@from_date,'')='' or isnull(@to_date,'')=''  
 begin  
  set @@FromDate='Jan  1 1900'  
  set @@ToDate='Dec 31 2078'  
 end  
 else  
 begin  
  set @@FromDate=@from_date  
  set @@ToDate=@to_date+' 23:59'  
 end  
  
 if isnull(@ClientCode,'')=''  
 begin  
  set @@FromClientCode='A'  
  set @@ToClientCode='ZZZZZZZZZZ'  
 end  
 else  
 begin  
  set @@FromClientCode=@ClientCode  
  set @@ToClientCode=@ClientCode  
 end  
  
 set @@getdate=left(getdate(),11)+' 23:59'  
  
 --declare @totalrecord as numeric  
  
select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0  
  
if isnull(@processid,'')=''  
begin  
 print 'DATARANGE'  
  insert into #codes_to_process  
  select distinct party_code = ltrim(rtrim(isnull(c5.cl_code, '')))  
  from NSESLBS.dbo.client5 c5 with(nolock) join anand1.msajag.dbo.client_brok_details c with(nolock)  
  on c.cl_code=c5.cl_code  
  where c5.cl_code>=@@FromClientCode  
    and c5.cl_code<=@@ToClientCode   
    --and c5.inactivefrom >@@getdate   
    and c5.inactivefrom >= @@FromDate  
    and c5.inactivefrom <= @@ToDate  
    and c.Deactive_value = 'C'  
  --select @totalrecord = count(*) from #codes_to_process  
  
end  
else  
begin  
 print 'SELECTED'  
  insert into #codes_to_process  
  select distinct party_code = ltrim(rtrim(isnull(c5.cl_code, '')))  
  from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock), anand1.msajag.dbo.client_brok_details c with(nolock)    
  where c.cl_code=c5.cl_code and c5.cl_code=A.party_code  
    and c5.cl_code>=@@FromClientCode  
    and c5.cl_code<=@@ToClientCode  
    and A.processid=@processid   
    and c.Deactive_value = 'C'  
  
  --select @totalrecord = count(*) from #codes_to_process  
  
  /*Delete selected clients*/   
  delete from tblUCCClientCode where processid=@processid   
end  
  
 /*******************FETCH DATA**************************/  
  
 --truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes  
   
  
CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(  
 [Segment] [varchar](1) NULL,  
 [Client_Code] [varchar](10) NULL,  
 [Client_Name] [varchar](150) NULL,  
 [Category] [varchar](10) NULL,  
 [PAN] [varchar](10) NULL,  
 [Gender] [varchar](2) NULL,  
 [Fathers_Husbands_GuardiansName] [varchar](150) NULL,  
 [Maritalstatus] [varchar](2) NULL,  
 [Nationality] [varchar](2) NULL,  
 [Nationality_Other] [varchar](50) NULL,  
 [ClientEmailId] [varchar](60) NULL,  
 [CorrespondenceClientAddressline1] [varchar](255) NULL,  
 [CorrespondenceClientAddressline2] [varchar](255) NULL,  
 [CorrespondenceClientAddressline3] [varchar](255) NULL,  
 [CorrespondenceClientAddress_City] [varchar](50) NULL,  
 [CorrespondenceClientAddress_State] [varchar](2) NULL,  
 [CorrespondenceClientAddress_State_Others] [varchar](75) NULL,  
 [CorrespondenceClientAddress_Country] [varchar](3) NULL,  
 [CorrespondenceClientAddress_Pincode] [varchar](10) NULL,  
 [FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] [varchar](1) NULL,  
 [PermanentClientAddressline1] [varchar](255) NULL,  
 [PermanentClientAddressline2] [varchar](255) NULL,  
 [PermanentClientAddressline3] [varchar](255) NULL,  
 [PermanentClientAddress_City] [varchar](50) NULL,  
 [PermanentClientAddress_State] [varchar](2) NULL,  
 [PermanentClientAddress_StateOthers] [varchar](75) NULL,  
 [PermanentClientAddress_Country] [varchar](2) NULL,  
 [PermanentClientAddress_Pincode] [varchar](10) NULL,  
 [ISDcode_Residence] [varchar](10) NULL,  
 [STDcode_Residence] [varchar](10) NULL,  
 [TelephoneNumber_Residence] [varchar](60) NULL,  
 [Mobilenumber] [varchar](20) NULL,  
 [ISDcode_Office] [varchar](10) NULL,  
 [STDcode_Office] [varchar](10) NULL,  
 [TelephoneNumber_Office] [varchar](60) NULL,  
 [DateofBirth_Incorporation] [varchar](60) NULL,  
 [UIDNUMBER] [varchar](30) NULL,  
 [BankName1] [varchar](60) NULL,  
 [BankBranchAddress1] [varchar](255) NULL,  
 [BankAccountNo1] [varchar](25) NULL,  
 [BankAccountType1] [varchar](2) NULL,  
 [BankName2] [varchar](60) NULL,  
 [BankBranchAddress2] [varchar](255) NULL,  
 [BankAccountNo2] [varchar](25) NULL,  
 [BankAccountType2] [varchar](2) NULL,  
 [BankName3] [varchar](60) NULL,  
 [BankBranchAddress3] [varchar](255) NULL,  
 [BankAccountNo3] [varchar](25) NULL,  
 [BankAccountType3] [varchar](2) NULL,  
 [DepositoryName1] [varchar](4) NULL,  
 [DepositoryID1] [varchar](8) NULL,  
 [BeneficialOwnerAccountNo1] [varchar](16) NULL,  
 [DepositoryName2] [varchar](4) NULL,  
 [DepositoryID2] [varchar](8) NULL,  
 [BeneficialOwnerAccountNo2] [varchar](16) NULL,  
 [DepositoryName3] [varchar](4) NULL,  
 [DepositoryID3] [varchar](8) NULL,  
 [BeneficialOwnerAccountNo3] [varchar](16) NULL,  
 [CorporateIdentitynumber_CIN] [varchar](21) NULL,  
 [GrossAnnualIncomeRange] [varchar](40) NULL,  
 [GrossAnnualIncomeasonDate] [varchar](40) NULL,  
 [NetWorth_InRs] [varchar](40) NULL,  
 [NetWorthasonDate] [varchar](40) NULL,  
 [PoliticallyExposedPerson_PEP] [varchar](2) NULL,  
 [PlaceofIncorporation] [varchar](75) NULL,  
 [Occupation] [varchar](2) NULL,  
 [OccupationDetails_Forothers] [varchar](75) NULL,  
 [Dateofcommencementofbusiness] [varchar](40) NULL,  
 [CustodialParticipantCodeoftheclient] [varchar](15) NULL,  
 [RegistrationNoofClient] [varchar](25) NULL,  
 [RegisteringAuthority] [varchar](60) NULL,  
 [PlaceofRegistration] [varchar](25) NULL,  
 [DateofRegistration] [varchar](40) NULL,  
 [InpersonVerification] [varchar](1) NULL,  
 [ClientAgreementDate] [varchar](40) NULL,  
 [UniqueClientCodeallottedbyNSCCL_BSE] [varchar](10) NULL,  
 [UpdationFlag_for_SMS_and_Email_facility] [varchar](1) NULL,  
 [Relationship] [varchar](1) NULL,  
 [TypeofFacility_for_SMS_and_Email_facility] [varchar](1) NULL,  
 [ProofType] [varchar](1) NULL,  
 [ProofNumber] [varchar](25) NULL,  
 [IssuePlaceofProof] [varchar](100) NULL,  
 [IssueDateofProof] [varchar](40) NULL,  
 [ClientStatus] [varchar](1) NULL,  
 [Remarks] [varchar](200) NULL,  
 [ClientType_Corporate] [varchar](200) NULL,  
 [NameofcontactPerson_1] [varchar](200) NULL,  
 [DesignationofContactPerson_1] [varchar](200) NULL,  
 [PANofcontactPerson_1] [varchar](200) NULL,  
 [AddressofcontactPerson_1] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_1] [varchar](200) NULL,  
 [DINofcontactPerson_1] [varchar](200) NULL,  
 [UIDofcontactPerson_1] [varchar](200) NULL,  
 [EmailIdofcontactPerson_1] [varchar](200) NULL,  
 [NameofcontactPerson_2] [varchar](200) NULL,  
 [DesignationofcontactPerson_2] [varchar](200) NULL,  
 [PANofcontactPerson_2] [varchar](200) NULL,  
 [AddressofcontactPerson_2] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_2] [varchar](200) NULL,  
 [DINofcontactPerson_2] [varchar](200) NULL,  
 [UIDofcontactPerson_2] [varchar](200) NULL,  
 [EmailIdofcontactPerson_2] [varchar](200) NULL,  
 [NameofcontactPerson_3] [varchar](200) NULL,  
 [DesignationofcontactPerson_3] [varchar](200) NULL,  
 [PANofcontactPerson_3] [varchar](200) NULL,  
 [AddressofcontactPerson_3] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_3] [varchar](200) NULL,  
 [DINofcontactPerson_3] [varchar](200) NULL,  
 [UIDofcontactPerson_3] [varchar](200) NULL,  
 [EmailIdofcontactPerson_3] [varchar](200) NULL,  
 [NameofcontactPerson_4] [varchar](200) NULL,  
 [DesignationofcontactPerson_4] [varchar](200) NULL,  
 [PANofcontactPerson_4] [varchar](200) NULL,  
 [AddressofcontactPerson_4] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_4] [varchar](200) NULL,  
 [DINofcontactPerson_4] [varchar](200) NULL,  
 [UIDofcontactPerson_4] [varchar](200) NULL,  
 [EmailIdofcontactPerson_4] [varchar](200) NULL,  
 [NameofcontactPerson_5] [varchar](200) NULL,  
 [DesignationofcontactPerson_5] [varchar](200) NULL,  
 [PANofcontactPerson_5] [varchar](200) NULL,  
 [AddressofcontactPerson_5] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_5] [varchar](200) NULL,  
 [DINofcontactPerson_5] [varchar](200) NULL,  
 [UIDofcontactPerson_5] [varchar](200) NULL,  
 [EmailIdofcontactPerson_5] [varchar](200) NULL,  
 [NameofcontactPerson_6] [varchar](200) NULL,  
 [DesignationofcontactPerson_6] [varchar](200) NULL,  
 [PANofcontactPerson_6] [varchar](200) NULL,  
 [AddressofcontactPerson_6] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_6] [varchar](200) NULL,  
 [DINofcontactPerson_6] [varchar](200) NULL,  
 [UIDofcontactPerson_6] [varchar](200) NULL,  
 [EmailIdofcontactPerson_6] [varchar](200) NULL,  
 [NameofcontactPerson_7] [varchar](200) NULL,  
 [DesignationofcontactPerson_7] [varchar](200) NULL,  
 [PANofcontactPerson_7] [varchar](200) NULL,  
 [AddressofcontactPerson_7] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_7] [varchar](200) NULL,  
 [DINofcontactPerson_7] [varchar](200) NULL,  
 [UIDofcontactPerson_7] [varchar](200) NULL,  
 [EmailIdofcontactPerson_7] [varchar](200) NULL,  
 [NameofcontactPerson_8] [varchar](200) NULL,  
 [DesignationofcontactPerson_8] [varchar](200) NULL,  
 [PANofcontactPerson_8] [varchar](200) NULL,  
 [AddressofcontactPerson_8] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_8] [varchar](200) NULL,  
 [DINofcontactPerson_8] [varchar](200) NULL,  
 [UIDofcontactPerson_8] [varchar](200) NULL,  
 [EmailIdofcontactPerson_8] [varchar](200) NULL,  
 [NameofcontactPerson_9] [varchar](200) NULL,  
 [DesignationofcontactPerson_9] [varchar](200) NULL,  
 [PANofcontactPerson_9] [varchar](200) NULL,  
 [AddressofcontactPerson_9] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_9] [varchar](200) NULL,  
 [DINofcontactPerson_9] [varchar](200) NULL,  
 [UIDofcontactPerson_9] [varchar](200) NULL,  
 [EmailIdofcontactPerson_9] [varchar](200) NULL,  
 [NameofcontactPerson_10] [varchar](200) NULL,  
 [DesignationofcontactPerson_10] [varchar](200) NULL,  
 [PANofcontactPerson_10] [varchar](200) NULL,  
 [AddressofcontactPerson_10] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_10] [varchar](200) NULL,  
 [DINofcontactPerson_10] [varchar](200) NULL,  
 [UIDofcontactPerson_10] [varchar](200) NULL,  
 [EmailIdofcontactPerson_10] [varchar](200) NULL,  
 [NameofcontactPerson_11] [varchar](200) NULL,  
 [DesignationofcontactPerson_11] [varchar](200) NULL,  
 [PANofcontactPerson_11] [varchar](200) NULL,  
 [AddressofcontactPerson_11] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_11] [varchar](200) NULL,  
 [DINofcontactPerson_11] [varchar](200) NULL,  
 [UIDofcontactPerson_11] [varchar](200) NULL,  
 [EmailIdofcontactPerson_11] [varchar](200) NULL,  
 [NameofcontactPerson_12] [varchar](200) NULL,  
 [DesignationofcontactPerson_12] [varchar](200) NULL,  
 [PANofcontactPerson_12] [varchar](200) NULL,  
 [AddressofcontactPerson_12] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_12] [varchar](200) NULL,  
 [DINofcontactPerson_12] [varchar](200) NULL,  
 [UIDofcontactPerson_12] [varchar](200) NULL,  
 [EmailIdofcontactPerson_12] [varchar](200) NULL,  
 [NameofcontactPerson_13] [varchar](200) NULL,  
 [DesignationofcontactPerson_13] [varchar](200) NULL,  
 [PANofcontactPerson_13] [varchar](200) NULL,  
 [AddressofcontactPerson_13] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_13] [varchar](200) NULL,  
 [DINofcontactPerson_13] [varchar](200) NULL,  
 [UIDofcontactPerson_13] [varchar](200) NULL,  
 [EmailIdofcontactPerson_13] [varchar](200) NULL,  
 [NameofcontactPerson_14] [varchar](200) NULL,  
 [DesignationofcontactPerson_14] [varchar](200) NULL,  
 [PANofcontactPerson_14] [varchar](200) NULL,  
 [AddressofcontactPerson_14] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_14] [varchar](200) NULL,  
 [DINofcontactPerson_14] [varchar](200) NULL,  
 [UIDofcontactPerson_14] [varchar](200) NULL,  
 [EmailIdofcontactPerson_14] [varchar](200) NULL,  
 [NameofcontactPerson_15] [varchar](200) NULL,  
 [DesignationofcontactPerson_15] [varchar](200) NULL,  
 [PANofcontactPerson_15] [varchar](200) NULL,  
 [AddressofcontactPerson_15] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_15] [varchar](200) NULL,  
 [DINofcontactPerson_15] [varchar](200) NULL,  
 [UIDofcontactPerson_15] [varchar](200) NULL,  
 [EmailIdofcontactPerson_15] [varchar](200) NULL,  
 [NameofcontactPerson_16] [varchar](200) NULL,  
 [DesignationofcontactPerson_16] [varchar](200) NULL,  
 [PANofcontactPerson_16] [varchar](200) NULL,  
 [AddressofcontactPerson_16] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_16] [varchar](200) NULL,  
 [DINofcontactPerson_16] [varchar](200) NULL,  
 [UIDofcontactPerson_16] [varchar](200) NULL,  
 [EmailIdofcontactPerson_16] [varchar](200) NULL,  
 [NameofcontactPerson_17] [varchar](200) NULL,  
 [DesignationofcontactPerson_17] [varchar](200) NULL,  
 [PANofcontactPerson_17] [varchar](200) NULL,  
 [AddressofcontactPerson_17] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_17] [varchar](200) NULL,  
 [DINofcontactPerson_17] [varchar](200) NULL,  
 [UIDofcontactPerson_17] [varchar](200) NULL,  
 [EmailIdofcontactPerson_17] [varchar](200) NULL,  
 [NameofcontactPerson_18] [varchar](200) NULL,  
 [DesignationofcontactPerson_18] [varchar](200) NULL,  
 [PANofcontactPerson_18] [varchar](200) NULL,  
 [AddressofcontactPerson_18] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_18] [varchar](200) NULL,  
 [DINofcontactPerson_18] [varchar](200) NULL,  
 [UIDofcontactPerson_18] [varchar](200) NULL,  
 [EmailIdofcontactPerson_18] [varchar](200) NULL,  
 [NameofcontactPerson_19] [varchar](200) NULL,  
 [DesignationofcontactPerson_19] [varchar](200) NULL,  
 [PANofcontactPerson_19] [varchar](200) NULL,  
 [AddressofcontactPerson_19] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_19] [varchar](200) NULL,  
 [DINofcontactPerson_19] [varchar](200) NULL,  
 [UIDofcontactPerson_19] [varchar](200) NULL,  
 [EmailIdofcontactPerson_19] [varchar](200) NULL,  
 [NameofcontactPerson_20] [varchar](200) NULL,  
 [DesignationofcontactPerson_20] [varchar](200) NULL,  
 [PANofcontactPerson_20] [varchar](200) NULL,  
 [AddressofcontactPerson_20] [varchar](200) NULL,  
 [ContactdetailsofcontactPerson_20] [varchar](200) NULL,  
 [DINofcontactPerson_20] [varchar](200) NULL,  
 [UIDofcontactPerson_20] [varchar](200) NULL,  
 [EmailIdofcontactPerson_20] [varchar](200) NULL,  
 [POAforFunds] [varchar](1) NULL,  
 [POAforSecurities] [varchar](1) NULL,  
 [Flag] [varchar](1) NULL  
)  
   
 --insert into   
 -- angel_ucc_nse_fo_client1  
 select  
  party_code = ltrim(rtrim(c2.party_code)),  
  --c1.*  
  Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),  
  Short_Name=ltrim(rtrim(isnull(Short_Name,''))),  
  Long_Name=ltrim(rtrim(isnull(Long_Name,''))),  
  L_Address1=ltrim(rtrim(isnull(L_Address1,''))),  
  L_Address2=ltrim(rtrim(isnull(L_Address2,''))),  
  L_Address3=ltrim(rtrim(isnull(L_Address3,''))),  
  L_city=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_city,'')))),  
  L_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_State,'')))),  
  L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),  
  L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),  
  L_Zip=ltrim(rtrim(isnull(L_Zip,''))),  
  --Fax=ltrim(rtrim(isnull(Fax,''))),  
  Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),  
  Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),  
  Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),  
  Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),  
  Email=ltrim(rtrim(isnull(Email,''))),  
  --Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),  
  --Credit_Limit=ltrim(rtrim(Credit_Limit)),  
  Cl_type=ltrim(rtrim(isnull(Cl_type,''))),  
  Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),  
  --Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),  
  --Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),  
  --Family=ltrim(rtrim(isnull(Family,''))),  
  --Penalty=ltrim(rtrim(Penalty)),  
  --Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),  
  --Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),  
  --PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),  
  Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),  
  pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),  
  --trader=ltrim(rtrim(isnull(trader,''))),  
  --Ward_No=ltrim(rtrim(isnull(Ward_No,''))),  
  --Region=ltrim(rtrim(isnull(Region,''))),  
  --Area=ltrim(rtrim(isnull(Area,''))),  
  --Clrating=ltrim(rtrim(isnull(Clrating,'')))  
  P_address1=cast('' as varchar(255)),  
  P_address2=cast('' as varchar(255)),  
  P_address3=cast('' as varchar(255)),  
  P_City=cast('' as varchar(50)),  
  P_State=cast('' as varchar(100)),  
  P_State_For_Other=cast('' as varchar(100)),  
  P_nation=cast('' as varchar(100)),  
  P_zip=cast('' as varchar(10)),  
  P_Len=cast('' as varchar(1)),   
  Gender=cast('' as varchar(1)),  
  STDcode_Residence1=cast('' as varchar(10)),  
  STDcode_Residence2=cast('' as varchar(10)),  
  STDcode_Office1=cast('' as varchar(10)),  
  STDcode_Office2=cast('' as varchar(10))  
 into   
  #temp_client1   
 from   
  NSESLBS.dbo.client1 c1 with(nolock),  
  NSESLBS.dbo.client2 c2 with(nolock),  
  #codes_to_process t with (nolock)  
 where   
  c1.cl_code = c2.cl_code and   
  c2.party_code = t.party_code   
  
 update #temp_client1 set   
  P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),  
  P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),  
  P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),  
  P_City=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_City,'')))),  
  P_State=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),  
  P_State_For_Other=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_State,'')))),  
  P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),  
  P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),  
  P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and   
      len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0  
    then 'N' else 'Y' end ,  
  Gender=ltrim(rtrim(isnull(c1.sex,''))),  
  STDcode_Residence1=isnull(Res_phone1_std,''),  
  STDcode_Residence2=isnull(Res_phone1_std,''),  
  STDcode_Office1=isnull(Off_phone1_std,''),  
  STDcode_Office2=isnull(off_phone2_std,'')  
 from #temp_client1 t1 , anand1.msajag.dbo.Client_Details c1 with(nolock)  
 where t1.Cl_Code=c1.cl_code  
  
 update   
  #temp_Client1   
 set   
 L_State= dbo.fn_state_countary_value(l_state,'STATE'),  
 P_State=dbo.fn_state_countary_value(P_state,'STATE'),  
 L_nation=dbo.fn_state_countary_value(L_Nation,'NATION'),  
 P_Nation=dbo.fn_state_countary_value(P_Nation,'NATION'),  
 cl_status=case  
    /*INDIVIDUAL/PROPRIETORSHIP FIRMS*/  
    when cl_status = 'IND' then '1'  /*INDIVIDUAL*/  
  
    /*PARTNERSHIP FIRM*/  
    when cl_status = 'PF' or cl_status='LLP' then '2'  /*PARTNERSHIP FIRMS*/  
  
    /*HUF*/  
    when cl_status = 'HUF' then '3'  /*HINDU UNDIVIDED FAMILY*/  
  
    /*PUBLIC & PRIVATE COMPANIES / BODIES CORPORATE*/  
    when cl_status = 'PPB' then '4'  /*PUB. PVT COMP/BODIES CORP*/  
    when cl_status = 'BCP' then '4'  /*BODY CORPORATE*/  
  
    /*TRUST / SOCIETY*/  
    when cl_status = 'TS' then '5'  /*TRUST / SOCIETY*/  
  
    /*MUTUAL FUND*/  
    when cl_status = 'MF' then '6'  /*MUTUAL FUNDS*/  
    when cl_status = 'MFF' then '6'  /*MUTUAL FUND (MF)*/  
  
    /*DOMESTIC FINANCIAL INSTITUTIONS (OTHER THAN BANKS & INSURANCE)*/  
    when cl_status = 'IFI' then '7'  /*INDIAN FINANCIAL INSTI*/  
    when cl_status = 'DFI' then '7'  /*DOMESTIC FIN. INST.*/  
  
    /*BANK*/  
    when cl_status = 'BA' then ' 8'  /*BANKS*/  
    when cl_status = 'BNK' then '8'  /*BANK*/  
  
    /*INSURANCE*/  
    when cl_status = 'IC' then ' 9'  /*INSURANCE COMPANIES*/  
  
    /*STATUTORY BODIES*/  
    when cl_status = 'SB' then ' 10'  /*STATUTORY BODIES*/  
  
    /*NRI*/  
    when cl_status = 'NRI' or cl_status='NRE' or cl_status='NRO' then '11'  /*NON RESIDENT INDIAN*/  
  
    /*FII*/  
    when cl_status = 'FII' then '12'  /*FOREIGN INSTIT INVESTORS*/  
  
    /*OCB*/  
    when cl_status = 'OCB' then '13'  /*OVERSEAS CORPORATE BODIES*/  
  
    /*FOREIGN DIRECT INVESTMENTS (FDI) / FOREIGN VENTURE CAPITAL FUNDS (VC)*/  
    when cl_status = 'DFN' then '14'  /*DIRECT FOREIGN INVESTMENTS*/  
  
    when cl_status = 'QFI' then '17'       /*Qualified foreign investors*/  
      
    /*FVC*/  
    when cl_status = 'FVC' then '20'  /*FOREIGN VENTURE CAPITAL FUNDS*/  
   else  
    '1'  /*INDIVIDUAL*/  
   end  
  
   
 select   
  Cl_Code, Party_code=c2.Party_code  
 into #temp_client2   
 from   
  NSESLBS.dbo.client2 c2 with(nolock),  
  #codes_to_process t with (nolock)  
 where   
  c2.party_code = t.party_code  
   
 select   
  party_code = ltrim(rtrim(t.party_code)),  
  --c5.*  
  cl_code=ltrim(rtrim(isnull(c5.cl_code,''))),  
  --BirthDate=ltrim(rtrim(isnull(c5.BirthDate,''))),  
  BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.Birthdate, 113),' ','-'),'')))),  
  --ActiveFrom=ltrim(rtrim(isnull(c5.ActiveFrom,''))), /*Change on 26 Apr 2014: Changes for NSE SLB */  
  ActiveFrom=c5.ActiveFrom,  
  InactiveFrom=ltrim(rtrim(isnull(c5.InactiveFrom,''))),  
  GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c5.ActiveFrom, 113),' ','-'),''))))  
 into #temp_Client5   
 from   
  NSESLBS.dbo.client5 c5 with(nolock),  
  #temp_Client2 t with (nolock)  
 where   
  c5.cl_code = t.cl_code  
  
 select distinct  
  party_code = ltrim(rtrim(c4.party_code)),  
  bank_id = ltrim(rtrim(c4.bankid)),  
  bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),  
  bank_address = ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1)
 + ltrim(rtrim(isnull(b.nation, ''))),  
  account_type = ltrim(rtrim(c4.depository)),  
  account_no = ltrim(rtrim(c4.cltdpid))  
 into  
  #pobank  
 from  
  #codes_to_process t with (nolock),  
  NSESLBS.dbo.client4 c4 with(nolock),  
  NSESLBS.dbo.pobank b with(nolock)  
 where  
  t.party_code = c4.party_code and  
  c4.bankid = b.bankid and  
  isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')  
  
 select distinct  
  party_code = ltrim(rtrim(c4.party_code)),  
  bank_id = ltrim(rtrim(c4.bankid)),  
  bank_name = ltrim(rtrim(isnull(b.bankname, ''))),  
  bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),  
  account_type = ltrim(rtrim(c4.depository)),  
  account_no = ltrim(rtrim(c4.cltdpid))  
 into  
  #bank  
 from  
  #codes_to_process t with (nolock),  
  NSESLBS.dbo.client4 c4 with(nolock),  
  NSESLBS.dbo.bank b with(nolock)  
 where  
  t.party_code = c4.party_code and  
  c4.bankid = b.bankid and  
  isnull(c4.depository, '') in ('CDSL', 'NSDL') and  
  isnull(c4.defdp, '') = '1'  
  
 --insert into  
 -- angel_ucc_nse_fo_client_bank  
 select distinct  
  party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),  
  bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),  
  bank_address = ltrim(rtrim(isnull(po.bank_address, ''))),  
  bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),  
  bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),  
  
  dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),  
  dp_name = ltrim(rtrim(isnull(b.account_type, ''))),  
  depository_participant = ltrim(rtrim(isnull(b.bank_name, ''))),  
  demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))  
 into #temp_client_bank   
 from  
  #pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))  
 order by  
  ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))  
  
  
 /*******************END - FETCH DATA**************************/  
  
 insert into  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
  (  
   Segment ,  
   Client_Code ,  
   Client_Name ,  
   Category ,  
   PAN ,  
   Gender ,  
   Fathers_Husbands_GuardiansName ,  
   Maritalstatus ,  
   Nationality ,  
   Nationality_Other ,  
   ClientEmailId ,  
   CorrespondenceClientAddressline1 ,  
   CorrespondenceClientAddressline2 ,  
   CorrespondenceClientAddressline3 ,  
   CorrespondenceClientAddress_City ,  
   CorrespondenceClientAddress_State ,  
   CorrespondenceClientAddress_State_Others ,  
   CorrespondenceClientAddress_Country ,  
   CorrespondenceClientAddress_Pincode ,  
   FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,  
   PermanentClientAddressline1 ,  
   PermanentClientAddressline2 ,  
   PermanentClientAddressline3 ,  
   PermanentClientAddress_City ,  
   PermanentClientAddress_State ,  
   PermanentClientAddress_StateOthers ,  
   PermanentClientAddress_Country ,  
   PermanentClientAddress_Pincode ,  
   ISDcode_Residence ,  
   STDcode_Residence ,  
   TelephoneNumber_Residence ,  
   Mobilenumber ,  
   ISDcode_Office ,  
   STDcode_Office ,  
   TelephoneNumber_Office ,  
   DateofBirth_Incorporation ,  
   UIDNUMBER ,  
   BankName1 ,  
   BankBranchAddress1 ,  
   BankAccountNo1 ,  
   BankAccountType1 ,  
   BankName2 ,  
   BankBranchAddress2 ,  
   BankAccountNo2 ,  
   BankAccountType2 ,  
   BankName3 ,  
   BankBranchAddress3 ,  
   BankAccountNo3 ,  
   BankAccountType3 ,  
   DepositoryName1 ,  
   DepositoryID1 ,  
   BeneficialOwnerAccountNo1 ,  
   DepositoryName2 ,  
   DepositoryID2 ,  
   BeneficialOwnerAccountNo2 ,  
   DepositoryName3 ,  
   DepositoryID3 ,  
   BeneficialOwnerAccountNo3 ,  
   CorporateIdentitynumber_CIN ,  
   GrossAnnualIncomeRange ,  
   GrossAnnualIncomeasonDate ,  
   NetWorth_InRs ,  
   NetWorthasonDate ,  
   PoliticallyExposedPerson_PEP ,  
   PlaceofIncorporation ,  
   Occupation ,  
   OccupationDetails_Forothers ,  
   Dateofcommencementofbusiness ,  
   CustodialParticipantCodeoftheclient ,  
   RegistrationNoofClient ,  
   RegisteringAuthority ,  
   PlaceofRegistration ,  
   DateofRegistration ,  
   InpersonVerification ,  
   ClientAgreementDate ,  
   UniqueClientCodeallottedbyNSCCL_BSE ,  
   UpdationFlag_for_SMS_and_Email_facility ,  
   Relationship ,  
   TypeofFacility_for_SMS_and_Email_facility ,  
   ProofType ,  
   ProofNumber ,  
   IssuePlaceofProof ,  
   IssueDateofProof ,  
   ClientStatus ,  
   Remarks ,  
   ClientType_Corporate ,  
   NameofcontactPerson_1 ,  
   DesignationofContactPerson_1 ,  
   PANofcontactPerson_1 ,  
   AddressofcontactPerson_1 ,  
   ContactdetailsofcontactPerson_1 ,  
   DINofcontactPerson_1 ,  
   UIDofcontactPerson_1 ,  
   EmailIdofcontactPerson_1 ,  
   NameofcontactPerson_2 ,  
   DesignationofcontactPerson_2 ,  
   PANofcontactPerson_2 ,  
   AddressofcontactPerson_2 ,  
   ContactdetailsofcontactPerson_2 ,  
   DINofcontactPerson_2 ,  
   UIDofcontactPerson_2 ,  
   EmailIdofcontactPerson_2 ,  
   NameofcontactPerson_3 ,  
   DesignationofcontactPerson_3 ,  
   PANofcontactPerson_3 ,  
   AddressofcontactPerson_3 ,  
   ContactdetailsofcontactPerson_3 ,  
   DINofcontactPerson_3 ,  
   UIDofcontactPerson_3 ,  
   EmailIdofcontactPerson_3 ,  
   NameofcontactPerson_4 ,  
   DesignationofcontactPerson_4 ,  
   PANofcontactPerson_4 ,  
   AddressofcontactPerson_4 ,  
   ContactdetailsofcontactPerson_4 ,  
   DINofcontactPerson_4 ,  
   UIDofcontactPerson_4 ,  
   EmailIdofcontactPerson_4 ,  
   NameofcontactPerson_5 ,  
   DesignationofcontactPerson_5 ,  
   PANofcontactPerson_5 ,  
   AddressofcontactPerson_5 ,  
   ContactdetailsofcontactPerson_5 ,  
   DINofcontactPerson_5 ,  
   UIDofcontactPerson_5 ,  
   EmailIdofcontactPerson_5 ,  
   NameofcontactPerson_6 ,  
   DesignationofcontactPerson_6 ,  
   PANofcontactPerson_6 ,  
   AddressofcontactPerson_6 ,  
   ContactdetailsofcontactPerson_6 ,  
   DINofcontactPerson_6 ,  
   UIDofcontactPerson_6 ,  
   EmailIdofcontactPerson_6 ,  
   NameofcontactPerson_7 ,  
   DesignationofcontactPerson_7 ,  
   PANofcontactPerson_7 ,  
   AddressofcontactPerson_7 ,  
   ContactdetailsofcontactPerson_7 ,  
   DINofcontactPerson_7 ,  
   UIDofcontactPerson_7 ,  
   EmailIdofcontactPerson_7 ,  
   NameofcontactPerson_8 ,  
   DesignationofcontactPerson_8 ,  
   PANofcontactPerson_8 ,  
   AddressofcontactPerson_8 ,  
   ContactdetailsofcontactPerson_8 ,  
   DINofcontactPerson_8 ,  
   UIDofcontactPerson_8 ,  
   EmailIdofcontactPerson_8 ,  
   NameofcontactPerson_9 ,  
   DesignationofcontactPerson_9 ,  
   PANofcontactPerson_9 ,  
   AddressofcontactPerson_9 ,  
   ContactdetailsofcontactPerson_9 ,  
   DINofcontactPerson_9 ,  
   UIDofcontactPerson_9 ,  
   EmailIdofcontactPerson_9 ,  
   NameofcontactPerson_10 ,  
   DesignationofcontactPerson_10 ,  
   PANofcontactPerson_10 ,  
   AddressofcontactPerson_10 ,  
   ContactdetailsofcontactPerson_10 ,  
   DINofcontactPerson_10 ,  
   UIDofcontactPerson_10 ,  
   EmailIdofcontactPerson_10 ,  
   NameofcontactPerson_11 ,  
   DesignationofcontactPerson_11 ,  
   PANofcontactPerson_11 ,  
   AddressofcontactPerson_11 ,  
   ContactdetailsofcontactPerson_11 ,  
   DINofcontactPerson_11 ,  
   UIDofcontactPerson_11 ,  
   EmailIdofcontactPerson_11 ,  
   NameofcontactPerson_12 ,  
   DesignationofcontactPerson_12 ,  
   PANofcontactPerson_12 ,  
   AddressofcontactPerson_12 ,  
   ContactdetailsofcontactPerson_12 ,  
   DINofcontactPerson_12 ,  
   UIDofcontactPerson_12 ,  
   EmailIdofcontactPerson_12 ,  
   NameofcontactPerson_13 ,  
   DesignationofcontactPerson_13 ,  
   PANofcontactPerson_13 ,  
   AddressofcontactPerson_13 ,  
   ContactdetailsofcontactPerson_13 ,  
   DINofcontactPerson_13 ,  
   UIDofcontactPerson_13 ,  
   EmailIdofcontactPerson_13 ,  
   NameofcontactPerson_14 ,  
   DesignationofcontactPerson_14 ,  
   PANofcontactPerson_14 ,  
   AddressofcontactPerson_14 ,  
   ContactdetailsofcontactPerson_14 ,  
   DINofcontactPerson_14 ,  
   UIDofcontactPerson_14 ,  
   EmailIdofcontactPerson_14 ,  
   NameofcontactPerson_15 ,  
   DesignationofcontactPerson_15 ,  
   PANofcontactPerson_15 ,  
   AddressofcontactPerson_15 ,  
   ContactdetailsofcontactPerson_15 ,  
   DINofcontactPerson_15 ,  
   UIDofcontactPerson_15 ,  
   EmailIdofcontactPerson_15 ,  
   NameofcontactPerson_16 ,  
   DesignationofcontactPerson_16 ,  
   PANofcontactPerson_16 ,  
   AddressofcontactPerson_16 ,  
   ContactdetailsofcontactPerson_16 ,  
   DINofcontactPerson_16 ,  
   UIDofcontactPerson_16 ,  
   EmailIdofcontactPerson_16 ,  
   NameofcontactPerson_17 ,  
   DesignationofcontactPerson_17 ,  
   PANofcontactPerson_17 ,  
   AddressofcontactPerson_17 ,  
   ContactdetailsofcontactPerson_17 ,  
   DINofcontactPerson_17 ,  
   UIDofcontactPerson_17 ,  
   EmailIdofcontactPerson_17 ,  
   NameofcontactPerson_18 ,  
   DesignationofcontactPerson_18 ,  
   PANofcontactPerson_18 ,  
   AddressofcontactPerson_18 ,  
   ContactdetailsofcontactPerson_18 ,  
   DINofcontactPerson_18 ,  
   UIDofcontactPerson_18 ,  
   EmailIdofcontactPerson_18 ,  
   NameofcontactPerson_19 ,  
   DesignationofcontactPerson_19 ,  
   PANofcontactPerson_19 ,  
   AddressofcontactPerson_19 ,  
   ContactdetailsofcontactPerson_19 ,  
   DINofcontactPerson_19 ,  
   UIDofcontactPerson_19 ,  
   EmailIdofcontactPerson_19 ,  
   NameofcontactPerson_20 ,  
   DesignationofcontactPerson_20 ,  
   PANofcontactPerson_20 ,  
   AddressofcontactPerson_20 ,  
   ContactdetailsofcontactPerson_20 ,  
   DINofcontactPerson_20 ,  
   UIDofcontactPerson_20 ,  
   EmailIdofcontactPerson_20 ,  
   POAforFunds ,  
         POAforSecurities,   
   Flag   
   )  
 select  
  segment = 'S',  
  client_code = c2.party_code,  
  client_name = left(c1_b.long_name, 150),  
  category =cl_status,  
  pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),  
  Gender=(case when cl_status in ('2','3','4','5') then '' else ltrim(rtrim(c1_b.Gender)) end), /*Change on 26 Apr 2014: Changes for NSE SLB */  
  Fathers_Husbands_GuardiansName ='',  
  Maritalstatus='',  
  Nationality ='',  
  Nationality_Other='',   
  ClientEmailId = left(email, 60),  
  CorrespondenceClientAddressline1 = left(  
   case  
    when len(c1_b.l_address1) = 0  
    then ''  
    else ltrim(rtrim(isnull(c1_b.l_address1, '')))  
    end  
   +  
   case  
    when len(c1_b.l_address2) = 0  
    then ''  
    else ltrim(rtrim(isnull(c1_b.l_address2, '')))  
    end  
   +  
   case  
    when len(c1_b.l_address3) = 0  
    then ''  
    else ltrim(rtrim(isnull(c1_b.l_address3, '')))  
    end, 255  
   ),  
  
  CorrespondenceClientAddressline2 = '',  
  CorrespondenceClientAddressline3 = '',  
  CorrespondenceClientAddress_City = left(c1_b.l_city, 50),  
  CorrespondenceClientAddress_State = c1_b.l_state,  
  CorrespondenceClientAddress_State_Others=case when c1_b.l_state='99' then c1_b.L_State_For_Other else '' end,  
  CorrespondenceClientAddress_Country = left(c1_b.l_nation, 50),  
  CorrespondenceClientAddress_Pincode =   
  case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then  
    case  
     when len(c1_b.l_zip) <> 6 then ''  
     when len(c1_b.l_zip) = 0 then ''  
     else c1_b.l_zip  
    end  
  else  
   c1_b.l_zip  
  end  ,  
  FlagIndicatingifCorrespondenceAddressissameasPermanentAddress=c1_b.P_Len,   
  /*Modify on 30 Apr 2014*/  
  PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255)+' '+left(c1_b.P_address2, 255)+' '+left(c1_b.P_address3, 255) else '' end,   
  PermanentClientAddressline2 ='',  
  PermanentClientAddressline3 ='',     
  /*PermanentClientAddressline1 =case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,  
  PermanentClientAddressline2 =case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,  
  PermanentClientAddressline3 =case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,*/  
  PermanentClientAddress_City =case when c1_b.P_Len='N' then left(c1_b.P_city, 50) else '' end,  
  PermanentClientAddress_State =case when c1_b.P_Len='N' then c1_b.P_State else '' end ,  
  PermanentClientAddress_StateOthers  =case when c1_b.P_Len='N' and c1_b.P_state='99' then c1_b.P_State_For_Other else '' end,  
  PermanentClientAddress_Country =case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,  
  PermanentClientAddress_Pincode =  
  case when c1_b.P_Len='N' then   
   case when c1_b.cl_status in ('1','2','3','4','5','6','7','8','9','10','15','16','19') then  
    case  
     when len(c1_b.l_zip) <> 6 then ''  
     when len(c1_b.l_zip) = 0 then ''  
     else c1_b.l_zip  
    end  
   else  
    c1_b.l_zip  
   end  
  else ''       
  end,  
  ISDcode_Residence ='',  
  STDcode_Residence =case   
       when len(STDcode_Residence1)>0 then STDcode_Residence1  
       when len(STDcode_Residence2)>0 then STDcode_Residence2  
         else '' end,   
  TelephoneNumber_Residence =   
   left( case   
      when len(isnull(c1_b.res_phone1, '')) > 0 then isnull(c1_b.res_phone1, '')  
      when len(isnull(c1_b.res_phone2, '')) > 0 then isnull(c1_b.res_phone2, '')  
     else   
      ''   
     end  
    , 60  
    ),  
  Mobilenumber =left(c1_b.mobile_pager, 10),  
  ISDcode_Office ='',  
  STDcode_Office =case   
       when len(STDcode_Office1)>0 then STDcode_Office1  
       when len(STDcode_Office2)>0 then STDcode_Office2  
         else '' end,  
  TelephoneNumber_Office=  
   left( case   
      when len(isnull(c1_b.off_phone1, '')) > 0 then isnull(c1_b.off_phone1, '')  
      when len(isnull(c1_b.off_phone2, '')) > 0 then isnull(c1_b.off_phone2, '')  
     else   
      ''   
     end  
    , 60  
    ),  
  DateofBirth_Incorporation = case when c5.BirthDate='01-JAN-1900' then '' else c5.BirthDate end ,  
  UIDNUMBER='',  
  
   
  BankName1 =bank_name,  
  BankBranchAddress1=case when len(bank_address)>0 then 'Branch Address '+ bank_address else '' end ,   
  BankAccountNo1 =bank_account_no,  
  BankAccountType1 =case   
       when bank_account_type = 'SAVING' then '10'  
       when bank_account_type = 'CURRENT' then '11'  
       when bank_account_type = 'OTHER' then '99'   
        else ''  
       end ,  
  BankName2 ='',  
  BankBranchAddress2 ='',  
  BankAccountNo2 ='',  
  BankAccountType2 ='',  
  BankName3 ='',  
  BankBranchAddress3 ='',  
  BankAccountNo3 ='',  
  BankAccountType3 ='',  
    
  DepositoryName1 =dp_name,  
  DepositoryID1 = case when dp_name='NSDL' then dp_id else '' end,  
  BeneficialOwnerAccountNo1 =demat_id_of_client,  
    
  DepositoryName2 ='',  
  DepositoryID2 ='',  
  BeneficialOwnerAccountNo2 ='',  
  DepositoryName3 ='',  
  DepositoryID3 ='',  
  BeneficialOwnerAccountNo3 ='',  
  CorporateIdentitynumber_CIN='',  
  GrossAnnualIncomeRange ='',  
  GrossAnnualIncomeasonDate =case when c5.GrossAnnualIncomeasonDate='01-JAN-1900' then '' else c5.GrossAnnualIncomeasonDate end ,  
  NetWorth_InRs ='',  
  NetWorthasonDate ='',  
  PoliticallyExposedPerson_PEP='0',   
  PlaceofIncorporation ='',  
  Occupation ='',  
  OccupationDetails_Forothers='',   
  Dateofcommencementofbusiness ='',  
  CustodialParticipantCodeoftheclient ='',  
  RegistrationNoofClient ='',  
  RegisteringAuthority ='',  
  PlaceofRegistration ='',  
  DateofRegistration ='',  
  InpersonVerification ='Y',  
  ClientAgreementDate =(case when Replace(convert(varchar,c5.ActiveFrom,106),' ','-')='01-JAN-1900'then '' else Replace(convert(varchar,c5.ActiveFrom,106),' ','-') end),  
       /*Change on 26 Apr 2014: Changes for NSE SLB */  
  UniqueClientCodeallottedbyNSCCL_BSE ='',  
  UpdationFlag_for_SMS_and_Email_facility='',   
  Relationship ='',  
  TypeofFacility_for_SMS_and_Email_facility ='',  
  ProofType ='',  
  ProofNumber ='',  
  IssuePlaceofProof='',   
  IssueDateofProof ='',  
  ClientStatus ='A',  
  Remarks ='',  
  ClientType_Corporate='',   
  NameofcontactPerson_1 ='',  
  DesignationofContactPerson_1 ='',  
  PANofcontactPerson_1 ='',  
  AddressofcontactPerson_1 ='',  
  ContactdetailsofcontactPerson_1 ='',  
  DINofcontactPerson_1 ='',  
  UIDofcontactPerson_1 ='',  
  EmailIdofcontactPerson_1 ='',  
  NameofcontactPerson_2  ='',  
  DesignationofcontactPerson_2 ='',  
  PANofcontactPerson_2 ='',  
  AddressofcontactPerson_2 ='',  
  ContactdetailsofcontactPerson_2='',   
  DINofcontactPerson_2 ='',  
  UIDofcontactPerson_2 ='',  
  EmailIdofcontactPerson_2 ='',  
  NameofcontactPerson_3 ='',  
  DesignationofcontactPerson_3='',   
  PANofcontactPerson_3 ='',  
  AddressofcontactPerson_3 ='',  
  ContactdetailsofcontactPerson_3='',   
  DINofcontactPerson_3 ='',  
  UIDofcontactPerson_3 ='',  
  EmailIdofcontactPerson_3 ='',  
  NameofcontactPerson_4 ='',  
  DesignationofcontactPerson_4='',   
  PANofcontactPerson_4 ='',  
  AddressofcontactPerson_4 ='',  
  ContactdetailsofcontactPerson_4 ='',  
  DINofcontactPerson_4 ='',  
  UIDofcontactPerson_4 ='',  
  EmailIdofcontactPerson_4 ='',  
  NameofcontactPerson_5 ='',  
  DesignationofcontactPerson_5 ='',  
  PANofcontactPerson_5 ='',  
  AddressofcontactPerson_5 ='',  
  ContactdetailsofcontactPerson_5='',   
  DINofcontactPerson_5 ='',  
  UIDofcontactPerson_5 ='',  
  EmailIdofcontactPerson_5 ='',  
  NameofcontactPerson_6 ='',  
  DesignationofcontactPerson_6='',   
  PANofcontactPerson_6 ='',  
  AddressofcontactPerson_6 ='',  
  ContactdetailsofcontactPerson_6='',   
  DINofcontactPerson_6 ='',  
  UIDofcontactPerson_6 ='',  
  EmailIdofcontactPerson_6 ='',  
  NameofcontactPerson_7 ='',  
  DesignationofcontactPerson_7='',   
  PANofcontactPerson_7 ='',  
  AddressofcontactPerson_7 ='',  
  ContactdetailsofcontactPerson_7='',   
  DINofcontactPerson_7 ='',  
  UIDofcontactPerson_7 ='',  
  EmailIdofcontactPerson_7 ='',  
  NameofcontactPerson_8 ='',  
  DesignationofcontactPerson_8 ='',  
  PANofcontactPerson_8 ='',  
  AddressofcontactPerson_8 ='',  
  ContactdetailsofcontactPerson_8 ='',  
  DINofcontactPerson_8 ='',  
  UIDofcontactPerson_8 ='',  
  EmailIdofcontactPerson_8 ='',  
  NameofcontactPerson_9 ='',  
  DesignationofcontactPerson_9='',   
  PANofcontactPerson_9 ='',  
  AddressofcontactPerson_9 ='',  
  ContactdetailsofcontactPerson_9='',   
  DINofcontactPerson_9 ='',  
  UIDofcontactPerson_9 ='',  
  EmailIdofcontactPerson_9 ='',  
  NameofcontactPerson_10 ='',  
  DesignationofcontactPerson_10='',   
  PANofcontactPerson_10 ='',  
  AddressofcontactPerson_10 ='',  
  ContactdetailsofcontactPerson_10='',   
  DINofcontactPerson_10 ='',  
  UIDofcontactPerson_10 ='',  
  EmailIdofcontactPerson_10 ='',  
  NameofcontactPerson_11 ='',  
  DesignationofcontactPerson_11='',   
  PANofcontactPerson_11 ='',  
  AddressofcontactPerson_11 ='',  
  ContactdetailsofcontactPerson_11='',   
  DINofcontactPerson_11 ='',  
  UIDofcontactPerson_11 ='',  
  EmailIdofcontactPerson_11 ='',  
  NameofcontactPerson_12 ='',  
  DesignationofcontactPerson_12='',   
  PANofcontactPerson_12 ='',  
  AddressofcontactPerson_12 ='',  
  ContactdetailsofcontactPerson_12='',   
  DINofcontactPerson_12 ='',  
  UIDofcontactPerson_12 ='',  
  EmailIdofcontactPerson_12 ='',  
  NameofcontactPerson_13 ='',  
  DesignationofcontactPerson_13 ='',  
  PANofcontactPerson_13 ='',  
  AddressofcontactPerson_13 ='',  
  ContactdetailsofcontactPerson_13 ='',  
  DINofcontactPerson_13 ='',  
  UIDofcontactPerson_13 ='',  
  EmailIdofcontactPerson_13 ='',  
  NameofcontactPerson_14 ='',  
  DesignationofcontactPerson_14 ='',  
  PANofcontactPerson_14 ='',  
  AddressofcontactPerson_14 ='',  
  ContactdetailsofcontactPerson_14 ='',  
  DINofcontactPerson_14 ='',  
  UIDofcontactPerson_14 ='',  
  EmailIdofcontactPerson_14 ='',  
  NameofcontactPerson_15 ='',  
  DesignationofcontactPerson_15 ='',  
  PANofcontactPerson_15 ='',  
  AddressofcontactPerson_15 ='',  
  ContactdetailsofcontactPerson_15='',   
  DINofcontactPerson_15 ='',  
  UIDofcontactPerson_15 ='',  
  EmailIdofcontactPerson_15 ='',  
  NameofcontactPerson_16 ='',  
  DesignationofcontactPerson_16='',   
  PANofcontactPerson_16 ='',  
  AddressofcontactPerson_16 ='',  
  ContactdetailsofcontactPerson_16='',   
  DINofcontactPerson_16 ='',  
  UIDofcontactPerson_16 ='',  
  EmailIdofcontactPerson_16 ='',  
  NameofcontactPerson_17 ='',  
  DesignationofcontactPerson_17='',   
  PANofcontactPerson_17 ='',  
  AddressofcontactPerson_17 ='',  
  ContactdetailsofcontactPerson_17='',   
  DINofcontactPerson_17 ='',  
  UIDofcontactPerson_17 ='',  
  EmailIdofcontactPerson_17 ='',  
  NameofcontactPerson_18 ='',  
  DesignationofcontactPerson_18='',   
  PANofcontactPerson_18 ='',  
  AddressofcontactPerson_18 ='',  
  ContactdetailsofcontactPerson_18='',   
  DINofcontactPerson_18 ='',  
  UIDofcontactPerson_18 ='',  
  EmailIdofcontactPerson_18 ='',  
  NameofcontactPerson_19 ='',  
  DesignationofcontactPerson_19='',   
  PANofcontactPerson_19 ='',  
  AddressofcontactPerson_19 ='',  
  ContactdetailsofcontactPerson_19='',   
  DINofcontactPerson_19 ='',  
  UIDofcontactPerson_19 ='',  
  EmailIdofcontactPerson_19 ='',  
  NameofcontactPerson_20 ='',  
  DesignationofcontactPerson_20='',   
  PANofcontactPerson_20 ='',  
  AddressofcontactPerson_20 ='',  
  ContactdetailsofcontactPerson_20='',   
  DINofcontactPerson_20 ='',  
  UIDofcontactPerson_20 ='',  
  EmailIdofcontactPerson_20 ='',  
  POAforFunds ='N',  
     POAforSecurities='N',   
  Flag='E'  
 from  
  (  
   select  
    c1.*,  
    b.bank_name, b.bank_address, b.bank_account_type, b.bank_account_no, b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client  
   from  
    #temp_Client1 c1 with (nolock)  
     left outer join  
    #temp_client_bank b with (nolock)  
     on ltrim(rtrim(c1.party_code)) = ltrim(rtrim(b.party_code))  
  ) c1_b,  
  #temp_Client2 c2 with (nolock),  
  #temp_Client5 c5 with (nolock)  
  
 where  
  ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and  
  ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and  
  ltrim(rtrim(left(c2.party_code,2))) <> '98'  
    
  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
  UpdationFlag_for_SMS_and_Email_facility=isnull(c1.UPDATIONFLAG,''),  
     --RELATIONSHIP=ISNULL(c1.RELATIONSHIP,''), /*Cpmmented on 4 Jun 2014 As per change reqest by Ajay on Call*/  
     --MASTERPAN=ISNULL(c1.MASTERPAN,''),  
     TypeofFacility_for_SMS_and_Email_facility=ISNULL(c1.TYPEOFFACILITY,''),  
  --Gender=isnull(c1.Gender,''),  
  Fathers_Husbands_GuardiansName=isnull(c1.FATHERNAME,''),  
  Maritalstatus=  
   case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  
     case   
      when isnull(c1.MARITALSTATUS,'')='01' then 'S'   
      when isnull(c1.MARITALSTATUS,'')='02' then 'M'  
      else 'S'   
     end  
   else  
    ''  
   end   ,  
  Nationality=  
     case when #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('1','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end,   
  NATIONALITY_OTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,  
  GrossAnnualIncomeRange=case   
     when c1.Gross_Income ='01' then '1'  
     when c1.Gross_Income ='02' then '2'  
     when c1.Gross_Income ='03' then '3'  
     when c1.Gross_Income ='04' then '4'  
     when c1.Gross_Income ='05' then '5'  
     when c1.Gross_Income ='06' then '5' --6 /*Modify on 30 Apr 2014*/  
     when c1.Gross_Income ='07' then '6' --7 /*Modify on 30 Apr 2014*/  
     else '' end,   
  NetWorth_InRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),  
  NetWorthasonDate=case when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' then ''  
      else upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),'')))) end,  
  PoliticallyExposedPerson_PEP=case   
    when c1.PEP='01' or c1.pep ='PEP' then '01'   
    when c1.PEP='02' or c1.pep ='RPEP' then '02'  
    else '0' end,  
  Occupation=case   
    when c1.Occupation='01' then '01'  
    when c1.Occupation='02' then '02'  
    when c1.Occupation='03' then '04'  
    when c1.Occupation='04' then '05'  
    when c1.Occupation='05' then '06'  
    when c1.Occupation='06' then '07'  
    when c1.Occupation='07' then '08'  
    when c1.Occupation='08' then '09'  
    when c1.Occupation='10' then '03'  
    else '99' end,  
  OccupationDetails_Forothers=isnull(Occupation_Other,''),  
  --UIDNUMBER=isnull(c1.AADHAR_UID,'')  
  UIDNUMBER=replace(isnull(rtrim(ltrim(c1.AADHAR_UID)),''),' ','')  
 from  
  anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)  
 where  
  client_code = party_code  
  and len(isnull(client_code, '')) > 0  
  and len(isnull(party_code, '')) > 0     
   
 update   
  #mimansa_angel_ucc_nse_slb_client_data_new_changes   
 set   
  GrossAnnualIncomeasonDate='',  
  NetWorth_InRs='',  
  NetWorthasonDate=''  
 where len(GrossAnnualIncomeRange)=0   
  
   
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes.CorporateIdentitynumber_CIN=isnull(c1.cin,''),  
  ClientType_Corporate='Y'  
 from  
  anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)  
 where  
  client_code = party_code  
  and len(isnull(client_code, '')) > 0  
  and len(isnull(party_code, '')) > 0   
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category=4   
  
 /****ADDRESS 1****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_1=c1.contact_name,  
 DesignationofContactPerson_1=c1.designation,  
 PANofcontactPerson_1=c1.PanNo,  
 AddressofcontactPerson_1=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_1=c1.DIN,  
 UIDofcontactPerson_1=c1.UID,  
 EmailIdofcontactPerson_1=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='1'  
  
 /****ADDRESS 2****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_2=c1.contact_name,  
 DesignationofContactPerson_2=c1.designation,  
 PANofcontactPerson_2=c1.PanNo,  
 AddressofcontactPerson_2=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_2=c1.DIN,  
 UIDofcontactPerson_2=c1.UID,  
 EmailIdofcontactPerson_2=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='2'  
  
 /****ADDRESS 3****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_3=c1.contact_name,  
 DesignationofContactPerson_3=c1.designation,  
 PANofcontactPerson_3=c1.PanNo,  
 AddressofcontactPerson_3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_3=c1.DIN,  
 UIDofcontactPerson_3=c1.UID,  
 EmailIdofcontactPerson_3=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='3'  
  
 /****ADDRESS 4****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_4=c1.contact_name,  
 DesignationofContactPerson_4=c1.designation,  
 PANofcontactPerson_4=c1.PanNo,  
 AddressofcontactPerson_4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_4=c1.DIN,  
 UIDofcontactPerson_4=c1.UID,  
 EmailIdofcontactPerson_4=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='4'  
  
 /****ADDRESS 5****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_5=c1.contact_name,  
 DesignationofContactPerson_5=c1.designation,  
 PANofcontactPerson_5=c1.PanNo,  
 AddressofcontactPerson_5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_5=c1.DIN,  
 UIDofcontactPerson_5=c1.UID,  
 EmailIdofcontactPerson_5=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='5'  
  
 /****ADDRESS 6****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_6=c1.contact_name,  
 DesignationofContactPerson_6=c1.designation,  
 PANofcontactPerson_6=c1.PanNo,  
 AddressofcontactPerson_6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_6=c1.DIN,  
 UIDofcontactPerson_6=c1.UID,  
 EmailIdofcontactPerson_6=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='6'  
  
 /****ADDRESS 7****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_7=c1.contact_name,  
 DesignationofContactPerson_7=c1.designation,  
 PANofcontactPerson_7=c1.PanNo,  
 AddressofcontactPerson_7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_7=c1.DIN,  
 UIDofcontactPerson_7=c1.UID,  
 EmailIdofcontactPerson_7=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='7'  
  
 /****ADDRESS 8****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_8=c1.contact_name,  
 DesignationofContactPerson_8=c1.designation,  
 PANofcontactPerson_8=c1.PanNo,  
 AddressofcontactPerson_8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_8=c1.DIN,  
 UIDofcontactPerson_8=c1.UID,  
 EmailIdofcontactPerson_8=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='8'  
  
 /****ADDRESS 9****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_9=c1.contact_name,  
 DesignationofContactPerson_9=c1.designation,  
 PANofcontactPerson_9=c1.PanNo,  
 AddressofcontactPerson_9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_9=c1.DIN,  
 UIDofcontactPerson_9=c1.UID,  
 EmailIdofcontactPerson_9=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='9'  
  
 /****ADDRESS 10****/  
 update  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
 set  
 NameofcontactPerson_10=c1.contact_name,  
 DesignationofContactPerson_10=c1.designation,  
 PANofcontactPerson_10=c1.PanNo,  
 AddressofcontactPerson_10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),  
 ContactdetailsofcontactPerson_10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),  
 DINofcontactPerson_10=c1.DIN,  
 UIDofcontactPerson_10=c1.UID,  
 EmailIdofcontactPerson_10=c1.Email    
 from  
  anand1.msajag.dbo.client_contact_details c1 with(nolock)  
 where  
  Client_Code = cl_code  
  and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')  
  and #mimansa_angel_ucc_nse_slb_client_data_new_changes.category in ('2','3','4','5')  
  and line_no='10'  
  
  
  
  /*Update POA*/  
  --Update   
  --    #mimansa_angel_ucc_nse_slb_client_data_new_changes  
  --  set       
  --     POAforSecurities=  
  --  case   
  --  when ltrim(rtrim(Def))=1 then 'Y'    
  --  when ltrim(rtrim(Def))=0 then 'N'       
  --  else  ''   
  -- end  
  --  from  
  --   anand1.msajag.dbo.Multicltid m with(nolock)  
  --     where  
  --Client_Code = m.Party_code  
  
   
 /*INVALID PAN*/  
  
   
  
 select distinct  
  client_code = ltrim(rtrim(client_code)),  
  client_name = ltrim(rtrim(client_name)),  
  pan = ltrim(rtrim(pan))  
  --pan,  
  --pan_err =   
  -- case   
  --  when ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'  
  --  then 'NO PAN'  
  --  when len(ltrim(rtrim(isnull(pan, '')))) = 0  
  --  then 'NO PAN'  
  --  when not (  
  --   isnumeric(left(ltrim(rtrim(isnull(pan, ''))), 5)) = 0 and  
  --   isnumeric(substring(ltrim(rtrim(isnull(pan, ''))), 6, 4)) = 1 and  
  --   isnumeric(right(ltrim(rtrim(isnull(pan, ''))), 1)) = 0 and  
  --   len(ltrim(rtrim(isnull(pan, '')))) = 10  
  --  )  
  --  then 'INVALID PAN'  
  -- end,  
  
  --pan_length = len(ltrim(rtrim(isnull(pan, '')))),  
  --telephone_number = ltrim(rtrim(TelephoneNumber_Residence)),  
  --client_address_1 = ltrim(rtrim(CorrespondenceClientAddressline1))  
into #invalidpan  
 from  
  --mimansa_angel_ucc_nse_fo_client_data with(nolock)  
  mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)  
 where  
  ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'  
  
   
  
   
delete  
 #mimansa_angel_ucc_nse_slb_client_data_new_changes  
from  
 --[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)  
 intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp   
where  
 ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))  
 and len(bp.panno)=10  
  
/***************FINAL DISPLAY*******************/  
select distinct  
  Segment,   
  Client_Code=ltrim(RTRIM(Client_Code)),   
  Client_Name ,  
  Category ,  
  PAN ,  
  Gender,   
  Fathers_Husbands_GuardiansName ,  
  Maritalstatus ,  
  Nationality ,  
  Nationality_Other,   
  ClientEmailId ,  
  CorrespondenceClientAddressline1 ,  
  CorrespondenceClientAddressline2 ,  
  CorrespondenceClientAddressline3 ,  
  CorrespondenceClientAddress_City ,  
  CorrespondenceClientAddress_State ,  
  CorrespondenceClientAddress_State_Others,   
  CorrespondenceClientAddress_Country ,  
  CorrespondenceClientAddress_Pincode ,  
  FlagIndicatingifCorrespondenceAddressissameasPermanentAddress ,  
  PermanentClientAddressline1 ,  
  PermanentClientAddressline2 ,  
  PermanentClientAddressline3 ,  
  PermanentClientAddress_City ,  
  PermanentClientAddress_State ,  
  PermanentClientAddress_StateOthers  ,  
  PermanentClientAddress_Country ,  
  PermanentClientAddress_Pincode ,  
  ISDcode_Residence ,  
  STDcode_Residence ,  
  TelephoneNumber_Residence ,  
  Mobilenumber ,  
  ISDcode_Office,   
  STDcode_Office ,  
  TelephoneNumber_Office ,  
  DateofBirth_Incorporation ,  
  UIDNUMBER ,  
  BankName1 ,  
  BankBranchAddress1 ,  
  BankAccountNo1 ,  
  BankAccountType1 ,  
  BankName2 ,  
  BankBranchAddress2 ,  
  BankAccountNo2 ,  
  BankAccountType2 ,  
  BankName3 ,  
  BankBranchAddress3 ,  
  BankAccountNo3 ,  
  BankAccountType3,   
  DepositoryName1 ,  
  DepositoryID1 ,  
  BeneficialOwnerAccountNo1 ,  
  DepositoryName2 ,  
  DepositoryID2 ,  
  BeneficialOwnerAccountNo2 ,  
  DepositoryName3 ,  
  DepositoryID3 ,  
  BeneficialOwnerAccountNo3 ,  
  CorporateIdentitynumber_CIN,   
  GrossAnnualIncomeRange ,  
  GrossAnnualIncomeasonDate,   
  NetWorth_InRs ,  
  NetWorthasonDate,   
  PoliticallyExposedPerson_PEP ,  
  PlaceofIncorporation ,  
  Occupation ,  
  OccupationDetails_Forothers ,  
  Dateofcommencementofbusiness ,  
  CustodialParticipantCodeoftheclient ,  
  RegistrationNoofClient ,  
  RegisteringAuthority ,  
  PlaceofRegistration ,  
  DateofRegistration ,  
  InpersonVerification,   
  ClientAgreementDate ,  
  UniqueClientCodeallottedbyNSCCL_BSE ,  
  UpdationFlag_for_SMS_and_Email_facility ,  
  Relationship ,  
  TypeofFacility_for_SMS_and_Email_facility ,  
  ProofType ,  
  ProofNumber ,  
  IssuePlaceofProof ,  
  IssueDateofProof ,  
  ClientStatus ,  
  Remarks ,  
  ClientType_Corporate,   
  NameofcontactPerson_1 ,  
  DesignationofContactPerson_1 ,  
  PANofcontactPerson_1 ,  
  AddressofcontactPerson_1 ,  
  ContactdetailsofcontactPerson_1 ,  
  DINofcontactPerson_1 ,  
  UIDofcontactPerson_1 ,  
  EmailIdofcontactPerson_1 ,  
  NameofcontactPerson_2  ,  
  DesignationofcontactPerson_2 ,  
  PANofcontactPerson_2 ,  
  AddressofcontactPerson_2 ,  
  ContactdetailsofcontactPerson_2,   
  DINofcontactPerson_2 ,  
  UIDofcontactPerson_2 ,  
  EmailIdofcontactPerson_2 ,  
  NameofcontactPerson_3 ,  
  DesignationofcontactPerson_3,   
  PANofcontactPerson_3 ,  
  AddressofcontactPerson_3 ,  
  ContactdetailsofcontactPerson_3,   
  DINofcontactPerson_3 ,  
  UIDofcontactPerson_3 ,  
  EmailIdofcontactPerson_3 ,  
  NameofcontactPerson_4 ,  
  DesignationofcontactPerson_4,   
  PANofcontactPerson_4 ,  
  AddressofcontactPerson_4 ,  
  ContactdetailsofcontactPerson_4 ,  
  DINofcontactPerson_4 ,  
  UIDofcontactPerson_4 ,  
  EmailIdofcontactPerson_4 ,  
  NameofcontactPerson_5 ,  
  DesignationofcontactPerson_5 ,  
  PANofcontactPerson_5 ,  
  AddressofcontactPerson_5 ,  
  ContactdetailsofcontactPerson_5,   
  DINofcontactPerson_5 ,  
  UIDofcontactPerson_5 ,  
  EmailIdofcontactPerson_5 ,  
  NameofcontactPerson_6 ,  
  DesignationofcontactPerson_6,   
  PANofcontactPerson_6 ,  
  AddressofcontactPerson_6 ,  
  ContactdetailsofcontactPerson_6,   
  DINofcontactPerson_6 ,  
  UIDofcontactPerson_6 ,  
  EmailIdofcontactPerson_6 ,  
  NameofcontactPerson_7 ,  
  DesignationofcontactPerson_7,   
  PANofcontactPerson_7 ,  
  AddressofcontactPerson_7 ,  
  ContactdetailsofcontactPerson_7,   
  DINofcontactPerson_7 ,  
  UIDofcontactPerson_7 ,  
  EmailIdofcontactPerson_7 ,  
  NameofcontactPerson_8 ,  
  DesignationofcontactPerson_8 ,  
  PANofcontactPerson_8 ,  
  AddressofcontactPerson_8 ,  
  ContactdetailsofcontactPerson_8 ,  
  DINofcontactPerson_8 ,  
  UIDofcontactPerson_8 ,  
  EmailIdofcontactPerson_8 ,  
  NameofcontactPerson_9 ,  
  DesignationofcontactPerson_9,   
  PANofcontactPerson_9 ,  
  AddressofcontactPerson_9 ,  
  ContactdetailsofcontactPerson_9,   
  DINofcontactPerson_9 ,  
  UIDofcontactPerson_9 ,  
  EmailIdofcontactPerson_9 ,  
  NameofcontactPerson_10 ,  
  DesignationofcontactPerson_10,   
  PANofcontactPerson_10 ,  
  AddressofcontactPerson_10 ,  
  ContactdetailsofcontactPerson_10,   
  DINofcontactPerson_10 ,  
  UIDofcontactPerson_10 ,  
  EmailIdofcontactPerson_10 ,  
  NameofcontactPerson_11 ,  
  DesignationofcontactPerson_11,   
  PANofcontactPerson_11 ,  
  AddressofcontactPerson_11 ,  
  ContactdetailsofcontactPerson_11,   
  DINofcontactPerson_11 ,  
  UIDofcontactPerson_11 ,  
  EmailIdofcontactPerson_11 ,  
  NameofcontactPerson_12 ,  
  DesignationofcontactPerson_12,   
  PANofcontactPerson_12 ,  
  AddressofcontactPerson_12 ,  
  ContactdetailsofcontactPerson_12,   
  DINofcontactPerson_12 ,  
  UIDofcontactPerson_12 ,  
  EmailIdofcontactPerson_12 ,  
  NameofcontactPerson_13 ,  
  DesignationofcontactPerson_13 ,  
  PANofcontactPerson_13 ,  
  AddressofcontactPerson_13 ,  
  ContactdetailsofcontactPerson_13 ,  
  DINofcontactPerson_13 ,  
  UIDofcontactPerson_13 ,  
  EmailIdofcontactPerson_13 ,  
  NameofcontactPerson_14 ,  
  DesignationofcontactPerson_14 ,  
  PANofcontactPerson_14 ,  
  AddressofcontactPerson_14 ,  
  ContactdetailsofcontactPerson_14 ,  
  DINofcontactPerson_14 ,  
  UIDofcontactPerson_14 ,  
  EmailIdofcontactPerson_14 ,  
  NameofcontactPerson_15 ,  
  DesignationofcontactPerson_15 ,  
  PANofcontactPerson_15 ,  
  AddressofcontactPerson_15 ,  
  ContactdetailsofcontactPerson_15,   
  DINofcontactPerson_15 ,  
  UIDofcontactPerson_15 ,  
  EmailIdofcontactPerson_15 ,  
  NameofcontactPerson_16 ,  
  DesignationofcontactPerson_16,   
  PANofcontactPerson_16 ,  
  AddressofcontactPerson_16 ,  
  ContactdetailsofcontactPerson_16,   
  DINofcontactPerson_16 ,  
  UIDofcontactPerson_16 ,  
  EmailIdofcontactPerson_16 ,  
  NameofcontactPerson_17 ,  
  DesignationofcontactPerson_17,   
  PANofcontactPerson_17 ,  
  AddressofcontactPerson_17 ,  
  ContactdetailsofcontactPerson_17,   
  DINofcontactPerson_17 ,  
  UIDofcontactPerson_17 ,  
  EmailIdofcontactPerson_17 ,  
  NameofcontactPerson_18 ,  
  DesignationofcontactPerson_18,   
  PANofcontactPerson_18 ,  
  AddressofcontactPerson_18 ,  
  ContactdetailsofcontactPerson_18,   
  DINofcontactPerson_18 ,  
  UIDofcontactPerson_18 ,  
  EmailIdofcontactPerson_18 ,  
  NameofcontactPerson_19 ,  
  DesignationofcontactPerson_19,   
  PANofcontactPerson_19 ,  
  AddressofcontactPerson_19 ,  
  ContactdetailsofcontactPerson_19,   
  DINofcontactPerson_19 ,  
  UIDofcontactPerson_19 ,  
  EmailIdofcontactPerson_19 ,  
  NameofcontactPerson_20 ,  
  DesignationofcontactPerson_20,   
  PANofcontactPerson_20 ,  
  AddressofcontactPerson_20 ,  
  ContactdetailsofcontactPerson_20,   
  DINofcontactPerson_20 ,  
  UIDofcontactPerson_20 ,  
  EmailIdofcontactPerson_20 ,  
  POAforFunds ='N',  
     POAforSecurities='N',   
  Flag='E'  
from  
 #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)  
   
where  
 len(ltrim(rtrim(isnull(pan, '')))) > 0 and  
 isnull(pan, '' ) <> 'NA'  
  
  
  
  
  
 /*****ROW COUNT****/  
declare @totalrecord numeric  
  
select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)   
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and  
 isnull(pan, '' ) <> 'NA'  
  
/*Insert Log*/  
if exists(select * from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_Deactive_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))  
begin  
 if(@totalrecord>0)  
 begin  
  update [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_Deactive_file_count   
  set file_number=file_number+1  
  where time_stamp>=cast(left(getdate(),11) as datetime)  
 end  
end  
else  
begin  
 if(@totalrecord>0)  
 begin  
  insert into [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_Deactive_file_count(file_number,time_stamp)  
  select 1,getdate()  
 end  
end  
   
/*Display File Name and First Row  
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)  
    Ex- uci_20140225.t04  
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count   
    Ex- 10|M|12798|27022014|04|220  
*/  
  
select FileName='uci_Deactive_'+replace(convert(varchar, getdate(), 102), '.', '')  
    +'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),       
    FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'  
    +(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'  
    +cast(@totalrecord  as varchar)   
from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_Deactive_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)  
  
  
/*DISPLAY INVALID PAN*/  
select Client_Code,Client_Name,PAN  
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_Inactive_client_data_pop_new_changes_rit
-- --------------------------------------------------
CREATE proc  
  
 [dbo].[mimansa_usp_ucc_nse_slb_Inactive_client_data_pop_new_changes_rit]  
 (  
 @from_date varchar(20),  
 @to_date varchar(20),  
 @ClientCode varchar(20),  
 --@selected_clients_only char(1),  
 @processid varchar(50)  
 )  
as  
--[mimansa_usp_ucc_nse_slb_client_data_pop_new_changes_SAN] @from_date='May 13 2014',@to_date='May 13 2014',@ClientCode='',@processid=''  
 /*Parameter Vertualization*/  
 Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,  
   @@FromClientCode varchar(20),@@ToClientCode varchar(20)  
  
/*Initialized Parameters*/  
 if isnull(@from_date,'')='' or isnull(@to_date,'')=''  
 begin  
  set @@FromDate='Jan  1 1900'  
  set @@ToDate='Dec 31 2078'  
 end  
 else  
 begin  
  set @@FromDate=@from_date  
  set @@ToDate=@to_date+' 23:59'  
 end  
  
 if isnull(@ClientCode,'')=''  
 begin  
  set @@FromClientCode='A'  
  set @@ToClientCode='ZZZZZZZZZZ'  
 end  
 else  
 begin  
  set @@FromClientCode=@ClientCode  
  set @@ToClientCode=@ClientCode  
 end  
  
 set @@getdate=left(getdate(),11)+' 23:59'  
  
 --declare @totalrecord as numeric  
  
select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0  
  
if isnull(@processid,'')=''  
begin  
 print 'DATARANGE'  
  insert into #codes_to_process  
  select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))  
  from NSESLBS.dbo.client5 c5 with(nolock)  
  where cl_code>=@@FromClientCode  
    and cl_code<=@@ToClientCode   
    and c5.inactivefrom >@@getdate   
    and activefrom >= @@FromDate  
    and activefrom <= @@ToDate  
  --select @totalrecord = count(*) from #codes_to_process  
  
end  
else  
begin  
 print 'SELECTED'  
  insert into #codes_to_process  
  select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))  
  from NSESLBS.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)  
  where c5.cl_code=A.party_code  
    and c5.cl_code>=@@FromClientCode  
    and c5.cl_code<=@@ToClientCode  
    and A.processid=@processid   
  
  --select @totalrecord = count(*) from #codes_to_process  
  
  /*Delete selected clients*/   
  delete from tblUCCClientCode where processid=@processid   
end  
  
 /*******************FETCH DATA**************************/  
  
 --truncate table mimansa_angel_ucc_nse_slb_client_data_new_changes  
   
  
CREATE TABLE #mimansa_angel_ucc_nse_slb_client_data_new_changes(  
 [Segment] [varchar](1) NULL,  
 [Client_Code] [varchar](10) NULL,  
 [Client_Name] [varchar](150) NULL,  
  
 [PAN] [varchar](10) NULL,  
   
 [ClientStatus] [varchar](1) NULL,  
 [Remarks] [varchar](200) NULL  
   
)  
   
 --insert into   
 -- angel_ucc_nse_fo_client1  
 select  
  party_code = ltrim(rtrim(c2.party_code)),  
    
  Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),  
  Short_Name=ltrim(rtrim(isnull(Short_Name,''))),  
  Long_Name=ltrim(rtrim(isnull(Long_Name,''))),  
    
    
  pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,'')))  
    
 into   
  #temp_client1   
 from   
  NSESLBS.dbo.client1 c1 with(nolock),  
  NSESLBS.dbo.client2 c2 with(nolock),  
  #codes_to_process t with (nolock)  
 where   
  c1.cl_code = c2.cl_code and   
  c2.party_code = t.party_code   
  
   
   
  
   
 select   
  Cl_Code, Party_code=c2.Party_code  
 into #temp_client2   
 from   
  NSESLBS.dbo.client2 c2 with(nolock),  
  #codes_to_process t with (nolock)  
 where   
  c2.party_code = t.party_code  
   
 select   
  party_code = ltrim(rtrim(t.party_code)),  
    
  cl_code=ltrim(rtrim(isnull(c5.cl_code,'')))  
    
 into #temp_Client5   
 from   
  NSESLBS.dbo.client5 c5 with(nolock),  
  #temp_Client2 t with (nolock)  
 where   
  c5.cl_code = t.cl_code  
  
   
  
 /*******************END - FETCH DATA**************************/  
  
 insert into  
  #mimansa_angel_ucc_nse_slb_client_data_new_changes  
  (  
   Segment ,  
   Client_Code ,  
   Client_Name ,  
    
   PAN ,  
     
   ClientStatus ,  
   Remarks   
     
   )  
 select  
  segment = 'S',  
  client_code = c2.party_code,  
  client_name = left(c1_b.long_name, 150),  
    
  pan =dbo.fn_validate_pan (c1_b.pan_gir_no, 'NA'),  
    
  ClientStatus ='I',  
  Remarks ='Account Closure'  
    
 from  
    
  #temp_Client2 c2 with (nolock),  
  #temp_Client5 c5 with (nolock),#temp_Client1 c1_b with (nolock)  
  
 where  
  ltrim(rtrim(c1_b.party_code)) = ltrim(rtrim(c2.party_code)) and  
  ltrim(rtrim(c2.party_code)) = ltrim(rtrim(c5.party_code)) and  
  ltrim(rtrim(left(c2.party_code,2))) <> '98'  
    
  
   
   
 /*INVALID PAN*/  
  
   
  
 select distinct  
  client_code = ltrim(rtrim(client_code)),  
  client_name = ltrim(rtrim(client_name)),  
  pan = ltrim(rtrim(pan))  
   
into #invalidpan  
 from  
  --mimansa_angel_ucc_nse_fo_client_data with(nolock)  
  mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)  
 where  
  ltrim(rtrim(isnull(pan, 'NA'))) = 'NA'  
  
   
  
   
delete  
 #mimansa_angel_ucc_nse_slb_client_data_new_changes  
from  
 --[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)  
 intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp   
where  
 ltrim(rtrim(replace(isnull(#mimansa_angel_ucc_nse_slb_client_data_new_changes.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))  
 and len(bp.panno)=10  
  
/***************FINAL DISPLAY*******************/  
select distinct  
  Segment,   
  Client_Code=ltrim(RTRIM(Client_Code)),   
    
  ClientStatus ,  
  Remarks   
    
from  
 #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)  
   
where  
 len(ltrim(rtrim(isnull(pan, '')))) > 0 and  
 isnull(pan, '' ) <> 'NA'  
  
  
  
  
  
 /*****ROW COUNT****/  
declare @totalrecord numeric  
  
select @totalrecord=count(*)  from #mimansa_angel_ucc_nse_slb_client_data_new_changes with(nolock)   
where len(ltrim(rtrim(isnull(pan, '')))) > 0 and  
 isnull(pan, '' ) <> 'NA'  
  
/*Insert Log*/  
if exists(select * from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime))  
begin  
 if(@totalrecord>0)  
 begin  
  update [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count   
  set file_number=file_number+1  
  where time_stamp>=cast(left(getdate(),11) as datetime)  
 end  
end  
else  
begin  
 if(@totalrecord>0)  
 begin  
  insert into [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count(file_number,time_stamp)  
  select 1,getdate()  
 end  
end  
   
/*Display File Name and First Row  
File NAme Syntax: uci_YYYYMMDD.t(No of file generated)  
    Ex- uci_20140225.t04  
First Row Syntax: 10|M|12798|strDD+strMM+strYYYY|file generation count | record count   
    Ex- 10|M|12798|27022014|04|220  
*/  
select FileName='CLT_STATUS_'+replace(convert(varchar, getdate(), 102), '.', '')  
    +'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)       
   
from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)  
  
  
/*  
select FileName='uci_'+replace(convert(varchar, getdate(), 102), '.', '')  
    +'.T'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),       
    FirstRow='10|M|12798|'+replace(convert(varchar, getdate(), 103), '/', '')+'|'  
    +(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+'|'  
    +cast(@totalrecord  as varchar)   
from [AngelFO].INHOUSE.dbo.mimansa_tbl_ucc_nse_file_count with(nolock) where time_stamp>=cast(left(getdate(),11) as datetime)  
*/  
  
/*DISPLAY INVALID PAN*/  
select Client_Code,Client_Name,PAN  
from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimansa_usp_ucc_nse_slb_load_new_client_data
-- --------------------------------------------------
CREATE proc

	[dbo].[mimansa_usp_ucc_nse_slb_load_new_client_data] (
		@from_date varchar(11), 
		@to_date varchar(11) 
	)

as

/*
	exec mimansa_usp_ucc_nse_slb_load_new_client_data
		@from_date = 'Jun 26 2013',
		@to_date = 'Jun 27 2013'
*/
set nocount on

set implicit_transactions off 
set transaction isolation level read uncommitted 

insert into 
	mimansa_angel_tbl_ucc_nse_SLB_trade
	(party_code)
select distinct
	party_code
from
	(
		select 
			c2.party_code,
			active = case when activefrom >= convert(datetime, left(convert(varchar, getdate(), 109), 11) + ' 00:00:00') then 'Y' else 'N' end,
			added_date = activefrom
		from 
			NSESLBS.dbo.client2 c2 with(nolock),
			NSESLBS.dbo.client5 c5 with(nolock)
		where
			ltrim(rtrim(c2.cl_code)) = ltrim(rtrim(c5.cl_code)) and
			activefrom >= convert(datetime, @from_date + ' 00:00:00') and
			activefrom < convert(datetime, @to_date + ' 23:59:59')
	) new_clients
order by
	party_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MimansaPoBankDetailsBseFo
-- --------------------------------------------------
Create Procedure MimansaPoBankDetailsBseFo
As
Select               
c.Party_code,              
'BSE-FUTURES' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.CltDpId,''),              
AcType = isnull(c.Depository,'')              
From               
bsefo.dbo.Client4 c (nolock)              
join              
bsefo.dbo.PoBank p (nolock)              
on              
(cast(p.BankId as varchar) = c.BankID)              
Where              
c.Depository not in ('CDSL','NSDL')              
UNION               
Select               
c.cltcode,              
'BSE-FUTURES' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.AccNo,''),              
AcType = isnull(c.AccType,'')               
From               
accountbfo.dbo.MultiBankId c (nolock)              
join              
bsefo.dbo.PoBank p (nolock)              
on              
/*(p.BankId = c.BankID) */             
(cast(p.BankId as varchar) = c.BankID)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MimansaPoBankDetailsMCDX
-- --------------------------------------------------
Create Procedure MimansaPoBankDetailsMCDX
As
Select               
c.Party_code,              
'MCX-COMM' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.CltDpId,''),              
AcType = isnull(c.Depository,'')              
From               
mcdx.dbo.Client4 c (nolock)              
join              
mcdx.dbo.PoBank p (nolock)              
on              
(cast(p.BankId as varchar) = c.BankID)              
Where              
c.Depository not in ('CDSL','NSDL')              
UNION               
Select               
c.cltcode,              
'MCX-COMM' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.AccNo,''),              
AcType = isnull(c.AccType,'')               
From               
accountmcdx.dbo.MultiBankId c (nolock)              
join              
mcdx.dbo.PoBank p (nolock)              
on              
/*(p.BankId = c.BankID) */             
(cast(p.BankId as varchar) = c.BankID)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MimansaPoBankDetailsMCDXCDS
-- --------------------------------------------------
Create Procedure MimansaPoBankDetailsMCDXCDS
As
Select               
c.Party_code,              
'MCX-CURR' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.CltDpId,''),              
AcType = isnull(c.Depository,'')              
From               
mcdxcds.dbo.Client4 c (nolock)              
join              
mcdxcds.dbo.PoBank p (nolock)              
on              
(cast(p.BankId as varchar) = c.BankID)              
Where              
c.Depository not in ('CDSL','NSDL')              
UNION               
Select        
c.cltcode,              
'MCX-CURR' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.AccNo,''),              
AcType = isnull(c.AccType,'')               
From               
accountmcdxcds.dbo.MultiBankId c (nolock)              
join              
mcdxcds.dbo.PoBank p (nolock)              
on              
/*(p.BankId = c.BankID) */             
(cast(p.BankId as varchar) = c.BankID)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MimansaPoBankDetailsNCDX
-- --------------------------------------------------
Create Procedure MimansaPoBankDetailsNCDX
As
Select               
c.Party_code,              
'NCX-COMM' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.CltDpId,''),              
AcType = isnull(c.Depository,'')              
From               
ncdx.dbo.Client4 c (nolock)              
join              
ncdx.dbo.PoBank p (nolock)              
on              
(cast(p.BankId as varchar) = c.BankID)              
Where              
c.Depository not in ('CDSL','NSDL')              
UNION               
Select               
c.cltcode,              
'NCX-COMM' as Exchange,              
BankName = isnull(p.Bank_Name,''),              
Branch = isnull(p.Branch_Name,''),              
AcNum = isnull(c.AccNo,''),              
AcType = isnull(c.AccType,'')               
From               
accountncdx.dbo.MultiBankId c (nolock)              
join              
ncdx.dbo.PoBank p (nolock)              
on              
/*(p.BankId = c.BankID) */             
(cast(p.BankId as varchar) = c.BankID)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mimnsa_usp_ucc_mcx_get_latest_file_number
-- --------------------------------------------------
create proc
	[dbo].[mimnsa_usp_ucc_mcx_get_latest_file_number] (
		@file_date varchar(11)
	)
as

/*
	sp_ucc_currency_futures_get_latest_file_number 'Aug 25 2008'
	select * from tbl_ucc_currency_futures_file_count
	----------sp_ucc_currency_futures_update_latest_file_number 'Aug 25 2008'
	----------truncate table tbl_ucc_currency_futures_file_count
*/

set nocount on

declare
	@file_number bigint

select
	@file_number = isnull(max(file_number), 0)
from
	mimansa_tbl_ucc_mcx_file_count with (tablockx)
where
	time_stamp like @file_date + '%'

if @file_number = 99 begin
	select
		@file_number = -1
end

if @file_number = 0 begin
	insert into
		mimansa_tbl_ucc_mcx_file_count with (tablockx) (
			file_number
			,time_stamp
		) values (
			@file_number
			,getdate()
		)
end		/*if @file_number = 1*/

select
	latest_file_number = @file_number + 1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NonUsedIndex
-- --------------------------------------------------
CREATE Procedure NonUsedIndex
As
SELECT TOP 200
 o.name AS ObjectName
 , i.name AS IndexName
 , i.index_id AS IndexID
 , dm_ius.user_seeks AS UserSeek
 , dm_ius.user_scans AS UserScans
 , dm_ius.user_lookups AS UserLookups
 , dm_ius.user_updates AS UserUpdates
 , p.TableRows
 , 'DROP INDEX ' + QUOTENAME(i.name)
 + ' ON ' + QUOTENAME(s.name) + '.' + QUOTENAME(OBJECT_NAME(dm_ius.OBJECT_ID)) AS 'drop statement'
 FROM sys.dm_db_index_usage_stats dm_ius
 INNER JOIN sys.indexes i ON i.index_id = dm_ius.index_id AND dm_ius.OBJECT_ID = i.OBJECT_ID
 INNER JOIN sys.objects o ON dm_ius.OBJECT_ID = o.OBJECT_ID
 INNER JOIN sys.schemas s ON o.schema_id = s.schema_id
 INNER JOIN (SELECT SUM(p.rows) TableRows, p.index_id, p.OBJECT_ID
 FROM sys.partitions p GROUP BY p.index_id, p.OBJECT_ID) p
 ON p.index_id = dm_ius.index_id AND dm_ius.OBJECT_ID = p.OBJECT_ID
 WHERE OBJECTPROPERTY(dm_ius.OBJECT_ID,'IsUserTable') = 1
 AND dm_ius.database_id = DB_ID()
 AND i.type_desc = 'nonclustered'
 AND i.is_primary_key = 0
 AND i.is_unique_constraint = 0
 ORDER BY (dm_ius.user_seeks + dm_ius.user_scans + dm_ius.user_lookups) ASC

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rebuild_index
-- --------------------------------------------------
CREATE procedure [dbo].[rebuild_index]  
@database varchar(100)  
as  
begin  
  
declare @db_id int  
Select @db_id = db_id(@database)  
  
if @db_id is Null  
return  
  
SET NOCOUNT ON;  
DECLARE @objectid int;  
DECLARE @indexid int;  
DECLARE @partitioncount bigint;  
DECLARE @schemaname nvarchar(130);  
DECLARE @objectname nvarchar(130);  
DECLARE @indexname nvarchar(130);  
DECLARE @partitionnum bigint;  
DECLARE @partitions bigint;  
DECLARE @frag float;  
DECLARE @command nvarchar(4000);  
-- Conditionally select tables and indexes from the sys.dm_db_index_physical_stats function  
-- and convert object and index IDs to names.  
  
SELECT  
object_id AS objectid,  
index_id AS indexid,  
partition_number AS partitionnum,  
avg_fragmentation_in_percent AS frag  
INTO #work_to_do  
FROM sys.dm_db_index_physical_stats (@db_id, NULL, NULL , NULL, 'LIMITED')  
WHERE avg_fragmentation_in_percent > 10.0 AND index_id > 0;  
  
-- Declare the cursor for the list of partitions to be processed.  
DECLARE partitions CURSOR FOR SELECT objectid,indexid,partitionnum,frag FROM #work_to_do;  
  
-- Open the cursor.  
OPEN partitions;  
  
-- Loop through the partitions.  
WHILE (1=1)  
BEGIN;  
FETCH NEXT  
FROM partitions  
INTO @objectid, @indexid, @partitionnum, @frag;  
IF @@FETCH_STATUS < 0 BREAK;  
SELECT @objectname = QUOTENAME(o.name), @schemaname = QUOTENAME(s.name)  
FROM sys.objects AS o  
JOIN sys.schemas as s ON s.schema_id = o.schema_id  
WHERE o.object_id = @objectid;  
SELECT @indexname = QUOTENAME(name)  
FROM sys.indexes  
WHERE object_id = @objectid AND index_id = @indexid;  
SELECT @partitioncount = count (*)  
FROM sys.partitions  
WHERE object_id = @objectid AND index_id = @indexid;  
  
-- 30 is an arbitrary decision point at which to switch between reorganizing and rebuilding.  
IF @frag < 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REORGANIZE';  
IF @frag >= 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REBUILD';  
IF @partitioncount > 1  
      SET @command = @command + N' PARTITION=' + CAST(@partitionnum AS nvarchar(10));  
IF @frag >= 30.0  
      set @command = @command +N' WITH (SORT_IN_TEMPDB = ON)' 
 
EXEC (@command);  
PRINT N'Executed: ' + @command;  
END;  
  
-- Close and deallocate the cursor.  
CLOSE partitions;  
DEALLOCATE partitions;  
  
-- Drop the temporary table.  
DROP TABLE #work_to_do;  
  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.RMS_Order_Capital_pattern_ANG
-- --------------------------------------------------

CREATE PROC RMS_Order_Capital_pattern_ANG (@DATE1 DATETIME ,   @DATE2 DATETIME)

AS
 
IF (SELECT COUNT(1) FROM CAPITALREQUIREMENT_SUMM WHERE MARGINDATE = @DATE1) = 0
BEGIN

SELECT 'Please upload the file for the date First and Process'
RETURN

END


IF (SELECT COUNT(1) FROM CAPITALREQUIREMENT_SUMM WHERE MARGINDATE = @DATE2) = 0
BEGIN

SELECT 'Please upload the file for the date First and Process'
RETURN

END



CREATE TABLE #TEMPTABLE (COL1 VARCHAR(100),COL2 VARCHAR(100),COL3 VARCHAR(100),COL4 VARCHAR(100))


INSERT INTO #TEMPTABLE ([COL1]) SELECT 'DATE'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'No. of Orders'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Order Growth'
INSERT INTO #TEMPTABLE ([COL1]) SELECT ''
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Capital-Peak'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Capital-Peak Growth'
INSERT INTO #TEMPTABLE ([COL1]) SELECT ''
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Capital-EOD'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Capital-EOD Growth'
INSERT INTO #TEMPTABLE ([COL1]) SELECT ''
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Capital Per Order'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Capital Requirement as per current volume'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Existing capital'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Funds reqd'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'OD (Funds should be available to avail intraday)-1'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Intraday-1'
INSERT INTO #TEMPTABLE ([COL1]) SELECT ''
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Intradaylines available'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'OD (Funds should be available to avail intraday)-2'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Intraday-2'
INSERT INTO #TEMPTABLE ([COL1]) SELECT ''
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Additional reqd'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'EOD'
INSERT INTO #TEMPTABLE ([COL1]) SELECT 'Intraday-3'

UPDATE #TEMPTABLE SET [COL2] ='',[COL3] ='',[COL4] =''

UPDATE #TEMPTABLE SET [COL2] = CONVERT(VARCHAR(10),@DATE1,105),[COL3] =CONVERT(VARCHAR(10),@DATE2,105),[COL4] = 'Inc/(Dec)' WHERE [COL1] = 'DATE'

UPDATE #TEMPTABLE SET [COL2] = (SELECT [No. of Orders] FROM CAPITALREQUIREMENT_SUMM_EOD WHERE MDATE = @DATE1),
[COL3] =(SELECT [No. of Orders] FROM CAPITALREQUIREMENT_SUMM_EOD WHERE MDATE = @DATE2) 
WHERE [COL1]  =  'No. of Orders'

UPDATE #TEMPTABLE SET [COL2] = CONVERT(NUMERIC(18,2),(SELECT Margin/10000000 FROM CAPITALREQUIREMENT_SUMM_EOD WHERE MDATE = @DATE1)),
[COL3] = CONVERT(NUMERIC(18,2),(SELECT Margin/10000000 FROM CAPITALREQUIREMENT_SUMM_EOD WHERE MDATE = @DATE2)) 
WHERE [COL1]  =  'Capital-EOD'

UPDATE #TEMPTABLE SET [COL2] = CONVERT(NUMERIC(18,2),(SELECT Margin/10000000 FROM CAPITALREQUIREMENT_SUMM_PEAK WHERE MDATE = @DATE1)),
[COL3] = CONVERT(NUMERIC(18,2),(SELECT Margin/10000000 FROM CAPITALREQUIREMENT_SUMM_PEAK WHERE MDATE = @DATE2)) 
WHERE [COL1]  =  'Capital-Peak'



UPDATE #TEMPTABLE SET [COL2] = CONVERT(NUMERIC(18,2),((SELECT CONVERT(NUMERIC(18,2),[COL2])  FROM #TEMPTABLE WHERE [COL1]  = 'Capital-Peak')/
(SELECT CONVERT(NUMERIC(18,2),[COL2])  FROM #TEMPTABLE WHERE [COL1]  = 'No. of Orders'))*10000000)
WHERE [COL1] = 'Capital Per Order'

UPDATE #TEMPTABLE SET [COL3] = CONVERT(NUMERIC(18,2),((SELECT CONVERT(NUMERIC(18,2),[COL3])  FROM #TEMPTABLE WHERE [COL1]  = 'Capital-Peak')
/(SELECT CONVERT(NUMERIC(18,2),[COL3])  FROM #TEMPTABLE WHERE [COL1]  = 'No. of Orders'))*10000000)
WHERE [COL1] = 'Capital Per Order'


UPDATE #TEMPTABLE SET [COL4] = CONVERT(NUMERIC(18,2),CONVERT(NUMERIC(18,2),[COL3]) - CONVERT(NUMERIC(18,2),[COL2]))
WHERE [COL1]  IN  ('Capital-Peak','Capital-EOD','No. of Orders','Capital Per Order')

UPDATE #TEMPTABLE SET [COL4] = CONVERT(NUMERIC(18,2),(SELECT CONVERT(NUMERIC(18,2),[COL4])*100  FROM #TEMPTABLE WHERE [COL1]  = 'No. of Orders')
/(SELECT CONVERT(NUMERIC(18,2),[COL2])  FROM #TEMPTABLE WHERE [COL1]  = 'No. of Orders'))
WHERE [COL1] = 'Order Growth'

UPDATE #TEMPTABLE SET [COL4] = CONVERT(NUMERIC(18,2),(SELECT CONVERT(NUMERIC(18,2),[COL4])*100  FROM #TEMPTABLE WHERE [COL1]  = 'Capital-Peak')/
(SELECT CONVERT(NUMERIC(18,2),[COL2])  FROM #TEMPTABLE WHERE [COL1]  = 'Capital-Peak'))
WHERE [COL1] = 'Capital-Peak Growth'

UPDATE #TEMPTABLE SET [COL4] = CONVERT(NUMERIC(18,2),(SELECT CONVERT(NUMERIC(18,2),[COL4])*100  FROM #TEMPTABLE WHERE [COL1]  = 'Capital-EOD')/
(SELECT CONVERT(NUMERIC(18,2),[COL2])  FROM #TEMPTABLE WHERE [COL1]  = 'Capital-EOD'))
WHERE [COL1] = 'Capital-EOD Growth'


UPDATE #TEMPTABLE SET [COL3] = CONVERT(NUMERIC(18,2),((SELECT CONVERT(NUMERIC(18,2),[COL2])  FROM #TEMPTABLE WHERE [COL1]  = 'Capital Per Order')*
(SELECT CONVERT(NUMERIC(18,2),[COL3])  FROM #TEMPTABLE WHERE [COL1]  = 'No. of Orders'))/10000000)
WHERE [COL1] = 'Capital Requirement as per current volume'

UPDATE #TEMPTABLE SET [COL3] = 0 WHERE [COL1] = 'Existing capital'

UPDATE #TEMPTABLE SET [COL3] = [Existing capital] FROM INHOUSE.DBO.CAPITALREQUIREMENT_SUMM A WHERE [COL1] = 'Existing capital' AND A.MARGINDATE = @DATE2

UPDATE #TEMPTABLE SET [COL3] = (SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Capital Requirement as per current volume') -
(SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Existing capital') WHERE [COL1] = 'Funds reqd'

UPDATE #TEMPTABLE SET [COL3] = CONVERT(NUMERIC(18,2),(SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Funds reqd')/2) 
WHERE [COL1] IN ('OD (Funds should be available to avail intraday)-1','Intraday-2')

UPDATE #TEMPTABLE SET [COL3] = 0 WHERE [COL1] = 'Intradaylines available'

UPDATE #TEMPTABLE SET [COL3] = [Intradaylines available] FROM INHOUSE.DBO.CAPITALREQUIREMENT_SUMM A WHERE [COL1] = 'Intradaylines available' AND A.MARGINDATE = @DATE2


UPDATE #TEMPTABLE SET [COL3] = CONVERT(NUMERIC(18,2),(SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Intradaylines available')/2) 
WHERE [COL1] IN ('OD (Funds should be available to avail intraday)-2','Intraday-2')


UPDATE #TEMPTABLE SET [COL3] = (SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Funds reqd') -
(SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Intradaylines available') WHERE [COL1] = 'Additional reqd'

UPDATE #TEMPTABLE SET [COL3] = CONVERT(NUMERIC(18,2),(SELECT CONVERT(NUMERIC(18,2),[COL3]) FROM  #TEMPTABLE WHERE [COL1] = 'Additional reqd')/2) 
WHERE [COL1] IN ('EOD','Intraday-3')


SELECT * FROM #TEMPTABLE

DROP TABLE #TEMPTABLE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_alterdiagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_alterdiagram
	(
		@diagramname 	sysname,
		@owner_id	int	= null,
		@version 	int,
		@definition 	varbinary(max)
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
	
		declare @theId 			int
		declare @retval 		int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
		declare @ShouldChangeUID	int
	
		if(@diagramname is null)
		begin
			RAISERROR ('Invalid ARG', 16, 1)
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID();	 
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		revert;
	
		select @ShouldChangeUID = 0
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		
		if(@DiagId IS NULL or (@IsDbo = 0 and @theId <> @UIDFound))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1);
			return -3
		end
	
		if(@IsDbo <> 0)
		begin
			if(@UIDFound is null or USER_NAME(@UIDFound) is null) -- invalid principal_id
			begin
				select @ShouldChangeUID = 1 ;
			end
		end

		-- update dds data			
		update dbo.sysdiagrams set definition = @definition where diagram_id = @DiagId ;

		-- change owner
		if(@ShouldChangeUID = 1)
			update dbo.sysdiagrams set principal_id = @theId where diagram_id = @DiagId ;

		-- update dds version
		if(@version is not null)
			update dbo.sysdiagrams set version = @version where diagram_id = @DiagId ;

		return 0
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_creatediagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_creatediagram
	(
		@diagramname 	sysname,
		@owner_id		int	= null, 	
		@version 		int,
		@definition 	varbinary(max)
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
	
		declare @theId int
		declare @retval int
		declare @IsDbo	int
		declare @userName sysname
		if(@version is null or @diagramname is null)
		begin
			RAISERROR (N'E_INVALIDARG', 16, 1);
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID(); 
		select @IsDbo = IS_MEMBER(N'db_owner');
		revert; 
		
		if @owner_id is null
		begin
			select @owner_id = @theId;
		end
		else
		begin
			if @theId <> @owner_id
			begin
				if @IsDbo = 0
				begin
					RAISERROR (N'E_INVALIDARG', 16, 1);
					return -1
				end
				select @theId = @owner_id
			end
		end
		-- next 2 line only for test, will be removed after define name unique
		if EXISTS(select diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @diagramname)
		begin
			RAISERROR ('The name is already used.', 16, 1);
			return -2
		end
	
		insert into dbo.sysdiagrams(name, principal_id , version, definition)
				VALUES(@diagramname, @theId, @version, @definition) ;
		
		select @retval = @@IDENTITY 
		return @retval
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_dropdiagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_dropdiagram
	(
		@diagramname 	sysname,
		@owner_id	int	= null
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
		declare @theId 			int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
	
		if(@diagramname is null)
		begin
			RAISERROR ('Invalid value', 16, 1);
			return -1
		end
	
		EXECUTE AS CALLER;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		REVERT; 
		
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1)
			return -3
		end
	
		delete from dbo.sysdiagrams where diagram_id = @DiagId;
	
		return 0;
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_helpdiagramdefinition
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_helpdiagramdefinition
	(
		@diagramname 	sysname,
		@owner_id	int	= null 		
	)
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		set nocount on

		declare @theId 		int
		declare @IsDbo 		int
		declare @DiagId		int
		declare @UIDFound	int
	
		if(@diagramname is null)
		begin
			RAISERROR (N'E_INVALIDARG', 16, 1);
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner');
		if(@owner_id is null)
			select @owner_id = @theId;
		revert; 
	
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname;
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId ))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1);
			return -3
		end

		select version, definition FROM dbo.sysdiagrams where diagram_id = @DiagId ; 
		return 0
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_helpdiagrams
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_helpdiagrams
	(
		@diagramname sysname = NULL,
		@owner_id int = NULL
	)
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		DECLARE @user sysname
		DECLARE @dboLogin bit
		EXECUTE AS CALLER;
			SET @user = USER_NAME();
			SET @dboLogin = CONVERT(bit,IS_MEMBER('db_owner'));
		REVERT;
		SELECT
			[Database] = DB_NAME(),
			[Name] = name,
			[ID] = diagram_id,
			[Owner] = USER_NAME(principal_id),
			[OwnerID] = principal_id
		FROM
			sysdiagrams
		WHERE
			(@dboLogin = 1 OR USER_NAME(principal_id) = @user) AND
			(@diagramname IS NULL OR name = @diagramname) AND
			(@owner_id IS NULL OR principal_id = @owner_id)
		ORDER BY
			4, 5, 1
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_renamediagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_renamediagram
	(
		@diagramname 		sysname,
		@owner_id		int	= null,
		@new_diagramname	sysname
	
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
		declare @theId 			int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
		declare @DiagIdTarg		int
		declare @u_name			sysname
		if((@diagramname is null) or (@new_diagramname is null))
		begin
			RAISERROR ('Invalid value', 16, 1);
			return -1
		end
	
		EXECUTE AS CALLER;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		REVERT;
	
		select @u_name = USER_NAME(@owner_id)
	
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1)
			return -3
		end
	
		-- if((@u_name is not null) and (@new_diagramname = @diagramname))	-- nothing will change
		--	return 0;
	
		if(@u_name is null)
			select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @new_diagramname
		else
			select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @owner_id and name = @new_diagramname
	
		if((@DiagIdTarg is not null) and  @DiagId <> @DiagIdTarg)
		begin
			RAISERROR ('The name is already used.', 16, 1);
			return -2
		end		
	
		if(@u_name is null)
			update dbo.sysdiagrams set [name] = @new_diagramname, principal_id = @theId where diagram_id = @DiagId
		else
			update dbo.sysdiagrams set [name] = @new_diagramname where diagram_id = @DiagId
		return 0
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_upgraddiagrams
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_upgraddiagrams
	AS
	BEGIN
		IF OBJECT_ID(N'dbo.sysdiagrams') IS NOT NULL
			return 0;
	
		CREATE TABLE dbo.sysdiagrams
		(
			name sysname NOT NULL,
			principal_id int NOT NULL,	-- we may change it to varbinary(85)
			diagram_id int PRIMARY KEY IDENTITY,
			version int,
	
			definition varbinary(max)
			CONSTRAINT UK_principal_name UNIQUE
			(
				principal_id,
				name
			)
		);


		/* Add this if we need to have some form of extended properties for diagrams */
		/*
		IF OBJECT_ID(N'dbo.sysdiagram_properties') IS NULL
		BEGIN
			CREATE TABLE dbo.sysdiagram_properties
			(
				diagram_id int,
				name sysname,
				value varbinary(max) NOT NULL
			)
		END
		*/

		IF OBJECT_ID(N'dbo.dtproperties') IS NOT NULL
		begin
			insert into dbo.sysdiagrams
			(
				[name],
				[principal_id],
				[version],
				[definition]
			)
			select	 
				convert(sysname, dgnm.[uvalue]),
				DATABASE_PRINCIPAL_ID(N'dbo'),			-- will change to the sid of sa
				0,							-- zero for old format, dgdef.[version],
				dgdef.[lvalue]
			from dbo.[dtproperties] dgnm
				inner join dbo.[dtproperties] dggd on dggd.[property] = 'DtgSchemaGUID' and dggd.[objectid] = dgnm.[objectid]	
				inner join dbo.[dtproperties] dgdef on dgdef.[property] = 'DtgSchemaDATA' and dgdef.[objectid] = dgnm.[objectid]
				
			where dgnm.[property] = 'DtgSchemaNAME' and dggd.[uvalue] like N'_EA3E6268-D998-11CE-9454-00AA00A3F36E_' 
			return 2;
		end
		return 1;
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spLogIops204
-- --------------------------------------------------
create proc spLogIops204
as

insert into LogIops204
select db_name(mf.database_id) as database_name, mf.physical_name, 
left(mf.physical_name, 1) as drive_letter, 
vfs.num_of_writes, vfs.num_of_bytes_written, vfs.io_stall_write_ms, 
mf.type_desc, vfs.num_of_reads, vfs.num_of_bytes_read, vfs.io_stall_read_ms,
vfs.io_stall, vfs.size_on_disk_bytes,Recordtime = Getdate()
from sys.master_files mf
join sys.dm_io_virtual_file_stats(NULL, NULL) vfs
on mf.database_id=vfs.database_id and mf.file_id=vfs.file_id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPTestPrepaid
-- --------------------------------------------------
CREATE proc SPTestPrepaid                                 
( @fvdt as datetime,@tvdt as datetime, @code as varchar(10))                                       
                                      
as                                      
          
set nocount on                                    
          
--declare  @code1 as varchar(10), @code2 as varchar(10)          
--set @code1 = '4100' + right(@code, 2)          
--set @code2= '4200' + right(@code, 2)                        
--declare @fvdt as datetime,@tvdt as datetime,@code as varchar(10)                          
--set @fvdt = '2008-04-01'                          
--set @tvdt = '2009-03-31'      
--set @code ='250001'               
--left(convert(varchar,vdt,121),11)  --convert(varchar(11),convert(datetime,vdt),103)                     
                                 
select * into #t from accountNCDX.dbo.ledger  where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                                      
                          
                              
select drcr= case                               
when drcr = 'D' then 'C'                               
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                              
select convert(varchar(11),vdt,103) as [Date],VNO,cltcode,acname, segment='NCDX',vamt,narration as [Narration],DRCR,vtyp  into #file1 from                              
(                              
select * from #t                            
union                             
select x.* from                              
(                              
select l.*                      
from accountNCDX.dbo.ledger l , #t t                       
where l.vtyp = t.vtyp and l.vtyp <> '18' and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' or l.cltcode not like '2%' and l.cltcode  like '5%')                     
              
) x              
inner join                              
(select * from #l1)y                              
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                              
) x where cltcode not like '27%'  and cltcode not like '26%' --and cltcode  like '5%'            
    
    
    
--select t.vtyp,t.vno,t.vdt,t.drcr,t.vamt,t.cltcode,t.acname    
--from #t t    
    
--declare @fvdt as datetime,@tvdt as datetime,@code as varchar(10)                          
--set @fvdt = '2008-04-01'                          
--set @tvdt = '2009-03-31'      
--set @code ='250001'               
    
select * into #P from accountNCDX.dbo.ledger  where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt         
    
    
select l.vtyp,l.vno,l.acname,l.drcr,l.vamt,l.cltcode  into #prepaid1                   
from accountNCDX.dbo.ledger l , #p p                       
where l.vtyp = p.vtyp and l.vtyp <> '18' and l.vno = p.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' and l.cltcode not like '2%')    
    
    
select t.vdt,t.VTYP,t.vno,t.cltcode,t.acname,t.drcr,t.vamt,t.narration,p.cltcode,p.acname,p.drcr,p.vamt    
from #t t left join #prepaid1 p    
on t.vtyp=p.vtyp and t.vno=p.vno

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPTestPrepaid_FAS
-- --------------------------------------------------
      
CREATE proc SPTestPrepaid_FAS                                    
( @fvdt as datetime,@tvdt as datetime, @code as varchar(10))                                           
                                          
as                                          
              
set nocount on                                                   
                                     
select * into #t from FAS.dbo.ledger  where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                                          
                              
                                  
select drcr= case                                   
when drcr = 'D' then 'C'                                   
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                                  
select convert(varchar(11),vdt,103) as [Date],VNO,cltcode,acname, segment='AIPL',vamt,      
narration as [Narration],DRCR,vtyp  into #file1 from                                  
(                                  
select * from #t                                
union                                 
select x.* from                                  
(                                  
select l.*                          
from FAS.dbo.ledger l , #t t                           
where l.vtyp = t.vtyp and l.vtyp <> '18' and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt       
and left(convert(varchar,l.vdt,121),11) <= @tvdt and isnumeric(l.cltcode) = 1       
and (l.cltcode not like '4%' or l.cltcode not like '2%' and l.cltcode  like '5%')                         
                  
) x                  
inner join                                  
(select * from #l1)y                                  
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                                  
) x where cltcode not like '27%'  and cltcode not like '26%' --and cltcode  like '5%'                
                
        
select * into #P from FAS.dbo.ledger  where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt       
and left(convert(varchar,vdt,121),11)<=@tvdt             
        
        
select l.vtyp,l.vno,l.acname,l.drcr,l.vamt,l.cltcode  into #prepaid1                       
from FAS.dbo.ledger l , #p p                           
where l.vtyp = p.vtyp and l.vtyp <> '18' and l.vno = p.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt       
and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1       
and (l.cltcode not like '4%' and l.cltcode not like '2%')        
        
        
select t.vdt,t.VTYP,t.vno,t.cltcode,t.acname,t.drcr,t.vamt,t.narration,p.cltcode,p.acname,p.drcr,p.vamt        
from #t t left join #prepaid1 p        
on t.vtyp=p.vtyp and t.vno=p.vno

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ucc_mcx_client_data_for_given_clients_test1
-- --------------------------------------------------




CREATE proc [dbo].[ucc_mcx_client_data_for_given_clients_test1] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec ucc_mcx_client_data_for_given_clients_test1 '', '', 'Y'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end


set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

truncate table _temp_mcx_client_data_new_temp

select 
Cl_Code=ltrim(rtrim(isnull(Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(L_Address2, ''))),L_city=ltrim(rtrim(isnull(L_city, ''))),L_State=ltrim(rtrim(isnull(L_State, ''))),
L_Nation=ltrim(rtrim(isnull(L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(L_Zip, ''))),Fax=ltrim(rtrim(isnull(Fax, ''))),
Res_Phone1=ltrim(rtrim(isnull(Res_Phone1, ''))),Res_Phone2=ltrim(rtrim(isnull(Res_Phone2, ''))),Off_Phone1=ltrim(rtrim(isnull(Off_Phone1, ''))),
Off_Phone2=ltrim(rtrim(isnull(Off_Phone2, ''))),Email=ltrim(rtrim(isnull(Email, ''))),Branch_cd=ltrim(rtrim(isnull(Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(Credit_Limit)),Cl_type=ltrim(rtrim(isnull(Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(Cl_Status, ''))),
Gl_Code=ltrim(rtrim(Gl_Code)),Fd_Code=ltrim(rtrim(isnull(Fd_Code, ''))),Family=ltrim(rtrim(isnull(Family, ''))),
Penalty=ltrim(rtrim(Penalty)),Sub_Broker=ltrim(rtrim(isnull(Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(L_Address3, ''))),Mobile_Pager=ltrim(rtrim(isnull(Mobile_Pager, ''))),
pan_gir_no=ltrim(rtrim(isnull(pan_gir_no, ''))),trader=ltrim(rtrim(isnull(trader, ''))),WARD_NO=ltrim(rtrim(isnull(WARD_NO, ''))),
Region=ltrim(rtrim(isnull(Region, ''))),Area=ltrim(rtrim(isnull(Area, ''))),ClRating=ltrim(rtrim(isnull(ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,Mcx_01_03_2013_02 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-23 00:00:00.000'
	
select c2.* into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,Mcx_01_03_2013_02 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-23 00:00:00.000'
	
select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),Mcx_01_03_2013_02 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c5.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-23 00:00:00.000'
	
	

insert into
	_temp_mcx_client_data_new_temp

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	[client first name] = 	
		left (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[middle name] = 
		substring (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(c1.long_name, space(2), space(1))) else
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[last name] = 
		right (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) - 1 
			end
		),
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then 'N.A' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = 
		case when len(c1.l_city) = 0 then 'N.A' else c1.l_city end,
	[state] = 
		case when len(c1.l_state) = 0 then 'N.A' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = 
		case when len(c1.l_nation) = 0 then 'N.A' else c1.l_nation end,
	[pin code] = c1.l_zip,
	[telephone number] = 
		case when 
			isnumeric( 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			) = 1 
			then 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			else 
				'' 
			end,
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	[pan number] = ltrim(rtrim(isnull(c1.pan_gir_no, ''))),
	[ward number] = ltrim(rtrim(isnull(c1.ward_no, ''))),
	[uin] = ltrim(rtrim(space(1))),

	[bank name] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = 'NSDL',
	[depository participant id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),
	[depository participant name (nsdl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		),
	[beneficiary account id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),

	[depository name (cdsl)] = 'CDSL',
	[depository participant id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),
	[depository participant name (cdsl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		),
	[beneficiary account id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),

	[passport number] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.passportdtl, ''))) 
		end,
	[place of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.passportplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.passportplaceofissue, ''))) end
		end,
	[date of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportdateofissue, ''), 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportexpdate, ''), 103), '/', '')
		end,
	[driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.drivelicendtl, ''))) 
		end,
	[place of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.licencenoplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.licencenoplaceofissue, ''))) end
		end,
	[date of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.licencenodateofissue, ''), 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.driveexpdate, ''), 103), '/', '') 
		end,

	[voter id] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.votersiddtl, ''))) 
		end,
	[place of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.voteridplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.voteridplaceofissue, ''))) end
		end,
	[date of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.voteriddateofissue, ''), 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.rationcarddtl, ''))) 
		end,
	[place of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.rationcardplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.rationcardplaceofissue, ''))) end
		end,
	[date of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.rationcarddateofissue, ''), 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else ltrim(rtrim(isnull(c5.regr_no, '')))
		end,
	[registering authority] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
				end
			end,
	[place of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
				end
			end,
	[date of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else
					replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
				end
			end,

	[introducers name] = 
		ltrim(rtrim(isnull(c5.introducer, ''))),
	[introducers client id] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_client_id, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_client_id, ''))) end
		end,
	[relationship with the introducer] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_relation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_relation, ''))) end
		end,

	[dealing with other member] = 
		case 
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = '' then 'N'
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = ltrim(rtrim('E')), 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved=''


from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock),
	--MCX_14_02_2013 m1 with(nolock)
	Mcx_01_03_2013_02 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, ''))) 
	and m1.party_code is not null 
and lasttradedate='2013-01-23 00:00:00.000' and
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'
	
	
	
	update
		_temp_mcx_client_data_new_temp
	set
		_temp_mcx_client_data_new_temp.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = _temp_mcx_client_data_new_temp.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(_temp_mcx_client_data_new_temp.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		_temp_mcx_client_data_new_temp
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(_temp_mcx_client_data_new_temp.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp.[client code], '')))) > 0
		
		--select * from _temp_mcx_client_data_new_temp
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	_temp_mcx_client_data_new_temp
from
	[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
where
	--ltrim(rtrim(replace(isnull(_temp_mcx_client_data_new_temp.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(_temp_mcx_client_data_new_temp.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then 'N.A'
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=ltrim(rtrim(replace(isnull(reserved, ''), ',', ''))),
	[flag] = ltrim(rtrim(replace(isnull([flag], ''), ',', '')))

from

--	#_temp_mcx_client_data
	_temp_mcx_client_data_new_temp

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ucc_mcx_client_data_for_given_clients_test2
-- --------------------------------------------------




CREATE proc [dbo].[ucc_mcx_client_data_for_given_clients_test2] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec ucc_mcx_client_data_for_given_clients_test2 '', '', 'Y'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end


set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

truncate table _temp_mcx_client_data_new_temp1

select 
Cl_Code=ltrim(rtrim(isnull(Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(L_Address2, ''))),L_city=ltrim(rtrim(isnull(L_city, ''))),L_State=ltrim(rtrim(isnull(L_State, ''))),
L_Nation=ltrim(rtrim(isnull(L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(L_Zip, ''))),Fax=ltrim(rtrim(isnull(Fax, ''))),
Res_Phone1=ltrim(rtrim(isnull(Res_Phone1, ''))),Res_Phone2=ltrim(rtrim(isnull(Res_Phone2, ''))),Off_Phone1=ltrim(rtrim(isnull(Off_Phone1, ''))),
Off_Phone2=ltrim(rtrim(isnull(Off_Phone2, ''))),Email=ltrim(rtrim(isnull(Email, ''))),Branch_cd=ltrim(rtrim(isnull(Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(Credit_Limit)),Cl_type=ltrim(rtrim(isnull(Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(Cl_Status, ''))),
Gl_Code=ltrim(rtrim(Gl_Code)),Fd_Code=ltrim(rtrim(isnull(Fd_Code, ''))),Family=ltrim(rtrim(isnull(Family, ''))),
Penalty=ltrim(rtrim(Penalty)),Sub_Broker=ltrim(rtrim(isnull(Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(L_Address3, ''))),Mobile_Pager=ltrim(rtrim(isnull(Mobile_Pager, ''))),
pan_gir_no=ltrim(rtrim(isnull(pan_gir_no, ''))),trader=ltrim(rtrim(isnull(trader, ''))),WARD_NO=ltrim(rtrim(isnull(WARD_NO, ''))),
Region=ltrim(rtrim(isnull(Region, ''))),Area=ltrim(rtrim(isnull(Area, ''))),ClRating=ltrim(rtrim(isnull(ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and m1.party_code is not null 
	
and lasttradedate='2013-01-24 00:00:00.000'
	
select c2.* into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-24 00:00:00.000'
	
select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c5.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-24 00:00:00.000'
	
	

insert into
	_temp_mcx_client_data_new_temp1

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	[client first name] = 	
		left (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[middle name] = 
		substring (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(c1.long_name, space(2), space(1))) else
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[last name] = 
		right (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) - 1 
			end
		),
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then 'N.A' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = 
		case when len(c1.l_city) = 0 then 'N.A' else c1.l_city end,
	[state] = 
		case when len(c1.l_state) = 0 then 'N.A' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = 
		case when len(c1.l_nation) = 0 then 'N.A' else c1.l_nation end,
	[pin code] = c1.l_zip,
	[telephone number] = 
		case when 
			isnumeric( 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			) = 1 
			then 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			else 
				'' 
			end,
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	[pan number] = ltrim(rtrim(isnull(c1.pan_gir_no, ''))),
	[ward number] = ltrim(rtrim(isnull(c1.ward_no, ''))),
	[uin] = ltrim(rtrim(space(1))),

	[bank name] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = 'NSDL',
	[depository participant id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),
	[depository participant name (nsdl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		),
	[beneficiary account id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),

	[depository name (cdsl)] = 'CDSL',
	[depository participant id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),
	[depository participant name (cdsl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		),
	[beneficiary account id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),

	[passport number] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.passportdtl, ''))) 
		end,
	[place of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.passportplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.passportplaceofissue, ''))) end
		end,
	[date of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportdateofissue, ''), 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportexpdate, ''), 103), '/', '')
		end,
	[driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.drivelicendtl, ''))) 
		end,
	[place of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.licencenoplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.licencenoplaceofissue, ''))) end
		end,
	[date of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.licencenodateofissue, ''), 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.driveexpdate, ''), 103), '/', '') 
		end,

	[voter id] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.votersiddtl, ''))) 
		end,
	[place of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.voteridplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.voteridplaceofissue, ''))) end
		end,
	[date of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.voteriddateofissue, ''), 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.rationcarddtl, ''))) 
		end,
	[place of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.rationcardplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.rationcardplaceofissue, ''))) end
		end,
	[date of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.rationcarddateofissue, ''), 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else ltrim(rtrim(isnull(c5.regr_no, '')))
		end,
	[registering authority] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
				end
			end,
	[place of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
				end
			end,
	[date of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else
					replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
				end
			end,

	[introducers name] = 
		ltrim(rtrim(isnull(c5.introducer, ''))),
	[introducers client id] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_client_id, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_client_id, ''))) end
		end,
	[relationship with the introducer] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_relation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_relation, ''))) end
		end,

	[dealing with other member] = 
		case 
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = '' then 'N'
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = ltrim(rtrim('E')), 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved=''


from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock),
	--MCX_14_02_2013 m1 with(nolock)
	mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, ''))) 
	and m1.party_code is not null 
and lasttradedate='2013-01-24 00:00:00.000' 
 and
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'
	
	
	
	update
		_temp_mcx_client_data_new_temp1
	set
		_temp_mcx_client_data_new_temp1.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = _temp_mcx_client_data_new_temp1.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(_temp_mcx_client_data_new_temp1.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		_temp_mcx_client_data_new_temp1
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(_temp_mcx_client_data_new_temp1.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], '')))) > 0
		
		--select * from _temp_mcx_client_data_new_temp1
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	_temp_mcx_client_data_new_temp1
from
	[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
where
	--ltrim(rtrim(replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then 'N.A'
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=ltrim(rtrim(replace(isnull(reserved, ''), ',', ''))),
	[flag] = ltrim(rtrim(replace(isnull([flag], ''), ',', '')))

from

--	#_temp_mcx_client_data
	_temp_mcx_client_data_new_temp1

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ucc_mcx_client_data_for_given_clients_test2BBG
-- --------------------------------------------------
CREATE proc [dbo].[ucc_mcx_client_data_for_given_clients_test2BBG] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec ucc_mcx_client_data_for_given_clients_test2 '', '', 'Y'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end


set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

Declare @@MaxTsrNo Int
Declare @@TsrNo Int
Declare @@Bank_name Varchar(255)
Declare @@Party_code Varchar(15)
Declare @@bankbranchaddress Varchar(512)
Declare @@bankaccountnumber Varchar(52)
Declare @@bankaccounttype Varchar(52)
Declare @@depositoryparticipantidnsdl Varchar(51)
Declare @@depositoryparticipantnamensdl Varchar(512)
Declare @@beneficiaryaccountidnsdl Varchar(512)
Declare @@depositoryparticipantidcdsl Varchar(512)
Declare @@depositoryparticipantnamecdsl Varchar(512)
Declare @@beneficiaryaccountidcdsl Varchar(512)

truncate table _temp_mcx_client_data_new_temp1

select 
Cl_Code=ltrim(rtrim(isnull(Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(L_Address2, ''))),L_city=ltrim(rtrim(isnull(L_city, ''))),L_State=ltrim(rtrim(isnull(L_State, ''))),
L_Nation=ltrim(rtrim(isnull(L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(L_Zip, ''))),Fax=ltrim(rtrim(isnull(Fax, ''))),
Res_Phone1=ltrim(rtrim(isnull(Res_Phone1, ''))),Res_Phone2=ltrim(rtrim(isnull(Res_Phone2, ''))),Off_Phone1=ltrim(rtrim(isnull(Off_Phone1, ''))),
Off_Phone2=ltrim(rtrim(isnull(Off_Phone2, ''))),Email=ltrim(rtrim(isnull(Email, ''))),Branch_cd=ltrim(rtrim(isnull(Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(Credit_Limit)),Cl_type=ltrim(rtrim(isnull(Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(Cl_Status, ''))),
Gl_Code=ltrim(rtrim(Gl_Code)),Fd_Code=ltrim(rtrim(isnull(Fd_Code, ''))),Family=ltrim(rtrim(isnull(Family, ''))),
Penalty=ltrim(rtrim(Penalty)),Sub_Broker=ltrim(rtrim(isnull(Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(L_Address3, ''))),Mobile_Pager=ltrim(rtrim(isnull(Mobile_Pager, ''))),
pan_gir_no=ltrim(rtrim(isnull(pan_gir_no, ''))),trader=ltrim(rtrim(isnull(trader, ''))),WARD_NO=ltrim(rtrim(isnull(WARD_NO, ''))),
Region=ltrim(rtrim(isnull(Region, ''))),Area=ltrim(rtrim(isnull(Area, ''))),ClRating=ltrim(rtrim(isnull(ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and m1.party_code is not null 
	
and lasttradedate='2013-01-25 00:00:00.000'
	
select c2.* into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-25 00:00:00.000'
	
select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c5.cl_code, '')))
	and m1.party_code is not null 
and lasttradedate='2013-01-25 00:00:00.000'
	
	

insert into
	_temp_mcx_client_data_new_temp1

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	[client first name] = 	
		left (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[middle name] = 
		substring (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(c1.long_name, space(2), space(1))) else
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[last name] = 
		right (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) - 1 
			end
		),
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then 'N.A' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = 
		case when len(c1.l_city) = 0 then 'N.A' else c1.l_city end,
	[state] = 
		case when len(c1.l_state) = 0 then 'N.A' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = 
		case when len(c1.l_nation) = 0 then 'N.A' else c1.l_nation end,
	[pin code] = c1.l_zip,
	[telephone number] = 
		case when 
			isnumeric( 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			) = 1 
			then 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			else 
				'' 
			end,
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	[pan number] = ltrim(rtrim(isnull(c1.pan_gir_no, ''))),
	[ward number] = ltrim(rtrim(isnull(c1.ward_no, ''))),
	[uin] = ltrim(rtrim(space(1))),

	[bank name] =  ''
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		) */ ,
	[bank branch address] = ''
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		) */ ,
	[bank account number] = '',
		-- (select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = '',
		--(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = 'NSDL',
	[depository participant id (nsdl)] = '',
		--(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),
	[depository participant name (nsdl)] = '',
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		)*/
	[beneficiary account id (nsdl)] = '',
		-- (select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),

	[depository name (cdsl)] = 'CDSL',
	[depository participant id (cdsl)] = '',
		--(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),
	[depository participant name (cdsl)] = ''
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		) */,
	[beneficiary account id (cdsl)] = '',
		--(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),

	[passport number] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.passportdtl, ''))) 
		end,
	[place of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.passportplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.passportplaceofissue, ''))) end
		end,
	[date of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportdateofissue, ''), 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportexpdate, ''), 103), '/', '')
		end,
	[driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.drivelicendtl, ''))) 
		end,
	[place of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.licencenoplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.licencenoplaceofissue, ''))) end
		end,
	[date of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.licencenodateofissue, ''), 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.driveexpdate, ''), 103), '/', '') 
		end,

	[voter id] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.votersiddtl, ''))) 
		end,
	[place of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.voteridplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.voteridplaceofissue, ''))) end
		end,
	[date of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.voteriddateofissue, ''), 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.rationcarddtl, ''))) 
		end,
	[place of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.rationcardplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.rationcardplaceofissue, ''))) end
		end,
	[date of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.rationcarddateofissue, ''), 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else ltrim(rtrim(isnull(c5.regr_no, '')))
		end,
	[registering authority] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
				end
			end,
	[place of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
				end
			end,
	[date of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else
					replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
				end
			end,

	[introducers name] = 
		ltrim(rtrim(isnull(c5.introducer, ''))),
	[introducers client id] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_client_id, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_client_id, ''))) end
		end,
	[relationship with the introducer] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_relation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_relation, ''))) end
		end,

	[dealing with other member] = 
		case 
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = '' then 'N'
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = ltrim(rtrim('E')), 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved=''


from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock),
	--MCX_14_02_2013 m1 with(nolock)
	mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, ''))) 
	and m1.party_code is not null 
and lasttradedate='2013-01-25 00:00:00.000' 
 and
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'
	
	--select [bank name] from _temp_mcx_client_data_new_temp1 

	Select @@MaxTsrNo = Max(SrNo) from _temp_mcx_client_data_new_temp1
	Select @@TsrNo = 0
	Select @@bank_name = ''
	Select @@bankbranchaddress = ''
	Select @@bankaccountnumber = ''
	Select @@bankaccounttype = ''
	Select @@depositoryparticipantidnsdl = ''
	Select @@depositoryparticipantnamensdl  = ''
	Select @@depositoryparticipantidcdsl = ''
	Select @@depositoryparticipantnamecdsl = ''
	While @@TsrNo <= @@MaxTsrNo
	Begin
	     Select @@Party_code = [client code] From  _temp_mcx_client_data_new_temp1
		 Where SrNo =  @@TsrNo
		 Select distinct top 1 @@Bank_name =  
				ltrim(rtrim(isnull(b.bank_name, ''))) ,
				@@bankbranchaddress = 
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, ''))),
				@@bankaccountnumber = isnull(c4.cltdpid, ''),
				@@bankaccounttype = isnull(c4.depository, '')
				
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
                angelcommodity.mcdx.dbo.client4 c4 with( nolock) --,
				
			where 
			    ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')


            Select distinct top 1 @@depositoryparticipantidnsdl = isnull(c4.bankid, '')
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' 
				
            
            Select distinct top 1 @@depositoryparticipantnamensdl =  ltrim(rtrim(isnull(b.bankname, ''))) 
			
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'

           Select distinct @@beneficiaryaccountidnsdl = ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) 
		   where ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code  
		   and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'

		   select distinct @@depositoryparticipantidcdsl = ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) 
		   where ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'
				
           Select Distinct top 1 @@depositoryparticipantnamecdsl = ltrim(rtrim(isnull(b.bankname, ''))) 
		   from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
		   where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
          
		  Select distinct @@beneficiaryaccountidcdsl =  ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) 
		  where ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'

                Update _temp_mcx_client_data_new_temp1 Set [bank name] = @@Bank_name  ,	[bank branch address]  = @@bankbranchaddress,[bank account number] = @@bankaccountnumber,
				[bank account type] = @@bankaccounttype , [depository participant id (nsdl)] = @@depositoryparticipantidnsdl,
				[depository participant name (nsdl)] = @@depositoryparticipantnamensdl , @@beneficiaryaccountidnsdl = [beneficiary account id (nsdl)],
				[depository participant id (cdsl)] = @@depositoryparticipantidcdsl ,
				[depository participant name (cdsl)] = @@depositoryparticipantnamecdsl,
				[beneficiary account id (cdsl)] = @@beneficiaryaccountidcdsl

				Where SrNo = @@TSrNo

	/* Update _temp_mcx_client_data_new_temp1 Set [bank name] = 
	 (
			select distinct top 1 
				Bank_name = ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
                angelcommodity.mcdx.dbo.client4 c4 with( nolock) --,
				--angelcommodity.mcdx.dbo.client2 c2 with( nolock) 
				
			where 
			    ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		) */
		Select @@Bank_name = ''
		Select @@bankbranchaddress = ''
		Select @@bankaccountnumber = ''
		Select @@bankaccounttype = ''
		Select @@depositoryparticipantidnsdl = ''
    	Select @@depositoryparticipantnamensdl  = ''
		Select @@depositoryparticipantidcdsl  = ''
		Select @@beneficiaryaccountidcdsl = ''
		Select @@TsrNo = @@TsrNo + 1
			
	End	
	Return

	Select @@bankbranchaddress = ''

	/* Update _temp_mcx_client_data_new_temp1 Set	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		)
	
	

	Update _temp_mcx_client_data_new_temp1 Set [bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT'))
		
	Update _temp_mcx_client_data_new_temp1 Set [bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT'))
		

Update _temp_mcx_client_data_new_temp1 Set [depository participant id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL')
		
Update _temp_mcx_client_data_new_temp1 Set[depository participant name (nsdl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		)

Update _temp_mcx_client_data_new_temp1 Set [beneficiary account id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL')

Update _temp_mcx_client_data_new_temp1 Set [depository participant id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL')
		

Update _temp_mcx_client_data_new_temp1 Set [depository participant name (cdsl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		)

Update _temp_mcx_client_data_new_temp1 Set[beneficiary account id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL')

*/
	
	update
		_temp_mcx_client_data_new_temp1
	set
		_temp_mcx_client_data_new_temp1.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = _temp_mcx_client_data_new_temp1.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(_temp_mcx_client_data_new_temp1.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		_temp_mcx_client_data_new_temp1
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(_temp_mcx_client_data_new_temp1.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], '')))) > 0
		
		--select * from _temp_mcx_client_data_new_temp1
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	_temp_mcx_client_data_new_temp1
from
	[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
where
	--ltrim(rtrim(replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then 'N.A'
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=ltrim(rtrim(replace(isnull(reserved, ''), ',', ''))),
	[flag] = ltrim(rtrim(replace(isnull([flag], ''), ',', '')))

from

--	#_temp_mcx_client_data
	_temp_mcx_client_data_new_temp1

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ucc_mcx_client_data_for_given_clients_test2BBG1
-- --------------------------------------------------
CREATE proc [dbo].[ucc_mcx_client_data_for_given_clients_test2BBG1] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec ucc_mcx_client_data_for_given_clients_test2BBG1 '', '', 'Y'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end


set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

Declare @@MaxTsrNo Int
Declare @@TsrNo Int
Declare @@Bank_name Varchar(255)
Declare @@Party_code Varchar(15)
Declare @@bankbranchaddress Varchar(512)
Declare @@bankaccountnumber Varchar(52)
Declare @@bankaccounttype Varchar(52)
Declare @@depositoryparticipantidnsdl Varchar(51)
Declare @@depositoryparticipantnamensdl Varchar(512)
Declare @@beneficiaryaccountidnsdl Varchar(512)
Declare @@depositoryparticipantidcdsl Varchar(512)
Declare @@depositoryparticipantnamecdsl Varchar(512)
Declare @@beneficiaryaccountidcdsl Varchar(512)

truncate table _temp_mcx_client_data_new_temp1

select 
Cl_Code=ltrim(rtrim(isnull(Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(L_Address2, ''))),L_city=ltrim(rtrim(isnull(L_city, ''))),L_State=ltrim(rtrim(isnull(L_State, ''))),
L_Nation=ltrim(rtrim(isnull(L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(L_Zip, ''))),Fax=ltrim(rtrim(isnull(Fax, ''))),
Res_Phone1=ltrim(rtrim(isnull(Res_Phone1, ''))),Res_Phone2=ltrim(rtrim(isnull(Res_Phone2, ''))),Off_Phone1=ltrim(rtrim(isnull(Off_Phone1, ''))),
Off_Phone2=ltrim(rtrim(isnull(Off_Phone2, ''))),Email=ltrim(rtrim(isnull(Email, ''))),Branch_cd=ltrim(rtrim(isnull(Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(Credit_Limit)),Cl_type=ltrim(rtrim(isnull(Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(Cl_Status, ''))),
Gl_Code=ltrim(rtrim(Gl_Code)),Fd_Code=ltrim(rtrim(isnull(Fd_Code, ''))),Family=ltrim(rtrim(isnull(Family, ''))),
Penalty=ltrim(rtrim(Penalty)),Sub_Broker=ltrim(rtrim(isnull(Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(L_Address3, ''))),Mobile_Pager=ltrim(rtrim(isnull(Mobile_Pager, ''))),
pan_gir_no=ltrim(rtrim(isnull(pan_gir_no, ''))),trader=ltrim(rtrim(isnull(trader, ''))),WARD_NO=ltrim(rtrim(isnull(WARD_NO, ''))),
Region=ltrim(rtrim(isnull(Region, ''))),Area=ltrim(rtrim(isnull(Area, ''))),ClRating=ltrim(rtrim(isnull(ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,MCX_05_03_2013_01 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and m1.party_code is not null 
	
--and lasttradedate='2013-01-25 00:00:00.000'
	
select c2.* into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,MCX_05_03_2013_01 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and m1.party_code is not null 
--and lasttradedate='2013-01-25 00:00:00.000'
	
select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),MCX_05_03_2013_01 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c5.cl_code, '')))
	and m1.party_code is not null 
--and lasttradedate='2013-01-25 00:00:00.000'
	
	

insert into
	_temp_mcx_client_data_new_temp1

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	[client first name] = 	
		left (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[middle name] = 
		substring (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(c1.long_name, space(2), space(1))) else
				charindex (
					space(1), 
					replace(c1.long_name, space(2), space(1)), 
					case 
						when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(c1.long_name, space(2), space(1)), 1) 
			end
		),
	[last name] = 
		right (
			replace(c1.long_name, space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) <= 0 then len(replace(c1.long_name, space(2), space(1))) 
				else charindex (space(1), reverse (replace(c1.long_name, space(2), space(1))), 1) - 1 
			end
		),
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then 'N.A' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = 
		case when len(c1.l_city) = 0 then 'N.A' else c1.l_city end,
	[state] = 
		case when len(c1.l_state) = 0 then 'N.A' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = 
		case when len(c1.l_nation) = 0 then 'N.A' else c1.l_nation end,
	[pin code] = c1.l_zip,
	[telephone number] = 
		case when 
			isnumeric( 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			) = 1 
			then 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(c1.res_phone1) > 0 then c1.res_phone1
										when len(c1.res_phone2) > 0 then c1.res_phone2
										when len(c1.off_phone1) > 0 then c1.off_phone1
										when len(c1.off_phone2) > 0 then c1.off_phone2
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			else 
				'' 
			end,
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	[pan number] = ltrim(rtrim(isnull(c1.pan_gir_no, ''))),
	[ward number] = ltrim(rtrim(isnull(c1.ward_no, ''))),
	[uin] = ltrim(rtrim(space(1))),

	[bank name] =  ''
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		) */ ,
	[bank branch address] = ''
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		) */ ,
	[bank account number] = '',
		-- (select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = '',
		--(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = 'NSDL',
	[depository participant id (nsdl)] = '',
		--(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),
	[depository participant name (nsdl)] = '',
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		)*/
	[beneficiary account id (nsdl)] = '',
		-- (select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),

	[depository name (cdsl)] = 'CDSL',
	[depository participant id (cdsl)] = '',
		--(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),
	[depository participant name (cdsl)] = ''
		/* (
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		) */,
	[beneficiary account id (cdsl)] = '',
		--(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),

	[passport number] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.passportdtl, ''))) 
		end,
	[place of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.passportplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.passportplaceofissue, ''))) end
		end,
	[date of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportdateofissue, ''), 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportexpdate, ''), 103), '/', '')
		end,
	[driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.drivelicendtl, ''))) 
		end,
	[place of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.licencenoplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.licencenoplaceofissue, ''))) end
		end,
	[date of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.licencenodateofissue, ''), 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.driveexpdate, ''), 103), '/', '') 
		end,

	[voter id] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.votersiddtl, ''))) 
		end,
	[place of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.voteridplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.voteridplaceofissue, ''))) end
		end,
	[date of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.voteriddateofissue, ''), 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.rationcarddtl, ''))) 
		end,
	[place of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.rationcardplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.rationcardplaceofissue, ''))) end
		end,
	[date of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.rationcarddateofissue, ''), 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else ltrim(rtrim(isnull(c5.regr_no, '')))
		end,
	[registering authority] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
				end
			end,
	[place of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
				end
			end,
	[date of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else
					replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
				end
			end,

	[introducers name] = 
		ltrim(rtrim(isnull(c5.introducer, ''))),
	[introducers client id] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_client_id, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_client_id, ''))) end
		end,
	[relationship with the introducer] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_relation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_relation, ''))) end
		end,

	[dealing with other member] = 
		case 
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = '' then 'N'
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = ltrim(rtrim('E')), 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved=''


from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock),
	--MCX_14_02_2013 m1 with(nolock)
	MCX_05_03_2013_01 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, ''))) 
	and m1.party_code is not null 
--and lasttradedate='2013-01-25 00:00:00.000' 
 and
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'
	
	--select [bank name] from _temp_mcx_client_data_new_temp1 

	Select @@MaxTsrNo = Max(SrNo) from _temp_mcx_client_data_new_temp1
	Select @@TsrNo = 0
	Select @@bank_name = ''
	Select @@bankbranchaddress = ''
	Select @@bankaccountnumber = ''
	Select @@bankaccounttype = ''
	Select @@depositoryparticipantidnsdl = ''
	Select @@depositoryparticipantnamensdl  = ''
	Select @@beneficiaryaccountidnsdl = ''
	Select @@depositoryparticipantidcdsl = ''
	Select @@depositoryparticipantnamecdsl = ''
	Select @@beneficiaryaccountidcdsl = ''
	Select @@beneficiaryaccountidnsdl = ''
	--Select @@Party_code = 'A18630' 
	While @@TsrNo <= @@MaxTsrNo --and @@party_code = 'A18630' 
	Begin
	     Select @@Party_code = [client code] From  _temp_mcx_client_data_new_temp1
		 Where SrNo =  @@TsrNo
		 Select  @@Bank_name =  
				ltrim(rtrim(isnull(b.bank_name, ''))) ,
				@@bankbranchaddress = 
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, ''))),
				@@bankaccountnumber = isnull(c4.cltdpid, ''),
				@@bankaccounttype = isnull(c4.depository, '')
				
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
                angelcommodity.mcdx.dbo.client4 c4 with( nolock) --,
				
			where 
			    --ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				--ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				--ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
				isnull(c4.party_code, '') = @@Party_code and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')


            Select  @@depositoryparticipantidnsdl = isnull(c4.bankid, '')
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				--ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				--ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				--ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' 
				isnull(c4.party_code, '') = @@Party_code and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'NSDL' 
            
            Select @@depositoryparticipantnamensdl =  ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				--ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				--ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				--ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				--ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
				isnull(c4.party_code, '') = @@Party_code and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'


           Select  @@beneficiaryaccountidnsdl = ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) 
		   where 
		   --ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code  
		   --and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'
		   isnull(c4.party_code, '') = @@Party_code  
		   and isnull(c4.depository, '') = 'NSDL'

		   select @@depositoryparticipantidcdsl = ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) 
		   where --ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'
			isnull(c4.party_code, '') = @@Party_code and isnull(c4.depository, '') = 'CDSL'	

           Select  @@depositoryparticipantnamecdsl = ltrim(rtrim(isnull(b.bankname, ''))) 
		   from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
		   where 
				--ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and 
				--ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				--ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				--ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
          
		     	isnull(c4.party_code, '') = @@Party_code and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
          
		  Select  @@beneficiaryaccountidcdsl =  ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) 
		  where 
		  --ltrim(rtrim(isnull(c4.party_code, ''))) = @@Party_code and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'
		  isnull(c4.party_code, '') = @@Party_code and isnull(c4.depository, '') = 'CDSL'

                Update _temp_mcx_client_data_new_temp1 Set [bank name] = @@Bank_name  ,	[bank branch address]  = @@bankbranchaddress,[bank account number] = @@bankaccountnumber,
				[bank account type] = @@bankaccounttype , [depository participant id (nsdl)] = @@depositoryparticipantidnsdl,
				[depository participant name (nsdl)] = @@depositoryparticipantnamensdl , [beneficiary account id (nsdl)] = @@beneficiaryaccountidnsdl ,
				[depository participant id (cdsl)] = @@depositoryparticipantidcdsl ,
				[depository participant name (cdsl)] = @@depositoryparticipantnamecdsl,
				[beneficiary account id (cdsl)] = @@beneficiaryaccountidcdsl
                Where SrNo = @@TSrNo

	/* Update _temp_mcx_client_data_new_temp1 Set [bank name] = 
	 (
			select distinct top 1 
				Bank_name = ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
                angelcommodity.mcdx.dbo.client4 c4 with( nolock) --,
				--angelcommodity.mcdx.dbo.client2 c2 with( nolock) 
				
			where 
			    ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		) */
		Select @@Bank_name = ''
		Select @@bankbranchaddress = ''
		Select @@bankaccountnumber = ''
		Select @@bankaccounttype = ''
		Select @@depositoryparticipantidnsdl = ''
    	Select @@depositoryparticipantnamensdl  = ''
		Select @@beneficiaryaccountidnsdl = ''
		Select @@depositoryparticipantidcdsl  = ''
		Select @@depositoryparticipantnamecdsl = ''
		Select @@beneficiaryaccountidcdsl = ''
		Select @@TsrNo = @@TsrNo + 1
			
	End	
	

	

	/* Update _temp_mcx_client_data_new_temp1 Set	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		)
	
	

	Update _temp_mcx_client_data_new_temp1 Set [bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT'))
		
	Update _temp_mcx_client_data_new_temp1 Set [bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT'))
		

Update _temp_mcx_client_data_new_temp1 Set [depository participant id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL')
		
Update _temp_mcx_client_data_new_temp1 Set[depository participant name (nsdl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		)

Update _temp_mcx_client_data_new_temp1 Set [beneficiary account id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL')

Update _temp_mcx_client_data_new_temp1 Set [depository participant id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL')
		

Update _temp_mcx_client_data_new_temp1 Set [depository participant name (cdsl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		)

Update _temp_mcx_client_data_new_temp1 Set[beneficiary account id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL')

*/
	
	update
		_temp_mcx_client_data_new_temp1
	set
		_temp_mcx_client_data_new_temp1.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = _temp_mcx_client_data_new_temp1.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(_temp_mcx_client_data_new_temp1.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		_temp_mcx_client_data_new_temp1
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(_temp_mcx_client_data_new_temp1.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], '')))) > 0
		
		--select * from _temp_mcx_client_data_new_temp1
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	_temp_mcx_client_data_new_temp1
from
	[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
where
	--ltrim(rtrim(replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then 'N.A'
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=ltrim(rtrim(replace(isnull(reserved, ''), ',', ''))),
	[flag] = ltrim(rtrim(replace(isnull([flag], ''), ',', '')))

from

--	#_temp_mcx_client_data
	_temp_mcx_client_data_new_temp1

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ucc_mcx_client_data_for_given_clients_test3
-- --------------------------------------------------




create proc [dbo].[ucc_mcx_client_data_for_given_clients_test3] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec ucc_mcx_client_data_for_given_clients_test3 '', '', 'Y'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end

set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

truncate table _temp_mcx_client_data_new_temp1

insert into
	_temp_mcx_client_data_new_temp1

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	[client first name] = 	
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		),
	[middle name] = 
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		),
	[last name] = 
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		),
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(ltrim(rtrim(isnull(c1.l_address1, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c1.l_address1, ''))) end,
	[address 2] = ltrim(rtrim(isnull(c1.l_address2, ''))),
	[address 3] = ltrim(rtrim(isnull(c1.l_address3, ''))),
	[city] = 
		case when len(ltrim(rtrim(isnull(c1.l_city, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	[state] = 
		case when len(ltrim(rtrim(isnull(c1.l_state, '')))) = 0 then 'N.A' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when ltrim(rtrim(isnull(c1.l_state, '')))='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when ltrim(rtrim(isnull(c1.l_state, '')))='ASSAM' then 'ASSAM'
					when ltrim(rtrim(isnull(c1.l_state, '')))='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='BIHAR' then 'BIHAR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='CHANDIGARH' then 'CHANDIGARH'  
					when ltrim(rtrim(isnull(c1.l_state, '')))='CHHATISGARH' then 'CHHATTISGARH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='DELHI' then 'DELHI'
					when ltrim(rtrim(isnull(c1.l_state, '')))='DAMAN AND DIU' then 'DAMAN AND DIU'
					when ltrim(rtrim(isnull(c1.l_state, '')))='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when ltrim(rtrim(isnull(c1.l_state, '')))='GUJARAT' then 'GUJARAT'
					when ltrim(rtrim(isnull(c1.l_state, '')))='GOA' then 'GOA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='HARYANA' then 'HARYANA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='JHARKHAND' then 'JHARKHAND'
					when ltrim(rtrim(isnull(c1.l_state, '')))='KARNATAKA' then 'KARNATAKA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='KERALA' then 'KERALA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='LAKSHADWEEP' then 'LAKSHADWEEP'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MANIPUR' then 'MANIPUR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MIZORAM' then 'MIZORAM'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MEGHALAYA' then 'MEGHALAYA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MADHYA PRADESH' then 'MADHYA PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MAHARASHTRA' then 'MAHARASHTRA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='NAGALAND' then 'NAGALAND'
					when ltrim(rtrim(isnull(c1.l_state, '')))='ORISSA' then 'ORISSA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='PUNJAB' then 'PUNJAB'
					when ltrim(rtrim(isnull(c1.l_state, '')))='PONDICHERRY' then 'PUDUCHERRY'
					when ltrim(rtrim(isnull(c1.l_state, '')))='RAJASTHAN' then 'RAJASTHAN'
					when ltrim(rtrim(isnull(c1.l_state, '')))='SIKKIM' then 'SIKKIM'
					when ltrim(rtrim(isnull(c1.l_state, '')))='TRIPURA' then 'TRIPURA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='TAMILNADU' then 'TAMIL NADU'
					when ltrim(rtrim(isnull(c1.l_state, '')))='UTTARANCHAL' then 'UTTARAKHAND'
					when ltrim(rtrim(isnull(c1.l_state, '')))='UTTAR PRADESH' then 'UTTAR PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='WEST BENGAL' then 'WEST BENGAL'
					else ltrim(rtrim(isnull(c1.l_state, ''))) end
		end,
	[country] = 
		case when len(ltrim(rtrim(isnull(c1.l_nation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c1.l_nation, ''))) end,
	[pin code] = ltrim(rtrim(isnull(c1.l_zip, ''))),
	[telephone number] = 
		case when 
			isnumeric( 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(ltrim(rtrim(isnull(c1.res_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.res_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone2, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone2, '')))
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			) = 1 
			then 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(ltrim(rtrim(isnull(c1.res_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.res_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone2, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone2, '')))
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			else 
				'' 
			end,
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	[pan number] = ltrim(rtrim(isnull(c1.pan_gir_no, ''))),
	[ward number] = ltrim(rtrim(isnull(c1.ward_no, ''))),
	[uin] = ltrim(rtrim(space(1))),

	[bank name] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = 'NSDL',
	[depository participant id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),
	[depository participant name (nsdl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		),
	[beneficiary account id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),

	[depository name (cdsl)] = 'CDSL',
	[depository participant id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),
	[depository participant name (cdsl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		),
	[beneficiary account id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),

	[passport number] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.passportdtl, ''))) 
		end,
	[place of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.passportplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.passportplaceofissue, ''))) end
		end,
	[date of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportdateofissue, ''), 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportexpdate, ''), 103), '/', '')
		end,
	[driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.drivelicendtl, ''))) 
		end,
	[place of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.licencenoplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.licencenoplaceofissue, ''))) end
		end,
	[date of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.licencenodateofissue, ''), 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.driveexpdate, ''), 103), '/', '') 
		end,

	[voter id] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.votersiddtl, ''))) 
		end,
	[place of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.voteridplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.voteridplaceofissue, ''))) end
		end,
	[date of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.voteriddateofissue, ''), 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.rationcarddtl, ''))) 
		end,
	[place of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.rationcardplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.rationcardplaceofissue, ''))) end
		end,
	[date of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.rationcarddateofissue, ''), 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else ltrim(rtrim(isnull(c5.regr_no, '')))
		end,
	[registering authority] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
				end
			end,
	[place of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
				end
			end,
	[date of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else
					replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
				end
			end,

	[introducers name] = 
		ltrim(rtrim(isnull(c5.introducer, ''))),
	[introducers client id] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_client_id, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_client_id, ''))) end
		end,
	[relationship with the introducer] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_relation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_relation, ''))) end
		end,

	[dealing with other member] = 
		case 
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = '' then 'N'
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = ltrim(rtrim('E')), 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved=ltrim(rtrim(space(1)))


from
	angelcommodity.mcdx.dbo.client1 c1 with(nolock),
	angelcommodity.mcdx.dbo.client2 c2 with(nolock),
	angelcommodity.mcdx.dbo.client5 c5 with(nolock),
	mcx_01_03_2013_02_vol1 m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, ''))) 
	and m1.party_code is not null 
	and lasttradedate='2013-01-24 00:00:00.000'  and
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'
	
	 
	
	update
		_temp_mcx_client_data_new_temp1
	set
		_temp_mcx_client_data_new_temp1.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = _temp_mcx_client_data_new_temp1.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(_temp_mcx_client_data_new_temp1.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		_temp_mcx_client_data_new_temp1
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(_temp_mcx_client_data_new_temp1.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp1.[client code], '')))) > 0
		
		--select * from _temp_mcx_client_data_new_temp1
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	_temp_mcx_client_data_new_temp1
from
	ucc.dbo.tbl_ucc_banned_pan bp
where
	ltrim(rtrim(replace(isnull(_temp_mcx_client_data_new_temp1.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then 'N.A'
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=ltrim(rtrim(replace(isnull(reserved, ''), ',', ''))),
	[flag] = ltrim(rtrim(replace(isnull([flag], ''), ',', '')))

from

--	#_temp_mcx_client_data
	_temp_mcx_client_data_new_temp1

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ucc_mcx_client_data_test_bak_apr_10_2012
-- --------------------------------------------------




CREATE proc [dbo].[ucc_mcx_client_data_test_bak_apr_10_2012] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec ucc_mcx_client_data_test_bak_apr_10_2012 'apr 10 2012', 'apr 10 2012', 'N'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end

set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

truncate table _temp_mcx_client_data_new_temp

insert into
	_temp_mcx_client_data_new_temp

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	[client first name] = 	
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		),
	[middle name] = 
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		),
	[last name] = 
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		),
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(ltrim(rtrim(isnull(c1.l_address1, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c1.l_address1, ''))) end,
	[address 2] = ltrim(rtrim(isnull(c1.l_address2, ''))),
	[address 3] = ltrim(rtrim(isnull(c1.l_address3, ''))),
	[city] = 
		case when len(ltrim(rtrim(isnull(c1.l_city, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	[state] = 
		case when len(ltrim(rtrim(isnull(c1.l_state, '')))) = 0 then 'N.A' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when ltrim(rtrim(isnull(c1.l_state, '')))='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when ltrim(rtrim(isnull(c1.l_state, '')))='ASSAM' then 'ASSAM'
					when ltrim(rtrim(isnull(c1.l_state, '')))='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='BIHAR' then 'BIHAR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='CHANDIGARH' then 'CHANDIGARH'  
					when ltrim(rtrim(isnull(c1.l_state, '')))='CHHATISGARH' then 'CHHATTISGARH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='DELHI' then 'DELHI'
					when ltrim(rtrim(isnull(c1.l_state, '')))='DAMAN AND DIU' then 'DAMAN AND DIU'
					when ltrim(rtrim(isnull(c1.l_state, '')))='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when ltrim(rtrim(isnull(c1.l_state, '')))='GUJARAT' then 'GUJARAT'
					when ltrim(rtrim(isnull(c1.l_state, '')))='GOA' then 'GOA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='HARYANA' then 'HARYANA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='JHARKHAND' then 'JHARKHAND'
					when ltrim(rtrim(isnull(c1.l_state, '')))='KARNATAKA' then 'KARNATAKA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='KERALA' then 'KERALA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='LAKSHADWEEP' then 'LAKSHADWEEP'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MANIPUR' then 'MANIPUR'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MIZORAM' then 'MIZORAM'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MEGHALAYA' then 'MEGHALAYA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MADHYA PRADESH' then 'MADHYA PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='MAHARASHTRA' then 'MAHARASHTRA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='NAGALAND' then 'NAGALAND'
					when ltrim(rtrim(isnull(c1.l_state, '')))='ORISSA' then 'ORISSA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='PUNJAB' then 'PUNJAB'
					when ltrim(rtrim(isnull(c1.l_state, '')))='PONDICHERRY' then 'PUDUCHERRY'
					when ltrim(rtrim(isnull(c1.l_state, '')))='RAJASTHAN' then 'RAJASTHAN'
					when ltrim(rtrim(isnull(c1.l_state, '')))='SIKKIM' then 'SIKKIM'
					when ltrim(rtrim(isnull(c1.l_state, '')))='TRIPURA' then 'TRIPURA'
					when ltrim(rtrim(isnull(c1.l_state, '')))='TAMILNADU' then 'TAMIL NADU'
					when ltrim(rtrim(isnull(c1.l_state, '')))='UTTARANCHAL' then 'UTTARAKHAND'
					when ltrim(rtrim(isnull(c1.l_state, '')))='UTTAR PRADESH' then 'UTTAR PRADESH'
					when ltrim(rtrim(isnull(c1.l_state, '')))='WEST BENGAL' then 'WEST BENGAL'
					else ltrim(rtrim(isnull(c1.l_state, ''))) end
		end,
	[country] = 
		case when len(ltrim(rtrim(isnull(c1.l_nation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c1.l_nation, ''))) end,
	[pin code] = ltrim(rtrim(isnull(c1.l_zip, ''))),
	[telephone number] = 
		case when 
			isnumeric( 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(ltrim(rtrim(isnull(c1.res_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.res_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone2, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone2, '')))
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			) = 1 
			then 
				replace( 
					replace( 
						replace( 
							replace( 
								replace( 
									case 
										when len(ltrim(rtrim(isnull(c1.res_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.res_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.res_phone2, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone1, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone1, '')))
										when len(ltrim(rtrim(isnull(c1.off_phone2, '')))) > 0 then ltrim(rtrim(isnull(c1.off_phone2, '')))
									else 
										'' 
									end, 
									space(1), 
									'' 
								), 
								'-', 
								'' 
							), 
							'/', 
							'' 
						), 
						'(', 
						'' 
					), 
					'(', 
					'' 
				) 
			else 
				'' 
			end,
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	[pan number] = ltrim(rtrim(isnull(c1.pan_gir_no, ''))),
	[ward number] = ltrim(rtrim(isnull(c1.ward_no, ''))),
	[uin] = ltrim(rtrim(space(1))),

	[bank name] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = 'NSDL',
	[depository participant id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),
	[depository participant name (nsdl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'NSDL'
		),
	[beneficiary account id (nsdl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'NSDL'),

	[depository name (cdsl)] = 'CDSL',
	[depository participant id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.bankid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),
	[depository participant name (cdsl)] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bankname, ''))) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and 
				ltrim(rtrim(isnull(c4.bankid, ''))) = ltrim(rtrim(isnull(b.bankid, ''))) and 
				ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL' and
				ltrim(rtrim(isnull(b.banktype, ''))) = 'CDSL'
		),
	[beneficiary account id (cdsl)] = 
		(select distinct ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where ltrim(rtrim(isnull(c4.party_code, ''))) = ltrim(rtrim(isnull(c2.party_code, ''))) and ltrim(rtrim(isnull(c4.depository, ''))) = 'CDSL'),

	[passport number] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.passportdtl, ''))) 
		end,
	[place of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.passportplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.passportplaceofissue, ''))) end
		end,
	[date of issue of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportdateofissue, ''), 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when ltrim(rtrim(isnull(c5.passportdtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.passportexpdate, ''), 103), '/', '')
		end,
	[driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.drivelicendtl, ''))) 
		end,
	[place of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.licencenoplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.licencenoplaceofissue, ''))) end
		end,
	[date of issue of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.licencenodateofissue, ''), 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when ltrim(rtrim(isnull(c5.drivelicendtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.driveexpdate, ''), 103), '/', '') 
		end,

	[voter id] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.votersiddtl, ''))) 
		end,
	[place of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.voteridplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.voteridplaceofissue, ''))) end
		end,
	[date of issue of voter id number] = 
		case 
			when ltrim(rtrim(isnull(c5.votersiddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.voteriddateofissue, ''), 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then '' 
			else ltrim(rtrim(isnull(c5.rationcarddtl, ''))) 
		end,
	[place of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.rationcardplaceofissue, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.rationcardplaceofissue, ''))) end
		end,
	[date of issue of ration card number] = 
		case 
			when ltrim(rtrim(isnull(c5.rationcarddtl, ''))) = '' then ''
			else
			replace(convert(varchar, isnull(c5.rationcarddateofissue, ''), 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else ltrim(rtrim(isnull(c5.regr_no, '')))
		end,
	[registering authority] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
				end
			end,
	[place of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
				end
			end,
	[date of registration] = 
		case 
			when ltrim(rtrim(isnull(cl_status, ''))) = 'IND' then ''
			else
				case 
					when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
					else
					replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
				end
			end,

	[introducers name] = 
		ltrim(rtrim(isnull(c5.introducer, ''))),
	[introducers client id] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_client_id, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_client_id, ''))) end
		end,
	[relationship with the introducer] = 
		case 
			when ltrim(rtrim(isnull(c5.introducer, ''))) = '' then ''
			else case when len(ltrim(rtrim(isnull(c5.introd_relation, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.introd_relation, ''))) end
		end,

	[dealing with other member] = 
		case 
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = '' then 'N'
			when ltrim(rtrim(isnull(c5.dealing_with_othrer_tm, ''))) = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = 
		
			1,		/*ACTIVE*/
		
	[flag] = ltrim(rtrim('E')), 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved=ltrim(rtrim(space(1)))


from
	angelcommodity.mcdx.dbo.client1 c1 with(nolock),
	angelcommodity.mcdx.dbo.client2 c2 with(nolock),
	angelcommodity.mcdx.dbo.client5 c5 with(nolock)
where

	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	--and c5.inactivefrom >= @from_date + ' 00:00:00'
	--and c5.activefrom >= @from_date + ' 00:00:00'
	--and c5.activefrom <= @to_date + ' 23:59:00'
	and c5.inactivefrom > GETDATE()
		and	c5.activefrom <= getdate()
	 
	
	update
		_temp_mcx_client_data_new_temp
	set
		_temp_mcx_client_data_new_temp.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = _temp_mcx_client_data_new_temp.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(_temp_mcx_client_data_new_temp.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		_temp_mcx_client_data_new_temp
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(_temp_mcx_client_data_new_temp.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(_temp_mcx_client_data_new_temp.[client code], '')))) > 0
		
		--select * from _temp_mcx_client_data_new_temp
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	_temp_mcx_client_data_new_temp
from
	[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
where
	--ltrim(rtrim(replace(isnull(_temp_mcx_client_data_new_temp.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(_temp_mcx_client_data_new_temp.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then 'N.A'
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then 'N.A'
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=ltrim(rtrim(replace(isnull(reserved, ''), ',', ''))),
	[flag] = ltrim(rtrim(replace(isnull([flag], ''), ',', '')))

from

--	#_temp_mcx_client_data
	_temp_mcx_client_data_new_temp

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upd_BO_OBJECT_Details
-- --------------------------------------------------
CREATE Procedure Upd_BO_OBJECT_Details          
as          
          
SET NOCOUNT ON          
          
declare @nor as int,@dbname as varchar(50),@ctr as int,@str as varchar(2000)          
SELECT @nor=count(distinct replace(OBJDBName,'.DBO.','')) FROM inhouse.dbo.BO_Object           
where ObjDBname ='FAS.DBO.'     
and objcomdtype like 'mis.%'        
--print @nor
          
truncate table BO_OBJECT_Details          
          
create table #file1          
(          
srno int identity(1,1),          
dbname varchar(50)          
)          
        
insert into #file1 SELECT distinct replace(OBJDBName,'.DBO.','') FROM inhouse.dbo.BO_Object           
where ObjDBname ='FAS.DBO.'        
and objcomdtype like 'mis.%'     
          
set @dbname=''          
set @ctr=1          
set @str=''          
          
while @ctr <= @NOR          
BEGIN          
 select @dbname=dbname from #file1 where srno=@ctr          
 set @str=' insert into BO_OBJECT_Details '          
 set @str=@str + ' select Objname,ObjType,ObjComdType,DBname,content,CntOccuranceChars,sum(CntOccuranceChars) as TotCnt from '          
 set @str=@str + ' ( select c.*,name, '          
 set @str=@str + ' substring(text,charindex(c.objComdType,text,0),charindex('' '',text,charindex(c.objComdType,text,0))-charindex(c.objComdType,text,0)) '          
 set @str=@str + ' as Content, '           
 set @str=@str + ' (LEN(text) - LEN(REPLACE(text, c.objComdType,'''')))/LEN(c.objComdType) as CntOccuranceChars '          
 set @str=@str + ' from '+@dbname+'.dbo.sysObjects a, (select id,text collate SQL_Latin1_General_CP1_CI_AS as text from '+@dbname+'.dbo.sysComments) b, '          
 set @str=@str + ' (SELECT distinct *,DBname=replace(OBJDBName,''.DBO.'','''') FROM inhouse.dbo.BO_Object where objDBNAme='''+@dbname+'.DBO.'' and objcomdtype like ''mis.%'') c'          
 set @str=@str + ' where a.id=b.id and  a.name collate SQL_Latin1_General_CP1_CI_AS=c.objname collate SQL_Latin1_General_CP1_CI_AS '          
 set @str=@str + ' and (LEN(text) - LEN(REPLACE(text, c.objComdType, '''')))/LEN(c.objComdType) <> 0 '          
 set @str=@str + ' and charindex('' '',text,charindex(c.objComdType,text,0)) > 0 '          
 set @str=@str + ' ) x group by Objname,ObjType,ObjComdType,DBname,content,CntOccuranceChars'          
 print @str          
 exec(@str)          
  print @ctr          
 set @ctr=@ctr+1          
END          
          
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_angel_STREG_MCDX
-- --------------------------------------------------
--sp_helptext usp_angel_STREG         
          
--sp_helptext usp_angel_STREG2              
              
--exec usp_angel_STREG2 '2009-03-01','2009-03-28'            
--exec usp_angel_STREG '2008-09-01','2008-09-30'               
CREATE proc [dbo].[usp_angel_STREG_MCDX]                              
( @fvdt as datetime,@tvdt as datetime)                               
                              
as                              
set nocount on                            
                  
                  
--declare @fvdt as datetime,@tvdt as datetime                  
--set @fvdt = '2008-09-01'                  
--set @tvdt = '2008-09-01'         
--left(convert(varchar,vdt,121),11)  --convert(varchar(11),convert(datetime,vdt),103)             
                         
select * into #t from  accountmcdx.dbo.ledger where  cltcode='400002' and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                              
                  
                      
select drcr= case                       
when drcr = 'D' then 'C'                       
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                      
                      
select left(vdt,11) as [Date],VNO,cltcode,acname, segment='MCDX',vamt,space(10) as [Expense Code],space(100) as [Expense Code Name],space(20) as [Expense Amount], space(20) as [400002],space(20) as [410002],space(20) as [420002],space(20) as [Total],space
  
(20) as [Rate],space(30) as [PAN No.],space(50) as [Service Tax No.],space(500) as [Address],narration as [Narration],DRCR,vtyp  into #file1 from                      
(                      
select * from #t                    
union                     
select x.* from                      
(                      
select l.*              
from  accountmcdx.dbo.ledger l , #t t               
where l.vtyp = t.vtyp and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' or l.cltcode not like '5%')                       
) x      
inner join                      
(select * from #l1)y                      
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                      
) x where cltcode not like '26%'                      
                              
  update #file1 set vamt = 0 where vamt = ''                
update #file1 set [Expense Amount] = 0 where [Expense Amount] = ''                  
  update #file1 set [400002] = 0 where [400002] = ''                
update #file1 set [410002] = 0 where [410002] = ''               
update #file1 set [420002] = 0 where [420002] = ''         
        
--select * from #file1                  
                              
update #file1 set [Expense Code]=b.cltcode,[Expense Amount]=b.vamt from                              
(select cltcode,vno,vamt,vtyp from  accountmcdx.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a        
 where a.vno=b.vno  and a.vtyp=b.vtyp           
        
update #file1 set [Expense Code Name]=b.acname from                              
(select cltcode,vno,vamt,acname from  accountmcdx.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a        
 where a.vno=b.vno           
                      
----------------    cltcode like '5%' and                          
update #file1 set [Service Tax No.]=v.st_no, [PAN No.]= v.pan_no, [Address]=v.add1+' '+v.add2+' '+v.add3+' '+v.city+' '+v.pin+' '+v.state  from                              
(select cltcode,vno from  accountmcdx.dbo.ledger  where  vno in ( select vno from #t))b, #file1 a, [172.19.2.98].account123.dbo.vendormaster v        
 where a.vno=b.vno and v.segment= 'MCX' and convert(varchar,v.cltcode)=b.cltcode        
-----------------        
                              
update #file1 set [400002]=b.vamt from                              
(select cltcode,vno,vamt from  accountmcdx.dbo.ledger  where cltcode ='400002' and vno in ( select vno from #t))b,#file1 a       where a.vno=b.vno                                
                              
                              
update #file1 set [410002]=b.vamt from                              
(select cltcode,vno,vamt from  accountmcdx.dbo.ledger  where cltcode ='410002' and vno in ( select vno from #t))b,#file1 a                      
 where a.vno=b.vno                                
                              
                              
update #file1 set [420002]=b.vamt from                              
(select cltcode,vno,vamt from  accountmcdx.dbo.ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                
          
update #File1 set [Total] = convert(money,[400002])+convert(money,[410002])+convert(money,[420002])                              
            
update #File1 set [Rate] = case when convert(money,[Expense Amount]) <> 0 then convert(money,[Total])/convert(money,[Expense Amount])*100             
else 0 end --from                    
--(select cltcode,vno,vamt from  accountmcdx.dbo.ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno              
              
select * from #file1 where cltcode <> '400002'                  
                  
                  
                  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_angel_STREG_NCDX
-- --------------------------------------------------


--sp_helptext usp_angel_STREG         
          
--sp_helptext usp_angel_STREG2              
              
--exec usp_angel_STREG2 '2009-03-01','2009-03-28'            
--exec usp_angel_STREG '2008-09-01','2008-09-30'               
CREATE proc [dbo].[usp_angel_STREG_NCDX]                              
( @fvdt as datetime,@tvdt as datetime)                               
                              
as                              
set nocount on                            
                  
                  
--declare @fvdt as datetime,@tvdt as datetime                  
--set @fvdt = '2008-09-01'                  
--set @tvdt = '2008-09-01'         
--left(convert(varchar,vdt,121),11)  --convert(varchar(11),convert(datetime,vdt),103)             
                         
select * into #t from accountncdx.dbo.ledger  where  cltcode='400002' and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                              
                  
                      
select drcr= case                       
when drcr = 'D' then 'C'                       
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                      
                      
select left(vdt,11) as [Date],VNO,cltcode,acname, segment='NCDX',vamt,space(10) as [Expense Code],space(100) as [Expense Code Name],space(20) as [Expense Amount], space(20) as [400002],space(20) as [410002],space(20) as [420002],space(20) as [Total],space
  
(20) as [Rate],space(30) as [PAN No.],space(50) as [Service Tax No.],space(500) as [Address],narration as [Narration],DRCR,vtyp  into #file1 from                      
(                      
select * from #t                    
union                     
select x.* from                      
(                      
select l.*              
from accountncdx.dbo.ledger l , #t t               
where l.vtyp = t.vtyp and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' or l.cltcode not like '5%')                       
) x      
inner join                      
(select * from #l1)y                      
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                      
) x where cltcode not like '26%'                      
                              
  update #file1 set vamt = 0 where vamt = ''                
update #file1 set [Expense Amount] = 0 where [Expense Amount] = ''                  
  update #file1 set [400002] = 0 where [400002] = ''                
update #file1 set [410002] = 0 where [410002] = ''               
update #file1 set [420002] = 0 where [420002] = ''         
        
--select * from #file1                  
                              
update #file1 set [Expense Code]=b.cltcode,[Expense Amount]=b.vamt from                              
(select cltcode,vno,vamt,vtyp from accountncdx.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a        
 where a.vno=b.vno  and a.vtyp=b.vtyp           
        
update #file1 set [Expense Code Name]=b.acname from                              
(select cltcode,vno,vamt,acname from accountncdx.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a        
 where a.vno=b.vno           
                      
----------------    cltcode like '5%' and                          
update #file1 set [Service Tax No.]=v.st_no, [PAN No.]= v.pan_no, [Address]=v.add1+' '+v.add2+' '+v.add3+' '+v.city+' '+v.pin+' '+v.state  from                              
(select cltcode,vno from accountncdx.dbo.ledger  where  vno in ( select vno from #t))b, #file1 a, [172.19.2.98].account123.dbo.vendormaster v        
 where a.vno=b.vno and v.segment= 'NCDEX' and convert(varchar,v.cltcode)=b.cltcode        
-----------------        
                              
update #file1 set [400002]=b.vamt from                              
(select cltcode,vno,vamt from accountncdx.dbo.ledger  where cltcode ='400002' and vno in ( select vno from #t))b,#file1 a       where a.vno=b.vno                                
                              
                              
update #file1 set [410002]=b.vamt from                              
(select cltcode,vno,vamt from accountncdx.dbo.ledger  where cltcode ='410002' and vno in ( select vno from #t))b,#file1 a                        
 where a.vno=b.vno                                
                              
                              
update #file1 set [420002]=b.vamt from                              
(select cltcode,vno,vamt from accountncdx.dbo.ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                
          
update #File1 set [Total] = convert(money,[400002])+convert(money,[410002])+convert(money,[420002])                              
            
update #File1 set [Rate] = case when convert(money,[Expense Amount]) <> 0 then convert(money,[Total])/convert(money,[Expense Amount])*100             
else 0 end --from                    
--(select cltcode,vno,vamt from accountncdx.dbo.ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno              
              
select * from #file1 where cltcode <> '400002'                  
                  
                  
                  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_angel_STREG1
-- --------------------------------------------------
--sp_helptext usp_angel_STREG2                      
                      
--exec usp_angel_STREG2 '2009-03-01','2009-03-28'                    
--exec usp_angel_STREG1 '2008-09-01','2008-09-30' ,'400002'                      
CREATE proc [dbo].[usp_angel_STREG1]                                        
( @fvdt as datetime,@tvdt as datetime, @code as varchar(10))                                         
                                        
as                                        
            
set nocount on                                      
            
declare  @code1 as varchar(10), @code2 as varchar(10)            
set @code1 = '4100' + right(@code, 2)            
set @code2= '4200' + right(@code, 2)              
--declare @fvdt as datetime,@tvdt as datetime                          
--set @fvdt = '2008-09-01'                          
--set @tvdt = '2008-09-01'                 
--left(convert(varchar,vdt,121),11)  --convert(varchar(11),convert(datetime,vdt),103)                     
                                 
select * into #t from ledger nolock where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                                      
                          
                              
select drcr= case                               
when drcr = 'D' then 'C'                               
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                              
                              
select convert(varchar(11),vdt,103) as [Date],VNO,cltcode,acname, segment='MCDX',vamt,space(10) as [Expense Code],space(100) as [Expense Code Name],space(20) as [Expense Amount], space(20) as [ST],space(20) as [EC],space(20) as [SHEC],space(20) as [Total]
  
    
      
,space(20) as [Rate],space(30) as [PAN No.],space(50) as [Service Tax No.],space(500) as [Address],narration as [Narration],DRCR,vtyp  into #file1 from                              
(                              
select * from #t                            
union                             
select x.* from                              
(                              
select l.*                      
from ledger l (nolock), #t t                       
where l.vtyp = t.vtyp and l.vtyp <> '18' and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' or l.cltcode not like '5%')                 
  
    
      
              
) x              
inner join                              
(select * from #l1)y                              
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                              
) x where cltcode not like '26%'                              
                                      
  update #file1 set vamt = 0 where vamt = ''                        
update #file1 set [Expense Amount] = 0 where [Expense Amount] = ''                          
    update #file1 set [ST] = 0 where [ST] = ''                          
update #file1 set [EC] = 0 where [EC] = ''                         
update #file1 set [SHEC] = 0 where [SHEC] = ''               
                
--select * from #file1                          
                                      
update #file1 set [Expense Code]=b.cltcode,[Expense Amount]=b.vamt from                                      
(select cltcode,vno,vamt,vtyp from ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a                
 where a.vno=b.vno  and a.vtyp=b.vtyp                   
                
update #file1 set [Expense Code Name]=b.acname from                                      
(select cltcode,vno,vamt,acname from ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a                
 where a.vno=b.vno                   
                              
----------------    cltcode like '5%' and                                  
update #file1 set [Service Tax No.]=v.st_no, [PAN No.]= v.pan_no, [Address]=v.add1+' '+v.add2+' '+v.add3+' '+v.city+' '+v.pin+' '+v.state  from                          
(select cltcode,vno from ledger  where  vno in ( select vno from #t))b, #file1 a, Intranet.angelvms.dbo.vendormaster v                
 where a.vno=b.vno and v.segment= 'MCX' and convert(varchar,v.cltcode)=b.cltcode                
-----------------                
                                        
update #file1 set [ST]=b.vamt from                                        
(select cltcode,vno,vamt from ledger  where cltcode =@code and vno in ( select vno from #t))b,#file1 a   where a.vno=b.vno                                          
                                        
                                        
update #file1 set [EC]=b.vamt from                                     
(select cltcode,vno,vamt from ledger  where cltcode =@code1 and vno in ( select vno from #t))b,#file1 a                                  
 where a.vno=b.vno                                          
                                        
                                        
update #file1 set [SHEC]=b.vamt from                                        
(select cltcode,vno,vamt from ledger  where cltcode =@code2 and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                          
                    
update #File1 set [Total] = convert(money,[ST])+convert(money,[EC])+convert(money,[SHEC])                                                  
                    
update #File1 set [Rate] = case when convert(money,[Expense Amount]) <> 0 then convert(money,[Total])/convert(money,[Expense Amount])*100                     
else 0 end --from                            
--(select cltcode,vno,vamt from ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                      
                      
select * from #file1 where cltcode <> @code                          
                          
                          
                          
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_angel_STREG1_MCDX
-- --------------------------------------------------
--sp_helptext usp_angel_STREG2                        
                        
--exec usp_angel_STREG2 '2009-03-01','2009-03-28'                      
--exec usp_angel_STREG1 '2008-09-01','2008-09-30' ,'400002'                        
CREATE proc [dbo].[usp_angel_STREG1_MCDX]                                          
( @fvdt as datetime,@tvdt as datetime, @code as varchar(10))                                           
                                          
as                                          
              
set nocount on                                        
              
declare  @code1 as varchar(10), @code2 as varchar(10)              
set @code1 = '4100' + right(@code, 2)              
set @code2= '4200' + right(@code, 2)                
--declare @fvdt as datetime,@tvdt as datetime                            
--set @fvdt = '2008-09-01'                            
--set @tvdt = '2008-09-01'                   
--left(convert(varchar,vdt,121),11)  --convert(varchar(11),convert(datetime,vdt),103)                       
                                   
select * into #t from  accountMCDX.dbo.ledger  where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                                        
                            
                                
select drcr= case                                 
when drcr = 'D' then 'C'                                 
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                                
                                
select convert(varchar(11),vdt,103) as [Date],VNO,cltcode,acname, segment='MCDX',vamt,space(10) as [Expense Code],space(100) as [Expense Code Name],space(20) as [Expense Amount], space(20) as [ST],space(20) as [EC],space(20) as [SHEC],space(20) as [Total]
  
    
      
        
,space(20) as [Rate],space(30) as [PAN No.],space(50) as [Service Tax No.],space(500) as [Address],narration as [Narration],DRCR,vtyp  into #file1 from                                
(                                
select * from #t                              
union                               
select x.* from                                
(                                
select l.*                        
from  accountMCDX.dbo.ledger l , #t t                         
where l.vtyp = t.vtyp and l.vtyp <> '18' and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' or l.cltcode not like '5%')                 
  
    
      
        
                
) x                
inner join                                
(select * from #l1)y                                
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                                
) x where cltcode not like '26%'                                
                                        
  update #file1 set vamt = 0 where vamt = ''                          
update #file1 set [Expense Amount] = 0 where [Expense Amount] = ''                            
    update #file1 set [ST] = 0 where [ST] = ''                            
update #file1 set [EC] = 0 where [EC] = ''                           
update #file1 set [SHEC] = 0 where [SHEC] = ''                 
                  
--select * from #file1                            
                                        
update #file1 set [Expense Code]=b.cltcode,[Expense Amount]=b.vamt from                                        
(select cltcode,vno,vamt,vtyp from  accountMCDX.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a                  
 where a.vno=b.vno  and a.vtyp=b.vtyp                     
                  
update #file1 set [Expense Code Name]=b.acname from                                        
(select cltcode,vno,vamt,acname from  accountMCDX.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a                  
 where a.vno=b.vno                     
                           
----------------    cltcode like '5%' and                                    
update #file1 set [Service Tax No.]=v.st_no, [PAN No.]= v.pan_no, [Address]=v.add1+' '+v.add2+' '+v.add3+' '+v.city+' '+v.pin+' '+v.state  from                            
(select cltcode,vno from  accountMCDX.dbo.ledger  where  vno in ( select vno from #t))b, #file1 a, Intranet.angelvms.dbo.vendormaster v                  
 where a.vno=b.vno and v.segment= 'MCX' and convert(varchar,v.cltcode)=b.cltcode                  
-----------------                  
                                          
update #file1 set [ST]=b.vamt from                                          
(select cltcode,vno,vamt from  accountMCDX.dbo.ledger  where cltcode =@code and vno in ( select vno from #t))b,#file1 a   where a.vno=b.vno                                            
                                          
                                          
update #file1 set [EC]=b.vamt from                                       
(select cltcode,vno,vamt from  accountMCDX.dbo.ledger  where cltcode =@code1 and vno in ( select vno from #t))b,#file1 a                                    
 where a.vno=b.vno                                            
                                          
                                          
update #file1 set [SHEC]=b.vamt from                                          
(select cltcode,vno,vamt from  accountMCDX.dbo.ledger  where cltcode =@code2 and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                            
                      
update #File1 set [Total] = convert(money,[ST])+convert(money,[EC])+convert(money,[SHEC])                                                    
                      
update #File1 set [Rate] = case when convert(money,[Expense Amount]) <> 0 then convert(money,[Total])/convert(money,[Expense Amount])*100                       
else 0 end --from                              
--(select cltcode,vno,vamt from  accountMCDX.dbo.ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                        
                        
select * from #file1 where cltcode <> @code                            
                            
                            
                            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_angel_STREG1_NCDX
-- --------------------------------------------------

--sp_helptext usp_angel_STREG2                          
                          
--exec usp_angel_STREG2 '2009-03-01','2009-03-28'                        
--exec usp_angel_STREG1 '2008-09-01','2008-09-30' ,'400002'                          
CREATE proc [dbo].[usp_angel_STREG1_NCDX]                                            
( @fvdt as datetime,@tvdt as datetime, @code as varchar(10))                                             
                                            
as                                            
                
set nocount on                                          
                
declare  @code1 as varchar(10), @code2 as varchar(10)                
set @code1 = '4100' + right(@code, 2)                
set @code2= '4200' + right(@code, 2)                  
--declare @fvdt as datetime,@tvdt as datetime                              
--set @fvdt = '2008-09-01'                              
--set @tvdt = '2008-09-01'                     
--left(convert(varchar,vdt,121),11)  --convert(varchar(11),convert(datetime,vdt),103)                         
                                     
select * into #t from  accountNCDX.dbo.ledger  where  cltcode=@code and left(convert(varchar,vdt,121),11)>=@fvdt and left(convert(varchar,vdt,121),11)<=@tvdt                                          
                              
                                  
select drcr= case                                   
when drcr = 'D' then 'C'                                   
when drcr = 'C' then 'D' end, vno,left(convert(varchar,vdt,121),11) vdt,vtyp into #l1 from #t                                  
                                  
select convert(varchar(11),vdt,103) as [Date],VNO,cltcode,acname, segment='NCDX',vamt,space(10) as [Expense Code],space(100) as [Expense Code Name],space(20) as [Expense Amount], space(20) as [ST],space(20) as [EC],space(20) as [SHEC],space(20) as [Total]
  
    
      
        
          
,space(20) as [Rate],space(30) as [PAN No.],space(50) as [Service Tax No.],space(500) as [Address],narration as [Narration],DRCR,vtyp  into #file1 from                                  
(                                  
select * from #t                                
union                                 
select x.* from                                  
(                                  
select l.*                          
from  accountNCDX.dbo.ledger l , #t t                           
where l.vtyp = t.vtyp and l.vtyp <> '18' and l.vno = t.vno and left(convert(varchar,l.vdt,121),11)>=@fvdt and left(convert(varchar,l.vdt,121),11)<=@tvdt and isnumeric(l.cltcode) = 1 and (l.cltcode not like '4%' or l.cltcode not like '5%')                 
  
    
      
        
          
                  
) x                  
inner join                                  
(select * from #l1)y                                  
on left(convert(varchar,x.vdt,121),11) = y.vdt and x.drcr = y.drcr and x.vno = y.vno                                  
) x where cltcode not like '26%'                                  
                                          
  update #file1 set vamt = 0 where vamt = ''                            
update #file1 set [Expense Amount] = 0 where [Expense Amount] = ''                              
    update #file1 set [ST] = 0 where [ST] = ''                              
update #file1 set [EC] = 0 where [EC] = ''                             
update #file1 set [SHEC] = 0 where [SHEC] = ''                   
                    
--select * from #file1                              
                                          
update #file1 set [Expense Code]=b.cltcode,[Expense Amount]=b.vamt from                                          
(select cltcode,vno,vamt,vtyp from  accountNCDX.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a                    
 where a.vno=b.vno  and a.vtyp=b.vtyp                       
                    
update #file1 set [Expense Code Name]=b.acname from                                          
(select cltcode,vno,vamt,acname from  accountNCDX.dbo.ledger  where cltcode like '5%' and vno in ( select vno from #t))b, #file1 a                    
 where a.vno=b.vno                       
                             
----------------    cltcode like '5%' and                                      
update #file1 set [Service Tax No.]=v.st_no, [PAN No.]= v.pan_no, [Address]=v.add1+' '+v.add2+' '+v.add3+' '+v.city+' '+v.pin+' '+v.state  from                              
(select cltcode,vno from  accountNCDX.dbo.ledger  where  vno in ( select vno from #t))b, #file1 a, Intranet.angelvms.dbo.vendormaster v                    
 where a.vno=b.vno and v.segment= 'NCDEX' and convert(varchar,v.cltcode)=b.cltcode                    
-----------------                    
                                            
update #file1 set [ST]=b.vamt from                                            
(select cltcode,vno,vamt from  accountNCDX.dbo.ledger  where cltcode =@code and vno in ( select vno from #t))b,#file1 a   where a.vno=b.vno                                              
                                            
                                            
update #file1 set [EC]=b.vamt from                                         
(select cltcode,vno,vamt from  accountNCDX.dbo.ledger  where cltcode =@code1 and vno in ( select vno from #t))b,#file1 a                                      
 where a.vno=b.vno                                              
                                            
                                            
update #file1 set [SHEC]=b.vamt from                                            
(select cltcode,vno,vamt from  accountNCDX.dbo.ledger  where cltcode =@code2 and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                              
                        
update #File1 set [Total] = convert(money,[ST])+convert(money,[EC])+convert(money,[SHEC])                                                      
                        
update #File1 set [Rate] = case when convert(money,[Expense Amount]) <> 0 then convert(money,[Total])/convert(money,[Expense Amount])*100                         
else 0 end --from                                
--(select cltcode,vno,vamt from  accountNCDX.dbo.ledger  where cltcode ='420002' and vno in ( select vno from #t))b,#file1 a        where a.vno=b.vno                          
                          
select * from #file1 where cltcode <> @code                              
                              
                              
                              
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_findInUSP
-- --------------------------------------------------
CREATE PROCEDURE usp_findInUSP            
@dbname varchar(500),          
@srcstr varchar(500)            
AS            
            
 set nocount on          
 set @srcstr  = '%' + @srcstr + '%'            
          
 declare @str as varchar(1000)          
 set @str=''          
 if @dbname <>''          
 Begin          
 set @dbname=@dbname+'.dbo.'          
 End          
 else          
 begin          
 set @dbname=db_name()+'.dbo.'          
 End          
-- print @dbname          
          
 set @str='select distinct O.name,O.xtype from '+@dbname+'sysComments  C '           
 set @str=@str+' join '+@dbname+'sysObjects O on O.id = C.id '           
 set @str=@str+' where O.xtype in (''P'',''V'') and C.text like '''+@srcstr+''''            
 --print @str          
  exec(@str)          
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FINDINUSP_UD
-- --------------------------------------------------
CREATE PROCEDURE USP_FINDINUSP_UD                                 
@DBNAME VARCHAR(500),                                
@SRCSTR VARCHAR(500)                                  
AS                                  
                                  
 SET NOCOUNT ON            
 --                              
 SET @SRCSTR  = '%' + @SRCSTR + '%'                                  
                                
 DECLARE @STR AS VARCHAR(1000)                                
 SET @STR=''                                
 IF @DBNAME <>''                                
 BEGIN                                
 SET @DBNAME=@DBNAME+'.DBO.'                                
 END                                
 ELSE                                
 BEGIN                                
 SET @DBNAME=DB_NAME()+'.DBO.'                                
 END                                
-- PRINT @DBNAME                                
                             
 SET @STR=' INSERT INTO BO_OBJECT '                    
 SET @STR=@STR+' SELECT DISTINCT O.NAME,O.XTYPE,'''+@DBNAME+''',SUBSTRING('''+@SRCSTR+''',2,100) FROM '+@DBNAME+'SYSCOMMENTS  C '                                 
 SET @STR=@STR+' JOIN '+@DBNAME+'SYSOBJECTS O ON O.ID = C.ID '                                 
 SET @STR=@STR+' WHERE O.XTYPE  IN(''P'',''V'') AND (C.TEXT LIKE ''%insert%'' or C.TEXT LIKE ''%update%'' or  C.TEXT LIKE ''%delete%'') '                      
 SET @STR=@STR+' AND REPLACE(C.TEXT,'' '','''') LIKE '''+@SRCSTR+''''                                  
                    
--PRINT @STR                                
EXEC(@STR)                                
SELECT * FROM  BO_OBJECT            
                      
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mcx_reco1
-- --------------------------------------------------
CREATE PROCEDURE usp_mcx_reco1                         
 as                           
set nocount on                           
set transaction isolation level read uncommitted                 
                
/*RECO - check reconsiled suspense a/c with unrecosiled client ledger */              
              
select * into #mcx_cr from ACCOUNTMCDX.DBO.ledger (nolock) where vdt >=getdate()-60 and vtyp=2 and drcr='C' and  cltcode='5100000001'              
              
select * into #mcx_dr from ACCOUNTMCDX.DBO.ledger (nolock) where vdt >=getdate()-60 and vtyp=3 and drcr='D' and  cltcode='5100000001'              
              
select ddno,vno,lno,reldt into #chqnodr from ACCOUNTMCDX.DBO.ledger1 (nolock) where vtyp=3 and vno >='200801010000'                
                  
select ddno,vno,lno,reldt into #chqno from ACCOUNTMCDX.DBO.ledger1 (nolock) where vtyp=2 and vno >='200801010000'                    
              
select a.*,b.ddno,b.reldt into #mcx1dr from #mcx_dr a, #chqnodr b where a.vno=b.vno and a.lno=b.lno                    
              
select a.*,b.ddno,b.reldt into #mcx1 from #mcx_cr a, #chqno b where a.vno=b.vno and a.lno=b.lno                    
              
delete from #mcx1 where cltcode+'|'+convert(varchar(25),ddno) in (select cltcode+'|'+convert(varchar(25),ddno)  from #mcx1dr)                
              
delete from mis.bse.dbo.mcx_reco1               
              
select  a.vtyp,a.vno,a.vdt,a.drcr,a.vamt,a.ddno,b.cltcode,b.ddno as ddno1,b.cramt,a.reldt ,a.edt, a.narration into #temp             
              
from              
              
(select * from #mcx1  where cltcode='5100000001'  and reldt <> 'Jan  1 1900') a,              
              
ACCOUNTMCDX.DBO.angel_client_deposit_recno b where a.ddno=b.ddno and a.vamt=b.cramt              
insert into mis.bse.dbo.mcx_reco1         
select  a.*,b.cltcode,b.acname from #temp a inner join ACCOUNTMCDX.DBO.ledger b on a.vno=b.vno where b.drcr='d'and b.vtyp='2'               
              
           
              
----------------- check for unreconsiled suspense account              
              
--select * from #bse1  where cltcode='5100000001' and reldt ='Jan  1 1900'              
              
              
delete mis.bse.dbo.mcx_noreco               
select vtyp,vno,edt,acname,drcr,vamt,balamt,cltcode,ddno,vdt,narration into #temp1 from #mcx1  where cltcode='5100000001' and reldt ='Jan  1 1900'         
insert into  mis.bse.dbo.mcx_noreco         
select a.*,b.cltcode,b.acname from #temp1 a inner join ACCOUNTMCDX.DBO.ledger b on a.vno=b.vno where b.drcr='d' and b.vtyp='2'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data
-- --------------------------------------------------




CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec usp_mimansa_ucc_mcx_client_data_for_given_clients 'Mar  4 2013', 'Mar  5 2013', 'N'
	exec usp_mimansa_ucc_mcx_client_data 'Apr  8 2013', 'Apr  9 2013', 'N'
*/
Declare @@getdate datetime
set @@getdate=left(getdate(),11)+' 23:59'

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end


set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock)
where
	len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0	
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	--and c5.inactivefrom >= @from_date + ' 00:00:00' 
	and c5.inactivefrom > @@getdate /* Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0


	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


	
	

insert into
	mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		mimansa_angel_mcx_client_data_new
	set
		mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from mimansa_angel_mcx_client_data_new
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	mimansa_angel_mcx_client_data_new

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_for_selected_clients
-- --------------------------------------------------




CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_for_selected_clients] (
	@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)
)

as

/*
	exec [usp_mimansa_ucc_mcx_client_data_for_selected_clients] '', '', 'Y'
*/

if (@selected_clients_only = 'Y') begin
	set @from_date = 'Jan  1 1900'
	set @to_date = 'Dec 31 2078'
end


set nocount on
set implicit_transactions off
set transaction isolation level read uncommitted

truncate table mimansa_angel_mcx_client_data_selected_clients

select 
Cl_Code=ltrim(rtrim(isnull(Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(L_Address2, ''))),L_city=ltrim(rtrim(isnull(L_city, ''))),L_State=ltrim(rtrim(isnull(L_State, ''))),
L_Nation=ltrim(rtrim(isnull(L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(L_Zip, ''))),Fax=ltrim(rtrim(isnull(Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2, '')))),Email=ltrim(rtrim(isnull(Email, ''))),Branch_cd=ltrim(rtrim(isnull(Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(Credit_Limit)),Cl_type=ltrim(rtrim(isnull(Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(Cl_Status, ''))),
Gl_Code=ltrim(rtrim(Gl_Code)),Fd_Code=ltrim(rtrim(isnull(Fd_Code, ''))),Family=ltrim(rtrim(isnull(Family, ''))),
Penalty=ltrim(rtrim(Penalty)),Sub_Broker=ltrim(rtrim(isnull(Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(pan_gir_no, ''))),trader=ltrim(rtrim(isnull(trader, ''))),WARD_NO=ltrim(rtrim(isnull(WARD_NO, ''))),
Region=ltrim(rtrim(isnull(Region, ''))),Area=ltrim(rtrim(isnull(Area, ''))),ClRating=ltrim(rtrim(isnull(ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,mimansa_tbl_ucc_mcx_selected_clients m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, '')))



	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,mimansa_tbl_ucc_mcx_selected_clients m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c2.cl_code, '')))

	
select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),mimansa_tbl_ucc_mcx_selected_clients m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c5.cl_code, '')))

	
	

insert into
	mimansa_angel_mcx_client_data_selected_clients

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then ''
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = 
		case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					--when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank branch address] = 
		(
			select distinct top 1
				ltrim(rtrim(isnull(b.branch_name, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.address1, ''))) + ',' + 
				ltrim(rtrim(isnull(b.city, ''))) + ',' + 
				ltrim(rtrim(isnull(b.nation, '')))
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),
	[bank account number] = 
		(select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),
	[bank account type] = 
		(select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] ='', 
	/*
		isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
		*/
	[depository participant name (nsdl)] = '',
	/*
		isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] ='',
	/* 
		isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	*/
	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] ='',
	/* 
		isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
		*/
	[depository participant name (cdsl)] = '',
	/*
		isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
	/*
		isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
		*/
	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = '',
		/*case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,*/
	[place of issue of ration card number] = '',
		/*case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,*/
	[date of issue of ration card number] = '',
		/*case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,
		*/
	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,

	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] = case
		when
			c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end,
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''


from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock),
	--MCX_14_02_2013 m1 with(nolock)
	mimansa_tbl_ucc_mcx_selected_clients m1 with(nolock)
where
	m1.party_code=ltrim(rtrim(isnull(c1.cl_code, ''))) and
	
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))


	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c5.cl_code, '')))) > 0

	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'
	
	
	
	update
		mimansa_angel_mcx_client_data_selected_clients
	set
		mimansa_angel_mcx_client_data_selected_clients.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = mimansa_angel_mcx_client_data_selected_clients.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(mimansa_angel_mcx_client_data_selected_clients.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		mimansa_angel_mcx_client_data_selected_clients
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(mimansa_angel_mcx_client_data_selected_clients.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(mimansa_angel_mcx_client_data_selected_clients.[client code], '')))) > 0
		
		--select * from mimansa_angel_mcx_client_data_selected_clients
	
				
	
	

/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/
/*************************************************************************************************************/

only_select:

delete
	mimansa_angel_mcx_client_data_selected_clients
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(mimansa_angel_mcx_client_data_selected_clients.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(mimansa_angel_mcx_client_data_selected_clients.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	mimansa_angel_mcx_client_data_selected_clients

where
	len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	and (
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 --or
		--len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH
-- --------------------------------------------------





/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam 'Apr 16 2018','Apr 21 2018','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new2022 m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new2022 m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_ADTest
-- --------------------------------------------------

/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_ADTest] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode_ADTest A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode_ADTest where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](20) NULL,
	[Nationality] [varchar](20) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](20) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](20) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](10) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=case when coalesce(c1.FATHERNAME,'')!='' then ltrim(rtrim(c1.FATHERNAME)) end,
		--FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				when c1.Occupation=ltrim(rtrim('')) then ''
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		--commented by ravi for to remove default value on date 28 April2015
		--update #mimansa_ucc_mcx_currency_client_data
		--set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		--where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		--and category not in ('13','15','16','17')

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name))
--	from
--		tblUCCMCXClientCode_ADTest mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode_ADTest

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode_ADTest
	

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Arjun
-- --------------------------------------------------




/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Arjun] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam 'Apr 16 2018','Apr 21 2018','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Backup(11Mar2015)
-- --------------------------------------------------
Create proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Backup(11Mar2015)] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](1) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end, --26 Mar 2014
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 		
			IncomedetailsperannuminRs='02', 
			Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where Incomeasondate=''
		and m.ClientCode= t.cl_code

		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 				
			Incomeasondate='25032013' 
		from #mimansa_ucc_mcx_currency_client_data m
		where  
		len(Incomeasondate)>0
		and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Backup(19March2015)
-- --------------------------------------------------
Create proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Backup(19March2015)] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](1) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end, --26 Mar 2014
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 		
			IncomedetailsperannuminRs='02', 
			Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where Incomeasondate=''
		and m.ClientCode= t.cl_code

		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 				
			Incomeasondate='25032013' 
		from #mimansa_ucc_mcx_currency_client_data m
		where  
		len(Incomeasondate)>0
		and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Backup(23June2015)
-- --------------------------------------------------

/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


Create proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Backup(23June2015)] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 
					
	

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_backup_30Nov2017
-- --------------------------------------------------


/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_backup_30Nov2017] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Backup28April2015
-- --------------------------------------------------
Create proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Backup28April2015] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](1) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end, --26 Mar 2014
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 		
			IncomedetailsperannuminRs='02', 
			Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where Incomeasondate=''
		and m.ClientCode= t.cl_code

		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 				
			Incomeasondate='25032013' 
		from #mimansa_ucc_mcx_currency_client_data m
		where  
		len(Incomeasondate)>0
		and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Bak9feb2018
-- --------------------------------------------------




/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


create proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Bak9feb2018] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from [172.31.16.57].CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_bkp_26Feb2018
-- --------------------------------------------------





/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_bkp_26Feb2018] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from [172.31.16.57].CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_bkup12Sep2022
-- --------------------------------------------------





/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_bkup12Sep2022] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam 'Apr 16 2018','Apr 21 2018','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from [172.31.16.57].CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_DateRangeWise
-- --------------------------------------------------


/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/
CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_DateRangeWise] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	create table #TempTable1
		(Client_Code varchar(20),
		Client_Name varchar(100),
		Pan_No varchar(20),
		Client_Type varchar(100),
		App_Form_No varchar(20),
		Com_Form_No varchar(20),
		Mod_Form_No varchar(20),
		Bo_Category varchar(20),
		Bo_ClientType varchar(20),
		branch varchar(30),
		subbroker varchar(20),
		process_status varchar(200),
		document_Type varchar(20),
		Initiated_Date varchar(20),
		Modified_date varchar(20),
		Ho_Recd_Dt varchar(20),
		verf_dt varchar(20),
		Verf_name varchar(30),
		Aud_Obj_DT varchar(20),
		Aud_Obj_Name varchar(30),
		Aud_DT varchar(20),
		Aud_Name varchar(30),
		CRN_No varchar(20),
		Dp_Batch_No varchar(20),
		Modification_type varchar(100),
		Request_Type varchar(20),
		DP_ID varchar(100))

       insert into #TempTable1
       exec ABVSCITRUS.CRMDB_A.dbo.pr_clientlisting_mod @@FromDate,@@ToDate,'0',3,'HO','HO'
	   declare @@FromDate1 datetime
       set @@FromDate1=convert(datetime,@@FromDate)
	   declare @@ToDate1 datetime
       set @@ToDate1=convert(datetime,@@ToDate)

    /*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 



		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from anand1.msajag.dbo.CLIENT_M_CI c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code=c1.cl_code
				and c1.cl_code>=@@FromClientCode
				and c1.cl_code<=@@ToClientCode
				and c1.UPDTIME >= @@FromDate
				and c1.UPDTIME <= @@ToDate	
				and c5.InactiveFrom>@@getdate
		union
		select distinct cl_code = ltrim(rtrim(isnull(c1.client_code, '')))
		from #TempTable1 c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where (c1.Modification_type like 'MOBILE%' or c1.Modification_type like 'Email%')	
		        and c5.cl_code=c1.client_code
		        and c1.client_code>=@@FromClientCode
				and c1.client_code<=@@ToClientCode
				and left(convert(varchar(30), c1.Modified_Date,109),10) >=convert(varchar,@@FromDate1,103)
				and left(convert(varchar(30), c1.Modified_Date,109),10) <=convert(varchar,@@ToDate1,103)
				and c5.InactiveFrom>@@getdate	

		


/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_DJ
-- --------------------------------------------------





/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_DJ] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam 'Apr 16 2018','Apr 21 2018','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--INTRANET.mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_test_PSB
-- --------------------------------------------------




/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_test_PSB] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec [usp_mimansa_ucc_mcx_client_data_RITESH_test_PSB] 'feb 22 2018','feb 22 2018','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on
		

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
	,ActiveFrom datetime
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	,ActiveFrom=c5.activefrom
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						when ActiveFrom< '2013-01-01 00:00:00.000' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					when ActiveFrom< '2013-01-01 00:00:00.000' then '02'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 

when ActiveFrom< '2013-01-01 00:00:00.000' and REPLACE(DATEDIFF(DAY,getdate(), c1.gross_date),'-','')>540 then 
replace(convert(varchar, getdate()-630, 103), '/', '')
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				when ActiveFrom< '2013-01-01 00:00:00.000' then '0'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	

	update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.LNAME,'')
	from [172.31.16.57].CRMDB_A.DBO.Api_Kyc c1 with(nolock)
	where ClientCode = BOPARTYCODE
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(BOPARTYCODE, '')) > 0
		and isnull(FathersHusbandsGuardiansName,'')=''
		and ActiveFrom< '2013-01-01 00:00:00.000' 
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from [172.31.16.57].CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Test21May2015
-- --------------------------------------------------

/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

EXEC usp_mimansa_ucc_mcx_client_data_RITESH_Test21May2015  @from_date='',@to_date='',@ClientCode='',@processid ='e0wk0qh4gndybo3u31qtqr1i21052015_182612'

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Test21May2015] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''

exec usp_mimansa_ucc_mcx_client_data_RITESH_Test21May2015 '','','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCMCXClientCode  A with(nolock)--tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.partycode
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			--and A.processid=@processid		

		/*Delete selected clients*/	
		--delete from tblUCCClientCode where processid=@processid	
	
		
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	print 'reached step'
		

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

				 print 'reached step 2'
		
update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	

print 'reached step 3'
	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	print 'reached step 4'

	
select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/

print 'reached step 5'



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))


	print 'reached step 6'



/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	print 'reached step 7'
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

		print 'reached step 8'
	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		/* temparary date 21 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate='31122014'
		where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		/* temparary date 21 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate='31122014'
		where len(Incomeasondate)=0 
							
		print 'reached step 9'
		
		--commented by ravi for to remove default value on date 28 April2015
		--update #mimansa_ucc_mcx_currency_client_data
		--set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		--where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		--and category not in ('13','15','16','17')

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=ltrim(rtrim( SUBSTRING(c11.addemailid,CHARINDEX(' ',ltrim(c11.addemailid)),len(ltrim(c11.addemailid)))))
		 
		 from tblUCCMCXClientCode s ,#mimansa_ucc_mcx_currency_client_data a, anand1.msajag.dbo.Client_Details c11 with(nolock) 
		where  s.partycode=a.ClientCode and
		s.partycode=c11.cl_code and
		isnull(ltrim(rtrim(a.FathersHusbandsGuardiansName)),'')=''
		and a.category not in ('13','15','16','17')

			
		--	update #mimansa_ucc_mcx_currency_client_data
		--set FathersHusbandsGuardiansName= REVERSE(SUBSTRING(REVERSE(ltrim(ClientName)), 1, CHARINDEX(' ', REVERSE(ltrim(ClientName))) - 1))
		--where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		--and category not in ('13','15','16','17')


		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')



		/*Temparary  default  22 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation='04'
	    where Occupation=''

		/*Temparary  default  22 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		IncomedetailsperannuminRs='02'
	    where IncomedetailsperannuminRs=''
		

		/*Temparary  default  22 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 		
		NetWorthRs='',
		NetWorthasonDate=''

	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

	
/* just for one day (29/05/2015) for given client list in excel*/
update
		#mimansa_ucc_mcx_currency_client_data
	set ClientName=rtrim(ltrim(name))--,UIDNUMBER=''
	from
		tblUCCMCXClientCode mcxc1 with(nolock)
	where
		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode

		--select top 5 * from tblUCCMCXClientCode
		
			
select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


	
/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_Test28April
-- --------------------------------------------------
CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_Test28April] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](1) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '' end,
				--else '99' end, --26 Mar 2014 -- comment by ravi to remove default values on date 28 April 2015
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
	--commented by ravi for to remove default value on date 28 April2015
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code

		--commented by ravi for to remove default value on date 28 April2015
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		--commented by ravi for to remove default value on date 28 April2015
		--update #mimansa_ucc_mcx_currency_client_data
		--set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		--where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		--and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam
-- --------------------------------------------------




/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,

*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new_testNeelam m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new_testNeelam m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](12) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_SAN
-- --------------------------------------------------


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_SAN] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate

		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end






--truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
where c5.cl_code=c1.party_code
	
print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0

	
	UPDATE #temp_Client1   /* Added on 12/09/2017 mail from Ajajy Gupta */
       SET
           L_state = CASE
                         WHEN L_city = 'HYDERABAD'
                         THEN 'ANDHRA PRADESH'
                         ELSE L_state
                     END
	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					when c1.l_state='TELANGANA' then 'ANDHRA PRADESH' -- Added by Rajesh on 25 Apr 2017 to avoid "0" code issue from Exchange. Mail from Ajay Gupta
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =1, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' or ltrim(rtrim(c1.cl_status))='LLP' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_SAN_Backup(11March2015)
-- --------------------------------------------------


Create proc [dbo].[usp_mimansa_ucc_mcx_client_data_SAN_Backup(11March2015)] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate

		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end






--truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
where c5.cl_code=c1.party_code
	
print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0


	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =1, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_SAN_bkp21Apr18
-- --------------------------------------------------


create proc [dbo].[usp_mimansa_ucc_mcx_client_data_SAN_bkp21Apr18] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate

		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end






--truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
where c5.cl_code=c1.party_code
	
print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0

	
	UPDATE #temp_Client1   /* Added on 12/09/2017 mail from Ajajy Gupta */
       SET
           L_state = CASE
                         WHEN L_city = 'HYDERABAD'
                         THEN 'ANDHRA PRADESH'
                         ELSE L_state
                     END
	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					when c1.l_state='TELANGANA' then 'ANDHRA PRADESH' -- Added by Rajesh on 25 Apr 2017 to avoid "0" code issue from Exchange. Mail from Ajay Gupta
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =1, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' or ltrim(rtrim(c1.cl_status))='LLP' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_SAN_DateRangeWise
-- --------------------------------------------------


CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_SAN_DateRangeWise] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	create table #TempTable1
		(Client_Code varchar(20),
		Client_Name varchar(100),
		Pan_No varchar(20),
		Client_Type varchar(100),
		App_Form_No varchar(20),
		Com_Form_No varchar(20),
		Mod_Form_No varchar(20),
		Bo_Category varchar(20),
		Bo_ClientType varchar(20),
		branch varchar(30),
		subbroker varchar(20),
		process_status varchar(200),
		document_Type varchar(20),
		Initiated_Date varchar(20),
		Modified_date varchar(20),
		Ho_Recd_Dt varchar(20),
		verf_dt varchar(20),
		Verf_name varchar(30),
		Aud_Obj_DT varchar(20),
		Aud_Obj_Name varchar(30),
		Aud_DT varchar(20),
		Aud_Name varchar(30),
		CRN_No varchar(20),
		Dp_Batch_No varchar(20),
		Modification_type varchar(100),
		Request_Type varchar(20),
		DP_ID varchar(100))

       insert into #TempTable1
       exec ABVSCITRUS.CRMDB_A.dbo.pr_clientlisting_mod @@FromDate,@@ToDate,'0',3,'HO','HO'
	   declare @@FromDate1 datetime
       set @@FromDate1=convert(datetime,@@FromDate)
	   declare @@ToDate1 datetime
       set @@ToDate1=convert(datetime,@@ToDate)

	--declare @totalrecord as numeric

       select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0


		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(c1.cl_code, '')))
		from anand1.msajag.dbo.CLIENT_M_CI c1 with(nolock), angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	c5.cl_code=c1.cl_code
				and c1.cl_code>=@@FromClientCode
				and c1.cl_code<=@@ToClientCode
				and c1.UPDTIME >= @@FromDate
				and c1.UPDTIME <= @@ToDate	
				and c5.InactiveFrom>@@getdate

				union

		select distinct cl_code = ltrim(rtrim(isnull(c1.client_code, '')))
		from #TempTable1 c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where (c1.Modification_type like 'MOBILE%' or c1.Modification_type like 'Email%')	
		        and c5.cl_code=c1.client_code
		        and c1.client_code>=@@FromClientCode
				and c1.client_code<=@@ToClientCode
				and left(convert(varchar(30), c1.Modified_Date,109),10) >=convert(varchar,@@FromDate1,103)
				and left(convert(varchar(30), c1.Modified_Date,109),10) <=convert(varchar,@@ToDate1,103)
				and c5.InactiveFrom>@@getdate

		

       select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
       where c5.cl_code=c1.party_code
	
       print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0

	
	UPDATE #temp_Client1   /* Added on 12/09/2017 mail from Ajajy Gupta */
       SET
           L_state = CASE
                         WHEN L_city = 'HYDERABAD'
                         THEN 'ANDHRA PRADESH'
                         ELSE L_state
                     END
	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					when c1.l_state='TELANGANA' then 'ANDHRA PRADESH' -- Added by Rajesh on 25 Apr 2017 to avoid "0" code issue from Exchange. Mail from Ajay Gupta
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =1, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' or ltrim(rtrim(c1.cl_status))='LLP' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_SAN_DJ
-- --------------------------------------------------



CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_SAN_DJ] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate

		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end






--truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
where c5.cl_code=c1.party_code
	
print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0

	
	UPDATE #temp_Client1   /* Added on 12/09/2017 mail from Ajajy Gupta */
       SET
           L_state = CASE
                         WHEN L_city = 'HYDERABAD'
                         THEN 'ANDHRA PRADESH'
                         ELSE L_state
                     END
	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					when c1.l_state='TELANGANA' then 'ANDHRA PRADESH' -- Added by Rajesh on 25 Apr 2017 to avoid "0" code issue from Exchange. Mail from Ajay Gupta
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =1, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' or ltrim(rtrim(c1.cl_status))='LLP' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_client_data_SAN_DJ1
-- --------------------------------------------------



CREATE proc [dbo].[usp_mimansa_ucc_mcx_client_data_SAN_DJ1] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate

		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end






--truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
where c5.cl_code=c1.party_code
	
print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0

	
	UPDATE #temp_Client1   /* Added on 12/09/2017 mail from Ajajy Gupta */
       SET
           L_state = CASE
                         WHEN L_city = 'HYDERABAD'
                         THEN 'ANDHRA PRADESH'
                         ELSE L_state
                     END
	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					when c1.l_state='TELANGANA' then 'ANDHRA PRADESH' -- Added by Rajesh on 25 Apr 2017 to avoid "0" code issue from Exchange. Mail from Ajay Gupta
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =1, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' or ltrim(rtrim(c1.cl_status))='LLP' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_Deactive_client_data
-- --------------------------------------------------







/*

--commented by ravi for to remove default value on date 28 April2015
FathersHusbandsGuardiansName
Occupation
IncomedetailsperannuminRs	,
Incomeasondate	,
exec [usp_mimansa_ucc_mcx_Deactive_client_data] 'Jan 25 2024','Jan 25 2024','',''
*/


CREATE proc [dbo].[usp_mimansa_ucc_mcx_Deactive_client_data] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH_testNeelam 'Apr 16 2018','Apr 21 2018','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(60),regr_place varchar(50),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock) join anand1.msajag.dbo.client_brok_details c with(nolock)
		on c.cl_code=c5.cl_code
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			and  c5.inactivefrom  >=@@FromDate
			and  c5.inactivefrom  <= @@ToDate
			and c.Deactive_value = 'C'
			 and c.exchange='MCX' and c.segment='FUTURES'


end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock), anand1.msajag.dbo.client_brok_details c with(nolock)		
		where c.cl_code=c5.cl_code and 			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		
			and c.Deactive_value = 'C'
			 and c.exchange='MCX' and c.segment='FUTURES'



		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		/*Added by Priyanka B on 01 Dec 2017 As Per MCX Circular given By Ajaykumar Gupta*/
		Long_Name=UPPER(ltrim(rtrim(isnull(addemailid,'')))),
		--Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when  L_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
				  when  L_state='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				  when   P_state ='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN & NICOBAR ISLANDS' /*Added on 09 Aug 2014*/
			      when   P_state ='JAMMU AND KASHMIR' then 'JAMMU & KASHMIR' /*Added on 09 Aug 2014*/
				 else
					P_state
				 end	


	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' or cl_status = 'LLP' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](10) NULL,
	[ClientName] [varchar](150) NULL,
	[Category] [varchar](10) NULL,
	[PAN] [varchar](10) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](150) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](8) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[Address1Corresponding] [varchar](255) NULL,
	[Address2Corresponding] [varchar](255) NULL,
	[Address3Corresponding] [varchar](255) NULL,
	[CountryCorresponding] [varchar](20) NULL,
	[StateCityCodeCorresponding] [varchar](50) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](1) NULL,
	[Address1Permanent] [varchar](255) NULL,
	[Address2Permanent] [varchar](255) NULL,
	[Address3Permanent] [varchar](255) NULL,
	[CountryPermanent] [varchar](20) NULL,
	[StateCityCodePermanent] [varchar](50) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](8) NULL,
	[UIDNumber] [varchar](30) NULL,
	[BankName1] [varchar](60) NULL,
	[BankBranchAddress1] [varchar](255) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](2) NULL,
	[BankName2] [varchar](60) NULL,
	[BankBranchAddress2] [varchar](255) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](2) NULL,
	[BankName3] [varchar](60) NULL,
	[BankBranchAddress3] [varchar](255) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](2) NULL,
	[DepositoryName1] [varchar](1) NULL,
	[DepositoryId1] [varchar](8) NULL,
	[BeneficiaryAccountID1] [varchar](16) NULL,
	[DepositoryName2] [varchar](1) NULL,
	[DepositoryId2] [varchar](8) NULL,
	[BeneficiaryAccountID2] [varchar](16) NULL,
	[DepositoryName3] [varchar](1) NULL,
	[DepositoryId3] [varchar](8) NULL,
	[BeneficiaryAccountID3] [varchar](16) NULL,
	[CIN] [varchar](21) NULL,
	[PlaceofIncorporation] [varchar](75) NULL,
	[Occupation] [varchar](2) NULL,
	[OccupationDetailsForOthers] [varchar](75) NULL,
	[Dateofcommencementofbusiness] [varchar](8) NULL,
	[IncomedetailsperannuminRs] [varchar](2) NULL,
	[Incomeasondate] [varchar](8) NULL,
	[NetworthRs] [varchar](18) NULL,
	[Networthasondate] [varchar](8) NULL,
	[PoliticallyexposedpersonPEP] [varchar](2) NULL,
	[CPCode] [varchar](15) NULL,
	[RegistrationNumberofClient] [varchar](50) NULL,
	[RegisteringAuthority] [varchar](60) NULL,
	[PlaceofRegistration] [varchar](25) NULL,
	[DateofRegistration] [varchar](8) NULL,
	[InpersonVerification] [varchar](1) NULL,
	[ClientAgreementDate] [varchar](8) NULL,
	[Reserved] [varchar](10) NULL,
	[RelationshipCode] [varchar](10) NULL,
	[ProofType] [varchar](2) NULL,
	[ProofNumber] [varchar](25) NULL,
	[IssuePlaceofProof] [varchar](100) NULL,
	[IssueDateofProof] [varchar](8) NULL,
	[ClientStatus] [varchar](1) NULL,
	[Remarks] [varchar](200) NULL,
	[ClientTypeCorporate] [varchar](1) NULL,
	[NameofContactPerson1] [varchar](100) NULL,
	[DesignationofContactPerson1] [varchar](100) NULL,
	[PANofcontactPerson1] [varchar](100) NULL,
	[AddressofContactPerson1] [varchar](255) NULL,
	[ContactDetailsofContactPerson1] [varchar](100) NULL,
	[DINofContactPerson1] [varchar](100) NULL,
	[UIDofContactPerson1] [varchar](100) NULL,
	[EmailIdofContactPerson1] [varchar](100) NULL,
	[NameofContactPerson2] [varchar](100) NULL,
	[DesignationofContactPerson2] [varchar](100) NULL,
	[PANofcontactPerson2] [varchar](100) NULL,
	[AddressofContactPerson2] [varchar](255) NULL,
	[ContactDetailsofContactPerson2] [varchar](100) NULL,
	[DINofContactPerson2] [varchar](100) NULL,
	[UIDofContactPerson2] [varchar](100) NULL,
	[EmailIdofContactPerson2] [varchar](100) NULL,
	[NameofContactPerson3] [varchar](100) NULL,
	[DesignationofContactPerson3] [varchar](100) NULL,
	[PANofcontactPerson3] [varchar](100) NULL,
	[AddressofContactPerson3] [varchar](255) NULL,
	[ContactDetailsofContactPerson3] [varchar](100) NULL,
	[DINofContactPerson3] [varchar](100) NULL,
	[UIDofContactPerson3] [varchar](100) NULL,
	[EmailIdofContactPerson3] [varchar](100) NULL,
	[NameofContactPerson4] [varchar](100) NULL,
	[DesignationofContactPerson4] [varchar](100) NULL,
	[PANofcontactPerson4] [varchar](100) NULL,
	[AddressofContactPerson4] [varchar](255) NULL,
	[ContactDetailsofContactPerson4] [varchar](100) NULL,
	[DINofContactPerson4] [varchar](100) NULL,
	[UIDofContactPerson4] [varchar](100) NULL,
	[EmailIdofContactPerson4] [varchar](100) NULL,
	[NameofContactPerson5] [varchar](100) NULL,
	[DesignationofContactPerson5] [varchar](100) NULL,
	[PANofcontactPerson5] [varchar](100) NULL,
	[AddressofContactPerson5] [varchar](255) NULL,
	[ContactDetailsofContactPerson5] [varchar](100) NULL,
	[DINofContactPerson5] [varchar](100) NULL,
	[UIDofContactPerson5] [varchar](100) NULL,
	[EmailIdofContactPerson5] [varchar](100) NULL,
	[NameofContactPerson6] [varchar](100) NULL,
	[DesignationofContactPerson6] [varchar](100) NULL,
	[PANofcontactPerson6] [varchar](100) NULL,
	[AddressofContactPerson6] [varchar](255) NULL,
	[ContactDetailsofContactPerson6] [varchar](100) NULL,
	[DINofContactPerson6] [varchar](100) NULL,
	[UIDofContactPerson6] [varchar](100) NULL,
	[EmailIdofContactPerson6] [varchar](100) NULL,
	[NameofContactPerson7] [varchar](100) NULL,
	[DesignationofContactPerson7] [varchar](100) NULL,
	[PANofcontactPerson7] [varchar](100) NULL,
	[AddressofContactPerson7] [varchar](255) NULL,
	[ContactDetailsofContactPerson7] [varchar](100) NULL,
	[DINofContactPerson7] [varchar](100) NULL,
	[UIDofContactPerson7] [varchar](100) NULL,
	[EmailIdofContactPerson7] [varchar](100) NULL,
	[NameofContactPerson8] [varchar](100) NULL,
	[DesignationofContactPerson8] [varchar](100) NULL,
	[PANofcontactPerson8] [varchar](100) NULL,
	[AddressofContactPerson8] [varchar](255) NULL,
	[ContactDetailsofContactPerson8] [varchar](100) NULL,
	[DINofContactPerson8] [varchar](100) NULL,
	[UIDofContactPerson8] [varchar](100) NULL,
	[EmailIdofContactPerson8] [varchar](100) NULL,
	[NameofContactPerson9] [varchar](100) NULL,
	[DesignationofContactPerson9] [varchar](100) NULL,
	[PANofcontactPerson9] [varchar](100) NULL,
	[AddressofContactPerson9] [varchar](255) NULL,
	[ContactDetailsofContactPerson9] [varchar](100) NULL,
	[DINofContactPerson9] [varchar](100) NULL,
	[UIDofContactPerson9] [varchar](100) NULL,
	[EmailIdofContactPerson9] [varchar](100) NULL,
	[NameofContactPerson10] [varchar](100) NULL,
	[DesignationofContactPerson10] [varchar](100) NULL,
	[PANofcontactPerson10] [varchar](100) NULL,
	[AddressofContactPerson10] [varchar](255) NULL,
	[ContactDetailsofContactPerson10] [varchar](100) NULL,
	[DINofContactPerson10] [varchar](100) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1='Branch address ' + Replace(c1_b.bank_address,',',' '),
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='1',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end,
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,

		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'				
				else '99' end, --26 Mar 2014 
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin	
	--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 		
		--	IncomedetailsperannuminRs='02', 
		--	Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		--from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		--where Incomeasondate=''
		--and m.ClientCode= t.cl_code
--commented by ravi for to remove default value on date 28 April2015	
		--update 
		--	#mimansa_ucc_mcx_currency_client_data 
		--	set 				
		--	Incomeasondate='25032013' 
		--from #mimansa_ucc_mcx_currency_client_data m
		--where  
		--len(Incomeasondate)>0
		--and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		 
		/*commented by ravi for to remove default value on date 09 May 2015 */
		update #mimansa_ucc_mcx_currency_client_data
		set Incomeasondate=''
		where Incomeasondate=replace(convert(varchar, DateofBirth_Incorporation, 103), '/', '') 


		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)>0 and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>547

		--/* temparary date 21 May 2015 */
		--update #mimansa_ucc_mcx_currency_client_data
		--set Incomeasondate='31032014'
		--where len(Incomeasondate)=0 

		/* added by ravi to reset father name if only last name is exists on 23 June 2015*/
		update #mimansa_ucc_mcx_currency_client_data	
		set FathersHusbandsGuardiansName=''	
		where (LEN(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''))-LEN(REPLACE(isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),''), ' ', '')))=0 
		and isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')<>''
		and category not in ('13','15','16','17')

		--commented by ravi for to remove default value on date 28 April2015
		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName= (case when (LEN(ltrim(rtrim(ClientName)))-LEN(REPLACE(ltrim(rtrim(ClientName)), ' ', '')))>=2 then  SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName))) else '' end)
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 5 May 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		OccupationDetailsForOthers=''
	    where Occupation='99'

		/*Remove it 28 April 2015 for default*/
		update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		Occupation=''
	    where Occupation='99'

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,''),
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2 ,' ')+ ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=isnull(c1.Address1,' ') + ' '+ isnull( c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=isnull(c1.Address1,' ') + ' '+  isnull(c1.Address2,' ') + ' ' + isnull(c1.Address3,' '),
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
update #mimansa_ucc_mcx_currency_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforMobile]=case when RELATION_CLIENT_MOBILE in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)) end ,
--[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
[NameoftheAuthorisedOrContactpersonforEmail]=case when RELATION_CLIENT_EMAIL in (1,2,3,4) then '' else ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL)) end 
--[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


/* just for one day (29/05/2015) for given client list in excel*/
--update
--		#mimansa_ucc_mcx_currency_client_data
--	set ClientName=rtrim(ltrim(name)),UIDNUMBER=''
--	from
--		tblUCCMCXClientCode mcxc1 with(nolock)
--	where
--		ClientCode = mcxc1.PartyCode

		--select rtrim(ltrim(name)) from tblUCCMCXClientCode

		--select * into tblUCCMCXClientCode_Temp from tblUCCMCXClientCode



select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	,
FathersHusbandsGuardiansName	,
MaritalStatus	,
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	,
BankAccountNumber1	,
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation	,
OccupationDetailsForOthers	,
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs	,
Incomeasondate	,
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	,
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_Deactive_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_Inactive_clients_data_rit
-- --------------------------------------------------


CREATE proc [dbo].[usp_mimansa_ucc_mcx_Inactive_clients_data_rit] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),	
	@processid varchar(50)
	
	/*@from_date varchar(11),
	@to_date varchar(11),
	@selected_clients_only char(1)*/
)

as
/*
exec [usp_mimansa_ucc_mcx_client_data_SAN] @from_date='May 12 2014', @to_date='May 12 2014',@ClientCode='',@processid=''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	--declare @totalrecord as numeric

select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

if isnull(@processid,'')=''
begin
	print 'DATARANGE'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where	cl_code>=@@FromClientCode
				and cl_code<=@@ToClientCode	
				and c5.inactivefrom >@@getdate 
				and activefrom >= @@FromDate
				and activefrom <= @@ToDate

		--select @totalrecord = count(*) from #codes_to_process

end
else
begin
	print 'SELECTED'
		insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(cl_code, '')))
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where	c5.cl_code=A.party_code
				and c5.cl_code>=@@FromClientCode
				and c5.cl_code<=@@ToClientCode
				and A.processid=@processid	

		--select @totalrecord = count(*) from #codes_to_process

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end






--truncate table mimansa_angel_mcx_client_data_new

select c5.* into #temp_client5 from 	angelcommodity.mcdx.dbo.client5 c5 with(nolock),#codes_to_process c1
where c5.cl_code=c1.party_code
	
print 'START'

select 
Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code, ''))),
Short_Name=ltrim(rtrim(isnull(c1.Short_Name, ''))),Long_Name=ltrim(rtrim(isnull(c1.Long_Name, ''))),L_Address1=ltrim(rtrim(isnull(c1.L_Address1, ''))),
L_Address2=ltrim(rtrim(isnull(c1.L_Address2, ''))),L_city=ltrim(rtrim(isnull(c1.L_city, ''))),L_State=ltrim(rtrim(isnull(c1.L_State, ''))),
L_Nation=ltrim(rtrim(isnull(c1.L_Nation, ''))),L_Zip=ltrim(rtrim(isnull(c1.L_Zip, ''))),Fax=ltrim(rtrim(isnull(c1.Fax, ''))),
Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone1, '')))),Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Res_Phone2, '')))),
Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone1, '')))),Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Off_Phone2, '')))),Email=ltrim(rtrim(isnull(c1.Email, ''))),Branch_cd=ltrim(rtrim(isnull(c1.Branch_cd, ''))),
Credit_Limit=ltrim(rtrim(c1.Credit_Limit)),Cl_type=ltrim(rtrim(isnull(c1.Cl_type, ''))),Cl_Status=ltrim(rtrim(isnull(c1.Cl_Status, ''))),
Gl_Code=ltrim(rtrim(c1.Gl_Code)),Fd_Code=ltrim(rtrim(isnull(c1.Fd_Code, ''))),Family=ltrim(rtrim(isnull(c1.Family, ''))),
Penalty=ltrim(rtrim(c1.Penalty)),Sub_Broker=ltrim(rtrim(isnull(c1.Sub_Broker, ''))),Confirm_fax=ltrim(rtrim(isnull(c1.Confirm_fax, ''))),
PhoneOld=ltrim(rtrim(isnull(c1.PhoneOld, ''))),L_Address3=ltrim(rtrim(isnull(c1.L_Address3, ''))),Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(c1.Mobile_Pager, '')))),
pan_gir_no=ltrim(rtrim(isnull(c1.pan_gir_no, ''))),trader=ltrim(rtrim(isnull(c1.trader, ''))),WARD_NO=ltrim(rtrim(isnull(c1.WARD_NO, ''))),
Region=ltrim(rtrim(isnull(c1.Region, ''))),Area=ltrim(rtrim(isnull(c1.Area, ''))),ClRating=ltrim(rtrim(isnull(c1.ClRating, '')))
into #temp_client1 from angelcommodity.mcdx.dbo.client1 c1 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c1.cl_code, '')))
	and len(ltrim(rtrim(isnull(c1.cl_code, '')))) > 0


	
select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	angelcommodity.mcdx.dbo.client2 c2 with(nolock) ,#temp_client5 m1 with(nolock)
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0

	


CREATE TABLE #mimansa_angel_mcx_client_data_new(
	[client code] [varchar](10) NULL,
	[client first name] [varchar](8000) NULL,
	[middle name] [varchar](8000) NULL,
	[last name] [varchar](8000) NULL,
	[category] [varchar](2) NOT NULL,
	[client address1] [varchar](40) NULL,
	[address 2] [varchar](40) NULL,
	[address 3] [varchar](40) NULL,
	[city] [varchar](40) NULL,
	[state] [varchar](50) NULL,
	[country] [varchar](15) NULL,
	[pin code] [varchar](10) NULL,
	[telephone number] [varchar](8000) NULL,
	[client agreement date] [varchar](8000) NULL,
	[date of birth] [varchar](8000) NULL,
	[pan number] [varchar](50) NULL,
	[ward number] [varchar](50) NULL,
	[uin] [varchar](1) NULL,
	[bank name] [varchar](50) NULL,
	[bank branch address] [varchar](194) NULL,
	[bank account number] [varchar](20) NULL,
	[bank account type] [varchar](7) NULL,
	[depository name (nsdl)] [varchar](4) NOT NULL,
	[depository participant id (nsdl)] [varchar](20) NULL,
	[depository participant name (nsdl)] [varchar](50) NULL,
	[beneficiary account id (nsdl)] [varchar](16) NULL,
	[depository name (cdsl)] [varchar](4) NOT NULL,
	[depository participant id (cdsl)] [varchar](20) NULL,
	[depository participant name (cdsl)] [varchar](50) NULL,
	[beneficiary account id (cdsl)] [varchar](16) NULL,
	[passport number] [varchar](30) NULL,
	[place of issue of passport] [varchar](30) NULL,
	[date of issue of passport] [varchar](8000) NULL,
	[expiry date of passport] [varchar](8000) NULL,
	[driving license number] [varchar](30) NULL,
	[place of issue of driving license number] [varchar](30) NULL,
	[date of issue of driving license number] [varchar](8000) NULL,
	[expiry date of driving license number] [varchar](8000) NULL,
	[voter id] [varchar](30) NULL,
	[place of issue of voter id number] [varchar](30) NULL,
	[date of issue of voter id number] [varchar](8000) NULL,
	[ration card number] [varchar](30) NULL,
	[place of issue of ration card number] [varchar](30) NULL,
	[date of issue of ration card number] [varchar](8000) NULL,
	[registration number of client] [varchar](50) NULL,
	[registering authority] [varchar](50) NULL,
	[place of registration] [varchar](50) NULL,
	[date of registration] [varchar](8000) NULL,
	[introducers name] [varchar](30) NULL,
	[introducers client id] [varchar](50) NULL,
	[relationship with the introducer] [varchar](50) NULL,
	[dealing with other member] [varchar](1) NOT NULL,
	[relationship code] [varchar](10) NOT NULL,
	[status] [char](1) NOT NULL,
	[flag] [varchar](1) NULL,
	[sms_email_status] [char](10) NULL,
	[mobile_number] [varchar](25) NULL,
	[email_id] [varchar](500) NULL,
	[reserved] [varchar](10) NULL,
	[reserved1] [varchar](10) NULL,
	[reserved2] [varchar](10) NULL
)
	

insert into
	#mimansa_angel_mcx_client_data_new

select
	[client code] = ltrim(rtrim(isnull(c2.party_code, ''))),
	--[client first name] = case when cl_status = 'HUF' then c1.long_name 
	[client first name] = case when cl_status <> 'IND' then c1.long_name 
		else
		left (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)
		end,
	--[middle name] = case when cl_status = 'HUF' then ''
	[middle name] = case when cl_status <> 'IND' then '' 
		else
		substring (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
			end,
			case when
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) else
				charindex (
					space(1), 
					replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 
					case 
						when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 1 
						else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) + 1 
					end
				)
			end - 
			case 
				when charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) <= 0 then 0 
				else charindex (space(1), replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)), 1) 
			end
		)end,
	--[last name] =  case when cl_status = 'HUF' then ''
	[last name] =  case when cl_status <> 'IND' then ''
		else
		right (
			replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1)),
			case 
				when charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) <= 0 then len(replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))) 
				else charindex (space(1), reverse (replace(ltrim(rtrim(isnull(c1.long_name, ''))), space(2), space(1))), 1) - 1 
			end
		)end,
	[category] = cast('' as varchar(10)) 
		/*case 
			when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then '01'
			when ltrim(rtrim(isnull(cl_type, ''))) = 'INS' then '13'
			else '99'
		end*/,
	[client address1] = 
		case when len(c1.l_address1) = 0 then '' else c1.l_address1 end,
	[address 2] = c1.l_address2,
	[address 3] = c1.l_address3,
	[city] = case when len(c1.l_city) = 0 then '' else ltrim(rtrim(isnull(c1.l_city, ''))) end,
	
	[state] = 
		case when len(c1.l_state) = 0 then '' else 
		--ltrim(rtrim(isnull(c1.l_state, ''))) 
		      case	when c1.l_state='ARUNACHAL PRADESH' then 'ARUNACHAL PRADESH' 
					when c1.l_state='ASSAM' then 'ASSAM'
					when c1.l_state='ANDHRA PRADESH' then 'ANDHRA PRADESH'
					when c1.l_state='ANDAMAN AND NICOBAR ISLANDS' then 'ANDAMAN AND NICOBAR'
					when c1.l_state='BIHAR' then 'BIHAR'
					when c1.l_state='CHANDIGARH' then 'CHANDIGARH'  
					when c1.l_state='CHHATISGARH' then 'CHHATTISGARH'
					when c1.l_state='DELHI' then 'DELHI'
					when c1.l_state='DAMAN AND DIU' then 'DAMAN AND DIU'
					when c1.l_state='NAGAR HAVELI' then 'NAGAR HAVELI'   --------------
					when c1.l_state='GUJARAT' then 'GUJARAT'
					when c1.l_state='GOA' then 'GOA'
					when c1.l_state='HIMACHAL PRADESH' then 'HIMACHAL PRADESH'
					when c1.l_state='HARYANA' then 'HARYANA'
					when c1.l_state='JAMMU AND KASHMIR' then 'JAMMU AND KASHMIR'
					when c1.l_state='JHARKHAND' then 'JHARKHAND'
					when c1.l_state='KARNATAKA' then 'KARNATAKA'
					when c1.l_state='KERALA' then 'KERALA'
					when c1.l_state='LAKSHADWEEP' then 'LAKSHADWEEP'
					when c1.l_state='MANIPUR' then 'MANIPUR'
					when c1.l_state='MIZORAM' then 'MIZORAM'
					when c1.l_state='MEGHALAYA' then 'MEGHALAYA'
					when c1.l_state='MADHYA PRADESH' then 'MADHYA PRADESH'
					when c1.l_state='MAHARASHTRA' then 'MAHARASHTRA'
					when c1.l_state='NAGALAND' then 'NAGALAND'
					when c1.l_state='ORISSA' then 'ORISSA'
					when c1.l_state='PUNJAB' then 'PUNJAB'
					when c1.l_state='PONDICHERRY' then 'PUDUCHERRY'
					when c1.l_state='RAJASTHAN' then 'RAJASTHAN'
					when c1.l_state='SIKKIM' then 'SIKKIM'
					when c1.l_state='TRIPURA' then 'TRIPURA'
					when c1.l_state='TAMILNADU' then 'TAMIL NADU'
					when c1.l_state='UTTARANCHAL' then 'UTTARAKHAND'
					when c1.l_state='UTTAR PRADESH' then 'UTTAR PRADESH'
					when c1.l_state='WEST BENGAL' then 'WEST BENGAL'
					else c1.l_state end
		end,
	[country] = c1.l_nation,
	[pin code] =c1.l_zip,
	[telephone number] = 
					case 
							when len(c1.res_phone1) > 0 then c1.res_phone1
							when len(c1.res_phone2) > 0 then c1.res_phone2
							when len(c1.off_phone1) > 0 then c1.off_phone1
							when len(c1.off_phone2) > 0 then c1.off_phone2
						else 
							'' 
						end,
										
					
			
	[client agreement date] = 
		case 
			when replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, isnull(c5.client_agre_dt, ''), 103), '/', '') 
		end,
	[date of birth] = 
		case 
			when  cl_status = 'IND' then
				replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
			else
				''
		end,
	 --	case 
		--	when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' and cl_status <> 'HUF' then
		--		replace(convert(varchar, isnull(c5.birthdate, ''), 103), '/', '') 
		--	else
		--		''
		--end,
	[pan number] = c1.pan_gir_no,
	[ward number] = c1.ward_no,
	[uin] = '',

	[bank name] = 
		isnull((
			select distinct top 1
				ltrim(rtrim(isnull(b.bank_name, ''))) 
			from 
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank branch address] = 
		isnull((
			select distinct top 1
				isnull(ltrim(rtrim(b.branch_name)), '') + ',' + 
				isnull(ltrim(rtrim(b.address1)), '') + ',' + 
				isnull(ltrim(rtrim(b.address2)),'') + ',' + 
				isnull(ltrim(rtrim(b.city)), '') + ',' + 
				isnull(ltrim(rtrim(b.nation)), '')
			from
				angelcommodity.mcdx.dbo.pobank b with(nolock), 
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')
		),''),
	[bank account number] = 
		isnull((select distinct top 1 ltrim(rtrim(isnull(c4.cltdpid, ''))) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),
	[bank account type] = 
		isnull((select distinct ltrim(rtrim(isnull(c4.depository, ''))) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') in ('SAVING', 'SAVINGS', 'CURRENT')),''),

	[depository name (nsdl)] = '',--'NSDL',
	[depository participant id (nsdl)] = '',
		--isnull((select distinct c4.bankid from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),
	[depository participant name (nsdl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = ltrim(rtrim(isnull(b.bankid, ''))) and 
				isnull(c4.depository, '') = 'NSDL' and
				isnull(b.banktype, '') = 'NSDL'
		),''),*/
	[beneficiary account id (nsdl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') =isnull(c2.party_code, '') and isnull(c4.depository, '') = 'NSDL'),''),

	[depository name (cdsl)] = '',--'CDSL',
	[depository participant id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.bankid)) from angelcommodity.mcdx.dbo.client4 c4  with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),
	[depository participant name (cdsl)] = '',
		/*isnull((
			select distinct top 1
				ltrim(rtrim(b.bankname)) 
			from 
				angelcommodity.mcdx.dbo.bank b with(nolock),
				angelcommodity.mcdx.dbo.client4 c4 with(nolock)
			where 
				isnull(c4.party_code, '') = isnull(c2.party_code, '') and 
				isnull(c4.bankid, '') = isnull(b.bankid, '') and 
				isnull(c4.depository, '') = 'CDSL' and
				isnull(b.banktype, '') = 'CDSL'
		),''),*/
	[beneficiary account id (cdsl)] = '',
		--isnull((select distinct ltrim(rtrim(c4.cltdpid)) from angelcommodity.mcdx.dbo.client4 c4 with(nolock) where isnull(c4.party_code, '') = isnull(c2.party_code, '') and isnull(c4.depository, '') = 'CDSL'),''),

	[passport number] = 
		case 
			when c5.passportdtl = '' then '' 
			else c5.passportdtl 
		end,
	[place of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else case when len(c5.passportplaceofissue) = 0 then '' else c5.passportplaceofissue end
		end,
	[date of issue of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportdateofissue, 103), '/', '')
		end,


	[expiry date of passport] = 
		case 
			when c5.passportdtl = '' then ''
			else
			replace(convert(varchar, c5.passportexpdate, 103), '/', '')
		end,
	[driving license number] = 
		case 
			when c5.drivelicendtl = '' then '' 
			else c5.drivelicendtl 
		end,
	[place of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else case when len(c5.licencenoplaceofissue) = 0 then '' else c5.licencenoplaceofissue end
		end,
	[date of issue of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.licencenodateofissue, 103), '/', '') 
		end,
	[expiry date of driving license number] = 
		case 
			when c5.drivelicendtl = '' then ''
			else
			replace(convert(varchar, c5.driveexpdate, 103), '/', '') 
		end,

	[voter id] = 
		case 
			when c5.votersiddtl = '' then '' 
			else c5.votersiddtl 
		end,
	[place of issue of voter id number] = 
		case 
			when c5.votersiddtl= '' then ''
			else case when len(c5.voteridplaceofissue) = 0 then '' else c5.voteridplaceofissue end
		end,
	[date of issue of voter id number] = 
		case 
			when c5.votersiddtl = '' then ''
			else
			replace(convert(varchar, c5.voteriddateofissue, 103), '/', '') 
		end,

	[ration card number] = 
		case 
			when c5.rationcarddtl = '' then '' 
			else c5.rationcarddtl 
		end,
	[place of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else case when len(c5.rationcardplaceofissue) = 0 then '' else c5.rationcardplaceofissue end
		end,
	[date of issue of ration card number] = 
		case 
			when c5.rationcarddtl = '' then ''
			else
			replace(convert(varchar, c5.rationcarddateofissue, 103), '/', '') 
		end,

	--[registration number of client] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else ltrim(rtrim(isnull(c5.regr_no, '')))
	--	end,
	--[registering authority] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_auth, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_auth, ''))) end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else case when len(ltrim(rtrim(isnull(c5.regr_place, '')))) = 0 then 'N.A' else ltrim(rtrim(isnull(c5.regr_place, ''))) end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when ltrim(rtrim(isnull(cl_type, ''))) = 'CLI' then ''
	--		else
	--			case 
	--				when ltrim(rtrim(isnull(c5.regr_no, ''))) = '' then ''
	--				else
	--				replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '') 
	--			end
	--		end,
	
	--[registration number of client] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else c5.regr_no
	--	end,
	--[registering authority] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
	--			end
	--		end,
	--[place of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
	--			end
	--		end,
	--[date of registration] = 
	--	case 
	--		when cl_status = 'IND' then ''
	--		else
	--			case 
	--				when c5.regr_no = '' then ''
	--				else
	--				replace(convert(varchar, c5.regr_date, 103), '/', '') 
	--			end
	--		end,
	[registration number of client] =
		case 
			when cl_status <> 'PPB' then ''
			else c5.regr_no
		end,
	[registering authority] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_auth) = 0 then '' else c5.regr_auth end
				end
			end,
	[place of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else case when len(c5.regr_place) = 0 then '' else c5.regr_place end
				end
			end,
	[date of registration] = 
		case 
			when cl_status <> 'PPB' then ''
			else
				case 
					when c5.regr_no = '' then ''
					else
					replace(convert(varchar, c5.regr_date, 103), '/', '') 
				end
			end,
	[introducers name] = 
		c5.introducer,
	[introducers client id] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_client_id) = 0 then '' else c5.introd_client_id end
		end,
	[relationship with the introducer] = 
		case 
			when c5.introducer = '' then ''
			else case when len(c5.introd_relation) = 0 then '' else c5.introd_relation end
		end,

	[dealing with other member] = 
		case 
			when c5.dealing_with_othrer_tm = '' then 'N'
			when c5.dealing_with_othrer_tm = 'N' then 'N'
			else 'Y'
		end,

	[relationship code] = '',

	[status] =2, /*Modify on 28 May 2014*/
	 /*case
		when
		/*Modified on 26 May 2014*/
			c5.activefrom >= @@FromDate
			and c5.activefrom <= @@ToDate
			and c5.inactivefrom>=@@getdate
			/*c5.activefrom <= @to_date + ' 23:59:00'
			and c5.inactivefrom >= @from_date + ' 00:00:00'*/
		then
			1		/*ACTIVE*/
		else
			2		/*INACTIVE*/
		end*/
	[flag] = 'E', 	
	sms_email_status='0',
	mobile_number='',--(select isnull(mobile_pager,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code) ,
	email_id='',--(select isnull(email,'') from anand1.msajag.dbo.client_details c12 with(nolock) where c12.cl_code = c1.cl_code),
	reserved='',
	reserved1='',
	reserved2=''

from
	#temp_client1 c1 with(nolock),
	#temp_client2 c2 with(nolock),
	#temp_client5 c5 with(nolock)
	
	
where
		
	ltrim(rtrim(isnull(c1.cl_code, ''))) = ltrim(rtrim(isnull(c2.cl_code, '')))
	and ltrim(rtrim(isnull(c2.cl_code, ''))) = ltrim(rtrim(isnull(c5.cl_code, '')))
	

	
	





	
	
	
	update
		#mimansa_angel_mcx_client_data_new
	set
		#mimansa_angel_mcx_client_data_new.[category]
										= case when ltrim(rtrim(c1.cl_status))='IND' then '01'
									      when ltrim(rtrim(c1.cl_status))='NRI' then '02' 	 
									      when ltrim(rtrim(c1.cl_status))='SB' then '03' 	 
									      when ltrim(rtrim(c1.cl_status))='FLL' then '04'
									      when ltrim(rtrim(c1.cl_status))='OCB' then '05'
									      when ltrim(rtrim(c1.cl_status))='MF' then '06'
									      when ltrim(rtrim(c1.cl_status))='DFN' then '07'
									      when ltrim(rtrim(c1.cl_status))='PPB' then '13'
									      when ltrim(rtrim(c1.cl_status))='PF' then '15'
									      when ltrim(rtrim(c1.cl_status))='HUF' then '16'
									      when ltrim(rtrim(c1.cl_status))='TS' then '17'
									      when ltrim(rtrim(c1.cl_status))='DFI' then '18'
									      when ltrim(rtrim(c1.cl_status))='BA' then '19'
									      when ltrim(rtrim(c1.cl_status))='IC' then '20'
										  else '99' end,
		mobile_number=isnull(mobile_pager,''),
		email_id=isnull(email,'')									  
	from
		anand1.msajag.dbo.client_details c1 with(nolock)
	where
		c1.cl_code = #mimansa_angel_mcx_client_data_new.[client code]
		and len(isnull(c1.cl_code, '')) > 0
		and len(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')) > 0	
	
	

--anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA Table flag values	
--Email			:	1
--SMS			:	2
--SMS & Email	:	3

--BSE required format
--SMS			:	1
--Email			:	2
--SMS & Email	:	3
--None			:	0
	
	 update
		#mimansa_angel_mcx_client_data_new
	set
		sms_email_status = 
		case when ltrim(rtrim(TYPEOFFACILITY))=1 then '2'  
		 when ltrim(rtrim(TYPEOFFACILITY))=2 then '1' 
		 when ltrim(rtrim(TYPEOFFACILITY))=3 then '3' 
	     else  '0' end
	    
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ltrim(rtrim(c1.party_code)) = ltrim(rtrim(#mimansa_angel_mcx_client_data_new.[client code]))
		and len(ltrim(rtrim(isnull(c1.party_code, '')))) > 0
		and len(ltrim(rtrim(isnull(#mimansa_angel_mcx_client_data_new.[client code], '')))) > 0
		
		--select * from #mimansa_angel_mcx_client_data_new
	


--only_select:

delete
	#mimansa_angel_mcx_client_data_new
from
	--[196.1.115.239].inhouse.dbo.AllSebiBannedEntities bp with (nolock)
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	--ltrim(rtrim(replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', ''))) = ltrim(rtrim(isnull(bp.pan_no, '')))
	replace(isnull(#mimansa_angel_mcx_client_data_new.[pan number], ''), ',', '') = ltrim(rtrim(isnull(bp.panno, '')))
	and len(bp.panno)=10	
	
	

select distinct
	[client code] = ltrim(rtrim(replace(isnull([client code], ''), ',', ''))),
	[client first name] = left(ltrim(rtrim(replace(isnull([client first name], ''), ',', ''))), 100),
	[middle name] = left(ltrim(rtrim(replace(isnull([middle name], ''), ',', ''))), 20),
	[last name] = left(ltrim(rtrim(replace(isnull([last name], ''), ',', ''))), 20),
	[category] = ltrim(rtrim(replace(isnull([category], ''), ',', ''))),
	[client address1] = left(ltrim(rtrim(replace(isnull([client address1], ''), ',', ''))), 75),
	[address 2] = left(ltrim(rtrim(replace(isnull([address 2], ''), ',', ''))), 75),
	[address 3] = left(ltrim(rtrim(replace(isnull([address 3], ''), ',', ''))), 50),
	[city] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([city], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([city], ''), ',', '')))
			end
			, 20
		),
	[state] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([state], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([state], ''), ',', '')))
			end
			, 20
		),
	[country] = 
		left(
			case 
				when len(ltrim(rtrim(replace(isnull([country], ''), ',', '')))) = 0 then ''
				else ltrim(rtrim(replace(isnull([country], ''), ',', '')))
			end
			, 15
		),
	[pin code] = 
		case
			when 
				isnumeric (
					left(
						case 
							when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
							else ltrim(rtrim(
								replace(
									replace(isnull([pin code], ''), ',', '')
									, space(1), ''
								)
							))
						end
						, 6
					)
				) = 1 
			then
				left(
					case 
						when len(ltrim(rtrim(replace(isnull([pin code], ''), ',', '')))) = 0 then replace(space(6), space(1), '0')
						else ltrim(rtrim(
							replace(
								replace(isnull([pin code], ''), ',', '')
								, space(1), ''
							)
						))
					end
					, 6
				)
			else
				replace(space(6), space(1), '0')
			end,
	[telephone number] = left(ltrim(rtrim(replace(isnull([telephone number], ''), ',', ''))), 25),
	[client agreement date] = ltrim(rtrim(replace(isnull([client agreement date], ''), ',', ''))),
	[date of birth] = ltrim(rtrim(replace(isnull([date of birth], ''), ',', ''))),
	[pan number] = left(ltrim(rtrim(replace(isnull([pan number], ''), ',', ''))), 25),
	[ward number] = left(ltrim(rtrim(replace(isnull([ward number], ''), ',', ''))), 25),
	[uin] = left(ltrim(rtrim(replace(isnull([uin], ''), ',', ''))), 15),
	[bank name] = left(ltrim(rtrim(replace(isnull([bank name], ''), ',', ''))), 60),
	[bank branch address] = left(ltrim(rtrim(replace(isnull([bank branch address], ''), ',', ''))), 255),
	[bank account number] = left(ltrim(rtrim(replace(isnull([bank account number], ''), ',', ''))), 25),
	[bank account type] = 
		case when 
			len(ltrim(rtrim(replace(isnull([bank account number], ''), ',', '')))) > 0 then
				case 
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) like 'SAVING%' then '10'
					when ltrim(rtrim(replace(isnull([bank account type], ''), ',', ''))) = 'CURRENT' then '11'
					else '99'
				end
			else ''
		end,
	[depository name (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (nsdl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (nsdl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))
									else ''
								end
							) > 0
						then ''
						else ''
					end
				end
			, 25
		),
	[beneficiary account id (nsdl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (nsdl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (nsdl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (nsdl)], ''), ',', '')))
				else ''
			end,
			8
		),

	[depository name (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant id (cdsl)] = 
		case 
			when (
				(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
				(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
			)
			then
				ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))
			else ''
		end,
	[depository participant name (cdsl)] = 
		left(
			case
				when
					len(
						case 
							when (
								(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
								(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
							)
							then
								left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
							else ''
						end
					) > 0 
				then
					case 
						when (
							(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
							(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
						)
						then
							left(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', ''))), 25)
						else ''
					end
				else
					case 
						when
							len(
								case 
									when (
										(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0) or
										(len(ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))) > 0)
									)
									then
										ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))
									else ''
								end
							) > 0 
						then
							'N.A' else 
						'' 
					end
				end
			, 25
		),
	[beneficiary account id (cdsl)] = 
		right(
			case 
				when (
					(len(ltrim(rtrim(replace(isnull([depository name (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant id (cdsl)], ''), ',', '')))) > 0) or
					(len(ltrim(rtrim(replace(isnull([depository participant name (cdsl)], ''), ',', '')))) > 0)
				)
				then
					ltrim(rtrim(replace(isnull([beneficiary account id (cdsl)], ''), ',', '')))
				else ''
			end
			, 8
		),

	[passport number] = left(ltrim(rtrim(replace(isnull([passport number], ''), ',', ''))), 25),
	[place of issue of passport] = left(ltrim(rtrim(replace(isnull([place of issue of passport], ''), ',', ''))), 25),
	[date of issue of passport] = ltrim(rtrim(replace(isnull([date of issue of passport], ''), ',', ''))),
	[expiry date of passport] = ltrim(rtrim(replace(isnull([expiry date of passport], ''), ',', ''))),

	[driving license number] = left(ltrim(rtrim(replace(isnull([driving license number], ''), ',', ''))), 25),
	[place of issue of driving license number] = left(ltrim(rtrim(replace(isnull([place of issue of driving license number], ''), ',', ''))), 25),
	[date of issue of driving license number] = ltrim(rtrim(replace(isnull([date of issue of driving license number], ''), ',', ''))),
	[expiry date of driving license number] = ltrim(rtrim(replace(isnull([expiry date of driving license number], ''), ',', ''))),

	[voter id] = left(ltrim(rtrim(replace(isnull([voter id], ''), ',', ''))), 25),
	[place of issue of voter id number] = left(ltrim(rtrim(replace(isnull([place of issue of voter id number], ''), ',', ''))), 25),
	[date of issue of voter id number] = ltrim(rtrim(replace(isnull([date of issue of voter id number], ''), ',', ''))),

	[ration card number] = left(ltrim(rtrim(replace(isnull([ration card number], ''), ',', ''))), 25),
	[place of issue of ration card number] = left(ltrim(rtrim(replace(isnull([place of issue of ration card number], ''), ',', ''))), 25),
	[date of issue of ration card number] = ltrim(rtrim(replace(isnull([date of issue of ration card number], ''), ',', ''))),

	[registration number of client] = left(ltrim(rtrim(replace(isnull([registration number of client], ''), ',', ''))), 25),
	[registering authority] = left(ltrim(rtrim(replace(isnull([registering authority], ''), ',', ''))), 60),
	[place of registration] = left(ltrim(rtrim(replace(isnull([place of registration], ''), ',', ''))), 25),
	[date of registration] = ltrim(rtrim(replace(isnull([date of registration], ''), ',', ''))),

	[introducers name] = left(ltrim(rtrim(replace(isnull([introducers name], ''), ',', ''))), 60),
	[introducers client id] = ltrim(rtrim(replace(isnull([introducers client id], ''), ',', ''))),
	[relationship with the introducer] = left(ltrim(rtrim(replace(isnull([relationship with the introducer], ''), ',', ''))), 25),

	[dealing with other member] = ltrim(rtrim(replace(isnull([dealing with other member], ''), ',', ''))),

	[relationship code] = ltrim(rtrim(replace(isnull([relationship code], ''), ',', ''))),

	[status] = ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	sms_email_status=ltrim(rtrim(replace(isnull(sms_email_status, ''), ',', ''))),
	mobile_number=ltrim(rtrim(replace(isnull(mobile_number, ''), ',', ''))),
	email_id=ltrim(rtrim(replace(isnull(email_id, ''), ',', ''))),
	reserved=reserved,
	reserved=reserved1,
	reserved=reserved2,
	[flag] = [flag]

from

--	#_temp_mcx_client_data
	#mimansa_angel_mcx_client_data_new

where
	--len(ltrim(rtrim(replace(isnull([client code], ''), ',', '')))) > 0
	--and 
	(
		len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	)

order by
	ltrim(rtrim(replace(isnull([status], ''), ',', ''))),
	ltrim(rtrim(replace(isnull([client code], ''), ',', '')))



/*****ROW COUNT****/
declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_angel_mcx_client_data_new with(nolock)	
where len(ltrim(rtrim(isnull([pan number], '')))) > 0 or
		len(ltrim(rtrim(isnull([passport number], '')))) > 0 or
		len(ltrim(rtrim(isnull([driving license number], '')))) > 0 or
		len(ltrim(rtrim(isnull([voter id], '')))) > 0 or
		len(ltrim(rtrim(isnull([ration card number], '')))) > 0
	
/*Display File Name and First Row
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,22
				Ex- 10,M,12685,14052014,01,22
*/

select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_Inactive_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 



/*DISPLAY INVALID PAN*/
select Client_Code='',Client_Name='',PAN=''  where 1=0
--from #invalidpan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_Inactive_clients_data_RITESH
-- --------------------------------------------------
CREATE proc [dbo].[usp_mimansa_ucc_mcx_Inactive_clients_data_RITESH] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(100),regr_place varchar(100),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
			
				 else
					P_state
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_city = 'HYDERABAD' then 'ANDHRA PRADESH' /* Added on 12/09/2017 mail from Ajay Gupta   */
				
				 else
					L_state
				 end	,	
	P_state= case when   P_City ='HYDERABAD' then 'ANDHRA PRADESH' 
			
				 else
					P_state
				 end	





	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](20) NULL,
	[ClientName] [varchar](250) NULL,
	[Category] [varchar](20) NULL,
	[PAN] [varchar](20) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](250) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](10) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](150) NULL,
	[Address1Corresponding] [varchar](355) NULL,
	[Address2Corresponding] [varchar](355) NULL,
	[Address3Corresponding] [varchar](355) NULL,
	[CountryCorresponding] [varchar](30) NULL,
	[StateCityCodeCorresponding] [varchar](60) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](5) NULL,
	[Address1Permanent] [varchar](355) NULL,
	[Address2Permanent] [varchar](355) NULL,
	[Address3Permanent] [varchar](355) NULL,
	[CountryPermanent] [varchar](30) NULL,
	[StateCityCodePermanent] [varchar](60) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](15) NULL,
	[UIDNumber] [varchar](200) NULL,
	[BankName1] [varchar](100) NULL,
	[BankBranchAddress1] [varchar](355) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](50) NULL,
	[BankName2] [varchar](100) NULL,
	[BankBranchAddress2] [varchar](355) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](50) NULL,
	[BankName3] [varchar](100) NULL,
	[BankBranchAddress3] [varchar](355) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](50) NULL,
	[DepositoryName1] [varchar](50) NULL,
	[DepositoryId1] [varchar](80) NULL,
	[BeneficiaryAccountID1] [varchar](160) NULL,
	[DepositoryName2] [varchar](10) NULL,
	[DepositoryId2] [varchar](80) NULL,
	[BeneficiaryAccountID2] [varchar](160) NULL,
	[DepositoryName3] [varchar](100) NULL,
	[DepositoryId3] [varchar](80) NULL,
	[BeneficiaryAccountID3] [varchar](160) NULL,
	[CIN] [varchar](210) NULL,
	[PlaceofIncorporation] [varchar](750) NULL,
	[Occupation] [varchar](20) NULL,
	[OccupationDetailsForOthers] [varchar](150) NULL,
	[Dateofcommencementofbusiness] [varchar](80) NULL,
	[IncomedetailsperannuminRs] [varchar](20) NULL,
	[Incomeasondate] [varchar](80) NULL,
	[NetworthRs] [varchar](180) NULL,
	[Networthasondate] [varchar](80) NULL,
	[PoliticallyexposedpersonPEP] [varchar](10) NULL,
	[CPCode] [varchar](150) NULL,
	[RegistrationNumberofClient] [varchar](500) NULL,
	[RegisteringAuthority] [varchar](600) NULL,
	[PlaceofRegistration] [varchar](500) NULL,
	[DateofRegistration] [varchar](80) NULL,
	[InpersonVerification] [varchar](100) NULL,
	[ClientAgreementDate] [varchar](800) NULL,
	[Reserved] [varchar](500) NULL,
	[RelationshipCode] [varchar](100) NULL,
	[ProofType] [varchar](200) NULL,
	[ProofNumber] [varchar](250) NULL,
	[IssuePlaceofProof] [varchar](500) NULL,
	[IssueDateofProof] [varchar](800) NULL,
	[ClientStatus] [varchar](100) NULL,
	[Remarks] [varchar](300) NULL,
	[ClientTypeCorporate] [varchar](100) NULL,
	[NameofContactPerson1] [varchar](500) NULL,
	[DesignationofContactPerson1] [varchar](500) NULL,
	[PANofcontactPerson1] [varchar](500) NULL,
	[AddressofContactPerson1] [varchar](555) NULL,
	[ContactDetailsofContactPerson1] [varchar](500) NULL,
	[DINofContactPerson1] [varchar](500) NULL,
	[UIDofContactPerson1] [varchar](500) NULL,
	[EmailIdofContactPerson1] [varchar](500) NULL,
	[NameofContactPerson2] [varchar](500) NULL,
	[DesignationofContactPerson2] [varchar](500) NULL,
	[PANofcontactPerson2] [varchar](500) NULL,
	[AddressofContactPerson2] [varchar](555) NULL,
	[ContactDetailsofContactPerson2] [varchar](500) NULL,
	[DINofContactPerson2] [varchar](500) NULL,
	[UIDofContactPerson2] [varchar](500) NULL,
	[EmailIdofContactPerson2] [varchar](500) NULL,
	[NameofContactPerson3] [varchar](500) NULL,
	[DesignationofContactPerson3] [varchar](500) NULL,
	[PANofcontactPerson3] [varchar](500) NULL,
	[AddressofContactPerson3] [varchar](555) NULL,
	[ContactDetailsofContactPerson3] [varchar](500) NULL,
	[DINofContactPerson3] [varchar](500) NULL,
	[UIDofContactPerson3] [varchar](500) NULL,
	[EmailIdofContactPerson3] [varchar](500) NULL,
	[NameofContactPerson4] [varchar](500) NULL,
	[DesignationofContactPerson4] [varchar](500) NULL,
	[PANofcontactPerson4] [varchar](500) NULL,
	[AddressofContactPerson4] [varchar](555) NULL,
	[ContactDetailsofContactPerson4] [varchar](500) NULL,
	[DINofContactPerson4] [varchar](500) NULL,
	[UIDofContactPerson4] [varchar](500) NULL,
	[EmailIdofContactPerson4] [varchar](500) NULL,
	[NameofContactPerson5] [varchar](500) NULL,
	[DesignationofContactPerson5] [varchar](500) NULL,
	[PANofcontactPerson5] [varchar](500) NULL,
	[AddressofContactPerson5] [varchar](555) NULL,
	[ContactDetailsofContactPerson5] [varchar](500) NULL,
	[DINofContactPerson5] [varchar](500) NULL,
	[UIDofContactPerson5] [varchar](500) NULL,
	[EmailIdofContactPerson5] [varchar](500) NULL,
	[NameofContactPerson6] [varchar](500) NULL,
	[DesignationofContactPerson6] [varchar](500) NULL,
	[PANofcontactPerson6] [varchar](500) NULL,
	[AddressofContactPerson6] [varchar](555) NULL,
	[ContactDetailsofContactPerson6] [varchar](500) NULL,
	[DINofContactPerson6] [varchar](500) NULL,
	[UIDofContactPerson6] [varchar](500) NULL,
	[EmailIdofContactPerson6] [varchar](500) NULL,
	[NameofContactPerson7] [varchar](500) NULL,
	[DesignationofContactPerson7] [varchar](500) NULL,
	[PANofcontactPerson7] [varchar](500) NULL,
	[AddressofContactPerson7] [varchar](555) NULL,
	[ContactDetailsofContactPerson7] [varchar](500) NULL,
	[DINofContactPerson7] [varchar](500) NULL,
	[UIDofContactPerson7] [varchar](500) NULL,
	[EmailIdofContactPerson7] [varchar](500) NULL,
	[NameofContactPerson8] [varchar](500) NULL,
	[DesignationofContactPerson8] [varchar](500) NULL,
	[PANofcontactPerson8] [varchar](500) NULL,
	[AddressofContactPerson8] [varchar](555) NULL,
	[ContactDetailsofContactPerson8] [varchar](500) NULL,
	[DINofContactPerson8] [varchar](500) NULL,
	[UIDofContactPerson8] [varchar](500) NULL,
	[EmailIdofContactPerson8] [varchar](500) NULL,
	[NameofContactPerson9] [varchar](500) NULL,
	[DesignationofContactPerson9] [varchar](500) NULL,
	[PANofcontactPerson9] [varchar](500) NULL,
	[AddressofContactPerson9] [varchar](555) NULL,
	[ContactDetailsofContactPerson9] [varchar](500) NULL,
	[DINofContactPerson9] [varchar](500) NULL,
	[UIDofContactPerson9] [varchar](500) NULL,
	[EmailIdofContactPerson9] [varchar](500) NULL,
	[NameofContactPerson10] [varchar](500) NULL,
	[DesignationofContactPerson10] [varchar](500) NULL,
	[PANofcontactPerson10] [varchar](500) NULL,
	[AddressofContactPerson10] [varchar](555) NULL,
	[ContactDetailsofContactPerson10] [varchar](500) NULL,
	[DINofContactPerson10] [varchar](500) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	--[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	--[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	--[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	--[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1= /* 'Branch address ' + */  Replace(c1_b.bank_address,',',' '),  --Removed On Nov 17 2014 Aniket Mail
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='2',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='Account Closure',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	--[RelatiomshipwithclientforMobile]='',
	--[NameoftheAuthorisedOrContactpersonforMobile]='',
	--[RelatiomshipwithclientforEmail]='',
	--[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end, --26 Mar 2014
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 		
			IncomedetailsperannuminRs='02', 
			Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where Incomeasondate=''
		and m.ClientCode= t.cl_code

		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 				
			Incomeasondate='25032013' 
		from #mimansa_ucc_mcx_currency_client_data m
		where  
		len(Incomeasondate)>0
		and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'



/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
--update #mimansa_ucc_mcx_currency_client_data set
--[RelatiomshipwithclientforMobile]=case when RELATION_CLIENT_MOBILE=1 then 'Self'
--									when RELATION_CLIENT_MOBILE=2 then 'Spouse'
--									when RELATION_CLIENT_MOBILE=3 then 'Dependent Children'
--									when RELATION_CLIENT_MOBILE=4 then 'Dependent Parent'
--									else '' end,
--[NameoftheAuthorisedOrContactpersonforMobile]=CONTACT_PERSON_NAME_MOBILE,
--[RelatiomshipwithclientforEmail]=case when RELATION_CLIENT_EMAIL=1 then 'Self'
--									when RELATION_CLIENT_EMAIL=2 then 'Spouse'
--									when RELATION_CLIENT_EMAIL=3 then 'Dependent Children'
--									when RELATION_CLIENT_EMAIL=4 then 'Dependent Parent'
--									else '' end,
--[NameoftheAuthorisedOrContactpersonforEmail]=CONTACT_PERSON_NAME_EMAIL
--from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
--where ClientCode = BOPARTYCODE




select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	='',   ---Changed To Blank on Nov 17 2014 Mail From Aniket
FathersHusbandsGuardiansName	= '', --Changed To Blank Nov 17 2014  Mail from Aniket,
MaritalStatus= ''	,--Changed To Blank Nov 17 2014  Mail from Aniket
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	, --Changed Mail from Aniket Nov 17 2014
BankAccountNumber1	, --Changed Mail from Aniket Nov 17 2014
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation =''	, --Changed To Blank Nov 17 2014  Mail from Aniket
OccupationDetailsForOthers	='', --Changed to Blank Nov 17 2014  Mail from Aniket
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs =''	,--Changed to Blank Nov 17 2014  Mail from Aniket
Incomeasondate	='', --Changed to Blank Nov 17 2014  Mail from Aniket
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	= 'Account Closure', --Changed to from commented Nov 17 2014  Mail from Aniket
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
--[RelatiomshipwithclientforMobile],
--[NameoftheAuthorisedOrContactpersonforMobile],
--[RelatiomshipwithclientforEmail],
--[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
--Display File Name and First Row
/*
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_Inactive_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_Inactive_clients_data_RITESH_backup_30Nov2017
-- --------------------------------------------------

CREATE proc [dbo].[usp_mimansa_ucc_mcx_Inactive_clients_data_RITESH_backup_30Nov2017] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(100),regr_place varchar(100),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
			
				 else
					P_state
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_city = 'HYDERABAD' then 'ANDHRA PRADESH' /* Added on 12/09/2017 mail from Ajay Gupta   */
				
				 else
					L_state
				 end	,	
	P_state= case when   P_City ='HYDERABAD' then 'ANDHRA PRADESH' 
			
				 else
					P_state
				 end	





	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](20) NULL,
	[ClientName] [varchar](250) NULL,
	[Category] [varchar](20) NULL,
	[PAN] [varchar](20) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](250) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](10) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](150) NULL,
	[Address1Corresponding] [varchar](355) NULL,
	[Address2Corresponding] [varchar](355) NULL,
	[Address3Corresponding] [varchar](355) NULL,
	[CountryCorresponding] [varchar](30) NULL,
	[StateCityCodeCorresponding] [varchar](60) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](5) NULL,
	[Address1Permanent] [varchar](355) NULL,
	[Address2Permanent] [varchar](355) NULL,
	[Address3Permanent] [varchar](355) NULL,
	[CountryPermanent] [varchar](30) NULL,
	[StateCityCodePermanent] [varchar](60) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](15) NULL,
	[UIDNumber] [varchar](200) NULL,
	[BankName1] [varchar](100) NULL,
	[BankBranchAddress1] [varchar](355) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](50) NULL,
	[BankName2] [varchar](100) NULL,
	[BankBranchAddress2] [varchar](355) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](50) NULL,
	[BankName3] [varchar](100) NULL,
	[BankBranchAddress3] [varchar](355) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](50) NULL,
	[DepositoryName1] [varchar](50) NULL,
	[DepositoryId1] [varchar](80) NULL,
	[BeneficiaryAccountID1] [varchar](160) NULL,
	[DepositoryName2] [varchar](10) NULL,
	[DepositoryId2] [varchar](80) NULL,
	[BeneficiaryAccountID2] [varchar](160) NULL,
	[DepositoryName3] [varchar](100) NULL,
	[DepositoryId3] [varchar](80) NULL,
	[BeneficiaryAccountID3] [varchar](160) NULL,
	[CIN] [varchar](210) NULL,
	[PlaceofIncorporation] [varchar](750) NULL,
	[Occupation] [varchar](20) NULL,
	[OccupationDetailsForOthers] [varchar](150) NULL,
	[Dateofcommencementofbusiness] [varchar](80) NULL,
	[IncomedetailsperannuminRs] [varchar](20) NULL,
	[Incomeasondate] [varchar](80) NULL,
	[NetworthRs] [varchar](180) NULL,
	[Networthasondate] [varchar](80) NULL,
	[PoliticallyexposedpersonPEP] [varchar](10) NULL,
	[CPCode] [varchar](150) NULL,
	[RegistrationNumberofClient] [varchar](500) NULL,
	[RegisteringAuthority] [varchar](600) NULL,
	[PlaceofRegistration] [varchar](500) NULL,
	[DateofRegistration] [varchar](80) NULL,
	[InpersonVerification] [varchar](100) NULL,
	[ClientAgreementDate] [varchar](800) NULL,
	[Reserved] [varchar](500) NULL,
	[RelationshipCode] [varchar](100) NULL,
	[ProofType] [varchar](200) NULL,
	[ProofNumber] [varchar](250) NULL,
	[IssuePlaceofProof] [varchar](500) NULL,
	[IssueDateofProof] [varchar](800) NULL,
	[ClientStatus] [varchar](100) NULL,
	[Remarks] [varchar](300) NULL,
	[ClientTypeCorporate] [varchar](100) NULL,
	[NameofContactPerson1] [varchar](500) NULL,
	[DesignationofContactPerson1] [varchar](500) NULL,
	[PANofcontactPerson1] [varchar](500) NULL,
	[AddressofContactPerson1] [varchar](555) NULL,
	[ContactDetailsofContactPerson1] [varchar](500) NULL,
	[DINofContactPerson1] [varchar](500) NULL,
	[UIDofContactPerson1] [varchar](500) NULL,
	[EmailIdofContactPerson1] [varchar](500) NULL,
	[NameofContactPerson2] [varchar](500) NULL,
	[DesignationofContactPerson2] [varchar](500) NULL,
	[PANofcontactPerson2] [varchar](500) NULL,
	[AddressofContactPerson2] [varchar](555) NULL,
	[ContactDetailsofContactPerson2] [varchar](500) NULL,
	[DINofContactPerson2] [varchar](500) NULL,
	[UIDofContactPerson2] [varchar](500) NULL,
	[EmailIdofContactPerson2] [varchar](500) NULL,
	[NameofContactPerson3] [varchar](500) NULL,
	[DesignationofContactPerson3] [varchar](500) NULL,
	[PANofcontactPerson3] [varchar](500) NULL,
	[AddressofContactPerson3] [varchar](555) NULL,
	[ContactDetailsofContactPerson3] [varchar](500) NULL,
	[DINofContactPerson3] [varchar](500) NULL,
	[UIDofContactPerson3] [varchar](500) NULL,
	[EmailIdofContactPerson3] [varchar](500) NULL,
	[NameofContactPerson4] [varchar](500) NULL,
	[DesignationofContactPerson4] [varchar](500) NULL,
	[PANofcontactPerson4] [varchar](500) NULL,
	[AddressofContactPerson4] [varchar](555) NULL,
	[ContactDetailsofContactPerson4] [varchar](500) NULL,
	[DINofContactPerson4] [varchar](500) NULL,
	[UIDofContactPerson4] [varchar](500) NULL,
	[EmailIdofContactPerson4] [varchar](500) NULL,
	[NameofContactPerson5] [varchar](500) NULL,
	[DesignationofContactPerson5] [varchar](500) NULL,
	[PANofcontactPerson5] [varchar](500) NULL,
	[AddressofContactPerson5] [varchar](555) NULL,
	[ContactDetailsofContactPerson5] [varchar](500) NULL,
	[DINofContactPerson5] [varchar](500) NULL,
	[UIDofContactPerson5] [varchar](500) NULL,
	[EmailIdofContactPerson5] [varchar](500) NULL,
	[NameofContactPerson6] [varchar](500) NULL,
	[DesignationofContactPerson6] [varchar](500) NULL,
	[PANofcontactPerson6] [varchar](500) NULL,
	[AddressofContactPerson6] [varchar](555) NULL,
	[ContactDetailsofContactPerson6] [varchar](500) NULL,
	[DINofContactPerson6] [varchar](500) NULL,
	[UIDofContactPerson6] [varchar](500) NULL,
	[EmailIdofContactPerson6] [varchar](500) NULL,
	[NameofContactPerson7] [varchar](500) NULL,
	[DesignationofContactPerson7] [varchar](500) NULL,
	[PANofcontactPerson7] [varchar](500) NULL,
	[AddressofContactPerson7] [varchar](555) NULL,
	[ContactDetailsofContactPerson7] [varchar](500) NULL,
	[DINofContactPerson7] [varchar](500) NULL,
	[UIDofContactPerson7] [varchar](500) NULL,
	[EmailIdofContactPerson7] [varchar](500) NULL,
	[NameofContactPerson8] [varchar](500) NULL,
	[DesignationofContactPerson8] [varchar](500) NULL,
	[PANofcontactPerson8] [varchar](500) NULL,
	[AddressofContactPerson8] [varchar](555) NULL,
	[ContactDetailsofContactPerson8] [varchar](500) NULL,
	[DINofContactPerson8] [varchar](500) NULL,
	[UIDofContactPerson8] [varchar](500) NULL,
	[EmailIdofContactPerson8] [varchar](500) NULL,
	[NameofContactPerson9] [varchar](500) NULL,
	[DesignationofContactPerson9] [varchar](500) NULL,
	[PANofcontactPerson9] [varchar](500) NULL,
	[AddressofContactPerson9] [varchar](555) NULL,
	[ContactDetailsofContactPerson9] [varchar](500) NULL,
	[DINofContactPerson9] [varchar](500) NULL,
	[UIDofContactPerson9] [varchar](500) NULL,
	[EmailIdofContactPerson9] [varchar](500) NULL,
	[NameofContactPerson10] [varchar](500) NULL,
	[DesignationofContactPerson10] [varchar](500) NULL,
	[PANofcontactPerson10] [varchar](500) NULL,
	[AddressofContactPerson10] [varchar](555) NULL,
	[ContactDetailsofContactPerson10] [varchar](500) NULL,
	[DINofContactPerson10] [varchar](500) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1= /* 'Branch address ' + */  Replace(c1_b.bank_address,',',' '),  --Removed On Nov 17 2014 Aniket Mail
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='2',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='Account Closure',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[196.1.115.132].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end, --26 Mar 2014
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 		
			IncomedetailsperannuminRs='02', 
			Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where Incomeasondate=''
		and m.ClientCode= t.cl_code

		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 				
			Incomeasondate='25032013' 
		from #mimansa_ucc_mcx_currency_client_data m
		where  
		len(Incomeasondate)>0
		and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	='',   ---Changed To Blank on Nov 17 2014 Mail From Aniket
FathersHusbandsGuardiansName	= '', --Changed To Blank Nov 17 2014  Mail from Aniket,
MaritalStatus= ''	,--Changed To Blank Nov 17 2014  Mail from Aniket
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	, --Changed Mail from Aniket Nov 17 2014
BankAccountNumber1	, --Changed Mail from Aniket Nov 17 2014
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation =''	, --Changed To Blank Nov 17 2014  Mail from Aniket
OccupationDetailsForOthers	='', --Changed to Blank Nov 17 2014  Mail from Aniket
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs =''	,--Changed to Blank Nov 17 2014  Mail from Aniket
Incomeasondate	='', --Changed to Blank Nov 17 2014  Mail from Aniket
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	= 'Account Closure', --Changed to from commented Nov 17 2014  Mail from Aniket
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
--Display File Name and First Row
/*
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_Inactive_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_Inactive_clients_data_RITESH_test_PSB
-- --------------------------------------------------

CREATE proc [dbo].[usp_mimansa_ucc_mcx_Inactive_clients_data_RITESH_test_PSB] (
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20),
	--@selected_clients_only char(1),
	@processid varchar(50)
)

as

/*
exec usp_mimansa_ucc_mcx_client_data_RITESH 'Jun 27 2014','Jun 27 2014','',''
*/
/*Parameter Vertualization*/
	Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

/*Initialized Parameters*/
	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

/*Table variable for Selected clients*/
	create table #temp_client5(cl_code varchar(20),client_agre_dt datetime, regr_no varchar(50),regr_auth varchar(100),regr_place varchar(100),regr_date datetime,activefrom datetime,inactivefrom datetime) 


if isnull(@processid,'')=''
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode			
			/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
			and c5.inactivefrom >@@getdate /*>=@@FromDate Change on 16 Apr 2014, UCC reporting from Offline to Online (Futures / Currency / Commodity Segments)*/
			and c5.activefrom >=@@FromDate
			and c5.activefrom <= @@ToDate
end
else
begin
		insert into #temp_client5
		select c5.cl_code,client_agre_dt,regr_no,regr_auth,regr_place,regr_date,activefrom,inactivefrom  
		from angelcommodity.mcdx.dbo.client5 c5 with(nolock),tblUCCClientCode A with(nolock)
		where			
			c5.cl_code=A.party_code
			and c5.cl_code>=@@FromClientCode
			and c5.cl_code<=@@ToClientCode
			and A.processid=@processid		

		/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	
end

/*********************************************************************************/

select
		--party_code = ltrim(rtrim(c2.party_code)),
		--c1.*
		Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
		Short_Name=ltrim(rtrim(isnull(Short_Name,''))),
		Long_Name=ltrim(rtrim(isnull(Long_Name,''))),
		L_Address1=ltrim(rtrim(isnull(L_Address1,''))),
		L_Address2=ltrim(rtrim(isnull(L_Address2,''))),
		L_Address3=ltrim(rtrim(isnull(L_Address3,''))),
		L_city=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_city,'')))),
		L_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(L_State,'')))),
		L_Nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(L_Nation,'')))),
		L_Zip=ltrim(rtrim(isnull(L_Zip,''))),
		--Fax=ltrim(rtrim(isnull(Fax,''))),
		Res_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone1,'')))),
		Res_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Res_Phone2,'')))),
		STDcode_Residence1=isnull(Res_phone1_std,''),
		STDcode_Residence2=isnull(Res_phone1_std,''),
		Off_Phone1=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone1,'')))),
		Off_Phone2=dbo.strip_non_digit(ltrim(rtrim(isnull(Off_Phone2,'')))),
		STDcode_Office1=isnull(Off_phone1_std,''),
		STDcode_Office2=isnull(off_phone2_std,''),
		Email=ltrim(rtrim(isnull(Email,''))),
		--Branch_cd=ltrim(rtrim(isnull(Branch_cd,''))),
		--Credit_Limit=ltrim(rtrim(Credit_Limit)),
		Cl_type=ltrim(rtrim(isnull(Cl_type,''))),
		Cl_Status=ltrim(rtrim(isnull(Cl_Status,''))),
		--Gl_Code=ltrim(rtrim(isnull(Gl_Code,''))),
		--Fd_Code=ltrim(rtrim(isnull(Fd_Code,''))),
		--Family=ltrim(rtrim(isnull(Family,''))),
		--Penalty=ltrim(rtrim(Penalty)),
		--Sub_Broker=ltrim(rtrim(isnull(Sub_Broker,''))),
		--Confirm_fax=ltrim(rtrim(isnull(Confirm_fax,''))),
		--PhoneOld=ltrim(rtrim(isnull(PhoneOld,''))),
		Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
		pan_gir_no=ltrim(rtrim(isnull(pan_gir_no,''))),
		--trader=ltrim(rtrim(isnull(trader,''))),
		--Ward_No=ltrim(rtrim(isnull(Ward_No,''))),
		--Region=ltrim(rtrim(isnull(Region,''))),
		--Area=ltrim(rtrim(isnull(Area,''))),
		--Clrating=ltrim(rtrim(isnull(Clrating,'')))
		P_address1=ltrim(rtrim(isnull(c1.P_address1,''))),
		P_address2=ltrim(rtrim(isnull(c1.P_address2,''))),
		P_address3=ltrim(rtrim(isnull(c1.P_address3,''))),
		P_City=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_City,'')))),
		P_State=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_State_For_Other=dbo.strip_non_alpha_without_space(ltrim(rtrim(isnull(c1.P_State,'')))),
		P_nation=dbo.strip_non_alpha(ltrim(rtrim(isnull(c1.P_nation,'')))),
		P_zip=replace(ltrim(rtrim(isnull(c1.P_zip,''))), ' ', ''),
		P_Len=case when len(c1.P_address1)>0 and len(c1.P_address2)>0 and len(c1.P_address3)>0 and 
						len(c1.P_City)>0 and len(c1.P_State)>0 and len(c1.P_nation)>0 and len(c1.P_zip)>0
				then 'N' else 'Y' end	,
		Gender=ltrim(rtrim(isnull(c1.sex,''))),
		BirthDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.dob, 113),' ','-'),'')))),
		dob=c1.dob,
		--ActiveFrom=t.Active_From,
		InactiveFrom='',
		--GrossAnnualIncomeasonDate=upper(ltrim(rtrim(isnull(replace(convert(varchar(11), t.Active_From, 113),' ','-'),'')))),
		--bank_name = ltrim(rtrim(isnull(c1.bank_name, ''))),
		--bank_address = ltrim(rtrim(isnull(c1.branch_name, ''))),
		--bank_account_type = ltrim(rtrim(isnull(c1.ac_type, ''))),
		--bank_account_no = ltrim(rtrim(isnull(c1.ac_num, ''))),
		--dp_id1 = ltrim(rtrim(isnull(c1.dpid1, ''))),
		--dp_name1 = ltrim(rtrim(isnull(c1.depository1, ''))),
		--depository_participant1 = '',
		--demat_id_of_client1 = ltrim(rtrim(isnull(c1.cltdpid1, ''))),
		dp_id2 = ltrim(rtrim(isnull(c1.dpid2, ''))),
		dp_name2 = ltrim(rtrim(isnull(c1.depository2, ''))),
		depository_participant2 = '',
		demat_id_of_client2 = ltrim(rtrim(isnull(c1.cltdpid2, ''))),
		dp_id3 = ltrim(rtrim(isnull(c1.dpid3, ''))),
		dp_name3 = ltrim(rtrim(isnull(c1.depository3, ''))),
		depository_participant3 = '',
		demat_id_of_client3 = ltrim(rtrim(isnull(c1.cltdpid3, '')))--,
		--Regr_no,
		--Regr_authority,
		--regr_at,
		--regr_on

	into 
		#temp_client1	
	from 
		anand1.msajag.dbo.Client_Details c1 with(nolock),
		--angelcommodity.mcdx.dbo.client5 c1 with(nolock),
		#temp_client5 t 
	where 
		c1.cl_code = t.cl_code 
		
	--select count(#temp_Client1.Cl_Code),#temp_Client1.Cl_Code from MCXState_City_Code m1, #temp_Client1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city	
	--group by #temp_Client1.Cl_Code
	--having count(#temp_Client1.Cl_Code)>1
	--order by Cl_Code
	
	--,state_city_code
	

	update 
		#temp_Client1 
	set 
	L_city= case when  L_city='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
				 when  L_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
				 when  L_city='PATAN' then 'PATANVAV'
				 when  L_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					L_city
				 end	,	
	P_city= case when   P_city ='MUZAFFARNAGAR' then 'MUZAFFAR NAGAR' 
			when  P_city='SRI GANGANAGAR' then 'SRIGANGANAGAR'
			when  P_city='PATAN' then 'PATANVAV'
			when  P_city='AMBALA CANTT' then 'AMBALA' /*Added on 22 Apr 2014*/
				 else
					P_city
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_state='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
				
				 else
					L_state
				 end	,	
	P_state= case when   P_state ='TAMILNADU' then 'TAMIL NADU' /*Added on 08 Aug 2014*/
			
				 else
					P_state
				 end	

update 
		#temp_Client1 
	set 
	L_state= case when  L_city = 'HYDERABAD' then 'ANDHRA PRADESH' /* Added on 12/09/2017 mail from Ajay Gupta   */
				
				 else
					L_state
				 end	,	
	P_state= case when   P_City ='HYDERABAD' then 'ANDHRA PRADESH' 
			
				 else
					P_state
				 end	





	update 
		#temp_Client1 
	set 
	


	L_State= isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.L_state and m1.city=#temp_Client1.L_city),''),
	P_State=isnull((select code from MCXState_City_Code_new m1 where m1.state= #temp_Client1.P_state and m1.city=#temp_Client1.P_city),''),
	L_nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from intranet.mimansa.dbo.MCXCountryCode m1 with(nolock) where m1.CountryName=L_Nation),''),
	P_Nation=(case when L_nation='INDIA' then '85' else L_nation end),--isnull((select CountryCode from MCXCountryCode m1 with(nolock) where m1.CountryName=P_Nation),''),
	--bank_account_type=case 
	--			when bank_account_type='S' then '10'
	--			when bank_account_type='C' then '11'
	--			else bank_account_type end,			
	cl_status=(case			when cl_status = 'IND' then '01'
							when cl_status = 'NRI' then '02'
							when cl_status = 'SB' then '03'
							when cl_status = 'FII' then '04'
							when cl_status = 'OCB' then '05'
							when cl_status = 'MF' then '06'
							when cl_status = 'DFN' then '07'
							when cl_status = 'DFN' then '07'

							when cl_status = 'QFI' then '10'
							when cl_status = 'PPB' or cl_status = 'BCP' then '13' /*Added BCP status on 7 Apr 2014*/
							when cl_status = 'PF' then '15'
							when cl_status = 'HUF' then '16'
							when cl_status = 'TS' then '17'
							when cl_status = 'DFI' then '18'
							when cl_status = 'BNK' then '19'
							when cl_status = 'IC' then '20'
							when cl_status = 'FVC' then '21'							
							else
								''
				end)
	
	/*case
				
				when cl_status = 'IND' then '01'		
				when cl_status = 'NRI' then '02'
				when cl_status = 'SB' then '03'
				when cl_status = 'FII' then '04'
				when cl_status = 'OCB' then '05'
				when cl_status = 'MF' then '06'
				when cl_status = 'DFN' then '07'		
				when cl_status = 'QFI' then ' 10'		
				when cl_status = 'PPB' then '13'
				when cl_status = 'HUF' then '16'
				when cl_status = 'TS' then '17'
				when cl_status = 'DFI' then '18'
				when cl_status = 'BNK' then '19'
				when cl_status = 'IC' then '20'
				when cl_status = 'FVC' then '21'	
			else
				'01'		
			end*/



select 
party_code=ltrim(rtrim(isnull(c2.party_code, ''))),	cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
/*c2.**/ into #temp_client2 from 	
--angelcommodity.mcdxcds.dbo.client2 c2 with(nolock) 
angelcommodity.mcdx.dbo.client2 c2 with(nolock)
,#temp_client5 m1 
where
	m1.cl_code=ltrim(rtrim(isnull(c2.cl_code, '')))
	and len(ltrim(rtrim(isnull(c2.cl_code, '')))) > 0
	and len(ltrim(rtrim(isnull(c2.party_code, '')))) > 0


select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bank_name, ''))),
		branch_name = ltrim(rtrim(b.branch_name)),
		bank_address =ltrim(rtrim(isnull(b.branch_name, ''))) + ' ' + ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))) + space(1) + ltrim(rtrim(isnull(b.state, ''))) + space(1) + ltrim(rtrim(isnull(b.nation, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#pobank
	from
		#temp_client5 t,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.pobank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		angelcommodity.mcdx.dbo.pobank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository, '') in ('SAVING', 'CURRENT', 'OTHER')

	

	select distinct
		party_code = ltrim(rtrim(c4.party_code)),
		bank_id = ltrim(rtrim(c4.bankid)),
		bank_name = ltrim(rtrim(isnull(b.bankname, ''))),
		branch_name = '',
		bank_address = ltrim(rtrim(isnull(b.address1, ''))) + space(1) + ltrim(rtrim(isnull(b.address2, ''))) + space(1) + ltrim(rtrim(isnull(b.city, ''))),
		account_type = ltrim(rtrim(c4.depository)),
		account_no = ltrim(rtrim(c4.cltdpid))
	into
		#bank
	from
		#temp_client5 t ,
		--angelcommodity.mcdxcds.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdxcds.dbo.bank b with(nolock)
		angelcommodity.mcdx.dbo.client4 c4 with(nolock),
		--angelcommodity.mcdx.dbo.pobank b with(nolock)				
		angelcommodity.mcdx.dbo.bank b with(nolock)
	where
		t.cl_code = c4.party_code and
		c4.bankid = b.bankid and
		isnull(c4.depository,'') in ('CDSL', 'NSDL') and
		c4.defdp = '1'
	
	--select count(party_code),party_code from #bank group by party_code order by party_code
	--return
	--insert into
	--	angel_ucc_currency_futures_client_bank
	select distinct
		party_code = ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end)),
		bank_name = ltrim(rtrim(isnull(po.bank_name, ''))),
		branch_name = ltrim(rtrim(isnull(po.branch_name, ''))),
		bank_address = cast('' as varchar(255)),--ltrim(rtrim(isnull(po.bank_address, ''))),
		bank_account_type = ltrim(rtrim(isnull(po.account_type, ''))),
		bank_account_no = ltrim(rtrim(isnull(po.account_no, ''))),

		dp_id = ltrim(rtrim(isnull(b.bank_id, ''))),
		dp_name = ltrim(rtrim(isnull(b.account_type, ''))),
		depository_participant = cast('' as varchar(50)),--ltrim(rtrim(isnull(b.bank_name, ''))),
		demat_id_of_client = ltrim(rtrim(isnull(b.account_no, '')))
	into #temp_client_bank
	from
		#pobank po full outer join #bank b on ltrim(rtrim(po.party_code)) = ltrim(rtrim(b.party_code))
	order by
		ltrim(rtrim(case when po.party_code is null then b.party_code else po.party_code end))

--select * from #temp_client_bank where party_code='M77537'
--select party_code,max(bank_address) from #pobank group by party_code order by party_code-- where party_code='M77537'

update #temp_client_bank set bank_address=a1.bank_address
from  
(select party_code,account_no,bank_address=max(bank_address) from #pobank  group by party_code,account_no)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

update #temp_client_bank set depository_participant=a1.bank_name
from  
(select party_code,bank_id,bank_name=max(bank_name) from #bank  group by party_code,bank_id)a1 --order by party_code-- where party_code='M77537'
where #temp_client_bank.party_code=a1.party_code

--truncate table mimansa_ucc_mcx_currency_client_data
  


CREATE TABLE #mimansa_ucc_mcx_currency_client_data(
	[ClientCode] [varchar](20) NULL,
	[ClientName] [varchar](250) NULL,
	[Category] [varchar](20) NULL,
	[PAN] [varchar](20) NULL,
	[Gender] [varchar](2) NULL,
	[FathersHusbandsGuardiansName] [varchar](250) NULL,
	[MaritalStatus] [varchar](2) NULL,
	[Nationality] [varchar](10) NULL,
	[NationalityOther] [varchar](50) NULL,
	[ClientEmailID] [varchar](150) NULL,
	[Address1Corresponding] [varchar](355) NULL,
	[Address2Corresponding] [varchar](355) NULL,
	[Address3Corresponding] [varchar](355) NULL,
	[CountryCorresponding] [varchar](30) NULL,
	[StateCityCodeCorresponding] [varchar](60) NULL,
	[PinCodeCorresponding] [varchar](10) NULL,
	[PermanentAddresssameasCorrespondingAddress] [varchar](5) NULL,
	[Address1Permanent] [varchar](355) NULL,
	[Address2Permanent] [varchar](355) NULL,
	[Address3Permanent] [varchar](355) NULL,
	[CountryPermanent] [varchar](30) NULL,
	[StateCityCodePermanent] [varchar](60) NULL,
	[PinCodePermanent] [varchar](10) NULL,
	[TelephoneNumberR] [varchar](60) NULL,
	[MobileNumber] [varchar](20) NULL,
	[TelephoneNumberO] [varchar](60) NULL,
	[DateofBirth_Incorporation] [varchar](15) NULL,
	[UIDNumber] [varchar](200) NULL,
	[BankName1] [varchar](100) NULL,
	[BankBranchAddress1] [varchar](355) NULL,
	[BankAccountNumber1] [varchar](25) NULL,
	[BankAccountType1] [varchar](50) NULL,
	[BankName2] [varchar](100) NULL,
	[BankBranchAddress2] [varchar](355) NULL,
	[BankAccountNumber2] [varchar](25) NULL,
	[BankAccountType2] [varchar](50) NULL,
	[BankName3] [varchar](100) NULL,
	[BankBranchAddress3] [varchar](355) NULL,
	[BankAccountNumber3] [varchar](25) NULL,
	[BankAccountType3] [varchar](50) NULL,
	[DepositoryName1] [varchar](50) NULL,
	[DepositoryId1] [varchar](80) NULL,
	[BeneficiaryAccountID1] [varchar](160) NULL,
	[DepositoryName2] [varchar](10) NULL,
	[DepositoryId2] [varchar](80) NULL,
	[BeneficiaryAccountID2] [varchar](160) NULL,
	[DepositoryName3] [varchar](100) NULL,
	[DepositoryId3] [varchar](80) NULL,
	[BeneficiaryAccountID3] [varchar](160) NULL,
	[CIN] [varchar](210) NULL,
	[PlaceofIncorporation] [varchar](750) NULL,
	[Occupation] [varchar](20) NULL,
	[OccupationDetailsForOthers] [varchar](150) NULL,
	[Dateofcommencementofbusiness] [varchar](80) NULL,
	[IncomedetailsperannuminRs] [varchar](20) NULL,
	[Incomeasondate] [varchar](80) NULL,
	[NetworthRs] [varchar](180) NULL,
	[Networthasondate] [varchar](80) NULL,
	[PoliticallyexposedpersonPEP] [varchar](10) NULL,
	[CPCode] [varchar](150) NULL,
	[RegistrationNumberofClient] [varchar](500) NULL,
	[RegisteringAuthority] [varchar](600) NULL,
	[PlaceofRegistration] [varchar](500) NULL,
	[DateofRegistration] [varchar](80) NULL,
	[InpersonVerification] [varchar](100) NULL,
	[ClientAgreementDate] [varchar](800) NULL,
	[Reserved] [varchar](500) NULL,
	[RelationshipCode] [varchar](100) NULL,
	[ProofType] [varchar](200) NULL,
	[ProofNumber] [varchar](250) NULL,
	[IssuePlaceofProof] [varchar](500) NULL,
	[IssueDateofProof] [varchar](800) NULL,
	[ClientStatus] [varchar](100) NULL,
	[Remarks] [varchar](300) NULL,
	[ClientTypeCorporate] [varchar](100) NULL,
	[NameofContactPerson1] [varchar](500) NULL,
	[DesignationofContactPerson1] [varchar](500) NULL,
	[PANofcontactPerson1] [varchar](500) NULL,
	[AddressofContactPerson1] [varchar](555) NULL,
	[ContactDetailsofContactPerson1] [varchar](500) NULL,
	[DINofContactPerson1] [varchar](500) NULL,
	[UIDofContactPerson1] [varchar](500) NULL,
	[EmailIdofContactPerson1] [varchar](500) NULL,
	[NameofContactPerson2] [varchar](500) NULL,
	[DesignationofContactPerson2] [varchar](500) NULL,
	[PANofcontactPerson2] [varchar](500) NULL,
	[AddressofContactPerson2] [varchar](555) NULL,
	[ContactDetailsofContactPerson2] [varchar](500) NULL,
	[DINofContactPerson2] [varchar](500) NULL,
	[UIDofContactPerson2] [varchar](500) NULL,
	[EmailIdofContactPerson2] [varchar](500) NULL,
	[NameofContactPerson3] [varchar](500) NULL,
	[DesignationofContactPerson3] [varchar](500) NULL,
	[PANofcontactPerson3] [varchar](500) NULL,
	[AddressofContactPerson3] [varchar](555) NULL,
	[ContactDetailsofContactPerson3] [varchar](500) NULL,
	[DINofContactPerson3] [varchar](500) NULL,
	[UIDofContactPerson3] [varchar](500) NULL,
	[EmailIdofContactPerson3] [varchar](500) NULL,
	[NameofContactPerson4] [varchar](500) NULL,
	[DesignationofContactPerson4] [varchar](500) NULL,
	[PANofcontactPerson4] [varchar](500) NULL,
	[AddressofContactPerson4] [varchar](555) NULL,
	[ContactDetailsofContactPerson4] [varchar](500) NULL,
	[DINofContactPerson4] [varchar](500) NULL,
	[UIDofContactPerson4] [varchar](500) NULL,
	[EmailIdofContactPerson4] [varchar](500) NULL,
	[NameofContactPerson5] [varchar](500) NULL,
	[DesignationofContactPerson5] [varchar](500) NULL,
	[PANofcontactPerson5] [varchar](500) NULL,
	[AddressofContactPerson5] [varchar](555) NULL,
	[ContactDetailsofContactPerson5] [varchar](500) NULL,
	[DINofContactPerson5] [varchar](500) NULL,
	[UIDofContactPerson5] [varchar](500) NULL,
	[EmailIdofContactPerson5] [varchar](500) NULL,
	[NameofContactPerson6] [varchar](500) NULL,
	[DesignationofContactPerson6] [varchar](500) NULL,
	[PANofcontactPerson6] [varchar](500) NULL,
	[AddressofContactPerson6] [varchar](555) NULL,
	[ContactDetailsofContactPerson6] [varchar](500) NULL,
	[DINofContactPerson6] [varchar](500) NULL,
	[UIDofContactPerson6] [varchar](500) NULL,
	[EmailIdofContactPerson6] [varchar](500) NULL,
	[NameofContactPerson7] [varchar](500) NULL,
	[DesignationofContactPerson7] [varchar](500) NULL,
	[PANofcontactPerson7] [varchar](500) NULL,
	[AddressofContactPerson7] [varchar](555) NULL,
	[ContactDetailsofContactPerson7] [varchar](500) NULL,
	[DINofContactPerson7] [varchar](500) NULL,
	[UIDofContactPerson7] [varchar](500) NULL,
	[EmailIdofContactPerson7] [varchar](500) NULL,
	[NameofContactPerson8] [varchar](500) NULL,
	[DesignationofContactPerson8] [varchar](500) NULL,
	[PANofcontactPerson8] [varchar](500) NULL,
	[AddressofContactPerson8] [varchar](555) NULL,
	[ContactDetailsofContactPerson8] [varchar](500) NULL,
	[DINofContactPerson8] [varchar](500) NULL,
	[UIDofContactPerson8] [varchar](500) NULL,
	[EmailIdofContactPerson8] [varchar](500) NULL,
	[NameofContactPerson9] [varchar](500) NULL,
	[DesignationofContactPerson9] [varchar](500) NULL,
	[PANofcontactPerson9] [varchar](500) NULL,
	[AddressofContactPerson9] [varchar](555) NULL,
	[ContactDetailsofContactPerson9] [varchar](500) NULL,
	[DINofContactPerson9] [varchar](500) NULL,
	[UIDofContactPerson9] [varchar](500) NULL,
	[EmailIdofContactPerson9] [varchar](500) NULL,
	[NameofContactPerson10] [varchar](500) NULL,
	[DesignationofContactPerson10] [varchar](500) NULL,
	[PANofcontactPerson10] [varchar](500) NULL,
	[AddressofContactPerson10] [varchar](555) NULL,
	[ContactDetailsofContactPerson10] [varchar](500) NULL,
	[DINofContactPerson10] [varchar](500) NULL,
	[UIDofContactPerson10] [varchar](100) NULL,
	[EmailIdofContactPerson10] [varchar](100) NULL,
	[NameContactofPerson11] [varchar](100) NULL,
	[DesignationofContactPerson11] [varchar](100) NULL,
	[PANofcontactPerson11] [varchar](100) NULL,
	[AddressofContactPerson11] [varchar](255) NULL,
	[ContactDetailsofContactPerson11] [varchar](100) NULL,
	[DINofContactPerson11] [varchar](100) NULL,
	[UIDofContactPerson11] [varchar](100) NULL,
	[EmailIdofContactPerson11] [varchar](100) NULL,
	[NameofContactPerson12] [varchar](100) NULL,
	[DesignationofContactPerson12] [varchar](100) NULL,
	[PANofcontactPerson12] [varchar](100) NULL,
	[AddressofContactPerson12] [varchar](255) NULL,
	[ContactDetailsofContactPerson12] [varchar](100) NULL,
	[DINofContactPerson12] [varchar](100) NULL,
	[UIDofContactPerson12] [varchar](100) NULL,
	[EmailIdofContactPerson12] [varchar](100) NULL,
	[NameofContactPerson13] [varchar](100) NULL,
	[DesignationofContactPerson13] [varchar](100) NULL,
	[PANofcontactPerson13] [varchar](100) NULL,
	[AddressofContactPerson13] [varchar](255) NULL,
	[ContactDetailsofContactPerson13] [varchar](100) NULL,
	[DINofContactPerson13] [varchar](100) NULL,
	[UIDofContactPerson13] [varchar](100) NULL,
	[EmailIdofContactPerson13] [varchar](100) NULL,
	[NameofContactPerson14] [varchar](100) NULL,
	[DesignationofContactPerson14] [varchar](100) NULL,
	[PANofcontactPerson14] [varchar](100) NULL,
	[AddressofContactPerson14] [varchar](255) NULL,
	[ContactDetailsofContactPerson14] [varchar](100) NULL,
	[DINofContactPerson14] [varchar](100) NULL,
	[UIDofContactPerson14] [varchar](100) NULL,
	[EmailIdofContactPerson14] [varchar](100) NULL,
	[NameofContactPerson15] [varchar](100) NULL,
	[DesignationofContactPerson15] [varchar](100) NULL,
	[PANofcontactPerson15] [varchar](100) NULL,
	[AddressofContactPerson15] [varchar](255) NULL,
	[ContactDetailsofContactPerson15] [varchar](100) NULL,
	[DINofContactPerson15] [varchar](100) NULL,
	[UIDofContactPerson15] [varchar](100) NULL,
	[EmailIdofContactPerson15] [varchar](100) NULL,
	[NameofContactPerson16] [varchar](100) NULL,
	[DesignationofContactPerson16] [varchar](100) NULL,
	[PANofcontactPerson16] [varchar](100) NULL,
	[AddressofContactPerson16] [varchar](255) NULL,
	[ContactDetailsofContactPerson16] [varchar](100) NULL,
	[DINofContactPerson16] [varchar](100) NULL,
	[UIDofContactPerson16] [varchar](100) NULL,
	[EmailIdofContactPerson16] [varchar](100) NULL,
	[NameofContactPerson17] [varchar](100) NULL,
	[DesignationofContactPerson17] [varchar](100) NULL,
	[PANofcontactPerson17] [varchar](100) NULL,
	[AddressofContactPerson17] [varchar](255) NULL,
	[ContactDetailsofContactPerson17] [varchar](100) NULL,
	[DINofContactPerson17] [varchar](100) NULL,
	[UIDofContactPerson17] [varchar](100) NULL,
	[EmailIdofContactPerson17] [varchar](100) NULL,
	[NameofContactPerson18] [varchar](100) NULL,
	[DesignationofContactPerson18] [varchar](100) NULL,
	[PANofcontactPerson18] [varchar](100) NULL,
	[AddressofContactPerson18] [varchar](255) NULL,
	[ContactDetailsofContactPerson18] [varchar](100) NULL,
	[DINofContactPerson18] [varchar](100) NULL,
	[UIDofContactPerson18] [varchar](100) NULL,
	[EmailIdofContactPerson18] [varchar](100) NULL,
	[NameofContactPerson19] [varchar](100) NULL,
	[DesignationofContactPerson19] [varchar](100) NULL,
	[PANofcontactPerson19] [varchar](100) NULL,
	[AddressofContactPerson19] [varchar](255) NULL,
	[ContactDetailsofContactPerson19] [varchar](100) NULL,
	[DINofContactPerson19] [varchar](100) NULL,
	[UIDofContactPerson19] [varchar](100) NULL,
	[EmailIdofContactPerson19] [varchar](100) NULL,
	[NameofContactPerson20] [varchar](100) NULL,
	[DesignationofContactPerson20] [varchar](100) NULL,
	[PANofcontactPerson20] [varchar](100) NULL,
	[AddressofContactPerson20] [varchar](255) NULL,
	[ContactDetailsofContactPerson20] [varchar](100) NULL,
	[DINofContactPerson20] [varchar](100) NULL,
	[UIDofContactPerson20] [varchar](100) NULL,
	[EmailIdofContactPerson20] [varchar](100) NULL,
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL,
	[Flag] [varchar](1) NULL
) 

insert into #mimansa_ucc_mcx_currency_client_data
select
	ClientCode = c1_b.cl_code,
	ClientName = replace(c1_b.long_name,'CLOSE ',''),--c1_b.long_name, Mar 26 2014
	category = cl_status,
	pan = c1_b.pan_gir_no,
	Gender=(case when cl_status ='16' then '' else  Gender end),
	FathersHusbandsGuardiansName='',
	MaritalStatus='',
	Nationality='',
	NationalityOther='',
	ClientEmailID=c1_b.email,
	Address1Corresponding=c1_b.l_address1,
	Address2Corresponding=c1_b.l_address2,
	Address3Corresponding=c1_b.l_address3,
	CountryCorresponding=L_nation,   -------------------------Need to work
	StateCityCodeCorresponding=isnull(L_state,''),    -------------------------Need to work
	PinCodeCorresponding=c1_b.l_zip,
	PermanentAddresssameasCorrespondingAddress=P_Len,
	Address1Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address1, 255) else '' end,
	Address2Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address2, 255) else '' end,
	Address3Permanent=case when c1_b.P_Len='N' then left(c1_b.P_address3, 255) else '' end,
	CountryPermanent=case when c1_b.P_Len='N' then left(c1_b.P_nation, 50) else '' end,
	StateCityCodePermanent=case when c1_b.P_Len='N' then c1_b.P_State else '' end ,
	PinCodePermanent=case when c1_b.P_Len='N' then left(c1_b.l_zip, 50) else '' end,
	TelephoneNumberR=	
		case 
			when len(c1_b.res_phone1) > 0 then c1_b.res_phone1
			when len(c1_b.res_phone2) > 0 then c1_b.res_phone2
		else
			''
		end,
	MobileNumber=c1_b.mobile_pager,
	TelephoneNumberO=
		case
			when len(c1_b.off_phone1) > 0 then c1_b.off_phone1
			when len(c1_b.off_phone2) > 0 then c1_b.off_phone2
		else 
			'' 
		end,
	DateofBirth_Incorporation=  replace(convert(varchar, c1_b.dob, 103), '/', '') ,
		/*case 
			when replace(convert(varchar, c5.activefrom, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.activefrom, 103), '/', '') 
		end,*/
	UIDNumber='',
	BankName1=c1_b.bank_name,
	BankBranchAddress1= /* 'Branch address ' + */  Replace(c1_b.bank_address,',',' '),  --Removed On Nov 17 2014 Aniket Mail
	BankAccountNumber1=c1_b.bank_account_no,
	BankAccountType1=case when c1_b.bank_account_type ='SAVING' then '10' 
						  when c1_b.bank_account_type ='CURRENT' then '11'
						  else '99' end 	,
	BankName2='',
	BankBranchAddress2='',
	BankAccountNumber2='',
	BankAccountType2='',
	BankName3='',
	BankBranchAddress3='',
	BankAccountNumber3='',
	BankAccountType3='',
	DepositoryName1='',
	DepositoryId1='',
	BeneficiaryAccountID1='',
	DepositoryName2='',
	DepositoryId2='',
	BeneficiaryAccountID2='',
	DepositoryName3='',
	DepositoryId3='',
	BeneficiaryAccountID3='',
	CIN='',
	PlaceofIncorporation='',
	Occupation='',
	OccupationDetailsForOthers='',
	Dateofcommencementofbusiness=
		case 
			when replace(convert(varchar, c5.client_agre_dt, 103), '/', '') = '01011900' then ''
			else replace(convert(varchar, c5.client_agre_dt, 103), '/', '') 
		end,
	IncomedetailsperannuminRs='',
	Incomeasondate='',
	NetworthRs='',
	Networthasondate='',
	PoliticallyexposedpersonPEP='',
	CPCode='',
	RegistrationNumberofClient='',/*case when cl_status='13' then c5.regr_no else '' end,*/
	RegisteringAuthority='',/*case when cl_status='13' then c5.regr_auth else '' end,*/
	PlaceofRegistration='',/*case when cl_status='13' then c5.regr_place else '' end,*/
	DateofRegistration='',/*case when cl_status='13' then replace(convert(varchar, isnull(c5.regr_date, ''), 103), '/', '')  else '' end,*/
	InpersonVerification='Y',
	activefrom='',
		--case 
		--	when replace(convert(varchar, c1_b.activefrom, 103), '/', '') = '01011900' then ''
		--	else replace(convert(varchar, c1_b.activefrom, 103), '/', '') 
		--end,
	Reserved='',
	RelationshipCode='',
	ProofType='',
	ProofNumber='',
	IssuePlaceofProof='',
	IssueDateofProof='',
	ClientStatus='2',/*Modify on 28 May 2014*/
	--(case when c5.inactivefrom >@@getdate and c5.activefrom >=@@FromDate and c5.activefrom <= @@ToDate then '1' else '2' end),/*Added on 26 May 2014*/
	Remarks='Account Closure',
	ClientTypeCorporate='N',
	NameofContactPerson1='',
	DesignationofContactPerson1='',
	PANofcontactPerson1='',
	AddressofContactPerson1='',
	ContactDetailsofContactPerson1='',
	DINofContactPerson1='',
	UIDofContactPerson1='',
	EmailIdofContactPerson1='',
	NameofContactPerson2='',
	DesignationofContactPerson2='',
	PANofcontactPerson2='',
	AddressofContactPerson2='',
	ContactDetailsofContactPerson2='',
	DINofContactPerson2='',
	UIDofContactPerson2='',
	EmailIdofContactPerson2='',
	NameofContactPerson3='',
	DesignationofContactPerson3='',
	PANofcontactPerson3='',
	AddressofContactPerson3='',
	ContactDetailsofContactPerson3='',
	DINofContactPerson3='',
	UIDofContactPerson3='',
	EmailIdofContactPerson3='',
	NameofContactPerson4='',
	DesignationofContactPerson4='',
	PANofcontactPerson4='',
	AddressofContactPerson4='',
	ContactDetailsofContactPerson4='',
	DINofContactPerson4='',
	UIDofContactPerson4='',
	EmailIdofContactPerson4='',
	NameofContactPerson5='',
	DesignationofContactPerson5='',
	PANofcontactPerson5='',
	AddressofContactPerson5='',
	ContactDetailsofContactPerson5='',
	DINofContactPerson5='',
	UIDofContactPerson5='',
	EmailIdofContactPerson5='',
	NameofContactPerson6='',
	DesignationofContactPerson6='',
	PANofcontactPerson6='',
	AddressofContactPerson6='',
	ContactDetailsofContactPerson6='',
	DINofContactPerson6='',
	UIDofContactPerson6='',
	EmailIdofContactPerson6='',
	NameofContactPerson7='',
	DesignationofContactPerson7='',
	PANofcontactPerson7='',
	AddressofContactPerson7='',
	ContactDetailsofContactPerson7='',
	DINofContactPerson7='',
	UIDofContactPerson7='',
	EmailIdofContactPerson7='',
	NameofContactPerson8='',
	DesignationofContactPerson8='',
	PANofcontactPerson8='',
	AddressofContactPerson8='',
	ContactDetailsofContactPerson8='',
	DINofContactPerson8='',
	UIDofContactPerson8='',
	EmailIdofContactPerson8='',
	NameofContactPerson9='',
	DesignationofContactPerson9='',
	PANofcontactPerson9='',
	AddressofContactPerson9='',
	ContactDetailsofContactPerson9='',
	DINofContactPerson9='',
	UIDofContactPerson9='',
	EmailIdofContactPerson9='',
	NameofContactPerson10='',
	DesignationofContactPerson10='',
	PANofcontactPerson10='',
	AddressofContactPerson10='',
	ContactDetailsofContactPerson10='',
	DINofContactPerson10='',
	UIDofContactPerson10='',
	EmailIdofContactPerson10='',
	NameContactofPerson11='',
	DesignationofContactPerson11='',
	PANofcontactPerson11='',
	AddressofContactPerson11='',
	ContactDetailsofContactPerson11='',
	DINofContactPerson11='',
	UIDofContactPerson11='',
	EmailIdofContactPerson11='',
	NameofContactPerson12='',
	DesignationofContactPerson12='',
	PANofcontactPerson12='',
	AddressofContactPerson12='',
	ContactDetailsofContactPerson12='',
	DINofContactPerson12='',
	UIDofContactPerson12='',
	EmailIdofContactPerson12='',
	NameofContactPerson13='',
	DesignationofContactPerson13='',
	PANofcontactPerson13='',
	AddressofContactPerson13='',
	ContactDetailsofContactPerson13='',
	DINofContactPerson13='',
	UIDofContactPerson13='',
	EmailIdofContactPerson13='',
	NameofContactPerson14='',
	DesignationofContactPerson14='',
	PANofcontactPerson14='',
	AddressofContactPerson14='',
	ContactDetailsofContactPerson14='',
	DINofContactPerson14='',
	UIDofContactPerson14='',
	EmailIdofContactPerson14='',
	NameofContactPerson15='',
	DesignationofContactPerson15='',
	PANofcontactPerson15='',
	AddressofContactPerson15='',
	ContactDetailsofContactPerson15='',
	DINofContactPerson15='',
	UIDofContactPerson15='',
	EmailIdofContactPerson15='',
	NameofContactPerson16='',
	DesignationofContactPerson16='',
	PANofcontactPerson16='',
	AddressofContactPerson16='',
	ContactDetailsofContactPerson16='',
	DINofContactPerson16='',
	UIDofContactPerson16='',
	EmailIdofContactPerson16='',
	NameofContactPerson17='',
	DesignationofContactPerson17='',
	PANofcontactPerson17='',
	AddressofContactPerson17='',
	ContactDetailsofContactPerson17='',
	DINofContactPerson17='',
	UIDofContactPerson17='',
	EmailIdofContactPerson17='',
	NameofContactPerson18='',
	DesignationofContactPerson18='',
	PANofcontactPerson18='',
	AddressofContactPerson18='',
	ContactDetailsofContactPerson18='',
	DINofContactPerson18='',
	UIDofContactPerson18='',
	EmailIdofContactPerson18='',
	NameofContactPerson19='',
	DesignationofContactPerson19='',
	PANofcontactPerson19='',
	AddressofContactPerson19='',
	ContactDetailsofContactPerson19='',
	DINofContactPerson19='',
	UIDofContactPerson19='',
	EmailIdofContactPerson19='',
	NameofContactPerson20='',
	DesignationofContactPerson20='',
	PANofcontactPerson20='',
	AddressofContactPerson20='',
	ContactDetailsofContactPerson20='',
	DINofContactPerson20='',
	UIDofContactPerson20='',
	EmailIdofContactPerson20='',
	/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
	[RelatiomshipwithclientforMobile]='',
	[NameoftheAuthorisedOrContactpersonforMobile]='',
	[RelatiomshipwithclientforEmail]='',
	[NameoftheAuthorisedOrContactpersonforEmail]='',
	Flag='E'
	
from

	--#temp_client1 c1_b with(nolock),
	(
			select
				c1.*,
				b.bank_name, b.bank_address, b.branch_name, b.bank_account_type, b.bank_account_no,b.dp_id, b.dp_name, b.depository_participant, b.demat_id_of_client
			from
				#temp_client1 c1 with (nolock)
					left outer join
				#temp_client_bank b with (nolock)
					on ltrim(rtrim(c1.cl_code)) = ltrim(rtrim(b.party_code))
		) c1_b,
	#temp_client2 c2 with(nolock),
	#temp_client5 c5

where
	c1_b.cl_code = c2.cl_code
	and c2.cl_code = c5.cl_code
	and left(c2.party_code,2) <> '98'
	and len(c1_b.cl_code) > 0
	and len(c2.party_code)> 0
	and len(c2.cl_code) > 0
	and len(c5.cl_code) > 0
	/*PICK UP ONLY CLIENTS ACTIVATED BETWEEN @from_date AND @to_date*/
	/*and c5.inactivefrom >= @from_date + ' 00:00:00'
	and c5.activefrom >= @from_date + ' 00:00:00'
	and c5.activefrom <= @to_date + ' 23:59:00'*/



only_select:

print 'Delete Invalid PAN'
create table #invalidPan(Client_Code varchar(20), Client_Name varchar(200), PAN varchar(30))

insert into #invalidPan
select Client_Code=[ClientCode],Client_Name=[ClientName],PAN =pan 
from #mimansa_ucc_mcx_currency_client_data c
where len(pan) = 0 

/*
insert into #invalidPan
select Client_Code=cast(c.[ClientCode] as varchar(20)),Client_Name=cast(c.[ClientName] as varchar(200)),PAN = cast(c.pan as varchar(30))
from #mimansa_ucc_mcx_currency_client_data c,	[INTRANET].mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(c.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))
	*/

delete
	#mimansa_ucc_mcx_currency_client_data
from
	--tbl_ucc_banned_pan bp
	--[INTRANET].mimansa.dbo.UCC_AllSebiBannedEntities bp
	intranet.mimansa.dbo.UCC_AllSebiBannedEntities bp
where
	ltrim(rtrim(replace(isnull(#mimansa_ucc_mcx_currency_client_data.pan, ''), ',', ''))) = ltrim(rtrim(isnull(bp.panno, '')))






/***********************************/


update
		#mimansa_ucc_mcx_currency_client_data
	set		
		FathersHusbandsGuardiansName=isnull(c1.FATHERNAME,''),
		Maritalstatus=
			case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then
					case 
						when isnull(c1.MARITALSTATUS,'')='01' then 'S' 
						when isnull(c1.MARITALSTATUS,'')='02' then 'M'
						else 'S' 
					end
			else
				''
			end			,
		Nationality=case when #mimansa_ucc_mcx_currency_client_data.category in ('01','11','18') then  right(isnull(c1.Nationality,'1'),1) else '' end, 
		NATIONALITYOTHER=case when isnull(c1.Nationality,'1')=2 then isnull(c1.NATIONALITY_OTHER,'') else '' end,
		IncomedetailsperannuminRs=case 
					when c1.Gross_Income ='01' then '01'
					when c1.Gross_Income ='02' then '02'
					when c1.Gross_Income ='03' then '03'
					when c1.Gross_Income ='04' then '04'
					when c1.Gross_Income ='05' then '05'
					when c1.Gross_Income ='06' then '06'
					when c1.Gross_Income ='07' then '07'
					else '' end, 
		Incomeasondate=
					case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.gross_date, 113),' ','-'),''))))='01-JAN-1900' 
							then replace(convert(varchar, #mimansa_ucc_mcx_currency_client_data.DateofBirth_Incorporation, 103), '/', '') 
							else replace(convert(varchar, c1.gross_date, 103), '/', '') end,
		NetWorthRs=isnull(case when c1.Net_worth > 0 then cast(c1.Net_worth as varchar) else '' end  ,''),
		NetWorthasonDate=case 
							when upper(ltrim(rtrim(isnull(replace(convert(varchar(11), c1.Net_worth_Date, 113),' ','-'),''))))='01-JAN-1900' 
							then ''
							when c1.Net_worth > 0 then replace(convert(varchar, c1.Net_worth_Date, 103), '/', '') 
							else '' end,

		PoliticallyexposedpersonPEP=case 
				when c1.PEP='01' or c1.pep ='PEP' then '01' 
				when c1.PEP='02' or c1.pep ='RPEP' then '02'
				else '0' end,
		Occupation=case 
				when c1.Occupation='01' then '01'
				when c1.Occupation='02' then '02'
				when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05'
				when c1.Occupation='05' then '06'
				when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08'
				when c1.Occupation='08' then '09'
				when c1.Occupation='10' then '03'
				else '99' end, --26 Mar 2014
		OccupationDetailsForOthers=case when (case 
				when c1.Occupation='01' then '01' when c1.Occupation='02' then '02' 	when c1.Occupation='03' then '04'
				when c1.Occupation='04' then '05' when c1.Occupation='05' then '06' when c1.Occupation='06' then '07'
				when c1.Occupation='07' then '08' when c1.Occupation='08' then '09' when c1.Occupation='10' then '03'
				else '99' end)='99' then 'INVESTOR' else isnull(Occupation_Other,'') end,
		UIDNUMBER= (case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
	from
		anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
	
	
	

	update 
		#mimansa_ucc_mcx_currency_client_data 
		set 
		--GrossAnnualIncomeasonDate='',
		NetWorthRs='',
		NetWorthasonDate='',
		IncomedetailsperannuminRs='',
		Incomeasondate=''
	where len(IncomedetailsperannuminRs)=0 

	--Modified on 26 Mar 2014
	if isnull(@processid,'')<>''
	begin		
		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 		
			IncomedetailsperannuminRs='02', 
			Incomeasondate=replace(convert(varchar, t.activefrom, 103), '/', '') 
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where Incomeasondate=''
		and m.ClientCode= t.cl_code

		update 
			#mimansa_ucc_mcx_currency_client_data 
			set 				
			Incomeasondate='25032013' 
		from #mimansa_ucc_mcx_currency_client_data m
		where  
		len(Incomeasondate)>0
		and datediff(day,cast(right(Incomeasondate, 4)+substring(Incomeasondate, 3, 2)+left(Incomeasondate, 2) as datetime),getdate())>365

		update #mimansa_ucc_mcx_currency_client_data
		set FathersHusbandsGuardiansName=SUBSTRING(ClientName,CHARINDEX(' ',ltrim(ClientName)),len(ltrim(ClientName)))
		where isnull(ltrim(rtrim(FathersHusbandsGuardiansName)),'')=''
		and category not in ('13','15','16','17')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality='1'
		where Nationality in('','2')

		/*Remove it 26 Mar 2014*/
		update #mimansa_ucc_mcx_currency_client_data
		set Nationality=''
		where category in ('13','15','16','17')
	end

	

		--
		/*select ClientCode,Incomeasondate= replace(convert(varchar, t.activefrom, 103), '/', '')  
		from #mimansa_ucc_mcx_currency_client_data m,#temp_client5 t 
		where m.ClientCode= t.cl_code
		and Incomeasondate=''*/
	
	--update
	--	#mimansa_ucc_mcx_currency_client_data
	--set
	--	#mimansa_ucc_mcx_currency_client_data.cin=isnull(c1.cin,'')
	--from
	--	anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	--where
	--	client_code = party_code
	--	and len(isnull(client_code, '')) > 0
	--	and len(isnull(party_code, '')) > 0	
	--	and #mimansa_ucc_mcx_currency_client_data.category=4		

	update
		#mimansa_ucc_mcx_currency_client_data
	set
		#mimansa_ucc_mcx_currency_client_data.CIN=isnull(c1.cin,''),ClientTypeCorporate='Y'
	from
		anand1.msajag.dbo.CLIENT_MASTER_NOMINEE_DATA c1 with(nolock)
	where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0	
		and #mimansa_ucc_mcx_currency_client_data.category=13

	/*Please implement for NON-INDIVIDUAL Category Public & Private Companies/Body Corporate (PPB), Partnership Firm/Association of Persons (PF), HUF & Trust/Society (7 Mar 2014)*/
	
	/****ADDRESS1****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson1=c1.contact_name,
	DesignationofContactPerson1=c1.designation,
	PANofcontactPerson1=c1.PanNo,
	AddressofContactPerson1=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson1=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson1=c1.DIN,
	UIDofContactPerson1=c1.UID,
	EmailIdofContactPerson1=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='1'
	
	/****ADDRESS2****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson2=c1.contact_name,
	DesignationofContactPerson2=c1.designation,
	PANofcontactPerson2=c1.PanNo,
	AddressofContactPerson2=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson2=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson2=c1.DIN,
	UIDofContactPerson2=c1.UID,
	EmailIdofContactPerson2=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='2'
	
	/****ADDRESS3****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson3=c1.contact_name,
	DesignationofContactPerson3=c1.designation,
	PANofcontactPerson3=c1.PanNo,
	AddressofContactPerson3=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson3=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson3=c1.DIN,
	UIDofContactPerson3=c1.UID,
	EmailIdofContactPerson3=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='3'

	/****ADDRESS4****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson4=c1.contact_name,
	DesignationofContactPerson4=c1.designation,
	PANofcontactPerson4=c1.PanNo,
	AddressofContactPerson4=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson4=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson4=c1.DIN,
	UIDofContactPerson4=c1.UID,
	EmailIdofContactPerson4=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='4'

	/****ADDRESS 5****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson5=c1.contact_name,
	DesignationofContactPerson5=c1.designation,
	PANofcontactPerson5=c1.PanNo,
	AddressofContactPerson5=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson5=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson5=c1.DIN,
	UIDofContactPerson5=c1.UID,
	EmailIdofContactPerson5=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='5'

	/****ADDRESS 6****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson6=c1.contact_name,
	DesignationofContactPerson6=c1.designation,
	PANofcontactPerson6=c1.PanNo,
	AddressofContactPerson6=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson6=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson6=c1.DIN,
	UIDofContactPerson6=c1.UID,
	EmailIdofContactPerson6=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='6'

	/****ADDRESS 7****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson7=c1.contact_name,
	DesignationofContactPerson7=c1.designation,
	PANofcontactPerson7=c1.PanNo,
	AddressofContactPerson7=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson7=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson7=c1.DIN,
	UIDofContactPerson7=c1.UID,
	EmailIdofContactPerson7=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='7'

	/****ADDRESS 8****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson8=c1.contact_name,
	DesignationofContactPerson8=c1.designation,
	PANofcontactPerson8=c1.PanNo,
	AddressofContactPerson8=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson8=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson8=c1.DIN,
	UIDofContactPerson8=c1.UID,
	EmailIdofContactPerson8=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='8'

	/****ADDRESS 9****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson9=c1.contact_name,
	DesignationofContactPerson9=c1.designation,
	PANofcontactPerson9=c1.PanNo,
	AddressofContactPerson9=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson9=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson9=c1.DIN,
	UIDofContactPerson9=c1.UID,
	EmailIdofContactPerson9=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='9'

	/****ADDRESS 10****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson10=c1.contact_name,
	DesignationofContactPerson10=c1.designation,
	PANofcontactPerson10=c1.PanNo,
	AddressofContactPerson10=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson10=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson10=c1.DIN,
	UIDofContactPerson10=c1.UID,
	EmailIdofContactPerson10=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='10'

	/****ADDRESS 11****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameContactofPerson11=c1.contact_name,
	DesignationofContactPerson11=c1.designation,
	PANofcontactPerson11=c1.PanNo,
	AddressofContactPerson11=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson11=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson11=c1.DIN,
	UIDofContactPerson11=c1.UID,
	EmailIdofContactPerson11=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='11'

	/****ADDRESS 12****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson12=c1.contact_name,
	DesignationofContactPerson12=c1.designation,
	PANofcontactPerson12=c1.PanNo,
	AddressofContactPerson12=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson12=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson12=c1.DIN,
	UIDofContactPerson12=c1.UID,
	EmailIdofContactPerson12=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='12'

	/****ADDRESS 13****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson13=c1.contact_name,
	DesignationofContactPerson13=c1.designation,
	PANofcontactPerson13=c1.PanNo,
	AddressofContactPerson13=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson13=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson13=c1.DIN,
	UIDofContactPerson13=c1.UID,
	EmailIdofContactPerson13=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='13'

	/****ADDRESS 14****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson14=c1.contact_name,
	DesignationofContactPerson14=c1.designation,
	PANofcontactPerson14=c1.PanNo,
	AddressofContactPerson14=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson14=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson14=c1.DIN,
	UIDofContactPerson14=c1.UID,
	EmailIdofContactPerson14=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='14'

	/****ADDRESS 15****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson15=c1.contact_name,
	DesignationofContactPerson15=c1.designation,
	PANofcontactPerson15=c1.PanNo,
	AddressofContactPerson15=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson15=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson15=c1.DIN,
	UIDofContactPerson15=c1.UID,
	EmailIdofContactPerson15=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='15'

	/****ADDRESS 16****/
	update
		#mimansa_ucc_mcx_currency_client_data
	set
	NameofContactPerson16=c1.contact_name,
	DesignationofContactPerson16=c1.designation,
	PANofcontactPerson16=c1.PanNo,
	AddressofContactPerson16=c1.Address1 + ' '+  c1.Address2 + ' ' + c1.Address3,
	ContactDetailsofContactPerson16=(case when len(c1.Mobileno)>0 then c1.Mobileno else c1.Phone_no end),
	DINofContactPerson16=c1.DIN,
	UIDofContactPerson16=c1.UID,
	EmailIdofContactPerson16=c1.Email		
	from
		anand1.msajag.dbo.client_contact_details c1 with(nolock)
	where
		ClientCode = cl_code
		and c1.designation in  ('DIRECTOR','KARTA','PARTNER','TRUSTEE')
		and #mimansa_ucc_mcx_currency_client_data.category in ('13','15','16','17')
		and line_no='16'

select distinct
	ClientCode	,
ClientName	,
Category	,
PAN	,
Gender	='',   ---Changed To Blank on Nov 17 2014 Mail From Aniket
FathersHusbandsGuardiansName	= '', --Changed To Blank Nov 17 2014  Mail from Aniket,
MaritalStatus= ''	,--Changed To Blank Nov 17 2014  Mail from Aniket
Nationality	,
NationalityOther	,
ClientEmailID	,
Address1Corresponding	,
Address2Corresponding	,
Address3Corresponding	,
CountryCorresponding	,
StateCityCodeCorresponding	,
PinCodeCorresponding	,
PermanentAddresssameasCorrespondingAddress	,
Address1Permanent	,
Address2Permanent	,
Address3Permanent	,
CountryPermanent	,
StateCityCodePermanent	,
PinCodePermanent	,
TelephoneNumberR	,
MobileNumber	,
TelephoneNumberO	,
DateofBirth_Incorporation	,
UIDNumber	,
BankName1	,
BankBranchAddress1	, --Changed Mail from Aniket Nov 17 2014
BankAccountNumber1	, --Changed Mail from Aniket Nov 17 2014
BankAccountType1	,
BankName2	,
BankBranchAddress2	,
BankAccountNumber2	,
BankAccountType2	,
BankName3	,
BankBranchAddress3	,
BankAccountNumber3	,
BankAccountType3	,
DepositoryName1	,
DepositoryId1	,
BeneficiaryAccountID1	,
DepositoryName2	,
DepositoryId2	,
BeneficiaryAccountID2	,
DepositoryName3	,
DepositoryId3	,
BeneficiaryAccountID3	,
CIN	,
PlaceofIncorporation	,
Occupation =''	, --Changed To Blank Nov 17 2014  Mail from Aniket
OccupationDetailsForOthers	='', --Changed to Blank Nov 17 2014  Mail from Aniket
Dateofcommencementofbusiness	,
IncomedetailsperannuminRs =''	,--Changed to Blank Nov 17 2014  Mail from Aniket
Incomeasondate	='', --Changed to Blank Nov 17 2014  Mail from Aniket
NetworthRs	,
Networthasondate	,
PoliticallyexposedpersonPEP	,
CPCode	,
RegistrationNumberofClient	,
RegisteringAuthority	,
PlaceofRegistration	,
DateofRegistration	,
InpersonVerification	,
ClientAgreementDate	,
Reserved	,
RelationshipCode	,
ProofType	,
ProofNumber	,
IssuePlaceofProof	,
IssueDateofProof	,
ClientStatus	,
Remarks	= 'Account Closure', --Changed to from commented Nov 17 2014  Mail from Aniket
ClientTypeCorporate	,
NameofContactPerson1	,
DesignationofContactPerson1	,
PANofcontactPerson1	,
AddressofContactPerson1	,
ContactDetailsofContactPerson1	,
DINofContactPerson1	,
UIDofContactPerson1	,
EmailIdofContactPerson1	,
NameofContactPerson2	,
DesignationofContactPerson2	,
PANofcontactPerson2	,
AddressofContactPerson2	,
ContactDetailsofContactPerson2	,
DINofContactPerson2	,
UIDofContactPerson2	,
EmailIdofContactPerson2	,
NameofContactPerson3	,
DesignationofContactPerson3	,
PANofcontactPerson3	,
AddressofContactPerson3	,
ContactDetailsofContactPerson3	,
DINofContactPerson3	,
UIDofContactPerson3	,
EmailIdofContactPerson3	,
NameofContactPerson4	,
DesignationofContactPerson4	,
PANofcontactPerson4	,
AddressofContactPerson4	,
ContactDetailsofContactPerson4	,
DINofContactPerson4	,
UIDofContactPerson4	,
EmailIdofContactPerson4	,
NameofContactPerson5	,
DesignationofContactPerson5	,
PANofcontactPerson5	,
AddressofContactPerson5	,
ContactDetailsofContactPerson5	,
DINofContactPerson5	,
UIDofContactPerson5	,
EmailIdofContactPerson5	,
NameofContactPerson6	,
DesignationofContactPerson6	,
PANofcontactPerson6	,
AddressofContactPerson6	,
ContactDetailsofContactPerson6	,
DINofContactPerson6	,
UIDofContactPerson6	,
EmailIdofContactPerson6	,
NameofContactPerson7	,
DesignationofContactPerson7	,
PANofcontactPerson7	,
AddressofContactPerson7	,
ContactDetailsofContactPerson7	,
DINofContactPerson7	,
UIDofContactPerson7	,
EmailIdofContactPerson7	,
NameofContactPerson8	,
DesignationofContactPerson8	,
PANofcontactPerson8	,
AddressofContactPerson8	,
ContactDetailsofContactPerson8	,
DINofContactPerson8	,
UIDofContactPerson8	,
EmailIdofContactPerson8	,
NameofContactPerson9	,
DesignationofContactPerson9	,
PANofcontactPerson9	,
AddressofContactPerson9	,
ContactDetailsofContactPerson9	,
DINofContactPerson9	,
UIDofContactPerson9	,
EmailIdofContactPerson9	,
NameofContactPerson10	,
DesignationofContactPerson10	,
PANofcontactPerson10	,
AddressofContactPerson10	,
ContactDetailsofContactPerson10	,
DINofContactPerson10	,
UIDofContactPerson10	,
EmailIdofContactPerson10	,
NameContactofPerson11	,
DesignationofContactPerson11	,
PANofcontactPerson11	,
AddressofContactPerson11	,
ContactDetailsofContactPerson11	,
DINofContactPerson11	,
UIDofContactPerson11	,
EmailIdofContactPerson11	,
NameofContactPerson12	,
DesignationofContactPerson12	,
PANofcontactPerson12	,
AddressofContactPerson12	,
ContactDetailsofContactPerson12	,
DINofContactPerson12	,
UIDofContactPerson12	,
EmailIdofContactPerson12	,
NameofContactPerson13	,
DesignationofContactPerson13	,
PANofcontactPerson13	,
AddressofContactPerson13	,
ContactDetailsofContactPerson13	,
DINofContactPerson13	,
UIDofContactPerson13	,
EmailIdofContactPerson13	,
NameofContactPerson14	,
DesignationofContactPerson14	,
PANofcontactPerson14	,
AddressofContactPerson14	,
ContactDetailsofContactPerson14	,
DINofContactPerson14,
UIDofContactPerson14	,
EmailIdofContactPerson14	,
NameofContactPerson15	,
DesignationofContactPerson15	,
PANofcontactPerson15	,
AddressofContactPerson15	,
ContactDetailsofContactPerson15	,
DINofContactPerson15	,
UIDofContactPerson15	,
EmailIdofContactPerson15	,
NameofContactPerson16	,
DesignationofContactPerson16	,
PANofcontactPerson16	,
AddressofContactPerson16	,
ContactDetailsofContactPerson16	,
DINofContactPerson16	,
UIDofContactPerson16	,
EmailIdofContactPerson16	,
NameofContactPerson17	,
DesignationofContactPerson17	,
PANofcontactPerson17	,
AddressofContactPerson17	,
ContactDetailsofContactPerson17	,
DINofContactPerson17	,
UIDofContactPerson17	,
EmailIdofContactPerson17	,
NameofContactPerson18	,
DesignationofContactPerson18	,
PANofcontactPerson18	,
AddressofContactPerson18	,
ContactDetailsofContactPerson18	,
DINofContactPerson18	,
UIDofContactPerson18	,
EmailIdofContactPerson18	,
NameofContactPerson19	,
DesignationofContactPerson19	,
PANofcontactPerson19	,
AddressofContactPerson19	,
ContactDetailsofContactPerson19	,
DINofContactPerson19	,
UIDofContactPerson19	,
EmailIdofContactPerson19	,
NameofContactPerson20	,
DesignationofContactPerson20	,
PANofcontactPerson20	,
AddressofContactPerson20	,
ContactDetailsofContactPerson20	,
DINofContactPerson20	,
UIDofContactPerson20	,
EmailIdofContactPerson20	,
/*Added by Priyanka B on 30 Nov2017 As Per MCX Circular given By Ajaykumar Gupta*/
[RelatiomshipwithclientforMobile],
[NameoftheAuthorisedOrContactpersonforMobile],
[RelatiomshipwithclientforEmail],
[NameoftheAuthorisedOrContactpersonforEmail],
Flag	

from
	#mimansa_ucc_mcx_currency_client_data with(nolock)
where
	len(ClientCode) > 0
	and 
		len(pan) > 0 
order by
	ClientCode


/*Insert Log*/
--if exists(select * from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime))
--begin
--	update mimansa_tbl_ucc_mcx_currency_file_count 
--	set file_number=file_number+1
--	where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)
--end
--else
--begin
--	insert into mimansa_tbl_ucc_mcx_currency_file_count(exchange,file_number,time_stamp)
--	select 'MCX-SX',1,getdate()
--end

/*Display File Number
File NAme Syntax: MCX-SX_<DDMMYYYY>_UCC10500<_selected_clients>.M<LastFileNumber+1>
				Ex- MCX-SX_20032014_UCC10500.M01
					OR 
					MCX-SX_20032014_UCC10500_selected_clients.M01
First Row : 10,M,10500,<DDMMYYYY>,<LastFileNumber+1>,<Total Rows>
			Ex- 10,M,10500,20032014,03,12
*/

--select FileName='MCX-SX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC10500'+(case when isnull(@processid,'')<>'' then '_selected_clients' else '' end)+
--					'.M'+(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end),
					
--		FirstRow='10,M,10500,'+replace(convert(varchar, getdate(), 103), '/', '')+','+
--						(case when file_number<10 then  '0'+cast(file_number  as varchar) else cast(file_number  as varchar) end)+','
--						+cast((select count(*) from #mimansa_ucc_mcx_currency_client_data) as varchar)
--from mimansa_tbl_ucc_mcx_currency_file_count with(nolock) where exchange='MCX-SX' and time_stamp>=cast(left(getdate(),11) as datetime)

declare @totalrecord numeric

select @totalrecord=count(*)  from #mimansa_ucc_mcx_currency_client_data with(nolock)	
where len(ClientCode) > 0
	and 
		len(pan) > 0 
--Display File Name and First Row
/*
File NAme Syntax: MCX_DDMMYYYY_UCC12685.txt
				Ex- MCX_25022014_UCC12685.txt
First Row Syntax: 10,M,12685,DDMMYYYY,01,TOTALROWS
				Ex- 10,M,12685,14052014,01,22
*/
select FileName='MCX_'+replace(convert(varchar, getdate(), 103), '/', '')+'_UCC12685'+(case when isnull(@processid,'')<>'' then '_Inactive_clients' else '' end)+'.txt',					
	   FirstRow='10,M,12685,'+replace(convert(varchar, getdate(), 103), '/', '')+',01,'++cast(@totalrecord  as varchar) 

/*DISPLAY INVALID PAN*/
select Client_Code,Client_Name,PAN 
from #invalidPan

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_modification_client_data_RITESH
-- --------------------------------------------------
CREATE proc

	[dbo].[usp_mimansa_ucc_mcx_modification_client_data_RITESH]
	(
	   @processid varchar(50)
	)
as 
/*
[usp_mimansa_ucc_mcx_modification_client_data_RITESH] '1i4n4nz5s5dximr31hlyeu0w01012018_171209'
*/
begin


CREATE TABLE #mimansa_ucc_mcx_Modification_client_data(
	[ClientCode] [varchar](10) NULL,
	[MobileNumber] [varchar](20) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[AADHAR_No] [varchar](12) NULL,
	Reserved [varchar](60) NULL,
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL
	)

insert into #mimansa_ucc_mcx_Modification_client_data
select Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
Email=ltrim(rtrim(isnull(Email,''))),
[AADHAR_No]='',
Reserved ='',
[RelatiomshipwithclientforMobile]='',
[NameoftheAuthorisedOrContactpersonforMobile]='',
[RelatiomshipwithclientforEmail]='',
[NameoftheAuthorisedOrContactpersonforEmail]=''
from tblUCCClientCode t1 with(nolock), 
		anand1.msajag.dbo.Client_Details c1 with(nolock)	
where t1.party_code=c1.cl_code
	and t1.processid=@processid	

	/*Delete selected clients*/	
		delete from tblUCCClientCode where processid=@processid	

update #mimansa_ucc_mcx_Modification_client_data set
[AADHAR_No]=(case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
from anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0

update #mimansa_ucc_mcx_Modification_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


select [ClientCode],
	[MobileNumber] ,
	[ClientEmailID],
	[AADHAR_No],
	Reserved,
	[RelatiomshipwithclientforMobile],
	[NameoftheAuthorisedOrContactpersonforMobile] ,
	[RelatiomshipwithclientforEmail] ,
	[NameoftheAuthorisedOrContactpersonforEmail] 
	from #mimansa_ucc_mcx_Modification_client_data

	select FileName='ucc_mcx_currency_modified_client_data.txt',
		   FirstRow=''

/*DISPLAY INVALID PAN*/
	select Client_Code='',Client_Name='',PAN =''
	where 1=0


	drop table #mimansa_ucc_mcx_Modification_client_data
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_modification_client_data_RITESH_DateRangeWise
-- --------------------------------------------------


CREATE proc

	[dbo].[usp_mimansa_ucc_mcx_modification_client_data_RITESH_DateRangeWise]
	(
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20)
	)
as 

begin
Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	create table #TempTable1
		(Client_Code varchar(20),
		Client_Name varchar(100),
		Pan_No varchar(20),
		Client_Type varchar(100),
		App_Form_No varchar(20),
		Com_Form_No varchar(20),
		Mod_Form_No varchar(20),
		Bo_Category varchar(20),
		Bo_ClientType varchar(20),
		branch varchar(30),
		subbroker varchar(20),
		process_status varchar(200),
		document_Type varchar(20),
		Initiated_Date varchar(20),
		Modified_date varchar(20),
		Ho_Recd_Dt varchar(20),
		verf_dt varchar(20),
		Verf_name varchar(30),
		Aud_Obj_DT varchar(20),
		Aud_Obj_Name varchar(30),
		Aud_DT varchar(20),
		Aud_Name varchar(30),
		CRN_No varchar(20),
		Dp_Batch_No varchar(20),
		Modification_type varchar(100),
		Request_Type varchar(20),
		DP_ID varchar(100))

       insert into #TempTable1
       exec ABVSCITRUS.CRMDB_A.dbo.pr_clientlisting_mod @@FromDate,@@ToDate,'0',3,'HO','HO'
	   declare @@FromDate1 datetime
       set @@FromDate1=convert(datetime,@@FromDate)
	   declare @@ToDate1 datetime
       set @@ToDate1=convert(datetime,@@ToDate)


    select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

	insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(c5.cl_code, '')))
		from anand1.msajag.dbo.CLIENT_M_CI c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code=c1.cl_code
				and c1.cl_code>=@@FromClientCode
				and c1.cl_code<=@@ToClientCode
				and c1.UPDTIME >= @@FromDate
				and c1.UPDTIME <= @@ToDate	
				and c5.InactiveFrom>@@getdate
		union
		select distinct cl_code = ltrim(rtrim(isnull(c1.client_code, '')))
		from #TempTable1 c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where (c1.Modification_type like 'MOBILE%' or c1.Modification_type like 'Email%')	
		        and c5.cl_code=c1.client_code
		        and c1.client_code>=@@FromClientCode
				and c1.client_code<=@@ToClientCode
				and left(convert(varchar(30), c1.Modified_Date,109),10) >=convert(varchar,@@FromDate1,103)
				and left(convert(varchar(30), c1.Modified_Date,109),10) <=convert(varchar,@@ToDate1,103)
				and c5.InactiveFrom>@@getdate	

		

	CREATE TABLE #mimansa_ucc_mcx_Modification_client_data(
	[ClientCode] [varchar](10) NULL,
	[MobileNumber] [varchar](20) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[AADHAR_No] [varchar](12) NULL,
	Reserved [varchar](60) NULL,
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL
	)

insert into #mimansa_ucc_mcx_Modification_client_data
select Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
Email=ltrim(rtrim(isnull(Email,''))),
[AADHAR_No]='',
Reserved ='',
[RelatiomshipwithclientforMobile]='',
[NameoftheAuthorisedOrContactpersonforMobile]='',
[RelatiomshipwithclientforEmail]='',
[NameoftheAuthorisedOrContactpersonforEmail]=''
from #codes_to_process t1 with(nolock), 
		anand1.msajag.dbo.Client_Details c1 with(nolock)	
where t1.party_code=c1.cl_code

	

update #mimansa_ucc_mcx_Modification_client_data set
[AADHAR_No]=(case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
from anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0

update #mimansa_ucc_mcx_Modification_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from ABVSCITRUS.CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


select [ClientCode],
	[MobileNumber] ,
	[ClientEmailID],
	[AADHAR_No],
	Reserved,
	[RelatiomshipwithclientforMobile],
	[NameoftheAuthorisedOrContactpersonforMobile] ,
	[RelatiomshipwithclientforEmail] ,
	[NameoftheAuthorisedOrContactpersonforEmail] 
	from #mimansa_ucc_mcx_Modification_client_data

	declare @RecordCount varchar(20)
	set @RecordCount=(select count(1) from #mimansa_ucc_mcx_Modification_client_data)

	/* Below file name & First row changed by Dinesh jadhav on Feb 4 2019 as per suggested by Ajaykumar Gupta */
	select FileName='MCX_' + REPLACE(convert(varchar(11),GETDATE(),103),'/','')+'_UCCBULK12685.M01',
		   FirstRow='10,M,12685,'+REPLACE(convert(varchar(11),GETDATE(),103),'/','')+ ',01,'+@RecordCount

		   

/*DISPLAY INVALID PAN*/
	select Client_Code='',Client_Name='',PAN =''
	where 1=0


	drop table #mimansa_ucc_mcx_Modification_client_data
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mimansa_ucc_mcx_modification_client_data_RITESH_DateRangeWise_Backup04Feb2019
-- --------------------------------------------------


CREATE proc

	[dbo].[usp_mimansa_ucc_mcx_modification_client_data_RITESH_DateRangeWise_Backup04Feb2019]
	(
	@from_date varchar(20),
	@to_date varchar(20),
	@ClientCode varchar(20)
	)
as 

begin
Declare @@FromDate datetime,@@ToDate datetime,@@getdate datetime,
			@@FromClientCode varchar(20),@@ToClientCode varchar(20)

	if isnull(@from_date,'')='' or isnull(@to_date,'')=''
	begin
		set @@FromDate='Jan  1 1900'
		set @@ToDate='Dec 31 2078'
	end
	else
	begin
		set @@FromDate=@from_date
		set @@ToDate=@to_date+' 23:59'
	end

	if isnull(@ClientCode,'')=''
	begin
		set @@FromClientCode='A'
		set @@ToClientCode='ZZZZZZZZZZ'
	end
	else
	begin
		set @@FromClientCode=@ClientCode
		set @@ToClientCode=@ClientCode
	end

	set @@getdate=left(getdate(),11)+' 23:59'

	create table #TempTable1
		(Client_Code varchar(20),
		Client_Name varchar(100),
		Pan_No varchar(20),
		Client_Type varchar(100),
		App_Form_No varchar(20),
		Com_Form_No varchar(20),
		Mod_Form_No varchar(20),
		Bo_Category varchar(20),
		Bo_ClientType varchar(20),
		branch varchar(30),
		subbroker varchar(20),
		process_status varchar(200),
		document_Type varchar(20),
		Initiated_Date varchar(20),
		Modified_date varchar(20),
		Ho_Recd_Dt varchar(20),
		verf_dt varchar(20),
		Verf_name varchar(30),
		Aud_Obj_DT varchar(20),
		Aud_Obj_Name varchar(30),
		Aud_DT varchar(20),
		Aud_Name varchar(30),
		CRN_No varchar(20),
		Dp_Batch_No varchar(20),
		Modification_type varchar(100),
		Request_Type varchar(20),
		DP_ID varchar(100))

       insert into #TempTable1
       exec [172.31.16.57].CRMDB_A.dbo.pr_clientlisting_mod @@FromDate,@@ToDate,'0',3,'HO','HO'
	   declare @@FromDate1 datetime
       set @@FromDate1=convert(datetime,@@FromDate)
	   declare @@ToDate1 datetime
       set @@ToDate1=convert(datetime,@@ToDate)


    select party_code = convert(varchar(10), '') into #codes_to_process where 1 = 0

	insert into #codes_to_process
		select distinct party_code = ltrim(rtrim(isnull(c5.cl_code, '')))
		from anand1.msajag.dbo.CLIENT_M_CI c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where			
			c5.cl_code=c1.cl_code
				and c1.cl_code>=@@FromClientCode
				and c1.cl_code<=@@ToClientCode
				and c1.UPDTIME >= @@FromDate
				and c1.UPDTIME <= @@ToDate	
				and c5.InactiveFrom>@@getdate
		union
		select distinct cl_code = ltrim(rtrim(isnull(c1.client_code, '')))
		from #TempTable1 c1  with(nolock),angelcommodity.mcdx.dbo.client5 c5 with(nolock)
		where (c1.Modification_type like 'MOBILE%' or c1.Modification_type like 'Email%')	
		        and c5.cl_code=c1.client_code
		        and c1.client_code>=@@FromClientCode
				and c1.client_code<=@@ToClientCode
				and left(convert(varchar(30), c1.Modified_Date,109),10) >=convert(varchar,@@FromDate1,103)
				and left(convert(varchar(30), c1.Modified_Date,109),10) <=convert(varchar,@@ToDate1,103)
				and c5.InactiveFrom>@@getdate	

		

	CREATE TABLE #mimansa_ucc_mcx_Modification_client_data(
	[ClientCode] [varchar](10) NULL,
	[MobileNumber] [varchar](20) NULL,
	[ClientEmailID] [varchar](60) NULL,
	[AADHAR_No] [varchar](12) NULL,
	Reserved [varchar](60) NULL,
	[RelatiomshipwithclientforMobile] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforMobile] [varchar](100) NULL,
	[RelatiomshipwithclientforEmail] [varchar](100) NULL,
	[NameoftheAuthorisedOrContactpersonforEmail] [varchar](100) NULL
	)

insert into #mimansa_ucc_mcx_Modification_client_data
select Cl_Code=ltrim(rtrim(isnull(c1.Cl_Code,''))),
Mobile_Pager=dbo.strip_non_digit(ltrim(rtrim(isnull(Mobile_Pager,'')))),
Email=ltrim(rtrim(isnull(Email,''))),
[AADHAR_No]='',
Reserved ='',
[RelatiomshipwithclientforMobile]='',
[NameoftheAuthorisedOrContactpersonforMobile]='',
[RelatiomshipwithclientforEmail]='',
[NameoftheAuthorisedOrContactpersonforEmail]=''
from #codes_to_process t1 with(nolock), 
		anand1.msajag.dbo.Client_Details c1 with(nolock)	
where t1.party_code=c1.cl_code

	

update #mimansa_ucc_mcx_Modification_client_data set
[AADHAR_No]=(case when len(ltrim(rtrim(isnull(c1.AADHAR_UID,''))))>12 then '' else ltrim(rtrim(isnull(c1.AADHAR_UID,''))) end)
from anand1.msajag.dbo.CLIENT_MASTER_UCC_DATA c1 with(nolock)
where
		ClientCode = party_code
		and len(isnull(ClientCode, '')) > 0
		and len(isnull(party_code, '')) > 0

update #mimansa_ucc_mcx_Modification_client_data set
[RelatiomshipwithclientforMobile]=case when isnull(ltrim(rtrim(RELATION_CLIENT_MOBILE)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_MOBILE)) end,
[NameoftheAuthorisedOrContactpersonforMobile]=ltrim(rtrim(CONTACT_PERSON_NAME_MOBILE)),
[RelatiomshipwithclientforEmail]=case when isnull(ltrim(rtrim(RELATION_CLIENT_EMAIL)),'')='' then '1'
else ltrim(rtrim(RELATION_CLIENT_EMAIL)) end,
[NameoftheAuthorisedOrContactpersonforEmail]=ltrim(rtrim(CONTACT_PERSON_NAME_EMAIL))
from [172.31.16.57].CRMDB_A.DBO.Api_Kyc with(nolock)
where ClientCode = BOPARTYCODE


select [ClientCode],
	[MobileNumber] ,
	[ClientEmailID],
	[AADHAR_No],
	Reserved,
	[RelatiomshipwithclientforMobile],
	[NameoftheAuthorisedOrContactpersonforMobile] ,
	[RelatiomshipwithclientforEmail] ,
	[NameoftheAuthorisedOrContactpersonforEmail] 
	from #mimansa_ucc_mcx_Modification_client_data

	select FileName='ucc_mcx_currency_modified_client_data.txt',
		   FirstRow=''

/*DISPLAY INVALID PAN*/
	select Client_Code='',Client_Name='',PAN =''
	where 1=0


	drop table #mimansa_ucc_mcx_Modification_client_data
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_ncdx_reco1
-- --------------------------------------------------
        
CREATE PROCEDURE usp_ncdx_reco1                     
 as                       
set nocount on                       
set transaction isolation level read uncommitted             
        
/*RECO - check reconsiled suspense a/c with unrecosiled client ledger */          
          
select * into #ncdx_cr from ACCOUNTNCDX.DBO.ledger (nolock) where vdt >=getdate()-60 and vtyp=2 and drcr='C' and  cltcode='5100000001'          
          
select * into #ncdx_dr from ACCOUNTNCDX.DBO.ledger (nolock) where vdt >=getdate()-60 and vtyp=3 and drcr='D' and  cltcode='5100000001'          
          
select ddno,vno,lno,reldt into #chqnodr from ACCOUNTNCDX.DBO.ledger1 (nolock) where vtyp=3 and vno >='200801010000'            
              
select ddno,vno,lno,reldt into #chqno from ACCOUNTNCDX.DBO.ledger1 (nolock) where vtyp=2 and vno >='200801010000'                
          
select a.*,b.ddno,b.reldt into #ncdx1dr from #ncdx_dr a, #chqnodr b where a.vno=b.vno and a.lno=b.lno                
          
select a.*,b.ddno,b.reldt into #ncdx1 from #ncdx_cr a, #chqno b where a.vno=b.vno and a.lno=b.lno                
          
delete from #ncdx1 where cltcode+'|'+convert(varchar(25),ddno) in (select cltcode+'|'+convert(varchar(25),ddno)  from #ncdx1dr)            
          
delete from mis.bse.dbo.ncdx_reco1           
          
select  a.vtyp,a.vno,a.vdt,a.drcr,a.vamt,a.ddno,b.cltcode,b.ddno as ddno1,b.cramt,a.reldt ,a.edt, a.narration into #temp        
          
from          
          
(select * from #ncdx1  where cltcode='5100000001'  and reldt <> 'Jan  1 1900') a,          
          
ACCOUNTNCDX.DBO.angel_client_deposit_recno b where a.ddno=b.ddno and a.vamt=b.cramt          
          
insert into mis.bse.dbo.ncdx_reco1           
select  a.*,b.cltcode,b.acname from #temp a inner join ACCOUNTNCDX.DBO.ledger b on a.vno=b.vno where b.drcr='d'and b.vtyp='2'             
      
----------------- check for unreconsiled suspense account          
          
--select * from #ncdx1  where cltcode='5100000001' and reldt ='Jan  1 1900'          
          
          
delete mis.bse.dbo.ncdx_noreco           
select vtyp,vno,edt,acname,drcr,vamt,balamt,cltcode,ddno,vdt,narration into #temp1 from #ncdx1  where cltcode='5100000001' and reldt ='Jan  1 1900'          
insert into  mis.bse.dbo.ncdx_noreco           
select a.*,b.cltcode,b.acname from #temp1 a inner join ACCOUNTNCDX.DBO.ledger b on a.vno=b.vno where b.drcr='d' and b.vtyp='2'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Worst_TSQL
-- --------------------------------------------------
CREATE PROC [dbo].[usp_Worst_TSQL] 
/*

Created By BBG NOV 22 2012 to check the performance of server
Written by: Gregory A. Larsen
Copyright  2008 Gregory A. Larsen.  All rights reserved.

Name: usp_Worst_TSQL
Description: This stored procedure displays the top worst performing queries based on CPU, Execution Count, 
             I/O and Elapsed_Time as identified using DMV information.  This can be display the worst 
             performing queries from an instance, or database perspective.   The number of records shown,
             the database, and the sort order are identified by passing pararmeters.

Parameters:  There are three different parameters that can be passed to this procedures: @DBNAME, @COUNT
             and @ORDERBY.  The @DBNAME is used to constraint the output to a specific database.  If  
             when calling this SP this parameter is set to a specific database name then only statements 
             that are associated with that database will be displayed.  If the @DBNAME parameter is not set
             then this SP will return rows associated with any database.  The @COUNT parameter allows you 
             to control the number of rows returned by this SP.  If this parameter is used then only the 
             TOP x rows, where x is equal to @COUNT will be returned, based on the @ORDERBY parameter.
             The @ORDERBY parameter identifies the sort order of the rows returned in descending order.  
             This @ORDERBY parameters supports the following type: CPU, AE, TE, EC or AIO, TIO, ALR, TLR, ALW, TLW, APR, and TPR 
             where "ACPU" represents Average CPU Usage
                   "TCPU" represents Total CPU usage 
                   "AE"   represents Average Elapsed Time
                   "TE"   represents Total Elapsed Time
                   "EC"   represents Execution Count
                   "AIO"  represents Average IOs
                   "TIO"  represents Total IOs 
                   "ALR"  represents Average Logical Reads
                   "TLR"  represents Total Logical Reads              
                   "ALW"  represents Average Logical Writes
                   "TLW"  represents Total Logical Writes
                   "APR"  represents Average Physical Reads
                   "TPR"  represents Total Physical Read

Typical execution calls
   
   Top 6 statements in the AdventureWorks database base on Average CPU Usage:
      EXEC usp_Worst_TSQL @DBNAME='AdventureWorks',@COUNT=6,@ORDERBY='ACPU';
   
   Top 100 statements order by Average IO 
      EXEC usp_Worst_TSQL @COUNT=100,@ORDERBY='TIO'; 

   Show top all statements by Average IO 
      EXEC usp_Worst_TSQL;
select 1341052 - 1346783
select 1357751 - 1346783
select 2901489 - 2906112

select 2921502 - 2926280
Select 2921422 - 2926199
Select 937490 - 937490



*/
(@DBNAME VARCHAR(128) = '<not supplied>'
 ,@COUNT INT = 999999999
 ,@ORDERBY VARCHAR(4) = 'AIO')
AS
-- Check for valid @ORDERBY parameter
IF ((SELECT CASE WHEN 
          @ORDERBY in ('ACPU','TCPU','AE','TE','EC','AIO','TIO','ALR','TLR','ALW','TLW','APR','TPR') 
             THEN 1 ELSE 0 END) = 0)
BEGIN 
   -- abort if invalid @ORDERBY parameter entered
   RAISERROR('@ORDERBY parameter not APCU, TCPU, AE, TE, EC, AIO, TIO, ALR, TLR, ALW, TLW, APR or TPR',11,1)
   RETURN
 END
 SELECT TOP (@COUNT) 
         COALESCE(DB_NAME(st.dbid), 
                  DB_NAME(CAST(pa.value AS INT))+'*', 
                 'Resource') AS [Database Name]  
         -- find the offset of the actual statement being executed
         ,SUBSTRING(text, 
                   CASE WHEN statement_start_offset = 0 
                          OR statement_start_offset IS NULL  
                           THEN 1  
                           ELSE statement_start_offset/2 + 1 END, 
                   CASE WHEN statement_end_offset = 0 
                          OR statement_end_offset = -1  
                          OR statement_end_offset IS NULL  
                           THEN LEN(text)  
                           ELSE statement_end_offset/2 END - 
                     CASE WHEN statement_start_offset = 0 
                            OR statement_start_offset IS NULL 
                             THEN 1  
                             ELSE statement_start_offset/2  END + 1 
                  )  AS [Statement]  
         ,OBJECT_SCHEMA_NAME(st.objectid,dbid) [Schema Name] 
         ,OBJECT_NAME(st.objectid,dbid) [Object Name]   
         ,objtype [Cached Plan objtype] 
         ,execution_count [Execution Count]  
         ,(total_logical_reads + total_logical_writes + total_physical_reads )/execution_count [Average IOs] 
         ,total_logical_reads + total_logical_writes + total_physical_reads [Total IOs]  
         ,total_logical_reads/execution_count [Avg Logical Reads] 
         ,total_logical_reads [Total Logical Reads]  
         ,total_logical_writes/execution_count [Avg Logical Writes]  
         ,total_logical_writes [Total Logical Writes]  
         ,total_physical_reads/execution_count [Avg Physical Reads] 
         ,total_physical_reads [Total Physical Reads]   
         ,total_worker_time / execution_count [Avg CPU] 
         ,total_worker_time [Total CPU] 
         ,total_elapsed_time / execution_count [Avg Elapsed Time] 
         ,total_elapsed_time  [Total Elasped Time] 
         ,last_execution_time [Last Execution Time]  
    FROM sys.dm_exec_query_stats qs  
    JOIN sys.dm_exec_cached_plans cp ON qs.plan_handle = cp.plan_handle 
    CROSS APPLY sys.dm_exec_sql_text(qs.plan_handle) st 
    OUTER APPLY sys.dm_exec_plan_attributes(qs.plan_handle) pa 
    WHERE attribute = 'dbid' AND  
     CASE when @DBNAME = '<not supplied>' THEN '<not supplied>'
                               ELSE COALESCE(DB_NAME(st.dbid), 
                                          DB_NAME(CAST(pa.value AS INT)) + '*', 
                                          'Resource') END
                                    IN (RTRIM(@DBNAME),RTRIM(@DBNAME) + '*')  
      
    ORDER BY CASE 
                WHEN @ORDERBY = 'ACPU' THEN total_worker_time / execution_count 
                WHEN @ORDERBY = 'TCPU'  THEN total_worker_time
                WHEN @ORDERBY = 'AE'   THEN total_elapsed_time / execution_count
                WHEN @ORDERBY = 'TE'   THEN total_elapsed_time  
                WHEN @ORDERBY = 'EC'   THEN execution_count
                WHEN @ORDERBY = 'AIO'  THEN (total_logical_reads + total_logical_writes + total_physical_reads) / execution_count  
                WHEN @ORDERBY = 'TIO'  THEN total_logical_reads + total_logical_writes + total_physical_reads
                WHEN @ORDERBY = 'ALR'  THEN total_logical_reads  / execution_count
                WHEN @ORDERBY = 'TLR'  THEN total_logical_reads 
                WHEN @ORDERBY = 'ALW'  THEN total_logical_writes / execution_count
                WHEN @ORDERBY = 'TLW'  THEN total_logical_writes  
                WHEN @ORDERBY = 'APR'  THEN total_physical_reads / execution_count 
                WHEN @ORDERBY = 'TPR'  THEN total_physical_reads
           END DESC

GO

-- --------------------------------------------------
-- TABLE dbo._temp_mcx_client_data_new
-- --------------------------------------------------
CREATE TABLE [dbo].[_temp_mcx_client_data_new]
(
    [client code] VARCHAR(10) NULL,
    [client first name] VARCHAR(8000) NULL,
    [middle name] VARCHAR(8000) NULL,
    [last name] VARCHAR(8000) NULL,
    [category] VARCHAR(2) NOT NULL,
    [client address1] VARCHAR(40) NULL,
    [address 2] VARCHAR(40) NULL,
    [address 3] VARCHAR(40) NULL,
    [city] VARCHAR(40) NULL,
    [state] VARCHAR(50) NULL,
    [country] VARCHAR(15) NULL,
    [pin code] VARCHAR(10) NULL,
    [telephone number] VARCHAR(8000) NULL,
    [client agreement date] VARCHAR(8000) NULL,
    [date of birth] VARCHAR(8000) NULL,
    [pan number] VARCHAR(50) NULL,
    [ward number] VARCHAR(50) NULL,
    [uin] VARCHAR(1) NULL,
    [bank name] VARCHAR(50) NULL,
    [bank branch address] VARCHAR(194) NULL,
    [bank account number] VARCHAR(20) NULL,
    [bank account type] VARCHAR(7) NULL,
    [depository name (nsdl)] VARCHAR(4) NOT NULL,
    [depository participant id (nsdl)] VARCHAR(20) NULL,
    [depository participant name (nsdl)] VARCHAR(50) NULL,
    [beneficiary account id (nsdl)] VARCHAR(16) NULL,
    [depository name (cdsl)] VARCHAR(4) NOT NULL,
    [depository participant id (cdsl)] VARCHAR(20) NULL,
    [depository participant name (cdsl)] VARCHAR(50) NULL,
    [beneficiary account id (cdsl)] VARCHAR(16) NULL,
    [passport number] VARCHAR(30) NULL,
    [place of issue of passport] VARCHAR(30) NULL,
    [date of issue of passport] VARCHAR(8000) NULL,
    [expiry date of passport] VARCHAR(8000) NULL,
    [driving license number] VARCHAR(30) NULL,
    [place of issue of driving license number] VARCHAR(30) NULL,
    [date of issue of driving license number] VARCHAR(8000) NULL,
    [expiry date of driving license number] VARCHAR(8000) NULL,
    [voter id] VARCHAR(30) NULL,
    [place of issue of voter id number] VARCHAR(30) NULL,
    [date of issue of voter id number] VARCHAR(8000) NULL,
    [ration card number] VARCHAR(30) NULL,
    [place of issue of ration card number] VARCHAR(30) NULL,
    [date of issue of ration card number] VARCHAR(8000) NULL,
    [registration number of client] VARCHAR(50) NULL,
    [registering authority] VARCHAR(50) NULL,
    [place of registration] VARCHAR(50) NULL,
    [date of registration] VARCHAR(8000) NULL,
    [introducers name] VARCHAR(30) NULL,
    [introducers client id] VARCHAR(50) NULL,
    [relationship with the introducer] VARCHAR(50) NULL,
    [dealing with other member] VARCHAR(1) NOT NULL,
    [relationship code] VARCHAR(10) NOT NULL,
    [status] CHAR(1) NOT NULL,
    [flag] VARCHAR(1) NULL,
    [sms_email_status] CHAR(10) NULL,
    [mobile_number] VARCHAR(25) NULL,
    [email_id] VARCHAR(500) NULL,
    [reserved] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo._temp_mcx_client_data_new_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[_temp_mcx_client_data_new_temp]
(
    [client code] VARCHAR(10) NULL,
    [client first name] VARCHAR(8000) NULL,
    [middle name] VARCHAR(8000) NULL,
    [last name] VARCHAR(8000) NULL,
    [category] VARCHAR(2) NOT NULL,
    [client address1] VARCHAR(40) NULL,
    [address 2] VARCHAR(40) NULL,
    [address 3] VARCHAR(40) NULL,
    [city] VARCHAR(40) NULL,
    [state] VARCHAR(50) NULL,
    [country] VARCHAR(15) NULL,
    [pin code] VARCHAR(10) NULL,
    [telephone number] VARCHAR(8000) NULL,
    [client agreement date] VARCHAR(8000) NULL,
    [date of birth] VARCHAR(8000) NULL,
    [pan number] VARCHAR(50) NULL,
    [ward number] VARCHAR(50) NULL,
    [uin] VARCHAR(1) NULL,
    [bank name] VARCHAR(50) NULL,
    [bank branch address] VARCHAR(194) NULL,
    [bank account number] VARCHAR(20) NULL,
    [bank account type] VARCHAR(7) NULL,
    [depository name (nsdl)] VARCHAR(4) NOT NULL,
    [depository participant id (nsdl)] VARCHAR(20) NULL,
    [depository participant name (nsdl)] VARCHAR(50) NULL,
    [beneficiary account id (nsdl)] VARCHAR(16) NULL,
    [depository name (cdsl)] VARCHAR(4) NOT NULL,
    [depository participant id (cdsl)] VARCHAR(20) NULL,
    [depository participant name (cdsl)] VARCHAR(50) NULL,
    [beneficiary account id (cdsl)] VARCHAR(16) NULL,
    [passport number] VARCHAR(30) NULL,
    [place of issue of passport] VARCHAR(30) NULL,
    [date of issue of passport] VARCHAR(8000) NULL,
    [expiry date of passport] VARCHAR(8000) NULL,
    [driving license number] VARCHAR(30) NULL,
    [place of issue of driving license number] VARCHAR(30) NULL,
    [date of issue of driving license number] VARCHAR(8000) NULL,
    [expiry date of driving license number] VARCHAR(8000) NULL,
    [voter id] VARCHAR(30) NULL,
    [place of issue of voter id number] VARCHAR(30) NULL,
    [date of issue of voter id number] VARCHAR(8000) NULL,
    [ration card number] VARCHAR(30) NULL,
    [place of issue of ration card number] VARCHAR(30) NULL,
    [date of issue of ration card number] VARCHAR(8000) NULL,
    [registration number of client] VARCHAR(50) NULL,
    [registering authority] VARCHAR(50) NULL,
    [place of registration] VARCHAR(50) NULL,
    [date of registration] VARCHAR(8000) NULL,
    [introducers name] VARCHAR(30) NULL,
    [introducers client id] VARCHAR(50) NULL,
    [relationship with the introducer] VARCHAR(50) NULL,
    [dealing with other member] VARCHAR(1) NOT NULL,
    [relationship code] VARCHAR(10) NOT NULL,
    [status] CHAR(1) NOT NULL,
    [flag] VARCHAR(1) NULL,
    [sms_email_status] CHAR(10) NULL,
    [mobile_number] VARCHAR(15) NULL,
    [email_id] VARCHAR(500) NULL,
    [reserved] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo._temp_mcx_client_data_new_temp1
-- --------------------------------------------------
CREATE TABLE [dbo].[_temp_mcx_client_data_new_temp1]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [client code] VARCHAR(10) NULL,
    [client first name] VARCHAR(8000) NULL,
    [middle name] VARCHAR(8000) NULL,
    [last name] VARCHAR(8000) NULL,
    [category] VARCHAR(2) NOT NULL,
    [client address1] VARCHAR(40) NULL,
    [address 2] VARCHAR(40) NULL,
    [address 3] VARCHAR(40) NULL,
    [city] VARCHAR(40) NULL,
    [state] VARCHAR(50) NULL,
    [country] VARCHAR(15) NULL,
    [pin code] VARCHAR(10) NULL,
    [telephone number] VARCHAR(8000) NULL,
    [client agreement date] VARCHAR(8000) NULL,
    [date of birth] VARCHAR(8000) NULL,
    [pan number] VARCHAR(50) NULL,
    [ward number] VARCHAR(50) NULL,
    [uin] VARCHAR(1) NULL,
    [bank name] VARCHAR(50) NULL,
    [bank branch address] VARCHAR(194) NULL,
    [bank account number] VARCHAR(20) NULL,
    [bank account type] VARCHAR(7) NULL,
    [depository name (nsdl)] VARCHAR(4) NOT NULL,
    [depository participant id (nsdl)] VARCHAR(20) NULL,
    [depository participant name (nsdl)] VARCHAR(50) NULL,
    [beneficiary account id (nsdl)] VARCHAR(16) NULL,
    [depository name (cdsl)] VARCHAR(4) NOT NULL,
    [depository participant id (cdsl)] VARCHAR(20) NULL,
    [depository participant name (cdsl)] VARCHAR(50) NULL,
    [beneficiary account id (cdsl)] VARCHAR(16) NULL,
    [passport number] VARCHAR(30) NULL,
    [place of issue of passport] VARCHAR(30) NULL,
    [date of issue of passport] VARCHAR(8000) NULL,
    [expiry date of passport] VARCHAR(8000) NULL,
    [driving license number] VARCHAR(30) NULL,
    [place of issue of driving license number] VARCHAR(30) NULL,
    [date of issue of driving license number] VARCHAR(8000) NULL,
    [expiry date of driving license number] VARCHAR(8000) NULL,
    [voter id] VARCHAR(30) NULL,
    [place of issue of voter id number] VARCHAR(30) NULL,
    [date of issue of voter id number] VARCHAR(8000) NULL,
    [ration card number] VARCHAR(30) NULL,
    [place of issue of ration card number] VARCHAR(30) NULL,
    [date of issue of ration card number] VARCHAR(8000) NULL,
    [registration number of client] VARCHAR(50) NULL,
    [registering authority] VARCHAR(50) NULL,
    [place of registration] VARCHAR(50) NULL,
    [date of registration] VARCHAR(8000) NULL,
    [introducers name] VARCHAR(30) NULL,
    [introducers client id] VARCHAR(50) NULL,
    [relationship with the introducer] VARCHAR(50) NULL,
    [dealing with other member] VARCHAR(1) NOT NULL,
    [relationship code] VARCHAR(10) NOT NULL,
    [status] CHAR(1) NOT NULL,
    [flag] VARCHAR(1) NULL,
    [sms_email_status] CHAR(10) NULL,
    [mobile_number] VARCHAR(15) NULL,
    [email_id] VARCHAR(500) NULL,
    [reserved] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.acmast
-- --------------------------------------------------
CREATE TABLE [dbo].[acmast]
(
    [acname] VARCHAR(100) NULL,
    [longname] VARCHAR(100) NULL,
    [actyp] CHAR(10) NULL,
    [accat] CHAR(10) NULL,
    [familycd] CHAR(10) NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [accdtls] CHAR(35) NULL,
    [grpcode] CHAR(13) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] VARCHAR(10) NULL,
    [branchcode] VARCHAR(10) NULL,
    [Btobpayment] INT NULL,
    [Paymode] CHAR(1) NULL,
    [Pobankname] VARCHAR(50) NULL,
    [Pobranch] VARCHAR(25) NULL,
    [Pobankcode] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALLCHARG3_ANG_TMP
-- --------------------------------------------------
CREATE TABLE [dbo].[ALLCHARG3_ANG_TMP]
(
    [PARTY_CODE] VARCHAR(10) NULL,
    [LONG_NAME] VARCHAR(100) NULL,
    [CLIENT_GST_NO] VARCHAR(20) NULL,
    [L_STATE] VARCHAR(50) NULL,
    [L_ZIP] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(5) NOT NULL,
    [DEL_BROK] MONEY NULL,
    [TRD_BROK] MONEY NULL,
    [SERVICE_TAX] MONEY NULL,
    [TURN_TAX] MONEY NULL,
    [SEBI_TAX] MONEY NULL,
    [STT] MONEY NULL,
    [STAMP] MONEY NULL,
    [OTHER_CHRG] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_01112023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_01112023]
(
    [SP_SrNo] INT IDENTITY(1,1) NOT NULL,
    [SP_Party_Code] VARCHAR(10) NULL,
    [SP_Computation_Level] CHAR(1) NULL,
    [SP_Product_Type] VARCHAR(3) NULL,
    [SP_Product_Code] VARCHAR(10) NULL,
    [SP_Scheme_Id] INT NOT NULL,
    [SP_Trd_Type] VARCHAR(3) NULL,
    [SP_Scheme_Type] CHAR(1) NULL,
    [SP_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Buy_Brok_Type] CHAR(1) NULL,
    [SP_Sell_Brok_Type] CHAR(1) NULL,
    [SP_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Sell_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Sell_Brok] NUMERIC(18, 4) NULL,
    [SP_Value_From] NUMERIC(18, 4) NOT NULL,
    [SP_Value_To] NUMERIC(18, 4) NOT NULL,
    [SP_Brok_ComputeOn] CHAR(1) NULL,
    [SP_Brok_ComputeType] CHAR(1) NULL,
    [SP_Min_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Min_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Date_From] DATETIME NOT NULL,
    [SP_Date_To] DATETIME NOT NULL,
    [SP_CreatedBy] VARCHAR(20) NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SP_ModifiedBy] VARCHAR(20) NULL,
    [SP_ModifiedOn] DATETIME NOT NULL,
    [SP_TurnOverOn] VARCHAR(7) NULL,
    [Sp_Scrip] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_01112023_DUP
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_01112023_DUP]
(
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [ALL_TRD] INT NULL,
    [SX50OPT_TRD] INT NULL,
    [BSXOPT_TRD] INT NULL,
    [ALL_DEL] INT NULL,
    [SX50OPT_DEL] INT NULL,
    [BSXOPT_DEL] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_011120231
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_011120231]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_0111202311
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_0111202311]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_01112023111
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_01112023111]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] VARCHAR(11) NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(6) NOT NULL,
    [SP_CREATEDON] VARCHAR(11) NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] VARCHAR(11) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_SCRIP] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_01112023112
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_01112023112]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] VARCHAR(11) NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(6) NOT NULL,
    [SP_CREATEDON] VARCHAR(11) NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] VARCHAR(11) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_SCRIP] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_0111202312
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_0111202312]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_0111202313
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_0111202313]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_011120232
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_011120232]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_011120233
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_011120233]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_011120234
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_011120234]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_05082022
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_05082022]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NOT NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_05082022_NCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_05082022_NCX]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_050820221
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_050820221]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_05122023_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_05122023_BFO]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_05122023_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_05122023_BFO_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_11112023
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_11112023]
(
    [SP_SrNo] INT IDENTITY(1,1) NOT NULL,
    [SP_Party_Code] VARCHAR(10) NULL,
    [SP_Computation_Level] CHAR(1) NULL,
    [SP_Product_Type] VARCHAR(3) NULL,
    [SP_Product_Code] VARCHAR(10) NULL,
    [SP_Scheme_Id] INT NOT NULL,
    [SP_Trd_Type] VARCHAR(3) NULL,
    [SP_Scheme_Type] CHAR(1) NULL,
    [SP_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Buy_Brok_Type] CHAR(1) NULL,
    [SP_Sell_Brok_Type] CHAR(1) NULL,
    [SP_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Sell_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Sell_Brok] NUMERIC(18, 4) NULL,
    [SP_Value_From] NUMERIC(18, 4) NOT NULL,
    [SP_Value_To] NUMERIC(18, 4) NOT NULL,
    [SP_Brok_ComputeOn] CHAR(1) NULL,
    [SP_Brok_ComputeType] CHAR(1) NULL,
    [SP_Min_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Min_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Date_From] DATETIME NOT NULL,
    [SP_Date_To] DATETIME NOT NULL,
    [SP_CreatedBy] VARCHAR(20) NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SP_ModifiedBy] VARCHAR(20) NULL,
    [SP_ModifiedOn] DATETIME NOT NULL,
    [SP_TurnOverOn] VARCHAR(7) NULL,
    [Sp_Scrip] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_11112023_DUP
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_11112023_DUP]
(
    [EXCHANGE] VARCHAR(3) NOT NULL,
    [SEGMENT] VARCHAR(7) NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [ALL_TRD] INT NULL,
    [SX50OPT_TRD] INT NULL,
    [BSXOPT_TRD] INT NULL,
    [ALL_DEL] INT NULL,
    [SX50OPT_DEL] INT NULL,
    [BSXOPT_DEL] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_111120231
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_111120231]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_1111202311
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_1111202311]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_11112023111
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_11112023111]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] VARCHAR(11) NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(6) NOT NULL,
    [SP_CREATEDON] VARCHAR(11) NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] VARCHAR(11) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_SCRIP] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_11112023112
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_11112023112]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] VARCHAR(11) NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(6) NOT NULL,
    [SP_CREATEDON] VARCHAR(11) NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] VARCHAR(11) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_SCRIP] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_1111202312
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_1111202312]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_1111202313
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_1111202313]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_111120232
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_111120232]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_111120233
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_111120233]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_DATE_FROM_MIN] DATETIME NULL,
    [SP_DATE_FROM_MAX] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_12012024_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_12012024_BFO]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_12012024_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_12012024_BFO_1]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_12012024_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_12012024_MCX]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NOT NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_12012024_NCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_12012024_NCX]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NOT NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_120120241_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_120120241_BFO]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_120120241_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_120120241_BFO_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_120120241_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_120120241_MCX]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_120120241_NCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_120120241_NCX]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_13012024_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_13012024_BFO_1]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_130120241_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_130120241_BFO_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_14112023_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_14112023_BFO]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_14112023_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_14112023_BFO_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_14112023_MCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_14112023_MCDX]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NOT NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_14112023_NCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_14112023_NCDX]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NOT NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_141120231_MCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_141120231_MCDX]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_141120231_NCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_141120231_NCDX]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NOT NULL,
    [SP_INST_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCRIP] VARCHAR(12) NOT NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NOT NULL,
    [SP_SCHEME_TYPE] CHAR(1) NOT NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NOT NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NOT NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NOT NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NOT NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_15012024_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_15012024_BFO]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_15012024_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_15012024_BFO_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_15012024_BFO1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_15012024_BFO1]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_15012024_BFO1_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_15012024_BFO1_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_15012024_BFO1_2
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_15012024_BFO1_2]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_15012024_BFO2
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_15012024_BFO2]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_18012024_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_18012024_MCX]
(
    [SP_SrNo] INT NOT NULL,
    [SP_Party_Code] VARCHAR(10) NOT NULL,
    [SP_Computation_Level] CHAR(1) NOT NULL,
    [SP_Inst_Type] VARCHAR(3) NOT NULL,
    [SP_Scrip] VARCHAR(12) NOT NULL,
    [SP_Scheme_Id] INT NOT NULL,
    [SP_Trd_Type] VARCHAR(3) NOT NULL,
    [SP_Scheme_Type] CHAR(1) NOT NULL,
    [SP_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Buy_Brok_Type] CHAR(1) NULL,
    [SP_Sell_Brok_Type] CHAR(1) NULL,
    [SP_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Sell_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Sell_Brok] NUMERIC(18, 4) NULL,
    [SP_Value_From] NUMERIC(18, 4) NOT NULL,
    [SP_Value_To] NUMERIC(18, 4) NOT NULL,
    [SP_TurnOverOn] VARCHAR(7) NOT NULL,
    [SP_Brok_ComputeOn] CHAR(1) NOT NULL,
    [SP_Brok_ComputeType] CHAR(1) NOT NULL,
    [SP_Min_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Min_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Date_From] DATETIME NOT NULL,
    [SP_Date_To] DATETIME NOT NULL,
    [SP_CreatedBy] VARCHAR(20) NOT NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SP_ModifiedBy] VARCHAR(20) NOT NULL,
    [SP_ModifiedOn] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_18012024_NCX
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_18012024_NCX]
(
    [SP_SrNo] INT NOT NULL,
    [SP_Party_Code] VARCHAR(10) NOT NULL,
    [SP_Computation_Level] CHAR(1) NOT NULL,
    [SP_Inst_Type] VARCHAR(3) NOT NULL,
    [SP_Scrip] VARCHAR(12) NOT NULL,
    [SP_Scheme_Id] INT NOT NULL,
    [SP_Trd_Type] VARCHAR(3) NOT NULL,
    [SP_Scheme_Type] CHAR(1) NOT NULL,
    [SP_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Buy_Brok_Type] CHAR(1) NULL,
    [SP_Sell_Brok_Type] CHAR(1) NULL,
    [SP_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Sell_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Multiplier] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Buy_Brok] NUMERIC(18, 4) NOT NULL,
    [SP_Res_Sell_Brok] NUMERIC(18, 4) NULL,
    [SP_Value_From] NUMERIC(18, 4) NOT NULL,
    [SP_Value_To] NUMERIC(18, 4) NOT NULL,
    [SP_TurnOverOn] VARCHAR(7) NOT NULL,
    [SP_Brok_ComputeOn] CHAR(1) NOT NULL,
    [SP_Brok_ComputeType] CHAR(1) NOT NULL,
    [SP_Min_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_BrokAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Min_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Max_ScripAmt] NUMERIC(18, 4) NOT NULL,
    [SP_Date_From] DATETIME NOT NULL,
    [SP_Date_To] DATETIME NOT NULL,
    [SP_CreatedBy] VARCHAR(20) NOT NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SP_ModifiedBy] VARCHAR(20) NOT NULL,
    [SP_ModifiedOn] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_23012024_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_23012024_BFO]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_26102023_BFO
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_26102023_BFO]
(
    [SP_SRNO] INT NOT NULL,
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BAK_SCHEME_MAPPING_26102023_BFO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[BAK_SCHEME_MAPPING_26102023_BFO_1]
(
    [SP_PARTY_CODE] VARCHAR(10) NULL,
    [SP_COMPUTATION_LEVEL] CHAR(1) NULL,
    [SP_PRODUCT_TYPE] VARCHAR(3) NULL,
    [SP_PRODUCT_CODE] VARCHAR(10) NULL,
    [SP_SCHEME_ID] INT NOT NULL,
    [SP_TRD_TYPE] VARCHAR(3) NULL,
    [SP_SCHEME_TYPE] CHAR(1) NULL,
    [SP_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_BUY_BROK_TYPE] CHAR(1) NULL,
    [SP_SELL_BROK_TYPE] CHAR(1) NULL,
    [SP_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_SELL_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_MULTIPLIER] NUMERIC(18, 4) NOT NULL,
    [SP_RES_BUY_BROK] NUMERIC(18, 4) NOT NULL,
    [SP_RES_SELL_BROK] NUMERIC(18, 4) NULL,
    [SP_VALUE_FROM] NUMERIC(18, 4) NOT NULL,
    [SP_VALUE_TO] NUMERIC(18, 4) NOT NULL,
    [SP_BROK_COMPUTEON] CHAR(1) NULL,
    [SP_BROK_COMPUTETYPE] CHAR(1) NULL,
    [SP_MIN_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_BROKAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MIN_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_MAX_SCRIPAMT] NUMERIC(18, 4) NOT NULL,
    [SP_DATE_FROM] DATETIME NOT NULL,
    [SP_DATE_TO] DATETIME NOT NULL,
    [SP_CREATEDBY] VARCHAR(20) NULL,
    [SP_CREATEDON] DATETIME NOT NULL,
    [SP_MODIFIEDBY] VARCHAR(20) NULL,
    [SP_MODIFIEDON] DATETIME NOT NULL,
    [SP_TURNOVERON] VARCHAR(7) NULL,
    [SP_SCRIP] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bfobillvalan
-- --------------------------------------------------
CREATE TABLE [dbo].[bfobillvalan]
(
    [Party_Code] VARCHAR(15) NOT NULL,
    [Party_Name] VARCHAR(100) NOT NULL,
    [Client_Type] VARCHAR(20) NOT NULL,
    [BillNo] VARCHAR(20) NOT NULL,
    [ContractNo] VARCHAR(20) NOT NULL,
    [Product_Code] VARCHAR(20) NOT NULL,
    [Series_Code] VARCHAR(20) NOT NULL,
    [expirydate] DATETIME NOT NULL,
    [Product_type] VARCHAR(20) NOT NULL,
    [Series_Id] INT NOT NULL,
    [Strike_Price] MONEY NOT NULL,
    [Market_Lot] INT NOT NULL,
    [AuctionPart] VARCHAR(20) NOT NULL,
    [MaturityDate] DATETIME NOT NULL,
    [Sauda_date] DATETIME NOT NULL,
    [IsIn] VARCHAR(20) NOT NULL,
    [PQty] INT NOT NULL,
    [SQty] INT NOT NULL,
    [PRate] MONEY NOT NULL,
    [SRate] MONEY NOT NULL,
    [PAmt] MONEY NOT NULL,
    [SAmt] MONEY NOT NULL,
    [PBrokAmt] MONEY NOT NULL,
    [SBrokAmt] MONEY NOT NULL,
    [PBillAmt] MONEY NOT NULL,
    [SBillAmt] MONEY NOT NULL,
    [Cl_Rate] MONEY NOT NULL,
    [Cl_Chrg] MONEY NOT NULL,
    [ExCl_Chrg] MONEY NOT NULL,
    [Service_Tax] MONEY NOT NULL,
    [ExSer_Tax] MONEY NOT NULL,
    [InExSerFlag] SMALLINT NOT NULL,
    [sebi_tax] MONEY NOT NULL,
    [turn_tax] MONEY NOT NULL,
    [Broker_note] MONEY NOT NULL,
    [Ins_Chrg] MONEY NOT NULL,
    [Other_Chrg] MONEY NOT NULL,
    [TradeType] VARCHAR(20) NOT NULL,
    [ParticiPantCode] VARCHAR(25) NOT NULL,
    [Terminal_Id] VARCHAR(25) NOT NULL,
    [Family] VARCHAR(20) NOT NULL,
    [FamilyName] VARCHAR(100) NOT NULL,
    [Trader] VARCHAR(40) NOT NULL,
    [Branch_Code] VARCHAR(20) NOT NULL,
    [Sub_Broker] VARCHAR(20) NOT NULL,
    [StatusName] VARCHAR(25) NOT NULL,
    [Exchange] VARCHAR(10) NOT NULL,
    [Segment] VARCHAR(25) NOT NULL,
    [MemberType] VARCHAR(10) NOT NULL,
    [CompanyName] VARCHAR(100) NOT NULL,
    [Region] VARCHAR(20) NOT NULL,
    [UpdateDate] VARCHAR(11) NOT NULL,
    [email] VARCHAR(100) NOT NULL,
    [sbu] VARCHAR(20) NOT NULL,
    [relmgr] VARCHAR(20) NOT NULL,
    [grp] VARCHAR(20) NOT NULL,
    [sector] VARCHAR(20) NOT NULL,
    [CMClosing] MONEY NOT NULL,
    [track] VARCHAR(20) NOT NULL,
    [Area] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bfoscrip1
-- --------------------------------------------------
CREATE TABLE [dbo].[bfoscrip1]
(
    [ProductName] CHAR(3) NULL,
    [UnderlyingAsset] VARCHAR(5) NULL,
    [product_type] VARCHAR(5) NULL,
    [product_code] VARCHAR(10) NULL,
    [series_code] VARCHAR(20) NULL,
    [series_id] VARCHAR(13) NULL,
    [scripmap_cd] VARCHAR(13) NULL,
    [reserved1] TINYINT NULL,
    [reserved2] TINYINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bfoscrip2
-- --------------------------------------------------
CREATE TABLE [dbo].[bfoscrip2]
(
    [product_type] VARCHAR(5) NULL,
    [product_code] VARCHAR(10) NULL,
    [series_code] VARCHAR(20) NULL,
    [Series_id] INT NULL,
    [series_type] VARCHAR(3) NULL,
    [sec_name] VARCHAR(50) NULL,
    [Expirydate] DATETIME NULL,
    [Maturitydate] DATETIME NULL,
    [OpeningDay] DATETIME NULL,
    [Lifetime] INT NULL,
    [Isin_Code] INT NULL,
    [Base_Price] MONEY NULL,
    [Multiplier] INT NULL,
    [marketsegment] VARCHAR(15) NULL,
    [marketlot] INT NULL,
    [ceilingdepth] INT NULL,
    [callput] VARCHAR(3) NULL,
    [optionstyle] VARCHAR(3) NULL,
    [strikeprice] MONEY NULL,
    [nearseriesid] INT NULL,
    [farseriesid] INT NULL,
    [cor_act_level] INT NULL,
    [reserved1] INT NULL,
    [reserved2] INT NULL,
    [reserved3] INT NULL,
    [reserved4] INT NULL,
    [reserved5] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bfosettlement
-- --------------------------------------------------
CREATE TABLE [dbo].[bfosettlement]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] NUMERIC(18, 0) NULL,
    [Trade_no] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [product_type] VARCHAR(5) NULL,
    [product_code] VARCHAR(10) NULL,
    [Series_code] VARCHAR(20) NULL,
    [Series_id] INT NULL,
    [expirydate] DATETIME NULL,
    [multiplier] INT NULL,
    [User_id] VARCHAR(7) NOT NULL,
    [Tradeqty] INT NULL,
    [AuctionPart] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL,
    [Series] VARCHAR(3) NOT NULL,
    [Order_no] CHAR(20) NOT NULL,
    [MarketRate] MONEY NULL,
    [strike_price] MONEY NULL,
    [Sauda_date] DATETIME NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NULL,
    [Normal] MONEY NULL,
    [Day_puc] MONEY NULL,
    [day_sales] MONEY NULL,
    [Sett_purch] MONEY NULL,
    [Sett_sales] MONEY NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NULL,
    [Brokapplied] MONEY NULL,
    [NetRate] NUMERIC(15, 7) NULL,
    [Amount] MONEY NULL,
    [Ins_chrg] MONEY NULL,
    [turn_tax] MONEY NULL,
    [other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Service_tax] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [Billflag] INT NULL,
    [sett_no] VARCHAR(7) NULL,
    [NBrokApp] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL,
    [sett_type] VARCHAR(3) NULL,
    [Cl_type] VARCHAR(3) NULL,
    [Order_Date] DATETIME NULL,
    [OppMemCode] VARCHAR(5) NULL,
    [OppTraderCode] VARCHAR(5) NULL,
    [Cl_rate] MONEY NULL,
    [GroupId] VARCHAR(7) NULL,
    [TraderCode] VARCHAR(7) NULL,
    [reserved1] TINYINT NULL,
    [reserved2] TINYINT NULL,
    [reserved3] TINYINT NULL,
    [reserved4] TINYINT NULL,
    [reserved5] TINYINT NULL,
    [status] CHAR(2) NULL,
    [branch_cd] VARCHAR(6) NULL,
    [pro_cli] VARCHAR(6) NULL,
    [participantcode] VARCHAR(15) NULL,
    [cpid] VARCHAR(5) NULL,
    [instrument] VARCHAR(5) NULL,
    [booktype] VARCHAR(5) NULL,
    [branch_id] VARCHAR(5) NULL,
    [scheme] VARCHAR(5) NULL,
    [tmark] VARCHAR(5) NULL,
    [dummy1] INT NULL,
    [dummy2] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BO_OBJECT
-- --------------------------------------------------
CREATE TABLE [dbo].[BO_OBJECT]
(
    [ObjName] VARCHAR(500) NULL,
    [ObjType] VARCHAR(10) NULL,
    [ObjDbName] VARCHAR(100) NULL,
    [ObjComdType] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BO_OBJECT_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[BO_OBJECT_Details]
(
    [Objname] VARCHAR(500) NULL,
    [ObjType] VARCHAR(10) NULL,
    [ObjComdType] VARCHAR(100) NULL,
    [DBname] VARCHAR(8000) NULL,
    [content] NVARCHAR(4000) NULL,
    [CntOccuranceChars] INT NULL,
    [TotCnt] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.branches
-- --------------------------------------------------
CREATE TABLE [dbo].[branches]
(
    [Branch_cd] CHAR(10) NOT NULL,
    [Short_Name] CHAR(20) NOT NULL,
    [Long_Name] CHAR(50) NULL,
    [Address1] CHAR(25) NULL,
    [Address2] CHAR(25) NULL,
    [City] CHAR(20) NULL,
    [State] CHAR(15) NULL,
    [Nation] CHAR(15) NULL,
    [Zip] CHAR(15) NULL,
    [Phone1] CHAR(15) NULL,
    [Phone2] CHAR(15) NULL,
    [Fax] CHAR(15) NULL,
    [Email] CHAR(50) NULL,
    [Remote] BIT NOT NULL,
    [Security_Net] BIT NOT NULL,
    [Money_Net] BIT NOT NULL,
    [Excise_Reg] CHAR(30) NULL,
    [Contact_Person] CHAR(100) NULL,
    [Com_Perc] MONEY NULL,
    [Terminal_Id] VARCHAR(10) NULL,
    [deftrader] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Broktable
-- --------------------------------------------------
CREATE TABLE [dbo].[Broktable]
(
    [Table_No] SMALLINT NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NULL,
    [Upper_lim] MONEY NULL,
    [Day_puc] NUMERIC(10, 6) NULL,
    [Day_Sales] NUMERIC(10, 6) NULL,
    [Sett_Purch] NUMERIC(10, 6) NULL,
    [round_to] NUMERIC(10, 2) NULL,
    [Table_name] CHAR(25) NULL,
    [sett_sales] NUMERIC(10, 6) NULL,
    [NORMAL] NUMERIC(10, 6) NULL,
    [Trd_Del] CHAR(1) NULL,
    [Lower_lim] NUMERIC(10, 2) NULL,
    [Def_table] TINYINT NULL,
    [RoFig] INT NULL,
    [ErrNum] MONEY NULL,
    [NoZero] INT NULL,
    [branch_code] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Payment_reco_CommCurr
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Payment_reco_CommCurr]
(
    [vtyp] SMALLINT NOT NULL,
    [booktype] CHAR(2) NULL,
    [vno] VARCHAR(12) NULL,
    [vdt] DATETIME NULL,
    [tdate] VARCHAR(30) NULL,
    [ddno] VARCHAR(15) NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [acname] VARCHAR(100) NOT NULL,
    [drcr] CHAR(1) NULL,
    [Dramt] MONEY NULL,
    [Cramt] MONEY NULL,
    [treldt] VARCHAR(30) NOT NULL,
    [refno] CHAR(12) NULL,
    [last_Date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Payment_reco_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Payment_reco_MCX]
(
    [vtyp] SMALLINT NOT NULL,
    [booktype] CHAR(2) NULL,
    [vno] VARCHAR(12) NULL,
    [vdt] DATETIME NULL,
    [tdate] VARCHAR(30) NULL,
    [ddno] VARCHAR(15) NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [acname] VARCHAR(100) NOT NULL,
    [drcr] CHAR(1) NULL,
    [Dramt] MONEY NULL,
    [Cramt] MONEY NULL,
    [treldt] VARCHAR(30) NOT NULL,
    [refno] CHAR(12) NULL,
    [last_Date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Payment_reco_NCDX
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Payment_reco_NCDX]
(
    [vtyp] SMALLINT NOT NULL,
    [booktype] CHAR(2) NULL,
    [vno] VARCHAR(12) NULL,
    [vdt] DATETIME NULL,
    [tdate] VARCHAR(30) NULL,
    [ddno] VARCHAR(15) NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [acname] VARCHAR(100) NOT NULL,
    [drcr] CHAR(1) NULL,
    [Dramt] MONEY NULL,
    [Cramt] MONEY NULL,
    [treldt] VARCHAR(30) NOT NULL,
    [refno] CHAR(12) NULL,
    [last_Date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client1
-- --------------------------------------------------
CREATE TABLE [dbo].[client1]
(
    [Cl_Code] VARCHAR(10) NULL,
    [Short_Name] VARCHAR(21) NOT NULL,
    [Long_Name] VARCHAR(100) NOT NULL,
    [L_Address1] VARCHAR(40) NOT NULL,
    [L_Address2] VARCHAR(40) NULL,
    [L_city] VARCHAR(40) NULL,
    [L_State] VARCHAR(50) NULL,
    [L_Nation] VARCHAR(15) NULL,
    [L_Zip] VARCHAR(10) NULL,
    [Fax] VARCHAR(15) NULL,
    [Res_Phone1] VARCHAR(15) NULL,
    [Res_Phone2] VARCHAR(15) NULL,
    [Off_Phone1] VARCHAR(15) NULL,
    [Off_Phone2] VARCHAR(15) NULL,
    [Email] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [Credit_Limit] NUMERIC(13, 2) NULL,
    [Cl_type] VARCHAR(3) NOT NULL,
    [Cl_Status] VARCHAR(3) NOT NULL,
    [Gl_Code] VARCHAR(6) NULL,
    [Fd_Code] VARCHAR(4) NULL,
    [Family] VARCHAR(10) NOT NULL,
    [Penalty] NUMERIC(6, 0) NULL,
    [Sub_Broker] VARCHAR(10) NOT NULL,
    [Confirm_fax] TINYINT NOT NULL,
    [PhoneOld] VARCHAR(40) NULL,
    [L_Address3] VARCHAR(40) NULL,
    [Mobile_Pager] VARCHAR(40) NULL,
    [pan_gir_no] VARCHAR(20) NULL,
    [trader] VARCHAR(20) NULL,
    [Ward_No] VARCHAR(50) NULL,
    [Region] VARCHAR(50) NULL,
    [Area] VARCHAR(10) NULL,
    [Clrating] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client2
-- --------------------------------------------------
CREATE TABLE [dbo].[client2]
(
    [Cl_Code] VARCHAR(10) NULL,
    [Exchange] CHAR(3) NOT NULL,
    [Tran_Cat] CHAR(3) NOT NULL,
    [Scrip_cat] NUMERIC(18, 4) NULL,
    [Party_code] VARCHAR(10) NULL,
    [Table_no] INT NULL,
    [Sub_TableNo] INT NULL,
    [Margin] TINYINT NOT NULL,
    [Turnover_tax] TINYINT NOT NULL,
    [Sebi_Turn_tax] TINYINT NOT NULL,
    [Insurance_Chrg] TINYINT NOT NULL,
    [Service_chrg] TINYINT NOT NULL,
    [Std_rate] INT NULL,
    [P_To_P] INT NULL,
    [exposure_lim] NUMERIC(12, 2) NOT NULL,
    [demat_tableno] INT NULL,
    [BankId] VARCHAR(15) NULL,
    [CltDpNo] VARCHAR(16) NULL,
    [Printf] TINYINT NOT NULL,
    [ALBMDelchrg] TINYINT NULL,
    [ALBMDelivery] SMALLINT NULL,
    [AlbmCF_tableno] SMALLINT NULL,
    [MF_tableno] INT NULL,
    [SB_tableno] INT NULL,
    [brok1_tableno] INT NULL,
    [brok2_tableno] INT NULL,
    [brok3_tableno] INT NULL,
    [BrokerNote] TINYINT NULL,
    [Other_chrg] TINYINT NULL,
    [brok_scheme] TINYINT NULL,
    [Contcharge] TINYINT NULL,
    [MinContAmt] TINYINT NULL,
    [AddLedgerBal] TINYINT NULL,
    [Dummy1] INT NULL,
    [Dummy2] INT NULL,
    [InsCont] CHAR(1) NULL,
    [SerTaxMethod] INT NULL,
    [Dummy6] VARCHAR(5) NULL,
    [Dummy7] VARCHAR(4) NULL,
    [Dummy8] VARCHAR(20) NULL,
    [Dummy9] VARCHAR(20) NULL,
    [Dummy10] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client3
-- --------------------------------------------------
CREATE TABLE [dbo].[client3]
(
    [cl_code] VARCHAR(10) NULL,
    [party_code] CHAR(10) NOT NULL,
    [exchange] CHAR(3) NOT NULL,
    [markettype] VARCHAR(15) NOT NULL,
    [margin] MONEY NOT NULL,
    [nooftimes] NUMERIC(2, 0) NOT NULL,
    [margin_recd] NUMERIC(18, 4) NULL,
    [MtoM] NUMERIC(18, 4) NULL,
    [pmarginrate] NUMERIC(5, 2) NULL,
    [MtoMdate] DATETIME NULL,
    [InitialMargin] NUMERIC(18, 4) NULL,
    [MainenancetMargin] NUMERIC(18, 4) NULL,
    [MarginExchange] NUMERIC(18, 4) NULL,
    [MarginBroker] NUMERIC(18, 4) NULL,
    [Dummy1] VARCHAR(4) NULL,
    [Dummy2] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client4
-- --------------------------------------------------
CREATE TABLE [dbo].[client4]
(
    [Cl_code] VARCHAR(10) NULL,
    [Party_code] VARCHAR(10) NOT NULL,
    [Instru] TINYINT NOT NULL,
    [BankID] VARCHAR(20) NULL,
    [Cltdpid] VARCHAR(16) NULL,
    [Depository] VARCHAR(7) NULL,
    [DefDp] SMALLINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client5
-- --------------------------------------------------
CREATE TABLE [dbo].[client5]
(
    [cl_code] VARCHAR(10) NULL,
    [BirthDate] DATETIME NULL,
    [Sex] CHAR(1) NULL,
    [ActiveFrom] DATETIME NULL,
    [InteractMode] TINYINT NULL,
    [RepatriatAC] TINYINT NULL,
    [RepatriatBank] TINYINT NULL,
    [RepatriatACNO] VARCHAR(30) NULL,
    [Introducer] VARCHAR(30) NULL,
    [Approver] VARCHAR(30) NULL,
    [KYCForm] TINYINT NULL,
    [BankCert] TINYINT NULL,
    [Passport] TINYINT NULL,
    [Passportdtl] VARCHAR(30) NULL,
    [VotersID] TINYINT NULL,
    [VotersIDdtl] VARCHAR(30) NULL,
    [ITReturn] TINYINT NULL,
    [ITReturndtl] VARCHAR(30) NULL,
    [Drivelicen] TINYINT NULL,
    [Drivelicendtl] VARCHAR(30) NULL,
    [Rationcard] TINYINT NULL,
    [Rationcarddtl] VARCHAR(30) NULL,
    [Corpdtlrecd] TINYINT NULL,
    [Corpdeed] TINYINT NULL,
    [Anualreport] TINYINT NULL,
    [Networthcert] TINYINT NULL,
    [InactiveFrom] DATETIME NULL,
    [P_Address1] VARCHAR(50) NULL,
    [P_Address2] VARCHAR(50) NULL,
    [P_Address3] VARCHAR(50) NULL,
    [P_City] VARCHAR(20) NULL,
    [P_State] VARCHAR(50) NULL,
    [P_Nation] VARCHAR(15) NULL,
    [P_Phone] VARCHAR(15) NULL,
    [P_Zip] VARCHAR(10) NULL,
    [addemailid] VARCHAR(230) NULL,
    [PassportDateOfIssue] DATETIME NULL,
    [PassportPlaceOfIssue] VARCHAR(30) NULL,
    [VoterIdDateOfIssue] DATETIME NULL,
    [VoterIdPlaceOfIssue] VARCHAR(30) NULL,
    [ITReturnDateOfFiling] DATETIME NULL,
    [LicenceNoDateOfIssue] DATETIME NULL,
    [LicenceNoPlaceOfIssue] VARCHAR(30) NULL,
    [RationCardDateOfIssue] DATETIME NULL,
    [RationCardPlaceOfIssue] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client6
-- --------------------------------------------------
CREATE TABLE [dbo].[client6]
(
    [Cl_Code] CHAR(6) NOT NULL,
    [Exchange] CHAR(3) NOT NULL,
    [Tran_Cat] CHAR(3) NOT NULL,
    [Scrip_cat] NUMERIC(18, 4) NULL,
    [Party_code] CHAR(10) NOT NULL,
    [Table_no] SMALLINT NOT NULL,
    [Sub_TableNo] SMALLINT NOT NULL,
    [Margin] TINYINT NOT NULL,
    [Turnover_tax] TINYINT NOT NULL,
    [Sebi_Turn_tax] TINYINT NOT NULL,
    [Insurance_Chrg] TINYINT NOT NULL,
    [Service_chrg] TINYINT NOT NULL,
    [Std_rate] SMALLINT NOT NULL,
    [P_To_P] SMALLINT NOT NULL,
    [exposure_lim] NUMERIC(12, 2) NOT NULL,
    [demat_tableno] SMALLINT NOT NULL,
    [BankId] VARCHAR(15) NULL,
    [CltDpNo] VARCHAR(15) NULL,
    [Printf] TINYINT NOT NULL,
    [ALBMDelchrg] TINYINT NULL,
    [ALBMDelivery] TINYINT NULL,
    [AlbmCF_tableno] SMALLINT NULL,
    [MF_tableno] SMALLINT NULL,
    [SB_tableno] SMALLINT NULL,
    [brok1_tableno] SMALLINT NULL,
    [brok2_tableno] SMALLINT NULL,
    [brok3_tableno] SMALLINT NULL,
    [BrokerNote] TINYINT NULL,
    [Other_chrg] TINYINT NULL,
    [brok_scheme] TINYINT NULL,
    [Contcharge] TINYINT NULL,
    [MinContAmt] TINYINT NULL,
    [AddLedgerBal] TINYINT NULL,
    [Dummy1] TINYINT NULL,
    [Dummy2] TINYINT NULL,
    [InsCont] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cmbillvalan
-- --------------------------------------------------
CREATE TABLE [dbo].[cmbillvalan]
(
    [Sett_No] VARCHAR(7) NULL,
    [Sett_Type] VARCHAR(3) NULL,
    [BillNo] VARCHAR(10) NULL,
    [ContractNo] VARCHAR(15) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Party_Name] VARCHAR(100) NULL,
    [Scrip_Cd] VARCHAR(12) NULL,
    [Series] VARCHAR(3) NULL,
    [Scrip_Name] VARCHAR(50) NULL,
    [ISIN] VARCHAR(12) NULL,
    [Sauda_Date] DATETIME NULL,
    [PQtyTrd] INT NULL,
    [PAmtTrd] MONEY NULL,
    [PQtyDel] INT NULL,
    [PAmtDel] MONEY NULL,
    [SQtyTrd] INT NULL,
    [SAmtTrd] MONEY NULL,
    [SQtyDel] INT NULL,
    [SAmtDel] MONEY NULL,
    [PBrokTrd] MONEY NULL,
    [SBrokTrd] MONEY NULL,
    [PBrokDel] MONEY NULL,
    [SBrokDel] MONEY NULL,
    [Family] VARCHAR(10) NULL,
    [Family_Name] VARCHAR(100) NULL,
    [Terminal_Id] VARCHAR(10) NULL,
    [ClientType] VARCHAR(10) NULL,
    [TradeType] VARCHAR(3) NULL,
    [Trader] VARCHAR(20) NULL,
    [Sub_Broker] VARCHAR(10) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [ParticipantCode] VARCHAR(15) NULL,
    [Pamt] MONEY NOT NULL,
    [Samt] MONEY NOT NULL,
    [PRate] MONEY NULL,
    [SRate] MONEY NULL,
    [TrdAmt] MONEY NULL,
    [DelAmt] MONEY NULL,
    [SerInEx] SMALLINT NULL,
    [Service_Tax] MONEY NULL,
    [ExService_Tax] MONEY NULL,
    [Turn_Tax] MONEY NULL,
    [Sebi_Tax] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Broker_Chrg] MONEY NULL,
    [Other_Chrg] MONEY NULL,
    [Region] VARCHAR(50) NULL,
    [Start_Date] VARCHAR(11) NULL,
    [End_Date] VARCHAR(11) NULL,
    [Update_Date] VARCHAR(11) NULL,
    [Status_Name] VARCHAR(15) NULL,
    [Exchange] VARCHAR(5) NULL,
    [Segment] VARCHAR(10) NULL,
    [MemberType] VARCHAR(3) NULL,
    [CompanyName] VARCHAR(100) NULL,
    [Dummy1] VARCHAR(1) NULL,
    [Dummy2] VARCHAR(1) NULL,
    [Dummy3] VARCHAR(1) NULL,
    [Dummy4] MONEY NULL,
    [Dummy5] MONEY NULL,
    [Area] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.collateraldetails
-- --------------------------------------------------
CREATE TABLE [dbo].[collateraldetails]
(
    [EffDate] DATETIME NULL,
    [Exchange] VARCHAR(3) NULL,
    [Segment] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(12) NULL,
    [Series] VARCHAR(3) NULL,
    [Isin] VARCHAR(20) NULL,
    [Cl_Rate] MONEY NULL,
    [Amount] MONEY NULL,
    [Qty] NUMERIC(18, 0) NULL,
    [HairCut] MONEY NULL,
    [FinalAmount] MONEY NULL,
    [PercentageCash] NUMERIC(18, 2) NULL,
    [PerecntageNonCash] NUMERIC(18, 2) NULL,
    [Receive_Date] DATETIME NULL,
    [Maturity_Date] DATETIME NULL,
    [Coll_Type] VARCHAR(6) NULL,
    [ClientType] VARCHAR(3) NULL,
    [Remarks] VARCHAR(50) NULL,
    [LoginName] VARCHAR(20) NULL,
    [LoginTime] DATETIME NULL,
    [Cash_Ncash] VARCHAR(2) NULL,
    [Group_Code] VARCHAR(15) NULL,
    [Fd_Bg_No] VARCHAR(20) NULL,
    [Bank_Code] VARCHAR(15) NULL,
    [Fd_Type] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.costmast
-- --------------------------------------------------
CREATE TABLE [dbo].[costmast]
(
    [COSTNAME] CHAR(35) NOT NULL,
    [COSTCODE] SMALLINT NOT NULL,
    [CATCODE] SMALLINT NOT NULL,
    [GrpCode] VARCHAR(20) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.fobillvalan
-- --------------------------------------------------
CREATE TABLE [dbo].[fobillvalan]
(
    [Party_Code] VARCHAR(10) NULL,
    [Party_Name] VARCHAR(50) NULL,
    [Client_Type] VARCHAR(10) NULL,
    [BillNo] INT NULL,
    [ContractNo] VARCHAR(10) NULL,
    [inst_type] VARCHAR(6) NULL,
    [symbol] VARCHAR(12) NULL,
    [expirydate] DATETIME NULL,
    [Option_type] VARCHAR(2) NULL,
    [Strike_Price] MONEY NULL,
    [AuctionPart] VARCHAR(2) NULL,
    [MaturityDate] DATETIME NULL,
    [Sauda_date] DATETIME NULL,
    [IsIn] VARCHAR(12) NULL,
    [PQty] INT NULL,
    [SQty] INT NULL,
    [PRate] MONEY NULL,
    [SRate] MONEY NULL,
    [PAmt] MONEY NULL,
    [SAmt] MONEY NULL,
    [PBrokAmt] MONEY NULL,
    [SBrokAmt] MONEY NULL,
    [PBillAmt] MONEY NULL,
    [SBillAmt] MONEY NULL,
    [Cl_Rate] MONEY NULL,
    [Cl_Chrg] MONEY NULL,
    [ExCl_Chrg] MONEY NULL,
    [Service_Tax] MONEY NULL,
    [ExSer_Tax] MONEY NULL,
    [InExSerFlag] SMALLINT NULL,
    [sebi_tax] MONEY NULL,
    [turn_tax] MONEY NULL,
    [Broker_note] MONEY NULL,
    [Ins_Chrg] MONEY NULL,
    [Other_Chrg] MONEY NULL,
    [TradeType] VARCHAR(3) NULL,
    [ParticiPantCode] VARCHAR(15) NULL,
    [Terminal_Id] VARCHAR(15) NULL,
    [Family] VARCHAR(10) NULL,
    [FamilyName] VARCHAR(50) NULL,
    [Trader] VARCHAR(20) NULL,
    [Branch_Code] VARCHAR(10) NULL,
    [Sub_Broker] VARCHAR(10) NULL,
    [StatusName] VARCHAR(15) NULL,
    [Exchange] VARCHAR(5) NULL,
    [Segment] VARCHAR(10) NULL,
    [MemberType] VARCHAR(2) NULL,
    [CompanyName] VARCHAR(100) NULL,
    [Region] VARCHAR(50) NULL,
    [UpdateDate] VARCHAR(11) NULL,
    [EMAIL] VARCHAR(100) NULL,
    [Dummy2] VARCHAR(1) NULL,
    [Dummy3] VARCHAR(1) NULL,
    [Dummy4] MONEY NULL,
    [Dummy5] MONEY NULL,
    [CMCLOSING] MONEY NULL,
    [Track] CHAR(1) NULL,
    [Area] CHAR(10) NULL,
    [FILTERCOLS] VARCHAR(199) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.fomargin
-- --------------------------------------------------
CREATE TABLE [dbo].[fomargin]
(
    [Margindate] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Short_name] VARCHAR(50) NULL,
    [Ledgeramount] MONEY NULL,
    [Cash_coll] MONEY NULL,
    [Initialmargin] MONEY NULL,
    [Family] VARCHAR(50) NULL,
    [Sub_broker] VARCHAR(50) NULL,
    [Trader] VARCHAR(50) NULL,
    [Col_without_haircut] MONEY NULL,
    [Col_after_haircut] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.globals
-- --------------------------------------------------
CREATE TABLE [dbo].[globals]
(
    [year] VARCHAR(4) NULL,
    [exchange] VARCHAR(3) NULL,
    [service_tax] NUMERIC(3, 2) NULL,
    [service_tax_ac] VARCHAR(30) NULL,
    [turnover_ac] VARCHAR(30) NULL,
    [sebi_turn_ac] VARCHAR(30) NULL,
    [broker_note_ac] VARCHAR(30) NULL,
    [other_chrg_ac] VARCHAR(30) NULL,
    [exchange_gl_ac] VARCHAR(30) NULL,
    [year_start_dt] DATETIME NULL,
    [year_end_dt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.inhousepobank
-- --------------------------------------------------
CREATE TABLE [dbo].[inhousepobank]
(
    [BankId] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [Bank_Name] VARCHAR(50) NOT NULL,
    [Branch_Name] VARCHAR(40) NOT NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(25) NULL,
    [State] VARCHAR(25) NULL,
    [Nation] VARCHAR(25) NULL,
    [Zip] VARCHAR(15) NULL,
    [Phone1] VARCHAR(15) NULL,
    [Phone2] VARCHAR(15) NULL,
    [Fax] VARCHAR(15) NULL,
    [Email] VARCHAR(50) NULL,
    [IFSCCODE] VARCHAR(12) NULL,
    [MICRNO] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger]
(
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NULL,
    [edt] DATETIME NULL,
    [lno] INT NULL,
    [acname] VARCHAR(100) NULL,
    [drcr] CHAR(1) NULL,
    [vamt] MONEY NULL,
    [vdt] DATETIME NULL,
    [vno1] VARCHAR(12) NULL,
    [refno] CHAR(12) NULL,
    [balamt] MONEY NOT NULL,
    [NoDays] INT NULL,
    [cdt] DATETIME NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [BookType] CHAR(2) NULL,
    [EnteredBy] VARCHAR(25) NULL,
    [pdt] DATETIME NULL,
    [CheckedBy] VARCHAR(25) NULL,
    [actnodays] INT NULL,
    [narration] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger1
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger1]
(
    [bnkname] VARCHAR(50) NULL,
    [brnname] VARCHAR(20) NULL,
    [dd] CHAR(1) NULL,
    [ddno] VARCHAR(15) NULL,
    [dddt] DATETIME NULL,
    [reldt] DATETIME NULL,
    [relamt] MONEY NULL,
    [refno] CHAR(12) NOT NULL,
    [receiptno] INT NULL,
    [vtyp] SMALLINT NULL,
    [vno] VARCHAR(12) NULL,
    [lno] INT NULL,
    [drcr] CHAR(1) NULL,
    [BookType] CHAR(2) NULL,
    [MicrNo] INT NULL,
    [SlipNo] INT NULL,
    [slipdate] DATETIME NULL,
    [ChequeInName] VARCHAR(50) NULL,
    [Chqprinted] TINYINT NULL,
    [clear_mode] CHAR(1) NULL,
    [L1_SNo] BIGINT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LogIops204
-- --------------------------------------------------
CREATE TABLE [dbo].[LogIops204]
(
    [database_name] VARCHAR(20) NULL,
    [physical_name] VARCHAR(80) NOT NULL,
    [drive_letter] NVARCHAR(1) NULL,
    [num_of_writes] BIGINT NOT NULL,
    [num_of_bytes_written] BIGINT NOT NULL,
    [io_stall_write_ms] BIGINT NOT NULL,
    [type_desc] VARCHAR(10) NULL,
    [num_of_reads] BIGINT NOT NULL,
    [num_of_bytes_read] BIGINT NOT NULL,
    [io_stall_read_ms] BIGINT NOT NULL,
    [io_stall] BIGINT NOT NULL,
    [size_on_disk_bytes] BIGINT NOT NULL,
    [Recordtime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LogIops204back
-- --------------------------------------------------
CREATE TABLE [dbo].[LogIops204back]
(
    [database_name] VARCHAR(20) NULL,
    [physical_name] VARCHAR(80) NOT NULL,
    [drive_letter] NVARCHAR(1) NULL,
    [num_of_writes] BIGINT NOT NULL,
    [num_of_bytes_written] BIGINT NOT NULL,
    [io_stall_write_ms] BIGINT NOT NULL,
    [type_desc] VARCHAR(10) NULL,
    [num_of_reads] BIGINT NOT NULL,
    [num_of_bytes_read] BIGINT NOT NULL,
    [io_stall_read_ms] BIGINT NOT NULL,
    [io_stall] BIGINT NOT NULL,
    [size_on_disk_bytes] BIGINT NOT NULL,
    [Recordtime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mcx_01_000000003_2013_04
-- --------------------------------------------------
CREATE TABLE [dbo].[Mcx_01_000000003_2013_04]
(
    [ClientCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013]
(
    [ClientCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_01
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_01]
(
    [party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mcx_01_03_2013_02
-- --------------------------------------------------
CREATE TABLE [dbo].[Mcx_01_03_2013_02]
(
    [Sr no] FLOAT NULL,
    [party_code] NVARCHAR(255) NULL,
    [lasttradedate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mcx_01_03_2013_02_vol1
-- --------------------------------------------------
CREATE TABLE [dbo].[mcx_01_03_2013_02_vol1]
(
    [Sr no] FLOAT NULL,
    [party_code] NVARCHAR(255) NULL,
    [lasttradedate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mcx_01_03_2013_03
-- --------------------------------------------------
CREATE TABLE [dbo].[Mcx_01_03_2013_03]
(
    [Sr no] FLOAT NULL,
    [party_code] NVARCHAR(255) NULL,
    [lasttradedate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_05
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_05]
(
    [Party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_06
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_06]
(
    [Party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_07
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_07]
(
    [Party_Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_08
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_08]
(
    [partycode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_09
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_09]
(
    [Party_Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_10
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_10]
(
    [Party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_11
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_11]
(
    [party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_01_03_2013_12
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_01_03_2013_12]
(
    [party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_04_03_2013_01
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_04_03_2013_01]
(
    [party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_05_03_2013_01
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_05_03_2013_01]
(
    [party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_21_03_2013_01
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_21_03_2013_01]
(
    [Client Code] NVARCHAR(255) NULL,
    [First Name] NVARCHAR(255) NULL,
    [Middle Name] NVARCHAR(255) NULL,
    [Last Name] NVARCHAR(255) NULL,
    [F5] NVARCHAR(255) NULL,
    [F6] NVARCHAR(255) NULL,
    [F7] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_21_03_2013_02
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_21_03_2013_02]
(
    [Client Code] NVARCHAR(255) NULL,
    [First Name] NVARCHAR(255) NULL,
    [Middle Name] NVARCHAR(255) NULL,
    [Last Name] NVARCHAR(255) NULL,
    [F5] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXState_City_Code
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXState_City_Code]
(
    [State] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [Code] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXState_City_Code_new
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXState_City_Code_new]
(
    [State] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [Code] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXState_City_Code_new_testNeelam
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXState_City_Code_new_testNeelam]
(
    [State] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [Code] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXState_City_Code_new2022
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXState_City_Code_new2022]
(
    [State] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [Code] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXState_City_Code_newbkp21Apr18
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXState_City_Code_newbkp21Apr18]
(
    [State] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [Code] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mimansa_angel_mcx_client_data_new
-- --------------------------------------------------
CREATE TABLE [dbo].[mimansa_angel_mcx_client_data_new]
(
    [client code] VARCHAR(10) NULL,
    [client first name] VARCHAR(8000) NULL,
    [middle name] VARCHAR(8000) NULL,
    [last name] VARCHAR(8000) NULL,
    [category] VARCHAR(2) NOT NULL,
    [client address1] VARCHAR(40) NULL,
    [address 2] VARCHAR(40) NULL,
    [address 3] VARCHAR(40) NULL,
    [city] VARCHAR(40) NULL,
    [state] VARCHAR(50) NULL,
    [country] VARCHAR(15) NULL,
    [pin code] VARCHAR(10) NULL,
    [telephone number] VARCHAR(8000) NULL,
    [client agreement date] VARCHAR(8000) NULL,
    [date of birth] VARCHAR(8000) NULL,
    [pan number] VARCHAR(50) NULL,
    [ward number] VARCHAR(50) NULL,
    [uin] VARCHAR(1) NULL,
    [bank name] VARCHAR(50) NULL,
    [bank branch address] VARCHAR(194) NULL,
    [bank account number] VARCHAR(20) NULL,
    [bank account type] VARCHAR(7) NULL,
    [depository name (nsdl)] VARCHAR(4) NOT NULL,
    [depository participant id (nsdl)] VARCHAR(20) NULL,
    [depository participant name (nsdl)] VARCHAR(50) NULL,
    [beneficiary account id (nsdl)] VARCHAR(16) NULL,
    [depository name (cdsl)] VARCHAR(4) NOT NULL,
    [depository participant id (cdsl)] VARCHAR(20) NULL,
    [depository participant name (cdsl)] VARCHAR(50) NULL,
    [beneficiary account id (cdsl)] VARCHAR(16) NULL,
    [passport number] VARCHAR(30) NULL,
    [place of issue of passport] VARCHAR(30) NULL,
    [date of issue of passport] VARCHAR(8000) NULL,
    [expiry date of passport] VARCHAR(8000) NULL,
    [driving license number] VARCHAR(30) NULL,
    [place of issue of driving license number] VARCHAR(30) NULL,
    [date of issue of driving license number] VARCHAR(8000) NULL,
    [expiry date of driving license number] VARCHAR(8000) NULL,
    [voter id] VARCHAR(30) NULL,
    [place of issue of voter id number] VARCHAR(30) NULL,
    [date of issue of voter id number] VARCHAR(8000) NULL,
    [ration card number] VARCHAR(30) NULL,
    [place of issue of ration card number] VARCHAR(30) NULL,
    [date of issue of ration card number] VARCHAR(8000) NULL,
    [registration number of client] VARCHAR(50) NULL,
    [registering authority] VARCHAR(50) NULL,
    [place of registration] VARCHAR(50) NULL,
    [date of registration] VARCHAR(8000) NULL,
    [introducers name] VARCHAR(30) NULL,
    [introducers client id] VARCHAR(50) NULL,
    [relationship with the introducer] VARCHAR(50) NULL,
    [dealing with other member] VARCHAR(1) NOT NULL,
    [relationship code] VARCHAR(10) NOT NULL,
    [status] CHAR(1) NOT NULL,
    [flag] VARCHAR(1) NULL,
    [sms_email_status] CHAR(10) NULL,
    [mobile_number] VARCHAR(25) NULL,
    [email_id] VARCHAR(500) NULL,
    [reserved] VARCHAR(10) NULL,
    [reserved1] VARCHAR(10) NULL,
    [reserved2] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mimansa_angel_mcx_client_data_selected_clients
-- --------------------------------------------------
CREATE TABLE [dbo].[mimansa_angel_mcx_client_data_selected_clients]
(
    [client code] VARCHAR(10) NULL,
    [client first name] VARCHAR(8000) NULL,
    [middle name] VARCHAR(8000) NULL,
    [last name] VARCHAR(8000) NULL,
    [category] VARCHAR(2) NOT NULL,
    [client address1] VARCHAR(40) NULL,
    [address 2] VARCHAR(40) NULL,
    [address 3] VARCHAR(40) NULL,
    [city] VARCHAR(40) NULL,
    [state] VARCHAR(50) NULL,
    [country] VARCHAR(15) NULL,
    [pin code] VARCHAR(10) NULL,
    [telephone number] VARCHAR(8000) NULL,
    [client agreement date] VARCHAR(8000) NULL,
    [date of birth] VARCHAR(8000) NULL,
    [pan number] VARCHAR(50) NULL,
    [ward number] VARCHAR(50) NULL,
    [uin] VARCHAR(1) NULL,
    [bank name] VARCHAR(50) NULL,
    [bank branch address] VARCHAR(194) NULL,
    [bank account number] VARCHAR(20) NULL,
    [bank account type] VARCHAR(7) NULL,
    [depository name (nsdl)] VARCHAR(4) NOT NULL,
    [depository participant id (nsdl)] VARCHAR(20) NULL,
    [depository participant name (nsdl)] VARCHAR(50) NULL,
    [beneficiary account id (nsdl)] VARCHAR(16) NULL,
    [depository name (cdsl)] VARCHAR(4) NOT NULL,
    [depository participant id (cdsl)] VARCHAR(20) NULL,
    [depository participant name (cdsl)] VARCHAR(50) NULL,
    [beneficiary account id (cdsl)] VARCHAR(16) NULL,
    [passport number] VARCHAR(30) NULL,
    [place of issue of passport] VARCHAR(30) NULL,
    [date of issue of passport] VARCHAR(8000) NULL,
    [expiry date of passport] VARCHAR(8000) NULL,
    [driving license number] VARCHAR(30) NULL,
    [place of issue of driving license number] VARCHAR(30) NULL,
    [date of issue of driving license number] VARCHAR(8000) NULL,
    [expiry date of driving license number] VARCHAR(8000) NULL,
    [voter id] VARCHAR(30) NULL,
    [place of issue of voter id number] VARCHAR(30) NULL,
    [date of issue of voter id number] VARCHAR(8000) NULL,
    [ration card number] VARCHAR(30) NULL,
    [place of issue of ration card number] VARCHAR(30) NULL,
    [date of issue of ration card number] VARCHAR(8000) NULL,
    [registration number of client] VARCHAR(50) NULL,
    [registering authority] VARCHAR(50) NULL,
    [place of registration] VARCHAR(50) NULL,
    [date of registration] VARCHAR(8000) NULL,
    [introducers name] VARCHAR(30) NULL,
    [introducers client id] VARCHAR(50) NULL,
    [relationship with the introducer] VARCHAR(50) NULL,
    [dealing with other member] VARCHAR(1) NOT NULL,
    [relationship code] VARCHAR(10) NOT NULL,
    [status] CHAR(1) NOT NULL,
    [flag] VARCHAR(1) NULL,
    [sms_email_status] CHAR(10) NULL,
    [mobile_number] VARCHAR(25) NULL,
    [email_id] VARCHAR(500) NULL,
    [reserved] VARCHAR(10) NULL,
    [reserved1] VARCHAR(10) NULL,
    [reserved2] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mimansa_angel_tbl_ucc_nse_SLB_trade
-- --------------------------------------------------
CREATE TABLE [dbo].[mimansa_angel_tbl_ucc_nse_SLB_trade]
(
    [party_code] VARCHAR(20) NULL,
    [Active_From] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mimansa_angel_ucc_nse_slb_client_data_new_changes
-- --------------------------------------------------
CREATE TABLE [dbo].[mimansa_angel_ucc_nse_slb_client_data_new_changes]
(
    [Segment] VARCHAR(1) NULL,
    [Client_Code] VARCHAR(10) NULL,
    [Client_Name] VARCHAR(150) NULL,
    [Category] VARCHAR(10) NULL,
    [PAN] VARCHAR(10) NULL,
    [Gender] VARCHAR(2) NULL,
    [Fathers_Husbands_GuardiansName] VARCHAR(150) NULL,
    [Maritalstatus] VARCHAR(2) NULL,
    [Nationality] VARCHAR(2) NULL,
    [Nationality_Other] VARCHAR(50) NULL,
    [ClientEmailId] VARCHAR(60) NULL,
    [CorrespondenceClientAddressline1] VARCHAR(255) NULL,
    [CorrespondenceClientAddressline2] VARCHAR(255) NULL,
    [CorrespondenceClientAddressline3] VARCHAR(255) NULL,
    [CorrespondenceClientAddress_City] VARCHAR(50) NULL,
    [CorrespondenceClientAddress_State] VARCHAR(2) NULL,
    [CorrespondenceClientAddress_State_Others] VARCHAR(75) NULL,
    [CorrespondenceClientAddress_Country] VARCHAR(3) NULL,
    [CorrespondenceClientAddress_Pincode] VARCHAR(10) NULL,
    [FlagIndicatingifCorrespondenceAddressissameasPermanentAddress] VARCHAR(1) NULL,
    [PermanentClientAddressline1] VARCHAR(255) NULL,
    [PermanentClientAddressline2] VARCHAR(255) NULL,
    [PermanentClientAddressline3] VARCHAR(255) NULL,
    [PermanentClientAddress_City] VARCHAR(50) NULL,
    [PermanentClientAddress_State] VARCHAR(2) NULL,
    [PermanentClientAddress_StateOthers] VARCHAR(75) NULL,
    [PermanentClientAddress_Country] VARCHAR(2) NULL,
    [PermanentClientAddress_Pincode] VARCHAR(10) NULL,
    [ISDcode_Residence] VARCHAR(10) NULL,
    [STDcode_Residence] VARCHAR(10) NULL,
    [TelephoneNumber_Residence] VARCHAR(60) NULL,
    [Mobilenumber] VARCHAR(20) NULL,
    [ISDcode_Office] VARCHAR(10) NULL,
    [STDcode_Office] VARCHAR(10) NULL,
    [TelephoneNumber_Office] VARCHAR(60) NULL,
    [DateofBirth_Incorporation] VARCHAR(60) NULL,
    [UIDNUMBER] VARCHAR(12) NULL,
    [BankName1] VARCHAR(60) NULL,
    [BankBranchAddress1] VARCHAR(255) NULL,
    [BankAccountNo1] VARCHAR(25) NULL,
    [BankAccountType1] VARCHAR(2) NULL,
    [BankName2] VARCHAR(60) NULL,
    [BankBranchAddress2] VARCHAR(255) NULL,
    [BankAccountNo2] VARCHAR(25) NULL,
    [BankAccountType2] VARCHAR(2) NULL,
    [BankName3] VARCHAR(60) NULL,
    [BankBranchAddress3] VARCHAR(255) NULL,
    [BankAccountNo3] VARCHAR(25) NULL,
    [BankAccountType3] VARCHAR(2) NULL,
    [DepositoryName1] VARCHAR(4) NULL,
    [DepositoryID1] VARCHAR(8) NULL,
    [BeneficialOwnerAccountNo1] VARCHAR(16) NULL,
    [DepositoryName2] VARCHAR(4) NULL,
    [DepositoryID2] VARCHAR(8) NULL,
    [BeneficialOwnerAccountNo2] VARCHAR(16) NULL,
    [DepositoryName3] VARCHAR(4) NULL,
    [DepositoryID3] VARCHAR(8) NULL,
    [BeneficialOwnerAccountNo3] VARCHAR(16) NULL,
    [CorporateIdentitynumber_CIN] VARCHAR(21) NULL,
    [GrossAnnualIncomeRange] VARCHAR(40) NULL,
    [GrossAnnualIncomeasonDate] VARCHAR(40) NULL,
    [NetWorth_InRs] VARCHAR(40) NULL,
    [NetWorthasonDate] VARCHAR(40) NULL,
    [PoliticallyExposedPerson_PEP] VARCHAR(2) NULL,
    [PlaceofIncorporation] VARCHAR(75) NULL,
    [Occupation] VARCHAR(2) NULL,
    [OccupationDetails_Forothers] VARCHAR(75) NULL,
    [Dateofcommencementofbusiness] VARCHAR(40) NULL,
    [CustodialParticipantCodeoftheclient] VARCHAR(15) NULL,
    [RegistrationNoofClient] VARCHAR(25) NULL,
    [RegisteringAuthority] VARCHAR(60) NULL,
    [PlaceofRegistration] VARCHAR(25) NULL,
    [DateofRegistration] VARCHAR(40) NULL,
    [InpersonVerification] VARCHAR(1) NULL,
    [ClientAgreementDate] VARCHAR(40) NULL,
    [UniqueClientCodeallottedbyNSCCL_BSE] VARCHAR(10) NULL,
    [UpdationFlag_for_SMS_and_Email_facility] VARCHAR(1) NULL,
    [Relationship] VARCHAR(1) NULL,
    [TypeofFacility_for_SMS_and_Email_facility] VARCHAR(1) NULL,
    [ProofType] VARCHAR(1) NULL,
    [ProofNumber] VARCHAR(25) NULL,
    [IssuePlaceofProof] VARCHAR(100) NULL,
    [IssueDateofProof] VARCHAR(40) NULL,
    [ClientStatus] VARCHAR(1) NULL,
    [Remarks] VARCHAR(200) NULL,
    [ClientType_Corporate] VARCHAR(200) NULL,
    [NameofcontactPerson_1] VARCHAR(200) NULL,
    [DesignationofContactPerson_1] VARCHAR(200) NULL,
    [PANofcontactPerson_1] VARCHAR(200) NULL,
    [AddressofcontactPerson_1] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_1] VARCHAR(200) NULL,
    [DINofcontactPerson_1] VARCHAR(200) NULL,
    [UIDofcontactPerson_1] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_1] VARCHAR(200) NULL,
    [NameofcontactPerson_2] VARCHAR(200) NULL,
    [DesignationofcontactPerson_2] VARCHAR(200) NULL,
    [PANofcontactPerson_2] VARCHAR(200) NULL,
    [AddressofcontactPerson_2] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_2] VARCHAR(200) NULL,
    [DINofcontactPerson_2] VARCHAR(200) NULL,
    [UIDofcontactPerson_2] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_2] VARCHAR(200) NULL,
    [NameofcontactPerson_3] VARCHAR(200) NULL,
    [DesignationofcontactPerson_3] VARCHAR(200) NULL,
    [PANofcontactPerson_3] VARCHAR(200) NULL,
    [AddressofcontactPerson_3] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_3] VARCHAR(200) NULL,
    [DINofcontactPerson_3] VARCHAR(200) NULL,
    [UIDofcontactPerson_3] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_3] VARCHAR(200) NULL,
    [NameofcontactPerson_4] VARCHAR(200) NULL,
    [DesignationofcontactPerson_4] VARCHAR(200) NULL,
    [PANofcontactPerson_4] VARCHAR(200) NULL,
    [AddressofcontactPerson_4] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_4] VARCHAR(200) NULL,
    [DINofcontactPerson_4] VARCHAR(200) NULL,
    [UIDofcontactPerson_4] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_4] VARCHAR(200) NULL,
    [NameofcontactPerson_5] VARCHAR(200) NULL,
    [DesignationofcontactPerson_5] VARCHAR(200) NULL,
    [PANofcontactPerson_5] VARCHAR(200) NULL,
    [AddressofcontactPerson_5] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_5] VARCHAR(200) NULL,
    [DINofcontactPerson_5] VARCHAR(200) NULL,
    [UIDofcontactPerson_5] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_5] VARCHAR(200) NULL,
    [NameofcontactPerson_6] VARCHAR(200) NULL,
    [DesignationofcontactPerson_6] VARCHAR(200) NULL,
    [PANofcontactPerson_6] VARCHAR(200) NULL,
    [AddressofcontactPerson_6] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_6] VARCHAR(200) NULL,
    [DINofcontactPerson_6] VARCHAR(200) NULL,
    [UIDofcontactPerson_6] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_6] VARCHAR(200) NULL,
    [NameofcontactPerson_7] VARCHAR(200) NULL,
    [DesignationofcontactPerson_7] VARCHAR(200) NULL,
    [PANofcontactPerson_7] VARCHAR(200) NULL,
    [AddressofcontactPerson_7] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_7] VARCHAR(200) NULL,
    [DINofcontactPerson_7] VARCHAR(200) NULL,
    [UIDofcontactPerson_7] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_7] VARCHAR(200) NULL,
    [NameofcontactPerson_8] VARCHAR(200) NULL,
    [DesignationofcontactPerson_8] VARCHAR(200) NULL,
    [PANofcontactPerson_8] VARCHAR(200) NULL,
    [AddressofcontactPerson_8] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_8] VARCHAR(200) NULL,
    [DINofcontactPerson_8] VARCHAR(200) NULL,
    [UIDofcontactPerson_8] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_8] VARCHAR(200) NULL,
    [NameofcontactPerson_9] VARCHAR(200) NULL,
    [DesignationofcontactPerson_9] VARCHAR(200) NULL,
    [PANofcontactPerson_9] VARCHAR(200) NULL,
    [AddressofcontactPerson_9] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_9] VARCHAR(200) NULL,
    [DINofcontactPerson_9] VARCHAR(200) NULL,
    [UIDofcontactPerson_9] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_9] VARCHAR(200) NULL,
    [NameofcontactPerson_10] VARCHAR(200) NULL,
    [DesignationofcontactPerson_10] VARCHAR(200) NULL,
    [PANofcontactPerson_10] VARCHAR(200) NULL,
    [AddressofcontactPerson_10] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_10] VARCHAR(200) NULL,
    [DINofcontactPerson_10] VARCHAR(200) NULL,
    [UIDofcontactPerson_10] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_10] VARCHAR(200) NULL,
    [NameofcontactPerson_11] VARCHAR(200) NULL,
    [DesignationofcontactPerson_11] VARCHAR(200) NULL,
    [PANofcontactPerson_11] VARCHAR(200) NULL,
    [AddressofcontactPerson_11] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_11] VARCHAR(200) NULL,
    [DINofcontactPerson_11] VARCHAR(200) NULL,
    [UIDofcontactPerson_11] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_11] VARCHAR(200) NULL,
    [NameofcontactPerson_12] VARCHAR(200) NULL,
    [DesignationofcontactPerson_12] VARCHAR(200) NULL,
    [PANofcontactPerson_12] VARCHAR(200) NULL,
    [AddressofcontactPerson_12] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_12] VARCHAR(200) NULL,
    [DINofcontactPerson_12] VARCHAR(200) NULL,
    [UIDofcontactPerson_12] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_12] VARCHAR(200) NULL,
    [NameofcontactPerson_13] VARCHAR(200) NULL,
    [DesignationofcontactPerson_13] VARCHAR(200) NULL,
    [PANofcontactPerson_13] VARCHAR(200) NULL,
    [AddressofcontactPerson_13] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_13] VARCHAR(200) NULL,
    [DINofcontactPerson_13] VARCHAR(200) NULL,
    [UIDofcontactPerson_13] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_13] VARCHAR(200) NULL,
    [NameofcontactPerson_14] VARCHAR(200) NULL,
    [DesignationofcontactPerson_14] VARCHAR(200) NULL,
    [PANofcontactPerson_14] VARCHAR(200) NULL,
    [AddressofcontactPerson_14] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_14] VARCHAR(200) NULL,
    [DINofcontactPerson_14] VARCHAR(200) NULL,
    [UIDofcontactPerson_14] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_14] VARCHAR(200) NULL,
    [NameofcontactPerson_15] VARCHAR(200) NULL,
    [DesignationofcontactPerson_15] VARCHAR(200) NULL,
    [PANofcontactPerson_15] VARCHAR(200) NULL,
    [AddressofcontactPerson_15] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_15] VARCHAR(200) NULL,
    [DINofcontactPerson_15] VARCHAR(200) NULL,
    [UIDofcontactPerson_15] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_15] VARCHAR(200) NULL,
    [NameofcontactPerson_16] VARCHAR(200) NULL,
    [DesignationofcontactPerson_16] VARCHAR(200) NULL,
    [PANofcontactPerson_16] VARCHAR(200) NULL,
    [AddressofcontactPerson_16] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_16] VARCHAR(200) NULL,
    [DINofcontactPerson_16] VARCHAR(200) NULL,
    [UIDofcontactPerson_16] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_16] VARCHAR(200) NULL,
    [NameofcontactPerson_17] VARCHAR(200) NULL,
    [DesignationofcontactPerson_17] VARCHAR(200) NULL,
    [PANofcontactPerson_17] VARCHAR(200) NULL,
    [AddressofcontactPerson_17] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_17] VARCHAR(200) NULL,
    [DINofcontactPerson_17] VARCHAR(200) NULL,
    [UIDofcontactPerson_17] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_17] VARCHAR(200) NULL,
    [NameofcontactPerson_18] VARCHAR(200) NULL,
    [DesignationofcontactPerson_18] VARCHAR(200) NULL,
    [PANofcontactPerson_18] VARCHAR(200) NULL,
    [AddressofcontactPerson_18] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_18] VARCHAR(200) NULL,
    [DINofcontactPerson_18] VARCHAR(200) NULL,
    [UIDofcontactPerson_18] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_18] VARCHAR(200) NULL,
    [NameofcontactPerson_19] VARCHAR(200) NULL,
    [DesignationofcontactPerson_19] VARCHAR(200) NULL,
    [PANofcontactPerson_19] VARCHAR(200) NULL,
    [AddressofcontactPerson_19] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_19] VARCHAR(200) NULL,
    [DINofcontactPerson_19] VARCHAR(200) NULL,
    [UIDofcontactPerson_19] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_19] VARCHAR(200) NULL,
    [NameofcontactPerson_20] VARCHAR(200) NULL,
    [DesignationofcontactPerson_20] VARCHAR(200) NULL,
    [PANofcontactPerson_20] VARCHAR(200) NULL,
    [AddressofcontactPerson_20] VARCHAR(200) NULL,
    [ContactdetailsofcontactPerson_20] VARCHAR(200) NULL,
    [DINofcontactPerson_20] VARCHAR(200) NULL,
    [UIDofcontactPerson_20] VARCHAR(200) NULL,
    [EmailIdofcontactPerson_20] VARCHAR(200) NULL,
    [Flag] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mimansa_tbl_ucc_mcx_file_count
-- --------------------------------------------------
CREATE TABLE [dbo].[mimansa_tbl_ucc_mcx_file_count]
(
    [row_id] BIGINT IDENTITY(1,1) NOT NULL,
    [file_number] SMALLINT NOT NULL,
    [time_stamp] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mimansa_tbl_ucc_mcx_selected_clients
-- --------------------------------------------------
CREATE TABLE [dbo].[mimansa_tbl_ucc_mcx_selected_clients]
(
    [party_code] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NCMS_com_03Aug2021
-- --------------------------------------------------
CREATE TABLE [dbo].[NCMS_com_03Aug2021]
(
    [cltcode] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NCMS_com_04Aug2021
-- --------------------------------------------------
CREATE TABLE [dbo].[NCMS_com_04Aug2021]
(
    [cltcode] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.parameter
-- --------------------------------------------------
CREATE TABLE [dbo].[parameter]
(
    [sdtcur] DATETIME NULL,
    [ldtcur] DATETIME NULL,
    [ldtprv] DATETIME NULL,
    [sdtnxt] DATETIME NULL,
    [curyear] TINYINT NULL,
    [vnoflag] SMALLINT NULL,
    [Match_BtoB] SMALLINT NULL,
    [Match_CtoC] SMALLINT NULL,
    [Maker_Checker] SMALLINT NULL,
    [branchflag] TINYINT NULL,
    [voucherprintflag] TINYINT NULL,
    [reportdays] INT NULL,
    [FLDAUTO] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PE_BadDebts_lbdetails
-- --------------------------------------------------
CREATE TABLE [dbo].[PE_BadDebts_lbdetails]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [vdt] DATETIME NULL,
    [vtyp] SMALLINT NOT NULL,
    [vno] VARCHAR(12) NULL,
    [narration] VARCHAR(234) NULL,
    [Seg] VARCHAR(4) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.region
-- --------------------------------------------------
CREATE TABLE [dbo].[region]
(
    [RegionCode] VARCHAR(10) NULL,
    [Description] VARCHAR(50) NULL,
    [Branch_Code] VARCHAR(10) NULL,
    [Dummy1] VARCHAR(1) NULL,
    [Dummy2] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip1
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip1]
(
    [co_code] INT NULL,
    [series] VARCHAR(3) NOT NULL,
    [short_name] VARCHAR(50) NULL,
    [long_name] VARCHAR(50) NULL,
    [market_lot] INT NULL,
    [face_val] FLOAT NULL,
    [book_cl_dt] DATETIME NULL,
    [ex_div_dt] DATETIME NULL,
    [ex_bon_dt] DATETIME NULL,
    [ex_rit_dt] DATETIME NULL,
    [eqt_type] VARCHAR(3) NULL,
    [sub_type] VARCHAR(3) NULL,
    [agent_cd] VARCHAR(6) NULL,
    [demat_flag] SMALLINT NULL,
    [demat_date] DATETIME NULL,
    [rec1] VARCHAR(10) NULL,
    [rec2] VARCHAR(10) NULL,
    [rec3] VARCHAR(10) NULL,
    [rec4] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip2
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip2]
(
    [co_code] INT NULL,
    [series] VARCHAR(3) NOT NULL,
    [exchange] VARCHAR(3) NULL,
    [scrip_cd] VARCHAR(12) NOT NULL,
    [scrip_cat] VARCHAR(3) NULL,
    [no_del_fr] DATETIME NULL,
    [no_del_to] DATETIME NULL,
    [cl_rate] FLOAT NULL,
    [clos_rate_dt] DATETIME NULL,
    [min_trd_qty] INT NULL,
    [BseCode] VARCHAR(10) NULL,
    [Isin] VARCHAR(20) NULL,
    [delsc_cat] VARCHAR(3) NULL,
    [Sector] VARCHAR(10) NULL,
    [Track] VARCHAR(1) NULL,
    [CDOL_No] VARCHAR(15) NULL,
    [Res1] VARCHAR(10) NULL,
    [Res2] VARCHAR(10) NULL,
    [Res3] VARCHAR(10) NULL,
    [Res4] VARCHAR(10) NULL,
    [Globalcustodian] VARCHAR(25) NULL,
    [common_code] VARCHAR(25) NULL,
    [IndexName] VARCHAR(10) NULL,
    [Industry] VARCHAR(10) NULL,
    [Bloomberg] VARCHAR(10) NULL,
    [RicCode] VARCHAR(10) NULL,
    [Reuters] VARCHAR(10) NULL,
    [IES] VARCHAR(10) NULL,
    [NoofIssuedshares] NUMERIC(18, 4) NULL,
    [Status] VARCHAR(10) NULL,
    [ADRGDRRatio] NUMERIC(18, 4) NULL,
    [GEMultiple] NUMERIC(18, 4) NULL,
    [GroupforGE] INT NULL,
    [RBICeilingIndicatorFlag] VARCHAR(2) NULL,
    [RBICeilingIndicatorValue] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[sett_mst]
(
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(3) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.settlement
-- --------------------------------------------------
CREATE TABLE [dbo].[settlement]
(
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] VARCHAR(10) NULL,
    [Trade_no] VARCHAR(12) NOT NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(10) NOT NULL,
    [User_id] VARCHAR(10) NOT NULL,
    [Tradeqty] INT NULL,
    [AuctionPart] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL,
    [Series] VARCHAR(3) NOT NULL,
    [Order_no] VARCHAR(16) NULL,
    [MarketRate] MONEY NULL,
    [Sauda_date] DATETIME NOT NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NULL,
    [Normal] MONEY NULL,
    [Day_puc] MONEY NULL,
    [day_sales] MONEY NULL,
    [Sett_purch] MONEY NULL,
    [Sett_sales] MONEY NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NULL,
    [Brokapplied] MONEY NULL,
    [NetRate] NUMERIC(18, 4) NULL,
    [Amount] MONEY NULL,
    [Ins_chrg] MONEY NULL,
    [turn_tax] MONEY NULL,
    [other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Service_tax] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [Billflag] INT NULL,
    [sett_no] VARCHAR(7) NULL,
    [NBrokApp] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(18, 4) NULL,
    [sett_type] VARCHAR(3) NULL,
    [participantcode] CHAR(15) NULL,
    [status] CHAR(2) NULL,
    [pro_cli] VARCHAR(10) NULL,
    [cpid] VARCHAR(20) NULL,
    [instrument] VARCHAR(2) NULL,
    [bookType] VARCHAR(2) NULL,
    [branch_id] VARCHAR(10) NULL,
    [dummy1] VARCHAR(2) NULL,
    [dummy2] MONEY NULL,
    [tmark] CHAR(2) NULL,
    [Scheme] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SlowDiskIoFiles
-- --------------------------------------------------
CREATE TABLE [dbo].[SlowDiskIoFiles]
(
    [Database Name] NVARCHAR(128) NULL,
    [physical_name] NVARCHAR(260) NOT NULL,
    [io_stall_read_ms] BIGINT NOT NULL,
    [num_of_reads] BIGINT NOT NULL,
    [avg_read_stall_ms] NUMERIC(10, 1) NULL,
    [io_stall_write_ms] BIGINT NOT NULL,
    [num_of_writes] BIGINT NOT NULL,
    [avg_write_stall_ms] NUMERIC(10, 1) NULL,
    [io_stalls] BIGINT NULL,
    [total_io] BIGINT NULL,
    [avg_io_stall_ms] NUMERIC(10, 1) NULL,
    [RecordDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.subbrokers
-- --------------------------------------------------
CREATE TABLE [dbo].[subbrokers]
(
    [Sub_Broker] VARCHAR(10) NOT NULL,
    [Name] VARCHAR(30) NULL,
    [Address1] CHAR(100) NULL,
    [Address2] CHAR(100) NULL,
    [City] CHAR(20) NULL,
    [State] CHAR(15) NULL,
    [Nation] CHAR(15) NULL,
    [Zip] CHAR(10) NULL,
    [Fax] CHAR(15) NULL,
    [Phone1] CHAR(15) NULL,
    [Phone2] CHAR(15) NULL,
    [Reg_No] CHAR(30) NULL,
    [Registered] BIT NOT NULL,
    [Main_Sub] CHAR(1) NULL,
    [Email] CHAR(50) NULL,
    [Com_Perc] MONEY NULL,
    [Branch_Code] VARCHAR(10) NULL,
    [Contact_Person] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sysdiagrams
-- --------------------------------------------------
CREATE TABLE [dbo].[sysdiagrams]
(
    [name] NVARCHAR(128) NOT NULL,
    [principal_id] INT NOT NULL,
    [diagram_id] INT IDENTITY(1,1) NOT NULL,
    [version] INT NULL,
    [definition] VARBINARY(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_clientmargin
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_clientmargin]
(
    [party_code] VARCHAR(15) NOT NULL,
    [margindate] DATETIME NOT NULL,
    [billamount] MONEY NOT NULL,
    [ledgeramount] MONEY NOT NULL,
    [cash_coll] MONEY NOT NULL,
    [noncash_coll] MONEY NOT NULL,
    [initialmargin] MONEY NOT NULL,
    [lst_update_dt] DATETIME NOT NULL,
    [short_name] VARCHAR(25) NULL,
    [long_name] VARCHAR(100) NULL,
    [branch_cd] VARCHAR(20) NULL,
    [family] VARCHAR(20) NULL,
    [sub_broker] VARCHAR(20) NULL,
    [trader] VARCHAR(20) NULL,
    [MTMMargin] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblUCCClientCode
-- --------------------------------------------------
CREATE TABLE [dbo].[tblUCCClientCode]
(
    [party_code] VARCHAR(20) NULL,
    [processid] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblUCCClientCode_ADTest
-- --------------------------------------------------
CREATE TABLE [dbo].[tblUCCClientCode_ADTest]
(
    [party_code] VARCHAR(20) NULL,
    [processid] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblUCCMCXClientCode
-- --------------------------------------------------
CREATE TABLE [dbo].[tblUCCMCXClientCode]
(
    [PartyCode] NVARCHAR(50) NULL,
    [Name] NVARCHAR(550) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblUCCMCXClientCode_ADTest
-- --------------------------------------------------
CREATE TABLE [dbo].[tblUCCMCXClientCode_ADTest]
(
    [ClientCode] NVARCHAR(255) NULL,
    [ClientName] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblUCCMCXClientCode_ADTest1
-- --------------------------------------------------
CREATE TABLE [dbo].[tblUCCMCXClientCode_ADTest1]
(
    [PartyCode] NVARCHAR(50) NULL,
    [Name] NVARCHAR(550) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblUCCMCXClientCode_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tblUCCMCXClientCode_Temp]
(
    [PartyCode] NVARCHAR(50) NULL,
    [Name] NVARCHAR(550) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vmast
-- --------------------------------------------------
CREATE TABLE [dbo].[vmast]
(
    [Vtype] SMALLINT NOT NULL,
    [Vdesc] VARCHAR(35) NOT NULL,
    [ShortDesc] CHAR(6) NULL,
    [DispFlag] CHAR(1) NULL
);

GO

